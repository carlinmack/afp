<div id='Gale_Shapley2'>ody>
<div class="head">
<h1>Theory Gale_Shapley1</h1>
</div>

<pre class="source"><span class="comment1"><span>(</span><span>*</span><span>
Stepwise refinement of the Gale-Shapley algorithm down to executable functional code.

Part 1: Refinement down to lists.

Author: Tobias Nipkow
</span><span>*</span><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>theory</span></span></span><span> </span><span>Gale_Shapley1</span><span>
</span><span class="keyword2"><span class="keyword"><span>imports</span></span></span><span> </span><a href="../../HOL/HOL/Main.html"><span>Main</span></a><span>
  </span><span class="quoted"><span>"</span><a href="../../HOL/HOL-Hoare/Hoare_Logic.html"><span>HOL-Hoare.Hoare_Logic</span></a><span>"</span></span><span>
  </span><span class="quoted"><span>"</span><a href="../List-Index/List_Index.html"><span>List-Index.List_Index</span></a><span>"</span></span><span>
  </span><span class="quoted"><span>"</span><a href="../../HOL/HOL-Library/While_Combinator.html"><span>HOL-Library.While_Combinator</span></a><span>"</span></span><span>
  </span><span class="quoted"><span>"</span><a href="../../HOL/HOL-Library/LaTeXsugar.html"><span>HOL-Library.LaTeXsugar</span></a><span>"</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>begin</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemmas</span></span></span><span> </span><span class="entity_def" id="Gale_Shapley1.conj12|fact"><span class="entity_def" id="Gale_Shapley1.conj12(2)|thm"><span class="entity_def" id="Gale_Shapley1.conj12(1)|thm"><span>conj12</span></span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conjunct1|fact"><span>conjunct1</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conjunct2|fact"><span>conjunct2</span></a><span>

</span><span class="comment1"><span>(</span><span>*</span><span> TODO: mv </span><span>*</span><span>)</span></span><span>
</span><span class="keyword1"><span class="command"><span>theorem</span></span></span><span> </span><span class="entity_def" id="Gale_Shapley1.while_rule2|fact"><span class="entity_def" id="Gale_Shapley1.while_rule2|thm"><span>while_rule2</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>[|</span></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="free"><span>s</span></span><span class="main"><span>;</span></span><span>
      </span><span class="main"><span>!!</span></span><span class="bound"><span>s</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>[|</span></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="bound"><span>s</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>b</span></span><span> </span><span class="bound"><span>s</span></span><span>  </span><span class="main"><span>|]</span></span><span> </span><span class="main"><span>==&gt;</span></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>c</span></span><span> </span><span class="bound"><span>s</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>c</span></span><span> </span><span class="bound"><span>s</span></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>s</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>â</span></a></span><span> </span><span class="free"><span>r</span></span><span class="main"><span>;</span></span><span>
      </span><span class="main"><span>!!</span></span><span class="bound"><span>s</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>[|</span></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="bound"><span>s</span></span><span class="main"><span>;</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>Â¬</span></a></span><span> </span><span class="free"><span>b</span></span><span> </span><span class="bound"><span>s</span></span><span>  </span><span class="main"><span>|]</span></span><span> </span><span class="main"><span>==&gt;</span></span><span> </span><span class="free"><span>Q</span></span><span> </span><span class="bound"><span>s</span></span><span class="main"><span>;</span></span><span>
      </span><a class="entity_ref" href="../../HOL/HOL/Wellfounded.html#Wellfounded.wf|const"><span>wf</span></a><span> </span><span class="free"><span>r</span></span><span> </span><span class="main"><span>|]</span></span><span> </span><span class="main"><span>==&gt;</span></span><span>
   </span><span class="free"><span>Q</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL-Library/While_Combinator.html#While_Combinator.while|const"><span>while</span></a><span> </span><span class="free"><span>b</span></span><span> </span><span class="free"><span>c</span></span><span> </span><span class="free"><span>s</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL-Library/While_Combinator.html#While_Combinator.while_rule|fact"><span>while_rule</span></a><span class="main"><span>[</span></span><span class="operator"><span>of</span></span><span> </span><span class="quoted"><span class="free"><span>P</span></span></span><span class="main"><span>]</span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>metis</span></span><span>

</span><span class="comment1"><span>(</span><span>*</span><span> by now in Map </span><span>*</span><span>)</span></span><span>
</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Gale_Shapley1.ran_map_upd_Some|fact"><span class="entity_def" id="Gale_Shapley1.ran_map_upd_Some|thm"><span>ran_map_upd_Some</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>â¦</span></span><span> </span><span class="free"><span>m</span></span><span> </span><span class="free"><span>x</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Option.html#Option.option.Some|const"><span>Some</span></a><span> </span><span class="free"><span>y</span></span><span class="main"><span>;</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.inj_on|const"><span>inj_on</span></a><span> </span><span class="free"><span>m</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/Map.html#Map.dom|const"><span>dom</span></a><span> </span><span class="free"><span>m</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>z</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.not_member|const"><span>â</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Map.html#Map.ran|const"><span>ran</span></a><span> </span><span class="free"><span>m</span></span><span> </span><span class="main"><span>â§</span></span><span> </span><span class="main"><span>â¹</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Map.html#Map.ran|const"><span>ran</span></a><span class="main"><span>(</span></span><span class="free"><span>m</span></span><span class="main"><span>(</span></span><span class="free"><span>x</span></span><span> </span><span class="main"><span>:=</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Option.html#Option.option.Some|const"><span>Some</span></a><span> </span><span class="free"><span>z</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Map.html#Map.ran|const"><span>ran</span></a><span> </span><span class="free"><span>m</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="main"><span>{</span></span><span class="free"><span>y</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.union|const"><span>âª</span></a></span><span> </span><span class="main"><span>{</span></span><span class="free"><span>z</span></span><span class="main"><span>}</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>by</span></span></span><span class="main"><span>(</span></span><span class="operator"><span>force</span></span><span> </span><span class="quasi_keyword"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Map.html#Map.ran_def|fact"><span>ran_def</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Map.html#Map.domI|fact"><span>domI</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.inj_onD|fact"><span>inj_onD</span></a><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>syntax</span></span></span><span>
  </span><span class="quoted"><span>"</span><span>_assign_list</span><span>"</span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>idt</span><span> </span><span class="main"><span>â</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.nat|type"><span>nat</span></a><span> </span><span class="main"><span>â</span></span><span> </span><span class="tfree"><span>'b</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span class="tfree"><span>'com</span></span><span>"</span></span></span><span>  </span><span class="main"><span>(</span></span><span class="quoted"><span>"</span><span class="keyword3"><span>(2</span></span><span>_</span><span class="keyword1"><span>[</span></span><span>_</span><span class="keyword1"><span>]</span></span><span> </span><span class="keyword1"><span>:=</span></span><span class="keyword3"><span>/ </span></span><span>_</span><span class="keyword3"><span>)</span></span><span>"</span></span><span> </span><span class="main"><span>[</span></span><span>70</span><span class="main"><span>,</span></span><span> 0</span><span class="main"><span>,</span></span><span> 65</span><span class="main"><span>]</span></span><span> 61</span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>translations</span></span></span><span>
  </span><span class="quoted"><span>"</span><span class="free"><span>xs</span></span><span class="main"><span>[</span></span><span class="free"><span>n</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>:=</span></span><span> </span><span class="free"><span>e</span></span><span>"</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span class="quoted"><span>"</span><span class="free"><span>xs</span></span><span> </span><span class="main"><span>:=</span></span><span> </span><span class="keyword1"><span>CONST</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list_update|const"><span>list_update</span></a><span> </span><span class="free"><span>xs</span></span><span> </span><span class="free"><span>n</span></span><span> </span><span class="free"><span>e</span></span><span>"</span></span><span>

</span><span class="keyword1"><span class="command"><span>abbreviation</span></span></span><span> </span><span class="entity"><span class="entity_def" id="Gale_Shapley1.upt_set|const"><span>upt_set</span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.nat|type"><span>nat</span></a><span> </span><span class="main"><span>â</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.nat|type"><span>nat</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.set|type"><span>set</span></a><span>"</span></span></span><span> </span><span class="main"><span>(</span></span><span class="quoted"><span>"</span><span class="keyword1"><span>{&lt;</span></span><span>_</span><span class="keyword1"><span>}</span></span><span>"</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
</span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span class="free"><span>{&lt;</span></span></span><span class="free"><span class="bound"><span class="entity"><span>n</span></span></span></span><span class="main"><span class="free"><span>}</span></span></span><span> </span><span class="main"><span>â¡</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set_Interval.html#Set_Interval.ord_class.atLeastLessThan|const"><span>{</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set_Interval.html#Set_Interval.ord_class.atLeastLessThan|const"><span>..&lt;</span></a></span><span class="free"><span class="bound"><span class="entity"><span>n</span></span></span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set_Interval.html#Set_Interval.ord_class.atLeastLessThan|const"><span>}</span></a></span><span>"</span></span></span><span>

</span><span class="comment1"><span>(</span><span>*</span><span> Maybe also require y : set P? </span><span>*</span><span>)</span></span><span>
</span><span class="keyword1"><span class="command"><span class="entity_def" id="Gale_Shapley1.prefers_def|fact"><span class="entity_def" id="Gale_Shapley1.prefers_def|thm"><span class="entity_def" id="Gale_Shapley1.prefers_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="Gale_Shapley1.prefers|const"><span>prefers</span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'a</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list|type"><span>list</span></a><span> </span><span class="main"><span>â</span></span><span> </span><span class="tfree"><span>'a</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span class="tfree"><span>'a</span></span><span> </span><span class="main"><span>â</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.bool|type"><span>bool</span></a><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
</span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>prefers</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>P</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>x</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>y</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../List-Index/List_Index.html#List_Index.index|const"><span>index</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>P</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>x</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><a class="entity_ref" href="../List-Index/List_Index.html#List_Index.index|const"><span>index</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>P</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>y</span></span></span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>abbreviation</span></span></span><span> </span><span class="entity"><span class="entity_def" id="Gale_Shapley1.prefa|const"><span>prefa</span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="tfree"><span>'a</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list|type"><span>list</span></a><span> </span><span class="main"><span>â</span></span><span> </span><span class="tfree"><span>'a</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span class="tfree"><span>'a</span></span><span> </span><span class="main"><span>â</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.bool|type"><span>bool</span></a><span>"</span></span></span><span> </span><span class="main"><span>(</span></span><span class="quoted"><span>"</span><span class="keyword3"><span>(</span></span><span>_</span><span> </span><span class="keyword1"><span>â¢</span></span><span class="keyword3"><span>/ </span></span><span>_</span><span> </span><span class="keyword1"><span>&lt;</span></span><span> </span><span>_</span><span class="keyword3"><span>)</span></span><span>"</span></span><span> </span><span class="main"><span>[</span></span><span>50</span><span class="main"><span>,</span></span><span>50</span><span class="main"><span>,</span></span><span>50</span><span class="main"><span>]</span></span><span> 50</span><span class="main"><span>)</span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
</span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="bound"><span class="entity"><span>P</span></span></span></span><span> </span><span class="main"><span class="free"><span>â¢</span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>x</span></span></span></span><span> </span><span class="main"><span class="free"><span>&lt;</span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>y</span></span></span></span><span> </span><span class="main"><span>â¡</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.prefers|const"><span>prefers</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>P</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>x</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>y</span></span></span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Gale_Shapley1.prefers_asym|fact"><span class="entity_def" id="Gale_Shapley1.prefers_asym|thm"><span>prefers_asym</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>P</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.prefa|const"><span>â¢</span></a></span><span> </span><span class="free"><span>x</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.prefa|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>y</span></span><span> </span><span class="main"><span>â¹</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>Â¬</span></a></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.prefa|const"><span>â¢</span></a></span><span> </span><span class="free"><span>y</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.prefa|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>x</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>by</span></span></span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.prefers_def|fact"><span>prefers_def</span></a><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Gale_Shapley1.prefers_trans|fact"><span class="entity_def" id="Gale_Shapley1.prefers_trans|thm"><span>prefers_trans</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>P</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.prefa|const"><span>â¢</span></a></span><span> </span><span class="free"><span>x</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.prefa|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>y</span></span><span> </span><span class="main"><span>â¹</span></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.prefa|const"><span>â¢</span></a></span><span> </span><span class="free"><span>y</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.prefa|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>z</span></span><span> </span><span class="main"><span>â¹</span></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.prefa|const"><span>â¢</span></a></span><span> </span><span class="free"><span>x</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.prefa|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>z</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>meson</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.order_less_trans|fact"><span>order_less_trans</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.prefers_def|fact"><span>prefers_def</span></a><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="Gale_Shapley1.rk_of_pref.elims|fact"><span class="entity_def" id="Gale_Shapley1.rk_of_pref.induct|fact"><span class="entity_def" id="Gale_Shapley1.rk_of_pref.simps|fact"><span class="entity_def" id="Gale_Shapley1.rk_of_pref.pelims|fact"><span class="entity_def" id="Gale_Shapley1.rk_of_pref.cases|fact"><span class="entity_def" id="Gale_Shapley1.rk_of_pref.termination|fact"><span class="entity_def" id="Gale_Shapley1.rk_of_pref.pinduct|fact"><span class="entity_def" id="Gale_Shapley1.rk_of_pref.psimps|fact"><span class="entity_def" id="Gale_Shapley1.rk_of_pref_rel.inducts|fact"><span class="entity_def" id="Gale_Shapley1.rk_of_pref_rel.simps|fact"><span class="entity_def" id="Gale_Shapley1.rk_of_pref_rel.induct|fact"><span class="entity_def" id="Gale_Shapley1.rk_of_pref_rel.cases|fact"><span class="entity_def" id="Gale_Shapley1.rk_of_pref_rel.intros|fact"><span class="entity_def" id="Gale_Shapley1.rk_of_pref_graph.inducts|fact"><span class="entity_def" id="Gale_Shapley1.rk_of_pref_graph.simps|fact"><span class="entity_def" id="Gale_Shapley1.rk_of_pref_graph.induct|fact"><span class="entity_def" id="Gale_Shapley1.rk_of_pref_graph.cases|fact"><span class="entity_def" id="Gale_Shapley1.rk_of_pref_graph.intros|fact"><span class="entity_def" id="Gale_Shapley1.rk_of_pref.elims|thm"><span class="entity_def" id="Gale_Shapley1.rk_of_pref.induct|thm"><span class="entity_def" id="Gale_Shapley1.rk_of_pref.simps(2)|thm"><span class="entity_def" id="Gale_Shapley1.rk_of_pref.simps(1)|thm"><span class="entity_def" id="Gale_Shapley1.rk_of_pref.pelims|thm"><span class="entity_def" id="Gale_Shapley1.rk_of_pref.cases|thm"><span class="entity_def" id="Gale_Shapley1.rk_of_pref.termination|thm"><span class="entity_def" id="Gale_Shapley1.rk_of_pref.pinduct|thm"><span class="entity_def" id="Gale_Shapley1.rk_of_pref.psimps(2)|thm"><span class="entity_def" id="Gale_Shapley1.rk_of_pref.psimps(1)|thm"><span class="entity_def" id="Gale_Shapley1.rk_of_pref_rel.inducts|thm"><span class="entity_def" id="Gale_Shapley1.rk_of_pref_rel.simps|thm"><span class="entity_def" id="Gale_Shapley1.rk_of_pref_rel.induct|thm"><span class="entity_def" id="Gale_Shapley1.rk_of_pref_rel.cases|thm"><span class="entity_def" id="Gale_Shapley1.rk_of_pref_rel.intros|thm"><span class="entity_def" id="Gale_Shapley1.rk_of_pref_graph.inducts|thm"><span class="entity_def" id="Gale_Shapley1.rk_of_pref_graph.simps|thm"><span class="entity_def" id="Gale_Shapley1.rk_of_pref_graph.induct|thm"><span class="entity_def" id="Gale_Shapley1.rk_of_pref_graph.cases|thm"><span class="entity_def" id="Gale_Shapley1.rk_of_pref_graph.intros(2)|thm"><span class="entity_def" id="Gale_Shapley1.rk_of_pref_graph.intros(1)|thm"><span class="entity_def" id="Gale_Shapley1.rk_of_pref_def|axiom"><span class="entity_def" id="Gale_Shapley1.rk_of_pref_rel_def|axiom"><span class="entity_def" id="Gale_Shapley1.rk_of_pref_sumC_def|axiom"><span class="entity_def" id="Gale_Shapley1.rk_of_pref_graph_def|axiom"><span class="entity_def" id="Gale_Shapley1.rk_of_pref_dom|const"><span class="entity_def" id="Gale_Shapley1.rk_of_pref_rel|const"><span class="entity_def" id="Gale_Shapley1.rk_of_pref_sumC|const"><span class="entity_def" id="Gale_Shapley1.rk_of_pref_graph|const"><span>fun</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="Gale_Shapley1.rk_of_pref|const"><span>rk_of_pref</span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.nat|type"><span>nat</span></a><span> </span><span class="main"><span>â</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.nat|type"><span>nat</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list|type"><span>list</span></a><span> </span><span class="main"><span>â</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.nat|type"><span>nat</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list|type"><span>list</span></a><span> </span><span class="main"><span>â</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.nat|type"><span>nat</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list|type"><span>list</span></a><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
</span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>rk_of_pref</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>r</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>rs</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>n</span></span></span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.Cons|const"><span>#</span></a></span><span class="free"><span class="bound"><span class="entity"><span>ns</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>rk_of_pref</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>r</span></span></span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>)</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>rs</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>ns</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>[</span></span><span class="free"><span class="bound"><span class="entity"><span>n</span></span></span></span><span> </span><span class="main"><span>:=</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>r</span></span></span></span><span class="main"><span>]</span></span><span>"</span></span></span><span> </span><span class="main"><span>|</span></span><span>
</span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>rk_of_pref</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>r</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>rs</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.Nil|const"><span>[]</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>rs</span></span></span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="Gale_Shapley1.ranking_def|fact"><span class="entity_def" id="Gale_Shapley1.ranking_def|thm"><span class="entity_def" id="Gale_Shapley1.ranking_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="Gale_Shapley1.ranking|const"><span>ranking</span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.nat|type"><span>nat</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list|type"><span>list</span></a><span> </span><span class="main"><span>â</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.nat|type"><span>nat</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list|type"><span>list</span></a><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
</span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>ranking</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>P</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.rk_of_pref|const"><span>rk_of_pref</span></a><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/List.html#List.replicate|const"><span>replicate</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/List.html#List.length|const"><span>length</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>P</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>)</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>P</span></span></span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Gale_Shapley1.length_rk_of_pref|fact"><span class="entity_def" id="Gale_Shapley1.length_rk_of_pref|thm"><span>length_rk_of_pref</span></span></span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/List.html#List.length|const"><span>length</span></a><span class="main"><span>(</span></span><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.rk_of_pref|const"><span>rk_of_pref</span></a><span> </span><span class="free"><span>v</span></span><span> </span><span class="free"><span>vs</span></span><span> </span><span class="free"><span>P</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.length|const"><span>length</span></a><span> </span><span class="free"><span>vs</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>by</span></span></span><span class="main"><span>(</span></span><span class="operator"><span>induction</span></span><span> </span><span class="quoted"><span class="free"><span>P</span></span></span><span> </span><span class="quasi_keyword"><span>arbitrary</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><span class="quoted"><span class="free"><span>v</span></span></span><span class="main"><span>)</span></span><span class="main"><span>(</span></span><span class="operator"><span>auto</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Gale_Shapley1.nth_rk_of_pref|fact"><span class="entity_def" id="Gale_Shapley1.nth_rk_of_pref|thm"><span>nth_rk_of_pref</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>â¦</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.length|const"><span>length</span></a><span> </span><span class="free"><span>P</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>â¤</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.length|const"><span>length</span></a><span> </span><span class="free"><span>rs</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>i</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>â</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.set|const"><span>set</span></a><span> </span><span class="free"><span>P</span></span><span class="main"><span>;</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.distinct|const"><span>distinct</span></a><span> </span><span class="free"><span>P</span></span><span class="main"><span>;</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.set|const"><span>set</span></a><span> </span><span class="free"><span>P</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>â</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><a class="entity_ref" href="../../HOL/HOL/List.html#List.length|const"><span>length</span></a><span> </span><span class="free"><span>rs</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><span>â§</span></span><span>
 </span><span class="main"><span>â¹</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.rk_of_pref|const"><span>rk_of_pref</span></a><span> </span><span class="free"><span>r</span></span><span> </span><span class="free"><span>rs</span></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="free"><span>i</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../List-Index/List_Index.html#List_Index.index|const"><span>index</span></a><span> </span><span class="free"><span>P</span></span><span> </span><span class="free"><span>i</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><span class="free"><span>r</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>by</span></span></span><span class="main"><span>(</span></span><span class="operator"><span>induction</span></span><span> </span><span class="quoted"><span class="free"><span>P</span></span></span><span> </span><span class="quasi_keyword"><span>arbitrary</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><span class="quoted"><span class="free"><span>r</span></span></span><span> </span><span class="quoted"><span class="free"><span>i</span></span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>auto</span></span><span> </span><span class="quasi_keyword"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth_list_update|fact"><span>nth_list_update</span></a><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Gale_Shapley1.ranking_iff_pref|fact"><span class="entity_def" id="Gale_Shapley1.ranking_iff_pref|thm"><span>ranking_iff_pref</span></span></span><span class="main"><span>:</span></span><span>  </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>â¦</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.set|const"><span>set</span></a><span> </span><span class="free"><span>P</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><a class="entity_ref" href="../../HOL/HOL/List.html#List.length|const"><span>length</span></a><span> </span><span class="free"><span>P</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>i</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.length|const"><span>length</span></a><span> </span><span class="free"><span>P</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>j</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.length|const"><span>length</span></a><span> </span><span class="free"><span>P</span></span><span> </span><span class="main"><span>â§</span></span><span>
 </span><span class="main"><span>â¹</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.ranking|const"><span>ranking</span></a><span> </span><span class="free"><span>P</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="free"><span>i</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.ranking|const"><span>ranking</span></a><span> </span><span class="free"><span>P</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="free"><span>j</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.iff|const"><span>â·</span></a></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.prefa|const"><span>â¢</span></a></span><span> </span><span class="free"><span>i</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.prefa|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>j</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>by</span></span></span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.ranking_def|fact"><span>ranking_def</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.prefers_def|fact"><span>prefers_def</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.nth_rk_of_pref|fact"><span>nth_rk_of_pref</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.card_distinct|fact"><span>card_distinct</span></a><span class="main"><span>)</span></span><span>


</span><span class="keyword1"><span class="command"><span>subsection</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>â¹</span><span>Fixing the preference lists</span><span>âº</span></span></span><span>
 
</span><span class="keyword1"><span class="command"><span>type_synonym</span></span></span><span> </span><span class="entity_def" id="Gale_Shapley1.prefs|type"><span>prefs</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.nat|type"><span>nat</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list|type"><span>list</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list|type"><span>list</span></a><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="Gale_Shapley1.Pref.n_def|fact"><span class="entity_def" id="Gale_Shapley1.Pref.intro|fact"><span class="entity_def" id="Gale_Shapley1.Pref_def|fact"><span class="entity_def" id="Gale_Shapley1.Pref.n_def|thm"><span class="entity_def" id="Gale_Shapley1.Pref.intro|thm"><span class="entity_def" id="Gale_Shapley1.Pref_def|thm"><span class="entity_def" id="Gale_Shapley1.Pref_def|axiom"><span class="entity_def" id="offset_2212..2218">locale</span></span></span></span></span></span></span></span></span></span><span> </span><span class="entity_def" id="Gale_Shapley1.Pref|locale"><span class="entity_def" id="Gale_Shapley1.Pref|const"><span>Pref</span></span></span><span> </span><span class="main"><span>=</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>n</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>P<span class="hidden">â©</span><sub>a</sub></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.prefs|type"><span>prefs</span></a></span><span>
</span><span class="keyword2"><span class="keyword"><span>fixes</span></span></span><span> </span><span class="free"><span>P<span class="hidden">â©</span><sub>b</sub></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.prefs|type"><span>prefs</span></a></span><span>
</span><span class="keyword2"><span class="keyword"><span>defines</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>n</span></span><span> </span><span class="main"><span>â¡</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.length|const"><span>length</span></a><span> </span><span class="free"><span>P<span class="hidden">â©</span><sub>a</sub></span></span><span>"</span></span></span><span>
</span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="Gale_Shapley1.Pref.length_P\&lt;^sub&gt;b|fact"><span class="entity_def" id="Gale_Shapley1.Pref.length_P\&lt;^sub&gt;b|thm"><span class="entity_def" id="offset_2305..2315">length_P<span class="hidden">â©</span><sub>b</sub></span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/List.html#List.length|const"><span>length</span></a><span> </span><span class="free"><span>P<span class="hidden">â©</span><sub>b</sub></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>n</span></span><span>"</span></span></span><span>
</span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="Gale_Shapley1.Pref.P\&lt;^sub&gt;a_set|fact"><span class="entity_def" id="Gale_Shapley1.Pref.P\&lt;^sub&gt;a_set|thm"><span class="entity_def" id="offset_2342..2349">P<span class="hidden">â©</span><sub>a</sub>_set</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>n</span></span><span>  </span><span class="main"><span>â¹</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.length|const"><span>length</span></a><span class="main"><span>(</span></span><span class="free"><span>P<span class="hidden">â©</span><sub>a</sub></span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span class="free"><span>a</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.set|const"><span>set</span></a><span class="main"><span>(</span></span><span class="free"><span>P<span class="hidden">â©</span><sub>a</sub></span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span class="free"><span>a</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span>"</span></span></span><span>
</span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="Gale_Shapley1.Pref.P\&lt;^sub&gt;b_set|fact"><span class="entity_def" id="Gale_Shapley1.Pref.P\&lt;^sub&gt;b_set|thm"><span class="entity_def" id="offset_2408..2415">P<span class="hidden">â©</span><sub>b</sub>_set</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>b</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><span>â¹</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.length|const"><span>length</span></a><span class="main"><span>(</span></span><span class="free"><span>P<span class="hidden">â©</span><sub>b</sub></span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span class="free"><span>b</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.set|const"><span>set</span></a><span class="main"><span>(</span></span><span class="free"><span>P<span class="hidden">â©</span><sub>b</sub></span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span class="free"><span>b</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span>"</span></span></span><span>
</span><span class="keyword2"><span class="keyword"><span>begin</span></span></span><span>


</span><span class="keyword1"><span class="command"><span>abbreviation</span></span></span><span> </span><span class="entity"><span class="entity_def" id="Gale_Shapley1.Pref.wf|const"><span class="entity_def" id="offset_2486..2488">wf</span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.nat|type"><span>nat</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list|type"><span>list</span></a><span> </span><span class="main"><span>â</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.bool|type"><span>bool</span></a><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
</span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>wf</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>xs</span></span></span></span><span> </span><span class="main"><span>â¡</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.length|const"><span>length</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>xs</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.set|const"><span>set</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>xs</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>â</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Gale_Shapley1.Pref.wf_less_n|fact"><span class="entity_def" id="Gale_Shapley1.Pref.wf_less_n|thm"><span class="entity_def" id="offset_2563..2572">wf_less_n</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>â¦</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_2486..2488"><span>wf</span></a><span> </span><span class="free"><span>A</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><span>â§</span></span><span> </span><span class="main"><span>â¹</span></span><span> </span><span class="free"><span>A</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span class="free"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>n</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|fact"><span>subset_eq</span></a><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>corollary</span></span></span><span> </span><span class="entity_def" id="Gale_Shapley1.Pref.wf_le_n1|fact"><span class="entity_def" id="Gale_Shapley1.Pref.wf_le_n1|thm"><span class="entity_def" id="offset_2638..2646">wf_le_n1</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>â¦</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_2486..2488"><span>wf</span></a><span> </span><span class="free"><span>A</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><span>â§</span></span><span> </span><span class="main"><span>â¹</span></span><span> </span><span class="free"><span>A</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span class="free"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>â¤</span></a></span><span> </span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_2563..2572"><span>wf_less_n</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>fastforce</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Gale_Shapley1.Pref.sumA_ub|fact"><span class="entity_def" id="Gale_Shapley1.Pref.sumA_ub|thm"><span class="entity_def" id="offset_2714..2721">sumA_ub</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_2486..2488"><span>wf</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="main"><span>â¹</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>â</span></span><span class="bound"><span>a</span></span><span class="main"><span>&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>A</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span class="bound"><span>a</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>â¤</span></a></span><span> </span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.times_class.times|const"><span>*</span></a></span><span class="main"><span>(</span></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Groups_Big.html#Groups_Big.sum_bounded_above|fact"><span>sum_bounded_above</span></a><span class="main"><span>[</span></span><span class="operator"><span>of</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set_Interval.html#Set_Interval.ord_class.lessThan|const"><span>{..&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set_Interval.html#Set_Interval.ord_class.lessThan|const"><span>}</span></a></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>(!)</span></a></span><span> </span><span class="free"><span>A</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span>"</span></span></span><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_2638..2646"><span>wf_le_n1</span></a><span class="main"><span>[</span></span><span class="operator"><span>of</span></span><span> </span><span class="quoted"><span class="free"><span>A</span></span></span><span class="main"><span>]</span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span class="main"><span>)</span></span><span>


</span><span class="keyword1"><span class="command"><span>subsubsection</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>â¹</span><span>The (termination) variant(s)</span><span>âº</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>â¹</span><span>Basic idea: either some </span><span class="antiquoted"><span class="raw_text"><span class="operator"><span>â¹</span></span><span>A!aâº</span></span></span><span> is incremented or size of </span><span class="antiquoted"><span class="raw_text"><span class="operator"><span>â¹</span></span><span>Mâº</span></span></span><span> is incremented, but this cannot
</span><span>go on forever because in the worst case all </span><span class="antiquoted"><span class="raw_text"><span class="operator"><span>â¹</span></span><span>A!a = n-1âº</span></span></span><span> and </span><span class="antiquoted"><span class="raw_text"><span class="operator"><span>â¹</span></span><span>M = nâº</span></span></span><span>. Because </span><span class="antiquoted"><span class="raw_text"><span class="operator"><span>â¹</span></span><span>n*(n-1) + n = n^2âº</span></span></span><span>,
</span><span>this leads to the following simple variant:</span><span>âº</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="Gale_Shapley1.Pref.var0_def|fact"><span class="entity_def" id="Gale_Shapley1.Pref.var0_def|thm"><span class="entity_def" id="Gale_Shapley1.Pref.var0_def_raw|axiom"><span class="entity_def" id="offset_3122..3132">definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="Gale_Shapley1.Pref.var0.cong|fact"><span class="entity_def" id="Gale_Shapley1.Pref.var0.cong|thm"><span class="entity_def" id="Gale_Shapley1.Pref.var0|const"><span class="entity_def" id="offset_3133..3137">var0</span></span></span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.nat|type"><span>nat</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list|type"><span>list</span></a><span> </span><span class="main"><span>â</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.nat|type"><span>nat</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.set|type"><span>set</span></a><span> </span><span class="main"><span>â</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.nat|type"><span>nat</span></a><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
</span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>var0</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>A</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>M</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Power.html#Power.power_class.power|const"><span>^</span></a></span><span class="numeral"><span>2</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>â</span></span><span class="bound"><span>a</span></span><span class="main"><span>&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>A</span></span></span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span class="bound"><span>a</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Finite_Set.html#Finite_Set.card|const"><span>card</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>M</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_3227..3232">lemma</span></span></span><span> </span><span class="entity_def" id="Gale_Shapley1.Pref.var0_match|fact"><span class="entity_def" id="Gale_Shapley1.Pref.var0_match|thm"><span class="entity_def" id="offset_3233..3243">var0_match</span></span></span><span class="main"><span>:</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_2486..2488"><span>wf</span></a><span> </span><span class="free"><span>A</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>â</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><span class="free"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.not_member|const"><span>â</span></a></span><span> </span><span class="free"><span>M</span></span><span>"</span></span></span><span>
</span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_3133..3137"><span>var0</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.union|const"><span>âª</span></a></span><span> </span><span class="main"><span>{</span></span><span class="free"><span>a</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_3133..3137"><span>var0</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="free"><span>M</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_3338..3339">2</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset|const"><span>â</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_3227..3232"><span>assms</span></a><span class="main"><span>(</span></span><span>2-3</span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>auto</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span>3</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Finite_Set.html#Finite_Set.card|const"><span>card</span></a><span> </span><span class="free"><span>M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>n</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Finite_Set.html#Finite_Set.psubset_card_mono|fact"><span>psubset_card_mono</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> _ </span><a class="entity_ref" href="Gale_Shapley1.html#offset_3338..3339"><span>2</span></a><span class="main"><span>]</span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
  </span><span class="keyword1"><span class="command"><span>then</span></span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_2714..2721"><span>sumA_ub</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_3227..3232"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>1</span><span class="main"><span class="main"><span>)</span></span></span><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_3227..3232"><span>assms</span></a><span class="main"><span>(</span></span><span>3</span><span class="main"><span>)</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Finite_Set.html#Finite_Set.finite_subset|fact"><span>finite_subset</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_3227..3232"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>2</span><span class="main"><span class="main"><span>)</span></span></span><span class="main"><span>]</span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Power.html#Power.monoid_mult_class.power2_eq_square|fact"><span>power2_eq_square</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.algebra_simps|fact"><span class="dynamic"><span class="dynamic"><span>algebra_simps</span></span></span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.le_diff_conv2|fact"><span>le_diff_conv2</span></a><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_3596..3601">lemma</span></span></span><span> </span><span class="entity_def" id="Gale_Shapley1.Pref.var0_next|fact"><span class="entity_def" id="Gale_Shapley1.Pref.var0_next|thm"><span class="entity_def" id="offset_3602..3611">var0_next</span></span></span><span class="main"><span>:</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_2486..2488"><span>wf</span></a><span> </span><span class="free"><span>A</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>â</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>â </span></a></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>a'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>n</span></span><span>"</span></span></span><span>
</span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_3133..3137"><span>var0</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>A</span></span><span class="main"><span>[</span></span><span class="free"><span>a'</span></span><span> </span><span class="main"><span>:=</span></span><span> </span><span class="free"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="free"><span>a'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_3133..3137"><span>var0</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="free"><span>M</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_3722..3723">0</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Finite_Set.html#Finite_Set.card|const"><span>card</span></a><span> </span><span class="free"><span>M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>n</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_3596..3601"><span>assms</span></a><span class="main"><span>(</span></span><span>2</span><span class="main"><span>,</span></span><span>3</span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set_Interval.html#Set_Interval.atLeast0LessThan|fact"><span>atLeast0LessThan</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Set_Interval.html#Set_Interval.card_lessThan|fact"><span>card_lessThan</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Finite_Set.html#Finite_Set.card_subset_eq|fact"><span>card_subset_eq</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Set_Interval.html#Set_Interval.finite_lessThan|fact"><span>finite_lessThan</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Set_Interval.html#Set_Interval.ord_class.lessThan_iff|fact"><span>lessThan_iff</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.nat_less_le|fact"><span>nat_less_le</span></a><span>
              </span><a class="entity_ref" href="../../HOL/HOL/Set_Interval.html#Set_Interval.subset_eq_atLeast0_lessThan_card|fact"><span>subset_eq_atLeast0_lessThan_card</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_3911..3912">*</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>â</span></span><span class="bound"><span>a</span></span><span class="main"><span>&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>A</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span class="bound"><span>a</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Finite_Set.html#Finite_Set.card|const"><span>card</span></a><span> </span><span class="free"><span>M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>â¤</span></a></span><span> </span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.times_class.times|const"><span>*</span></a></span><span class="free"><span>n</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_2714..2721"><span>sumA_ub</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_3596..3601"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>1</span><span class="main"><span class="main"><span>)</span></span></span><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_3722..3723"><span>0</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.algebra_simps|fact"><span class="dynamic"><span class="dynamic"><span>algebra_simps</span></span></span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.le_diff_conv2|fact"><span>le_diff_conv2</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_3133..3137"><span>var0</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>A</span></span><span class="main"><span>[</span></span><span class="free"><span>a'</span></span><span> </span><span class="main"><span>:=</span></span><span> </span><span class="free"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="free"><span>a'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.times_class.times|const"><span>*</span></a></span><span class="free"><span>n</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="free"><span>a'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Groups_Big.html#Groups_Big.comm_monoid_add_class.sum|const"><span>sum</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>(!)</span></a></span><span> </span><span class="free"><span>A</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="main"><span>{</span></span><span class="free"><span>a'</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Finite_Set.html#Finite_Set.card|const"><span>card</span></a><span> </span><span class="free"><span>M</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_3596..3601"><span>assms</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Power.html#Power.monoid_mult_class.power2_eq_square|fact"><span>power2_eq_square</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth_list_update|fact"><span>nth_list_update</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Groups_Big.html#Groups_Big.comm_monoid_add_class.sum.If_cases|fact"><span>sum.If_cases</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Set_Interval.html#Set_Interval.lessThan_atLeast0|fact"><span>lessThan_atLeast0</span></a><span> </span><span class="quasi_keyword"><span>flip</span></span><span class="main"><span class="main"><span>:</span></span></span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.Diff_eq|fact"><span>Diff_eq</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>also</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>â¦</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Power.html#Power.power_class.power|const"><span>^</span></a></span><span class="numeral"><span>2</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>â</span></span><span class="bound"><span>a</span></span><span class="main"><span>&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>A</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span class="bound"><span>a</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Finite_Set.html#Finite_Set.card|const"><span>card</span></a><span> </span><span class="free"><span>M</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Groups_Big.html#Groups_Big.comm_monoid_add_class.sum.insert_remove|fact"><span>sum.insert_remove</span></a><span class="main"><span>[</span></span><span class="operator"><span>of</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>nth</span></a><span> </span><span class="free"><span>A</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="free"><span>a'</span></span></span><span class="main"><span>,</span></span><span class="operator"><span>simplified</span></span><span class="main"><span>,</span></span><span class="operator"><span>symmetric</span></span><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_3596..3601"><span>assms</span></a><span class="main"><span>(</span></span><span>4</span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.insert_absorb|fact"><span>insert_absorb</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Set_Interval.html#Set_Interval.lessThan_atLeast0|fact"><span>lessThan_atLeast0</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Power.html#Power.monoid_mult_class.power2_eq_square|fact"><span>power2_eq_square</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>also</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>â¦</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Power.html#Power.power_class.power|const"><span>^</span></a></span><span class="numeral"><span>2</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>â</span></span><span class="bound"><span>a</span></span><span class="main"><span>&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>A</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span class="bound"><span>a</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Finite_Set.html#Finite_Set.card|const"><span>card</span></a><span> </span><span class="free"><span>M</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Power.html#Power.monoid_mult_class.power2_eq_square|fact"><span>power2_eq_square</span></a><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_3911..3912"><span>*</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>linarith</span></span><span>
  </span><span class="keyword1"><span class="command"><span>finally</span></span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_3122..3132"><span>var0_def</span></a><span> </span><span class="keyword1"><span class="command"><span>.</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="Gale_Shapley1.Pref.var_def|fact"><span class="entity_def" id="Gale_Shapley1.Pref.var_def|thm"><span class="entity_def" id="Gale_Shapley1.Pref.var_def_raw|axiom"><span class="entity_def" id="offset_4569..4579">definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="Gale_Shapley1.Pref.var.cong|fact"><span class="entity_def" id="Gale_Shapley1.Pref.var.cong|thm"><span class="entity_def" id="Gale_Shapley1.Pref.var|const"><span class="entity_def" id="offset_4580..4583">var</span></span></span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.nat|type"><span>nat</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list|type"><span>list</span></a><span> </span><span class="main"><span>â</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.nat|type"><span>nat</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.set|type"><span>set</span></a><span> </span><span class="main"><span>â</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.nat|type"><span>nat</span></a><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
</span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>var</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>A</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>M</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Power.html#Power.power_class.power|const"><span>^</span></a></span><span class="numeral"><span>2</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>â</span></span><span class="bound"><span>a</span></span><span class="main"><span>&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>A</span></span></span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span class="bound"><span>a</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Finite_Set.html#Finite_Set.card|const"><span>card</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>M</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_4680..4685">lemma</span></span></span><span> </span><span class="entity_def" id="Gale_Shapley1.Pref.sumA_ub2|fact"><span class="entity_def" id="Gale_Shapley1.Pref.sumA_ub2|thm"><span class="entity_def" id="offset_4686..4694">sumA_ub2</span></span></span><span class="main"><span>:</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>a'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>n</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>A</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span class="free"><span>a'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>â¤</span></a></span><span> </span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>â</span></span><span class="bound"><span class="bound"><span>a</span></span></span><span> </span><span class="main"><span>&lt;</span></span><span> </span><span class="free"><span>n</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>â </span></a></span><span> </span><span class="free"><span>a'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>â¶</span></a></span><span> </span><span class="free"><span>A</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span class="bound"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>â¤</span></a></span><span> </span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="numeral"><span>2</span></span><span>"</span></span></span><span>
</span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="main"><span>â</span></span><span class="bound"><span>a</span></span><span class="main"><span>&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>A</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span class="bound"><span>a</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>â¤</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.times_class.times|const"><span>*</span></a></span><span class="main"><span>(</span></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="main"><span>â</span></span><span class="bound"><span>a</span></span><span class="main"><span>&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>A</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span class="bound"><span>a</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>â</span></span><span class="bound"><span>a</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="main"><span>{</span></span><span class="free"><span>a'</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.union|const"><span>âª</span></a></span><span> </span><span class="main"><span>{</span></span><span class="free"><span>a'</span></span><span class="main"><span>}</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>A</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span class="bound"><span>a</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_4680..4685"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>1</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set_Interval.html#Set_Interval.atLeast0LessThan|fact"><span>atLeast0LessThan</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.insert_absorb|fact"><span>insert_absorb</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>also</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>â¦</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span class="main"><span>(</span></span><span class="main"><span>â</span></span><span class="bound"><span>a</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="main"><span>{</span></span><span class="free"><span>a'</span></span><span class="main"><span>}</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>A</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span class="bound"><span>a</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><span class="free"><span>A</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span class="free"><span>a'</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Groups_Big.html#Groups_Big.comm_monoid_add_class.sum.insert_remove|fact"><span>sum.insert_remove</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>also</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>â¦</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>â¤</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>â</span></span><span class="bound"><span>a</span></span><span> </span><span class="main"><span>â</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="main"><span>{</span></span><span class="free"><span>a'</span></span><span class="main"><span>}</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>A</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span class="bound"><span>a</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>)</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_4680..4685"><span>assms</span></a><span class="main"><span>(</span></span><span>2</span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>linarith</span></span><span>
  </span><span class="keyword1"><span class="command"><span>also</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>â¦</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>â¤</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.times_class.times|const"><span>*</span></a></span><span class="main"><span>(</span></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="numeral"><span>2</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Groups_Big.html#Groups_Big.sum_bounded_above|fact"><span>sum_bounded_above</span></a><span class="main"><span>[</span></span><span class="operator"><span>of</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set_Interval.html#Set_Interval.ord_class.lessThan|const"><span>{..&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set_Interval.html#Set_Interval.ord_class.lessThan|const"><span>}</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="main"><span>{</span></span><span class="free"><span>a'</span></span><span class="main"><span>}</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>(!)</span></a></span><span> </span><span class="free"><span>A</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="numeral"><span>2</span></span><span>"</span></span></span><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_4680..4685"><span>assms</span></a><span class="main"><span>(</span></span><span>1</span><span class="main"><span>,</span></span><span>3</span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set_Interval.html#Set_Interval.atLeast0LessThan|fact"><span>atLeast0LessThan</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>also</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>â¦</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.times_class.times|const"><span>*</span></a></span><span class="main"><span>(</span></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.Suc_diff_Suc|fact"><span>Suc_diff_Suc</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.Suc_eq_plus1|fact"><span>Suc_eq_plus1</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.ab_semigroup_add_class.add.commute|fact"><span>add.commute</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.diff_is_0_eq&apos;|fact"><span>diff_is_0_eq'</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.linorder_not_le|fact"><span>linorder_not_le</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.mult_Suc_right|fact"><span>mult_Suc_right</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Rings.html#Rings.semiring_no_zero_divisors_cancel_class.mult_cancel_left|fact"><span>mult_cancel_left</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Num.html#Num.nat_1_add_1|fact"><span>nat_1_add_1</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>finally</span></span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>.</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="Gale_Shapley1.Pref.match_def|fact"><span class="entity_def" id="Gale_Shapley1.Pref.match_def|thm"><span class="entity_def" id="Gale_Shapley1.Pref.match_def_raw|axiom"><span class="entity_def" id="offset_5402..5412">definition</span></span></span></span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="Gale_Shapley1.Pref.match.cong|fact"><span class="entity_def" id="Gale_Shapley1.Pref.match.cong|thm"><span class="entity_def" id="Gale_Shapley1.Pref.match|const"><span class="entity_def" id="offset_5414..5419">match</span></span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>A</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>a</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>P<span class="hidden">â©</span><sub>a</sub></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>a</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>A</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>a</span></span></span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Gale_Shapley1.Pref.match_less_n|fact"><span class="entity_def" id="Gale_Shapley1.Pref.match_less_n|thm"><span class="entity_def" id="offset_5452..5464">match_less_n</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>â¦</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_2486..2488"><span>wf</span></a><span> </span><span class="free"><span>A</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><span>â§</span></span><span> </span><span class="main"><span>â¹</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="free"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>n</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_2342..2349"><span>P<span class="hidden">â©</span><sub>a</sub>_set</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Set_Interval.html#Set_Interval.ord_class.atLeastLessThan_iff|fact"><span>atLeastLessThan_iff</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5402..5412"><span>match_def</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth_mem|fact"><span>nth_mem</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|fact"><span>subset_eq</span></a><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Gale_Shapley1.Pref.match_upd_neq|fact"><span class="entity_def" id="Gale_Shapley1.Pref.match_upd_neq|thm"><span class="entity_def" id="offset_5574..5587">match_upd_neq</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>â¦</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_2486..2488"><span>wf</span></a><span> </span><span class="free"><span>A</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>n</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>â </span></a></span><span> </span><span class="free"><span>a'</span></span><span> </span><span class="main"><span>â§</span></span><span> </span><span class="main"><span>â¹</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>A</span></span><span class="main"><span>[</span></span><span class="free"><span>a</span></span><span> </span><span class="main"><span>:=</span></span><span> </span><span class="free"><span>b</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>a'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="free"><span>a'</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5402..5412"><span>match_def</span></a><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="Gale_Shapley1.Pref.blocks_def|fact"><span class="entity_def" id="Gale_Shapley1.Pref.blocks_def|thm"><span class="entity_def" id="Gale_Shapley1.Pref.blocks_def_raw|axiom"><span class="entity_def" id="offset_5677..5687">definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="Gale_Shapley1.Pref.blocks.cong|fact"><span class="entity_def" id="Gale_Shapley1.Pref.blocks.cong|thm"><span class="entity_def" id="Gale_Shapley1.Pref.blocks|const"><span class="entity_def" id="offset_5688..5694">blocks</span></span></span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.nat|type"><span>nat</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list|type"><span>list</span></a><span> </span><span class="main"><span>â</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.nat|type"><span>nat</span></a><span> </span><span class="main"><span>â</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.nat|type"><span>nat</span></a><span> </span><span class="main"><span>â</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.bool|type"><span>bool</span></a><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
</span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>blocks</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>A</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>a</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>a'</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>P<span class="hidden">â©</span><sub>a</sub></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>a</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.prefa|const"><span>â¢</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>A</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>a'</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.prefa|const"><span>&lt;</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>A</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>a</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><span class="free"><span>P<span class="hidden">â©</span><sub>b</sub></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>A</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>a'</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.prefa|const"><span>â¢</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>a</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.prefa|const"><span>&lt;</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>a'</span></span></span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="Gale_Shapley1.Pref.stable_def|fact"><span class="entity_def" id="Gale_Shapley1.Pref.stable_def|thm"><span class="entity_def" id="Gale_Shapley1.Pref.stable_def_raw|axiom"><span class="entity_def" id="offset_5816..5826">definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="Gale_Shapley1.Pref.stable.cong|fact"><span class="entity_def" id="Gale_Shapley1.Pref.stable.cong|thm"><span class="entity_def" id="Gale_Shapley1.Pref.stable|const"><span class="entity_def" id="offset_5827..5833">stable</span></span></span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.nat|type"><span>nat</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list|type"><span>list</span></a><span> </span><span class="main"><span>â</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.nat|type"><span>nat</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.set|type"><span>set</span></a><span> </span><span class="main"><span>â</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.bool|type"><span>bool</span></a><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
</span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>stable</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>A</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>M</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>Â¬</span></a></span><span class="main"><span>(</span></span><span class="main"><span>â</span></span><span class="bound"><span>a</span></span><span class="main"><span>â</span></span><span class="free"><span class="bound"><span class="entity"><span>M</span></span></span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>â</span></span><span class="bound"><span>a'</span></span><span class="main"><span>â</span></span><span class="free"><span class="bound"><span class="entity"><span>M</span></span></span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>â </span></a></span><span> </span><span class="bound"><span>a'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5688..5694"><span>blocks</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>A</span></span></span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="bound"><span>a'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>â¹</span><span>The set of Bs that an A would prefer to its current match,
</span><span>i.e. all Bs above its current match </span><span class="antiquoted"><span class="raw_text"><span class="operator"><span>â¹</span></span><span>A!aâº</span></span></span><span>.</span><span>âº</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>abbreviation</span></span></span><span> </span><span class="entity"><span class="entity_def" id="Gale_Shapley1.Pref.preferred|const"><span class="entity_def" id="offset_6050..6059">preferred</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
</span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>preferred</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>A</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>a</span></span></span></span><span> </span><span class="main"><span>==</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>nth</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>P<span class="hidden">â©</span><sub>a</sub></span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span class="free"><span class="bound"><span class="entity"><span>a</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span class="bound"><span class="entity"><span>A</span></span></span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span class="free"><span class="bound"><span class="entity"><span>a</span></span></span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="Gale_Shapley1.Pref.matching_def|fact"><span class="entity_def" id="Gale_Shapley1.Pref.matching_def|thm"><span class="entity_def" id="Gale_Shapley1.Pref.matching_def_raw|axiom"><span class="entity_def" id="offset_6107..6117">definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="Gale_Shapley1.Pref.matching.cong|fact"><span class="entity_def" id="Gale_Shapley1.Pref.matching.cong|thm"><span class="entity_def" id="Gale_Shapley1.Pref.matching|const"><span class="entity_def" id="offset_6118..6126">matching</span></span></span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span>
</span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>matching</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>A</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>M</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Gale_Shapley1.html#offset_2486..2488"><span>wf</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>A</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.inj_on|const"><span>inj_on</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>A</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>M</span></span></span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>


</span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>â¹</span><span>If </span><span class="antiquoted"><span class="raw_text"><span class="operator"><span>â¹</span></span><span>a'âº</span></span></span><span> is unmatched and final then all other </span><span class="antiquoted"><span class="raw_text"><span class="operator"><span>â¹</span></span><span>aâº</span></span></span><span> are matched:</span><span>âº</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Gale_Shapley1.Pref.final_last|fact"><span class="entity_def" id="Gale_Shapley1.Pref.final_last|thm"><span class="entity_def" id="offset_6265..6275">final_last</span></span></span><span class="main"><span>:</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_6285..6286">M</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>â</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span>inj</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.inj_on|const"><span>inj_on</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="free"><span>A</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>M</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity_def" id="offset_6333..6344">pref_match'</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_6050..6059"><span>preferred</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="free"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>â</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span> </span><span class="free"><span>M</span></span><span>"</span></span></span><span>
</span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity_def" id="offset_6380..6381">a</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><span class="free"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.not_member|const"><span>â</span></a></span><span> </span><span class="free"><span>M</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity_def" id="offset_6403..6408">final</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="free"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>n</span></span><span>"</span></span></span><span>
</span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.insert|const"><span>insert</span></a><span> </span><span class="free"><span>a</span></span><span> </span><span class="free"><span>M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>
  </span><span class="keyword1"><span class="command"><span>let</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?B</span></span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_6050..6059"><span>preferred</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="free"><span>a</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>(!)</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>P<span class="hidden">â©</span><sub>a</sub></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="free"><span>a</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_2342..2349"><span>P<span class="hidden">â©</span><sub>a</sub>_set</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_6380..6381"><span>a</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.map_nth|fact"><span>map_nth</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.set_map|fact"><span>set_map</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.set_upt|fact"><span>set_upt</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>hence</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.inj_on|const"><span>inj_on</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>(!)</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>P<span class="hidden">â©</span><sub>a</sub></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="free"><span>a</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Finite_Set.html#Finite_Set.eq_card_imp_inj_on|fact"><span>eq_card_imp_inj_on</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>hence</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.inj_on|const"><span>inj_on</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>(!)</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>P<span class="hidden">â©</span><sub>a</sub></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="free"><span>a</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>A</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span class="free"><span>a</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_6403..6408"><span>final</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.subset_inj_on|fact"><span>subset_inj_on</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>hence</span></span></span><span> </span><span class="entity_def" id="offset_6728..6729">1</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.Suc|const"><span>Suc</span></a><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/Finite_Set.html#Finite_Set.card|const"><span>card</span></a><span> </span><span class="var"><span>?B</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>n</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_2342..2349"><span>P<span class="hidden">â©</span><sub>a</sub>_set</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_6380..6381"><span>a</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_6403..6408"><span>final</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Finite_Set.html#Finite_Set.card_image|fact"><span>card_image</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_6805..6806">2</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Finite_Set.html#Finite_Set.card|const"><span>card</span></a><span> </span><span class="var"><span>?B</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>â¤</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Finite_Set.html#Finite_Set.card|const"><span>card</span></a><span> </span><span class="free"><span>M</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span class="main"><span>(</span></span><span class="operator"><span>rule</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Finite_Set.html#Finite_Set.surj_card_le|fact"><span>surj_card_le</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set_Interval.html#Set_Interval.subset_eq_atLeast0_lessThan_finite|fact"><span>subset_eq_atLeast0_lessThan_finite</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_6285..6286"><span>M</span></a><span class="main"><span class="main"><span>]</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_6333..6344"><span>pref_match'</span></a><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_6917..6918">3</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Finite_Set.html#Finite_Set.card|const"><span>card</span></a><span> </span><span class="free"><span>M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>n</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_6285..6286"><span>M</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_6380..6381"><span>a</span></a><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set_Interval.html#Set_Interval.atLeast0LessThan|fact"><span>atLeast0LessThan</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Finite_Set.html#Finite_Set.card_seteq|fact"><span>card_seteq</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.preorder_class.order.refl|fact"><span>order.refl</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Set_Interval.html#Set_Interval.finite_atLeastLessThan|fact"><span>finite_atLeastLessThan</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.le_neq_implies_less|fact"><span>le_neq_implies_less</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Set_Interval.html#Set_Interval.ord_class.lessThan_iff|fact"><span>lessThan_iff</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Set_Interval.html#Set_Interval.subset_eq_atLeast0_lessThan_card|fact"><span>subset_eq_atLeast0_lessThan_card</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.Suc|const"><span>Suc</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/Finite_Set.html#Finite_Set.card|const"><span>card</span></a><span> </span><span class="free"><span>M</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>n</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_6728..6729"><span>1</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_6805..6806"><span>2</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_6917..6918"><span>3</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
  </span><span class="keyword3"><span class="command"><span>thus</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_6285..6286"><span>M</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_6380..6381"><span>a</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Finite_Set.html#Finite_Set.card_subset_eq|fact"><span>card_subset_eq</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Finite_Set.html#Finite_Set.finite_subset|fact"><span>finite_subset</span></a><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Gale_Shapley1.Pref.more_choices|fact"><span class="entity_def" id="Gale_Shapley1.Pref.more_choices|thm"><span class="entity_def" id="offset_7212..7224">more_choices</span></span></span><span class="main"><span>:</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_7234..7235">A</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_6118..6126"><span>matching</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="free"><span>M</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity_def" id="offset_7256..7257">M</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>â</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>â </span></a></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span>"</span></span></span><span>
</span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity_def" id="offset_7285..7296">pref_match'</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_6050..6059"><span>preferred</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="free"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>â</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span> </span><span class="free"><span>M</span></span><span>"</span></span></span><span>
</span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>n</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity_def" id="offset_7344..7351">matched</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="free"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>â</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span> </span><span class="free"><span>M</span></span><span>"</span></span></span><span>
</span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="free"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>n</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>rule</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.ccontr|fact"><span>ccontr</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_7428..7433">match</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span> </span><span class="free"><span>M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>â</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_7234..7235"><span>A</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_7256..7257"><span>M</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_2342..2349"><span>P<span class="hidden">â©</span><sub>a</sub>_set</span></a><span> </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_6107..6117"><span>matching_def</span></a><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>smt</span></span><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>verit</span><span class="main"><span class="main"><span>,</span></span></span><span> best</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set_Interval.html#Set_Interval.ord_class.atLeastLessThan_iff|fact"><span>atLeastLessThan_iff</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5402..5412"><span>match_def</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image_subsetI|fact"><span>image_subsetI</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.in_mono|fact"><span>in_mono</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth_mem|fact"><span>nth_mem</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Finite_Set.html#Finite_Set.card|const"><span>card</span></a><span> </span><span class="free"><span>M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>n</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_7256..7257"><span>M</span></a><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set_Interval.html#Set_Interval.card_atLeastLessThan|fact"><span>card_atLeastLessThan</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Finite_Set.html#Finite_Set.card_seteq|fact"><span>card_seteq</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.cancel_comm_monoid_add_class.diff_zero|fact"><span>diff_zero</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Set_Interval.html#Set_Interval.finite_atLeastLessThan|fact"><span>finite_atLeastLessThan</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.linorder_class.not_less|fact"><span>not_less</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>assume</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>Â¬</span></a></span><span> </span><span class="free"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="free"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>n</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>hence</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="free"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>n</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_7234..7235"><span>A</span></a><span> </span><span class="quoted"><span class="quoted"><span>â¹</span><span class="free"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>n</span></span><span>âº</span></span></span><span> </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_6107..6117"><span>matching_def</span></a><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.ab_semigroup_add_class.add.commute|fact"><span>add.commute</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_2563..2572"><span>wf_less_n</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.linorder_neqE_nat|fact"><span>linorder_neqE_nat</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.not_less_eq|fact"><span>not_less_eq</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.plus_1_eq_Suc|fact"><span>plus_1_eq_Suc</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>hence</span></span></span><span> </span><span class="entity_def" id="offset_7880..7881">*</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>nth</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>P<span class="hidden">â©</span><sub>a</sub></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="free"><span>a</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>â</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span> </span><span class="free"><span>M</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_7285..7296"><span>pref_match'</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_7344..7351"><span>matched</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.less_Suc_eq|fact"><span>less_Suc_eq</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5402..5412"><span>match_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>fastforce</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>nth</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>P<span class="hidden">â©</span><sub>a</sub></span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span class="free"><span>a</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><span class="quoted"><span class="quoted"><span>â¹</span><span class="free"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>n</span></span><span>âº</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.map_nth|fact"><span>map_nth</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_2342..2349"><span>P<span class="hidden">â©</span><sub>a</sub>_set</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.set_map|fact"><span>set_map</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.set_upt|fact"><span>set_upt</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>hence</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span> </span><span class="free"><span>M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_7880..7881"><span>*</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_7428..7433"><span>match</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.set_eq_subset|fact"><span>set_eq_subset</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>then</span></span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="quoted"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.False|const"><span>False</span></a></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_7234..7235"><span>A</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_7256..7257"><span>M</span></a><span> </span><span class="quoted"><span class="quoted"><span>â¹</span><a class="entity_ref" href="../../HOL/HOL/Finite_Set.html#Finite_Set.card|const"><span>card</span></a><span> </span><span class="free"><span>M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>n</span></span><span>âº</span></span></span><span> </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_6107..6117"><span>matching_def</span></a><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set_Interval.html#Set_Interval.atLeast0LessThan|fact"><span>atLeast0LessThan</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Finite_Set.html#Finite_Set.card_image|fact"><span>card_image</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Set_Interval.html#Set_Interval.card_lessThan|fact"><span>card_lessThan</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.nat_neq_iff|fact"><span>nat_neq_iff</span></a><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_8279..8288">corollary</span></span></span><span> </span><span class="entity_def" id="Gale_Shapley1.Pref.more_choices_matched|fact"><span class="entity_def" id="Gale_Shapley1.Pref.more_choices_matched|thm"><span class="entity_def" id="offset_8289..8309">more_choices_matched</span></span></span><span class="main"><span>:</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_6118..6126"><span>matching</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="free"><span>M</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>â</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>â </span></a></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span>"</span></span></span><span>
</span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_6050..6059"><span>preferred</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="free"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>â</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span> </span><span class="free"><span>M</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>â</span></a></span><span> </span><span class="free"><span>M</span></span><span>"</span></span></span><span>
</span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="free"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>n</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_7212..7224"><span>more_choices</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_8279..8288"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>1-4</span><span class="main"><span class="main"><span>)</span></span></span><span class="main"><span>]</span></span><span> </span><span class="quoted"><span class="quoted"><span>â¹</span><span class="free"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>â</span></a></span><span> </span><span class="free"><span>M</span></span><span>âº</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>â¹</span><span class="free"><span>M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>â</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span>âº</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set_Interval.html#Set_Interval.ord_class.atLeastLessThan_iff|fact"><span>atLeastLessThan_iff</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>blast</span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_8507..8512">lemma</span></span></span><span> </span><span class="entity_def" id="Gale_Shapley1.Pref.atmost1_final|fact"><span class="entity_def" id="Gale_Shapley1.Pref.atmost1_final|thm"><span class="entity_def" id="offset_8513..8526">atmost1_final</span></span></span><span class="main"><span>:</span></span><span> </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_8536..8537">M</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>â</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity_def" id="offset_8554..8557">inj</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.inj_on|const"><span>inj_on</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="free"><span>A</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>M</span></span><span>"</span></span></span><span>
</span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>â</span></span><span class="bound"><span class="bound"><span>a</span></span></span><span class="main"><span>&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_6050..6059"><span>preferred</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>â</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span> </span><span class="free"><span>M</span></span><span>"</span></span></span><span>
</span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>â<span class="hidden">â©</span><sub>â¤</sub><span class="hidden">â©</span><sub>1</sub></span></span><span> </span><span class="bound"><span>a</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.not_member|const"><span>â</span></a></span><span> </span><span class="free"><span>M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><span class="free"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>n</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>rule</span></span><span>
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>subgoal</span></span></span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>for</span></span></span><span> x y</span><span>
</span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_6265..6275"><span>final_last</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_8536..8537"><span>M</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_8554..8557"><span>inj</span></a><span class="main"><span>,</span></span><span> </span><span class="operator"><span>of</span></span><span> </span><span class="quoted"><span class="skolem"><span>x</span></span></span><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_6265..6275"><span>final_last</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_8536..8537"><span>M</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_8554..8557"><span>inj</span></a><span class="main"><span>,</span></span><span> </span><span class="operator"><span>of</span></span><span> </span><span class="quoted"><span class="skolem"><span>y</span></span></span><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_8507..8512"><span>assms</span></a><span class="main"><span>(</span></span><span>3</span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>blast</span></span><span>
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_8778..8783">lemma</span></span></span><span> </span><span class="entity_def" id="Gale_Shapley1.Pref.sumA_UB|fact"><span class="entity_def" id="Gale_Shapley1.Pref.sumA_UB|thm"><span class="entity_def" id="offset_8784..8791">sumA_UB</span></span></span><span class="main"><span>:</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_6118..6126"><span>matching</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="free"><span>M</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>â</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>â </span></a></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>â</span></span><span class="bound"><span class="bound"><span>a</span></span></span><span class="main"><span>&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_6050..6059"><span>preferred</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>â</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span> </span><span class="free"><span>M</span></span><span>"</span></span></span><span>
</span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="main"><span>â</span></span><span class="bound"><span>a</span></span><span class="main"><span>&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>A</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span class="bound"><span>a</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>â¤</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Power.html#Power.power_class.power|const"><span>^</span></a></span><span class="numeral"><span>2</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_8919..8920">M</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>â</span></span><span class="bound"><span>a</span></span><span class="main"><span>â</span></span><span class="free"><span>M</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>A</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span class="bound"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>n</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_8289..8309"><span>more_choices_matched</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_8778..8783"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>1-3</span><span class="main"><span class="main"><span>)</span></span></span><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_8778..8783"><span>assms</span></a><span class="main"><span>(</span></span><span>4</span><span class="main"><span>)</span></span><span>
    </span><span class="quoted"><span class="quoted"><span>â¹</span><span class="free"><span>M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>â</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span>âº</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set_Interval.html#Set_Interval.ord_class.atLeastLessThan_iff|fact"><span>atLeastLessThan_iff</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>blast</span></span><span>
  </span><span class="keyword1"><span class="command"><span>note</span></span></span><span> </span><span class="entity_def" id="offset_9044..9048">Ainj</span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.conj12|fact"><span>conj12</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_8778..8783"><a class="entity_ref" href="Gale_Shapley1.html#offset_8778..8783"><span>assms</span></a></a><span class="main"><span class="main"><span class="main"><span>(</span></span></span></span><span>1</span><span class="main"><span class="main"><span class="main"><span>)</span></span></span></span><span class="main"><span class="main"><span class="main"><span>[</span></span></span></span><span class="operator"><span class="operator"><span>unfolded</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_6107..6117"><a class="entity_ref" href="Gale_Shapley1.html#offset_6107..6117"><span>matching_def</span></a></a><span class="main"><span class="main"><span class="main"><span>]</span></span></span></span><span class="main"><span>]</span></span><span>
  </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>cases</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>â</span></span><span class="bound"><span class="bound"><span>a'</span></span></span><span class="main"><span>&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>a'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.not_member|const"><span>â</span></a></span><span> </span><span class="free"><span>M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><span class="free"><span>A</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span class="bound"><span>a'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>n</span></span><span>"</span></span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>True</span><span>
    </span><span class="keyword1"><span class="command"><span>then</span></span></span><span> </span><span class="keyword3"><span class="command"><span>obtain</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>a'</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="entity_def" id="offset_9195..9197">a'</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>a'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span class="free"><span>n</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>a'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.not_member|const"><span>â</span></a></span><span> </span><span class="free"><span>M</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>A</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span class="skolem"><span>a'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>n</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>â¹</span><span class="free"><span>M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>â</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span>âº</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>â¹</span><span class="free"><span>M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>â </span></a></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span>âº</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>blast</span></span><span>
    </span><span class="keyword1"><span class="command"><span>hence</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>â</span></span><span class="bound"><span class="bound"><span>a</span></span></span><span class="main"><span>&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>â </span></a></span><span> </span><span class="skolem"><span>a'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>â¶</span></a></span><span> </span><span class="free"><span>A</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span class="bound"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>â¤</span></a></span><span> </span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="numeral"><span>2</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Uniq_D|fact"><span>Uniq_D</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_8513..8526"><span>atmost1_final</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_8778..8783"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>2</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_9044..9048"><span>Ainj</span></a><span class="main"><span class="main"><span>(</span></span></span><span>2</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_8778..8783"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>4</span><span class="main"><span class="main"><span>)</span></span></span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>,</span></span><span> </span><span class="operator"><span>of</span></span><span> </span><span class="quoted"><span class="skolem"><span>a'</span></span></span><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_8919..8920"><span>M</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_2638..2646"><span>wf_le_n1</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_9044..9048"><span>Ainj</span></a><span class="main"><span class="main"><span>(</span></span></span><span>1</span><span class="main"><span class="main"><span>)</span></span></span><span class="main"><span>]</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_9407..9409">by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Num.html#Num.Suc_1|fact"><span>Suc_1</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.Suc_eq_plus1|fact"><span>Suc_eq_plus1</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.cancel_ab_semigroup_add_class.add_diff_cancel_right&apos;|fact"><span>add_diff_cancel_right'</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Rings.html#Rings.linordered_semidom_class.add_le_imp_le_diff|fact"><span>add_le_imp_le_diff</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.diff_diff_left|fact"><span>diff_diff_left</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.less_eq_Suc_le|fact"><span>less_eq_Suc_le</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.order_less_le|fact"><span>order_less_le</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>from</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_4686..4694"><span>sumA_ub2</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_9195..9197"><span>a'</span></a><span class="main"><span class="main"><span>(</span></span></span><span>1</span><span class="main"><span class="main"><span>)</span></span></span><span> _ </span><a class="entity_ref" href="Gale_Shapley1.html#offset_9407..9409"><span>this</span></a><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_9195..9197"><span>a'</span></a><span class="main"><span>(</span></span><span>3</span><span class="main"><span>)</span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Power.html#Power.monoid_mult_class.power2_eq_square|fact"><span>power2_eq_square</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>linarith</span></span><span>
  </span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
    </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>False</span><span>
    </span><span class="keyword1"><span class="command"><span>hence</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>â</span></span><span class="bound"><span class="bound"><span>a'</span></span></span><span class="main"><span>&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>a'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.not_member|const"><span>â</span></a></span><span> </span><span class="free"><span>M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>â¶</span></a></span><span> </span><span class="free"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="bound"><span>a'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>n</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.Suc_eq_plus1|fact"><span>Suc_eq_plus1</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.Suc_lessI|fact"><span>Suc_lessI</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_2563..2572"><span>wf_less_n</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_9044..9048"><span>Ainj</span></a><span class="main"><span class="main"><span>(</span></span></span><span>1</span><span class="main"><span class="main"><span>)</span></span></span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>with</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_8919..8920"><span>M</span></a><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>â</span></span><span class="bound"><span class="bound"><span>a</span></span></span><span class="main"><span>&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>n</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>blast</span></span><span>
    </span><span class="keyword1"><span class="command"><span>hence</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="main"><span>â</span></span><span class="bound"><span>a</span></span><span class="main"><span>&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>A</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span class="bound"><span>a</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>â¤</span></a></span><span> </span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.times_class.times|const"><span>*</span></a></span><span class="main"><span>(</span></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="numeral"><span>2</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Groups_Big.html#Groups_Big.sum_bounded_above|fact"><span>sum_bounded_above</span></a><span class="main"><span>[</span></span><span class="operator"><span>of</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set_Interval.html#Set_Interval.ord_class.lessThan|const"><span>{..&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set_Interval.html#Set_Interval.ord_class.lessThan|const"><span>}</span></a></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>(!)</span></a></span><span> </span><span class="free"><span>A</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="numeral"><span>2</span></span><span>"</span></span></span><span class="main"><span>]</span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>fastforce</span></span><span>
    </span><span class="keyword1"><span class="command"><span>also</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>â¦</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>â¤</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.times_class.times|const"><span>*</span></a></span><span class="main"><span>(</span></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>)</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.algebra_simps|fact"><span class="dynamic"><span class="dynamic"><span>algebra_simps</span></span></span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>finally</span></span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Power.html#Power.monoid_mult_class.power2_eq_square|fact"><span>power2_eq_square</span></a><span> </span><span class="keyword1"><span class="command"><span>.</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_10015..10020">lemma</span></span></span><span> </span><span class="entity_def" id="Gale_Shapley1.Pref.var_ub|fact"><span class="entity_def" id="Gale_Shapley1.Pref.var_ub|thm"><span class="entity_def" id="offset_10021..10027">var_ub</span></span></span><span class="main"><span>:</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_6118..6126"><span>matching</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="free"><span>M</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>â</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>â </span></a></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>â</span></span><span class="bound"><span class="bound"><span>a</span></span></span><span class="main"><span>&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_6050..6059"><span>preferred</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>â</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span> </span><span class="free"><span>M</span></span><span>"</span></span></span><span>
</span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="main"><span>â</span></span><span class="bound"><span>a</span></span><span class="main"><span>&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>A</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span class="bound"><span>a</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Finite_Set.html#Finite_Set.card|const"><span>card</span></a><span> </span><span class="free"><span>M</span></span><span>  </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Power.html#Power.power_class.power|const"><span>^</span></a></span><span class="numeral"><span>2</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_10169..10170">1</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset|const"><span>â</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_10015..10020"><span>assms</span></a><span class="main"><span>(</span></span><span>2</span><span class="main"><span>,</span></span><span>3</span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>auto</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_10215..10216">2</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Finite_Set.html#Finite_Set.card|const"><span>card</span></a><span> </span><span class="free"><span>M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>n</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Finite_Set.html#Finite_Set.psubset_card_mono|fact"><span>psubset_card_mono</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> _ </span><a class="entity_ref" href="Gale_Shapley1.html#offset_10169..10170"><span>1</span></a><span class="main"><span>]</span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_10278..10279">3</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Groups_Big.html#Groups_Big.comm_monoid_add_class.sum|const"><span>sum</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>(!)</span></a></span><span> </span><span class="free"><span>A</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set_Interval.html#Set_Interval.ord_class.lessThan|const"><span>{..&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set_Interval.html#Set_Interval.ord_class.lessThan|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>â¤</span></a></span><span> </span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Power.html#Power.power_class.power|const"><span>^</span></a></span><span class="numeral"><span>2</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="numeral"><span>2</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.times_class.times|const"><span>*</span></a></span><span class="free"><span>n</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_8784..8791"><span>sumA_UB</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_10015..10020"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>1-4</span><span class="main"><span class="main"><span>)</span></span></span><span class="main"><span>]</span></span><span>  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Power.html#Power.monoid_mult_class.power2_eq_square|fact"><span>power2_eq_square</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.algebra_simps|fact"><span class="dynamic"><span class="dynamic"><span>algebra_simps</span></span></span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_10405..10406">4</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="numeral"><span>2</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.times_class.times|const"><span>*</span></a></span><span class="free"><span>n</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>â¤</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.Suc|const"><span>Suc</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Power.html#Power.power_class.power|const"><span>^</span></a></span><span class="numeral"><span>2</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.le_square|fact"><span>le_square</span></a><span class="main"><span>[</span></span><span class="operator"><span>of</span></span><span> </span><span class="quoted"><span class="free"><span>n</span></span></span><span class="main"><span>]</span></span><span> </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Power.html#Power.monoid_mult_class.power2_eq_square|fact"><span>power2_eq_square</span></a><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Num.html#Num.Suc_1|fact"><span>Suc_1</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.add_mono_thms_linordered_semiring|fact"><span>add_mono_thms_linordered_semiring</span></a><span class="main"><span class="main"><span>(</span></span></span><span>1</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.le_SucI|fact"><span>le_SucI</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Num.html#Num.semiring_numeral_class.mult_2|fact"><span>mult_2</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.mult_le_mono1|fact"><span>mult_le_mono1</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.not_less_eq_eq|fact"><span>not_less_eq_eq</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.plus_1_eq_Suc|fact"><span>plus_1_eq_Suc</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="main"><span>â</span></span><span class="bound"><span>a</span></span><span class="main"><span>&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>A</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span class="bound"><span>a</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Finite_Set.html#Finite_Set.card|const"><span>card</span></a><span> </span><span class="free"><span>M</span></span><span>  </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Power.html#Power.power_class.power|const"><span>^</span></a></span><span class="numeral"><span>2</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_10215..10216"><span>2</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_10278..10279"><span>3</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_10405..10406"><span>4</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>linarith</span></span><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_10665..10670">lemma</span></span></span><span> </span><span class="entity_def" id="Gale_Shapley1.Pref.var_match|fact"><span class="entity_def" id="Gale_Shapley1.Pref.var_match|thm"><span class="entity_def" id="offset_10671..10680">var_match</span></span></span><span class="main"><span>:</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_6118..6126"><span>matching</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="free"><span>M</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>â</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>â </span></a></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>â</span></span><span class="bound"><span class="bound"><span>a</span></span></span><span class="main"><span>&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_6050..6059"><span>preferred</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>â</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span> </span><span class="free"><span>M</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.not_member|const"><span>â</span></a></span><span> </span><span class="free"><span>M</span></span><span>"</span></span></span><span>
</span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_4580..4583"><span>var</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.union|const"><span>âª</span></a></span><span> </span><span class="main"><span>{</span></span><span class="free"><span>a</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_4580..4583"><span>var</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="free"><span>M</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_10820..10821">2</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset|const"><span>â</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_10665..10670"><span>assms</span></a><span class="main"><span>(</span></span><span>2</span><span class="main"><span>,</span></span><span>3</span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>auto</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_10866..10867">3</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Finite_Set.html#Finite_Set.card|const"><span>card</span></a><span> </span><span class="free"><span>M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>n</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Finite_Set.html#Finite_Set.psubset_card_mono|fact"><span>psubset_card_mono</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> _ </span><a class="entity_ref" href="Gale_Shapley1.html#offset_10820..10821"><span>2</span></a><span class="main"><span>]</span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_10929..10930">4</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Groups_Big.html#Groups_Big.comm_monoid_add_class.sum|const"><span>sum</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>(!)</span></a></span><span> </span><span class="free"><span>A</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set_Interval.html#Set_Interval.ord_class.lessThan|const"><span>{..&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set_Interval.html#Set_Interval.ord_class.lessThan|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>â¤</span></a></span><span> </span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Power.html#Power.power_class.power|const"><span>^</span></a></span><span class="numeral"><span>2</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="numeral"><span>2</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.times_class.times|const"><span>*</span></a></span><span class="free"><span>n</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_8784..8791"><span>sumA_UB</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_10665..10670"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>1-4</span><span class="main"><span class="main"><span>)</span></span></span><span class="main"><span>]</span></span><span>  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Power.html#Power.monoid_mult_class.power2_eq_square|fact"><span>power2_eq_square</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.algebra_simps|fact"><span class="dynamic"><span class="dynamic"><span>algebra_simps</span></span></span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_11056..11057">5</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="numeral"><span>2</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.times_class.times|const"><span>*</span></a></span><span class="free"><span>n</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>â¤</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.Suc|const"><span>Suc</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Power.html#Power.power_class.power|const"><span>^</span></a></span><span class="numeral"><span>2</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.le_square|fact"><span>le_square</span></a><span class="main"><span>[</span></span><span class="operator"><span>of</span></span><span> </span><span class="quoted"><span class="free"><span>n</span></span></span><span class="main"><span>]</span></span><span> </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Power.html#Power.monoid_mult_class.power2_eq_square|fact"><span>power2_eq_square</span></a><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Num.html#Num.Suc_1|fact"><span>Suc_1</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.add_mono_thms_linordered_semiring|fact"><span>add_mono_thms_linordered_semiring</span></a><span class="main"><span class="main"><span>(</span></span></span><span>1</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.le_SucI|fact"><span>le_SucI</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Num.html#Num.semiring_numeral_class.mult_2|fact"><span>mult_2</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.mult_le_mono1|fact"><span>mult_le_mono1</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.not_less_eq_eq|fact"><span>not_less_eq_eq</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.plus_1_eq_Suc|fact"><span>plus_1_eq_Suc</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span>6</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="main"><span>â</span></span><span class="bound"><span>a</span></span><span class="main"><span>&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>A</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span class="bound"><span>a</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Finite_Set.html#Finite_Set.card|const"><span>card</span></a><span> </span><span class="free"><span>M</span></span><span>  </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Power.html#Power.power_class.power|const"><span>^</span></a></span><span class="numeral"><span>2</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="free"><span>n</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_10866..10867"><span>3</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_10929..10930"><span>4</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_11056..11057"><span>5</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>linarith</span></span><span>
  </span><span class="keyword1"><span class="command"><span>from</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_10021..10027"><span>var_ub</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_10665..10670"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>1-4</span><span class="main"><span class="main"><span>)</span></span></span><span class="main"><span>]</span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>â¹</span><span class="free"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.not_member|const"><span>â</span></a></span><span> </span><span class="free"><span>M</span></span><span>âº</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Finite_Set.html#Finite_Set.finite_subset|fact"><span>finite_subset</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_10665..10670"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>2</span><span class="main"><span class="main"><span>)</span></span></span><span class="main"><span>]</span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_11411..11416">lemma</span></span></span><span> </span><span class="entity_def" id="Gale_Shapley1.Pref.var_next|fact"><span class="entity_def" id="Gale_Shapley1.Pref.var_next|thm"><span class="entity_def" id="offset_11417..11425">var_next</span></span></span><span class="main"><span>:</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_6118..6126"><span>matching</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="free"><span>M</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>â</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>â </span></a></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>â</span></span><span class="bound"><span class="bound"><span>a</span></span></span><span class="main"><span>&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_6050..6059"><span>preferred</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>â</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span> </span><span class="free"><span>M</span></span><span>"</span></span></span><span>
 </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>n</span></span><span>"</span></span></span><span>
</span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_4580..4583"><span>var</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>A</span></span><span class="main"><span>[</span></span><span class="free"><span>a</span></span><span> </span><span class="main"><span>:=</span></span><span> </span><span class="free"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="free"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_4580..4583"><span>var</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="free"><span>M</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_4580..4583"><span>var</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>A</span></span><span class="main"><span>[</span></span><span class="free"><span>a</span></span><span> </span><span class="main"><span>:=</span></span><span> </span><span class="free"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="free"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.times_class.times|const"><span>*</span></a></span><span class="free"><span>n</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="free"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Groups_Big.html#Groups_Big.comm_monoid_add_class.sum|const"><span>sum</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>(!)</span></a></span><span> </span><span class="free"><span>A</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="main"><span>{</span></span><span class="free"><span>a</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Finite_Set.html#Finite_Set.card|const"><span>card</span></a><span> </span><span class="free"><span>M</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_11411..11416"><span>assms</span></a><span class="main"><span>(</span></span><span>1</span><span class="main"><span>,</span></span><span>5</span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Power.html#Power.monoid_mult_class.power2_eq_square|fact"><span>power2_eq_square</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth_list_update|fact"><span>nth_list_update</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Groups_Big.html#Groups_Big.comm_monoid_add_class.sum.If_cases|fact"><span>sum.If_cases</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Set_Interval.html#Set_Interval.lessThan_atLeast0|fact"><span>lessThan_atLeast0</span></a><span> </span><span class="quasi_keyword"><span>flip</span></span><span class="main"><span class="main"><span>:</span></span></span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.Diff_eq|fact"><span>Diff_eq</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>also</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>â¦</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Power.html#Power.power_class.power|const"><span>^</span></a></span><span class="numeral"><span>2</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>â</span></span><span class="bound"><span>a</span></span><span class="main"><span>&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>A</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span class="bound"><span>a</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Finite_Set.html#Finite_Set.card|const"><span>card</span></a><span> </span><span class="free"><span>M</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Groups_Big.html#Groups_Big.comm_monoid_add_class.sum.insert_remove|fact"><span>sum.insert_remove</span></a><span class="main"><span>[</span></span><span class="operator"><span>of</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>nth</span></a><span> </span><span class="free"><span>A</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="free"><span>a</span></span></span><span class="main"><span>,</span></span><span class="operator"><span>simplified</span></span><span class="main"><span>,</span></span><span class="operator"><span>symmetric</span></span><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_11411..11416"><span>assms</span></a><span class="main"><span>(</span></span><span>5</span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.insert_absorb|fact"><span>insert_absorb</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Set_Interval.html#Set_Interval.lessThan_atLeast0|fact"><span>lessThan_atLeast0</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Power.html#Power.monoid_mult_class.power2_eq_square|fact"><span>power2_eq_square</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>also</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>â¦</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Power.html#Power.power_class.power|const"><span>^</span></a></span><span class="numeral"><span>2</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="main"><span>â</span></span><span class="bound"><span>a</span></span><span class="main"><span>&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>A</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span class="bound"><span>a</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Finite_Set.html#Finite_Set.card|const"><span>card</span></a><span> </span><span class="free"><span>M</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_10021..10027"><span>var_ub</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_11411..11416"><span>assms</span></a><span class="main"><span class="main"><span>(</span></span></span><span>1-4</span><span class="main"><span class="main"><span>)</span></span></span><span class="main"><span>]</span></span><span> </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Power.html#Power.monoid_mult_class.power2_eq_square|fact"><span>power2_eq_square</span></a><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>linarith</span></span><span>
  </span><span class="keyword1"><span class="command"><span>finally</span></span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_4569..4579"><span>var_def</span></a><span> </span><span class="keyword1"><span class="command"><span>.</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>


</span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>â¹</span><span>The following two predicates express the same property:
</span><span>if </span><span class="antiquoted"><span class="raw_text"><span class="operator"><span>â¹</span></span><span>aâº</span></span></span><span> prefers </span><span class="antiquoted"><span class="raw_text"><span class="operator"><span>â¹</span></span><span>bâº</span></span></span><span> over </span><span class="antiquoted"><span class="raw_text"><span class="operator"><span>â¹</span></span><span>aâº</span></span></span><span>'s current match,
</span><span>then </span><span class="antiquoted"><span class="raw_text"><span class="operator"><span>â¹</span></span><span>bâº</span></span></span><span> is matched with an </span><span class="antiquoted"><span class="raw_text"><span class="operator"><span>â¹</span></span><span>a'âº</span></span></span><span> that </span><span class="antiquoted"><span class="raw_text"><span class="operator"><span>â¹</span></span><span>bâº</span></span></span><span> prefers to </span><span class="antiquoted"><span class="raw_text"><span class="operator"><span>â¹</span></span><span>aâº</span></span></span><span>.</span><span>âº</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="Gale_Shapley1.Pref.pref_match_def|fact"><span class="entity_def" id="Gale_Shapley1.Pref.pref_match_def|thm"><span class="entity_def" id="Gale_Shapley1.Pref.pref_match_def_raw|axiom"><span class="entity_def" id="offset_12328..12338">definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="Gale_Shapley1.Pref.pref_match.cong|fact"><span class="entity_def" id="Gale_Shapley1.Pref.pref_match.cong|thm"><span class="entity_def" id="Gale_Shapley1.Pref.pref_match|const"><span class="entity_def" id="offset_12339..12349">pref_match</span></span></span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
</span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>pref_match</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>A</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>M</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>â</span></span><span class="bound"><span class="bound"><span>a</span></span></span><span class="main"><span>&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>â</span></span><span class="bound"><span class="bound"><span>b</span></span></span><span class="main"><span>&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>P<span class="hidden">â©</span><sub>a</sub></span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span class="bound"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.prefa|const"><span>â¢</span></a></span><span> </span><span class="bound"><span>b</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.prefa|const"><span>&lt;</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>A</span></span></span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>â¶</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>â</span></span><span class="bound"><span>a'</span></span><span class="main"><span>â</span></span><span class="free"><span class="bound"><span class="entity"><span>M</span></span></span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>b</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>A</span></span></span></span><span> </span><span class="bound"><span>a'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><span class="free"><span>P<span class="hidden">â©</span><sub>b</sub></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="bound"><span>b</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.prefa|const"><span>â¢</span></a></span><span> </span><span class="bound"><span>a'</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.prefa|const"><span>&lt;</span></a></span><span> </span><span class="bound"><span>a</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="Gale_Shapley1.Pref.pref_match&apos;_def|fact"><span class="entity_def" id="Gale_Shapley1.Pref.pref_match&apos;_def|thm"><span class="entity_def" id="Gale_Shapley1.Pref.pref_match&apos;_def_raw|axiom"><span class="entity_def" id="offset_12457..12467">definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="Gale_Shapley1.Pref.pref_match&apos;.cong|fact"><span class="entity_def" id="Gale_Shapley1.Pref.pref_match&apos;.cong|thm"><span class="entity_def" id="Gale_Shapley1.Pref.pref_match&apos;|const"><span class="entity_def" id="offset_12468..12479">pref_match'</span></span></span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
</span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>pref_match'</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>A</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>M</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>â</span></span><span class="bound"><span class="bound"><span>a</span></span></span><span class="main"><span>&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>â</span></span><span class="bound"><span>b</span></span><span> </span><span class="main"><span>â</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_6050..6059"><span>preferred</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>A</span></span></span></span><span> </span><span class="bound"><span>a</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>â</span></span><span class="bound"><span>a'</span></span><span class="main"><span>â</span></span><span class="free"><span class="bound"><span class="entity"><span>M</span></span></span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>b</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>A</span></span></span></span><span> </span><span class="bound"><span>a'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><span class="free"><span>P<span class="hidden">â©</span><sub>b</sub></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="bound"><span>b</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.prefa|const"><span>â¢</span></a></span><span> </span><span class="bound"><span>a'</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.prefa|const"><span>&lt;</span></a></span><span> </span><span class="bound"><span>a</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Gale_Shapley1.Pref.pref_match&apos;_iff|fact"><span class="entity_def" id="Gale_Shapley1.Pref.pref_match&apos;_iff|thm"><span class="entity_def" id="offset_12582..12597">pref_match'_iff</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_2486..2488"><span>wf</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="main"><span>â¹</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_12468..12479"><span>pref_match'</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="free"><span>M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_12339..12349"><span>pref_match</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="free"><span>M</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>auto</span></span><span> </span><span class="quasi_keyword"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_12457..12467"><span>pref_match'_def</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_12328..12338"><span>pref_match_def</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.imp_ex|fact"><span>imp_ex</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.prefers_def|fact"><span>prefers_def</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5402..5412"><span>match_def</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>smt</span></span><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>verit</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_2342..2349"><span>P<span class="hidden">â©</span><sub>a</sub>_set</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Set_Interval.html#Set_Interval.atLeast0LessThan|fact"><span>atLeast0LessThan</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.preorder_class.order.strict_trans|fact"><span>order.strict_trans</span></a><span> </span><a class="entity_ref" href="../List-Index/List_Index.html#List_Index.index_first|fact"><span>index_first</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Set_Interval.html#Set_Interval.ord_class.lessThan_iff|fact"><span>lessThan_iff</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.linorder_neqE_nat|fact"><span>linorder_neqE_nat</span></a><span> </span><a class="entity_ref" href="../List-Index/List_Index.html#List_Index.nth_index|fact"><span>nth_index</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>smt</span></span><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>verit</span><span class="main"><span class="main"><span>,</span></span></span><span> best</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_2342..2349"><span>P<span class="hidden">â©</span><sub>a</sub>_set</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Set_Interval.html#Set_Interval.atLeast0LessThan|fact"><span>atLeast0LessThan</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Set_Interval.html#Set_Interval.card_atLeastLessThan|fact"><span>card_atLeastLessThan</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.card_distinct|fact"><span>card_distinct</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.cancel_comm_monoid_add_class.diff_zero|fact"><span>diff_zero</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.in_mono|fact"><span>in_mono</span></a><span> </span><a class="entity_ref" href="../List-Index/List_Index.html#List_Index.index_nth_id|fact"><span>index_nth_id</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Set_Interval.html#Set_Interval.ord_class.lessThan_iff|fact"><span>lessThan_iff</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.preorder_class.less_trans|fact"><span>less_trans</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth_mem|fact"><span>nth_mem</span></a><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="Gale_Shapley1.Pref.opti\&lt;^sub&gt;a_def|fact"><span class="entity_def" id="Gale_Shapley1.Pref.opti\&lt;^sub&gt;a_def|thm"><span class="entity_def" id="Gale_Shapley1.Pref.opti\&lt;^sub&gt;a_def_raw|axiom"><span class="entity_def" id="offset_12992..13002">definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="Gale_Shapley1.Pref.opti\&lt;^sub&gt;a.cong|fact"><span class="entity_def" id="Gale_Shapley1.Pref.opti\&lt;^sub&gt;a.cong|thm"><span class="entity_def" id="Gale_Shapley1.Pref.opti\&lt;^sub&gt;a|const"><span class="entity_def" id="offset_13003..13009">opti<span class="hidden">â©</span><sub>a</sub></span></span></span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
</span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>opti<span class="hidden">â©</span><sub>a</sub></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>A</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>â</span></span><span class="bound"><span>A'</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_6118..6126"><span>matching</span></a><span> </span><span class="bound"><span>A'</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5827..5833"><span>stable</span></a><span> </span><span class="bound"><span>A'</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span>
                </span><span class="main"><span>(</span></span><span class="main"><span>â</span></span><span class="bound"><span class="bound"><span>a</span></span></span><span class="main"><span>&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>P<span class="hidden">â©</span><sub>a</sub></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.prefa|const"><span>â¢</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="bound"><span>A'</span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.prefa|const"><span>&lt;</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>A</span></span></span></span><span> </span><span class="bound"><span>a</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="Gale_Shapley1.Pref.pessi\&lt;^sub&gt;b_def|fact"><span class="entity_def" id="Gale_Shapley1.Pref.pessi\&lt;^sub&gt;b_def|thm"><span class="entity_def" id="Gale_Shapley1.Pref.pessi\&lt;^sub&gt;b_def_raw|axiom"><span class="entity_def" id="offset_13130..13140">definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="Gale_Shapley1.Pref.pessi\&lt;^sub&gt;b.cong|fact"><span class="entity_def" id="Gale_Shapley1.Pref.pessi\&lt;^sub&gt;b.cong|thm"><span class="entity_def" id="Gale_Shapley1.Pref.pessi\&lt;^sub&gt;b|const"><span class="entity_def" id="offset_13141..13148">pessi<span class="hidden">â©</span><sub>b</sub></span></span></span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
</span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>pessi<span class="hidden">â©</span><sub>b</sub></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>A</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>â</span></span><span class="bound"><span>A'</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_6118..6126"><span>matching</span></a><span> </span><span class="bound"><span>A'</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5827..5833"><span>stable</span></a><span> </span><span class="bound"><span>A'</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span>
                 </span><span class="main"><span>(</span></span><span class="main"><span>â</span></span><span class="bound"><span class="bound"><span>a</span></span></span><span class="main"><span>&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>â</span></span><span class="bound"><span class="bound"><span>a'</span></span></span><span class="main"><span>&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>A</span></span></span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="bound"><span>A'</span></span><span> </span><span class="bound"><span>a'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><span class="free"><span>P<span class="hidden">â©</span><sub>b</sub></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>A</span></span></span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.prefa|const"><span>â¢</span></a></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.prefa|const"><span>&lt;</span></a></span><span> </span><span class="bound"><span>a'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Gale_Shapley1.Pref.opti\&lt;^sub&gt;a_pessi\&lt;^sub&gt;b|fact"><span class="entity_def" id="Gale_Shapley1.Pref.opti\&lt;^sub&gt;a_pessi\&lt;^sub&gt;b|thm"><span>opti<span class="hidden">â©</span><sub>a</sub>_pessi<span class="hidden">â©</span><sub>b</sub></span></span></span><span class="main"><span>:</span></span><span> </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_13003..13009"><span>opti<span class="hidden">â©</span><sub>a</sub></span></a><span> </span><span class="free"><span>A</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_13141..13148"><span>pessi<span class="hidden">â©</span><sub>b</sub></span></a><span> </span><span class="free"><span>A</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_13130..13140"><span>pessi<span class="hidden">â©</span><sub>b</sub>_def</span></a><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>safe</span></span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>goal_cases</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity_def" id="offset_13410..13411">1</span><span> </span><span class="skolem"><span>A'</span></span><span> </span><span class="skolem"><span>a</span></span><span> </span><span class="skolem"><span>a'</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>Â¬</span></a></span><span> </span><span class="free"><span>P<span class="hidden">â©</span><sub>a</sub></span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span class="skolem"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.prefa|const"><span>â¢</span></a></span><span>  </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="skolem"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.prefa|const"><span>&lt;</span></a></span><span>  </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="skolem"><span>A'</span></span><span> </span><span class="skolem"><span>a</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_13410..13411"><span>1</span></a><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set_Interval.html#Set_Interval.atLeast0LessThan|fact"><span>atLeast0LessThan</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5677..5687"><span>blocks_def</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Set_Interval.html#Set_Interval.ord_class.lessThan_iff|fact"><span>lessThan_iff</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.prefers_asym|fact"><span>prefers_asym</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5816..5826"><span>stable_def</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>with</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_13410..13411"><span>1</span></a><span> </span><span class="quoted"><span class="quoted"><span>â¹</span><a class="entity_ref" href="Gale_Shapley1.html#offset_13003..13009"><span>opti<span class="hidden">â©</span><sub>a</sub></span></a><span> </span><span class="free"><span>A</span></span><span>âº</span></span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_2342..2349"><span>P<span class="hidden">â©</span><sub>a</sub>_set</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5452..5464"><span>match_less_n</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_12992..13002"><span>opti<span class="hidden">â©</span><sub>a</sub>_def</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.prefers_def|fact"><span>prefers_def</span></a><span> </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_6107..6117"><span>matching_def</span></a><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>no_types</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set_Interval.html#Set_Interval.atLeast0LessThan|fact"><span>atLeast0LessThan</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.inj_on_contraD|fact"><span>inj_on_contraD</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Set_Interval.html#Set_Interval.ord_class.lessThan_iff|fact"><span>lessThan_iff</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.less_not_refl|fact"><span>less_not_refl</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.linorder_neqE_nat|fact"><span>linorder_neqE_nat</span></a><span> </span><a class="entity_ref" href="../List-Index/List_Index.html#List_Index.nth_index|fact"><span>nth_index</span></a><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Gale_Shapley1.Pref.opti\&lt;^sub&gt;a_inv|fact"><span class="entity_def" id="Gale_Shapley1.Pref.opti\&lt;^sub&gt;a_inv|thm"><span class="entity_def" id="offset_13781..13791">opti<span class="hidden">â©</span><sub>a</sub>_inv</span></span></span><span class="main"><span>:</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_13801..13802">A</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_2486..2488"><span>wf</span></a><span> </span><span class="free"><span>A</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity_def" id="offset_13815..13816">a</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>n</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity_def" id="offset_13830..13832">a'</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>a'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>n</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity_def" id="offset_13847..13857">same_match</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="free"><span>a'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="free"><span>a</span></span><span>"</span></span></span><span>
</span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity_def" id="offset_13888..13892">pref</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>P<span class="hidden">â©</span><sub>b</sub></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="free"><span>a'</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.prefa|const"><span>â¢</span></a></span><span> </span><span class="free"><span>a'</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.prefa|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>a</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_13003..13009"><span>opti<span class="hidden">â©</span><sub>a</sub></span></a><span> </span><span class="free"><span>A</span></span><span>"</span></span></span><span>
</span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_13003..13009"><span>opti<span class="hidden">â©</span><sub>a</sub></span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>A</span></span><span class="main"><span>[</span></span><span class="free"><span>a</span></span><span> </span><span class="main"><span>:=</span></span><span> </span><span class="free"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="free"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>unfold</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_12992..13002"><span>opti<span class="hidden">â©</span><sub>a</sub>_def</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_6107..6117"><span>matching_def</span></a><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>rule</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.notI|fact"><span>notI</span></a><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>elim</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.exE|fact"><span>exE</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conjE|fact"><span>conjE</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>note</span></span></span><span> </span><span class="entity_def" id="offset_14045..14051">opti<span class="hidden">â©</span><sub>a</sub></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="quoted"><span class="quoted"><span>â¹</span><a class="entity_ref" href="Gale_Shapley1.html#offset_13003..13009"><span>opti<span class="hidden">â©</span><sub>a</sub></span></a><span> </span><span class="free"><span>A</span></span><span>âº</span></span></span><span class="main"><span>[</span></span><span class="operator"><span>unfolded</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_12992..13002"><span>opti<span class="hidden">â©</span><sub>a</sub>_def</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_6107..6117"><span>matching_def</span></a><span class="main"><span>]</span></span><span>
  </span><span class="keyword1"><span class="command"><span>let</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?A</span></span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>A</span></span><span class="main"><span>[</span></span><span class="free"><span>a</span></span><span> </span><span class="main"><span>:=</span></span><span> </span><span class="free"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="free"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>]</span></span><span>"</span></span></span><span>
  </span><span class="keyword3"><span class="command"><span>fix</span></span></span><span> </span><span class="skolem"><span>A'</span></span><span> </span><span class="skolem"><span>a''</span></span><span>
  </span><span class="keyword3"><span class="command"><span>assume</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>a''</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>n</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity_def" id="offset_14166..14168">A'</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/List.html#List.length|const"><span>length</span></a><span> </span><span class="skolem"><span>A'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>n</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.set|const"><span>set</span></a><span> </span><span class="skolem"><span>A'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>â</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_5827..5833"><span>stable</span></a><span> </span><span class="skolem"><span>A'</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.inj_on|const"><span>inj_on</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="skolem"><span>A'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity_def" id="offset_14250..14258">pref_a''</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>P<span class="hidden">â©</span><sub>a</sub></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="skolem"><span>a''</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.prefa|const"><span>â¢</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="skolem"><span>A'</span></span><span> </span><span class="skolem"><span>a''</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.prefa|const"><span>&lt;</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="var"><span>?A</span></span><span> </span><span class="skolem"><span>a''</span></span><span>"</span></span></span><span>
  </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="quoted"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.False|const"><span>False</span></a></span><span>
  </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>cases</span></span><span>
    </span><span class="keyword3"><span class="command"><span>assume</span></span></span><span> </span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>a''</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>a</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>A</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span class="free"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>n</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_13801..13802"><span>A</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_13815..13816"><span>a</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|fact"><span>subset_eq</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>with</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_13801..13802"><span>A</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_14166..14168"><span>A'</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_13815..13816"><span>a</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_14250..14258"><span>pref_a''</span></a><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>P<span class="hidden">â©</span><sub>a</sub></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="free"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.prefa|const"><span>â¢</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="skolem"><span>A'</span></span><span> </span><span class="free"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.prefa|const"><span>&lt;</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="free"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.disj|const"><span>â¨</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="skolem"><span>A'</span></span><span> </span><span class="free"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="free"><span>a</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span class="main"><span>(</span></span><span class="operator"><span>auto</span></span><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.prefers_def|fact"><span>prefers_def</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5402..5412"><span>match_def</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>smt</span></span><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>verit</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_2342..2349"><span>P<span class="hidden">â©</span><sub>a</sub>_set</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_2563..2572"><span>wf_less_n</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Set_Interval.html#Set_Interval.card_atLeastLessThan|fact"><span>card_atLeastLessThan</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.card_distinct|fact"><span>card_distinct</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.cancel_comm_monoid_add_class.diff_zero|fact"><span>diff_zero</span></a><span> </span><a class="entity_ref" href="../List-Index/List_Index.html#List_Index.index_nth_id|fact"><span>index_nth_id</span></a><span>
              </span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.not_less_eq|fact"><span>not_less_eq</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.not_less_less_Suc_eq|fact"><span>not_less_less_Suc_eq</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword3"><span class="command"><span>thus</span></span></span><span> </span><span class="quoted"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.False|const"><span>False</span></a></span><span>
    </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span>
      </span><span class="keyword3"><span class="command"><span>assume</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>P<span class="hidden">â©</span><sub>a</sub></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="free"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.prefa|const"><span>â¢</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="skolem"><span>A'</span></span><span> </span><span class="free"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.prefa|const"><span>&lt;</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="free"><span>a</span></span><span> </span><span>"</span></span></span><span> </span><span class="keyword3"><span class="command"><span>thus</span></span></span><span> </span><span class="quoted"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.False|const"><span>False</span></a></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_14045..14051"><span>opti<span class="hidden">â©</span><sub>a</sub></span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_14166..14168"><span>A'</span></a><span> </span><span class="quoted"><span class="quoted"><span>â¹</span><span class="free"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>n</span></span><span>âº</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span class="main"><span>(</span></span><span class="operator"><span>fastforce</span></span><span class="main"><span>)</span></span><span> 
    </span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
      </span><span class="keyword3"><span class="command"><span>assume</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="skolem"><span>A'</span></span><span> </span><span class="free"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="free"><span>a</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>â </span></a></span><span> </span><span class="free"><span>a'</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_13888..13892"><span>pref</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_13830..13832"><span>a'</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span class="main"><span>(</span></span><span class="operator"><span>auto</span></span><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.prefers_def|fact"><span>prefers_def</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span>hence</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_5688..5694"><span>blocks</span></a><span> </span><span class="skolem"><span>A'</span></span><span> </span><span class="free"><span>a'</span></span><span> </span><span class="free"><span>a</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_14045..14051"><span>opti<span class="hidden">â©</span><sub>a</sub></span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_13888..13892"><span>pref</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_14166..14168"><span>A'</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_13847..13857"><span>same_match</span></a><span> </span><span class="quoted"><span class="quoted"><span>â¹</span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="skolem"><span>A'</span></span><span> </span><span class="free"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="free"><span>a</span></span><span>âº</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_13815..13816"><span>a</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_13830..13832"><span>a'</span></a><span>
        </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5677..5687"><span>blocks_def</span></a><span>
        </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_2342..2349"><span>P<span class="hidden">â©</span><sub>a</sub>_set</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Set_Interval.html#Set_Interval.atLeast0LessThan|fact"><span>atLeast0LessThan</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5452..5464"><span>match_less_n</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.inj_onD|fact"><span>inj_onD</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Set_Interval.html#Set_Interval.ord_class.lessThan_iff|fact"><span>lessThan_iff</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.linorder_neqE_nat|fact"><span>linorder_neqE_nat</span></a><span> </span><a class="entity_ref" href="../List-Index/List_Index.html#List_Index.nth_index|fact"><span>nth_index</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.prefers_def|fact"><span>prefers_def</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword3"><span class="command"><span>thus</span></span></span><span> </span><span class="quoted"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.False|const"><span>False</span></a></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_13815..13816"><span>a</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_13830..13832"><span>a'</span></a><span> </span><span class="quoted"><span class="quoted"><span>â¹</span><span class="free"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>â </span></a></span><span> </span><span class="free"><span>a'</span></span><span>âº</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_14166..14168"><span>A'</span></a><span class="main"><span>(</span></span><span>3</span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5816..5826"><span>stable_def</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Set_Interval.html#Set_Interval.ord_class.atLeastLessThan_iff|fact"><span>atLeastLessThan_iff</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.canonically_ordered_monoid_add_class.zero_le|fact"><span>zero_le</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
    </span><span class="keyword3"><span class="command"><span>assume</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>a''</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>â </span></a></span><span> </span><span class="free"><span>a</span></span><span>"</span></span></span><span> </span><span class="keyword3"><span class="command"><span>thus</span></span></span><span> </span><span class="quoted"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.False|const"><span>False</span></a></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_14045..14051"><span>opti<span class="hidden">â©</span><sub>a</sub></span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_14166..14168"><span>A'</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_14250..14258"><span>pref_a''</span></a><span> </span><span class="quoted"><span class="quoted"><span>â¹</span><span class="skolem"><span>a''</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>n</span></span><span>âº</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5402..5412"><span>match_def</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth_list_update_neq|fact"><span>nth_list_update_neq</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Gale_Shapley1.Pref.pref_match_stable|fact"><span class="entity_def" id="Gale_Shapley1.Pref.pref_match_stable|thm"><span class="entity_def" id="offset_15395..15412">pref_match_stable</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>â¦</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_6118..6126"><span>matching</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span class="main"><span>;</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_12339..12349"><span>pref_match</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><span>â§</span></span><span> </span><span class="main"><span>â¹</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5827..5833"><span>stable</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_12328..12338"><span>pref_match_def</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5816..5826"><span>stable_def</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5677..5687"><span>blocks_def</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_6107..6117"><span>matching_def</span></a><span>
</span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set_Interval.html#Set_Interval.atLeast0LessThan|fact"><span>atLeast0LessThan</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5452..5464"><span>match_less_n</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.inj_onD|fact"><span>inj_onD</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Set_Interval.html#Set_Interval.ord_class.lessThan_iff|fact"><span>lessThan_iff</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.prefers_asym|fact"><span>prefers_asym</span></a><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="Gale_Shapley1.Pref.invAM_def|fact"><span class="entity_def" id="Gale_Shapley1.Pref.invAM_def|thm"><span class="entity_def" id="Gale_Shapley1.Pref.invAM_def_raw|axiom"><span class="entity_def" id="offset_15609..15619">definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="Gale_Shapley1.Pref.invAM.cong|fact"><span class="entity_def" id="Gale_Shapley1.Pref.invAM.cong|thm"><span class="entity_def" id="Gale_Shapley1.Pref.invAM|const"><span class="entity_def" id="offset_15620..15625">invAM</span></span></span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
</span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>invAM</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>A</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>M</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Gale_Shapley1.html#offset_6118..6126"><span>matching</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>A</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>M</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>M</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>â</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_12339..12349"><span>pref_match</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>A</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>M</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_13003..13009"><span>opti<span class="hidden">â©</span><sub>a</sub></span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>A</span></span></span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Gale_Shapley1.Pref.invAM_match|fact"><span class="entity_def" id="Gale_Shapley1.Pref.invAM_match|thm"><span class="entity_def" id="offset_15715..15726">invAM_match</span></span></span><span class="main"><span>:</span></span><span>
  </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>â¦</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_15620..15625"><span>invAM</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="free"><span>M</span></span><span class="main"><span>;</span></span><span>  </span><span class="free"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><span class="free"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.not_member|const"><span>â</span></a></span><span> </span><span class="free"><span>M</span></span><span class="main"><span>;</span></span><span>  </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="free"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.not_member|const"><span>â</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span> </span><span class="free"><span>M</span></span><span> </span><span class="main"><span>â§</span></span><span> </span><span class="main"><span>â¹</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_15620..15625"><span>invAM</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.union|const"><span>âª</span></a></span><span> </span><span class="main"><span>{</span></span><span class="free"><span>a</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>by</span></span></span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_12328..12338"><span>pref_match_def</span></a><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Gale_Shapley1.Pref.invAM_swap|fact"><span class="entity_def" id="Gale_Shapley1.Pref.invAM_swap|thm"><span class="entity_def" id="offset_15844..15854">invAM_swap</span></span></span><span class="main"><span>:</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_15620..15625"><span>invAM</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="free"><span>M</span></span><span>"</span></span></span><span>
</span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_15884..15885">a</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><span class="free"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.not_member|const"><span>â</span></a></span><span> </span><span class="free"><span>M</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity_def" id="offset_15907..15909">a'</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>a'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>â</span></a></span><span> </span><span class="free"><span>M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="free"><span>a'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="free"><span>a</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity_def" id="offset_15949..15953">pref</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>P<span class="hidden">â©</span><sub>b</sub></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="free"><span>a'</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.prefa|const"><span>â¢</span></a></span><span> </span><span class="free"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.prefa|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>a'</span></span><span>"</span></span></span><span>
</span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_15620..15625"><span>invAM</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>A</span></span><span class="main"><span>[</span></span><span class="free"><span>a'</span></span><span> </span><span class="main"><span>:=</span></span><span> </span><span class="free"><span>A</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span class="free"><span>a'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="main"><span>{</span></span><span class="free"><span>a'</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.union|const"><span>âª</span></a></span><span> </span><span class="main"><span>{</span></span><span class="free"><span>a</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_16047..16048">A</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_2486..2488"><span>wf</span></a><span> </span><span class="free"><span>A</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity_def" id="offset_16061..16062">M</span><span> </span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>â</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity_def" id="offset_16080..16083">inj</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.inj_on|const"><span>inj_on</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="free"><span>A</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>M</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity_def" id="offset_16110..16120">pref_match</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_12339..12349"><span>pref_match</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="free"><span>M</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_13003..13009"><span>opti<span class="hidden">â©</span><sub>a</sub></span></a><span> </span><span class="free"><span>A</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span class="main"><span>(</span></span><span class="operator"><span>insert</span></span><span> </span><span class="quoted"><span class="quoted"><span>â¹</span><a class="entity_ref" href="Gale_Shapley1.html#offset_15620..15625"><span>invAM</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="free"><span>M</span></span><span>âº</span></span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>auto</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>â </span></a></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>a'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>n</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>â </span></a></span><span> </span><span class="free"><span>a'</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_15907..15909"><span>a'</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_15884..15885"><span>a</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_16061..16062"><span>M</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>auto</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_16250..16261">pref_match'</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_12468..12479"><span>pref_match'</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="free"><span>M</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_16110..16120"><span>pref_match</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_12582..12597"><span>pref_match'_iff</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_16047..16048"><span>A</span></a><span class="main"><span>]</span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>blast</span></span><span>
  </span><span class="keyword1"><span class="command"><span>let</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?A</span></span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>A</span></span><span class="main"><span>[</span></span><span class="free"><span>a'</span></span><span> </span><span class="main"><span>:=</span></span><span> </span><span class="free"><span>A</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span class="free"><span>a'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>]</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>let</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?M</span></span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="main"><span>{</span></span><span class="free"><span>a'</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.union|const"><span>âª</span></a></span><span> </span><span class="main"><span>{</span></span><span class="free"><span>a</span></span><span class="main"><span>}</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_16391..16397">neq_a'</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>â</span></a></span><span class="bound"><span>x</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>.</span></a></span><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>â</span></a></span><span> </span><span class="var"><span>?M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>â¶</span></a></span><span> </span><span class="free"><span>a'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>â </span></a></span><span> </span><span class="bound"><span>x</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>â¹</span><span class="free"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>â </span></a></span><span> </span><span class="free"><span>a'</span></span><span>âº</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>blast</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>â¹</span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.set|const"><span>set</span></a><span> </span><span class="var"><span>?A</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>â</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span>âº</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span class="main"><span>(</span></span><span class="operator"><span>rule</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.set_update_subsetI|fact"><span>set_update_subsetI</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_16047..16048"><span>A</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>THEN</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conjunct2|fact"><span>conjunct2</span></a><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_7212..7224"><span>more_choices</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> _ </span><a class="entity_ref" href="Gale_Shapley1.html#offset_16061..16062"><span>M</span></a><span> </span><span class="quoted"><span class="quoted"><span>â¹</span><span class="free"><span>M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>â </span></a></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span>âº</span></span></span><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_16047..16048"><span>A</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_16080..16083"><span>inj</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_16250..16261"><span>pref_match'</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_15907..15909"><span>a'</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subsetD|fact"><span>subsetD</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_16061..16062"><span>M</span></a><span class="main"><span>,</span></span><span> </span><span class="operator"><span>of</span></span><span> </span><span class="quoted"><span class="free"><span>a'</span></span></span><span class="main"><span>]</span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span class="main"><span>(</span></span><span class="operator"><span>fastforce</span></span><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_12457..12467"><span>pref_match'_def</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>hence</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_2486..2488"><span>wf</span></a><span> </span><span class="var"><span>?A</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_16047..16048"><span>A</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>moreover</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.inj_on|const"><span>inj_on</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="var"><span>?A</span></span><span class="main"><span>)</span></span><span> </span><span class="var"><span>?M</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_15884..15885"><span>a</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_15907..15909"><span>a'</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_16080..16083"><span>inj</span></a><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5402..5412"><span>match_def</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.inj_on_def|fact"><span>inj_on_def</span></a><span class="main"><span>)</span></span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.Diff_iff|fact"><span>Diff_iff</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.insert_iff|fact"><span>insert_iff</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth_list_update_neq|fact"><span>nth_list_update_neq</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>moreover</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_12468..12479"><span>pref_match'</span></a><span> </span><span class="var"><span>?A</span></span><span> </span><span class="var"><span>?M</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_15884..15885"><span>a</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_15907..15909"><span>a'</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_16250..16261"><span>pref_match'</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_16047..16048"><span>A</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_15949..15953"><span>pref</span></a><span> </span><span class="quoted"><span class="quoted"><span>â¹</span><span class="free"><span>a'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>n</span></span><span>âº</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_12457..12467"><span>pref_match'_def</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5574..5587"><span>match_upd_neq</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_16391..16397"><span>neq_a'</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.Ball_def|fact"><span>Ball_def</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.Bex_def|fact"><span>Bex_def</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image_iff|fact"><span>image_iff</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.imp_ex|fact"><span>imp_ex</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth_list_update|fact"><span>nth_list_update</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.less_Suc_eq|fact"><span>less_Suc_eq</span></a><span>
            </span><span class="quasi_keyword"><span>flip</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5402..5412"><span>match_def</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.prefers_trans|fact"><span>prefers_trans</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>moreover</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_13003..13009"><span>opti<span class="hidden">â©</span><sub>a</sub></span></a><span> </span><span class="var"><span>?A</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_13781..13791"><span>opti<span class="hidden">â©</span><sub>a</sub>_inv</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_16047..16048"><span>A</span></a><span> </span><span class="quoted"><span class="quoted"><span>â¹</span><span class="free"><span>a'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>n</span></span><span>âº</span></span></span><span> _ _ _ </span><span class="quoted"><span class="quoted"><span>â¹</span><a class="entity_ref" href="Gale_Shapley1.html#offset_13003..13009"><span>opti<span class="hidden">â©</span><sub>a</sub></span></a><span> </span><span class="free"><span>A</span></span><span>âº</span></span></span><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_15884..15885"><span>a</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_15907..15909"><span>a'</span></a><span class="main"><span>[</span></span><span class="operator"><span>THEN</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conjunct2|fact"><span>conjunct2</span></a><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_15949..15953"><span>pref</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>auto</span></span><span>
  </span><span class="keyword1"><span class="command"><span>ultimately</span></span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_15884..15885"><span>a</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_15907..15909"><span>a'</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_16061..16062"><span>M</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_12582..12597"><span>pref_match'_iff</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>auto</span></span><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Gale_Shapley1.Pref.invAM_next|fact"><span class="entity_def" id="Gale_Shapley1.Pref.invAM_next|thm"><span class="entity_def" id="offset_17259..17269">invAM_next</span></span></span><span class="main"><span>:</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_15620..15625"><span>invAM</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="free"><span>M</span></span><span>"</span></span></span><span>
</span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_17299..17300">a</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><span class="free"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.not_member|const"><span>â</span></a></span><span> </span><span class="free"><span>M</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity_def" id="offset_17322..17324">a'</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>a'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>â</span></a></span><span> </span><span class="free"><span>M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="free"><span>a'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="free"><span>a</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity_def" id="offset_17364..17368">pref</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>Â¬</span></a></span><span> </span><span class="free"><span>P<span class="hidden">â©</span><sub>b</sub></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="free"><span>a'</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.prefa|const"><span>â¢</span></a></span><span> </span><span class="free"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.prefa|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>a'</span></span><span>"</span></span></span><span>
</span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_15620..15625"><span>invAM</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>A</span></span><span class="main"><span>[</span></span><span class="free"><span>a</span></span><span> </span><span class="main"><span>:=</span></span><span> </span><span class="free"><span>A</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span class="free"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>M</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_17449..17450">A</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_2486..2488"><span>wf</span></a><span> </span><span class="free"><span>A</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity_def" id="offset_17463..17464">M</span><span> </span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>â</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity_def" id="offset_17482..17485">inj</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.inj_on|const"><span>inj_on</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="free"><span>A</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>M</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity_def" id="offset_17512..17522">pref_match</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_12339..12349"><span>pref_match</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="free"><span>M</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity_def" id="offset_17547..17553">opti<span class="hidden">â©</span><sub>a</sub></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_13003..13009"><span>opti<span class="hidden">â©</span><sub>a</sub></span></a><span> </span><span class="free"><span>A</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>a'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>n</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span class="main"><span>(</span></span><span class="operator"><span>insert</span></span><span> </span><span class="quoted"><span class="quoted"><span>â¹</span><a class="entity_ref" href="Gale_Shapley1.html#offset_15620..15625"><span>invAM</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="free"><span>M</span></span><span>âº</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_17322..17324"><span>a'</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>auto</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>hence</span></span></span><span> </span><span class="entity_def" id="offset_17624..17629">pref'</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>P<span class="hidden">â©</span><sub>b</sub></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="free"><span>a'</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.prefa|const"><span>â¢</span></a></span><span> </span><span class="free"><span>a'</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.prefa|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>a</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_17364..17368"><span>pref</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_17299..17300"><span>a</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_17322..17324"><span>a'</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_2408..2415"><span>P<span class="hidden">â©</span><sub>b</sub>_set</span></a><span> </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.prefers_def|fact"><span>prefers_def</span></a><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5402..5412"><span>match_def</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5452..5464"><span>match_less_n</span></a><span> </span><a class="entity_ref" href="../List-Index/List_Index.html#List_Index.index_eq_index_conv|fact"><span>index_eq_index_conv</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.linorder_less_linear|fact"><span>linorder_less_linear</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subsetD|fact"><span>subsetD</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>â </span></a></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_17299..17300"><span>a</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>fastforce</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_17842..17847">neq_a</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>â</span></a></span><span class="bound"><span>x</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>.</span></a></span><span> </span><span class="bound"><span>x</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>â</span></a></span><span> </span><span class="free"><span>M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>â¶</span></a></span><span> </span><span class="free"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>â </span></a></span><span> </span><span class="bound"><span>x</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_17299..17300"><span>a</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>blast</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_17892..17903">pref_match'</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_12468..12479"><span>pref_match'</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="free"><span>M</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_17512..17522"><span>pref_match</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_12582..12597"><span>pref_match'_iff</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_17449..17450"><span>A</span></a><span class="main"><span>,</span></span><span class="operator"><span>of</span></span><span> </span><span class="quoted"><span class="free"><span>M</span></span></span><span class="main"><span>]</span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>blast</span></span><span>
  </span><span class="keyword1"><span class="command"><span>hence</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>â</span></span><span class="bound"><span class="bound"><span>a</span></span></span><span class="main"><span>&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_6050..6059"><span>preferred</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>â</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span> </span><span class="free"><span>M</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_12457..12467"><span>pref_match'_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>blast</span></span><span>
  </span><span class="keyword1"><span class="command"><span>hence</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>A</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span class="free"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>n</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_7212..7224"><span>more_choices</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> _ </span><a class="entity_ref" href="Gale_Shapley1.html#offset_17463..17464"><span>M</span></a><span> </span><span class="quoted"><span class="quoted"><span>â¹</span><span class="free"><span>M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>â </span></a></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span>âº</span></span></span><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_17449..17450"><span>A</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_17482..17485"><span>inj</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_17299..17300"><span>a</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_17322..17324"><span>a'</span></a><span> </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_6107..6117"><span>matching_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>no_types</span><span class="main"><span class="main"><span>,</span></span></span><span> lifting</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.imageI|fact"><span>imageI</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>let</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?A</span></span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>A</span></span><span class="main"><span>[</span></span><span class="free"><span>a</span></span><span> </span><span class="main"><span>:=</span></span><span> </span><span class="free"><span>A</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span class="free"><span>a</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>]</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_2486..2488"><span>wf</span></a><span> </span><span class="var"><span>?A</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_17449..17450"><span>A</span></a><span> </span><span class="quoted"><span class="quoted"><span>â¹</span><span class="free"><span>A</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span class="free"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>n</span></span><span>âº</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.set_update_subsetI|fact"><span>set_update_subsetI</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>moreover</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.inj_on|const"><span>inj_on</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="var"><span>?A</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>M</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_17299..17300"><span>a</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_17482..17485"><span>inj</span></a><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5402..5412"><span>match_def</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.inj_on_def|fact"><span>inj_on_def</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth_list_update_neq|fact"><span>nth_list_update_neq</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>moreover</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_12468..12479"><span>pref_match'</span></a><span> </span><span class="var"><span>?A</span></span><span> </span><span class="free"><span>M</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_17299..17300"><span>a</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_17892..17903"><span>pref_match'</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_17624..17629"><span>pref'</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_17449..17450"><span>A</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_17322..17324"><span>a'</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_17842..17847"><span>neq_a</span></a><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span class="main"><span>(</span></span><span class="operator"><span>auto</span></span><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5574..5587"><span>match_upd_neq</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_12457..12467"><span>pref_match'_def</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.Ball_def|fact"><span>Ball_def</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.Bex_def|fact"><span>Bex_def</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image_iff|fact"><span>image_iff</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth_list_update|fact"><span>nth_list_update</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.imp_ex|fact"><span>imp_ex</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.less_Suc_eq|fact"><span>less_Suc_eq</span></a><span>
            </span><span class="quasi_keyword"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>flip</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5402..5412"><span>match_def</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>moreover</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span>  </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_13003..13009"><span>opti<span class="hidden">â©</span><sub>a</sub></span></a><span> </span><span class="var"><span>?A</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_13781..13791"><span>opti<span class="hidden">â©</span><sub>a</sub>_inv</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_17449..17450"><span>A</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conjunct1|fact"><span>conjunct1</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_17299..17300"><span>a</span></a><span class="main"><span class="main"><span>]</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>â¹</span><span class="free"><span>a'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>n</span></span><span>âº</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conjunct2|fact"><span>conjunct2</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_17322..17324"><span>a'</span></a><span class="main"><span class="main"><span>]</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_17624..17629"><span>pref'</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_17547..17553"><span>opti<span class="hidden">â©</span><sub>a</sub></span></a><span class="main"><span>]</span></span><span> </span><span class="keyword1"><span class="command"><span>.</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>ultimately</span></span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_17463..17464"><span>M</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_12582..12597"><span>pref_match'_iff</span></a><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>


</span><span class="keyword1"><span class="command"><span>subsection</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>â¹</span><span>Algorithm 1</span><span>âº</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Gale_Shapley1.Pref.Gale_Shapley1|fact"><span class="entity_def" id="Gale_Shapley1.Pref.Gale_Shapley1|thm"><span>Gale_Shapley1</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="keyword1"><span>VARS</span></span><span> </span><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span>M</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span> </span><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span>A</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span> </span><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span>a</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span> </span><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span>a'</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span>
 </span><span class="main"><span>[</span></span><span class="bound"><span>M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.empty|const"><span>{}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><span class="bound"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.replicate|const"><span>replicate</span></a><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>]</span></span><span>
 </span><span class="keyword1"><span>WHILE</span></span><span> </span><span class="bound"><span>M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>â </span></a></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span>
 </span><span class="keyword1"><span>INV</span></span><span> </span><span class="main"><span>{</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_15620..15625"><span>invAM</span></a><span> </span><span class="bound"><span>A</span></span><span> </span><span class="bound"><span>M</span></span><span> </span><span class="main"><span>}</span></span><span>
 </span><span class="keyword1"><span>VAR</span></span><span> </span><span class="main"><span>{</span></span><a class="entity_ref" href="Gale_Shapley1.html#offset_4580..4583"><span>var</span></a><span> </span><span class="bound"><span>A</span></span><span> </span><span class="bound"><span>M</span></span><span class="main"><span>}</span></span><span>
 </span><span class="keyword1"><span>DO</span></span><span> a </span><span class="main"><span>:=</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span>SOME</span></span><span> </span><span class="bound"><span>a</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.not_member|const"><span>â</span></a></span><span> </span><span class="bound"><span>M</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword1"><span>IF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="bound"><span>A</span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.not_member|const"><span>â</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="bound"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span> </span><span class="bound"><span>M</span></span><span>
  </span><span class="keyword1"><span>THEN</span></span><span> M </span><span class="main"><span>:=</span></span><span> </span><span class="bound"><span>M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.union|const"><span>âª</span></a></span><span> </span><span class="main"><span>{</span></span><span class="bound"><span>a</span></span><span class="main"><span>}</span></span><span>
  </span><span class="keyword1"><span>ELSE</span></span><span> a' </span><span class="main"><span>:=</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span>SOME</span></span><span> </span><span class="bound"><span>a'</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>a'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>â</span></a></span><span> </span><span class="bound"><span>M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="bound"><span>A</span></span><span> </span><span class="bound"><span>a'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="bound"><span>A</span></span><span> </span><span class="bound"><span>a</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
       </span><span class="keyword1"><span>IF</span></span><span> </span><span class="free"><span>P<span class="hidden">â©</span><sub>b</sub></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="bound"><span>A</span></span><span> </span><span class="bound"><span>a'</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.prefa|const"><span>â¢</span></a></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.prefa|const"><span>&lt;</span></a></span><span> </span><span class="bound"><span>a'</span></span><span>
       </span><span class="keyword1"><span>THEN</span></span><span> </span><span class="bound"><span>A</span></span><span class="main"><span>[</span></span><span class="bound"><span>a'</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>:=</span></span><span> </span><span class="bound"><span>A</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span class="bound"><span>a'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>;</span></span><span> M </span><span class="main"><span>:=</span></span><span> </span><span class="bound"><span>M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="main"><span>{</span></span><span class="bound"><span>a'</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.union|const"><span>âª</span></a></span><span> </span><span class="main"><span>{</span></span><span class="bound"><span>a</span></span><span class="main"><span>}</span></span><span>
       </span><span class="keyword1"><span>ELSE</span></span><span> </span><span class="bound"><span>A</span></span><span class="main"><span>[</span></span><span class="bound"><span>a</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>:=</span></span><span> </span><span class="bound"><span>A</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span class="bound"><span>a</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span>
       </span><span class="keyword1"><span>FI</span></span><span>
  </span><span class="keyword1"><span>FI</span></span><span> 
 </span><span class="keyword1"><span>OD</span></span><span>
 </span><span class="main"><span>[</span></span><a class="entity_ref" href="Gale_Shapley1.html#offset_6118..6126"><span>matching</span></a><span> </span><span class="bound"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5827..5833"><span>stable</span></a><span> </span><span class="bound"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_13003..13009"><span>opti<span class="hidden">â©</span><sub>a</sub></span></a><span> </span><span class="bound"><span>A</span></span><span class="main"><span>]</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL-Hoare/Hoare_Logic.html#Hoare_Logic.vcg_tc|method"><span class="operator"><span>vcg_tc</span></span></a><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>goal_cases</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>1</span><span> </span><span class="keyword3"><span class="command"><span>thus</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span>
   </span><span class="keyword1"><span class="command"><span>by</span></span></span><span class="main"><span>(</span></span><span class="operator"><span>auto</span></span><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5816..5826"><span>stable_def</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_12992..13002"><span>opti<span class="hidden">â©</span><sub>a</sub>_def</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_12328..12338"><span>pref_match_def</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_2342..2349"><span>P<span class="hidden">â©</span><sub>a</sub>_set</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.card_distinct|fact"><span>card_distinct</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5402..5412"><span>match_def</span></a><span> </span><a class="entity_ref" href="../List-Index/List_Index.html#List_Index.index_nth_id|fact"><span>index_nth_id</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.prefers_def|fact"><span>prefers_def</span></a><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
  </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>3</span><span> </span><span class="keyword3"><span class="command"><span>thus</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_15395..15412"><span>pref_match_stable</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>auto</span></span><span>
</span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
  </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span class="main"><span>(</span></span><span>2</span><span> </span><span class="skolem"><span>v</span></span><span> </span><span class="skolem"><span>M</span></span><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="skolem"><span>a</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>hence</span></span></span><span> </span><span class="entity_def" id="offset_19509..19514">invAM</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_15620..15625"><span>invAM</span></a><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="skolem"><span>M</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity_def" id="offset_19532..19533">m</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_6118..6126"><span>matching</span></a><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="skolem"><span>M</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity_def" id="offset_19554..19555">M</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>â</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>â </span></a></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity_def" id="offset_19587..19597">pref_match</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_12339..12349"><span>pref_match</span></a><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="skolem"><span>M</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_13003..13009"><span>opti<span class="hidden">â©</span><sub>a</sub></span></a><span> </span><span class="skolem"><span>A</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity_def" id="offset_19635..19636">v</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_4580..4583"><span>var</span></a><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="skolem"><span>M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="skolem"><span>v</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>auto</span></span><span>
  </span><span class="keyword1"><span class="command"><span>note</span></span></span><span> </span><span class="entity_def" id="offset_19667..19671">Ainj</span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.conj12|fact"><span>conj12</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_19532..19533"><a class="entity_ref" href="Gale_Shapley1.html#offset_19532..19533"><span>m</span></a></a><span class="main"><span class="main"><span class="main"><span>[</span></span></span></span><span class="operator"><span class="operator"><span>unfolded</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_6107..6117"><a class="entity_ref" href="Gale_Shapley1.html#offset_6107..6117"><span>matching_def</span></a></a><span class="main"><span class="main"><span class="main"><span>]</span></span></span></span><span class="main"><span>]</span></span><span>
  </span><span class="keyword1"><span class="command"><span>note</span></span></span><span> </span><span>pref_match'</span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_19587..19597"><span>pref_match</span></a><span class="main"><span>[</span></span><span class="operator"><span>THEN</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_12582..12597"><span>pref_match'_iff</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_19667..19671"><span>Ainj</span></a><span class="main"><span class="main"><span>(</span></span></span><span>1</span><span class="main"><span class="main"><span>)</span></span></span><span class="main"><span class="main"><span>,</span></span></span><span> </span><span class="operator"><span>THEN</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.iffD2|fact"><span>iffD2</span></a><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>]</span></span><span>
  </span><span class="keyword1"><span class="command"><span>hence</span></span></span><span> </span><span class="entity_def" id="offset_19796..19807">pref_match1</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>â</span></span><span class="bound"><span class="bound"><span>a</span></span></span><span class="main"><span>&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_6050..6059"><span>preferred</span></a><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>â</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span> </span><span class="skolem"><span>M</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_12457..12467"><span>pref_match'_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>blast</span></span><span>
  </span><span class="keyword3"><span class="command"><span class="entity_def" id="offset_19882..19888">define</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>a</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span>SOME</span></span><span> </span><span class="bound"><span>a</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.not_member|const"><span>â</span></a></span><span> </span><span class="skolem"><span>M</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_19934..19935">a</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><span class="skolem"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.not_member|const"><span>â</span></a></span><span> </span><span class="skolem"><span>M</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_19882..19888"><span>a_def</span></a><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_19554..19555"><span>M</span></a><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>no_types</span><span class="main"><span class="main"><span>,</span></span></span><span> lifting</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set_Interval.html#Set_Interval.ord_class.atLeastLessThan_iff|fact"><span>atLeastLessThan_iff</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Hilbert_Choice.html#Hilbert_Choice.someI_ex|fact"><span>someI_ex</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subsetI|fact"><span>subsetI</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_antisym|fact"><span>subset_antisym</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>is</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="var"><span>?P</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="keyword1"><span>SOME</span></span><span> </span><span class="bound"><span>a</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.not_member|const"><span>â</span></a></span><span> </span><span class="skolem"><span>M</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_19882..19888"><span>a_def</span></a><span class="main"><span>[</span></span><span class="operator"><span>symmetric</span></span><span class="main"><span>]</span></span><span>
  </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>
    </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="var"><span>?P</span></span><span> </span><span class="skolem"><span>a</span></span><span>"</span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>is</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="var"><span>?not_matched</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>â¶</span></a></span><span> </span><span class="var"><span>?THEN</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>Â¬</span></a></span><span> </span><span class="var"><span>?not_matched</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>â¶</span></a></span><span> </span><span class="var"><span>?ELSE</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>rule</span></span><span class="main"><span class="keyword3"><span>;</span></span></span><span> </span><span class="operator"><span>rule</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword3"><span class="command"><span>assume</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?not_matched</span></span></span></span><span>
      </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?THEN</span></span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>only</span></span><span class="main"><span class="main"><span>:</span></span></span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.mem_Collect_eq|fact"><span>mem_Collect_eq</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.case|fact"><span>prod.case</span></a><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>rule</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conjI|fact"><span>conjI</span></a><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>goal_cases</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>1</span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_15715..15726"><span>invAM_match</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_19509..19514"><span>invAM</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_19934..19935"><span>a</span></a><span> </span><span class="quoted"><span class="quoted"><span>â¹</span><span class="var"><span>?not_matched</span></span><span>âº</span></span></span><span class="main"><span>]</span></span><span> </span><span class="keyword1"><span class="command"><span>.</span></span></span><span>

        </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>2</span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span>
          </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_10671..10680"><span>var_match</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_19532..19533"><span>m</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_19554..19555"><span>M</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_19796..19807"><span>pref_match1</span></a><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_3233..3243"><span>var0_match</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_19667..19671"><span>Ainj</span></a><span class="main"><span class="main"><span>(</span></span></span><span>1</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_19554..19555"><span>M</span></a><span class="main"><span class="main"><span>(</span></span></span><span>1</span><span class="main"><span class="main"><span>)</span></span></span><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_19934..19935"><span>a</span></a><span> </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_19635..19636"><span>v</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>blast</span></span><span>
      </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
      </span><span class="keyword3"><span class="command"><span>assume</span></span></span><span> </span><span class="entity_def" id="offset_20589..20596">matched</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>Â¬</span></a></span><span> </span><span class="var"><span>?not_matched</span></span><span>"</span></span></span><span>
      </span><span class="keyword3"><span class="command"><span class="entity_def" id="offset_20621..20627">define</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>a'</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>a'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span>SOME</span></span><span> </span><span class="bound"><span>a'</span></span><span class="main"><span>.</span></span><span>  </span><span class="bound"><span>a'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>â</span></a></span><span> </span><span class="skolem"><span>M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="bound"><span>a'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="skolem"><span>a</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_20699..20701">a'</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>a'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>â</span></a></span><span> </span><span class="skolem"><span>M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="skolem"><span>a'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="skolem"><span>a</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_20621..20627"><span>a'_def</span></a><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_20589..20596"><span>matched</span></a><span>
        </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>smt</span></span><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>verit</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image_iff|fact"><span>image_iff</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Hilbert_Choice.html#Hilbert_Choice.someI_ex|fact"><span>someI_ex</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span>hence</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>a'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>n</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>â </span></a></span><span> </span><span class="skolem"><span>a'</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_19934..19935"><span>a</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_19554..19555"><span>M</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Set_Interval.html#Set_Interval.atLeast0LessThan|fact"><span>atLeast0LessThan</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>auto</span></span><span>
      </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?ELSE</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>is</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="var"><span>?P</span></span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="keyword1"><span>SOME</span></span><span> </span><span class="bound"><span>a'</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>a'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>â</span></a></span><span> </span><span class="skolem"><span>M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="bound"><span>a'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="skolem"><span>a</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_20621..20627"><span>a'_def</span></a><span class="main"><span>[</span></span><span class="operator"><span>symmetric</span></span><span class="main"><span>]</span></span><span>
      </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>
        </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="var"><span>?P</span></span><span> </span><span class="skolem"><span>a'</span></span><span>"</span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>is</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="var"><span>?pref</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>â¶</span></a></span><span> </span><span class="var"><span>?THEN</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>Â¬</span></a></span><span> </span><span class="var"><span>?pref</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>â¶</span></a></span><span> </span><span class="var"><span>?ELSE</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>rule</span></span><span class="main"><span class="keyword3"><span>;</span></span></span><span> </span><span class="operator"><span>rule</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword3"><span class="command"><span>assume</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?pref</span></span></span></span><span>
          </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?THEN</span></span></span></span><span>
          </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>only</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.mem_Collect_eq|fact"><span>mem_Collect_eq</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.case|fact"><span>prod.case</span></a><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>rule</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conjI|fact"><span>conjI</span></a><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>goal_cases</span></span><span class="main"><span>)</span></span><span>
            </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>1</span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span class="main"><span>(</span></span><span class="operator"><span>rule</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_15844..15854"><span>invAM_swap</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_19509..19514"><span>invAM</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_19934..19935"><span>a</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_20699..20701"><span>a'</span></a><span> </span><span class="quoted"><span class="quoted"><span>â¹</span><span class="var"><span>?pref</span></span><span>âº</span></span></span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>

            </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>2</span><span>
            </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Finite_Set.html#Finite_Set.card|const"><span>card</span></a><span class="main"><span>(</span></span><span class="skolem"><span>M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="main"><span>{</span></span><span class="skolem"><span>a'</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.union|const"><span>âª</span></a></span><span> </span><span class="main"><span>{</span></span><span class="skolem"><span>a</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Finite_Set.html#Finite_Set.card|const"><span>card</span></a><span> </span><span class="skolem"><span>M</span></span><span>"</span></span></span><span>
              </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_19934..19935"><span>a</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_20699..20701"><span>a'</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Finite_Set.html#Finite_Set.card.remove|fact"><span>card.remove</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Set_Interval.html#Set_Interval.subset_eq_atLeast0_lessThan_finite|fact"><span>subset_eq_atLeast0_lessThan_finite</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_19554..19555"><span>M</span></a><span class="main"><span class="main"><span>(</span></span></span><span>1</span><span class="main"><span class="main"><span>)</span></span></span><span class="main"><span>]</span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>fastforce</span></span><span>
            </span><span class="keyword3"><span class="command"><span>thus</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_19635..19636"><span>v</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_11417..11425"><span>var_next</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_19532..19533"><span>m</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_19554..19555"><span>M</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_19796..19807"><span>pref_match1</span></a><span> </span><span class="quoted"><span class="quoted"><span>â¹</span><span class="skolem"><span>a'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>n</span></span><span>âº</span></span></span><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_3602..3611"><span>var0_next</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_19667..19671"><span>Ainj</span></a><span class="main"><span class="main"><span>(</span></span></span><span>1</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_19554..19555"><span>M</span></a><span> </span><span class="quoted"><span class="quoted"><span>â¹</span><span class="skolem"><span>a'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>n</span></span><span>âº</span></span></span><span class="main"><span>]</span></span><span>
              </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
          </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>
        </span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
          </span><span class="keyword3"><span class="command"><span>assume</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>Â¬</span></a></span><span> </span><span class="var"><span>?pref</span></span><span>"</span></span></span><span>
          </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?ELSE</span></span></span></span><span>
          </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>only</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.mem_Collect_eq|fact"><span>mem_Collect_eq</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.case|fact"><span>prod.case</span></a><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>rule</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conjI|fact"><span>conjI</span></a><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>goal_cases</span></span><span class="main"><span>)</span></span><span>
            </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>1</span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_17259..17269"><span>invAM_next</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_19509..19514"><span>invAM</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_19934..19935"><span>a</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_20699..20701"><span>a'</span></a><span> </span><span class="quoted"><span class="quoted"><span>â¹</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>Â¬</span></a></span><span> </span><span class="var"><span>?pref</span></span><span>âº</span></span></span><span class="main"><span>]</span></span><span> </span><span class="keyword1"><span class="command"><span>.</span></span></span><span>

            </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>2</span><span>
            </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_19934..19935"><span>a</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_19635..19636"><span>v</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_11417..11425"><span>var_next</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_19532..19533"><span>m</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_19554..19555"><span>M</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_19796..19807"><span>pref_match1</span></a><span class="main"><span>,</span></span><span> </span><span class="operator"><span>of</span></span><span> </span><span class="quoted"><span class="skolem"><span>a</span></span></span><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_3602..3611"><span>var0_next</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_19667..19671"><span>Ainj</span></a><span class="main"><span class="main"><span>(</span></span></span><span>1</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_19554..19555"><span>M</span></a><span class="main"><span>,</span></span><span> </span><span class="operator"><span>of</span></span><span> </span><span class="quoted"><span class="skolem"><span>a</span></span></span><span class="main"><span>]</span></span><span>
              </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
          </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>
        </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>â¹</span><span>Proof also works for </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>const</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_3133..3137"><span>var0</span></a><span class="antiquote"><span>}</span></span></span><span> instead of </span><span class="antiquoted"><span class="antiquote"><span>@{</span></span><span class="operator"><span>const</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_4580..4583"><span>var</span></a><span class="antiquote"><span>}</span></span></span><span>.</span><span>âº</span></span></span><span>


</span><span class="keyword1"><span class="command"><span>subsection</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>â¹</span><span>Algorithm 2: List of unmatched As</span><span>âº</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>abbreviation</span></span></span><span> </span><span class="entity"><span class="entity_def" id="Gale_Shapley1.Pref.invas|const"><span class="entity_def" id="offset_22115..22120">invas</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
</span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>invas</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>as</span></span></span></span><span> </span><span class="main"><span>==</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.set|const"><span>set</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>as</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>â</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.distinct|const"><span>distinct</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>as</span></span></span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Gale_Shapley1.Pref.Gale_Shapley2|fact"><span class="entity_def" id="Gale_Shapley1.Pref.Gale_Shapley2|thm"><span>Gale_Shapley2</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="keyword1"><span>VARS</span></span><span> </span><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span>A</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span> </span><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span>a</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span> </span><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span>a'</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span> </span><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span>as</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span>
 </span><span class="main"><span>[</span></span><span class="bound"><span>as</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.upt|const"><span>[</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.upt|const"><span>..&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.upt|const"><span>]</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><span class="bound"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.replicate|const"><span>replicate</span></a><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>]</span></span><span>
 </span><span class="keyword1"><span>WHILE</span></span><span> </span><span class="bound"><span>as</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>â </span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.Nil|const"><span>[]</span></a></span><span>
 </span><span class="keyword1"><span>INV</span></span><span> </span><span class="main"><span>{</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_15620..15625"><span>invAM</span></a><span> </span><span class="bound"><span>A</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.set|const"><span>set</span></a><span> </span><span class="bound"><span>as</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_22115..22120"><span>invas</span></a><span> </span><span class="bound"><span>as</span></span><span class="main"><span>}</span></span><span>
 </span><span class="keyword1"><span>VAR</span></span><span> </span><span class="main"><span>{</span></span><a class="entity_ref" href="Gale_Shapley1.html#offset_4580..4583"><span>var</span></a><span> </span><span class="bound"><span>A</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.set|const"><span>set</span></a><span> </span><span class="bound"><span>as</span></span><span class="main"><span>)</span></span><span class="main"><span>}</span></span><span>
 </span><span class="keyword1"><span>DO</span></span><span> a </span><span class="main"><span>:=</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.hd|const"><span>hd</span></a><span> </span><span class="bound"><span>as</span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword1"><span>IF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="bound"><span>A</span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.not_member|const"><span>â</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="bound"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.set|const"><span>set</span></a><span> </span><span class="bound"><span>as</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span>THEN</span></span><span> as </span><span class="main"><span>:=</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.tl|const"><span>tl</span></a><span> </span><span class="bound"><span>as</span></span><span>
  </span><span class="keyword1"><span>ELSE</span></span><span> a' </span><span class="main"><span>:=</span></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span>SOME</span></span><span> </span><span class="bound"><span>a'</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>a'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>â</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.set|const"><span>set</span></a><span> </span><span class="bound"><span>as</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="bound"><span>A</span></span><span> </span><span class="bound"><span>a'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="bound"><span>A</span></span><span> </span><span class="bound"><span>a</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
       </span><span class="keyword1"><span>IF</span></span><span> </span><span class="free"><span>P<span class="hidden">â©</span><sub>b</sub></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="bound"><span>A</span></span><span> </span><span class="bound"><span>a'</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.prefa|const"><span>â¢</span></a></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.prefa|const"><span>&lt;</span></a></span><span> </span><span class="bound"><span>a'</span></span><span>
       </span><span class="keyword1"><span>THEN</span></span><span> </span><span class="bound"><span>A</span></span><span class="main"><span>[</span></span><span class="bound"><span>a'</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>:=</span></span><span> </span><span class="bound"><span>A</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span class="bound"><span>a'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>;</span></span><span> as </span><span class="main"><span>:=</span></span><span> </span><span class="bound"><span>a'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.Cons|const"><span>#</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.tl|const"><span>tl</span></a><span> </span><span class="bound"><span>as</span></span><span>
       </span><span class="keyword1"><span>ELSE</span></span><span> </span><span class="bound"><span>A</span></span><span class="main"><span>[</span></span><span class="bound"><span>a</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>:=</span></span><span> </span><span class="bound"><span>A</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span class="bound"><span>a</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span>
       </span><span class="keyword1"><span>FI</span></span><span>
  </span><span class="keyword1"><span>FI</span></span><span> 
 </span><span class="keyword1"><span>OD</span></span><span>
 </span><span class="main"><span>[</span></span><a class="entity_ref" href="Gale_Shapley1.html#offset_6118..6126"><span>matching</span></a><span> </span><span class="bound"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5827..5833"><span>stable</span></a><span> </span><span class="bound"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_13003..13009"><span>opti<span class="hidden">â©</span><sub>a</sub></span></a><span> </span><span class="bound"><span>A</span></span><span class="main"><span>]</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL-Hoare/Hoare_Logic.html#Hoare_Logic.vcg_tc|method"><span class="operator"><span>vcg_tc</span></span></a><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>goal_cases</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>1</span><span> </span><span class="keyword3"><span class="command"><span>thus</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span>
   </span><span class="keyword1"><span class="command"><span>by</span></span></span><span class="main"><span>(</span></span><span class="operator"><span>auto</span></span><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5816..5826"><span>stable_def</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_12992..13002"><span>opti<span class="hidden">â©</span><sub>a</sub>_def</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_12328..12338"><span>pref_match_def</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_2342..2349"><span>P<span class="hidden">â©</span><sub>a</sub>_set</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.card_distinct|fact"><span>card_distinct</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5402..5412"><span>match_def</span></a><span> </span><a class="entity_ref" href="../List-Index/List_Index.html#List_Index.index_nth_id|fact"><span>index_nth_id</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.prefers_def|fact"><span>prefers_def</span></a><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
  </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>3</span><span> </span><span class="keyword3"><span class="command"><span>thus</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_15395..15412"><span>pref_match_stable</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>auto</span></span><span>
</span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
  </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity_def" id="offset_22883..22884">2</span><span> </span><span class="skolem"><span>v</span></span><span> </span><span class="skolem"><span>A</span></span><span> _ </span><span class="skolem"><span>a'</span></span><span> </span><span class="skolem"><span>as</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>let</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?M</span></span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.set|const"><span>set</span></a><span> </span><span class="skolem"><span>as</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_15620..15625"><span>invAM</span></a><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="var"><span>?M</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity_def" id="offset_22949..22950">m</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_6118..6126"><span>matching</span></a><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="var"><span>?M</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity_def" id="offset_22972..22973">A</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_2486..2488"><span>wf</span></a><span> </span><span class="skolem"><span>A</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity_def" id="offset_22986..22987">M</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="var"><span>?M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>â</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity_def" id="offset_23009..23019">pref_match</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_12339..12349"><span>pref_match</span></a><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="var"><span>?M</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_13003..13009"><span>opti<span class="hidden">â©</span><sub>a</sub></span></a><span> </span><span class="skolem"><span>A</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>as</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>â </span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.Nil|const"><span>[]</span></a></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity_def" id="offset_23072..23073">v</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_4580..4583"><span>var</span></a><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="var"><span>?M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="skolem"><span>v</span></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity_def" id="offset_23098..23100">as</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_22115..22120"><span>invas</span></a><span> </span><span class="skolem"><span>as</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_22883..22884"><span>2</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>auto</span></span><span>
  </span><span class="keyword1"><span class="command"><span>note</span></span></span><span> </span><span>pref_match'</span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_23009..23019"><span>pref_match</span></a><span class="main"><span>[</span></span><span class="operator"><span>THEN</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_12582..12597"><span>pref_match'_iff</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_22972..22973"><span>A</span></a><span class="main"><span class="main"><span>,</span></span></span><span> </span><span class="operator"><span>THEN</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.iffD2|fact"><span>iffD2</span></a><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>]</span></span><span>
  </span><span class="keyword1"><span class="command"><span>hence</span></span></span><span> </span><span class="entity_def" id="offset_23209..23220">pref_match1</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>â</span></span><span class="bound"><span class="bound"><span>a</span></span></span><span class="main"><span>&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_6050..6059"><span>preferred</span></a><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>â</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span> </span><span class="var"><span>?M</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_12457..12467"><span>pref_match'_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>blast</span></span><span>
  </span><span class="keyword1"><span class="command"><span>from</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>â¹</span><span class="skolem"><span>as</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>â </span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.Nil|const"><span>[]</span></a></span><span>âº</span></span></span><span> </span><span class="keyword3"><span class="command"><span>obtain</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>a</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>as'</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="entity_def" id="offset_23330..23334">aseq</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>as</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="skolem"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.Cons|const"><span>#</span></a></span><span> </span><span class="skolem"><span>as'</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>fastforce</span></span><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.neq_Nil_conv|fact"><span>neq_Nil_conv</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_23392..23398">set_as</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="var"><span>?M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.union|const"><span>âª</span></a></span><span> </span><span class="main"><span>{</span></span><span class="skolem"><span>a</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.set|const"><span>set</span></a><span> </span><span class="skolem"><span>as'</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_23098..23100"><span>as</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_23330..23334"><span>aseq</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>force</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_23458..23459">a</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><span class="skolem"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.not_member|const"><span>â</span></a></span><span> </span><span class="var"><span>?M</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_23098..23100"><span>as</span></a><span> </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_23330..23334"><span>aseq</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>only</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_23330..23334"><span>aseq</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.sel|fact"><span>list.sel</span></a><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>goal_cases</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>1</span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>is</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="var"><span>?not_matched</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>â¶</span></a></span><span> </span><span class="var"><span>?THEN</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>Â¬</span></a></span><span> </span><span class="var"><span>?not_matched</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>â¶</span></a></span><span> </span><span class="var"><span>?ELSE</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>rule</span></span><span class="main"><span class="keyword3"><span>;</span></span></span><span> </span><span class="operator"><span>rule</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword3"><span class="command"><span>assume</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?not_matched</span></span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>then</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_23716..23718">nm</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="skolem"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.not_member|const"><span>â</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span> </span><span class="var"><span>?M</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_23330..23334"><span>aseq</span></a><span> </span><span class="keyword1"><span class="command"><span>.</span></span></span><span>
      </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?THEN</span></span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>only</span></span><span class="main"><span class="main"><span>:</span></span></span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.mem_Collect_eq|fact"><span>mem_Collect_eq</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.case|fact"><span>prod.case</span></a><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>rule</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conjI|fact"><span>conjI</span></a><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>goal_cases</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>1</span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_15715..15726"><span>invAM_match</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><span class="quoted"><span class="quoted"><span>â¹</span><a class="entity_ref" href="Gale_Shapley1.html#offset_15620..15625"><span>invAM</span></a><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="var"><span>?M</span></span><span>âº</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_23458..23459"><span>a</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_23716..23718"><span>nm</span></a><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_23098..23100"><span>as</span></a><span> </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_23392..23398"><span>set_as</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_23330..23334"><span>aseq</span></a><span class="main"><span>)</span></span><span>
        </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>2</span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span>
          </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_10671..10680"><span>var_match</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_22949..22950"><span>m</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_22986..22987"><span>M</span></a><span> _ </span><a class="entity_ref" href="Gale_Shapley1.html#offset_23209..23220"><span>pref_match1</span></a><span class="main"><span>,</span></span><span> </span><span class="operator"><span>of</span></span><span> </span><span class="quoted"><span class="skolem"><span>a</span></span></span><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_23458..23459"><span>a</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Set_Interval.html#Set_Interval.atLeast0LessThan|fact"><span>atLeast0LessThan</span></a><span>
          </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_23392..23398"><span>set_as</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_23072..23073"><span>v</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>blast</span></span><span> 
      </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
      </span><span class="keyword3"><span class="command"><span>assume</span></span></span><span> </span><span class="entity_def" id="offset_24129..24136">matched</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>Â¬</span></a></span><span> </span><span class="var"><span>?not_matched</span></span><span>"</span></span></span><span>
      </span><span class="keyword3"><span class="command"><span class="entity_def" id="offset_24161..24167">define</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>a'</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>a'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><span>SOME</span></span><span> </span><span class="bound"><span>a'</span></span><span class="main"><span>.</span></span><span>  </span><span class="bound"><span>a'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>â</span></a></span><span> </span><span class="var"><span>?M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="bound"><span>a'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="skolem"><span>a</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_24240..24242">a'</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>a'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>â</span></a></span><span> </span><span class="var"><span>?M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="skolem"><span>a'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="skolem"><span>a</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_24161..24167"><span>a'_def</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_23330..23334"><span>aseq</span></a><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_24129..24136"><span>matched</span></a><span>
        </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>smt</span></span><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>verit</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image_iff|fact"><span>image_iff</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Hilbert_Choice.html#Hilbert_Choice.someI_ex|fact"><span>someI_ex</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span>hence</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>a'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>n</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>â </span></a></span><span> </span><span class="skolem"><span>a'</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_23458..23459"><span>a</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_22986..22987"><span>M</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Set_Interval.html#Set_Interval.atLeast0LessThan|fact"><span>atLeast0LessThan</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>auto</span></span><span>
      </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?ELSE</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_23330..23334"><span>aseq</span></a><span class="main"><span>[</span></span><span class="operator"><span>symmetric</span></span><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_24161..24167"><span>a'_def</span></a><span class="main"><span>[</span></span><span class="operator"><span>symmetric</span></span><span class="main"><span>]</span></span><span>
      </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>goal_cases</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>1</span><span>
        </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>is</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="var"><span>?pref</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>â¶</span></a></span><span> </span><span class="var"><span>?THEN</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>Â¬</span></a></span><span> </span><span class="var"><span>?pref</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>â¶</span></a></span><span> </span><span class="var"><span>?ELSE</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>rule</span></span><span class="main"><span class="keyword3"><span>;</span></span></span><span> </span><span class="operator"><span>rule</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword3"><span class="command"><span>assume</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?pref</span></span></span></span><span>
          </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?THEN</span></span></span></span><span>
          </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>only</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.mem_Collect_eq|fact"><span>mem_Collect_eq</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.case|fact"><span>prod.case</span></a><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>rule</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conjI|fact"><span>conjI</span></a><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>goal_cases</span></span><span class="main"><span>)</span></span><span>
            </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_24753..24754">*</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.set|const"><span>set</span></a><span> </span><span class="skolem"><span>as</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="main"><span>{</span></span><span class="skolem"><span>a'</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.union|const"><span>âª</span></a></span><span> </span><span class="main"><span>{</span></span><span class="skolem"><span>a</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.set|const"><span>set</span></a><span> </span><span class="main"><span>(</span></span><span class="skolem"><span>a'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.Cons|const"><span>#</span></a></span><span> </span><span class="skolem"><span>as'</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_23458..23459"><span>a</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_24240..24242"><span>a'</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_23098..23100"><span>as</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_23330..23334"><span>aseq</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>auto</span></span><span>
            </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>1</span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_15844..15854"><span>invAM_swap</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><span class="quoted"><span class="quoted"><span>â¹</span><a class="entity_ref" href="Gale_Shapley1.html#offset_15620..15625"><span>invAM</span></a><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="var"><span>?M</span></span><span>âº</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_23458..23459"><span>a</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_24240..24242"><span>a'</span></a><span> </span><span class="quoted"><span class="quoted"><span>â¹</span><span class="var"><span>?pref</span></span><span>âº</span></span></span><span class="main"><span>]</span></span><span> </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_24753..24754"><span>*</span></a><span>
              </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_24240..24242"><span>a'</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_23098..23100"><span>as</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_23330..23334"><span>aseq</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>force</span></span><span>
            </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>2</span><span>
            </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Finite_Set.html#Finite_Set.card|const"><span>card</span></a><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.set|const"><span>set</span></a><span> </span><span class="skolem"><span>as</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Finite_Set.html#Finite_Set.card|const"><span>card</span></a><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.set|const"><span>set</span></a><span> </span><span class="main"><span>(</span></span><span class="skolem"><span>a'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.Cons|const"><span>#</span></a></span><span> </span><span class="skolem"><span>as'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_23458..23459"><span>a</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_24240..24242"><span>a'</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_23098..23100"><span>as</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_23330..23334"><span>aseq</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>auto</span></span><span>
            </span><span class="keyword3"><span class="command"><span>thus</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_23072..23073"><span>v</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_11417..11425"><span>var_next</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_22949..22950"><span>m</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_22986..22987"><span>M</span></a><span> _ </span><a class="entity_ref" href="Gale_Shapley1.html#offset_23209..23220"><span>pref_match1</span></a><span class="main"><span>,</span></span><span> </span><span class="operator"><span>of</span></span><span> </span><span class="quoted"><span class="skolem"><span>a'</span></span></span><span class="main"><span>]</span></span><span> </span><span class="quoted"><span class="quoted"><span>â¹</span><span class="skolem"><span>a'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>n</span></span><span>âº</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_23458..23459"><span>a</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Set_Interval.html#Set_Interval.atLeast0LessThan|fact"><span>atLeast0LessThan</span></a><span>
              </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.Suc_eq_plus1|fact"><span>Suc_eq_plus1</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Set_Interval.html#Set_Interval.ord_class.lessThan_iff|fact"><span>lessThan_iff</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_4569..4579"><span>var_def</span></a><span class="main"><span>)</span></span><span>
          </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>
        </span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
          </span><span class="keyword3"><span class="command"><span>assume</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>Â¬</span></a></span><span> </span><span class="var"><span>?pref</span></span><span>"</span></span></span><span>
          </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?ELSE</span></span></span></span><span>
          </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>only</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.mem_Collect_eq|fact"><span>mem_Collect_eq</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.case|fact"><span>prod.case</span></a><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>rule</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conjI|fact"><span>conjI</span></a><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>goal_cases</span></span><span class="main"><span>)</span></span><span>
            </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>1</span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_17259..17269"><span>invAM_next</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><span class="quoted"><span class="quoted"><span>â¹</span><a class="entity_ref" href="Gale_Shapley1.html#offset_15620..15625"><span>invAM</span></a><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="var"><span>?M</span></span><span>âº</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_23458..23459"><span>a</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_24240..24242"><span>a'</span></a><span> </span><span class="quoted"><span class="quoted"><span>â¹</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>Â¬</span></a></span><span> </span><span class="var"><span>?pref</span></span><span>âº</span></span></span><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_23098..23100"><span>as</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>blast</span></span><span>

            </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>2</span><span>
            </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_23458..23459"><span>a</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_23072..23073"><span>v</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_11417..11425"><span>var_next</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_22949..22950"><span>m</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_22986..22987"><span>M</span></a><span> _ </span><a class="entity_ref" href="Gale_Shapley1.html#offset_23209..23220"><span>pref_match1</span></a><span class="main"><span>,</span></span><span> </span><span class="operator"><span>of</span></span><span> </span><span class="quoted"><span class="skolem"><span>a</span></span></span><span class="main"><span>]</span></span><span>
              </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.Suc_eq_plus1|fact"><span>Suc_eq_plus1</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Set_Interval.html#Set_Interval.atLeast0LessThan|fact"><span>atLeast0LessThan</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Set_Interval.html#Set_Interval.ord_class.lessThan_iff|fact"><span>lessThan_iff</span></a><span class="main"><span>)</span></span><span> 
          </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>
        </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>


</span><span class="keyword1"><span class="command"><span>abbreviation</span></span></span><span> </span><span class="entity"><span class="entity_def" id="Gale_Shapley1.Pref.invAB|const"><span class="entity_def" id="offset_25708..25713">invAB</span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.nat|type"><span>nat</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list|type"><span>list</span></a><span> </span><span class="main"><span>â</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.nat|type"><span>nat</span></a><span> </span><span class="main"><span>â</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.nat|type"><span>nat</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Option.html#Option.option|type"><span>option</span></a><span class="main"><span>)</span></span><span> </span><span class="main"><span>â</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.nat|type"><span>nat</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.set|type"><span>set</span></a><span> </span><span class="main"><span>â</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.bool|type"><span>bool</span></a><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
</span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>invAB</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>A</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>B</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>M</span></span></span></span><span> </span><span class="main"><span>==</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/Map.html#Map.ran|const"><span>ran</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>B</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>M</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>â</span></a></span><span class="bound"><span>b</span></span><span> </span><span class="bound"><span>a</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>.</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>B</span></span></span></span><span> </span><span class="bound"><span>b</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Option.html#Option.option.Some|const"><span>Some</span></a><span> </span><span class="bound"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>â¶</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>A</span></span></span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="bound"><span>b</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_25841..25846">lemma</span></span></span><span> </span><span class="entity_def" id="Gale_Shapley1.Pref.invAB_swap|fact"><span class="entity_def" id="Gale_Shapley1.Pref.invAB_swap|thm"><span class="entity_def" id="offset_25847..25857">invAB_swap</span></span></span><span class="main"><span>:</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_25867..25872">invAB</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_25708..25713"><span>invAB</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="free"><span>B</span></span><span> </span><span class="free"><span>M</span></span><span>"</span></span></span><span>
</span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_25896..25897">a</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><span class="free"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.not_member|const"><span>â</span></a></span><span> </span><span class="free"><span>M</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity_def" id="offset_25919..25921">a'</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>a'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>â</span></a></span><span> </span><span class="free"><span>M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="free"><span>a'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="free"><span>a</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.inj_on|const"><span>inj_on</span></a><span> </span><span class="free"><span>B</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/Map.html#Map.dom|const"><span>dom</span></a><span> </span><span class="free"><span>B</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>B</span></span><span class="main"><span>(</span></span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="free"><span>a</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Option.html#Option.option.Some|const"><span>Some</span></a><span> </span><span class="free"><span>a'</span></span><span>"</span></span></span><span>
</span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_25708..25713"><span>invAB</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>A</span></span><span class="main"><span>[</span></span><span class="free"><span>a'</span></span><span> </span><span class="main"><span>:=</span></span><span> </span><span class="free"><span>A</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span class="free"><span>a'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>B</span></span><span class="main"><span>(</span></span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="free"><span>a</span></span><span> </span><span class="main"><span>:=</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Option.html#Option.option.Some|const"><span>Some</span></a><span> </span><span class="free"><span>a</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="main"><span>{</span></span><span class="free"><span>a'</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.union|const"><span>âª</span></a></span><span> </span><span class="main"><span>{</span></span><span class="free"><span>a</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>â</span></a></span><span class="bound"><span>b</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>.</span></a></span><span> </span><span class="bound"><span>b</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>â </span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="free"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>â¶</span></a></span><span> </span><span class="free"><span>B</span></span><span> </span><span class="bound"><span>b</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Option.html#Option.option.Some|const"><span>Some</span></a><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>â¶</span></a></span><span> </span><span class="free"><span>a'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>â </span></a></span><span> </span><span class="bound"><span>x</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_25867..25872"><span>invAB</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_25919..25921"><span>a'</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>blast</span></span><span>
  </span><span class="keyword1"><span class="command"><span>moreover</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>â </span></a></span><span> </span><span class="free"><span>a'</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_25896..25897"><span>a</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_25919..25921"><span>a'</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>auto</span></span><span> 
  </span><span class="keyword1"><span class="command"><span>ultimately</span></span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_25841..25846"><span>assms</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.ran_map_upd_Some|fact"><span>ran_map_upd_Some</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5402..5412"><span>match_def</span></a><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>


</span><span class="keyword1"><span class="command"><span>subsection</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>â¹</span><span>Algorithm 3: Record matching of Bs to As</span><span>âº</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Gale_Shapley1.Pref.Gale_Shapley3|fact"><span class="entity_def" id="Gale_Shapley1.Pref.Gale_Shapley3|thm"><span>Gale_Shapley3</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="keyword1"><span>VARS</span></span><span> </span><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span>A</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span> </span><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span>B</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span> </span><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span>a</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span> </span><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span>a'</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span> </span><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span>as</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span> </span><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span>b</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span>
 </span><span class="main"><span>[</span></span><span class="bound"><span>as</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.upt|const"><span>[</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.upt|const"><span>..&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.upt|const"><span>]</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><span class="bound"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.replicate|const"><span>replicate</span></a><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><span class="bound"><span>B</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>Î»</span></span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Option.html#Option.option.None|const"><span>None</span></a><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span>
 </span><span class="keyword1"><span>WHILE</span></span><span> </span><span class="bound"><span>as</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>â </span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.Nil|const"><span>[]</span></a></span><span>
 </span><span class="keyword1"><span>INV</span></span><span> </span><span class="main"><span>{</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_15620..15625"><span>invAM</span></a><span> </span><span class="bound"><span>A</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.set|const"><span>set</span></a><span> </span><span class="bound"><span>as</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_25708..25713"><span>invAB</span></a><span> </span><span class="bound"><span>A</span></span><span> </span><span class="bound"><span>B</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.set|const"><span>set</span></a><span> </span><span class="bound"><span>as</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_22115..22120"><span>invas</span></a><span> </span><span class="bound"><span>as</span></span><span class="main"><span>}</span></span><span>
 </span><span class="keyword1"><span>VAR</span></span><span> </span><span class="main"><span>{</span></span><a class="entity_ref" href="Gale_Shapley1.html#offset_4580..4583"><span>var</span></a><span> </span><span class="bound"><span>A</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.set|const"><span>set</span></a><span> </span><span class="bound"><span>as</span></span><span class="main"><span>)</span></span><span class="main"><span>}</span></span><span>
 </span><span class="keyword1"><span>DO</span></span><span> a </span><span class="main"><span>:=</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.hd|const"><span>hd</span></a><span> </span><span class="bound"><span>as</span></span><span class="main"><span>;</span></span><span> b </span><span class="main"><span>:=</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="bound"><span>A</span></span><span> </span><span class="bound"><span>a</span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword1"><span>IF</span></span><span> </span><span class="bound"><span>B</span></span><span> </span><span class="bound"><span>b</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Option.html#Option.option.None|const"><span>None</span></a><span>
  </span><span class="keyword1"><span>THEN</span></span><span> B </span><span class="main"><span>:=</span></span><span> </span><span class="bound"><span>B</span></span><span class="main"><span>(</span></span><span class="bound"><span>b</span></span><span> </span><span class="main"><span>:=</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Option.html#Option.option.Some|const"><span>Some</span></a><span> </span><span class="bound"><span>a</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span> as </span><span class="main"><span>:=</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.tl|const"><span>tl</span></a><span> </span><span class="bound"><span>as</span></span><span>
  </span><span class="keyword1"><span>ELSE</span></span><span> a' </span><span class="main"><span>:=</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Option.html#Option.option.the|const"><span>the</span></a><span class="main"><span>(</span></span><span class="bound"><span>B</span></span><span> </span><span class="bound"><span>b</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
       </span><span class="keyword1"><span>IF</span></span><span> </span><span class="free"><span>P<span class="hidden">â©</span><sub>b</sub></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="bound"><span>A</span></span><span> </span><span class="bound"><span>a'</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.prefa|const"><span>â¢</span></a></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.prefa|const"><span>&lt;</span></a></span><span> </span><span class="bound"><span>a'</span></span><span>
       </span><span class="keyword1"><span>THEN</span></span><span> B </span><span class="main"><span>:=</span></span><span> </span><span class="bound"><span>B</span></span><span class="main"><span>(</span></span><span class="bound"><span>b</span></span><span> </span><span class="main"><span>:=</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Option.html#Option.option.Some|const"><span>Some</span></a><span> </span><span class="bound"><span>a</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>A</span></span><span class="main"><span>[</span></span><span class="bound"><span>a'</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>:=</span></span><span> </span><span class="bound"><span>A</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span class="bound"><span>a'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>;</span></span><span> as </span><span class="main"><span>:=</span></span><span> </span><span class="bound"><span>a'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.Cons|const"><span>#</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.tl|const"><span>tl</span></a><span> </span><span class="bound"><span>as</span></span><span>
       </span><span class="keyword1"><span>ELSE</span></span><span> </span><span class="bound"><span>A</span></span><span class="main"><span>[</span></span><span class="bound"><span>a</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>:=</span></span><span> </span><span class="bound"><span>A</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span class="bound"><span>a</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span>
       </span><span class="keyword1"><span>FI</span></span><span>
  </span><span class="keyword1"><span>FI</span></span><span> 
 </span><span class="keyword1"><span>OD</span></span><span>
 </span><span class="main"><span>[</span></span><a class="entity_ref" href="Gale_Shapley1.html#offset_6118..6126"><span>matching</span></a><span> </span><span class="bound"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5827..5833"><span>stable</span></a><span> </span><span class="bound"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_13003..13009"><span>opti<span class="hidden">â©</span><sub>a</sub></span></a><span> </span><span class="bound"><span>A</span></span><span class="main"><span>]</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL-Hoare/Hoare_Logic.html#Hoare_Logic.vcg_tc|method"><span class="operator"><span>vcg_tc</span></span></a><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>goal_cases</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>1</span><span> </span><span class="keyword3"><span class="command"><span>thus</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span class="main"><span>(</span></span><span class="operator"><span>auto</span></span><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5816..5826"><span>stable_def</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_12992..13002"><span>opti<span class="hidden">â©</span><sub>a</sub>_def</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_12328..12338"><span>pref_match_def</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_2342..2349"><span>P<span class="hidden">â©</span><sub>a</sub>_set</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.card_distinct|fact"><span>card_distinct</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5402..5412"><span>match_def</span></a><span> </span><a class="entity_ref" href="../List-Index/List_Index.html#List_Index.index_nth_id|fact"><span>index_nth_id</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.prefers_def|fact"><span>prefers_def</span></a><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
  </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>3</span><span> </span><span class="keyword3"><span class="command"><span>thus</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_15395..15412"><span>pref_match_stable</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>auto</span></span><span>
</span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
  </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity_def" id="offset_27096..27097">2</span><span> </span><span class="skolem"><span>v</span></span><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="skolem"><span>B</span></span><span> _ </span><span class="skolem"><span>a'</span></span><span> </span><span class="skolem"><span>as</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>let</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?M</span></span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.set|const"><span>set</span></a><span> </span><span class="skolem"><span>as</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_27147..27152">invAM</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_15620..15625"><span>invAM</span></a><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="var"><span>?M</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity_def" id="offset_27171..27172">m</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_6118..6126"><span>matching</span></a><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="var"><span>?M</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity_def" id="offset_27194..27195">A</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_2486..2488"><span>wf</span></a><span> </span><span class="skolem"><span>A</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity_def" id="offset_27208..27209">M</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="var"><span>?M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>â</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity_def" id="offset_27231..27241">pref_match</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_12339..12349"><span>pref_match</span></a><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="var"><span>?M</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_13003..13009"><span>opti<span class="hidden">â©</span><sub>a</sub></span></a><span> </span><span class="skolem"><span>A</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>as</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>â </span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.Nil|const"><span>[]</span></a></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity_def" id="offset_27294..27295">v</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_4580..4583"><span>var</span></a><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="var"><span>?M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="skolem"><span>v</span></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity_def" id="offset_27320..27322">as</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_22115..22120"><span>invas</span></a><span> </span><span class="skolem"><span>as</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity_def" id="offset_27339..27344">invAB</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_25708..25713"><span>invAB</span></a><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="skolem"><span>B</span></span><span> </span><span class="var"><span>?M</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_27096..27097"><span>2</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>auto</span></span><span>
  </span><span class="keyword1"><span class="command"><span>note</span></span></span><span> </span><span>pref_match'</span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_27231..27241"><span>pref_match</span></a><span class="main"><span>[</span></span><span class="operator"><span>THEN</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_12582..12597"><span>pref_match'_iff</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_27194..27195"><span>A</span></a><span class="main"><span class="main"><span>,</span></span></span><span> </span><span class="operator"><span>THEN</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.iffD2|fact"><span>iffD2</span></a><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>]</span></span><span>
  </span><span class="keyword1"><span class="command"><span>hence</span></span></span><span> </span><span class="entity_def" id="offset_27457..27468">pref_match1</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>â</span></span><span class="bound"><span class="bound"><span>a</span></span></span><span class="main"><span>&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_6050..6059"><span>preferred</span></a><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>â</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span> </span><span class="var"><span>?M</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_12457..12467"><span>pref_match'_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>blast</span></span><span>
  </span><span class="keyword1"><span class="command"><span>from</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>â¹</span><span class="skolem"><span>as</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>â </span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.Nil|const"><span>[]</span></a></span><span>âº</span></span></span><span> </span><span class="keyword3"><span class="command"><span>obtain</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>a</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>as'</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="entity_def" id="offset_27578..27582">aseq</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>as</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="skolem"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.Cons|const"><span>#</span></a></span><span> </span><span class="skolem"><span>as'</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>fastforce</span></span><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.neq_Nil_conv|fact"><span>neq_Nil_conv</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_27640..27646">set_as</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="var"><span>?M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.union|const"><span>âª</span></a></span><span> </span><span class="main"><span>{</span></span><span class="skolem"><span>a</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.set|const"><span>set</span></a><span> </span><span class="skolem"><span>as'</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_27320..27322"><span>as</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_27578..27582"><span>aseq</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>force</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_27706..27707">a</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><span class="skolem"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.not_member|const"><span>â</span></a></span><span> </span><span class="var"><span>?M</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_27320..27322"><span>as</span></a><span> </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_27578..27582"><span>aseq</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>only</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_27578..27582"><span>aseq</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.sel|fact"><span>list.sel</span></a><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>goal_cases</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>1</span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>is</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="var"><span>?not_matched</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>â¶</span></a></span><span> </span><span class="var"><span>?THEN</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>Â¬</span></a></span><span> </span><span class="var"><span>?not_matched</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>â¶</span></a></span><span> </span><span class="var"><span>?ELSE</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>rule</span></span><span class="main"><span class="keyword3"><span>;</span></span></span><span> </span><span class="operator"><span>rule</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword3"><span class="command"><span>assume</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?not_matched</span></span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>then</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_27964..27966">nm</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="skolem"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.not_member|const"><span>â</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span> </span><span class="var"><span>?M</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_27339..27344"><span>invAB</span></a><span> </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_27578..27582"><span>aseq</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Map.html#Map.ran_def|fact"><span>ran_def</span></a><span>
        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>clarsimp</span></span><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.set_eq_iff|fact"><span>set_eq_iff</span></a><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Option.html#Option.not_None_eq|fact"><span>not_None_eq</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>blast</span></span><span>
      </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?THEN</span></span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>only</span></span><span class="main"><span class="main"><span>:</span></span></span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.mem_Collect_eq|fact"><span>mem_Collect_eq</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.case|fact"><span>prod.case</span></a><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>rule</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conjI|fact"><span>conjI</span></a><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>goal_cases</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_28201..28207">invAM'</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_15620..15625"><span>invAM</span></a><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.set|const"><span>set</span></a><span> </span><span class="skolem"><span>as'</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
          </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_15715..15726"><span>invAM_match</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_27147..27152"><span>invAM</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_27706..27707"><span>a</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_27964..27966"><span>nm</span></a><span class="main"><span>]</span></span><span> </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_27640..27646"><span>set_as</span></a><span class="main"><span>[</span></span><span class="operator"><span>symmetric</span></span><span class="main"><span>]</span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
        </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_28328..28334">invAB'</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_25708..25713"><span>invAB</span></a><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="main"><span>(</span></span><span class="skolem"><span>B</span></span><span class="main"><span>(</span></span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="skolem"><span>a</span></span><span> </span><span class="main"><span>:=</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Option.html#Option.option.Some|const"><span>Some</span></a><span> </span><span class="skolem"><span>a</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.set|const"><span>set</span></a><span> </span><span class="skolem"><span>as'</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
          </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_27339..27344"><span>invAB</span></a><span> </span><span class="quoted"><span class="quoted"><span>â¹</span><span class="var"><span>?not_matched</span></span><span>âº</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_27640..27646"><span>set_as</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>1</span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_28201..28207"><span>invAM'</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_27320..27322"><span>as</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_28328..28334"><span>invAB'</span></a><span> </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_27640..27646"><span>set_as</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_27578..27582"><span>aseq</span></a><span>
          </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.distinct.simps|fact"><span>distinct.simps</span></a><span class="main"><span class="main"><span>(</span></span></span><span>2</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.insert_subset|fact"><span>insert_subset</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.simps|fact"><span>list.simps</span></a><span class="main"><span class="main"><span>(</span></span></span><span>15</span><span class="main"><span class="main"><span>)</span></span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>2</span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span>
          </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_10671..10680"><span>var_match</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_27171..27172"><span>m</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_27208..27209"><span>M</span></a><span> _ </span><a class="entity_ref" href="Gale_Shapley1.html#offset_27457..27468"><span>pref_match1</span></a><span class="main"><span>,</span></span><span> </span><span class="operator"><span>of</span></span><span> </span><span class="quoted"><span class="skolem"><span>a</span></span></span><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_27706..27707"><span>a</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Set_Interval.html#Set_Interval.atLeast0LessThan|fact"><span>atLeast0LessThan</span></a><span>
          </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_27640..27646"><span>set_as</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_27294..27295"><span>v</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>blast</span></span><span> 
      </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
      </span><span class="keyword3"><span class="command"><span>assume</span></span></span><span> </span><span>matched</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>Â¬</span></a></span><span> </span><span class="var"><span>?not_matched</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>then</span></span></span><span> </span><span class="keyword3"><span class="command"><span>obtain</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>a'</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="entity_def" id="offset_28804..28808">a'eq</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>B</span></span><span class="main"><span>(</span></span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="skolem"><span>a</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Option.html#Option.option.Some|const"><span>Some</span></a><span> </span><span class="skolem"><span>a'</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>auto</span></span><span>
      </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_28854..28856">a'</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>a'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>â</span></a></span><span> </span><span class="var"><span>?M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="skolem"><span>a'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="skolem"><span>a</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_27578..27582"><span>aseq</span></a><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_28804..28808"><span>a'eq</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_27339..27344"><span>invAB</span></a><span>
        </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Map.html#Map.ranI|fact"><span>ranI</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_27578..27582"><span>aseq</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span>hence</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>a'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>n</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>â </span></a></span><span> </span><span class="skolem"><span>a'</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_27706..27707"><span>a</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_27208..27209"><span>M</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Set_Interval.html#Set_Interval.atLeast0LessThan|fact"><span>atLeast0LessThan</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>auto</span></span><span>
      </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?ELSE</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_27578..27582"><span>aseq</span></a><span class="main"><span>[</span></span><span class="operator"><span>symmetric</span></span><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_28804..28808"><span>a'eq</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Option.html#Option.option.sel|fact"><span>option.sel</span></a><span>
      </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>goal_cases</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_29116..29123">inj_dom</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.inj_on|const"><span>inj_on</span></a><span> </span><span class="skolem"><span>B</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/Map.html#Map.dom|const"><span>dom</span></a><span> </span><span class="skolem"><span>B</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>mono_tags</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Map.html#Map.domD|fact"><span>domD</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.inj_onI|fact"><span>inj_onI</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_27339..27344"><span>invAB</span></a><span class="main"><span>)</span></span><span>
        </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>1</span><span>
        </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>is</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="var"><span>?pref</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>â¶</span></a></span><span> </span><span class="var"><span>?THEN</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>Â¬</span></a></span><span> </span><span class="var"><span>?pref</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>â¶</span></a></span><span> </span><span class="var"><span>?ELSE</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>rule</span></span><span class="main"><span class="keyword3"><span>;</span></span></span><span> </span><span class="operator"><span>rule</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword3"><span class="command"><span>assume</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?pref</span></span></span></span><span>
          </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?THEN</span></span></span></span><span>
          </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>only</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.mem_Collect_eq|fact"><span>mem_Collect_eq</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.case|fact"><span>prod.case</span></a><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>rule</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conjI|fact"><span>conjI</span></a><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>goal_cases</span></span><span class="main"><span>)</span></span><span>
            </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_29429..29430">*</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.set|const"><span>set</span></a><span> </span><span class="skolem"><span>as</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="main"><span>{</span></span><span class="skolem"><span>a'</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.union|const"><span>âª</span></a></span><span> </span><span class="main"><span>{</span></span><span class="skolem"><span>a</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.set|const"><span>set</span></a><span> </span><span class="main"><span>(</span></span><span class="skolem"><span>a'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.Cons|const"><span>#</span></a></span><span> </span><span class="skolem"><span>as'</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_27706..27707"><span>a</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_28854..28856"><span>a'</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_27320..27322"><span>as</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_27578..27582"><span>aseq</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>auto</span></span><span>
            </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span>a'neq</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>â</span></a></span><span class="bound"><span>b</span></span><span> </span><span class="bound"><span>x</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>.</span></a></span><span> </span><span class="bound"><span>b</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>â </span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="skolem"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>â¶</span></a></span><span> </span><span class="skolem"><span>B</span></span><span> </span><span class="bound"><span>b</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Option.html#Option.option.Some|const"><span>Some</span></a><span> </span><span class="bound"><span>x</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>â¶</span></a></span><span> </span><span class="skolem"><span>a'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>â </span></a></span><span> </span><span class="bound"><span>x</span></span><span>"</span></span></span><span>
              </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_27339..27344"><span>invAB</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_28854..28856"><span>a'</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>blast</span></span><span>
            </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_29636..29642">invAB'</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_25708..25713"><span>invAB</span></a><span> </span><span class="main"><span>(</span></span><span class="skolem"><span>A</span></span><span class="main"><span>[</span></span><span class="skolem"><span>a'</span></span><span> </span><span class="main"><span>:=</span></span><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="skolem"><span>a'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="skolem"><span>B</span></span><span class="main"><span>(</span></span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="skolem"><span>a</span></span><span> </span><span class="main"><span>:=</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Option.html#Option.option.Some|const"><span>Some</span></a><span> </span><span class="skolem"><span>a</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.insert|const"><span>insert</span></a><span> </span><span class="skolem"><span>a'</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.set|const"><span>set</span></a><span> </span><span class="skolem"><span>as'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
              </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_25847..25857"><span>invAB_swap</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_27339..27344"><span>invAB</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_27706..27707"><span>a</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_28854..28856"><span>a'</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_29116..29123"><span>inj_dom</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_28804..28808"><span>a'eq</span></a><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_29429..29430"><span>*</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
            </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>1</span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_15844..15854"><span>invAM_swap</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_27147..27152"><span>invAM</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_27706..27707"><span>a</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_28854..28856"><span>a'</span></a><span> </span><span class="quoted"><span class="quoted"><span>â¹</span><span class="var"><span>?pref</span></span><span>âº</span></span></span><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_29636..29642"><span>invAB'</span></a><span> </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_29429..29430"><span>*</span></a><span>
              </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_28854..28856"><span>a'</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_27320..27322"><span>as</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_27578..27582"><span>aseq</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
            </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>2</span><span>
            </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Finite_Set.html#Finite_Set.card|const"><span>card</span></a><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.set|const"><span>set</span></a><span> </span><span class="skolem"><span>as</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Finite_Set.html#Finite_Set.card|const"><span>card</span></a><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.set|const"><span>set</span></a><span> </span><span class="main"><span>(</span></span><span class="skolem"><span>a'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.Cons|const"><span>#</span></a></span><span> </span><span class="skolem"><span>as'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_27706..27707"><span>a</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_28854..28856"><span>a'</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_27320..27322"><span>as</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_27578..27582"><span>aseq</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>auto</span></span><span>
            </span><span class="keyword3"><span class="command"><span>thus</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_27294..27295"><span>v</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_11417..11425"><span>var_next</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_27171..27172"><span>m</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_27208..27209"><span>M</span></a><span> _ </span><a class="entity_ref" href="Gale_Shapley1.html#offset_27457..27468"><span>pref_match1</span></a><span class="main"><span>,</span></span><span> </span><span class="operator"><span>of</span></span><span> </span><span class="quoted"><span class="skolem"><span>a'</span></span></span><span class="main"><span>]</span></span><span> </span><span class="quoted"><span class="quoted"><span>â¹</span><span class="skolem"><span>a'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>n</span></span><span>âº</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_27706..27707"><span>a</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Set_Interval.html#Set_Interval.atLeast0LessThan|fact"><span>atLeast0LessThan</span></a><span>
              </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.Suc_eq_plus1|fact"><span>Suc_eq_plus1</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Set_Interval.html#Set_Interval.ord_class.lessThan_iff|fact"><span>lessThan_iff</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_4569..4579"><span>var_def</span></a><span class="main"><span>)</span></span><span>
          </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>
        </span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
          </span><span class="keyword3"><span class="command"><span>assume</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>Â¬</span></a></span><span> </span><span class="var"><span>?pref</span></span><span>"</span></span></span><span>
          </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?ELSE</span></span></span></span><span>
          </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>only</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.mem_Collect_eq|fact"><span>mem_Collect_eq</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.case|fact"><span>prod.case</span></a><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>rule</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conjI|fact"><span>conjI</span></a><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>goal_cases</span></span><span class="main"><span>)</span></span><span>
            </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>1</span><span>
            </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_25708..25713"><span>invAB</span></a><span> </span><span class="main"><span>(</span></span><span class="skolem"><span>A</span></span><span class="main"><span>[</span></span><span class="skolem"><span>a</span></span><span> </span><span class="main"><span>:=</span></span><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="skolem"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="skolem"><span>B</span></span><span> </span><span class="var"><span>?M</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_27339..27344"><span>invAB</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_27706..27707"><span>a</span></a><span>
              </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5402..5412"><span>match_def</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth_list_update_neq|fact"><span>nth_list_update_neq</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Map.html#Map.ranI|fact"><span>ranI</span></a><span class="main"><span>)</span></span><span>
            </span><span class="keyword3"><span class="command"><span>thus</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_17259..17269"><span>invAM_next</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_27147..27152"><span>invAM</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_27706..27707"><span>a</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_28854..28856"><span>a'</span></a><span> </span><span class="quoted"><span class="quoted"><span>â¹</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>Â¬</span></a></span><span> </span><span class="var"><span>?pref</span></span><span>âº</span></span></span><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_27320..27322"><span>as</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>blast</span></span><span>
            </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>2</span><span>
            </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_27706..27707"><span>a</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_27294..27295"><span>v</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_11417..11425"><span>var_next</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_27171..27172"><span>m</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_27208..27209"><span>M</span></a><span> _ </span><a class="entity_ref" href="Gale_Shapley1.html#offset_27457..27468"><span>pref_match1</span></a><span class="main"><span>,</span></span><span> </span><span class="operator"><span>of</span></span><span> </span><span class="quoted"><span class="skolem"><span>a</span></span></span><span class="main"><span>]</span></span><span>
              </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.Suc_eq_plus1|fact"><span>Suc_eq_plus1</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Set_Interval.html#Set_Interval.atLeast0LessThan|fact"><span>atLeast0LessThan</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Set_Interval.html#Set_Interval.ord_class.lessThan_iff|fact"><span>lessThan_iff</span></a><span class="main"><span>)</span></span><span> 
          </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>
        </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>

</span><span class="comment1"><span>(</span><span>*</span><span> begin unused: directly implement function B via lists B and M (data refinement);
   also done in Alg. 4 in a more principled manner </span><span>*</span><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>abbreviation</span></span></span><span> </span><span class="entity"><span class="entity_def" id="Gale_Shapley1.Pref.invAB&apos;|const"><span class="entity_def" id="offset_30934..30940">invAB'</span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.nat|type"><span>nat</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list|type"><span>list</span></a><span> </span><span class="main"><span>â</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.nat|type"><span>nat</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list|type"><span>list</span></a><span> </span><span class="main"><span>â</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.bool|type"><span>bool</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list|type"><span>list</span></a><span> </span><span class="main"><span>â</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.nat|type"><span>nat</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.set|type"><span>set</span></a><span> </span><span class="main"><span>â</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.bool|type"><span>bool</span></a><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
</span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>invAB'</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>A</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>B</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>M</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>M'</span></span></span></span><span> </span><span class="main"><span>==</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/List.html#List.length|const"><span>length</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>B</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.length|const"><span>length</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>M</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>M'</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>nth</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>B</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span> </span><span class="main"><span>{</span></span><span class="bound"><span>b</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>b</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>M</span></span></span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span class="bound"><span>b</span></span><span class="main"><span>}</span></span><span>
 </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>â</span></span><span class="bound"><span class="bound"><span>b</span></span></span><span class="main"><span>&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>M</span></span></span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span class="bound"><span>b</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>â¶</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>B</span></span></span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span class="bound"><span>b</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>A</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>B</span></span></span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span class="bound"><span>b</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="bound"><span>b</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Gale_Shapley1.Pref.Gale_Shapley4&apos;|fact"><span class="entity_def" id="Gale_Shapley1.Pref.Gale_Shapley4&apos;|thm"><span>Gale_Shapley4'</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="keyword1"><span>VARS</span></span><span> </span><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span>A</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span> </span><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span>B</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span> </span><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span>M</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span> </span><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span>a</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span> </span><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span>a'</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span> </span><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span>as</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span> </span><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span>b</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span>
 </span><span class="main"><span>[</span></span><span class="bound"><span>as</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.upt|const"><span>[</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.upt|const"><span>..&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.upt|const"><span>]</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><span class="bound"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.replicate|const"><span>replicate</span></a><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><span class="bound"><span>B</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.replicate|const"><span>replicate</span></a><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><span class="bound"><span>M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.replicate|const"><span>replicate</span></a><span> </span><span class="free"><span>n</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.False|const"><span>False</span></a><span class="main"><span>]</span></span><span>
 </span><span class="keyword1"><span>WHILE</span></span><span> </span><span class="bound"><span>as</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>â </span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.Nil|const"><span>[]</span></a></span><span>
 </span><span class="keyword1"><span>INV</span></span><span> </span><span class="main"><span>{</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_15620..15625"><span>invAM</span></a><span> </span><span class="bound"><span>A</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.set|const"><span>set</span></a><span> </span><span class="bound"><span>as</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_30934..30940"><span>invAB'</span></a><span> </span><span class="bound"><span>A</span></span><span> </span><span class="bound"><span>B</span></span><span> </span><span class="bound"><span>M</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.set|const"><span>set</span></a><span> </span><span class="bound"><span>as</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_22115..22120"><span>invas</span></a><span> </span><span class="bound"><span>as</span></span><span class="main"><span>}</span></span><span>
 </span><span class="keyword1"><span>VAR</span></span><span> </span><span class="main"><span>{</span></span><a class="entity_ref" href="Gale_Shapley1.html#offset_4580..4583"><span>var</span></a><span> </span><span class="bound"><span>A</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.set|const"><span>set</span></a><span> </span><span class="bound"><span>as</span></span><span class="main"><span>)</span></span><span class="main"><span>}</span></span><span>
 </span><span class="keyword1"><span>DO</span></span><span> a </span><span class="main"><span>:=</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.hd|const"><span>hd</span></a><span> </span><span class="bound"><span>as</span></span><span class="main"><span>;</span></span><span> b </span><span class="main"><span>:=</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="bound"><span>A</span></span><span> </span><span class="bound"><span>a</span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword1"><span>IF</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>Â¬</span></a></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="bound"><span>b</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span>THEN</span></span><span> </span><span class="bound"><span>M</span></span><span class="main"><span>[</span></span><span class="bound"><span>b</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>:=</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.True|const"><span>True</span></a><span class="main"><span>;</span></span><span> </span><span class="bound"><span>B</span></span><span class="main"><span>[</span></span><span class="bound"><span>b</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>:=</span></span><span> </span><span class="bound"><span>a</span></span><span class="main"><span>;</span></span><span> as </span><span class="main"><span>:=</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.tl|const"><span>tl</span></a><span> </span><span class="bound"><span>as</span></span><span>
  </span><span class="keyword1"><span>ELSE</span></span><span> a' </span><span class="main"><span>:=</span></span><span> </span><span class="bound"><span>B</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="bound"><span>b</span></span><span class="main"><span>;</span></span><span>
       </span><span class="keyword1"><span>IF</span></span><span> </span><span class="free"><span>P<span class="hidden">â©</span><sub>b</sub></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="bound"><span>A</span></span><span> </span><span class="bound"><span>a'</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.prefa|const"><span>â¢</span></a></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.prefa|const"><span>&lt;</span></a></span><span> </span><span class="bound"><span>a'</span></span><span>
       </span><span class="keyword1"><span>THEN</span></span><span> </span><span class="bound"><span>B</span></span><span class="main"><span>[</span></span><span class="bound"><span>b</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>:=</span></span><span> </span><span class="bound"><span>a</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>A</span></span><span class="main"><span>[</span></span><span class="bound"><span>a'</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>:=</span></span><span> </span><span class="bound"><span>A</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span class="bound"><span>a'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>;</span></span><span> as </span><span class="main"><span>:=</span></span><span> </span><span class="bound"><span>a'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.Cons|const"><span>#</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.tl|const"><span>tl</span></a><span> </span><span class="bound"><span>as</span></span><span>
       </span><span class="keyword1"><span>ELSE</span></span><span> </span><span class="bound"><span>A</span></span><span class="main"><span>[</span></span><span class="bound"><span>a</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>:=</span></span><span> </span><span class="bound"><span>A</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span class="bound"><span>a</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span>
       </span><span class="keyword1"><span>FI</span></span><span>
  </span><span class="keyword1"><span>FI</span></span><span> 
 </span><span class="keyword1"><span>OD</span></span><span>
 </span><span class="main"><span>[</span></span><a class="entity_ref" href="Gale_Shapley1.html#offset_2486..2488"><span>wf</span></a><span> </span><span class="bound"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.inj_on|const"><span>inj_on</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="bound"><span>A</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5827..5833"><span>stable</span></a><span> </span><span class="bound"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_13003..13009"><span>opti<span class="hidden">â©</span><sub>a</sub></span></a><span> </span><span class="bound"><span>A</span></span><span class="main"><span>]</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL-Hoare/Hoare_Logic.html#Hoare_Logic.vcg_tc|method"><span class="operator"><span>vcg_tc</span></span></a><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>goal_cases</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>1</span><span> </span><span class="keyword3"><span class="command"><span>thus</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span>
   </span><span class="keyword1"><span class="command"><span>by</span></span></span><span class="main"><span>(</span></span><span class="operator"><span>auto</span></span><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5816..5826"><span>stable_def</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_12992..13002"><span>opti<span class="hidden">â©</span><sub>a</sub>_def</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_12328..12338"><span>pref_match_def</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_2342..2349"><span>P<span class="hidden">â©</span><sub>a</sub>_set</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.card_distinct|fact"><span>card_distinct</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5402..5412"><span>match_def</span></a><span> </span><a class="entity_ref" href="../List-Index/List_Index.html#List_Index.index_nth_id|fact"><span>index_nth_id</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.prefers_def|fact"><span>prefers_def</span></a><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
  </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>3</span><span> </span><span class="keyword3"><span class="command"><span>thus</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_15395..15412"><span>pref_match_stable</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>auto</span></span><span>
</span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
  </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity_def" id="offset_31911..31912">2</span><span> </span><span class="skolem"><span>v</span></span><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="skolem"><span>B</span></span><span> </span><span class="skolem"><span>M</span></span><span> _ </span><span class="skolem"><span>a'</span></span><span> </span><span class="skolem"><span>as</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>let</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?M</span></span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.set|const"><span>set</span></a><span> </span><span class="skolem"><span>as</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_31964..31969">invAM</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_15620..15625"><span>invAM</span></a><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="var"><span>?M</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity_def" id="offset_31988..31989">m</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_6118..6126"><span>matching</span></a><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="var"><span>?M</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity_def" id="offset_32011..32012">A</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_2486..2488"><span>wf</span></a><span> </span><span class="skolem"><span>A</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity_def" id="offset_32025..32026">M</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="var"><span>?M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>â</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity_def" id="offset_32048..32058">pref_match</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_12339..12349"><span>pref_match</span></a><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="var"><span>?M</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_13003..13009"><span>opti<span class="hidden">â©</span><sub>a</sub></span></a><span> </span><span class="skolem"><span>A</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity_def" id="offset_32097..32103">notall</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>as</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>â </span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.Nil|const"><span>[]</span></a></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity_def" id="offset_32119..32120">v</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_4580..4583"><span>var</span></a><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="var"><span>?M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="skolem"><span>v</span></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity_def" id="offset_32145..32147">as</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_22115..22120"><span>invas</span></a><span> </span><span class="skolem"><span>as</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity_def" id="offset_32164..32169">invAB</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_30934..30940"><span>invAB'</span></a><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="skolem"><span>B</span></span><span> </span><span class="skolem"><span>M</span></span><span> </span><span class="var"><span>?M</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_31911..31912"><span>2</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>auto</span></span><span>
  </span><span class="keyword1"><span class="command"><span>note</span></span></span><span> </span><span>pref_match'</span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_32048..32058"><span>pref_match</span></a><span class="main"><span>[</span></span><span class="operator"><span>THEN</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_12582..12597"><span>pref_match'_iff</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_32011..32012"><span>A</span></a><span class="main"><span class="main"><span>,</span></span></span><span> </span><span class="operator"><span>THEN</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.iffD2|fact"><span>iffD2</span></a><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>]</span></span><span>
  </span><span class="keyword1"><span class="command"><span>hence</span></span></span><span> </span><span class="entity_def" id="offset_32285..32296">pref_match1</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>â</span></span><span class="bound"><span class="bound"><span>a</span></span></span><span class="main"><span>&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_6050..6059"><span>preferred</span></a><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>â</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span> </span><span class="var"><span>?M</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_12457..12467"><span>pref_match'_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>blast</span></span><span>
  </span><span class="keyword1"><span class="command"><span>from</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_32097..32103"><span>notall</span></a><span> </span><span class="keyword3"><span class="command"><span>obtain</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>a</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>as'</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="entity_def" id="offset_32403..32407">aseq</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>as</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="skolem"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.Cons|const"><span>#</span></a></span><span> </span><span class="skolem"><span>as'</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>fastforce</span></span><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.neq_Nil_conv|fact"><span>neq_Nil_conv</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_32465..32471">set_as</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="var"><span>?M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.union|const"><span>âª</span></a></span><span> </span><span class="main"><span>{</span></span><span class="skolem"><span>a</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.set|const"><span>set</span></a><span> </span><span class="skolem"><span>as'</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_32145..32147"><span>as</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_32403..32407"><span>aseq</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>force</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_32531..32532">a</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><span class="skolem"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.not_member|const"><span>â</span></a></span><span> </span><span class="var"><span>?M</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_32145..32147"><span>as</span></a><span> </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_32403..32407"><span>aseq</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>only</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_32403..32407"><span>aseq</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.sel|fact"><span>list.sel</span></a><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>goal_cases</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>1</span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>is</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="var"><span>?not_matched</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>â¶</span></a></span><span> </span><span class="var"><span>?THEN</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>Â¬</span></a></span><span> </span><span class="var"><span>?not_matched</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>â¶</span></a></span><span> </span><span class="var"><span>?ELSE</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>rule</span></span><span class="main"><span class="keyword3"><span>;</span></span></span><span> </span><span class="operator"><span>rule</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword3"><span class="command"><span>assume</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?not_matched</span></span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>then</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_32789..32791">nm</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="skolem"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.not_member|const"><span>â</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span> </span><span class="var"><span>?M</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_32164..32169"><span>invAB</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_32465..32471"><span>set_as</span></a><span> </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_32403..32407"><span>aseq</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>force</span></span><span>
      </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?THEN</span></span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>only</span></span><span class="main"><span class="main"><span>:</span></span></span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.mem_Collect_eq|fact"><span>mem_Collect_eq</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.case|fact"><span>prod.case</span></a><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>rule</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conjI|fact"><span>conjI</span></a><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>goal_cases</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_32965..32971">invAM'</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_15620..15625"><span>invAM</span></a><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.set|const"><span>set</span></a><span> </span><span class="skolem"><span>as'</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
          </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_15715..15726"><span>invAM_match</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_31964..31969"><span>invAM</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_32531..32532"><span>a</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_32789..32791"><span>nm</span></a><span class="main"><span>]</span></span><span> </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_32465..32471"><span>set_as</span></a><span class="main"><span>[</span></span><span class="operator"><span>symmetric</span></span><span class="main"><span>]</span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
        </span><span class="keyword1"><span class="command"><span>then</span></span></span><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_33097..33103">invAB'</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_30934..30940"><span>invAB'</span></a><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="main"><span>(</span></span><span class="skolem"><span>B</span></span><span class="main"><span>[</span></span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="skolem"><span>a</span></span><span> </span><span class="main"><span>:=</span></span><span> </span><span class="skolem"><span>a</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="skolem"><span>M</span></span><span class="main"><span>[</span></span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="skolem"><span>a</span></span><span> </span><span class="main"><span>:=</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.True|const"><span>True</span></a><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.set|const"><span>set</span></a><span> </span><span class="skolem"><span>as'</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
          </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_32164..32169"><span>invAB</span></a><span> </span><span class="quoted"><span class="quoted"><span>â¹</span><span class="var"><span>?not_matched</span></span><span>âº</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_32465..32471"><span>set_as</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5452..5464"><span>match_less_n</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_32011..32012"><span>A</span></a><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_32531..32532"><span>a</span></a><span>
          </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>auto</span></span><span> </span><span class="quasi_keyword"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image_def|fact"><span>image_def</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth_list_update|fact"><span>nth_list_update</span></a><span class="main"><span>)</span></span><span>
        </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>1</span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_32965..32971"><span>invAM'</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_32164..32169"><span>invAB</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_32145..32147"><span>as</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_33097..33103"><span>invAB'</span></a><span> </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_32465..32471"><span>set_as</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_32403..32407"><span>aseq</span></a><span>
          </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.distinct.simps|fact"><span>distinct.simps</span></a><span class="main"><span class="main"><span>(</span></span></span><span>2</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.insert_subset|fact"><span>insert_subset</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.simps|fact"><span>list.simps</span></a><span class="main"><span class="main"><span>(</span></span></span><span>15</span><span class="main"><span class="main"><span>)</span></span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>2</span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span>
          </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_10671..10680"><span>var_match</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_31988..31989"><span>m</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_32025..32026"><span>M</span></a><span> _ </span><a class="entity_ref" href="Gale_Shapley1.html#offset_32285..32296"><span>pref_match1</span></a><span class="main"><span>,</span></span><span> </span><span class="operator"><span>of</span></span><span> </span><span class="quoted"><span class="skolem"><span>a</span></span></span><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_32531..32532"><span>a</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Set_Interval.html#Set_Interval.atLeast0LessThan|fact"><span>atLeast0LessThan</span></a><span>
          </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_32465..32471"><span>set_as</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_32119..32120"><span>v</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>blast</span></span><span> 
      </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
      </span><span class="keyword3"><span class="command"><span>assume</span></span></span><span> </span><span class="entity_def" id="offset_33612..33619">matched</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>Â¬</span></a></span><span> </span><span class="var"><span>?not_matched</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>hence</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="skolem"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>â</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.insert|const"><span>insert</span></a><span> </span><span class="skolem"><span>a</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.set|const"><span>set</span></a><span> </span><span class="skolem"><span>as'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span>  </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5452..5464"><span>match_less_n</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_32011..32012"><span>A</span></a><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_32531..32532"><span>a</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_32164..32169"><span>invAB</span></a><span>
        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span class="main"><span>(</span></span><span class="operator"><span>auto</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>lifting</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image_eqI|fact"><span>image_eqI</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.simps|fact"><span>list.simps</span></a><span class="main"><span class="main"><span>(</span></span></span><span>15</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.mem_Collect_eq|fact"><span>mem_Collect_eq</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_32403..32407"><span>aseq</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span>hence</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.Suc|const"><span>Suc</span></a><span class="main"><span>(</span></span><span class="skolem"><span>A</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span class="skolem"><span>a</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>n</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_7212..7224"><span>more_choices</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_31988..31989"><span>m</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_32025..32026"><span>M</span></a><span class="main"><span>,</span></span><span> </span><span class="operator"><span>of</span></span><span> </span><span class="quoted"><span class="skolem"><span>a</span></span></span><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_32531..32532"><span>a</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_32285..32296"><span>pref_match1</span></a><span>
        </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_32403..32407"><span>aseq</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Set_Interval.html#Set_Interval.atLeast0LessThan|fact"><span>atLeast0LessThan</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>auto</span></span><span>
      </span><span class="keyword1"><span class="command"><span>let</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?a</span></span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>B</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="skolem"><span>a</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_33982..33984">a'</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="var"><span>?a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>â</span></a></span><span> </span><span class="var"><span>?M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="var"><span>?a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="skolem"><span>a</span></span><span>"</span></span></span><span>
        </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_32164..32169"><span>invAB</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5452..5464"><span>match_less_n</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_32011..32012"><span>A</span></a><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_33612..33619"><span>matched</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_32531..32532"><span>a</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>blast</span></span><span>
      </span><span class="keyword1"><span class="command"><span>hence</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="var"><span>?a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>n</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>â </span></a></span><span> </span><span class="var"><span>?a</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_32531..32532"><span>a</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>auto</span></span><span>
      </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?ELSE</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_32403..32407"><span>aseq</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Option.html#Option.option.sel|fact"><span>option.sel</span></a><span>
      </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>goal_cases</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>1</span><span>
        </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>is</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="var"><span>?pref</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>â¶</span></a></span><span> </span><span class="var"><span>?THEN</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>Â¬</span></a></span><span> </span><span class="var"><span>?pref</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>â¶</span></a></span><span> </span><span class="var"><span>?ELSE</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>rule</span></span><span class="main"><span class="keyword3"><span>;</span></span></span><span> </span><span class="operator"><span>rule</span></span><span class="main"><span>)</span></span><span>
          </span><span class="keyword3"><span class="command"><span>assume</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?pref</span></span></span></span><span>
          </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?THEN</span></span></span></span><span>
          </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>only</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.mem_Collect_eq|fact"><span>mem_Collect_eq</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.case|fact"><span>prod.case</span></a><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>rule</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conjI|fact"><span>conjI</span></a><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>goal_cases</span></span><span class="main"><span>)</span></span><span>
            </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_34436..34437">*</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.set|const"><span>set</span></a><span> </span><span class="skolem"><span>as</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="main"><span>{</span></span><span class="var"><span>?a</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.union|const"><span>âª</span></a></span><span> </span><span class="main"><span>{</span></span><span class="skolem"><span>a</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.set|const"><span>set</span></a><span> </span><span class="main"><span>(</span></span><span class="var"><span>?a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.Cons|const"><span>#</span></a></span><span> </span><span class="skolem"><span>as'</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_32531..32532"><span>a</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_33982..33984"><span>a'</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_32145..32147"><span>as</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_32403..32407"><span>aseq</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>auto</span></span><span>
            </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span>a'neq</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>â</span></span><span class="bound"><span class="bound"><span>b</span></span></span><span class="main"><span>&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>b</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>â </span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="skolem"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>â¶</span></a></span><span> </span><span class="skolem"><span>M</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span class="bound"><span>b</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>â¶</span></a></span><span> </span><span class="var"><span>?a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>â </span></a></span><span> </span><span class="skolem"><span>B</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span class="bound"><span>b</span></span><span>"</span></span></span><span>
              </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_32164..32169"><span>invAB</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_33982..33984"><span>a'</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>metis</span></span><span>
            </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_34637..34643">invAB'</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_30934..30940"><span>invAB'</span></a><span> </span><span class="main"><span>(</span></span><span class="skolem"><span>A</span></span><span class="main"><span>[</span></span><span class="var"><span>?a</span></span><span> </span><span class="main"><span>:=</span></span><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="var"><span>?a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="skolem"><span>B</span></span><span class="main"><span>[</span></span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="skolem"><span>a</span></span><span> </span><span class="main"><span>:=</span></span><span> </span><span class="skolem"><span>a</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="skolem"><span>M</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.set|const"><span>set</span></a><span> </span><span class="main"><span>(</span></span><span class="var"><span>?a</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.Cons|const"><span>#</span></a></span><span class="skolem"><span>as'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
              </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_32164..32169"><span>invAB</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_32403..32407"><span>aseq</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_34436..34437"><span>*</span></a><span> </span><span class="quoted"><span class="quoted"><span>â¹</span><span class="skolem"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>â </span></a></span><span> </span><span class="var"><span>?a</span></span><span>âº</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_33982..33984"><span>a'</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5452..5464"><span>match_less_n</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_32011..32012"><span>A</span></a><span class="main"><span>,</span></span><span> </span><span class="operator"><span>of</span></span><span> </span><span class="quoted"><span class="skolem"><span>a</span></span></span><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_32531..32532"><span>a</span></a><span>
              </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth_list_update|fact"><span>nth_list_update</span></a><span class="main"><span>)</span></span><span>
              </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>rule</span></span><span>
               </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span class="main"><span>(</span></span><span class="operator"><span>auto</span></span><span> </span><span class="quasi_keyword"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span>  </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image_def|fact"><span>image_def</span></a><span class="main"><span>)</span></span><span class="main"><span class="keyword3"><span>[</span></span></span><span class="main"><span class="keyword3"><span>]</span></span></span><span>
              </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>clarsimp</span></span><span> </span><span class="quasi_keyword"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5402..5412"><span>match_def</span></a><span class="main"><span>)</span></span><span>
              </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>opaque_lifting</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth_list_update_neq|fact"><span>nth_list_update_neq</span></a><span class="main"><span>)</span></span><span>
              </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>done</span></span></span></span></span><span>
            </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>1</span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_15844..15854"><span>invAM_swap</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_31964..31969"><span>invAM</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_32531..32532"><span>a</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_33982..33984"><span>a'</span></a><span> </span><span class="quoted"><span class="quoted"><span>â¹</span><span class="var"><span>?pref</span></span><span>âº</span></span></span><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_34637..34643"><span>invAB'</span></a><span> </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_34436..34437"><span>*</span></a><span>
              </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_33982..33984"><span>a'</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_32145..32147"><span>as</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_32403..32407"><span>aseq</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>auto</span></span><span class="main"><span>)</span></span><span>
            </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>2</span><span>
            </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Finite_Set.html#Finite_Set.card|const"><span>card</span></a><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.set|const"><span>set</span></a><span> </span><span class="skolem"><span>as</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Finite_Set.html#Finite_Set.card|const"><span>card</span></a><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.set|const"><span>set</span></a><span> </span><span class="main"><span>(</span></span><span class="var"><span>?a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.Cons|const"><span>#</span></a></span><span> </span><span class="skolem"><span>as'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_32531..32532"><span>a</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_33982..33984"><span>a'</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_32145..32147"><span>as</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_32403..32407"><span>aseq</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
            </span><span class="keyword3"><span class="command"><span>thus</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_32119..32120"><span>v</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_11417..11425"><span>var_next</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_31988..31989"><span>m</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_32025..32026"><span>M</span></a><span> _ </span><a class="entity_ref" href="Gale_Shapley1.html#offset_32285..32296"><span>pref_match1</span></a><span class="main"><span>,</span></span><span> </span><span class="operator"><span>of</span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?a</span></span></span></span><span class="main"><span>]</span></span><span> </span><span class="quoted"><span class="quoted"><span>â¹</span><span class="var"><span>?a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>n</span></span><span>âº</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_32531..32532"><span>a</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Set_Interval.html#Set_Interval.atLeast0LessThan|fact"><span>atLeast0LessThan</span></a><span>
              </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.Suc_eq_plus1|fact"><span>Suc_eq_plus1</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Set_Interval.html#Set_Interval.ord_class.lessThan_iff|fact"><span>lessThan_iff</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_4569..4579"><span>var_def</span></a><span class="main"><span>)</span></span><span>
          </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>
        </span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
          </span><span class="keyword3"><span class="command"><span>assume</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>Â¬</span></a></span><span> </span><span class="var"><span>?pref</span></span><span>"</span></span></span><span>
          </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?ELSE</span></span></span></span><span>
          </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>only</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.mem_Collect_eq|fact"><span>mem_Collect_eq</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.case|fact"><span>prod.case</span></a><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>rule</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conjI|fact"><span>conjI</span></a><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>goal_cases</span></span><span class="main"><span>)</span></span><span>
            </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>1</span><span>
            </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_30934..30940"><span>invAB'</span></a><span> </span><span class="main"><span>(</span></span><span class="skolem"><span>A</span></span><span class="main"><span>[</span></span><span class="skolem"><span>a</span></span><span> </span><span class="main"><span>:=</span></span><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="skolem"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="skolem"><span>B</span></span><span> </span><span class="skolem"><span>M</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.set|const"><span>set</span></a><span> </span><span class="skolem"><span>as</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_32164..32169"><span>invAB</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_32531..32532"><span>a</span></a><span> </span><span class="quoted"><span class="quoted"><span>â¹</span><span class="skolem"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>â </span></a></span><span> </span><span class="var"><span>?a</span></span><span>âº</span></span></span><span>
              </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5402..5412"><span>match_def</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth_list_update_neq|fact"><span>nth_list_update_neq</span></a><span class="main"><span>)</span></span><span>
            </span><span class="keyword3"><span class="command"><span>thus</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_17259..17269"><span>invAM_next</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_31964..31969"><span>invAM</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_32531..32532"><span>a</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_33982..33984"><span>a'</span></a><span> </span><span class="quoted"><span class="quoted"><span>â¹</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>Â¬</span></a></span><span> </span><span class="var"><span>?pref</span></span><span>âº</span></span></span><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_32145..32147"><span>as</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_32403..32407"><span>aseq</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>fastforce</span></span><span>
            </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>2</span><span>
            </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_32531..32532"><span>a</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_32119..32120"><span>v</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_11417..11425"><span>var_next</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_31988..31989"><span>m</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_32025..32026"><span>M</span></a><span> _ </span><a class="entity_ref" href="Gale_Shapley1.html#offset_32285..32296"><span>pref_match1</span></a><span class="main"><span>,</span></span><span> </span><span class="operator"><span>of</span></span><span> </span><span class="quoted"><span class="skolem"><span>a</span></span></span><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_32403..32407"><span>aseq</span></a><span>
              </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.Suc_eq_plus1|fact"><span>Suc_eq_plus1</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Set_Interval.html#Set_Interval.atLeast0LessThan|fact"><span>atLeast0LessThan</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Set_Interval.html#Set_Interval.ord_class.lessThan_iff|fact"><span>lessThan_iff</span></a><span class="main"><span>)</span></span><span> 
          </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>
        </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>

</span><span class="comment1"><span>(</span><span>*</span><span> end unused </span><span>*</span><span>)</span></span><span>


</span><span class="keyword1"><span class="command"><span>subsection</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>â¹</span><span>Algorithm 4: remove list of unmatched As</span><span>âº</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Gale_Shapley1.Pref.Gale_Shapley4|fact"><span class="entity_def" id="Gale_Shapley1.Pref.Gale_Shapley4|thm"><span>Gale_Shapley4</span></span></span><span class="main"><span>:</span></span><span>
</span><span class="quoted"><span class="quoted"><span>"</span><span class="keyword1"><span>VARS</span></span><span> </span><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span>A</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span> </span><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span>B</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span> </span><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span>ai</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span> </span><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span>a</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span> </span><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span>a'</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span>
 </span><span class="main"><span>[</span></span><span class="bound"><span>ai</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><span class="bound"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.replicate|const"><span>replicate</span></a><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><span class="bound"><span>B</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>Î»</span></span><span class="main"><span class="bound"><span>_</span></span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Option.html#Option.option.None|const"><span>None</span></a><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span>
 </span><span class="keyword1"><span>WHILE</span></span><span> </span><span class="bound"><span>ai</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>n</span></span><span>
 </span><span class="keyword1"><span>INV</span></span><span> </span><span class="main"><span>{</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_15620..15625"><span>invAM</span></a><span> </span><span class="bound"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="bound"><span>ai</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_25708..25713"><span>invAB</span></a><span> </span><span class="bound"><span>A</span></span><span> </span><span class="bound"><span>B</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="bound"><span>ai</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><span class="bound"><span>ai</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>â¤</span></a></span><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><span>}</span></span><span>
 </span><span class="keyword1"><span>VAR</span></span><span> </span><span class="main"><span>{</span></span><span class="bound"><span>z</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="bound"><span>ai</span></span><span class="main"><span>}</span></span><span>
 </span><span class="keyword1"><span>DO</span></span><span> a </span><span class="main"><span>:=</span></span><span> </span><span class="bound"><span>ai</span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword1"><span>WHILE</span></span><span> </span><span class="bound"><span>B</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="bound"><span>A</span></span><span> </span><span class="bound"><span>a</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>â </span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Option.html#Option.option.None|const"><span>None</span></a><span>
  </span><span class="keyword1"><span>INV</span></span><span> </span><span class="main"><span>{</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_15620..15625"><span>invAM</span></a><span> </span><span class="bound"><span>A</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="bound"><span>ai</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="main"><span>{</span></span><span class="bound"><span>a</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_25708..25713"><span>invAB</span></a><span> </span><span class="bound"><span>A</span></span><span> </span><span class="bound"><span>B</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="bound"><span>ai</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="main"><span>{</span></span><span class="bound"><span>a</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>â¤</span></a></span><span> </span><span class="bound"><span>ai</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><span class="bound"><span>ai</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>n</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><span class="bound"><span>z</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="bound"><span>ai</span></span><span> </span><span class="main"><span>}</span></span><span>
  </span><span class="keyword1"><span>VAR</span></span><span> </span><span class="main"><span>{</span></span><a class="entity_ref" href="Gale_Shapley1.html#offset_4580..4583"><span>var</span></a><span> </span><span class="bound"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="bound"><span>ai</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span class="main"><span>}</span></span><span>
  </span><span class="keyword1"><span>DO</span></span><span> a' </span><span class="main"><span>:=</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Option.html#Option.option.the|const"><span>the</span></a><span class="main"><span>(</span></span><span class="bound"><span>B</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="bound"><span>A</span></span><span> </span><span class="bound"><span>a</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span>
     </span><span class="keyword1"><span>IF</span></span><span> </span><span class="free"><span>P<span class="hidden">â©</span><sub>b</sub></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="bound"><span>A</span></span><span> </span><span class="bound"><span>a'</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.prefa|const"><span>â¢</span></a></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.prefa|const"><span>&lt;</span></a></span><span> </span><span class="bound"><span>a'</span></span><span>
     </span><span class="keyword1"><span>THEN</span></span><span> B </span><span class="main"><span>:=</span></span><span> </span><span class="bound"><span>B</span></span><span class="main"><span>(</span></span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="bound"><span>A</span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="main"><span>:=</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Option.html#Option.option.Some|const"><span>Some</span></a><span> </span><span class="bound"><span>a</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>A</span></span><span class="main"><span>[</span></span><span class="bound"><span>a'</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>:=</span></span><span> </span><span class="bound"><span>A</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span class="bound"><span>a'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>;</span></span><span> a </span><span class="main"><span>:=</span></span><span> </span><span class="bound"><span>a'</span></span><span>
     </span><span class="keyword1"><span>ELSE</span></span><span> </span><span class="bound"><span>A</span></span><span class="main"><span>[</span></span><span class="bound"><span>a</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>:=</span></span><span> </span><span class="bound"><span>A</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span class="bound"><span>a</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span>
     </span><span class="keyword1"><span>FI</span></span><span>
  </span><span class="keyword1"><span>OD</span></span><span class="main"><span>;</span></span><span>
  B </span><span class="main"><span>:=</span></span><span> </span><span class="bound"><span>B</span></span><span class="main"><span>(</span></span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="bound"><span>A</span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="main"><span>:=</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Option.html#Option.option.Some|const"><span>Some</span></a><span> </span><span class="bound"><span>a</span></span><span class="main"><span>)</span></span><span class="main"><span>;</span></span><span> ai </span><span class="main"><span>:=</span></span><span> </span><span class="bound"><span>ai</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span>
 </span><span class="keyword1"><span>OD</span></span><span>
 </span><span class="main"><span>[</span></span><a class="entity_ref" href="Gale_Shapley1.html#offset_6118..6126"><span>matching</span></a><span> </span><span class="bound"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5827..5833"><span>stable</span></a><span> </span><span class="bound"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_13003..13009"><span>opti<span class="hidden">â©</span><sub>a</sub></span></a><span> </span><span class="bound"><span>A</span></span><span class="main"><span>]</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL-Hoare/Hoare_Logic.html#Hoare_Logic.vcg_tc|method"><span class="operator"><span>vcg_tc</span></span></a><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>goal_cases</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>1</span><span> </span><span class="keyword3"><span class="command"><span>thus</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span>  </span><span class="comment1"><span>(</span><span>*</span><span> outer invar holds initially </span><span>*</span><span>)</span></span><span>
   </span><span class="keyword1"><span class="command"><span>by</span></span></span><span class="main"><span>(</span></span><span class="operator"><span>auto</span></span><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5816..5826"><span>stable_def</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_12328..12338"><span>pref_match_def</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_2342..2349"><span>P<span class="hidden">â©</span><sub>a</sub>_set</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.card_distinct|fact"><span>card_distinct</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5402..5412"><span>match_def</span></a><span> </span><a class="entity_ref" href="../List-Index/List_Index.html#List_Index.index_nth_id|fact"><span>index_nth_id</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.prefers_def|fact"><span>prefers_def</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_12992..13002"><span>opti<span class="hidden">â©</span><sub>a</sub>_def</span></a><span class="main"><span>)</span></span><span class="main"><span class="keyword3"><span>[</span></span></span><span class="main"><span class="keyword3"><span>]</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
  </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>2</span><span> </span><span class="comment1"><span>(</span><span>*</span><span> outer invar and b ibplies inner invar </span><span>*</span><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>thus</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>auto</span></span><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set_Interval.html#Set_Interval.atLeastLessThanSuc_atLeastAtMost|fact"><span>atLeastLessThanSuc_atLeastAtMost</span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>flip</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set_Interval.html#Set_Interval.order_class.atLeastLessThan_eq_atLeastAtMost_diff|fact"><span>atLeastLessThan_eq_atLeastAtMost_diff</span></a><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
  </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity_def" id="offset_37106..37107">4</span><span> </span><span class="skolem"><span>z</span></span><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="skolem"><span>B</span></span><span> </span><span class="skolem"><span>ai</span></span><span> </span><span class="skolem"><span>a</span></span><span class="main"><span>)</span></span><span> </span><span class="comment1"><span>(</span><span>*</span><span> inner invar' and not b ibplies outer invar </span><span>*</span><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>note</span></span></span><span> </span><span class="entity_def" id="offset_37176..37179">inv</span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_37106..37107"><span>4</span></a><span class="main"><span>[</span></span><span class="operator"><span>THEN</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conjunct1|fact"><span>conjunct1</span></a><span class="main"><span>]</span></span><span>
  </span><span class="keyword1"><span class="command"><span>note</span></span></span><span> </span><span class="entity_def" id="offset_37207..37212">invAM</span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_37176..37179"><span>inv</span></a><span class="main"><span>[</span></span><span class="operator"><span>THEN</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conjunct1|fact"><span>conjunct1</span></a><span class="main"><span>]</span></span><span>
  </span><span class="keyword1"><span class="command"><span>note</span></span></span><span> </span><span class="entity_def" id="offset_37242..37245">aai</span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_37176..37179"><span>inv</span></a><span class="main"><span>[</span></span><span class="operator"><span>THEN</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conjunct2|fact"><span>conjunct2</span></a><span class="main"><span>,</span></span><span class="operator"><span>THEN</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conjunct2|fact"><span>conjunct2</span></a><span class="main"><span>]</span></span><span>
  </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>only</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.mem_Collect_eq|fact"><span>mem_Collect_eq</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.case|fact"><span>prod.case</span></a><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>rule</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conjI|fact"><span>conjI</span></a><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>goal_cases</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>1</span><span>
    </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_37386..37387">*</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.Suc|const"><span>Suc</span></a><span> </span><span class="skolem"><span>ai</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.insert|const"><span>insert</span></a><span> </span><span class="skolem"><span>a</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.Suc|const"><span>Suc</span></a><span> </span><span class="skolem"><span>ai</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="main"><span>{</span></span><span class="skolem"><span>a</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_37242..37245"><span>aai</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.insert_absorb|fact"><span>insert_absorb</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_37478..37480">**</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.inj_on|const"><span>inj_on</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="skolem"><span>A</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.Suc|const"><span>Suc</span></a><span> </span><span class="skolem"><span>ai</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.inj_on|const"><span>inj_on</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="skolem"><span>A</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.Suc|const"><span>Suc</span></a><span> </span><span class="skolem"><span>ai</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="main"><span>{</span></span><span class="skolem"><span>a</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="skolem"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.not_member|const"><span>â</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.Suc|const"><span>Suc</span></a><span> </span><span class="skolem"><span>ai</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="main"><span>{</span></span><span class="skolem"><span>a</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_37386..37387"><span>*</span></a><span>"</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.Diff_idemp|fact"><span>Diff_idemp</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.inj_on_insert|fact"><span>inj_on_insert</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_37647..37649">nm</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="skolem"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.not_member|const"><span>â</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.Suc|const"><span>Suc</span></a><span> </span><span class="skolem"><span>ai</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="main"><span>{</span></span><span class="skolem"><span>a</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_37106..37107"><span>4</span></a><span> </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Map.html#Map.ran_def|fact"><span>ran_def</span></a><span>
        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>clarsimp</span></span><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.set_eq_iff|fact"><span>set_eq_iff</span></a><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Option.html#Option.not_None_eq|fact"><span>not_None_eq</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_37793..37799">invAM'</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_15620..15625"><span>invAM</span></a><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="skolem"><span>ai</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_15715..15726"><span>invAM_match</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_37207..37212"><span>invAM</span></a><span class="main"><span>,</span></span><span> </span><span class="operator"><span>of</span></span><span> </span><span class="quoted"><span class="skolem"><span>a</span></span></span><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_37242..37245"><span>aai</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_37647..37649"><span>nm</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_37478..37480"><span>**</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.insert_absorb|fact"><span>insert_absorb</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_37106..37107"><span>4</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_37793..37799"><span>invAM'</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.insert_absorb|fact"><span>insert_absorb</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
    </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>2</span><span> </span><span class="keyword3"><span class="command"><span>thus</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_37106..37107"><span>4</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>auto</span></span><span>
  </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
  </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>5</span><span> </span><span class="comment1"><span>(</span><span>*</span><span> outer invar and not b implies post </span><span>*</span><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>thus</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_15395..15412"><span>pref_match_stable</span></a><span> </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_15609..15619"><span>invAM_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.le_neq_implies_less|fact"><span>le_neq_implies_less</span></a><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
  </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity_def" id="offset_38164..38165">3</span><span> </span><span class="skolem"><span>z</span></span><span> </span><span class="skolem"><span>v</span></span><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="skolem"><span>B</span></span><span> </span><span class="skolem"><span>ai</span></span><span> </span><span class="skolem"><span>a</span></span><span> </span><span class="skolem"><span>a'</span></span><span class="main"><span>)</span></span><span> </span><span class="comment1"><span>(</span><span>*</span><span> preservation of inner invar </span><span>*</span><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>let</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?M</span></span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="skolem"><span>ai</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="main"><span>{</span></span><span class="skolem"><span>a</span></span><span class="main"><span>}</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_38251..38256">invAM</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_15620..15625"><span>invAM</span></a><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="var"><span>?M</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity_def" id="offset_38275..38276">m</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_6118..6126"><span>matching</span></a><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="var"><span>?M</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity_def" id="offset_38298..38299">A</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_2486..2488"><span>wf</span></a><span> </span><span class="skolem"><span>A</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity_def" id="offset_38312..38313">M</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="var"><span>?M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>â</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity_def" id="offset_38335..38345">pref_match</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_12339..12349"><span>pref_match</span></a><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="var"><span>?M</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity_def" id="offset_38369..38376">matched</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>B</span></span><span class="main"><span>(</span></span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="skolem"><span>a</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>â </span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Option.html#Option.option.None|const"><span>None</span></a><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>â¤</span></a></span><span> </span><span class="skolem"><span>ai</span></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity_def" id="offset_38421..38422">v</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_4580..4583"><span>var</span></a><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="var"><span>?M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="skolem"><span>v</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span>as</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>â¤</span></a></span><span> </span><span class="skolem"><span>ai</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><span class="skolem"><span>ai</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>n</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity_def" id="offset_38469..38474">invAB</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_25708..25713"><span>invAB</span></a><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="skolem"><span>B</span></span><span> </span><span class="var"><span>?M</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_38164..38165"><span>3</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>auto</span></span><span>
  </span><span class="keyword1"><span class="command"><span>note</span></span></span><span> </span><span class="entity_def" id="offset_38514..38519">invar</span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_38164..38165"><span>3</span></a><span class="main"><span>[</span></span><span class="operator"><span>THEN</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conjunct1|fact"><span>conjunct1</span></a><span class="main"><span>,</span></span><span class="operator"><span>THEN</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conjunct1|fact"><span>conjunct1</span></a><span class="main"><span>]</span></span><span>
  </span><span class="keyword1"><span class="command"><span>note</span></span></span><span> </span><span>pref_match'</span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_38335..38345"><span>pref_match</span></a><span class="main"><span>[</span></span><span class="operator"><span>THEN</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_12582..12597"><span>pref_match'_iff</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_38298..38299"><span>A</span></a><span class="main"><span class="main"><span>,</span></span></span><span> </span><span class="operator"><span>THEN</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.iffD2|fact"><span>iffD2</span></a><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>]</span></span><span>
  </span><span class="keyword1"><span class="command"><span>hence</span></span></span><span> </span><span class="entity_def" id="offset_38635..38646">pref_match1</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>â</span></span><span class="bound"><span class="bound"><span>a</span></span></span><span class="main"><span>&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_6050..6059"><span>preferred</span></a><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>â</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span> </span><span class="var"><span>?M</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_12457..12467"><span>pref_match'_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>blast</span></span><span>
  </span><span class="keyword1"><span class="command"><span>from</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_38369..38376"><span>matched</span></a><span> </span><span class="keyword3"><span class="command"><span>obtain</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>a'</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="entity_def" id="offset_38751..38755">a'eq</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>B</span></span><span class="main"><span>(</span></span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="skolem"><span>a</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Option.html#Option.option.Some|const"><span>Some</span></a><span> </span><span class="skolem"><span>a'</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>auto</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_38797..38799">a'</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>a'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>â</span></a></span><span> </span><span class="var"><span>?M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="skolem"><span>a'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="skolem"><span>a</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_38751..38755"><span>a'eq</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_38469..38474"><span>invAB</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Map.html#Map.ranI|fact"><span>ranI</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_38876..38877">a</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><span class="skolem"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.not_member|const"><span>â</span></a></span><span> </span><span class="var"><span>?M</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_38514..38519"><span>invar</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>auto</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="var"><span>?M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>â </span></a></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>a'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>n</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_38312..38313"><span>M</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_38876..38877"><span>a</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_38797..38799"><span>a'</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Set_Interval.html#Set_Interval.atLeast0LessThan|fact"><span>atLeast0LessThan</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>auto</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_38993..38997">card</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Finite_Set.html#Finite_Set.card|const"><span>card</span></a><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="skolem"><span>ai</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Finite_Set.html#Finite_Set.card|const"><span>card</span></a><span> </span><span class="var"><span>?M</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>â¹</span><span class="skolem"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>â¤</span></a></span><span> </span><span class="skolem"><span>ai</span></span><span>âº</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
  </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_38751..38755"><span>a'eq</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Option.html#Option.option.sel|fact"><span>option.sel</span></a><span>
  </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>goal_cases</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>1</span><span>
    </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>is</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="var"><span>?unstab</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>â¶</span></a></span><span> </span><span class="var"><span>?THEN</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>Â¬</span></a></span><span> </span><span class="var"><span>?unstab</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>â¶</span></a></span><span> </span><span class="var"><span>?ELSE</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>rule</span></span><span class="main"><span class="keyword3"><span>;</span></span></span><span> </span><span class="operator"><span>rule</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword3"><span class="command"><span>assume</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?unstab</span></span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_39233..39234">*</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="skolem"><span>ai</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="main"><span>{</span></span><span class="skolem"><span>a</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="main"><span>{</span></span><span class="skolem"><span>a'</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.union|const"><span>âª</span></a></span><span> </span><span class="main"><span>{</span></span><span class="skolem"><span>a</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="skolem"><span>ai</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="main"><span>{</span></span><span class="skolem"><span>a'</span></span><span class="main"><span>}</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_38514..38519"><span>invar</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_38797..38799"><span>a'</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>auto</span></span><span>
      </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?THEN</span></span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>only</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.mem_Collect_eq|fact"><span>mem_Collect_eq</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.case|fact"><span>prod.case</span></a><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>rule</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conjI|fact"><span>conjI</span></a><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>goal_cases</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_39413..39420">inj_dom</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.inj_on|const"><span>inj_on</span></a><span> </span><span class="skolem"><span>B</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/Map.html#Map.dom|const"><span>dom</span></a><span> </span><span class="skolem"><span>B</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>mono_tags</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Map.html#Map.domD|fact"><span>domD</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.inj_onI|fact"><span>inj_onI</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_38469..38474"><span>invAB</span></a><span class="main"><span>)</span></span><span>
        </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_39496..39502">invAB'</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_25708..25713"><span>invAB</span></a><span> </span><span class="main"><span>(</span></span><span class="skolem"><span>A</span></span><span class="main"><span>[</span></span><span class="skolem"><span>a'</span></span><span> </span><span class="main"><span>:=</span></span><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="skolem"><span>a'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="skolem"><span>B</span></span><span class="main"><span>(</span></span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="skolem"><span>a</span></span><span> </span><span class="main"><span>â¦</span></span><span> </span><span class="skolem"><span>a</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="skolem"><span>ai</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="main"><span>{</span></span><span class="skolem"><span>a'</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
          </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_25847..25857"><span>invAB_swap</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_38469..38474"><span>invAB</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_38876..38877"><span>a</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_38797..38799"><span>a'</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_39413..39420"><span>inj_dom</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_38751..38755"><span>a'eq</span></a><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_39233..39234"><span>*</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
        </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>1</span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span>
          </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_15844..15854"><span>invAM_swap</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_38251..38256"><span>invAM</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_38876..38877"><span>a</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_38797..38799"><span>a'</span></a><span> </span><span class="quoted"><span class="quoted"><span>â¹</span><span class="var"><span>?unstab</span></span><span>âº</span></span></span><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_39496..39502"><span>invAB'</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_38514..38519"><span>invar</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_38797..38799"><span>a'</span></a><span> </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_39233..39234"><span>*</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
        </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>2</span><span>
        </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_38421..38422"><span>v</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_11417..11425"><span>var_next</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_38275..38276"><span>m</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_38312..38313"><span>M</span></a><span> </span><span class="quoted"><span class="quoted"><span>â¹</span><span class="var"><span>?M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>â </span></a></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span>âº</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_38635..38646"><span>pref_match1</span></a><span> </span><span class="quoted"><span class="quoted"><span>â¹</span><span class="skolem"><span>a'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>n</span></span><span>âº</span></span></span><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_38993..38997"><span>card</span></a><span>
          </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_4569..4579"><span>var_def</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.Suc_eq_plus1|fact"><span>Suc_eq_plus1</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.psubset_eq|fact"><span>psubset_eq</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
      </span><span class="keyword3"><span class="command"><span>assume</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>Â¬</span></a></span><span> </span><span class="var"><span>?unstab</span></span><span>"</span></span></span><span>
      </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?ELSE</span></span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>only</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.mem_Collect_eq|fact"><span>mem_Collect_eq</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.case|fact"><span>prod.case</span></a><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>rule</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conjI|fact"><span>conjI</span></a><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>goal_cases</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_40062..40063">*</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>â</span></a></span><span class="bound"><span>b</span></span><span> </span><span class="bound"><span>a'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>.</span></a></span><span> </span><span class="skolem"><span>B</span></span><span> </span><span class="bound"><span>b</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Option.html#Option.option.Some|const"><span>Some</span></a><span> </span><span class="bound"><span>a'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>â¶</span></a></span><span> </span><span class="skolem"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>â </span></a></span><span> </span><span class="bound"><span>a'</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_38469..38474"><span>invAB</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Map.html#Map.ranI|fact"><span>ranI</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_38876..38877"><span>a</span></a><span class="main"><span>)</span></span><span> 
        </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>1</span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_17259..17269"><span>invAM_next</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_38251..38256"><span>invAM</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_38876..38877"><span>a</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_38797..38799"><span>a'</span></a><span> </span><span class="quoted"><span class="quoted"><span>â¹</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>Â¬</span></a></span><span> </span><span class="var"><span>?unstab</span></span><span>âº</span></span></span><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_38514..38519"><span>invar</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_40062..40063"><span>*</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5402..5412"><span>match_def</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
        </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>2</span><span>
        </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_38421..38422"><span>v</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_11417..11425"><span>var_next</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_38275..38276"><span>m</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_38312..38313"><span>M</span></a><span> </span><span class="quoted"><span class="quoted"><span>â¹</span><span class="var"><span>?M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>â </span></a></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span>âº</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_38635..38646"><span>pref_match1</span></a><span class="main"><span>,</span></span><span> </span><span class="operator"><span>of</span></span><span> </span><span class="quoted"><span class="skolem"><span>a</span></span></span><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_38876..38877"><span>a</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_38993..38997"><span>card</span></a><span>
          </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.Suc_eq_plus1|fact"><span>Suc_eq_plus1</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_4569..4579"><span>var_def</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="Gale_Shapley1.Pref.\&lt;alpha&gt;_def|fact"><span class="entity_def" id="Gale_Shapley1.Pref.\&lt;alpha&gt;_def|thm"><span class="entity_def" id="Gale_Shapley1.Pref.\&lt;alpha&gt;_def_raw|axiom"><span class="entity_def" id="offset_40403..40413">definition</span></span></span></span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="Gale_Shapley1.Pref.\&lt;alpha&gt;.cong|fact"><span class="entity_def" id="Gale_Shapley1.Pref.\&lt;alpha&gt;.cong|thm"><span class="entity_def" id="Gale_Shapley1.Pref.\&lt;alpha&gt;|const"><span class="entity_def" id="offset_40415..40416">Î±</span></span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>B</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>M</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>Î»</span></span><span class="bound"><span>b</span></span><span class="main"><span>.</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>if</span></a></span><span> </span><span class="bound"><span>b</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>M</span></span></span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span class="bound"><span>b</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>then</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Option.html#Option.option.Some|const"><span>Some</span></a><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>B</span></span></span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span class="bound"><span>b</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>else</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Option.html#Option.option.None|const"><span>None</span></a><span class="main"><span>)</span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Gale_Shapley1.Pref.\&lt;alpha&gt;_Some|fact"><span class="entity_def" id="Gale_Shapley1.Pref.\&lt;alpha&gt;_Some|thm"><span class="entity_def" id="offset_40477..40483">Î±_Some</span></span></span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_40415..40416"><span>Î±</span></a><span> </span><span class="free"><span>B</span></span><span> </span><span class="free"><span>M</span></span><span> </span><span class="free"><span>b</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Option.html#Option.option.Some|const"><span>Some</span></a><span> </span><span class="free"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.iff|const"><span>â·</span></a></span><span> </span><span class="free"><span>b</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><span class="free"><span>M</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span class="free"><span>b</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><span class="free"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>B</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span class="free"><span>b</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>by</span></span></span><span class="main"><span>(</span></span><span class="operator"><span>auto</span></span><span> </span><span class="quasi_keyword"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_40403..40413"><span>Î±_def</span></a><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Gale_Shapley1.Pref.\&lt;alpha&gt;update1|fact"><span class="entity_def" id="Gale_Shapley1.Pref.\&lt;alpha&gt;update1|thm"><span class="entity_def" id="offset_40566..40574">Î±update1</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>â¦</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>Â¬</span></a></span><span> </span><span class="free"><span>M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="free"><span>b</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>b</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.length|const"><span>length</span></a><span> </span><span class="free"><span>B</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>b</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.length|const"><span>length</span></a><span> </span><span class="free"><span>M</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.length|const"><span>length</span></a><span> </span><span class="free"><span>M</span></span><span> </span><span class="main"><span>â§</span></span><span>
 </span><span class="main"><span>â¹</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Map.html#Map.ran|const"><span>ran</span></a><span class="main"><span>(</span></span><a class="entity_ref" href="Gale_Shapley1.html#offset_40415..40416"><span>Î±</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>B</span></span><span class="main"><span>[</span></span><span class="free"><span>b</span></span><span> </span><span class="main"><span>:=</span></span><span> </span><span class="free"><span>a</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>M</span></span><span class="main"><span>[</span></span><span class="free"><span>b</span></span><span> </span><span class="main"><span>:=</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.True|const"><span>True</span></a><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Map.html#Map.ran|const"><span>ran</span></a><span class="main"><span>(</span></span><a class="entity_ref" href="Gale_Shapley1.html#offset_40415..40416"><span>Î±</span></a><span> </span><span class="free"><span>B</span></span><span> </span><span class="free"><span>M</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.union|const"><span>âª</span></a></span><span> </span><span class="main"><span>{</span></span><span class="free"><span>a</span></span><span class="main"><span>}</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>by</span></span></span><span class="main"><span>(</span></span><span class="operator"><span>force</span></span><span> </span><span class="quasi_keyword"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_40403..40413"><span>Î±_def</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Map.html#Map.ran_def|fact"><span>ran_def</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth_list_update|fact"><span>nth_list_update</span></a><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Gale_Shapley1.Pref.\&lt;alpha&gt;update2|fact"><span class="entity_def" id="Gale_Shapley1.Pref.\&lt;alpha&gt;update2|thm"><span class="entity_def" id="offset_40745..40753">Î±update2</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>â¦</span></span><span> </span><span class="free"><span>M</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span class="free"><span>b</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>b</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.length|const"><span>length</span></a><span> </span><span class="free"><span>B</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>b</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.length|const"><span>length</span></a><span> </span><span class="free"><span>M</span></span><span class="main"><span>;</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.length|const"><span>length</span></a><span> </span><span class="free"><span>M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><span>â§</span></span><span>
 </span><span class="main"><span>â¹</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_40415..40416"><span>Î±</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>B</span></span><span class="main"><span>[</span></span><span class="free"><span>b</span></span><span> </span><span class="main"><span>:=</span></span><span> </span><span class="free"><span>a</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Gale_Shapley1.html#offset_40415..40416"><span>Î±</span></a><span> </span><span class="free"><span>B</span></span><span> </span><span class="free"><span>M</span></span><span class="main"><span>)</span></span><span class="main"><span>(</span></span><span class="free"><span>b</span></span><span> </span><span class="main"><span>:=</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Option.html#Option.option.Some|const"><span>Some</span></a><span> </span><span class="free"><span>a</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>by</span></span></span><span class="main"><span>(</span></span><span class="operator"><span>force</span></span><span> </span><span class="quasi_keyword"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_40403..40413"><span>Î±_def</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth_list_update|fact"><span>nth_list_update</span></a><span class="main"><span>)</span></span><span>

 
</span><span class="keyword1"><span class="command"><span>abbreviation</span></span></span><span> </span><span class="entity"><span class="entity_def" id="Gale_Shapley1.Pref.invAB2|const"><span class="entity_def" id="offset_40907..40913">invAB2</span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.nat|type"><span>nat</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list|type"><span>list</span></a><span> </span><span class="main"><span>â</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.nat|type"><span>nat</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list|type"><span>list</span></a><span> </span><span class="main"><span>â</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.bool|type"><span>bool</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list|type"><span>list</span></a><span> </span><span class="main"><span>â</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.nat|type"><span>nat</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.set|type"><span>set</span></a><span> </span><span class="main"><span>â</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.bool|type"><span>bool</span></a><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
</span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>invAB2</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>A</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>B</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>M</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>M'</span></span></span></span><span> </span><span class="main"><span>==</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Gale_Shapley1.html#offset_25708..25713"><span>invAB</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>A</span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Gale_Shapley1.html#offset_40415..40416"><span>Î±</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>B</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>M</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>M'</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/List.html#List.length|const"><span>length</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>B</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.length|const"><span>length</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>M</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>n</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="Gale_Shapley1.Pref.invar1_def|fact"><span class="entity_def" id="Gale_Shapley1.Pref.invar1_def|thm"><span class="entity_def" id="Gale_Shapley1.Pref.invar1_def_raw|axiom"><span class="entity_def" id="offset_41049..41059">definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="Gale_Shapley1.Pref.invar1.cong|fact"><span class="entity_def" id="Gale_Shapley1.Pref.invar1.cong|thm"><span class="entity_def" id="Gale_Shapley1.Pref.invar1|const"><span class="entity_def" id="offset_41060..41066">invar1</span></span></span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
</span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>invar1</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>A</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>B</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>M</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>ai</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Gale_Shapley1.html#offset_15620..15625"><span>invAM</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>A</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span class="bound"><span class="entity"><span>ai</span></span></span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_40907..40913"><span>invAB2</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>A</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>B</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>M</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span class="bound"><span class="entity"><span>ai</span></span></span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>ai</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>â¤</span></a></span><span> </span><span class="free"><span>n</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="Gale_Shapley1.Pref.invar2_def|fact"><span class="entity_def" id="Gale_Shapley1.Pref.invar2_def|thm"><span class="entity_def" id="Gale_Shapley1.Pref.invar2_def_raw|axiom"><span class="entity_def" id="offset_41148..41158">definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="Gale_Shapley1.Pref.invar2.cong|fact"><span class="entity_def" id="Gale_Shapley1.Pref.invar2.cong|thm"><span class="entity_def" id="Gale_Shapley1.Pref.invar2|const"><span class="entity_def" id="offset_41159..41165">invar2</span></span></span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
</span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>invar2</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>A</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>B</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>M</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>ai</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>a</span></span></span></span><span> </span><span class="main"><span>â¡</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Gale_Shapley1.html#offset_15620..15625"><span>invAM</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>A</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span class="bound"><span class="entity"><span>ai</span></span></span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="main"><span>{</span></span><span class="free"><span class="bound"><span class="entity"><span>a</span></span></span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_40907..40913"><span>invAB2</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>A</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>B</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>M</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span class="bound"><span class="entity"><span>ai</span></span></span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="main"><span>{</span></span><span class="free"><span class="bound"><span class="entity"><span>a</span></span></span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>a</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>â¤</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>ai</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>ai</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>n</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>


</span><span class="keyword1"><span class="command"><span>subsection</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>â¹</span><span>Algorithm 5: Data refinement of </span><span class="antiquoted"><span class="raw_text"><span class="operator"><span>â¹</span></span><span>Bâº</span></span></span><span>âº</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Gale_Shapley1.Pref.Gale_Shapley5|fact"><span class="entity_def" id="Gale_Shapley1.Pref.Gale_Shapley5|thm"><span>Gale_Shapley5</span></span></span><span class="main"><span>:</span></span><span>
</span><span class="quoted"><span class="quoted"><span>"</span><span class="keyword1"><span>VARS</span></span><span> </span><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span>A</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span> </span><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span>B</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span> </span><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span>M</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span> </span><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span>ai</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span> </span><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span>a</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span> </span><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span>a'</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span>
 </span><span class="main"><span>[</span></span><span class="bound"><span>ai</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><span class="bound"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.replicate|const"><span>replicate</span></a><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.length|const"><span>length</span></a><span> </span><span class="bound"><span>B</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><span class="bound"><span>M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.replicate|const"><span>replicate</span></a><span> </span><span class="free"><span>n</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.False|const"><span>False</span></a><span class="main"><span>]</span></span><span>
 </span><span class="keyword1"><span>WHILE</span></span><span> </span><span class="bound"><span>ai</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>n</span></span><span>
 </span><span class="keyword1"><span>INV</span></span><span> </span><span class="main"><span>{</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_41060..41066"><span>invar1</span></a><span> </span><span class="bound"><span>A</span></span><span> </span><span class="bound"><span>B</span></span><span> </span><span class="bound"><span>M</span></span><span> </span><span class="bound"><span>ai</span></span><span> </span><span class="main"><span>}</span></span><span>
 </span><span class="keyword1"><span>VAR</span></span><span> </span><span class="main"><span>{</span></span><span> </span><span class="bound"><span>z</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="bound"><span>ai</span></span><span class="main"><span>}</span></span><span>
 </span><span class="keyword1"><span>DO</span></span><span> a </span><span class="main"><span>:=</span></span><span> </span><span class="bound"><span>ai</span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword1"><span>WHILE</span></span><span> </span><span class="bound"><span>M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="bound"><span>A</span></span><span> </span><span class="bound"><span>a</span></span><span>
  </span><span class="keyword1"><span>INV</span></span><span> </span><span class="main"><span>{</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_41159..41165"><span>invar2</span></a><span> </span><span class="bound"><span>A</span></span><span> </span><span class="bound"><span>B</span></span><span> </span><span class="bound"><span>M</span></span><span> </span><span class="bound"><span>ai</span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><span class="bound"><span>z</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="bound"><span>ai</span></span><span> </span><span class="main"><span>}</span></span><span>
  </span><span class="keyword1"><span>VAR</span></span><span> </span><span class="main"><span>{</span></span><a class="entity_ref" href="Gale_Shapley1.html#offset_4580..4583"><span>var</span></a><span> </span><span class="bound"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="bound"><span>ai</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span class="main"><span>}</span></span><span>
  </span><span class="keyword1"><span>DO</span></span><span> a' </span><span class="main"><span>:=</span></span><span> </span><span class="bound"><span>B</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="bound"><span>A</span></span><span> </span><span class="bound"><span>a</span></span><span class="main"><span>;</span></span><span>
     </span><span class="keyword1"><span>IF</span></span><span> </span><span class="free"><span>P<span class="hidden">â©</span><sub>b</sub></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="bound"><span>A</span></span><span> </span><span class="bound"><span>a'</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.prefa|const"><span>â¢</span></a></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.prefa|const"><span>&lt;</span></a></span><span> </span><span class="bound"><span>a'</span></span><span>
     </span><span class="keyword1"><span>THEN</span></span><span> </span><span class="bound"><span>B</span></span><span class="main"><span>[</span></span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="bound"><span>A</span></span><span> </span><span class="bound"><span>a</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>:=</span></span><span> </span><span class="bound"><span>a</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>A</span></span><span class="main"><span>[</span></span><span class="bound"><span>a'</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>:=</span></span><span> </span><span class="bound"><span>A</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span class="bound"><span>a'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>;</span></span><span> a </span><span class="main"><span>:=</span></span><span> </span><span class="bound"><span>a'</span></span><span>
     </span><span class="keyword1"><span>ELSE</span></span><span> </span><span class="bound"><span>A</span></span><span class="main"><span>[</span></span><span class="bound"><span>a</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>:=</span></span><span> </span><span class="bound"><span>A</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span class="bound"><span>a</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span>
     </span><span class="keyword1"><span>FI</span></span><span>
  </span><span class="keyword1"><span>OD</span></span><span class="main"><span>;</span></span><span>
  </span><span class="bound"><span>B</span></span><span class="main"><span>[</span></span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="bound"><span>A</span></span><span> </span><span class="bound"><span>a</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>:=</span></span><span> </span><span class="bound"><span>a</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>M</span></span><span class="main"><span>[</span></span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="bound"><span>A</span></span><span> </span><span class="bound"><span>a</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>:=</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.True|const"><span>True</span></a><span class="main"><span>;</span></span><span> ai </span><span class="main"><span>:=</span></span><span> </span><span class="bound"><span>ai</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span>
 </span><span class="keyword1"><span>OD</span></span><span>
 </span><span class="main"><span>[</span></span><a class="entity_ref" href="Gale_Shapley1.html#offset_6118..6126"><span>matching</span></a><span> </span><span class="bound"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5827..5833"><span>stable</span></a><span> </span><span class="bound"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_13003..13009"><span>opti<span class="hidden">â©</span><sub>a</sub></span></a><span> </span><span class="bound"><span>A</span></span><span class="main"><span>]</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL-Hoare/Hoare_Logic.html#Hoare_Logic.vcg_tc|method"><span class="operator"><span>vcg_tc</span></span></a><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>goal_cases</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>1</span><span> </span><span class="keyword3"><span class="command"><span>thus</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span>  </span><span class="comment1"><span>(</span><span>*</span><span> outer invar holds initially </span><span>*</span><span>)</span></span><span>
   </span><span class="keyword1"><span class="command"><span>by</span></span></span><span class="main"><span>(</span></span><span class="operator"><span>auto</span></span><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5816..5826"><span>stable_def</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_12328..12338"><span>pref_match_def</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_2342..2349"><span>P<span class="hidden">â©</span><sub>a</sub>_set</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.card_distinct|fact"><span>card_distinct</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5402..5412"><span>match_def</span></a><span> </span><a class="entity_ref" href="../List-Index/List_Index.html#List_Index.index_nth_id|fact"><span>index_nth_id</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.prefers_def|fact"><span>prefers_def</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_12992..13002"><span>opti<span class="hidden">â©</span><sub>a</sub>_def</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_40403..40413"><span>Î±_def</span></a><span> </span><span class="quasi_keyword"><span>cong</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj_cong|fact"><span>conj_cong</span></a><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
  </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>2</span><span> </span><span class="comment1"><span>(</span><span>*</span><span> outer invar and b ibplies inner invar </span><span>*</span><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>thus</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>auto</span></span><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set_Interval.html#Set_Interval.atLeastLessThanSuc_atLeastAtMost|fact"><span>atLeastLessThanSuc_atLeastAtMost</span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>flip</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set_Interval.html#Set_Interval.order_class.atLeastLessThan_eq_atLeastAtMost_diff|fact"><span>atLeastLessThan_eq_atLeastAtMost_diff</span></a><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
  </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity_def" id="offset_42246..42247">4</span><span> </span><span class="skolem"><span>z</span></span><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="skolem"><span>B</span></span><span> </span><span class="skolem"><span>M</span></span><span> </span><span class="skolem"><span>ai</span></span><span> </span><span class="skolem"><span>a</span></span><span class="main"><span>)</span></span><span> </span><span class="comment1"><span>(</span><span>*</span><span> inner invar' and not b ibplies outer invar </span><span>*</span><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>note</span></span></span><span> </span><span class="entity_def" id="offset_42318..42321">inv</span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_42246..42247"><span>4</span></a><span class="main"><span>[</span></span><span class="operator"><span>THEN</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conjunct1|fact"><span>conjunct1</span></a><span class="main"><span>,</span></span><span> </span><span class="operator"><span>unfolded</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_41148..41158"><span>invar2_def</span></a><span class="main"><span>]</span></span><span>
  </span><span class="keyword1"><span class="command"><span>note</span></span></span><span> </span><span class="entity_def" id="offset_42370..42375">invAM</span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_42318..42321"><span>inv</span></a><span class="main"><span>[</span></span><span class="operator"><span>THEN</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conjunct1|fact"><span>conjunct1</span></a><span class="main"><span>,</span></span><span class="operator"><span>THEN</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conjunct1|fact"><span>conjunct1</span></a><span class="main"><span>]</span></span><span>
  </span><span class="keyword1"><span class="command"><span>note</span></span></span><span> </span><span class="entity_def" id="offset_42420..42423">aai</span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_42318..42321"><span>inv</span></a><span class="main"><span>[</span></span><span class="operator"><span>THEN</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conjunct1|fact"><span>conjunct1</span></a><span class="main"><span>,</span></span><span> </span><span class="operator"><span>THEN</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conjunct2|fact"><span>conjunct2</span></a><span class="main"><span>,</span></span><span> </span><span class="operator"><span>THEN</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conjunct2|fact"><span>conjunct2</span></a><span class="main"><span>]</span></span><span>
  </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>only</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.mem_Collect_eq|fact"><span>mem_Collect_eq</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.case|fact"><span>prod.case</span></a><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>rule</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conjI|fact"><span>conjI</span></a><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>goal_cases</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>1</span><span>
    </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_42581..42582">*</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.Suc|const"><span>Suc</span></a><span> </span><span class="skolem"><span>ai</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.insert|const"><span>insert</span></a><span> </span><span class="skolem"><span>a</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.Suc|const"><span>Suc</span></a><span> </span><span class="skolem"><span>ai</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="main"><span>{</span></span><span class="skolem"><span>a</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_42420..42423"><span>aai</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.insert_absorb|fact"><span>insert_absorb</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_42673..42675">**</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.inj_on|const"><span>inj_on</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="skolem"><span>A</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.Suc|const"><span>Suc</span></a><span> </span><span class="skolem"><span>ai</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.inj_on|const"><span>inj_on</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="skolem"><span>A</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.Suc|const"><span>Suc</span></a><span> </span><span class="skolem"><span>ai</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="main"><span>{</span></span><span class="skolem"><span>a</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="skolem"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.not_member|const"><span>â</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.Suc|const"><span>Suc</span></a><span> </span><span class="skolem"><span>ai</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="main"><span>{</span></span><span class="skolem"><span>a</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_42581..42582"><span>*</span></a><span>"</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.Diff_idemp|fact"><span>Diff_idemp</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.inj_on_insert|fact"><span>inj_on_insert</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_42842..42844">nm</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="skolem"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.not_member|const"><span>â</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.Suc|const"><span>Suc</span></a><span> </span><span class="skolem"><span>ai</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="main"><span>{</span></span><span class="skolem"><span>a</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_42246..42247"><span>4</span></a><span> </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_41148..41158"><span>invar2_def</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Map.html#Map.ran_def|fact"><span>ran_def</span></a><span>
        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>clarsimp</span></span><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.set_eq_iff|fact"><span>set_eq_iff</span></a><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_42987..42993">invAM'</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_15620..15625"><span>invAM</span></a><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="skolem"><span>ai</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_15715..15726"><span>invAM_match</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_42370..42375"><span>invAM</span></a><span class="main"><span>,</span></span><span> </span><span class="operator"><span>of</span></span><span> </span><span class="quoted"><span class="skolem"><span>a</span></span></span><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_42420..42423"><span>aai</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_42842..42844"><span>nm</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_42673..42675"><span>**</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.insert_absorb|fact"><span>insert_absorb</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_42246..42247"><span>4</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_42987..42993"><span>invAM'</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_40566..40574"><span>Î±update1</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5452..5464"><span>match_less_n</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.insert_absorb|fact"><span>insert_absorb</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth_list_update|fact"><span>nth_list_update</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
    </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>2</span><span> </span><span class="keyword3"><span class="command"><span>thus</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_42246..42247"><span>4</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>auto</span></span><span>
  </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
  </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>5</span><span> </span><span class="comment1"><span>(</span><span>*</span><span> outer invar and not b ibplies post </span><span>*</span><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>thus</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_15395..15412"><span>pref_match_stable</span></a><span> </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_15609..15619"><span>invAM_def</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_41049..41059"><span>invar1_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.le_neq_implies_less|fact"><span>le_neq_implies_less</span></a><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
  </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity_def" id="offset_43406..43407">3</span><span> </span><span class="skolem"><span>z</span></span><span> </span><span class="skolem"><span>v</span></span><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="skolem"><span>B</span></span><span> </span><span class="skolem"><span>M</span></span><span> </span><span class="skolem"><span>ai</span></span><span> </span><span class="skolem"><span>a</span></span><span class="main"><span>)</span></span><span> </span><span class="comment1"><span>(</span><span>*</span><span> preservation of inner invar </span><span>*</span><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>let</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?M</span></span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="skolem"><span>ai</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="main"><span>{</span></span><span class="skolem"><span>a</span></span><span class="main"><span>}</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_43492..43497">invAM</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_15620..15625"><span>invAM</span></a><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="var"><span>?M</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity_def" id="offset_43516..43517">m</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_6118..6126"><span>matching</span></a><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="var"><span>?M</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity_def" id="offset_43539..43540">A</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_2486..2488"><span>wf</span></a><span> </span><span class="skolem"><span>A</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity_def" id="offset_43553..43554">M</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="var"><span>?M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>â</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity_def" id="offset_43576..43586">pref_match</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_12339..12349"><span>pref_match</span></a><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="var"><span>?M</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity_def" id="offset_43610..43617">matched</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="skolem"><span>a</span></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity_def" id="offset_43643..43644">v</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_4580..4583"><span>var</span></a><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="skolem"><span>ai</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="skolem"><span>v</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity_def" id="offset_43668..43670">as</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>â¤</span></a></span><span> </span><span class="skolem"><span>ai</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><span class="skolem"><span>ai</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>n</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity_def" id="offset_43694..43699">invAB</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_40907..40913"><span>invAB2</span></a><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="skolem"><span>B</span></span><span> </span><span class="skolem"><span>M</span></span><span> </span><span class="var"><span>?M</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_43406..43407"><span>3</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>auto</span></span><span>
  </span><span class="keyword1"><span class="command"><span>note</span></span></span><span> </span><span class="entity_def" id="offset_43746..43751">invar</span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_43406..43407"><span>3</span></a><span class="main"><span>[</span></span><span class="operator"><span>THEN</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conjunct1|fact"><span>conjunct1</span></a><span class="main"><span>,</span></span><span> </span><span class="operator"><span>THEN</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conjunct1|fact"><span>conjunct1</span></a><span class="main"><span>,</span></span><span> </span><span class="operator"><span>unfolded</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_41148..41158"><span>invar2_def</span></a><span class="main"><span>]</span></span><span>
  </span><span class="keyword1"><span class="command"><span>note</span></span></span><span> </span><span>pref_match'</span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_43576..43586"><span>pref_match</span></a><span class="main"><span>[</span></span><span class="operator"><span>THEN</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_12582..12597"><span>pref_match'_iff</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_43539..43540"><span>A</span></a><span class="main"><span class="main"><span>,</span></span></span><span> </span><span class="operator"><span>THEN</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.iffD2|fact"><span>iffD2</span></a><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>]</span></span><span>
  </span><span class="keyword1"><span class="command"><span>hence</span></span></span><span> </span><span class="entity_def" id="offset_43889..43900">pref_match1</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>â</span></span><span class="bound"><span class="bound"><span>a</span></span></span><span class="main"><span>&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_6050..6059"><span>preferred</span></a><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>â</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span> </span><span class="var"><span>?M</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_12457..12467"><span>pref_match'_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>blast</span></span><span>
  </span><span class="keyword1"><span class="command"><span>let</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?a</span></span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>B</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="skolem"><span>a</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_44008..44009">a</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><span class="skolem"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.not_member|const"><span>â</span></a></span><span> </span><span class="var"><span>?M</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_43746..43751"><span>invar</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>auto</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_44055..44057">a'</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="var"><span>?a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>â</span></a></span><span> </span><span class="var"><span>?M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="var"><span>?a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="skolem"><span>a</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_43694..43699"><span>invAB</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5452..5464"><span>match_less_n</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_43539..43540"><span>A</span></a><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_44008..44009"><span>a</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_43610..43617"><span>matched</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_40477..40483"><span>Î±_Some</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Map.html#Map.ranI|fact"><span>ranI</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="var"><span>?M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>â </span></a></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="var"><span>?a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>n</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_43553..43554"><span>M</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_44008..44009"><span>a</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_44055..44057"><span>a'</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Set_Interval.html#Set_Interval.atLeast0LessThan|fact"><span>atLeast0LessThan</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>auto</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_44239..44243">card</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Finite_Set.html#Finite_Set.card|const"><span>card</span></a><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="skolem"><span>ai</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Finite_Set.html#Finite_Set.card|const"><span>card</span></a><span> </span><span class="var"><span>?M</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_43668..43670"><span>as</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_44292..44293">*</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="skolem"><span>ai</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="main"><span>{</span></span><span class="skolem"><span>a</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="main"><span>{</span></span><span class="var"><span>?a</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.union|const"><span>âª</span></a></span><span> </span><span class="main"><span>{</span></span><span class="skolem"><span>a</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="skolem"><span>ai</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="main"><span>{</span></span><span class="var"><span>?a</span></span><span class="main"><span>}</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_43746..43751"><span>invar</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_44055..44057"><span>a'</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>auto</span></span><span>
  </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>only</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.mem_Collect_eq|fact"><span>mem_Collect_eq</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.case|fact"><span>prod.case</span></a><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>goal_cases</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>1</span><span>
    </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="operator"><span>rule</span></span><span class="main"><span class="keyword3"><span>;</span></span></span><span class="operator"><span>rule</span></span><span class="main"><span class="keyword3"><span>;</span></span></span><span class="operator"><span>rule</span></span><span class="main"><span>)</span></span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>goal_cases</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span class="entity_def" id="offset_44517..44523">unstab</span><span class="main"><span>:</span></span><span> </span><span>1</span><span>
      </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_44538..44545">inj_dom</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.inj_on|const"><span>inj_on</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Gale_Shapley1.html#offset_40415..40416"><span>Î±</span></a><span> </span><span class="skolem"><span>B</span></span><span> </span><span class="skolem"><span>M</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/Map.html#Map.dom|const"><span>dom</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Gale_Shapley1.html#offset_40415..40416"><span>Î±</span></a><span> </span><span class="skolem"><span>B</span></span><span> </span><span class="skolem"><span>M</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>mono_tags</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Map.html#Map.domD|fact"><span>domD</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.inj_onI|fact"><span>inj_onI</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_43694..43699"><span>invAB</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_44631..44637">invAB'</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_25708..25713"><span>invAB</span></a><span> </span><span class="main"><span>(</span></span><span class="skolem"><span>A</span></span><span class="main"><span>[</span></span><span class="skolem"><span>B</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="skolem"><span>a</span></span><span> </span><span class="main"><span>:=</span></span><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="var"><span>?a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Gale_Shapley1.html#offset_40415..40416"><span>Î±</span></a><span> </span><span class="main"><span>(</span></span><span class="skolem"><span>B</span></span><span class="main"><span>[</span></span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="skolem"><span>a</span></span><span> </span><span class="main"><span>:=</span></span><span> </span><span class="skolem"><span>a</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="skolem"><span>M</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="skolem"><span>ai</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="main"><span>{</span></span><span class="var"><span>?a</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
        </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_25847..25857"><span>invAB_swap</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_43694..43699"><span>invAB</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>THEN</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conjunct1|fact"><span>conjunct1</span></a><span class="main"><span class="main"><span>]</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_44008..44009"><span>a</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_44055..44057"><span>a'</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_44538..44545"><span>inj_dom</span></a><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_44292..44293"><span>*</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5452..5464"><span>match_less_n</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_43539..43540"><span>A</span></a><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_44008..44009"><span>a</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_43610..43617"><span>matched</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_43694..43699"><span>invAB</span></a><span>
        </span><span class="keyword1"><span class="command"><span>by</span></span></span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><a class="entity_ref" href="Gale_Shapley1.html#offset_40745..40753"><span>Î±update2</span></a><span class="main"><span>)</span></span><span>
      </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_15844..15854"><span>invAM_swap</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_43492..43497"><span>invAM</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_44008..44009"><span>a</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_44055..44057"><span>a'</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_44517..44523"><span>unstab</span></a><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_44631..44637"><span>invAB'</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_43746..43751"><span>invar</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_44055..44057"><span>a'</span></a><span>
        </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_44292..44293"><span>*</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.insert_absorb|fact"><span>insert_absorb</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_40745..40753"><span>Î±update2</span></a><span class="main"><span>)</span></span><span>

      </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>2</span><span>
      </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_43643..43644"><span>v</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_11417..11425"><span>var_next</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_43516..43517"><span>m</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_43553..43554"><span>M</span></a><span> </span><span class="quoted"><span class="quoted"><span>â¹</span><span class="var"><span>?M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>â </span></a></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span>âº</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_43889..43900"><span>pref_match1</span></a><span> </span><span class="quoted"><span class="quoted"><span>â¹</span><span class="var"><span>?a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>n</span></span><span>âº</span></span></span><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_44239..44243"><span>card</span></a><span>
        </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_4569..4579"><span>var_def</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.Suc_eq_plus1|fact"><span>Suc_eq_plus1</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
      </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span class="entity_def" id="offset_45140..45144">stab</span><span class="main"><span>:</span></span><span> </span><span>3</span><span>
      </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_45159..45160">*</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>â</span></a></span><span class="bound"><span>b</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>.</span></a></span><span> </span><span class="bound"><span>b</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><span class="skolem"><span>M</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span class="bound"><span>b</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>â¶</span></a></span><span> </span><span class="skolem"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>â </span></a></span><span> </span><span class="skolem"><span>B</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span class="bound"><span>b</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_43694..43699"><span>invAB</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Map.html#Map.ranI|fact"><span>ranI</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_40477..40483"><span>Î±_Some</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_44008..44009"><span>a</span></a><span class="main"><span>)</span></span><span> 
      </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_17259..17269"><span>invAM_next</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_43492..43497"><span>invAM</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_44008..44009"><span>a</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_44055..44057"><span>a'</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_45140..45144"><span>stab</span></a><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_43746..43751"><span>invar</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_45159..45160"><span>*</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5402..5412"><span>match_def</span></a><span class="main"><span>)</span></span><span>

      </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>4</span><span>
      </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_43643..43644"><span>v</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_11417..11425"><span>var_next</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_43516..43517"><span>m</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_43553..43554"><span>M</span></a><span> </span><span class="quoted"><span class="quoted"><span>â¹</span><span class="var"><span>?M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>â </span></a></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span>âº</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_43889..43900"><span>pref_match1</span></a><span class="main"><span>,</span></span><span> </span><span class="operator"><span>of</span></span><span> </span><span class="quoted"><span class="skolem"><span>a</span></span></span><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_44008..44009"><span>a</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_44239..44243"><span>card</span></a><span>
        </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.Suc_eq_plus1|fact"><span>Suc_eq_plus1</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_4569..4579"><span>var_def</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Gale_Shapley1.Pref.inner_to_outer|fact"><span class="entity_def" id="Gale_Shapley1.Pref.inner_to_outer|thm"><span class="entity_def" id="offset_45467..45481">inner_to_outer</span></span></span><span class="main"><span>:</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_45491..45494">inv</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_41159..41165"><span>invar2</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="free"><span>B</span></span><span> </span><span class="free"><span>M</span></span><span> </span><span class="free"><span>ai</span></span><span> </span><span class="free"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><span class="free"><span>b</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="free"><span>a</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity_def" id="offset_45536..45541">not_b</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>Â¬</span></a></span><span> </span><span class="free"><span>M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="free"><span>b</span></span><span>"</span></span></span><span>
</span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_41060..41066"><span>invar1</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>B</span></span><span class="main"><span>[</span></span><span class="free"><span>b</span></span><span> </span><span class="main"><span>:=</span></span><span> </span><span class="free"><span>a</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>M</span></span><span class="main"><span>[</span></span><span class="free"><span>b</span></span><span> </span><span class="main"><span>:=</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.True|const"><span>True</span></a><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>ai</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>
  </span><span class="keyword1"><span class="command"><span>note</span></span></span><span> </span><span class="entity_def" id="offset_45619..45624">invAM</span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_45491..45494"><span>inv</span></a><span class="main"><span>[</span></span><span class="operator"><span>unfolded</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_41148..41158"><span>invar2_def</span></a><span class="main"><span>,</span></span><span> </span><span class="operator"><span>THEN</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conjunct1|fact"><span>conjunct1</span></a><span class="main"><span>,</span></span><span class="operator"><span>THEN</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conjunct1|fact"><span>conjunct1</span></a><span class="main"><span>]</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_45690..45691">*</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.Suc|const"><span>Suc</span></a><span> </span><span class="free"><span>ai</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.insert|const"><span>insert</span></a><span> </span><span class="free"><span>a</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.Suc|const"><span>Suc</span></a><span> </span><span class="free"><span>ai</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="main"><span>{</span></span><span class="free"><span>a</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_45491..45494"><span>inv</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.insert_absorb|fact"><span>insert_absorb</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_45780..45782">**</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.inj_on|const"><span>inj_on</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="free"><span>A</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.Suc|const"><span>Suc</span></a><span> </span><span class="free"><span>ai</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.inj_on|const"><span>inj_on</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="free"><span>A</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.Suc|const"><span>Suc</span></a><span> </span><span class="free"><span>ai</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="main"><span>{</span></span><span class="free"><span>a</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="free"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.not_member|const"><span>â</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.Suc|const"><span>Suc</span></a><span> </span><span class="free"><span>ai</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="main"><span>{</span></span><span class="free"><span>a</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_45690..45691"><span>*</span></a><span>"</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.Diff_idemp|fact"><span>Diff_idemp</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.inj_on_insert|fact"><span>inj_on_insert</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_45945..45947">nm</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="free"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.not_member|const"><span>â</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.Suc|const"><span>Suc</span></a><span> </span><span class="free"><span>ai</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="main"><span>{</span></span><span class="free"><span>a</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_45491..45494"><span>inv</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_45536..45541"><span>not_b</span></a><span> </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_41148..41158"><span>invar2_def</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Map.html#Map.ran_def|fact"><span>ran_def</span></a><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>clarsimp</span></span><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.set_eq_iff|fact"><span>set_eq_iff</span></a><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_46094..46100">invAM'</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_15620..15625"><span>invAM</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>ai</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_15715..15726"><span>invAM_match</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_45619..45624"><span>invAM</span></a><span class="main"><span>,</span></span><span> </span><span class="operator"><span>of</span></span><span> </span><span class="quoted"><span class="free"><span>a</span></span></span><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_45491..45494"><span>inv</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_45945..45947"><span>nm</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_45780..45782"><span>**</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.insert_absorb|fact"><span>insert_absorb</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_45491..45494"><span>inv</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_45536..45541"><span>not_b</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_46094..46100"><span>invAM'</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5452..5464"><span>match_less_n</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>clarsimp</span></span><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_40566..40574"><span>Î±update1</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.insert_absorb|fact"><span>insert_absorb</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth_list_update|fact"><span>nth_list_update</span></a><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_46312..46317">lemma</span></span></span><span> </span><span class="entity_def" id="Gale_Shapley1.Pref.inner_pres|fact"><span class="entity_def" id="Gale_Shapley1.Pref.inner_pres|thm"><span class="entity_def" id="offset_46318..46328">inner_pres</span></span></span><span class="main"><span>:</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="entity_def" id="offset_46338..46339">R</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>â</span></span><span class="bound"><span class="bound"><span>b</span></span></span><span class="main"><span>&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>â</span></span><span class="bound"><span class="bound"><span>a1</span></span></span><span class="main"><span>&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>â</span></span><span class="bound"><span class="bound"><span>a2</span></span></span><span class="main"><span>&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="bound"><span>b</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="bound"><span>a1</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="bound"><span>b</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="bound"><span>a2</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.iff|const"><span>â·</span></a></span><span> </span><span class="free"><span>P<span class="hidden">â©</span><sub>b</sub></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="bound"><span>b</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.prefa|const"><span>â¢</span></a></span><span> </span><span class="bound"><span>a1</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.prefa|const"><span>&lt;</span></a></span><span> </span><span class="bound"><span>a2</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span>
  </span><span class="entity_def" id="offset_46413..46416">inv</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_41159..41165"><span>invar2</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="free"><span>B</span></span><span> </span><span class="free"><span>M</span></span><span> </span><span class="free"><span>ai</span></span><span> </span><span class="free"><span>a</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity_def" id="offset_46442..46443">m</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="free"><span>b</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity_def" id="offset_46457..46458">v</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_4580..4583"><span>var</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>ai</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>v</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity_def" id="offset_46484..46489">after</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>A1</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>A</span></span><span class="main"><span>[</span></span><span class="free"><span>B</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="free"><span>b</span></span><span> </span><span class="main"><span>:=</span></span><span> </span><span class="free"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>B</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="free"><span>b</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>]</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>A2</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>A</span></span><span class="main"><span>[</span></span><span class="free"><span>a</span></span><span> </span><span class="main"><span>:=</span></span><span> </span><span class="free"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="free"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>]</span></span><span>"</span></span></span><span>
    </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>a'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>B</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span class="free"><span>b</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>r</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="free"><span>a'</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>b</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="free"><span>a</span></span><span>"</span></span></span><span>
</span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>(</span></span><span class="free"><span>r</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="free"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>r</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="free"><span>a'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>â¶</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_41159..41165"><span>invar2</span></a><span> </span><span class="free"><span>A1</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>B</span></span><span class="main"><span>[</span></span><span class="free"><span>b</span></span><span class="main"><span>:=</span></span><span class="free"><span>a</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>M</span></span><span> </span><span class="free"><span>ai</span></span><span> </span><span class="free"><span>a'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_4580..4583"><span>var</span></a><span> </span><span class="free"><span>A1</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>ai</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>v</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span>
  </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>Â¬</span></a></span><span> </span><span class="free"><span>r</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="free"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>r</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="free"><span>a'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>â¶</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_41159..41165"><span>invar2</span></a><span> </span><span class="free"><span>A2</span></span><span> </span><span class="free"><span>B</span></span><span> </span><span class="free"><span>M</span></span><span> </span><span class="free"><span>ai</span></span><span> </span><span class="free"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_4580..4583"><span>var</span></a><span> </span><span class="free"><span>A2</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>ai</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>v</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="operator"><span>-</span></span><span>
  </span><span class="keyword1"><span class="command"><span>let</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?M</span></span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>ai</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="main"><span>{</span></span><span class="free"><span>a</span></span><span class="main"><span>}</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>note</span></span></span><span> </span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_46484..46489"><span>after</span></a><span>
  </span><span class="keyword1"><span class="command"><span>note</span></span></span><span> </span><span class="entity_def" id="offset_46804..46808">inv'</span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_46413..46416"><span>inv</span></a><span class="main"><span>[</span></span><span class="operator"><span>unfolded</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_41148..41158"><span>invar2_def</span></a><span class="main"><span>]</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_46843..46844">A</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_2486..2488"><span>wf</span></a><span> </span><span class="free"><span>A</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity_def" id="offset_46857..46858">M</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="var"><span>?M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>â</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity_def" id="offset_46876..46881">invAM</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_15620..15625"><span>invAM</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="var"><span>?M</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity_def" id="offset_46900..46905">invAB</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_25708..25713"><span>invAB</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Gale_Shapley1.html#offset_40415..40416"><span>Î±</span></a><span> </span><span class="free"><span>B</span></span><span> </span><span class="free"><span>M</span></span><span class="main"><span>)</span></span><span> </span><span class="var"><span>?M</span></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity_def" id="offset_46936..46939">mat</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_6118..6126"><span>matching</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="var"><span>?M</span></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity_def" id="offset_46961..46971">pref_match</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_12339..12349"><span>pref_match</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="var"><span>?M</span></span><span>"</span></span></span><span>
    </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="entity_def" id="offset_46999..47001">as</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>â¤</span></a></span><span> </span><span class="free"><span>ai</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><span class="free"><span>ai</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>n</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_46804..46808"><span>inv'</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>auto</span></span><span>
  </span><span class="keyword1"><span class="command"><span>note</span></span></span><span> </span><span>pref_match'</span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_46961..46971"><span>pref_match</span></a><span class="main"><span>[</span></span><span class="operator"><span>THEN</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_12582..12597"><span>pref_match'_iff</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_46843..46844"><span>A</span></a><span class="main"><span class="main"><span>,</span></span></span><span> </span><span class="operator"><span>THEN</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.iffD2|fact"><span>iffD2</span></a><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>]</span></span><span>
  </span><span class="keyword1"><span class="command"><span>hence</span></span></span><span> </span><span class="entity_def" id="offset_47120..47131">pref_match1</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>â</span></span><span class="bound"><span class="bound"><span>a</span></span></span><span class="main"><span>&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_6050..6059"><span>preferred</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>â</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.image|const"><span>`</span></a></span><span> </span><span class="var"><span>?M</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_12457..12467"><span>pref_match'_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>blast</span></span><span>
  </span><span class="keyword1"><span class="command"><span>let</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?a</span></span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>B</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="free"><span>a</span></span><span>"</span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_47239..47240">a</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><span class="free"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.not_member|const"><span>â</span></a></span><span> </span><span class="var"><span>?M</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_46413..46416"><span>inv</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>auto</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_47284..47286">a'</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="var"><span>?a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>â</span></a></span><span> </span><span class="var"><span>?M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="var"><span>?a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="free"><span>a</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_46900..46905"><span>invAB</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5452..5464"><span>match_less_n</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_46843..46844"><span>A</span></a><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_47239..47240"><span>a</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_46442..46443"><span>m</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_46413..46416"><span>inv</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_40477..40483"><span>Î±_Some</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Map.html#Map.ranI|fact"><span>ranI</span></a><span> </span><span class="quoted"><span class="quoted"><span>â¹</span><span class="free"><span>b</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>_</span></span><span>âº</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="var"><span>?M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>â </span></a></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>and</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="var"><span>?a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>n</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_46857..46858"><span>M</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_47239..47240"><span>a</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_47284..47286"><span>a'</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Set_Interval.html#Set_Interval.atLeast0LessThan|fact"><span>atLeast0LessThan</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>auto</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_47474..47478">card</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Finite_Set.html#Finite_Set.card|const"><span>card</span></a><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>ai</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Finite_Set.html#Finite_Set.card|const"><span>card</span></a><span> </span><span class="var"><span>?M</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_46999..47001"><span>as</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
  </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?thesis</span></span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><span class="operator"><span>rule</span></span><span class="main"><span class="keyword3"><span>;</span></span></span><span class="operator"><span>rule</span></span><span class="main"><span class="keyword3"><span>;</span></span></span><span class="operator"><span>rule</span></span><span class="main"><span>)</span></span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>goal_cases</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_47583..47584">*</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>ai</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="main"><span>{</span></span><span class="free"><span>a</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="main"><span>{</span></span><span class="var"><span>?a</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.union|const"><span>âª</span></a></span><span> </span><span class="main"><span>{</span></span><span class="free"><span>a</span></span><span class="main"><span>}</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>ai</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="main"><span>{</span></span><span class="var"><span>?a</span></span><span class="main"><span>}</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_46413..46416"><span>inv</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_47284..47286"><span>a'</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>auto</span></span><span>
    </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>1</span><span>
    </span><span class="keyword1"><span class="command"><span>hence</span></span></span><span> </span><span class="entity_def" id="offset_47678..47684">unstab</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>P<span class="hidden">â©</span><sub>b</sub></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="free"><span>a'</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.prefa|const"><span>â¢</span></a></span><span> </span><span class="free"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.prefa|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>a'</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_46338..46339"><span>R</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_47239..47240"><span>a</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_47284..47286"><span>a'</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_46999..47001"><span>as</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_2408..2415"><span>P<span class="hidden">â©</span><sub>b</sub>_set</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_2342..2349"><span>P<span class="hidden">â©</span><sub>a</sub>_set</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5452..5464"><span>match_less_n</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_46843..46844"><span>A</span></a><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_2212..2218"><span>n_def</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_2305..2315"><span>length_P<span class="hidden">â©</span><sub>b</sub></span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_46338..46339"><span>R</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_47809..47816">inj_dom</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.inj_on|const"><span>inj_on</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Gale_Shapley1.html#offset_40415..40416"><span>Î±</span></a><span> </span><span class="free"><span>B</span></span><span> </span><span class="free"><span>M</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/Map.html#Map.dom|const"><span>dom</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Gale_Shapley1.html#offset_40415..40416"><span>Î±</span></a><span> </span><span class="free"><span>B</span></span><span> </span><span class="free"><span>M</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><span class="main"><span class="main"><span>(</span></span></span><span>mono_tags</span><span class="main"><span class="main"><span>)</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Map.html#Map.domD|fact"><span>domD</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.inj_onI|fact"><span>inj_onI</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_46900..46905"><span>invAB</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_47900..47906">invAB'</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_25708..25713"><span>invAB</span></a><span> </span><span class="free"><span>A1</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Gale_Shapley1.html#offset_40415..40416"><span>Î±</span></a><span> </span><span class="main"><span>(</span></span><span class="free"><span>B</span></span><span class="main"><span>[</span></span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="free"><span>a</span></span><span> </span><span class="main"><span>:=</span></span><span> </span><span class="free"><span>a</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>M</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>ai</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="main"><span>{</span></span><span class="var"><span>?a</span></span><span class="main"><span>}</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_25847..25857"><span>invAB_swap</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_46900..46905"><span>invAB</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_47239..47240"><span>a</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_47284..47286"><span>a'</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_47809..47816"><span>inj_dom</span></a><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_47583..47584"><span>*</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5452..5464"><span>match_less_n</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_46843..46844"><span>A</span></a><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_47239..47240"><span>a</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_46442..46443"><span>m</span></a><span>
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_40745..40753"><span>Î±update2</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_46804..46808"><span>inv'</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_15844..15854"><span>invAM_swap</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_46876..46881"><span>invAM</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_47239..47240"><span>a</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_47284..47286"><span>a'</span></a><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_47678..47684"><span>unstab</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_47900..47906"><span>invAB'</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_46413..46416"><span>inv</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_47284..47286"><span>a'</span></a><span>
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_47583..47584"><span>*</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.insert_absorb|fact"><span>insert_absorb</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_40745..40753"><span>Î±update2</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
    </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>2</span><span>
      </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_46457..46458"><span>v</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_11417..11425"><span>var_next</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_46936..46939"><span>mat</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_46857..46858"><span>M</span></a><span> </span><span class="quoted"><span class="quoted"><span>â¹</span><span class="var"><span>?M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>â </span></a></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span>âº</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_47120..47131"><span>pref_match1</span></a><span> </span><span class="quoted"><span class="quoted"><span>â¹</span><span class="var"><span>?a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>n</span></span><span>âº</span></span></span><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_47474..47478"><span>card</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_46312..46317"><span>assms</span></a><span class="main"><span>(</span></span><span>5</span><span class="main"><span>,</span></span><span>9</span><span class="main"><span>)</span></span><span>
        </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.Suc_eq_plus1|fact"><span>Suc_eq_plus1</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_4569..4579"><span>var_def</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_48361..48362">*</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>â</span></a></span><span class="bound"><span>b</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.All|const"><span>.</span></a></span><span> </span><span class="bound"><span>b</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><span class="free"><span>M</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span class="bound"><span>b</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>â¶</span></a></span><span> </span><span class="free"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>â </span></a></span><span> </span><span class="free"><span>B</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span class="bound"><span>b</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_46900..46905"><span>invAB</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Map.html#Map.ranI|fact"><span>ranI</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_40477..40483"><span>Î±_Some</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_47239..47240"><span>a</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span class="entity_def" id="offset_48432..48433">3</span><span>
    </span><span class="keyword1"><span class="command"><span>hence</span></span></span><span> </span><span>unstab</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Not|const"><span>Â¬</span></a></span><span> </span><span class="free"><span>P<span class="hidden">â©</span><sub>b</sub></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="free"><span>a'</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.prefa|const"><span>â¢</span></a></span><span> </span><span class="free"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.prefa|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>a'</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_46338..46339"><span>R</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_47239..47240"><span>a</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_47284..47286"><span>a'</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_46999..47001"><span>as</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_2408..2415"><span>P<span class="hidden">â©</span><sub>b</sub>_set</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_2342..2349"><span>P<span class="hidden">â©</span><sub>a</sub>_set</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5452..5464"><span>match_less_n</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_46843..46844"><span>A</span></a><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_2212..2218"><span>n_def</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_2305..2315"><span>length_P<span class="hidden">â©</span><sub>b</sub></span></a><span>
      </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.ranking_iff_pref|fact"><span>ranking_iff_pref</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>then</span></span></span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_17259..17269"><span>invAM_next</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_46876..46881"><span>invAM</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_47239..47240"><span>a</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_47284..47286"><span>a'</span></a><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_48432..48433"><span>3</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_46413..46416"><span>inv</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_48361..48362"><span>*</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5402..5412"><span>match_def</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
    </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>4</span><span>
      </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_46457..46458"><span>v</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_11417..11425"><span>var_next</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_46936..46939"><span>mat</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_46857..46858"><span>M</span></a><span> </span><span class="quoted"><span class="quoted"><span>â¹</span><span class="var"><span>?M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.not_equal|const"><span>â </span></a></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span>âº</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_47120..47131"><span>pref_match1</span></a><span class="main"><span>,</span></span><span> </span><span class="operator"><span>of</span></span><span> </span><span class="quoted"><span class="free"><span>a</span></span></span><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_47239..47240"><span>a</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_47474..47478"><span>card</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_46312..46317"><span>assms</span></a><span class="main"><span>(</span></span><span>6</span><span class="main"><span>)</span></span><span>
        </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.Suc_eq_plus1|fact"><span>Suc_eq_plus1</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_4569..4579"><span>var_def</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>


</span><span class="keyword1"><span class="command"><span>subsection</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>â¹</span><span>Algorithm 6: replace </span><span class="antiquoted"><span class="raw_text"><span class="operator"><span>â¹</span></span><span>P<span class="hidden">â©</span><sub>b</sub>âº</span></span></span><span> by ranking </span><span class="antiquoted"><span class="raw_text"><span class="operator"><span>â¹</span></span><span>Râº</span></span></span><span>âº</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Gale_Shapley1.Pref.Gale_Shapley6|fact"><span class="entity_def" id="Gale_Shapley1.Pref.Gale_Shapley6|thm"><span>Gale_Shapley6</span></span></span><span class="main"><span>:</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>R</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.map|const"><span>map</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.ranking|const"><span>ranking</span></a><span> </span><span class="free"><span>P<span class="hidden">â©</span><sub>b</sub></span></span><span>"</span></span></span><span>
</span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span>
</span><span class="quoted"><span class="quoted"><span>"</span><span class="keyword1"><span>VARS</span></span><span> </span><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span>A</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span> </span><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span>B</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span> </span><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span>M</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span> </span><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span>ai</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span> </span><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span>a</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span> </span><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span>a'</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span> </span><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span>b</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span> </span><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span>r</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span>
 </span><span class="main"><span>[</span></span><span class="bound"><span>ai</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><span class="bound"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.replicate|const"><span>replicate</span></a><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.length|const"><span>length</span></a><span> </span><span class="bound"><span>B</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><span class="bound"><span>M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.replicate|const"><span>replicate</span></a><span> </span><span class="free"><span>n</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.False|const"><span>False</span></a><span class="main"><span>]</span></span><span>
 </span><span class="keyword1"><span>WHILE</span></span><span> </span><span class="bound"><span>ai</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>n</span></span><span>
 </span><span class="keyword1"><span>INV</span></span><span> </span><span class="main"><span>{</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_41060..41066"><span>invar1</span></a><span> </span><span class="bound"><span>A</span></span><span> </span><span class="bound"><span>B</span></span><span> </span><span class="bound"><span>M</span></span><span> </span><span class="bound"><span>ai</span></span><span> </span><span class="main"><span>}</span></span><span>
 </span><span class="keyword1"><span>VAR</span></span><span> </span><span class="main"><span>{</span></span><span class="bound"><span>z</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="bound"><span>ai</span></span><span class="main"><span>}</span></span><span>
 </span><span class="keyword1"><span>DO</span></span><span> a </span><span class="main"><span>:=</span></span><span> </span><span class="bound"><span>ai</span></span><span class="main"><span>;</span></span><span> b </span><span class="main"><span>:=</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="bound"><span>A</span></span><span> </span><span class="bound"><span>a</span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword1"><span>WHILE</span></span><span> </span><span class="bound"><span>M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="bound"><span>b</span></span><span>
  </span><span class="keyword1"><span>INV</span></span><span> </span><span class="main"><span>{</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_41159..41165"><span>invar2</span></a><span> </span><span class="bound"><span>A</span></span><span> </span><span class="bound"><span>B</span></span><span> </span><span class="bound"><span>M</span></span><span> </span><span class="bound"><span>ai</span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><span class="bound"><span>b</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="bound"><span>A</span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><span class="bound"><span>z</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="bound"><span>ai</span></span><span> </span><span class="main"><span>}</span></span><span>
  </span><span class="keyword1"><span>VAR</span></span><span> </span><span class="main"><span>{</span></span><a class="entity_ref" href="Gale_Shapley1.html#offset_4580..4583"><span>var</span></a><span> </span><span class="bound"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="bound"><span>ai</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span class="main"><span>}</span></span><span>
  </span><span class="keyword1"><span>DO</span></span><span> a' </span><span class="main"><span>:=</span></span><span> </span><span class="bound"><span>B</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="bound"><span>b</span></span><span class="main"><span>;</span></span><span> r </span><span class="main"><span>:=</span></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="bound"><span>A</span></span><span> </span><span class="bound"><span>a'</span></span><span class="main"><span>;</span></span><span>
     </span><span class="keyword1"><span>IF</span></span><span> </span><span class="bound"><span>r</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="bound"><span>r</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="bound"><span>a'</span></span><span>
     </span><span class="keyword1"><span>THEN</span></span><span> </span><span class="bound"><span>B</span></span><span class="main"><span>[</span></span><span class="bound"><span>b</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>:=</span></span><span> </span><span class="bound"><span>a</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>A</span></span><span class="main"><span>[</span></span><span class="bound"><span>a'</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>:=</span></span><span> </span><span class="bound"><span>A</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span class="bound"><span>a'</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>;</span></span><span> a </span><span class="main"><span>:=</span></span><span> </span><span class="bound"><span>a'</span></span><span>
     </span><span class="keyword1"><span>ELSE</span></span><span> </span><span class="bound"><span>A</span></span><span class="main"><span>[</span></span><span class="bound"><span>a</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>:=</span></span><span> </span><span class="bound"><span>A</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span class="bound"><span>a</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span>
     </span><span class="keyword1"><span>FI</span></span><span class="main"><span>;</span></span><span>
     b </span><span class="main"><span>:=</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="bound"><span>A</span></span><span> </span><span class="bound"><span>a</span></span><span>
  </span><span class="keyword1"><span>OD</span></span><span class="main"><span>;</span></span><span>
  </span><span class="bound"><span>B</span></span><span class="main"><span>[</span></span><span class="bound"><span>b</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>:=</span></span><span> </span><span class="bound"><span>a</span></span><span class="main"><span>;</span></span><span> </span><span class="bound"><span>M</span></span><span class="main"><span>[</span></span><span class="bound"><span>b</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>:=</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.True|const"><span>True</span></a><span class="main"><span>;</span></span><span> ai </span><span class="main"><span>:=</span></span><span> </span><span class="bound"><span>ai</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span>
 </span><span class="keyword1"><span>OD</span></span><span>
 </span><span class="main"><span>[</span></span><a class="entity_ref" href="Gale_Shapley1.html#offset_6118..6126"><span>matching</span></a><span> </span><span class="bound"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5827..5833"><span>stable</span></a><span> </span><span class="bound"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_13003..13009"><span>opti<span class="hidden">â©</span><sub>a</sub></span></a><span> </span><span class="bound"><span>A</span></span><span class="main"><span>]</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL-Hoare/Hoare_Logic.html#Hoare_Logic.vcg_tc|method"><span class="operator"><span>vcg_tc</span></span></a><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>goal_cases</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>1</span><span> </span><span class="keyword3"><span class="command"><span>thus</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span>  </span><span class="comment1"><span>(</span><span>*</span><span> outer invar holds initially </span><span>*</span><span>)</span></span><span>
   </span><span class="keyword1"><span class="command"><span>by</span></span></span><span class="main"><span>(</span></span><span class="operator"><span>auto</span></span><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5816..5826"><span>stable_def</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_12328..12338"><span>pref_match_def</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_2342..2349"><span>P<span class="hidden">â©</span><sub>a</sub>_set</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.card_distinct|fact"><span>card_distinct</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5402..5412"><span>match_def</span></a><span> </span><a class="entity_ref" href="../List-Index/List_Index.html#List_Index.index_nth_id|fact"><span>index_nth_id</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.prefers_def|fact"><span>prefers_def</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_12992..13002"><span>opti<span class="hidden">â©</span><sub>a</sub>_def</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_40403..40413"><span>Î±_def</span></a><span> </span><span class="quasi_keyword"><span>cong</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj_cong|fact"><span>conj_cong</span></a><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
  </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>2</span><span> </span><span class="comment1"><span>(</span><span>*</span><span> outer invar and b ibplies inner invar </span><span>*</span><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>thus</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>auto</span></span><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set_Interval.html#Set_Interval.atLeastLessThanSuc_atLeastAtMost|fact"><span>atLeastLessThanSuc_atLeastAtMost</span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>flip</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set_Interval.html#Set_Interval.order_class.atLeastLessThan_eq_atLeastAtMost_diff|fact"><span>atLeastLessThan_eq_atLeastAtMost_diff</span></a><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
  </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span class="entity_def" id="offset_49873..49874">3</span><span> </span><span class="comment1"><span>(</span><span>*</span><span> preservation of inner invar </span><span>*</span><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_49916..49917">R</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>â</span></span><span class="bound"><span class="bound"><span>b</span></span></span><span class="main"><span>&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>â</span></span><span class="bound"><span class="bound"><span>a1</span></span></span><span class="main"><span>&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>â</span></span><span class="bound"><span class="bound"><span>a2</span></span></span><span class="main"><span>&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="bound"><span>b</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="bound"><span>a1</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="bound"><span>b</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="bound"><span>a2</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.iff|const"><span>â·</span></a></span><span> </span><span class="free"><span>P<span class="hidden">â©</span><sub>b</sub></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="bound"><span>b</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.prefa|const"><span>â¢</span></a></span><span> </span><span class="bound"><span>a1</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.prefa|const"><span>&lt;</span></a></span><span> </span><span class="bound"><span>a2</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_2408..2415"><span>P<span class="hidden">â©</span><sub>b</sub>_set</span></a><span> </span><span class="quoted"><span class="quoted"><span>â¹</span><span class="free"><span>R</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>_</span></span><span>âº</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_2305..2315"><span>length_P<span class="hidden">â©</span><sub>b</sub></span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.ranking_iff_pref|fact"><span>ranking_iff_pref</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>only</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.mem_Collect_eq|fact"><span>mem_Collect_eq</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.case|fact"><span>prod.case</span></a><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>goal_cases</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>1</span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_46318..46328"><span>inner_pres</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_49916..49917"><span>R</span></a><span> _ _ </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.refl|fact"><span>refl</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.refl|fact"><span>refl</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.refl|fact"><span>refl</span></a><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_49873..49874"><span>3</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>blast</span></span><span>
  </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
  </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span class="entity_def" id="offset_50212..50213">4</span><span> </span><span class="comment1"><span>(</span><span>*</span><span> inner invar' and not b ibplies outer invar </span><span>*</span><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>only</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.mem_Collect_eq|fact"><span>mem_Collect_eq</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.case|fact"><span>prod.case</span></a><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>rule</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conjI|fact"><span>conjI</span></a><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>goal_cases</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>1</span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_50212..50213"><span>4</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_45467..45481"><span>inner_to_outer</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>blast</span></span><span>
  </span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
    </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>2</span><span> </span><span class="keyword3"><span class="command"><span>thus</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_50212..50213"><span>4</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>auto</span></span><span>
  </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
  </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>5</span><span> </span><span class="comment1"><span>(</span><span>*</span><span> outer invar and not b ibplies post </span><span>*</span><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>thus</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_15395..15412"><span>pref_match_stable</span></a><span> </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_15609..15619"><span>invAM_def</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_41049..41059"><span>invar1_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.le_neq_implies_less|fact"><span>le_neq_implies_less</span></a><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>


</span><span class="keyword1"><span class="command"><span>subsection</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>â¹</span><span>Functional implementation</span><span>âº</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="Gale_Shapley1.gs_inner_def|fact"><span class="entity_def" id="Gale_Shapley1.gs_inner_def|thm"><span class="entity_def" id="Gale_Shapley1.gs_inner_def_raw|axiom"><span>definition</span></span></span></span></span></span><span>
</span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="Gale_Shapley1.gs_inner|const"><span>gs_inner</span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>P<span class="hidden">â©</span><sub>a</sub></span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>R</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>M</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span>
  </span><a class="entity_ref" href="../../HOL/HOL-Library/While_Combinator.html#While_Combinator.while|const"><span>while</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><span>Î»</span></span><span class="main"><span>(</span></span><span class="bound"><span>A</span></span><span class="main"><span>,</span></span><span class="bound"><span>B</span></span><span class="main"><span>,</span></span><span class="bound"><span>a</span></span><span class="main"><span>,</span></span><span class="bound"><span>b</span></span><span class="main"><span>)</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>M</span></span></span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span class="bound"><span>b</span></span><span class="main"><span>)</span></span><span>
    </span><span class="main"><span>(</span></span><span class="main"><span>Î»</span></span><span class="main"><span>(</span></span><span class="bound"><span>A</span></span><span class="main"><span>,</span></span><span class="bound"><span>B</span></span><span class="main"><span>,</span></span><span class="bound"><span>a</span></span><span class="main"><span>,</span></span><span class="bound"><span>b</span></span><span class="main"><span>)</span></span><span class="main"><span>.</span></span><span>
      </span><span class="keyword1"><span>let</span></span><span> </span><span class="bound"><span>a'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="bound"><span>B</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="bound"><span>b</span></span><span class="main"><span>;</span></span><span>
          </span><span class="bound"><span>r</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>R</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>P<span class="hidden">â©</span><sub>a</sub></span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="bound"><span>a'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="bound"><span>a'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span>in</span></span><span>
      </span><span class="keyword1"><span>let</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>A</span></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>B</span></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>a</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
        </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>if</span></a></span><span> </span><span class="bound"><span>r</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="bound"><span>r</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="bound"><span>a'</span></span><span>
        </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>then</span></a></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>A</span></span><span class="main"><span>[</span></span><span class="bound"><span>a'</span></span><span> </span><span class="main"><span>:=</span></span><span> </span><span class="bound"><span>A</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span class="bound"><span>a'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>B</span></span><span class="main"><span>[</span></span><span class="bound"><span>b</span></span><span> </span><span class="main"><span>:=</span></span><span> </span><span class="bound"><span>a</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>a'</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>else</span></a></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>A</span></span><span class="main"><span>[</span></span><span class="bound"><span>a</span></span><span> </span><span class="main"><span>:=</span></span><span> </span><span class="bound"><span>A</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span class="bound"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>B</span></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>a</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span>in</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>A</span></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>B</span></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>a</span></span><span class="main"><span>,</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>P<span class="hidden">â©</span><sub>a</sub></span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="bound"><span>a</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="Gale_Shapley1.gs_def|fact"><span class="entity_def" id="Gale_Shapley1.gs_def|thm"><span class="entity_def" id="Gale_Shapley1.gs_def_raw|axiom"><span>definition</span></span></span></span></span></span><span>
</span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="Gale_Shapley1.gs|const"><span>gs</span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>n</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>P<span class="hidden">â©</span><sub>a</sub></span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>R</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span>
  </span><a class="entity_ref" href="../../HOL/HOL-Library/While_Combinator.html#While_Combinator.while|const"><span>while</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><span>Î»</span></span><span class="main"><span>(</span></span><span class="bound"><span>A</span></span><span class="main"><span>,</span></span><span class="bound"><span>B</span></span><span class="main"><span>,</span></span><span class="bound"><span>M</span></span><span class="main"><span>,</span></span><span class="bound"><span>ai</span></span><span class="main"><span>)</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>ai</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>n</span></span></span></span><span class="main"><span>)</span></span><span>
   </span><span class="main"><span>(</span></span><span class="main"><span>Î»</span></span><span class="main"><span>(</span></span><span class="bound"><span>A</span></span><span class="main"><span>,</span></span><span class="bound"><span>B</span></span><span class="main"><span>,</span></span><span class="bound"><span>M</span></span><span class="main"><span>,</span></span><span class="bound"><span>ai</span></span><span class="main"><span>)</span></span><span class="main"><span>.</span></span><span>
     </span><span class="keyword1"><span>let</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>A</span></span><span class="main"><span>,</span></span><span class="bound"><span>B</span></span><span class="main"><span>,</span></span><span class="bound"><span>a</span></span><span class="main"><span>,</span></span><span class="bound"><span>b</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.gs_inner|const"><span>gs_inner</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>P<span class="hidden">â©</span><sub>a</sub></span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>R</span></span></span></span><span> </span><span class="bound"><span>M</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>A</span></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>B</span></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>ai</span></span><span class="main"><span>,</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>P<span class="hidden">â©</span><sub>a</sub></span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="bound"><span>ai</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="bound"><span>ai</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
     </span><span class="keyword1"><span>in</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>A</span></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>B</span></span><span class="main"><span>[</span></span><span class="bound"><span>b</span></span><span class="main"><span>:=</span></span><span class="bound"><span>a</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>M</span></span><span class="main"><span>[</span></span><span class="bound"><span>b</span></span><span class="main"><span>:=</span></span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.True|const"><span>True</span></a><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>ai</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/List.html#List.replicate|const"><span>replicate</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>n</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>,</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.replicate|const"><span>replicate</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>n</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>,</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.replicate|const"><span>replicate</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>n</span></span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.False|const"><span>False</span></a><span class="main"><span>,</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>)</span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_51206..51213">context</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.Pref|locale"><span>Pref</span></a><span>
</span><span class="keyword2"><span class="keyword"><span>begin</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_51226..51231">lemma</span></span></span><span> </span><span class="entity_def" id="Gale_Shapley1.Pref.gs_inner|fact"><span class="entity_def" id="Gale_Shapley1.Pref.gs_inner|thm"><span class="entity_def" id="offset_51232..51240">gs_inner</span></span></span><span class="main"><span>:</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>R</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.map|const"><span>map</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.ranking|const"><span>ranking</span></a><span> </span><span class="free"><span>P<span class="hidden">â©</span><sub>b</sub></span></span><span>"</span></span></span><span>
</span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_41159..41165"><span>invar2</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="free"><span>B</span></span><span> </span><span class="free"><span>M</span></span><span> </span><span class="free"><span>ai</span></span><span> </span><span class="free"><span>a</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>b</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="free"><span>a</span></span><span>"</span></span></span><span>
</span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.gs_inner|const"><span>gs_inner</span></a><span> </span><span class="free"><span>P<span class="hidden">â©</span><sub>a</sub></span></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="free"><span>M</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>A</span></span><span class="main"><span>,</span></span><span> </span><span class="free"><span>B</span></span><span class="main"><span>,</span></span><span> </span><span class="free"><span>a</span></span><span class="main"><span>,</span></span><span> </span><span class="free"><span>b</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>A'</span></span><span class="main"><span>,</span></span><span class="free"><span>B'</span></span><span class="main"><span>,</span></span><span class="free"><span>a'</span></span><span class="main"><span>,</span></span><span class="free"><span>b'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>â¶</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_41060..41066"><span>invar1</span></a><span> </span><span class="free"><span>A'</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>B'</span></span><span class="main"><span>[</span></span><span class="free"><span>b'</span></span><span> </span><span class="main"><span>:=</span></span><span> </span><span class="free"><span>a'</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>M</span></span><span class="main"><span>[</span></span><span class="free"><span>b'</span></span><span> </span><span class="main"><span>:=</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.True|const"><span>True</span></a><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>ai</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.gs_inner_def|fact"><span>gs_inner_def</span></a><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span class="main"><span>(</span></span><span class="operator"><span>rule</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.while_rule2|fact"><span>while_rule2</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="keyword2"><span class="keyword"><span class="operator"><span>where</span></span></span></span><span> P </span><span class="main"><span class="main"><span class="main"><span>=</span></span></span></span><span> </span><span class="quoted"><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span class="main"><span>Î»</span></span></span><span class="main"><span class="main"><span>(</span></span></span><span class="bound"><span class="bound"><span>A</span></span></span><span class="main"><span class="main"><span>,</span></span></span><span class="bound"><span class="bound"><span>B</span></span></span><span class="main"><span class="main"><span>,</span></span></span><span class="bound"><span class="bound"><span>a</span></span></span><span class="main"><span class="main"><span>,</span></span></span><span class="bound"><span class="bound"><span>b</span></span></span><span class="main"><span class="main"><span>)</span></span></span><span class="main"><span class="main"><span>.</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_41159..41165"><a class="entity_ref" href="Gale_Shapley1.html#offset_41159..41165"><span>invar2</span></a></a><span> </span><span class="bound"><span class="bound"><span>A</span></span></span><span> </span><span class="bound"><span class="bound"><span>B</span></span></span><span> </span><span class="free"><span class="free"><span>M</span></span></span><span> </span><span class="free"><span class="free"><span>ai</span></span></span><span> </span><span class="bound"><span class="bound"><span>a</span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span></a></span><span> </span><span class="bound"><span class="bound"><span>b</span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><a class="entity_ref" href="Gale_Shapley1.html#offset_5414..5419"><span>match</span></a></a><span> </span><span class="bound"><span class="bound"><span>A</span></span></span><span> </span><span class="bound"><span class="bound"><span>a</span></span></span><span>"</span></span></span></span><span>
 </span><span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword"><span>and</span></span></span></span></span><span> r </span><span class="main"><span class="main"><span class="main"><span>=</span></span></span></span><span> </span><span class="quoted"><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Wellfounded.html#Wellfounded.measure|const"><a class="entity_ref" href="../../HOL/HOL/Wellfounded.html#Wellfounded.measure|const"><span>measure</span></a></a><span> </span><span class="main"><span class="main"><span>(</span></span></span><span class="main"><span class="main"><span>%</span></span></span><span class="main"><span class="main"><span>(</span></span></span><span class="bound"><span class="bound"><span>A</span></span></span><span class="main"><span class="main"><span>,</span></span></span><span> </span><span class="bound"><span class="bound"><span>B</span></span></span><span class="main"><span class="main"><span>,</span></span></span><span> </span><span class="bound"><span class="bound"><span>a</span></span></span><span class="main"><span class="main"><span>,</span></span></span><span> </span><span class="bound"><span class="bound"><span>b</span></span></span><span class="main"><span class="main"><span>)</span></span></span><span class="main"><span class="main"><span>.</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.Pref.var|const"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.Pref.var|const"><span>Pref.var</span></a></a><span> </span><span class="free"><span class="free"><span>P<span class="hidden">â©</span><sub>a</sub></span></span></span><span> </span><span class="bound"><span class="bound"><span>A</span></span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span></a></span><span class="free"><span class="free"><span>ai</span></span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span></a></span><span class="main"><span class="main"><span>)</span></span></span><span>"</span></span></span></span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>goal_cases</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>1</span><span>
  </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_51226..51231"><span>assms</span></a><span> </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_51206..51213"><span>var_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
</span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
  </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span class="entity_def" id="offset_51667..51670">inv</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span>2</span><span> </span><span class="skolem"><span>s</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>obtain</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>A</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>B</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>a</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>b</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="entity_def" id="offset_51701..51702">s</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>s</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span>  </span><span class="main"><span>(</span></span><span class="skolem"><span>A</span></span><span class="main"><span>,</span></span><span> </span><span class="skolem"><span>B</span></span><span class="main"><span>,</span></span><span> </span><span class="skolem"><span>a</span></span><span class="main"><span>,</span></span><span> </span><span class="skolem"><span>b</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod_cases4|fact"><span>prod_cases4</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>blast</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_51762..51763">R</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>â</span></span><span class="bound"><span class="bound"><span>b</span></span></span><span class="main"><span>&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>â</span></span><span class="bound"><span class="bound"><span>a1</span></span></span><span class="main"><span>&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>â</span></span><span class="bound"><span class="bound"><span>a2</span></span></span><span class="main"><span>&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="bound"><span>b</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="bound"><span>a1</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="bound"><span>b</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="bound"><span>a2</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.iff|const"><span>â·</span></a></span><span> </span><span class="free"><span>P<span class="hidden">â©</span><sub>b</sub></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="bound"><span>b</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.prefa|const"><span>â¢</span></a></span><span> </span><span class="bound"><span>a1</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.prefa|const"><span>&lt;</span></a></span><span> </span><span class="bound"><span>a2</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_2408..2415"><span>P<span class="hidden">â©</span><sub>b</sub>_set</span></a><span> </span><span class="quoted"><span class="quoted"><span>â¹</span><span class="free"><span>R</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>_</span></span><span>âº</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_2305..2315"><span>length_P<span class="hidden">â©</span><sub>b</sub></span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.ranking_iff_pref|fact"><span>ranking_iff_pref</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span class="main"><span>(</span></span><span class="operator"><span>rule</span></span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>goal_cases</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>1</span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_51667..51670"><span>inv</span></a><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>only</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_51701..51702"><span>s</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.case|fact"><span>prod.case</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Let_def|fact"><span>Let_def</span></a><span> </span><span class="quasi_keyword"><span>split</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.if_split|fact"><span>if_split</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_46318..46328"><span>inner_pres</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_51762..51763"><span>R</span></a><span> _ _ </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.refl|fact"><span>refl</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.refl|fact"><span>refl</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.refl|fact"><span>refl</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.refl|fact"><span>refl</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.refl|fact"><span>refl</span></a><span class="main"><span>,</span></span><span> </span><span class="operator"><span>of</span></span><span> </span><span class="quoted"><span class="skolem"><span>A</span></span></span><span> </span><span class="quoted"><span class="skolem"><span>B</span></span></span><span> </span><span class="quoted"><span class="free"><span>M</span></span></span><span> </span><span class="quoted"><span class="free"><span>ai</span></span></span><span> </span><span class="quoted"><span class="skolem"><span>a</span></span></span><span> </span><span class="quoted"><span class="skolem"><span>b</span></span></span><span class="main"><span>]</span></span><span>
    </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_51206..51213"><span>invar2_def</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_51206..51213"><span>match_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Presburger.html#Presburger.presburger|method"><span class="operator"><span>presburger</span></span></a><span>
    </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>2</span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_51667..51670"><span>inv</span></a><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>only</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_51701..51702"><span>s</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.case|fact"><span>prod.case</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Let_def|fact"><span>Let_def</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Wellfounded.html#Wellfounded.in_measure|fact"><span>in_measure</span></a><span> </span><span class="quasi_keyword"><span>split</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.if_split|fact"><span>if_split</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_46318..46328"><span>inner_pres</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_51762..51763"><span>R</span></a><span> _ _ </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.refl|fact"><span>refl</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.refl|fact"><span>refl</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.refl|fact"><span>refl</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.refl|fact"><span>refl</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.refl|fact"><span>refl</span></a><span class="main"><span>,</span></span><span> </span><span class="operator"><span>of</span></span><span> </span><span class="quoted"><span class="skolem"><span>A</span></span></span><span> </span><span class="quoted"><span class="skolem"><span>B</span></span></span><span> </span><span class="quoted"><span class="free"><span>M</span></span></span><span> </span><span class="quoted"><span class="free"><span>ai</span></span></span><span> </span><span class="quoted"><span class="skolem"><span>a</span></span></span><span> </span><span class="quoted"><span class="skolem"><span>b</span></span></span><span class="main"><span>]</span></span><span>
    </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_51206..51213"><span>invar2_def</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_51206..51213"><span>match_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Presburger.html#Presburger.presburger|method"><span class="operator"><span>presburger</span></span></a><span>
  </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
  </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span class="entity_def" id="offset_52386..52387">3</span><span>
  </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>rule</span></span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>goal_cases</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span class="entity_def" id="offset_52437..52438">1</span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span class="main"><span>(</span></span><span class="operator"><span>rule</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_45467..45481"><span>inner_to_outer</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_52386..52387"><span>3</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>unfolded</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_52437..52438"><a class="entity_ref" href="Gale_Shapley1.html#offset_52437..52438"><span>1</span></a></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.case|fact"><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.case|fact"><span>prod.case</span></a></a><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
  </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>4</span><span>
  </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Gale_Shapley1.Pref.gs|fact"><span class="entity_def" id="Gale_Shapley1.Pref.gs|thm"><span>gs</span></span></span><span class="main"><span>:</span></span><span> </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>R</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.map|const"><span>map</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.ranking|const"><span>ranking</span></a><span> </span><span class="free"><span>P<span class="hidden">â©</span><sub>b</sub></span></span><span>"</span></span></span><span>
</span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.gs|const"><span>gs</span></a><span> </span><span class="free"><span>n</span></span><span> </span><span class="free"><span>P<span class="hidden">â©</span><sub>a</sub></span></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>A</span></span><span class="main"><span>,</span></span><span class="free"><span>BMai</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>â¶</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_6118..6126"><span>matching</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_5827..5833"><span>stable</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_13003..13009"><span>opti<span class="hidden">â©</span><sub>a</sub></span></a><span> </span><span class="free"><span>A</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.gs_def|fact"><span>gs_def</span></a><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span class="main"><span>(</span></span><span class="operator"><span>rule</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.while_rule2|fact"><span>while_rule2</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="keyword2"><span class="keyword"><span class="operator"><span>where</span></span></span></span><span> P </span><span class="main"><span class="main"><span class="main"><span>=</span></span></span></span><span> </span><span class="quoted"><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span class="main"><span>Î»</span></span></span><span class="main"><span class="main"><span>(</span></span></span><span class="bound"><span class="bound"><span>A</span></span></span><span class="main"><span class="main"><span>,</span></span></span><span class="bound"><span class="bound"><span>B</span></span></span><span class="main"><span class="main"><span>,</span></span></span><span class="bound"><span class="bound"><span>M</span></span></span><span class="main"><span class="main"><span>,</span></span></span><span class="bound"><span class="bound"><span>ai</span></span></span><span class="main"><span class="main"><span>)</span></span></span><span class="main"><span class="main"><span>.</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_41060..41066"><a class="entity_ref" href="Gale_Shapley1.html#offset_41060..41066"><span>invar1</span></a></a><span> </span><span class="bound"><span class="bound"><span>A</span></span></span><span> </span><span class="bound"><span class="bound"><span>B</span></span></span><span> </span><span class="bound"><span class="bound"><span>M</span></span></span><span> </span><span class="bound"><span class="bound"><span>ai</span></span></span><span>"</span></span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword"><span>and</span></span></span></span></span><span> r </span><span class="main"><span class="main"><span class="main"><span>=</span></span></span></span><span> </span><span class="quoted"><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Wellfounded.html#Wellfounded.measure|const"><a class="entity_ref" href="../../HOL/HOL/Wellfounded.html#Wellfounded.measure|const"><span>measure</span></a></a><span class="main"><span class="main"><span>(</span></span></span><span class="main"><span class="main"><span>Î»</span></span></span><span class="main"><span class="main"><span>(</span></span></span><span class="bound"><span class="bound"><span>A</span></span></span><span class="main"><span class="main"><span>,</span></span></span><span class="bound"><span class="bound"><span>B</span></span></span><span class="main"><span class="main"><span>,</span></span></span><span class="bound"><span class="bound"><span>M</span></span></span><span class="main"><span class="main"><span>,</span></span></span><span class="bound"><span class="bound"><span>ai</span></span></span><span class="main"><span class="main"><span>)</span></span></span><span class="main"><span class="main"><span>.</span></span></span><span> </span><span class="free"><span class="free"><span>n</span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span></a></span><span> </span><span class="bound"><span class="bound"><span>ai</span></span></span><span class="main"><span class="main"><span>)</span></span></span><span>"</span></span></span></span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>goal_cases</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>1</span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span>
   </span><span class="keyword1"><span class="command"><span>by</span></span></span><span class="main"><span>(</span></span><span class="operator"><span>auto</span></span><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_51206..51213"><span>stable_def</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_51206..51213"><span>pref_match_def</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_2342..2349"><span>P<span class="hidden">â©</span><sub>a</sub>_set</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.card_distinct|fact"><span>card_distinct</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_51206..51213"><span>match_def</span></a><span> </span><a class="entity_ref" href="../List-Index/List_Index.html#List_Index.index_nth_id|fact"><span>index_nth_id</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.prefers_def|fact"><span>prefers_def</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_51206..51213"><span>opti<span class="hidden">â©</span><sub>a</sub>_def</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_51206..51213"><span>Î±_def</span></a><span> </span><span class="quasi_keyword"><span>cong</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj_cong|fact"><span>conj_cong</span></a><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
  </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity_def" id="offset_52966..52967">2</span><span> </span><span class="skolem"><span>s</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>obtain</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>A</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>B</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>M</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>ai</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="entity_def" id="offset_52995..52996">s</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>s</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span>  </span><span class="main"><span>(</span></span><span class="skolem"><span>A</span></span><span class="main"><span>,</span></span><span> </span><span class="skolem"><span>B</span></span><span class="main"><span>,</span></span><span> </span><span class="skolem"><span>M</span></span><span class="main"><span>,</span></span><span> </span><span class="skolem"><span>ai</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod_cases4|fact"><span>prod_cases4</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>blast</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_53057..53058">1</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#offset_41159..41165"><span>invar2</span></a><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="skolem"><span>B</span></span><span> </span><span class="skolem"><span>M</span></span><span> </span><span class="skolem"><span>ai</span></span><span> </span><span class="skolem"><span>ai</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_52966..52967"><span>2</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_52995..52996"><span>s</span></a><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>auto</span></span><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set_Interval.html#Set_Interval.atLeastLessThanSuc_atLeastAtMost|fact"><span>atLeastLessThanSuc_atLeastAtMost</span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>flip</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set_Interval.html#Set_Interval.order_class.atLeastLessThan_eq_atLeastAtMost_diff|fact"><span>atLeastLessThan_eq_atLeastAtMost_diff</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_52966..52967"><span>2</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_52995..52996"><span>s</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_51232..51240"><span>gs_inner</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><span class="quoted"><span class="quoted"><span>â¹</span><span class="free"><span>R</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>_</span></span><span> </span><span>âº</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_53057..53058"><span>1</span></a><span class="main"><span>]</span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>auto</span></span><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_51206..51213"><span>match_def</span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>del</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_51206..51213"><span>invar1_def</span></a><span> </span><span class="quasi_keyword"><span>split</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.split|fact"><span>prod.split</span></a><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
  </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>3</span><span>
  </span><span class="keyword3"><span class="command"><span>thus</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#offset_15395..15412"><span>pref_match_stable</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>auto</span></span><span>
</span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
  </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>4</span><span>
  </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>


</span><span class="keyword1"><span class="command"><span>subsection</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>â¹</span><span>Executable functional Code</span><span>âº</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="Gale_Shapley1.Gale_Shapley_def|fact"><span class="entity_def" id="Gale_Shapley1.Gale_Shapley_def|thm"><span class="entity_def" id="Gale_Shapley1.Gale_Shapley_def_raw|axiom"><span>definition</span></span></span></span></span></span><span>
</span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="Gale_Shapley1.Gale_Shapley|const"><span>Gale_Shapley</span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>P<span class="hidden">â©</span><sub>a</sub></span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>P<span class="hidden">â©</span><sub>b</sub></span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>(</span></span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>if</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.Pref|const"><span>Pref</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>P<span class="hidden">â©</span><sub>a</sub></span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>P<span class="hidden">â©</span><sub>b</sub></span></span></span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>then</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Option.html#Option.option.Some|const"><span>Some</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.fst|const"><span>fst</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.gs|const"><span>gs</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/List.html#List.length|const"><span>length</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>P<span class="hidden">â©</span><sub>a</sub></span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>P<span class="hidden">â©</span><sub>a</sub></span></span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.map|const"><span>map</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.ranking|const"><span>ranking</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>P<span class="hidden">â©</span><sub>b</sub></span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>else</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Option.html#Option.option.None|const"><span>None</span></a><span class="main"><span>)</span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>theorem</span></span></span><span> </span><span class="entity_def" id="Gale_Shapley1.gs|fact"><span class="entity_def" id="Gale_Shapley1.gs|thm"><span>gs</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>â¦</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.Pref|const"><span>Pref</span></a><span> </span><span class="free"><span>P<span class="hidden">â©</span><sub>a</sub></span></span><span> </span><span class="free"><span>P<span class="hidden">â©</span><sub>b</sub></span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.length|const"><span>length</span></a><span> </span><span class="free"><span>P<span class="hidden">â©</span><sub>a</sub></span></span><span> </span><span class="main"><span>â§</span></span><span> </span><span class="main"><span>â¹</span></span><span>
 </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Ex|const"><span>â</span></a></span><span class="bound"><span>A</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Ex|const"><span>.</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.Gale_Shapley|const"><span>Gale_Shapley</span></a><span> </span><span class="free"><span>P<span class="hidden">â©</span><sub>a</sub></span></span><span> </span><span class="free"><span>P<span class="hidden">â©</span><sub>b</sub></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Option.html#Option.option.Some|const"><span>Some</span></a><span class="main"><span>(</span></span><span class="bound"><span>A</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.Pref.matching|const"><span>Pref.matching</span></a><span> </span><span class="free"><span>P<span class="hidden">â©</span><sub>a</sub></span></span><span> </span><span class="bound"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span>
   </span><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.Pref.stable|const"><span>Pref.stable</span></a><span> </span><span class="free"><span>P<span class="hidden">â©</span><sub>a</sub></span></span><span> </span><span class="free"><span>P<span class="hidden">â©</span><sub>b</sub></span></span><span> </span><span class="bound"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.Pref.opti\&lt;^sub&gt;a|const"><span>Pref.opti<span class="hidden">â©</span><sub>a</sub></span></a><span> </span><span class="free"><span>P<span class="hidden">â©</span><sub>a</sub></span></span><span> </span><span class="free"><span>P<span class="hidden">â©</span><sub>b</sub></span></span><span> </span><span class="bound"><span>A</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.Gale_Shapley_def|fact"><span>Gale_Shapley_def</span></a><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.Pref.gs|fact"><span>Pref.gs</span></a><span>
</span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.fst_conv|fact"><span>fst_conv</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.surj_pair|fact"><span>surj_pair</span></a><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>declare</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.Pref_def|fact"><span>Pref_def</span></a><span> </span><span class="main"><span>[</span></span><span class="operator"><span>code</span></span><span class="main"><span>]</span></span><span>

</span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>â¹</span><span>Two examples from Gusfield and Irving:</span><span>âº</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.Gale_Shapley|const"><span>Gale_Shapley</span></a><span>
  </span><span class="main"><span>[</span></span><span class="main"><span>[</span></span><span class="numeral"><span>3</span></span><span class="main"><span>,</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>,</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>,</span></span><span class="numeral"><span>2</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>,</span></span><span class="numeral"><span>2</span></span><span class="main"><span>,</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>,</span></span><span class="numeral"><span>3</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>,</span></span><span class="numeral"><span>3</span></span><span class="main"><span>,</span></span><span class="numeral"><span>2</span></span><span class="main"><span>,</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="numeral"><span>2</span></span><span class="main"><span>,</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>,</span></span><span class="numeral"><span>3</span></span><span class="main"><span>,</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>]</span></span><span class="main"><span>]</span></span><span>
  </span><span class="main"><span>[</span></span><span class="main"><span>[</span></span><span class="numeral"><span>3</span></span><span class="main"><span>,</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>,</span></span><span class="numeral"><span>2</span></span><span class="main"><span>,</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>,</span></span><span class="numeral"><span>2</span></span><span class="main"><span>,</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>,</span></span><span class="numeral"><span>3</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>,</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>,</span></span><span class="numeral"><span>2</span></span><span class="main"><span>,</span></span><span class="numeral"><span>3</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="numeral"><span>3</span></span><span class="main"><span>,</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>,</span></span><span class="numeral"><span>2</span></span><span class="main"><span>,</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>]</span></span><span class="main"><span>]</span></span><span>
  </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Option.html#Option.option.Some|const"><span>Some</span></a><span class="main"><span>[</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>,</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>,</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>,</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>]</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eval|method"><span class="operator"><span>eval</span></span></a><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.Gale_Shapley|const"><span>Gale_Shapley</span></a><span>
  </span><span class="main"><span>[</span></span><span class="main"><span>[</span></span><span class="numeral"><span>4</span></span><span class="main"><span>,</span></span><span class="numeral"><span>6</span></span><span class="main"><span>,</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>,</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>,</span></span><span class="numeral"><span>5</span></span><span class="main"><span>,</span></span><span class="numeral"><span>7</span></span><span class="main"><span>,</span></span><span class="numeral"><span>3</span></span><span class="main"><span>,</span></span><span class="numeral"><span>2</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>,</span></span><span class="numeral"><span>2</span></span><span class="main"><span>,</span></span><span class="numeral"><span>6</span></span><span class="main"><span>,</span></span><span class="numeral"><span>4</span></span><span class="main"><span>,</span></span><span class="numeral"><span>3</span></span><span class="main"><span>,</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>,</span></span><span class="numeral"><span>7</span></span><span class="main"><span>,</span></span><span class="numeral"><span>5</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="numeral"><span>7</span></span><span class="main"><span>,</span></span><span class="numeral"><span>4</span></span><span class="main"><span>,</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>,</span></span><span class="numeral"><span>3</span></span><span class="main"><span>,</span></span><span class="numeral"><span>5</span></span><span class="main"><span>,</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>,</span></span><span class="numeral"><span>2</span></span><span class="main"><span>,</span></span><span class="numeral"><span>6</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="numeral"><span>2</span></span><span class="main"><span>,</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>,</span></span><span class="numeral"><span>6</span></span><span class="main"><span>,</span></span><span class="numeral"><span>3</span></span><span class="main"><span>,</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>,</span></span><span class="numeral"><span>5</span></span><span class="main"><span>,</span></span><span class="numeral"><span>7</span></span><span class="main"><span>,</span></span><span class="numeral"><span>4</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
   </span><span class="main"><span>[</span></span><span class="numeral"><span>6</span></span><span class="main"><span>,</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>,</span></span><span class="numeral"><span>4</span></span><span class="main"><span>,</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>,</span></span><span class="numeral"><span>2</span></span><span class="main"><span>,</span></span><span class="numeral"><span>5</span></span><span class="main"><span>,</span></span><span class="numeral"><span>7</span></span><span class="main"><span>,</span></span><span class="numeral"><span>3</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>,</span></span><span class="numeral"><span>5</span></span><span class="main"><span>,</span></span><span class="numeral"><span>6</span></span><span class="main"><span>,</span></span><span class="numeral"><span>4</span></span><span class="main"><span>,</span></span><span class="numeral"><span>7</span></span><span class="main"><span>,</span></span><span class="numeral"><span>3</span></span><span class="main"><span>,</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>,</span></span><span class="numeral"><span>2</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>,</span></span><span class="numeral"><span>4</span></span><span class="main"><span>,</span></span><span class="numeral"><span>6</span></span><span class="main"><span>,</span></span><span class="numeral"><span>5</span></span><span class="main"><span>,</span></span><span class="numeral"><span>2</span></span><span class="main"><span>,</span></span><span class="numeral"><span>3</span></span><span class="main"><span>,</span></span><span class="numeral"><span>7</span></span><span class="main"><span>,</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="numeral"><span>2</span></span><span class="main"><span>,</span></span><span class="numeral"><span>7</span></span><span class="main"><span>,</span></span><span class="numeral"><span>3</span></span><span class="main"><span>,</span></span><span class="numeral"><span>4</span></span><span class="main"><span>,</span></span><span class="numeral"><span>6</span></span><span class="main"><span>,</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>,</span></span><span class="numeral"><span>5</span></span><span class="main"><span>,</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>]</span></span><span class="main"><span>]</span></span><span>
  </span><span class="main"><span>[</span></span><span class="main"><span>[</span></span><span class="numeral"><span>4</span></span><span class="main"><span>,</span></span><span class="numeral"><span>2</span></span><span class="main"><span>,</span></span><span class="numeral"><span>6</span></span><span class="main"><span>,</span></span><span class="numeral"><span>5</span></span><span class="main"><span>,</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>,</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>,</span></span><span class="numeral"><span>7</span></span><span class="main"><span>,</span></span><span class="numeral"><span>3</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="numeral"><span>7</span></span><span class="main"><span>,</span></span><span class="numeral"><span>5</span></span><span class="main"><span>,</span></span><span class="numeral"><span>2</span></span><span class="main"><span>,</span></span><span class="numeral"><span>4</span></span><span class="main"><span>,</span></span><span class="numeral"><span>6</span></span><span class="main"><span>,</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>,</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>,</span></span><span class="numeral"><span>3</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>,</span></span><span class="numeral"><span>4</span></span><span class="main"><span>,</span></span><span class="numeral"><span>5</span></span><span class="main"><span>,</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>,</span></span><span class="numeral"><span>3</span></span><span class="main"><span>,</span></span><span class="numeral"><span>7</span></span><span class="main"><span>,</span></span><span class="numeral"><span>6</span></span><span class="main"><span>,</span></span><span class="numeral"><span>2</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="numeral"><span>7</span></span><span class="main"><span>,</span></span><span class="numeral"><span>6</span></span><span class="main"><span>,</span></span><span class="numeral"><span>2</span></span><span class="main"><span>,</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>,</span></span><span class="numeral"><span>3</span></span><span class="main"><span>,</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>,</span></span><span class="numeral"><span>4</span></span><span class="main"><span>,</span></span><span class="numeral"><span>5</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
   </span><span class="main"><span>[</span></span><span class="numeral"><span>5</span></span><span class="main"><span>,</span></span><span class="numeral"><span>3</span></span><span class="main"><span>,</span></span><span class="numeral"><span>6</span></span><span class="main"><span>,</span></span><span class="numeral"><span>2</span></span><span class="main"><span>,</span></span><span class="numeral"><span>7</span></span><span class="main"><span>,</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>,</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>,</span></span><span class="numeral"><span>4</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>,</span></span><span class="numeral"><span>7</span></span><span class="main"><span>,</span></span><span class="numeral"><span>4</span></span><span class="main"><span>,</span></span><span class="numeral"><span>2</span></span><span class="main"><span>,</span></span><span class="numeral"><span>3</span></span><span class="main"><span>,</span></span><span class="numeral"><span>5</span></span><span class="main"><span>,</span></span><span class="numeral"><span>6</span></span><span class="main"><span>,</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="numeral"><span>6</span></span><span class="main"><span>,</span></span><span class="numeral"><span>4</span></span><span class="main"><span>,</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>,</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>,</span></span><span class="numeral"><span>7</span></span><span class="main"><span>,</span></span><span class="numeral"><span>5</span></span><span class="main"><span>,</span></span><span class="numeral"><span>3</span></span><span class="main"><span>,</span></span><span class="numeral"><span>2</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="numeral"><span>6</span></span><span class="main"><span>,</span></span><span class="numeral"><span>3</span></span><span class="main"><span>,</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>,</span></span><span class="numeral"><span>4</span></span><span class="main"><span>,</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>,</span></span><span class="numeral"><span>2</span></span><span class="main"><span>,</span></span><span class="numeral"><span>5</span></span><span class="main"><span>,</span></span><span class="numeral"><span>7</span></span><span class="main"><span>]</span></span><span class="main"><span>]</span></span><span>
  </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Option.html#Option.option.Some|const"><span>Some</span></a><span> </span><span class="main"><span>[</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>,</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>,</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>,</span></span><span> </span><span class="numeral"><span>5</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>,</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>,</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>,</span></span><span> </span><span class="numeral"><span>2</span></span><span class="main"><span>]</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eval|method"><span class="operator"><span>eval</span></span></a><span>

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span></pre></div><div id='Gale_Shapley2'>ody>
<div class="head">
<h1>Theory Gale_Shapley2</h1>
</div>

<pre class="source"><span class="comment1"><span>(</span><span>*</span><span>
Stepwise refinement of the Gale-Shapley algorithm down to executable code.

Part 2: Refinement from lists to arrays,
        resulting in a linear (in the input size, which is n^2) time algorithm

Author: Tobias Nipkow
</span><span>*</span><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>theory</span></span></span><span> </span><span>Gale_Shapley2</span><span>
</span><span class="keyword2"><span class="keyword"><span>imports</span></span></span><span> </span><a href="Gale_Shapley1.html"><span>Gale_Shapley1</span></a><span> </span><span class="quoted"><span>"</span><a href="../Collections/Diff_Array.html"><span>Collections.Diff_Array</span></a><span>"</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>begin</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>abbreviation</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="Gale_Shapley2.array|const"><span>array</span></span></span><span> </span><span class="main"><span>â¡</span></span><span> </span><a class="entity_ref" href="../Collections/Diff_Array.html#Diff_Array.new_array|const"><span>new_array</span></a><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>notation</span></span></span><span> </span><a class="entity_ref" href="../Collections/Diff_Array.html#Diff_Array.array_get|const"><span>array_get</span></a><span> </span><span class="main"><span>(</span></span><span class="keyword2"><span class="keyword"><span>infixl</span></span></span><span> </span><span class="quoted"><span>"</span><span class="keyword1"><span>!!</span></span><span>"</span></span><span> 100</span><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="command"><span>notation</span></span></span><span> </span><a class="entity_ref" href="../Collections/Diff_Array.html#Diff_Array.array_set|const"><span>array_set</span></a><span> </span><span class="main"><span>(</span></span><span class="quoted"><span>"</span><span>_</span><span class="keyword1"><span>[</span></span><span>_</span><span> </span><span class="keyword1"><span>::=</span></span><span> </span><span>_</span><span class="keyword1"><span>]</span></span><span>"</span></span><span> </span><span class="main"><span>[</span></span><span>1000</span><span class="main"><span>,</span></span><span>0</span><span class="main"><span>,</span></span><span>0</span><span class="main"><span>]</span></span><span> 900</span><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="command"><span>abbreviation</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="Gale_Shapley2.list|const"><span>list</span></span></span><span> </span><span class="main"><span>â¡</span></span><span> </span><a class="entity_ref" href="../Collections/Diff_Array.html#Diff_Array.list_of_array|const"><span>list_of_array</span></a><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Gale_Shapley2.list_array|fact"><span class="entity_def" id="Gale_Shapley2.list_array|thm"><span>list_array</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley2.html#Gale_Shapley2.list|const"><span>list</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Gale_Shapley2.html#Gale_Shapley2.array|const"><span>array</span></a><span> </span><span class="free"><span>x</span></span><span> </span><span class="free"><span>n</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.replicate|const"><span>replicate</span></a><span> </span><span class="free"><span>n</span></span><span> </span><span class="free"><span>x</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../Collections/Diff_Array.html#Diff_Array.new_array_def|fact"><span>new_array_def</span></a><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Gale_Shapley2.array_get|fact"><span class="entity_def" id="Gale_Shapley2.array_get|thm"><span>array_get</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../Collections/Diff_Array.html#Diff_Array.array_get|const"><span>!!</span></a></span><span> </span><span class="free"><span>i</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley2.html#Gale_Shapley2.list|const"><span>list</span></a><span> </span><span class="free"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="free"><span>i</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>cases</span></span><span> </span><span class="quoted"><span class="free"><span>a</span></span></span><span class="main"><span>)</span></span><span> </span><span class="operator"><span>simp</span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_599..606">context</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.Pref|locale"><span>Pref</span></a><span>
</span><span class="keyword2"><span class="keyword"><span>begin</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>subsection</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>â¹</span><span>Algorithm 7: Arrays</span><span>âº</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="Gale_Shapley2.Pref.match_array_def|fact"><span class="entity_def" id="Gale_Shapley2.Pref.match_array_def|thm"><span class="entity_def" id="Gale_Shapley2.Pref.match_array_def_raw|axiom"><span class="entity_def" id="offset_653..663">definition</span></span></span></span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="Gale_Shapley2.Pref.match_array.cong|fact"><span class="entity_def" id="Gale_Shapley2.Pref.match_array.cong|thm"><span class="entity_def" id="Gale_Shapley2.Pref.match_array|const"><span class="entity_def" id="offset_665..676">match_array</span></span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>A</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>a</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>P<span class="hidden">â©</span><sub>a</sub></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>a</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>A</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../Collections/Diff_Array.html#Diff_Array.array_get|const"><span>!!</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>a</span></span></span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Gale_Shapley2.Pref.match_array|fact"><span class="entity_def" id="Gale_Shapley2.Pref.match_array|thm"><span class="entity_def" id="offset_710..721">match_array</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley2.html#offset_665..676"><span>match_array</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="free"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span>match</span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Gale_Shapley2.html#Gale_Shapley2.list|const"><span>list</span></a><span> </span><span class="free"><span>A</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>a</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>by</span></span></span><span class="main"><span>(</span></span><span class="operator"><span>cases</span></span><span> </span><span class="quoted"><span class="free"><span>A</span></span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley2.html#offset_653..663"><span>match_array_def</span></a><span> </span><a class="entity_ref" href="Gale_Shapley2.html#offset_599..606"><span>match_def</span></a><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemmas</span></span></span><span> </span><span class="entity_def" id="Gale_Shapley2.Pref.array_abs|fact"><span class="entity_def" id="Gale_Shapley2.Pref.array_abs(3)|thm"><span class="entity_def" id="Gale_Shapley2.Pref.array_abs(2)|thm"><span class="entity_def" id="Gale_Shapley2.Pref.array_abs(1)|thm"><span class="entity_def" id="offset_818..827">array_abs</span></span></span></span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="Gale_Shapley2.html#offset_710..721"><span>match_array</span></a><span> </span><a class="entity_ref" href="../Collections/Diff_Array.html#Diff_Array.array_list_of_set|fact"><span>array_list_of_set</span></a><span> </span><a class="entity_ref" href="Gale_Shapley2.html#Gale_Shapley2.array_get|fact"><span>array_get</span></a><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Gale_Shapley2.Pref.Gale_Shapley7|fact"><span class="entity_def" id="Gale_Shapley2.Pref.Gale_Shapley7|thm"><span>Gale_Shapley7</span></span></span><span class="main"><span>:</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>R</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.map|const"><span>map</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.ranking|const"><span>ranking</span></a><span> </span><span class="free"><span>P<span class="hidden">â©</span><sub>b</sub></span></span><span>"</span></span></span><span>
</span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span>
</span><span class="quoted"><span class="quoted"><span>"</span><span class="keyword1"><span>VARS</span></span><span> </span><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span>A</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span> </span><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span>B</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span> </span><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span>M</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span> </span><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span>ai</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span> </span><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span>a</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span> </span><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span>a'</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span> </span><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span>b</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span> </span><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span>r</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span>
 </span><span class="main"><span>[</span></span><span class="bound"><span>ai</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><span class="bound"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley2.html#Gale_Shapley2.array|const"><span>array</span></a><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><span class="bound"><span>B</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley2.html#Gale_Shapley2.array|const"><span>array</span></a><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><span class="bound"><span>M</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley2.html#Gale_Shapley2.array|const"><span>array</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.False|const"><span>False</span></a><span> </span><span class="free"><span>n</span></span><span class="main"><span>]</span></span><span>
 </span><span class="keyword1"><span>WHILE</span></span><span> </span><span class="bound"><span>ai</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>n</span></span><span>
 </span><span class="keyword1"><span>INV</span></span><span> </span><span class="main"><span>{</span></span><span> </span><span>invar1</span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Gale_Shapley2.html#Gale_Shapley2.list|const"><span>list</span></a><span> </span><span class="bound"><span>A</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Gale_Shapley2.html#Gale_Shapley2.list|const"><span>list</span></a><span> </span><span class="bound"><span>B</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Gale_Shapley2.html#Gale_Shapley2.list|const"><span>list</span></a><span> </span><span class="bound"><span>M</span></span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>ai</span></span><span> </span><span class="main"><span>}</span></span><span>
 </span><span class="keyword1"><span>VAR</span></span><span> </span><span class="main"><span>{</span></span><span class="bound"><span>z</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="bound"><span>ai</span></span><span class="main"><span>}</span></span><span>
 </span><span class="keyword1"><span>DO</span></span><span> a </span><span class="main"><span>:=</span></span><span> </span><span class="bound"><span>ai</span></span><span class="main"><span>;</span></span><span> b </span><span class="main"><span>:=</span></span><span> </span><a class="entity_ref" href="Gale_Shapley2.html#offset_665..676"><span>match_array</span></a><span> </span><span class="bound"><span>A</span></span><span> </span><span class="bound"><span>a</span></span><span class="main"><span>;</span></span><span>
  </span><span class="keyword1"><span>WHILE</span></span><span> </span><span class="bound"><span>M</span></span><span> </span><span class="main"><a class="entity_ref" href="../Collections/Diff_Array.html#Diff_Array.array_get|const"><span>!!</span></a></span><span> </span><span class="bound"><span>b</span></span><span>
  </span><span class="keyword1"><span>INV</span></span><span> </span><span class="main"><span>{</span></span><span> </span><span>invar2</span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Gale_Shapley2.html#Gale_Shapley2.list|const"><span>list</span></a><span> </span><span class="bound"><span>A</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Gale_Shapley2.html#Gale_Shapley2.list|const"><span>list</span></a><span> </span><span class="bound"><span>B</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Gale_Shapley2.html#Gale_Shapley2.list|const"><span>list</span></a><span> </span><span class="bound"><span>M</span></span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>ai</span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><span class="bound"><span>b</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley2.html#offset_665..676"><span>match_array</span></a><span> </span><span class="bound"><span>A</span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><span class="bound"><span>z</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span class="bound"><span>ai</span></span><span> </span><span class="main"><span>}</span></span><span>
  </span><span class="keyword1"><span>VAR</span></span><span> </span><span class="main"><span>{</span></span><span>var</span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Gale_Shapley2.html#Gale_Shapley2.list|const"><span>list</span></a><span> </span><span class="bound"><span>A</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="bound"><span>ai</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span class="main"><span>}</span></span><span>
  </span><span class="keyword1"><span>DO</span></span><span> a' </span><span class="main"><span>:=</span></span><span> </span><span class="bound"><span>B</span></span><span> </span><span class="main"><a class="entity_ref" href="../Collections/Diff_Array.html#Diff_Array.array_get|const"><span>!!</span></a></span><span> </span><span class="bound"><span>b</span></span><span class="main"><span>;</span></span><span> r </span><span class="main"><span>:=</span></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley2.html#offset_665..676"><span>match_array</span></a><span> </span><span class="bound"><span>A</span></span><span> </span><span class="bound"><span>a'</span></span><span class="main"><span>;</span></span><span>
     </span><span class="keyword1"><span>IF</span></span><span> </span><span class="bound"><span>r</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="bound"><span>r</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="bound"><span>a'</span></span><span>
     </span><span class="keyword1"><span>THEN</span></span><span> B </span><span class="main"><span>:=</span></span><span> </span><span class="bound"><span>B</span></span><span class="main"><a class="entity_ref" href="../Collections/Diff_Array.html#Diff_Array.array_set|const"><span>[</span></a></span><span class="bound"><span>b</span></span><span> </span><span class="main"><a class="entity_ref" href="../Collections/Diff_Array.html#Diff_Array.array_set|const"><span>::=</span></a></span><span> </span><span class="bound"><span>a</span></span><span class="main"><a class="entity_ref" href="../Collections/Diff_Array.html#Diff_Array.array_set|const"><span>]</span></a></span><span class="main"><span>;</span></span><span> A </span><span class="main"><span>:=</span></span><span> </span><span class="bound"><span>A</span></span><span class="main"><a class="entity_ref" href="../Collections/Diff_Array.html#Diff_Array.array_set|const"><span>[</span></a></span><span class="bound"><span>a'</span></span><span> </span><span class="main"><a class="entity_ref" href="../Collections/Diff_Array.html#Diff_Array.array_set|const"><span>::=</span></a></span><span> </span><span class="bound"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="../Collections/Diff_Array.html#Diff_Array.array_get|const"><span>!!</span></a></span><span> </span><span class="bound"><span>a'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><a class="entity_ref" href="../Collections/Diff_Array.html#Diff_Array.array_set|const"><span>]</span></a></span><span class="main"><span>;</span></span><span> a </span><span class="main"><span>:=</span></span><span> </span><span class="bound"><span>a'</span></span><span>
     </span><span class="keyword1"><span>ELSE</span></span><span> A </span><span class="main"><span>:=</span></span><span> </span><span class="bound"><span>A</span></span><span class="main"><a class="entity_ref" href="../Collections/Diff_Array.html#Diff_Array.array_set|const"><span>[</span></a></span><span class="bound"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../Collections/Diff_Array.html#Diff_Array.array_set|const"><span>::=</span></a></span><span> </span><span class="bound"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="../Collections/Diff_Array.html#Diff_Array.array_get|const"><span>!!</span></a></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><a class="entity_ref" href="../Collections/Diff_Array.html#Diff_Array.array_set|const"><span>]</span></a></span><span>
     </span><span class="keyword1"><span>FI</span></span><span class="main"><span>;</span></span><span>
     b </span><span class="main"><span>:=</span></span><span> </span><a class="entity_ref" href="Gale_Shapley2.html#offset_665..676"><span>match_array</span></a><span> </span><span class="bound"><span>A</span></span><span> </span><span class="bound"><span>a</span></span><span>
  </span><span class="keyword1"><span>OD</span></span><span class="main"><span>;</span></span><span>
  B </span><span class="main"><span>:=</span></span><span> </span><span class="bound"><span>B</span></span><span class="main"><a class="entity_ref" href="../Collections/Diff_Array.html#Diff_Array.array_set|const"><span>[</span></a></span><span class="bound"><span>b</span></span><span> </span><span class="main"><a class="entity_ref" href="../Collections/Diff_Array.html#Diff_Array.array_set|const"><span>::=</span></a></span><span> </span><span class="bound"><span>a</span></span><span class="main"><a class="entity_ref" href="../Collections/Diff_Array.html#Diff_Array.array_set|const"><span>]</span></a></span><span class="main"><span>;</span></span><span> M </span><span class="main"><span>:=</span></span><span> </span><span class="bound"><span>M</span></span><span class="main"><a class="entity_ref" href="../Collections/Diff_Array.html#Diff_Array.array_set|const"><span>[</span></a></span><span class="bound"><span>b</span></span><span> </span><span class="main"><a class="entity_ref" href="../Collections/Diff_Array.html#Diff_Array.array_set|const"><span>::=</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.True|const"><span>True</span></a><span class="main"><a class="entity_ref" href="../Collections/Diff_Array.html#Diff_Array.array_set|const"><span>]</span></a></span><span class="main"><span>;</span></span><span> ai </span><span class="main"><span>:=</span></span><span> </span><span class="bound"><span>ai</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span>
 </span><span class="keyword1"><span>OD</span></span><span>
 </span><span class="main"><span>[</span></span><span>matching</span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Gale_Shapley2.html#Gale_Shapley2.list|const"><span>list</span></a><span> </span><span class="bound"><span>A</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><span>stable</span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Gale_Shapley2.html#Gale_Shapley2.list|const"><span>list</span></a><span> </span><span class="bound"><span>A</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><span>opti<span class="hidden">â©</span><sub>a</sub></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Gale_Shapley2.html#Gale_Shapley2.list|const"><span>list</span></a><span> </span><span class="bound"><span>A</span></span><span class="main"><span>)</span></span><span class="main"><span>]</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL-Hoare/Hoare_Logic.html#Hoare_Logic.vcg_tc|method"><span class="operator"><span>vcg_tc</span></span></a><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>goal_cases</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>1</span><span> </span><span class="keyword3"><span class="command"><span>thus</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span>  </span><span class="comment1"><span>(</span><span>*</span><span> outer invar holds initially </span><span>*</span><span>)</span></span><span>
   </span><span class="keyword1"><span class="command"><span>by</span></span></span><span class="main"><span>(</span></span><span class="operator"><span>auto</span></span><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span>  </span><a class="entity_ref" href="Gale_Shapley2.html#offset_599..606"><span>pref_match_def</span></a><span> </span><span>P<span class="hidden">â©</span><sub>a</sub>_set</span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.card_distinct|fact"><span>card_distinct</span></a><span> </span><a class="entity_ref" href="Gale_Shapley2.html#offset_599..606"><span>match_def</span></a><span> </span><a class="entity_ref" href="Gale_Shapley2.html#Gale_Shapley2.list_array|fact"><span>list_array</span></a><span> </span><a class="entity_ref" href="../List-Index/List_Index.html#List_Index.index_nth_id|fact"><span>index_nth_id</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.prefers_def|fact"><span>prefers_def</span></a><span> </span><a class="entity_ref" href="Gale_Shapley2.html#offset_599..606"><span>opti<span class="hidden">â©</span><sub>a</sub>_def</span></a><span> </span><a class="entity_ref" href="Gale_Shapley2.html#offset_599..606"><span>Î±_def</span></a><span> </span><span class="quasi_keyword"><span>cong</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj_cong|fact"><span>conj_cong</span></a><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
  </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>2</span><span> </span><span class="comment1"><span>(</span><span>*</span><span> outer invar and b implies inner invar </span><span>*</span><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>thus</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>auto</span></span><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set_Interval.html#Set_Interval.atLeastLessThanSuc_atLeastAtMost|fact"><span>atLeastLessThanSuc_atLeastAtMost</span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>flip</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set_Interval.html#Set_Interval.order_class.atLeastLessThan_eq_atLeastAtMost_diff|fact"><span>atLeastLessThan_eq_atLeastAtMost_diff</span></a><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
  </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span class="entity_def" id="offset_1979..1980">3</span><span> </span><span class="comment1"><span>(</span><span>*</span><span> preservation of inner invar </span><span>*</span><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_2022..2023">R</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>â</span></span><span class="bound"><span class="bound"><span>b</span></span></span><span class="main"><span>&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>â</span></span><span class="bound"><span class="bound"><span>a1</span></span></span><span class="main"><span>&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>â</span></span><span class="bound"><span class="bound"><span>a2</span></span></span><span class="main"><span>&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="bound"><span>b</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="bound"><span>a1</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="bound"><span>b</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="bound"><span>a2</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.iff|const"><span>â·</span></a></span><span> </span><span class="free"><span>P<span class="hidden">â©</span><sub>b</sub></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="bound"><span>b</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.prefa|const"><span>â¢</span></a></span><span> </span><span class="bound"><span>a1</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.prefa|const"><span>&lt;</span></a></span><span> </span><span class="bound"><span>a2</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><span>P<span class="hidden">â©</span><sub>b</sub>_set</span><span> </span><span class="quoted"><span class="quoted"><span>â¹</span><span class="free"><span>R</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>_</span></span><span>âº</span></span></span><span> </span><span>length_P<span class="hidden">â©</span><sub>b</sub></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.ranking_iff_pref|fact"><span>ranking_iff_pref</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>only</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.mem_Collect_eq|fact"><span>mem_Collect_eq</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.case|fact"><span>prod.case</span></a><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>goal_cases</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>1</span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><span>inner_pres</span><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley2.html#offset_2022..2023"><span>R</span></a><span> _ _ </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.refl|fact"><span>refl</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.refl|fact"><span>refl</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.refl|fact"><span>refl</span></a><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="Gale_Shapley2.html#offset_1979..1980"><span>3</span></a><span>
      </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley2.html#offset_818..827"><span>array_abs</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>blast</span></span><span>
  </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
  </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span class="entity_def" id="offset_2344..2345">4</span><span> </span><span class="comment1"><span>(</span><span>*</span><span> inner invar' and not b implies outer invar </span><span>*</span><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>only</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.mem_Collect_eq|fact"><span>mem_Collect_eq</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.case|fact"><span>prod.case</span></a><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>rule</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conjI|fact"><span>conjI</span></a><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>goal_cases</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>1</span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley2.html#offset_2344..2345"><span>4</span></a><span> </span><span>inner_to_outer</span><span> </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley2.html#offset_818..827"><span>array_abs</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>blast</span></span><span>
  </span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
    </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>2</span><span> </span><span class="keyword3"><span class="command"><span>thus</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley2.html#offset_2344..2345"><span>4</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>auto</span></span><span>
  </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
  </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>5</span><span> </span><span class="comment1"><span>(</span><span>*</span><span> outer invar and not b ibplies post </span><span>*</span><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>thus</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><span>pref_match_stable</span><span> </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley2.html#offset_599..606"><span>invAM_def</span></a><span> </span><a class="entity_ref" href="Gale_Shapley2.html#offset_599..606"><span>invar1_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.le_neq_implies_less|fact"><span>le_neq_implies_less</span></a><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>


</span><span class="keyword1"><span class="command"><span>subsection</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>â¹</span><span>Executable functional Code</span><span>âº</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="Gale_Shapley2.gs_inner_def|fact"><span class="entity_def" id="Gale_Shapley2.gs_inner_def|thm"><span class="entity_def" id="Gale_Shapley2.gs_inner_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="Gale_Shapley2.gs_inner|const"><span>gs_inner</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
</span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>gs_inner</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>P<span class="hidden">â©</span><sub>a</sub></span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>R</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>M</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span>
  </span><a class="entity_ref" href="../../HOL/HOL-Library/While_Combinator.html#While_Combinator.while|const"><span>while</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><span>Î»</span></span><span class="main"><span>(</span></span><span class="bound"><span>A</span></span><span class="main"><span>,</span></span><span class="bound"><span>B</span></span><span class="main"><span>,</span></span><span class="bound"><span>a</span></span><span class="main"><span>,</span></span><span class="bound"><span>b</span></span><span class="main"><span>)</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>M</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../Collections/Diff_Array.html#Diff_Array.array_get|const"><span>!!</span></a></span><span> </span><span class="bound"><span>b</span></span><span class="main"><span>)</span></span><span>
    </span><span class="main"><span>(</span></span><span class="main"><span>Î»</span></span><span class="main"><span>(</span></span><span class="bound"><span>A</span></span><span class="main"><span>,</span></span><span class="bound"><span>B</span></span><span class="main"><span>,</span></span><span class="bound"><span>a</span></span><span class="main"><span>,</span></span><span class="bound"><span>b</span></span><span class="main"><span>)</span></span><span class="main"><span>.</span></span><span>
      </span><span class="keyword1"><span>let</span></span><span> </span><span class="bound"><span>a'</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="bound"><span>B</span></span><span> </span><span class="main"><a class="entity_ref" href="../Collections/Diff_Array.html#Diff_Array.array_get|const"><span>!!</span></a></span><span> </span><span class="bound"><span>b</span></span><span class="main"><span>;</span></span><span>
          </span><span class="bound"><span>r</span></span><span> </span><span class="main"><span>=</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>R</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../Collections/Diff_Array.html#Diff_Array.array_get|const"><span>!!</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>P<span class="hidden">â©</span><sub>a</sub></span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../Collections/Diff_Array.html#Diff_Array.array_get|const"><span>!!</span></a></span><span> </span><span class="bound"><span>a'</span></span><span> </span><span class="main"><a class="entity_ref" href="../Collections/Diff_Array.html#Diff_Array.array_get|const"><span>!!</span></a></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="../Collections/Diff_Array.html#Diff_Array.array_get|const"><span>!!</span></a></span><span> </span><span class="bound"><span>a'</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span>in</span></span><span>
      </span><span class="keyword1"><span>let</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>A</span></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>B</span></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>a</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span>
        </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>if</span></a></span><span> </span><span class="bound"><span>r</span></span><span> </span><span class="main"><a class="entity_ref" href="../Collections/Diff_Array.html#Diff_Array.array_get|const"><span>!!</span></a></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="bound"><span>r</span></span><span> </span><span class="main"><a class="entity_ref" href="../Collections/Diff_Array.html#Diff_Array.array_get|const"><span>!!</span></a></span><span> </span><span class="bound"><span>a'</span></span><span>
        </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>then</span></a></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>A</span></span><span class="main"><a class="entity_ref" href="../Collections/Diff_Array.html#Diff_Array.array_set|const"><span>[</span></a></span><span class="bound"><span>a'</span></span><span> </span><span class="main"><a class="entity_ref" href="../Collections/Diff_Array.html#Diff_Array.array_set|const"><span>::=</span></a></span><span> </span><span class="bound"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="../Collections/Diff_Array.html#Diff_Array.array_get|const"><span>!!</span></a></span><span> </span><span class="bound"><span>a'</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><a class="entity_ref" href="../Collections/Diff_Array.html#Diff_Array.array_set|const"><span>]</span></a></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>B</span></span><span class="main"><a class="entity_ref" href="../Collections/Diff_Array.html#Diff_Array.array_set|const"><span>[</span></a></span><span class="bound"><span>b</span></span><span> </span><span class="main"><a class="entity_ref" href="../Collections/Diff_Array.html#Diff_Array.array_set|const"><span>::=</span></a></span><span> </span><span class="bound"><span>a</span></span><span class="main"><a class="entity_ref" href="../Collections/Diff_Array.html#Diff_Array.array_set|const"><span>]</span></a></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>a'</span></span><span class="main"><span>)</span></span><span>
        </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>else</span></a></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>A</span></span><span class="main"><a class="entity_ref" href="../Collections/Diff_Array.html#Diff_Array.array_set|const"><span>[</span></a></span><span class="bound"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../Collections/Diff_Array.html#Diff_Array.array_set|const"><span>::=</span></a></span><span> </span><span class="bound"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="../Collections/Diff_Array.html#Diff_Array.array_get|const"><span>!!</span></a></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><a class="entity_ref" href="../Collections/Diff_Array.html#Diff_Array.array_set|const"><span>]</span></a></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>B</span></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>a</span></span><span class="main"><span>)</span></span><span>
      </span><span class="keyword1"><span>in</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>A</span></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>B</span></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>a</span></span><span class="main"><span>,</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>P<span class="hidden">â©</span><sub>a</sub></span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../Collections/Diff_Array.html#Diff_Array.array_get|const"><span>!!</span></a></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../Collections/Diff_Array.html#Diff_Array.array_get|const"><span>!!</span></a></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="../Collections/Diff_Array.html#Diff_Array.array_get|const"><span>!!</span></a></span><span> </span><span class="bound"><span>a</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="Gale_Shapley2.gs_def|fact"><span class="entity_def" id="Gale_Shapley2.gs_def|thm"><span class="entity_def" id="Gale_Shapley2.gs_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="Gale_Shapley2.gs|const"><span>gs</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
</span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>gs</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>n</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>P<span class="hidden">â©</span><sub>a</sub></span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>R</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span>
  </span><a class="entity_ref" href="../../HOL/HOL-Library/While_Combinator.html#While_Combinator.while|const"><span>while</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><span>Î»</span></span><span class="main"><span>(</span></span><span class="bound"><span>A</span></span><span class="main"><span>,</span></span><span class="bound"><span>B</span></span><span class="main"><span>,</span></span><span class="bound"><span>M</span></span><span class="main"><span>,</span></span><span class="bound"><span>ai</span></span><span class="main"><span>)</span></span><span class="main"><span>.</span></span><span> </span><span class="bound"><span>ai</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>n</span></span></span></span><span class="main"><span>)</span></span><span>
   </span><span class="main"><span>(</span></span><span class="main"><span>Î»</span></span><span class="main"><span>(</span></span><span class="bound"><span>A</span></span><span class="main"><span>,</span></span><span class="bound"><span>B</span></span><span class="main"><span>,</span></span><span class="bound"><span>M</span></span><span class="main"><span>,</span></span><span class="bound"><span>ai</span></span><span class="main"><span>)</span></span><span class="main"><span>.</span></span><span>
     </span><span class="keyword1"><span>let</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>A</span></span><span class="main"><span>,</span></span><span class="bound"><span>B</span></span><span class="main"><span>,</span></span><span class="bound"><span>a</span></span><span class="main"><span>,</span></span><span class="bound"><span>b</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>=</span></span><span> </span><a class="entity_ref" href="Gale_Shapley2.html#Gale_Shapley2.gs_inner|const"><span>gs_inner</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>P<span class="hidden">â©</span><sub>a</sub></span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>R</span></span></span></span><span> </span><span class="bound"><span>M</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>A</span></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>B</span></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>ai</span></span><span class="main"><span>,</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>P<span class="hidden">â©</span><sub>a</sub></span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../Collections/Diff_Array.html#Diff_Array.array_get|const"><span>!!</span></a></span><span> </span><span class="bound"><span>ai</span></span><span> </span><span class="main"><a class="entity_ref" href="../Collections/Diff_Array.html#Diff_Array.array_get|const"><span>!!</span></a></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="../Collections/Diff_Array.html#Diff_Array.array_get|const"><span>!!</span></a></span><span> </span><span class="bound"><span>ai</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
     </span><span class="keyword1"><span>in</span></span><span> </span><span class="main"><span>(</span></span><span class="bound"><span>A</span></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>B</span></span><span class="main"><a class="entity_ref" href="../Collections/Diff_Array.html#Diff_Array.array_set|const"><span>[</span></a></span><span class="bound"><span>b</span></span><span> </span><span class="main"><a class="entity_ref" href="../Collections/Diff_Array.html#Diff_Array.array_set|const"><span>::=</span></a></span><span> </span><span class="bound"><span>a</span></span><span class="main"><a class="entity_ref" href="../Collections/Diff_Array.html#Diff_Array.array_set|const"><span>]</span></a></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>M</span></span><span class="main"><a class="entity_ref" href="../Collections/Diff_Array.html#Diff_Array.array_set|const"><span>[</span></a></span><span class="bound"><span>b</span></span><span class="main"><a class="entity_ref" href="../Collections/Diff_Array.html#Diff_Array.array_set|const"><span>::=</span></a></span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.True|const"><span>True</span></a><span class="main"><a class="entity_ref" href="../Collections/Diff_Array.html#Diff_Array.array_set|const"><span>]</span></a></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>ai</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><span>(</span></span><a class="entity_ref" href="Gale_Shapley2.html#Gale_Shapley2.array|const"><span>array</span></a><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>n</span></span></span></span><span class="main"><span>,</span></span><span> </span><a class="entity_ref" href="Gale_Shapley2.html#Gale_Shapley2.array|const"><span>array</span></a><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>n</span></span></span></span><span class="main"><span>,</span></span><span> </span><a class="entity_ref" href="Gale_Shapley2.html#Gale_Shapley2.array|const"><span>array</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.False|const"><span>False</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>n</span></span></span></span><span class="main"><span>,</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>)</span></span><span>"</span></span></span><span>


</span><span class="keyword1"><span class="command"><span class="entity_def" id="Gale_Shapley2.pref_array_def|fact"><span class="entity_def" id="Gale_Shapley2.pref_array_def|thm"><span class="entity_def" id="Gale_Shapley2.pref_array_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span class="entity_def" id="Gale_Shapley2.pref_array|const"><span>pref_array</span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../Collections/Diff_Array.html#Diff_Array.array_of_list|const"><span>array_of_list</span></a><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.comp|const"><span>o</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.map|const"><span>map</span></a><span> </span><a class="entity_ref" href="../Collections/Diff_Array.html#Diff_Array.array_of_list|const"><span>array_of_list</span></a><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Gale_Shapley2.list_list_pref_array|fact"><span class="entity_def" id="Gale_Shapley2.list_list_pref_array|thm"><span>list_list_pref_array</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>i</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.length|const"><span>length</span></a><span> </span><span class="free"><span>Pa</span></span><span> </span><span class="main"><span>â¹</span></span><span> </span><a class="entity_ref" href="Gale_Shapley2.html#Gale_Shapley2.list|const"><span>list</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Gale_Shapley2.html#Gale_Shapley2.list|const"><span>list</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Gale_Shapley2.html#Gale_Shapley2.pref_array|const"><span>pref_array</span></a><span> </span><span class="free"><span>Pa</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="free"><span>i</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span>Pa</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="free"><span>i</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>by</span></span></span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley2.html#Gale_Shapley2.pref_array_def|fact"><span>pref_array_def</span></a><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="Gale_Shapley2.rk_of_pref.elims|fact"><span class="entity_def" id="Gale_Shapley2.rk_of_pref.induct|fact"><span class="entity_def" id="Gale_Shapley2.rk_of_pref.simps|fact"><span class="entity_def" id="Gale_Shapley2.rk_of_pref.pelims|fact"><span class="entity_def" id="Gale_Shapley2.rk_of_pref.cases|fact"><span class="entity_def" id="Gale_Shapley2.rk_of_pref.termination|fact"><span class="entity_def" id="Gale_Shapley2.rk_of_pref.pinduct|fact"><span class="entity_def" id="Gale_Shapley2.rk_of_pref.psimps|fact"><span class="entity_def" id="Gale_Shapley2.rk_of_pref_rel.inducts|fact"><span class="entity_def" id="Gale_Shapley2.rk_of_pref_rel.simps|fact"><span class="entity_def" id="Gale_Shapley2.rk_of_pref_rel.induct|fact"><span class="entity_def" id="Gale_Shapley2.rk_of_pref_rel.cases|fact"><span class="entity_def" id="Gale_Shapley2.rk_of_pref_rel.intros|fact"><span class="entity_def" id="Gale_Shapley2.rk_of_pref_graph.inducts|fact"><span class="entity_def" id="Gale_Shapley2.rk_of_pref_graph.simps|fact"><span class="entity_def" id="Gale_Shapley2.rk_of_pref_graph.induct|fact"><span class="entity_def" id="Gale_Shapley2.rk_of_pref_graph.cases|fact"><span class="entity_def" id="Gale_Shapley2.rk_of_pref_graph.intros|fact"><span class="entity_def" id="Gale_Shapley2.rk_of_pref.elims|thm"><span class="entity_def" id="Gale_Shapley2.rk_of_pref.induct|thm"><span class="entity_def" id="Gale_Shapley2.rk_of_pref.simps(2)|thm"><span class="entity_def" id="Gale_Shapley2.rk_of_pref.simps(1)|thm"><span class="entity_def" id="Gale_Shapley2.rk_of_pref.pelims|thm"><span class="entity_def" id="Gale_Shapley2.rk_of_pref.cases|thm"><span class="entity_def" id="Gale_Shapley2.rk_of_pref.termination|thm"><span class="entity_def" id="Gale_Shapley2.rk_of_pref.pinduct|thm"><span class="entity_def" id="Gale_Shapley2.rk_of_pref.psimps(2)|thm"><span class="entity_def" id="Gale_Shapley2.rk_of_pref.psimps(1)|thm"><span class="entity_def" id="Gale_Shapley2.rk_of_pref_rel.inducts|thm"><span class="entity_def" id="Gale_Shapley2.rk_of_pref_rel.simps|thm"><span class="entity_def" id="Gale_Shapley2.rk_of_pref_rel.induct|thm"><span class="entity_def" id="Gale_Shapley2.rk_of_pref_rel.cases|thm"><span class="entity_def" id="Gale_Shapley2.rk_of_pref_rel.intros|thm"><span class="entity_def" id="Gale_Shapley2.rk_of_pref_graph.inducts|thm"><span class="entity_def" id="Gale_Shapley2.rk_of_pref_graph.simps|thm"><span class="entity_def" id="Gale_Shapley2.rk_of_pref_graph.induct|thm"><span class="entity_def" id="Gale_Shapley2.rk_of_pref_graph.cases|thm"><span class="entity_def" id="Gale_Shapley2.rk_of_pref_graph.intros(2)|thm"><span class="entity_def" id="Gale_Shapley2.rk_of_pref_graph.intros(1)|thm"><span class="entity_def" id="Gale_Shapley2.rk_of_pref_def|axiom"><span class="entity_def" id="Gale_Shapley2.rk_of_pref_rel_def|axiom"><span class="entity_def" id="Gale_Shapley2.rk_of_pref_sumC_def|axiom"><span class="entity_def" id="Gale_Shapley2.rk_of_pref_graph_def|axiom"><span class="entity_def" id="Gale_Shapley2.rk_of_pref_dom|const"><span class="entity_def" id="Gale_Shapley2.rk_of_pref_rel|const"><span class="entity_def" id="Gale_Shapley2.rk_of_pref_sumC|const"><span class="entity_def" id="Gale_Shapley2.rk_of_pref_graph|const"><span>fun</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="Gale_Shapley2.rk_of_pref|const"><span>rk_of_pref</span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.nat|type"><span>nat</span></a><span> </span><span class="main"><span>â</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.nat|type"><span>nat</span></a><span> </span><a class="entity_ref" href="../Collections/Diff_Array.html#Diff_Array.array|type"><span>array</span></a><span> </span><span class="main"><span>â</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.nat|type"><span>nat</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list|type"><span>list</span></a><span> </span><span class="main"><span>â</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.nat|type"><span>nat</span></a><span> </span><a class="entity_ref" href="../Collections/Diff_Array.html#Diff_Array.array|type"><span>array</span></a><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
</span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>rk_of_pref</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>r</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>rs</span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>n</span></span></span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.Cons|const"><span>#</span></a></span><span class="free"><span class="bound"><span class="entity"><span>ns</span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>rk_of_pref</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span class="bound"><span class="entity"><span>r</span></span></span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>)</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>rs</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>ns</span></span></span></span><span class="main"><span>)</span></span><span class="main"><a class="entity_ref" href="../Collections/Diff_Array.html#Diff_Array.array_set|const"><span>[</span></a></span><span class="free"><span class="bound"><span class="entity"><span>n</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../Collections/Diff_Array.html#Diff_Array.array_set|const"><span>::=</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>r</span></span></span></span><span class="main"><a class="entity_ref" href="../Collections/Diff_Array.html#Diff_Array.array_set|const"><span>]</span></a></span><span>"</span></span></span><span> </span><span class="main"><span>|</span></span><span>
</span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>rk_of_pref</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>r</span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>rs</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.Nil|const"><span>[]</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>rs</span></span></span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="Gale_Shapley2.rank_array1_def|fact"><span class="entity_def" id="Gale_Shapley2.rank_array1_def|thm"><span class="entity_def" id="Gale_Shapley2.rank_array1_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="Gale_Shapley2.rank_array1|const"><span>rank_array1</span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.nat|type"><span>nat</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list|type"><span>list</span></a><span> </span><span class="main"><span>â</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.nat|type"><span>nat</span></a><span> </span><a class="entity_ref" href="../Collections/Diff_Array.html#Diff_Array.array|type"><span>array</span></a><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
</span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>rank_array1</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>P</span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley2.html#Gale_Shapley2.rk_of_pref|const"><span>rk_of_pref</span></a><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Gale_Shapley2.html#Gale_Shapley2.array|const"><span>array</span></a><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/List.html#List.length|const"><span>length</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>P</span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>P</span></span></span></span><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="Gale_Shapley2.rank_array_def|fact"><span class="entity_def" id="Gale_Shapley2.rank_array_def|thm"><span class="entity_def" id="Gale_Shapley2.rank_array_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="Gale_Shapley2.rank_array|const"><span>rank_array</span></span></span><span> </span><span class="main"><span>::</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.nat|type"><span>nat</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list|type"><span>list</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list|type"><span>list</span></a><span> </span><span class="main"><span>â</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Nat.html#Nat.nat|type"><span>nat</span></a><span> </span><a class="entity_ref" href="../Collections/Diff_Array.html#Diff_Array.array|type"><span>array</span></a><span> </span><a class="entity_ref" href="../Collections/Diff_Array.html#Diff_Array.array|type"><span>array</span></a><span>"</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
</span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>rank_array</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../Collections/Diff_Array.html#Diff_Array.array_of_list|const"><span>array_of_list</span></a><span> </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/Fun.html#Fun.comp|const"><span>o</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.map|const"><span>map</span></a><span> </span><a class="entity_ref" href="Gale_Shapley2.html#Gale_Shapley2.rank_array1|const"><span>rank_array1</span></a><span>"</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Gale_Shapley2.length_rk_of_pref|fact"><span class="entity_def" id="Gale_Shapley2.length_rk_of_pref|thm"><span>length_rk_of_pref</span></span></span><span class="main"><span>[</span></span><span class="operator"><span>simp</span></span><span class="main"><span>]</span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../Collections/Diff_Array.html#Diff_Array.array_length|const"><span>array_length</span></a><span class="main"><span>(</span></span><a class="entity_ref" href="Gale_Shapley2.html#Gale_Shapley2.rk_of_pref|const"><span>rk_of_pref</span></a><span> </span><span class="free"><span>v</span></span><span> </span><span class="free"><span>vs</span></span><span> </span><span class="free"><span>P</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../Collections/Diff_Array.html#Diff_Array.array_length|const"><span>array_length</span></a><span> </span><span class="free"><span>vs</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>by</span></span></span><span class="main"><span>(</span></span><span class="operator"><span>induction</span></span><span> </span><span class="quoted"><span class="free"><span>P</span></span></span><span> </span><span class="quasi_keyword"><span>arbitrary</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><span class="quoted"><span class="free"><span>v</span></span></span><span class="main"><span>)</span></span><span class="main"><span>(</span></span><span class="operator"><span>auto</span></span><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Gale_Shapley2.nth_rk_of_pref|fact"><span class="entity_def" id="Gale_Shapley2.nth_rk_of_pref|thm"><span>nth_rk_of_pref</span></span></span><span class="main"><span>:</span></span><span>
 </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>â¦</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.length|const"><span>length</span></a><span> </span><span class="free"><span>P</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less_eq|const"><span>â¤</span></a></span><span> </span><a class="entity_ref" href="../Collections/Diff_Array.html#Diff_Array.array_length|const"><span>array_length</span></a><span> </span><span class="free"><span>rs</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>i</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.member|const"><span>â</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.set|const"><span>set</span></a><span> </span><span class="free"><span>P</span></span><span class="main"><span>;</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.distinct|const"><span>distinct</span></a><span> </span><span class="free"><span>P</span></span><span class="main"><span>;</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.set|const"><span>set</span></a><span> </span><span class="free"><span>P</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Set.html#Set.subset_eq|const"><span>â</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><a class="entity_ref" href="../Collections/Diff_Array.html#Diff_Array.array_length|const"><span>array_length</span></a><span> </span><span class="free"><span>rs</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><span>â§</span></span><span>
 </span><span class="main"><span>â¹</span></span><span> </span><a class="entity_ref" href="Gale_Shapley2.html#Gale_Shapley2.rk_of_pref|const"><span>rk_of_pref</span></a><span> </span><span class="free"><span>r</span></span><span> </span><span class="free"><span>rs</span></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="main"><a class="entity_ref" href="../Collections/Diff_Array.html#Diff_Array.array_get|const"><span>!!</span></a></span><span> </span><span class="free"><span>i</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../List-Index/List_Index.html#List_Index.index|const"><span>index</span></a><span> </span><span class="free"><span>P</span></span><span> </span><span class="free"><span>i</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span> </span><span class="free"><span>r</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>by</span></span></span><span class="main"><span>(</span></span><span class="operator"><span>induction</span></span><span> </span><span class="quoted"><span class="free"><span>P</span></span></span><span> </span><span class="quasi_keyword"><span>arbitrary</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><span class="quoted"><span class="free"><span>r</span></span></span><span> </span><span class="quoted"><span class="free"><span>i</span></span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>auto</span></span><span> </span><span class="quasi_keyword"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../Collections/Diff_Array.html#Diff_Array.array_get_array_set_other|fact"><span>array_get_array_set_other</span></a><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Gale_Shapley2.rank_array1_iff_pref|fact"><span class="entity_def" id="Gale_Shapley2.rank_array1_iff_pref|thm"><span>rank_array1_iff_pref</span></span></span><span class="main"><span>:</span></span><span>  </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>â¦</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.set|const"><span>set</span></a><span> </span><span class="free"><span>P</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><a class="entity_ref" href="../../HOL/HOL/List.html#List.length|const"><span>length</span></a><span> </span><span class="free"><span>P</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>i</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.length|const"><span>length</span></a><span> </span><span class="free"><span>P</span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>j</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.length|const"><span>length</span></a><span> </span><span class="free"><span>P</span></span><span> </span><span class="main"><span>â§</span></span><span>
 </span><span class="main"><span>â¹</span></span><span> </span><a class="entity_ref" href="Gale_Shapley2.html#Gale_Shapley2.rank_array1|const"><span>rank_array1</span></a><span> </span><span class="free"><span>P</span></span><span> </span><span class="main"><a class="entity_ref" href="../Collections/Diff_Array.html#Diff_Array.array_get|const"><span>!!</span></a></span><span> </span><span class="free"><span>i</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley2.html#Gale_Shapley2.rank_array1|const"><span>rank_array1</span></a><span> </span><span class="free"><span>P</span></span><span> </span><span class="main"><a class="entity_ref" href="../Collections/Diff_Array.html#Diff_Array.array_get|const"><span>!!</span></a></span><span> </span><span class="free"><span>j</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.iff|const"><span>â·</span></a></span><span> </span><span class="free"><span>P</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.prefa|const"><span>â¢</span></a></span><span> </span><span class="free"><span>i</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.prefa|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>j</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>by</span></span></span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley2.html#Gale_Shapley2.rank_array1_def|fact"><span>rank_array1_def</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.prefers_def|fact"><span>prefers_def</span></a><span> </span><a class="entity_ref" href="Gale_Shapley2.html#Gale_Shapley2.nth_rk_of_pref|fact"><span>nth_rk_of_pref</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.card_distinct|fact"><span>card_distinct</span></a><span class="main"><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="Gale_Shapley2.Gale_Shapley_def|fact"><span class="entity_def" id="Gale_Shapley2.Gale_Shapley_def|thm"><span class="entity_def" id="Gale_Shapley2.Gale_Shapley_def_raw|axiom"><span>definition</span></span></span></span></span></span><span> </span><span class="entity"><span class="entity_def" id="Gale_Shapley2.Gale_Shapley|const"><span>Gale_Shapley</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span>
</span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>Gale_Shapley</span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>P<span class="hidden">â©</span><sub>a</sub></span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>P<span class="hidden">â©</span><sub>b</sub></span></span></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span>
  </span><span class="main"><span>(</span></span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>if</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.Pref|const"><span>Pref</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>P<span class="hidden">â©</span><sub>a</sub></span></span></span></span><span> </span><span class="free"><span class="bound"><span class="entity"><span>P<span class="hidden">â©</span><sub>b</sub></span></span></span></span><span>
   </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>then</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Option.html#Option.option.Some|const"><span>Some</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.fst|const"><span>fst</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Gale_Shapley2.html#Gale_Shapley2.gs|const"><span>gs</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/List.html#List.length|const"><span>length</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>P<span class="hidden">â©</span><sub>a</sub></span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Gale_Shapley2.html#Gale_Shapley2.pref_array|const"><span>pref_array</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>P<span class="hidden">â©</span><sub>a</sub></span></span></span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Gale_Shapley2.html#Gale_Shapley2.rank_array|const"><span>rank_array</span></a><span> </span><span class="free"><span class="bound"><span class="entity"><span>P<span class="hidden">â©</span><sub>b</sub></span></span></span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
   </span><span class="keyword1"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.If|const"><span>else</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Option.html#Option.option.None|const"><span>None</span></a><span class="main"><span>)</span></span><span>"</span></span></span><span>

</span><span class="comment1"><span>(</span><span>*</span><span>export_code Gale_Shapley_array in SML</span><span>*</span><span>)</span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_4714..4721">context</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.Pref|locale"><span>Pref</span></a><span>
</span><span class="keyword2"><span class="keyword"><span>begin</span></span></span><span>

</span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_4734..4739">lemma</span></span></span><span> </span><span class="entity_def" id="Gale_Shapley2.Pref.gs_inner|fact"><span class="entity_def" id="Gale_Shapley2.Pref.gs_inner|thm"><span class="entity_def" id="offset_4740..4748">gs_inner</span></span></span><span class="main"><span>:</span></span><span>
</span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>R</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley2.html#Gale_Shapley2.rank_array|const"><span>rank_array</span></a><span> </span><span class="free"><span>P<span class="hidden">â©</span><sub>b</sub></span></span><span>"</span></span></span><span>
</span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>invar2</span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Gale_Shapley2.html#Gale_Shapley2.list|const"><span>list</span></a><span> </span><span class="free"><span>A</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Gale_Shapley2.html#Gale_Shapley2.list|const"><span>list</span></a><span> </span><span class="free"><span>B</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Gale_Shapley2.html#Gale_Shapley2.list|const"><span>list</span></a><span> </span><span class="free"><span>M</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>ai</span></span><span> </span><span class="free"><span>a</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>b</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley2.html#offset_665..676"><span>match_array</span></a><span> </span><span class="free"><span>A</span></span><span> </span><span class="free"><span>a</span></span><span>"</span></span></span><span>
</span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley2.html#Gale_Shapley2.gs_inner|const"><span>gs_inner</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Gale_Shapley2.html#Gale_Shapley2.pref_array|const"><span>pref_array</span></a><span> </span><span class="free"><span>P<span class="hidden">â©</span><sub>a</sub></span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="free"><span>M</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>A</span></span><span class="main"><span>,</span></span><span> </span><span class="free"><span>B</span></span><span class="main"><span>,</span></span><span> </span><span class="free"><span>a</span></span><span class="main"><span>,</span></span><span> </span><span class="free"><span>b</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>A'</span></span><span class="main"><span>,</span></span><span class="free"><span>B'</span></span><span class="main"><span>,</span></span><span class="free"><span>a'</span></span><span class="main"><span>,</span></span><span class="free"><span>b'</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>â¶</span></a></span><span> </span><span>invar1</span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Gale_Shapley2.html#Gale_Shapley2.list|const"><span>list</span></a><span> </span><span class="free"><span>A'</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><a class="entity_ref" href="Gale_Shapley2.html#Gale_Shapley2.list|const"><span>list</span></a><span> </span><span class="free"><span>B'</span></span><span class="main"><span>)</span></span><span class="main"><span>[</span></span><span class="free"><span>b'</span></span><span> </span><span class="main"><span>:=</span></span><span> </span><span class="free"><span>a'</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="main"><span>(</span></span><a class="entity_ref" href="Gale_Shapley2.html#Gale_Shapley2.list|const"><span>list</span></a><span> </span><span class="free"><span>M</span></span><span class="main"><span>)</span></span><span class="main"><span>[</span></span><span class="free"><span>b'</span></span><span> </span><span class="main"><span>:=</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.True|const"><span>True</span></a><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>ai</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.plus_class.plus|const"><span>+</span></a></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley2.html#Gale_Shapley2.gs_inner_def|fact"><span>gs_inner_def</span></a><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span class="main"><span>(</span></span><span class="operator"><span>rule</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.while_rule2|fact"><span>while_rule2</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="keyword2"><span class="keyword"><span class="operator"><span>where</span></span></span></span><span>
     P </span><span class="main"><span class="main"><span class="main"><span>=</span></span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>Î»</span></span><span class="main"><span>(</span></span><span class="bound"><span>A</span></span><span class="main"><span>,</span></span><span class="bound"><span>B</span></span><span class="main"><span>,</span></span><span class="bound"><span>a</span></span><span class="main"><span>,</span></span><span class="bound"><span>b</span></span><span class="main"><span>)</span></span><span class="main"><span>.</span></span><span> </span><span>invar2</span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Gale_Shapley2.html#Gale_Shapley2.list|const"><span>list</span></a><span> </span><span class="bound"><span>A</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Gale_Shapley2.html#Gale_Shapley2.list|const"><span>list</span></a><span> </span><span class="bound"><span>B</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Gale_Shapley2.html#Gale_Shapley2.list|const"><span>list</span></a><span> </span><span class="free"><span>M</span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>ai</span></span><span> </span><span class="bound"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><span class="bound"><span>b</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley2.html#offset_665..676"><span>match_array</span></a><span> </span><span class="bound"><span>A</span></span><span> </span><span class="bound"><span>a</span></span><span>"</span></span></span><span>
 </span><span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword"><span>and</span></span></span></span></span><span> r </span><span class="main"><span class="main"><span class="main"><span>=</span></span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Wellfounded.html#Wellfounded.measure|const"><span>measure</span></a><span> </span><span class="main"><span>(</span></span><span class="main"><span>Î»</span></span><span class="main"><span>(</span></span><span class="bound"><span>A</span></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>B</span></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>a</span></span><span class="main"><span>,</span></span><span> </span><span class="bound"><span>b</span></span><span class="main"><span>)</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.Pref.var|const"><span>Pref.var</span></a><span> </span><span class="free"><span>P<span class="hidden">â©</span><sub>a</sub></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Gale_Shapley2.html#Gale_Shapley2.list|const"><span>list</span></a><span> </span><span class="bound"><span>A</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>ai</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span class="main"><span>)</span></span><span>"</span></span></span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>goal_cases</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>1</span><span>
  </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley2.html#offset_4734..4739"><span>assms</span></a><span> </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley2.html#offset_4714..4721"><span>var_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
</span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
  </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span class="entity_def" id="offset_5276..5279">inv</span><span class="main"><span>:</span></span><span> </span><span class="main"><span>(</span></span><span>2</span><span> </span><span class="skolem"><span>s</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>obtain</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>A</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>B</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>a</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>b</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="entity_def" id="offset_5310..5311">s</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>s</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span>  </span><span class="main"><span>(</span></span><span class="skolem"><span>A</span></span><span class="main"><span>,</span></span><span> </span><span class="skolem"><span>B</span></span><span class="main"><span>,</span></span><span> </span><span class="skolem"><span>a</span></span><span class="main"><span>,</span></span><span> </span><span class="skolem"><span>b</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod_cases4|fact"><span>prod_cases4</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>blast</span></span><span>
  </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span class="main"><span>(</span></span><span class="operator"><span>rule</span></span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>goal_cases</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>1</span><span>
    </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_5423..5424">*</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>n</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley2.html#offset_5310..5311"><span>s</span></a><span> </span><a class="entity_ref" href="Gale_Shapley2.html#offset_5276..5279"><span>inv</span></a><span class="main"><span>(</span></span><span>1</span><span class="main"><span>)</span></span><span class="main"><span>[</span></span><span class="operator"><span>unfolded</span></span><span> </span><a class="entity_ref" href="Gale_Shapley2.html#offset_4714..4721"><span>invar2_def</span></a><span class="main"><span>]</span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>auto</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>hence</span></span></span><span> </span><span>2</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley2.html#Gale_Shapley2.list|const"><span>list</span></a><span> </span><span class="skolem"><span>A</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="skolem"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>n</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley2.html#offset_5310..5311"><span>s</span></a><span> </span><a class="entity_ref" href="Gale_Shapley2.html#offset_5276..5279"><span>inv</span></a><span class="main"><span>(</span></span><span>1</span><span class="main"><span>)</span></span><span class="main"><span>[</span></span><span class="operator"><span>unfolded</span></span><span> </span><a class="entity_ref" href="Gale_Shapley2.html#offset_4714..4721"><span>invar2_def</span></a><span class="main"><span>]</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="operator"><span>simp</span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley2.html#offset_5423..5424"><span>*</span></a><span>"</span></span><span> </span><span>wf_less_n</span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Presburger.html#Presburger.presburger|method"><span class="operator"><span>presburger</span></span></a><span>
    </span><span class="keyword1"><span class="command"><span>hence</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>match</span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Gale_Shapley2.html#Gale_Shapley2.list|const"><span>list</span></a><span> </span><span class="skolem"><span>A</span></span><span class="main"><span>)</span></span><span> </span><span class="skolem"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>n</span></span><span>"</span></span></span><span>
      </span><span class="keyword1"><span class="command"><span class="entity_def" id="offset_5636..5638">by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley2.html#offset_5423..5424"><span>*</span></a><span>"</span></span><span> </span><span>P<span class="hidden">â©</span><sub>a</sub>_set</span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set_Interval.html#Set_Interval.atLeast0LessThan|fact"><span>atLeast0LessThan</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Set_Interval.html#Set_Interval.ord_class.lessThan_iff|fact"><span>lessThan_iff</span></a><span> </span><a class="entity_ref" href="Gale_Shapley2.html#offset_4714..4721"><span>match_def</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth_mem|fact"><span>nth_mem</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>from</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley2.html#offset_5636..5638"><span>this</span></a><span> </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_5726..5728">**</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley2.html#Gale_Shapley2.list|const"><span>list</span></a><span> </span><span class="skolem"><span>B</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span>match</span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Gale_Shapley2.html#Gale_Shapley2.list|const"><span>list</span></a><span> </span><span class="skolem"><span>A</span></span><span class="main"><span>)</span></span><span> </span><span class="skolem"><span>a</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>n</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley2.html#offset_5310..5311"><span>s</span></a><span> </span><a class="entity_ref" href="Gale_Shapley2.html#offset_5276..5279"><span>inv</span></a><span class="main"><span>[</span></span><span class="operator"><span>unfolded</span></span><span> </span><a class="entity_ref" href="Gale_Shapley2.html#offset_4714..4721"><a class="entity_ref" href="Gale_Shapley2.html#offset_4714..4721"><span>invar2_def</span></a></a><span class="main"><span>]</span></span><span>
      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley2.html#offset_818..827"><span>array_abs</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Map.html#Map.ran_def|fact"><span>ran_def</span></a><span class="main"><span>)</span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set_Interval.html#Set_Interval.atLeast0LessThan|fact"><span>atLeast0LessThan</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>blast</span></span><span>
    </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_5878..5879">R</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>â</span></span><span class="bound"><span class="bound"><span>b</span></span></span><span class="main"><span>&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>â</span></span><span class="bound"><span class="bound"><span>a1</span></span></span><span class="main"><span>&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>.</span></span><span> </span><span class="main"><span>â</span></span><span class="bound"><span class="bound"><span>a2</span></span></span><span class="main"><span>&lt;</span></span><span class="free"><span>n</span></span><span class="main"><span>.</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.map|const"><span>map</span></a><span> </span><a class="entity_ref" href="Gale_Shapley2.html#Gale_Shapley2.list|const"><span>list</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Gale_Shapley2.html#Gale_Shapley2.list|const"><span>list</span></a><span> </span><span class="free"><span>R</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="bound"><span>b</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="bound"><span>a1</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.list.map|const"><span>map</span></a><span> </span><a class="entity_ref" href="Gale_Shapley2.html#Gale_Shapley2.list|const"><span>list</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Gale_Shapley2.html#Gale_Shapley2.list|const"><span>list</span></a><span> </span><span class="free"><span>R</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="bound"><span>b</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="bound"><span>a2</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.iff|const"><span>â·</span></a></span><span> </span><span class="free"><span>P<span class="hidden">â©</span><sub>b</sub></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="bound"><span>b</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.prefa|const"><span>â¢</span></a></span><span> </span><span class="bound"><span>a1</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.prefa|const"><span>&lt;</span></a></span><span> </span><span class="bound"><span>a2</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley2.html#Gale_Shapley2.rank_array1_iff_pref|fact"><span>rank_array1_iff_pref</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>â¹</span><span class="free"><span>R</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>_</span></span><span>âº</span></span></span><span> </span><span>length_P<span class="hidden">â©</span><sub>b</sub></span><span> </span><a class="entity_ref" href="Gale_Shapley2.html#Gale_Shapley2.array_get|fact"><span>array_get</span></a><span> </span><span>P<span class="hidden">â©</span><sub>b</sub>_set</span><span> </span><a class="entity_ref" href="Gale_Shapley2.html#Gale_Shapley2.rank_array_def|fact"><span>rank_array_def</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_6085..6088">***</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>match</span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Gale_Shapley2.html#Gale_Shapley2.list|const"><span>list</span></a><span> </span><span class="skolem"><span>A</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Gale_Shapley2.html#Gale_Shapley2.list|const"><span>list</span></a><span> </span><span class="skolem"><span>B</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth|const"><span>!</span></a></span><span> </span><span class="skolem"><span>b</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.length|const"><span>length</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Gale_Shapley2.html#Gale_Shapley2.list|const"><span>list</span></a><span> </span><span class="free"><span>R</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>  </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley2.html#offset_5310..5311"><span>s</span></a><span> </span><a class="entity_ref" href="Gale_Shapley2.html#offset_5276..5279"><span>inv</span></a><span class="main"><span>(</span></span><span>1</span><span class="main"><span>)</span></span><span class="main"><span>[</span></span><span class="operator"><span>unfolded</span></span><span> </span><a class="entity_ref" href="Gale_Shapley2.html#offset_4714..4721"><span>invar2_def</span></a><span class="main"><span>]</span></span><span>
      </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley2.html#offset_5726..5728"><span>**</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>add</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>â¹</span><span class="free"><span>R</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>_</span></span><span>âº</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley2.html#Gale_Shapley2.rank_array_def|fact"><span>rank_array_def</span></a><span> </span><a class="entity_ref" href="Gale_Shapley2.html#offset_710..721"><span>match_array</span></a><span> </span><span>match_less_n</span><span> </span><span>length_P<span class="hidden">â©</span><sub>b</sub></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley2.html#offset_5276..5279"><span>inv</span></a><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>only</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley2.html#offset_5310..5311"><span>s</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.case|fact"><span>prod.case</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Let_def|fact"><span>Let_def</span></a><span> </span><span class="quasi_keyword"><span>split</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.if_split|fact"><span>if_split</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><span>inner_pres</span><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley2.html#offset_5878..5879"><span>R</span></a><span> _ _ </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.refl|fact"><span>refl</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.refl|fact"><span>refl</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.refl|fact"><span>refl</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.refl|fact"><span>refl</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.refl|fact"><span>refl</span></a><span class="main"><span>,</span></span><span> </span><span class="operator"><span>of</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley2.html#Gale_Shapley2.list|const"><span>list</span></a><span> </span><span class="skolem"><span>A</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley2.html#Gale_Shapley2.list|const"><span>list</span></a><span> </span><span class="skolem"><span>B</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley2.html#Gale_Shapley2.list|const"><span>list</span></a><span> </span><span class="free"><span>M</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="free"><span>ai</span></span></span><span> </span><span class="quoted"><span class="skolem"><span>a</span></span></span><span> </span><span class="quoted"><span class="skolem"><span>b</span></span></span><span class="main"><span>]</span></span><span>
    </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley2.html#offset_4714..4721"><span>invar2_def</span></a><span> </span><a class="entity_ref" href="Gale_Shapley2.html#offset_818..827"><span>array_abs</span></a><span>
      </span><a class="entity_ref" href="Gale_Shapley2.html#Gale_Shapley2.list_list_pref_array|fact"><span>list_list_pref_array</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley2.html#offset_5726..5728"><span>**</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>unfolded</span></span><span> </span><a class="entity_ref" href="Gale_Shapley2.html#offset_4714..4721"><span>n_def</span></a><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="Gale_Shapley2.html#Gale_Shapley2.list_list_pref_array|fact"><span>list_list_pref_array</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley2.html#offset_5423..5424"><span>*</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>unfolded</span></span><span> </span><a class="entity_ref" href="Gale_Shapley2.html#offset_4714..4721"><span>n_def</span></a><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth_map|fact"><span>nth_map</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley2.html#offset_6085..6088"><span>***</span></a><span class="main"><span>]</span></span><span>
    </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley2.html#offset_4714..4721"><span>match_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Presburger.html#Presburger.presburger|method"><span class="operator"><span>presburger</span></span></a><span>
    </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>2</span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley2.html#offset_5276..5279"><span>inv</span></a><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command"><span>apply</span></span></span></span></span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>only</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley2.html#offset_5310..5311"><span>s</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.case|fact"><span>prod.case</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Let_def|fact"><span>Let_def</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Wellfounded.html#Wellfounded.in_measure|fact"><span>in_measure</span></a><span> </span><span class="quasi_keyword"><span>split</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.if_split|fact"><span>if_split</span></a><span class="main"><span>)</span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><span>inner_pres</span><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley2.html#offset_5878..5879"><span>R</span></a><span> _ _ </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.refl|fact"><span>refl</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.refl|fact"><span>refl</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.refl|fact"><span>refl</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.refl|fact"><span>refl</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.refl|fact"><span>refl</span></a><span class="main"><span>,</span></span><span> </span><span class="operator"><span>of</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley2.html#Gale_Shapley2.list|const"><span>list</span></a><span> </span><span class="skolem"><span>A</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley2.html#Gale_Shapley2.list|const"><span>list</span></a><span> </span><span class="skolem"><span>B</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley2.html#Gale_Shapley2.list|const"><span>list</span></a><span> </span><span class="free"><span>M</span></span><span>"</span></span></span><span> </span><span class="quoted"><span class="free"><span>ai</span></span></span><span> </span><span class="quoted"><span class="skolem"><span>a</span></span></span><span> </span><span class="quoted"><span class="skolem"><span>b</span></span></span><span class="main"><span>]</span></span><span>
    </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley2.html#offset_4714..4721"><span>invar2_def</span></a><span> </span><a class="entity_ref" href="Gale_Shapley2.html#offset_818..827"><span>array_abs</span></a><span>
      </span><a class="entity_ref" href="Gale_Shapley2.html#Gale_Shapley2.list_list_pref_array|fact"><span>list_list_pref_array</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley2.html#offset_5726..5728"><span>**</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>unfolded</span></span><span> </span><a class="entity_ref" href="Gale_Shapley2.html#offset_4714..4721"><span>n_def</span></a><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="Gale_Shapley2.html#Gale_Shapley2.list_list_pref_array|fact"><span>list_list_pref_array</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley2.html#offset_5423..5424"><span>*</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>unfolded</span></span><span> </span><a class="entity_ref" href="Gale_Shapley2.html#offset_4714..4721"><span>n_def</span></a><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>]</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.nth_map|fact"><span>nth_map</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley2.html#offset_6085..6088"><span>***</span></a><span class="main"><span>]</span></span><span>
    </span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley2.html#offset_4714..4721"><span>match_def</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Presburger.html#Presburger.presburger|method"><span class="operator"><span>presburger</span></span></a><span>
  </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
  </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span class="entity_def" id="offset_7017..7018">3</span><span>
  </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span>
  </span><span class="keyword1"><span class="command"><span>proof</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>rule</span></span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>goal_cases</span></span><span class="main"><span>)</span></span><span>
    </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span class="entity_def" id="offset_7068..7069">1</span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span class="main"><span>(</span></span><span class="operator"><span>rule</span></span><span> </span><span>inner_to_outer</span><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>OF</span></span><span> </span><a class="entity_ref" href="Gale_Shapley2.html#offset_7017..7018"><span>3</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>unfolded</span></span><span> </span><a class="entity_ref" href="Gale_Shapley2.html#offset_7068..7069"><a class="entity_ref" href="Gale_Shapley2.html#offset_7068..7069"><span>1</span></a></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.case|fact"><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.case|fact"><span>prod.case</span></a></a><span> </span><a class="entity_ref" href="Gale_Shapley2.html#offset_818..827"><a class="entity_ref" href="Gale_Shapley2.html#offset_818..827"><span>array_abs</span></a></a><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
  </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>4</span><span>
  </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="entity_def" id="Gale_Shapley2.Pref.gs|fact"><span class="entity_def" id="Gale_Shapley2.Pref.gs|thm"><span>gs</span></span></span><span class="main"><span>:</span></span><span> </span><span class="keyword2"><span class="keyword"><span>assumes</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="free"><span>R</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley2.html#Gale_Shapley2.rank_array|const"><span>rank_array</span></a><span> </span><span class="free"><span>P<span class="hidden">â©</span><sub>b</sub></span></span><span>"</span></span></span><span>
</span><span class="keyword2"><span class="keyword"><span>shows</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="Gale_Shapley2.html#Gale_Shapley2.gs|const"><span>gs</span></a><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Gale_Shapley2.html#Gale_Shapley2.pref_array|const"><span>pref_array</span></a><span> </span><span class="free"><span>P<span class="hidden">â©</span><sub>a</sub></span></span><span class="main"><span>)</span></span><span> </span><span class="free"><span>R</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>(</span></span><span class="free"><span>A</span></span><span class="main"><span>,</span></span><span class="free"><span>B</span></span><span class="main"><span>,</span></span><span class="free"><span>M</span></span><span class="main"><span>,</span></span><span class="free"><span>ai</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.implies|const"><span>â¶</span></a></span><span> </span><span>matching</span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Gale_Shapley2.html#Gale_Shapley2.list|const"><span>list</span></a><span> </span><span class="free"><span>A</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><span>stable</span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Gale_Shapley2.html#Gale_Shapley2.list|const"><span>list</span></a><span> </span><span class="free"><span>A</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><span>opti<span class="hidden">â©</span><sub>a</sub></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Gale_Shapley2.html#Gale_Shapley2.list|const"><span>list</span></a><span> </span><span class="free"><span>A</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley2.html#Gale_Shapley2.gs_def|fact"><span>gs_def</span></a><span>
</span><span class="keyword1"><span class="command"><span>proof</span></span></span><span class="main"><span>(</span></span><span class="operator"><span>rule</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.while_rule2|fact"><span>while_rule2</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="keyword2"><span class="keyword"><span class="operator"><span>where</span></span></span></span><span> P </span><span class="main"><span class="main"><span class="main"><span>=</span></span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>Î»</span></span><span class="main"><span>(</span></span><span class="bound"><span>A</span></span><span class="main"><span>,</span></span><span class="bound"><span>B</span></span><span class="main"><span>,</span></span><span class="bound"><span>M</span></span><span class="main"><span>,</span></span><span class="bound"><span>ai</span></span><span class="main"><span>)</span></span><span class="main"><span>.</span></span><span> </span><span>invar1</span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Gale_Shapley2.html#Gale_Shapley2.list|const"><span>list</span></a><span> </span><span class="bound"><span>A</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Gale_Shapley2.html#Gale_Shapley2.list|const"><span>list</span></a><span> </span><span class="bound"><span>B</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Gale_Shapley2.html#Gale_Shapley2.list|const"><span>list</span></a><span> </span><span class="bound"><span>M</span></span><span class="main"><span>)</span></span><span> </span><span class="bound"><span>ai</span></span><span>"</span></span></span><span>
  </span><span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword"><span>and</span></span></span></span></span><span> r </span><span class="main"><span class="main"><span class="main"><span>=</span></span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../../HOL/HOL/Wellfounded.html#Wellfounded.measure|const"><span>measure</span></a><span class="main"><span>(</span></span><span class="main"><span>Î»</span></span><span class="main"><span>(</span></span><span class="bound"><span>A</span></span><span class="main"><span>,</span></span><span class="bound"><span>B</span></span><span class="main"><span>,</span></span><span class="bound"><span>M</span></span><span class="main"><span>,</span></span><span class="bound"><span>ai</span></span><span class="main"><span>)</span></span><span class="main"><span>.</span></span><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.minus_class.minus|const"><span>-</span></a></span><span> </span><span class="bound"><span>ai</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span class="main"><span class="main"><span>]</span></span></span><span class="main"><span class="keyword3"><span>,</span></span></span><span> </span><span class="operator"><span>goal_cases</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>1</span><span> </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span>
   </span><span class="keyword1"><span class="command"><span>by</span></span></span><span class="main"><span>(</span></span><span class="operator"><span>auto</span></span><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley2.html#offset_4714..4721"><span>pref_match_def</span></a><span> </span><span>P<span class="hidden">â©</span><sub>a</sub>_set</span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.card_distinct|fact"><span>card_distinct</span></a><span> </span><a class="entity_ref" href="Gale_Shapley2.html#offset_4714..4721"><span>match_def</span></a><span> </span><a class="entity_ref" href="Gale_Shapley2.html#Gale_Shapley2.list_array|fact"><span>list_array</span></a><span> </span><a class="entity_ref" href="../List-Index/List_Index.html#List_Index.index_nth_id|fact"><span>index_nth_id</span></a><span> </span><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.prefers_def|fact"><span>prefers_def</span></a><span> </span><a class="entity_ref" href="Gale_Shapley2.html#offset_4714..4721"><span>opti<span class="hidden">â©</span><sub>a</sub>_def</span></a><span> </span><a class="entity_ref" href="Gale_Shapley2.html#offset_4714..4721"><span>Î±_def</span></a><span> </span><span class="quasi_keyword"><span>cong</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj_cong|fact"><span>conj_cong</span></a><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
  </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span class="main"><span>(</span></span><span class="entity_def" id="offset_7663..7664">2</span><span> </span><span class="skolem"><span>s</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>obtain</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>A</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>B</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>M</span></span></span><span> </span><span class="skolem"><span class="skolem"><span>ai</span></span></span><span> </span><span class="keyword2"><span class="keyword"><span>where</span></span></span><span> </span><span class="entity_def" id="offset_7692..7693">s</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>s</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span>  </span><span class="main"><span>(</span></span><span class="skolem"><span>A</span></span><span class="main"><span>,</span></span><span> </span><span class="skolem"><span>B</span></span><span class="main"><span>,</span></span><span> </span><span class="skolem"><span>M</span></span><span class="main"><span>,</span></span><span> </span><span class="skolem"><span>ai</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
    </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod_cases4|fact"><span>prod_cases4</span></a><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>blast</span></span><span>
  </span><span class="keyword1"><span class="command"><span>have</span></span></span><span> </span><span class="entity_def" id="offset_7754..7755">1</span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span>invar2</span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Gale_Shapley2.html#Gale_Shapley2.list|const"><span>list</span></a><span> </span><span class="skolem"><span>A</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Gale_Shapley2.html#Gale_Shapley2.list|const"><span>list</span></a><span> </span><span class="skolem"><span>B</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Gale_Shapley2.html#Gale_Shapley2.list|const"><span>list</span></a><span> </span><span class="skolem"><span>M</span></span><span class="main"><span>)</span></span><span> </span><span class="skolem"><span>ai</span></span><span> </span><span class="skolem"><span>ai</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley2.html#offset_7663..7664"><span>2</span></a><span> </span><a class="entity_ref" href="Gale_Shapley2.html#offset_7692..7693"><span>s</span></a><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>auto</span></span><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set_Interval.html#Set_Interval.atLeastLessThanSuc_atLeastAtMost|fact"><span>atLeastLessThanSuc_atLeastAtMost</span></a><span> </span><span class="quasi_keyword"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>flip</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Set_Interval.html#Set_Interval.order_class.atLeastLessThan_eq_atLeastAtMost_diff|fact"><span>atLeastLessThan_eq_atLeastAtMost_diff</span></a><span class="main"><span>)</span></span><span>
  </span><span class="keyword1"><span class="command"><span>hence</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="skolem"><span>ai</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>n</span></span><span>"</span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span class="main"><span>(</span></span><span class="operator"><span>simp</span></span><span class="main"><span>)</span></span><span>
  </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley2.html#offset_7663..7664"><span>2</span></a><span> </span><a class="entity_ref" href="Gale_Shapley2.html#offset_7692..7693"><span>s</span></a><span> </span><a class="entity_ref" href="Gale_Shapley2.html#offset_4740..4748"><span>gs_inner</span></a><span class="main"><span>[</span></span><span class="operator"><span>OF</span></span><span> </span><span class="quoted"><span class="quoted"><span>â¹</span><span class="free"><span>R</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>_</span></span><span> </span><span>âº</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley2.html#offset_7754..7755"><span>1</span></a><span class="main"><span>]</span></span><span>
    </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>auto</span></span><span> </span><span class="quasi_keyword"><span>simp</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley2.html#offset_818..827"><span>array_abs</span></a><span> </span><a class="entity_ref" href="Gale_Shapley2.html#offset_4714..4721"><span>match_def</span></a><span> </span><a class="entity_ref" href="Gale_Shapley2.html#Gale_Shapley2.list_list_pref_array|fact"><span>list_list_pref_array</span></a><span class="main"><span class="main"><span>[</span></span></span><span class="operator"><span>OF</span></span><span> </span><span class="quoted"><span class="quoted"><span>â¹</span><span class="skolem"><span>ai</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Orderings.html#Orderings.ord_class.less|const"><span>&lt;</span></a></span><span> </span><span class="free"><span>n</span></span><span>âº</span></span></span><span class="main"><span class="main"><span class="main"><span>[</span></span></span></span><span class="operator"><span>unfolded</span></span><span> </span><a class="entity_ref" href="Gale_Shapley2.html#offset_4714..4721"><span>n_def</span></a><span class="main"><span class="main"><span class="main"><span>]</span></span></span></span><span class="main"><span class="main"><span>]</span></span></span><span>
             </span><span class="quasi_keyword"><span>simp</span></span><span> </span><span class="quasi_keyword"><span>del</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley2.html#offset_4714..4721"><span>invar1_def</span></a><span> </span><span class="quasi_keyword"><span>split</span></span><span class="main"><span class="main"><span>:</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.prod.split|fact"><span>prod.split</span></a><span class="main"><span>)</span></span><span>
</span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
  </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>3</span><span>
  </span><span class="keyword3"><span class="command"><span>thus</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><span>pref_match_stable</span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>auto</span></span><span>
</span><span class="keyword1"><span class="command"><span>next</span></span></span><span>
  </span><span class="keyword3"><span class="command"><span>case</span></span></span><span> </span><span>4</span><span>
  </span><span class="keyword3"><span class="command"><span>show</span></span></span><span> </span><span class="var"><span class="quoted"><span class="var"><span>?case</span></span></span></span><span> </span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="operator"><span>simp</span></span><span>
</span><span class="keyword1"><span class="command"><span>qed</span></span></span><span>

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>theorem</span></span></span><span> </span><span class="entity_def" id="Gale_Shapley2.gs|fact"><span class="entity_def" id="Gale_Shapley2.gs|thm"><span>gs</span></span></span><span class="main"><span>:</span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><span class="main"><span>â¦</span></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.Pref|const"><span>Pref</span></a><span> </span><span class="free"><span>P<span class="hidden">â©</span><sub>a</sub></span></span><span> </span><span class="free"><span>P<span class="hidden">â©</span><sub>b</sub></span></span><span class="main"><span>;</span></span><span> </span><span class="free"><span>n</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/List.html#List.length|const"><span>length</span></a><span> </span><span class="free"><span>P<span class="hidden">â©</span><sub>a</sub></span></span><span> </span><span class="main"><span>â§</span></span><span> </span><span class="main"><span>â¹</span></span><span>
 </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Ex|const"><span>â</span></a></span><span class="bound"><span>A</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.Ex|const"><span>.</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley2.html#Gale_Shapley2.Gale_Shapley|const"><span>Gale_Shapley</span></a><span> </span><span class="free"><span>P<span class="hidden">â©</span><sub>a</sub></span></span><span> </span><span class="free"><span>P<span class="hidden">â©</span><sub>b</sub></span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Option.html#Option.option.Some|const"><span>Some</span></a><span> </span><span class="bound"><span>A</span></span><span>
   </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.Pref.matching|const"><span>Pref.matching</span></a><span> </span><span class="free"><span>P<span class="hidden">â©</span><sub>a</sub></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Gale_Shapley2.html#Gale_Shapley2.list|const"><span>list</span></a><span> </span><span class="bound"><span>A</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.Pref.stable|const"><span>Pref.stable</span></a><span> </span><span class="free"><span>P<span class="hidden">â©</span><sub>a</sub></span></span><span> </span><span class="free"><span>P<span class="hidden">â©</span><sub>b</sub></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Gale_Shapley2.html#Gale_Shapley2.list|const"><span>list</span></a><span> </span><span class="bound"><span>A</span></span><span class="main"><span>)</span></span><span> </span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>{&lt;</span></a></span><span class="free"><span>n</span></span><span class="main"><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.upt_set|const"><span>}</span></a></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.conj|const"><span>â§</span></a></span><span> </span><a class="entity_ref" href="Gale_Shapley1.html#Gale_Shapley1.Pref.opti\&lt;^sub&gt;a|const"><span>Pref.opti<span class="hidden">â©</span><sub>a</sub></span></a><span> </span><span class="free"><span>P<span class="hidden">â©</span><sub>a</sub></span></span><span> </span><span class="free"><span>P<span class="hidden">â©</span><sub>b</sub></span></span><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Gale_Shapley2.html#Gale_Shapley2.list|const"><span>list</span></a><span> </span><span class="bound"><span>A</span></span><span class="main"><span>)</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>unfolding</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley2.html#Gale_Shapley2.Gale_Shapley_def|fact"><span>Gale_Shapley_def</span></a><span> </span><span class="keyword1"><span class="command"><span>using</span></span></span><span> </span><a class="entity_ref" href="Gale_Shapley2.html#Gale_Shapley2.Pref.gs|fact"><span>Pref.gs</span></a><span>
</span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><span class="main"><span>(</span></span><span class="operator"><span>metis</span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.fst_conv|fact"><span>fst_conv</span></a><span> </span><a class="entity_ref" href="../../HOL/HOL/Product_Type.html#Product_Type.surj_pair|fact"><span>surj_pair</span></a><span class="main"><span>)</span></span><span>


</span><span class="keyword1"><span class="command"><span>text</span></span></span><span> </span><span class="quoted"><span class="plain_text"><span>â¹</span><span>Two examples from Gusfield and Irving:</span><span>âº</span></span></span><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../Collections/Diff_Array.html#Diff_Array.list_of_array|const"><span>list_of_array</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/Option.html#Option.option.the|const"><span>the</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Gale_Shapley2.html#Gale_Shapley2.Gale_Shapley|const"><span>Gale_Shapley</span></a><span>
  </span><span class="main"><span>[</span></span><span class="main"><span>[</span></span><span class="numeral"><span>3</span></span><span class="main"><span>,</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>,</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>,</span></span><span class="numeral"><span>2</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>,</span></span><span class="numeral"><span>2</span></span><span class="main"><span>,</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>,</span></span><span class="numeral"><span>3</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>,</span></span><span class="numeral"><span>3</span></span><span class="main"><span>,</span></span><span class="numeral"><span>2</span></span><span class="main"><span>,</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="numeral"><span>2</span></span><span class="main"><span>,</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>,</span></span><span class="numeral"><span>3</span></span><span class="main"><span>,</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>]</span></span><span class="main"><span>]</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><span>[</span></span><span class="numeral"><span>3</span></span><span class="main"><span>,</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>,</span></span><span class="numeral"><span>2</span></span><span class="main"><span>,</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>,</span></span><span class="numeral"><span>2</span></span><span class="main"><span>,</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>,</span></span><span class="numeral"><span>3</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>,</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>,</span></span><span class="numeral"><span>2</span></span><span class="main"><span>,</span></span><span class="numeral"><span>3</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="numeral"><span>3</span></span><span class="main"><span>,</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>,</span></span><span class="numeral"><span>2</span></span><span class="main"><span>,</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>]</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>[</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>,</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>,</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>,</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>]</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eval|method"><span class="operator"><span>eval</span></span></a><span>

</span><span class="keyword1"><span class="command"><span>lemma</span></span></span><span> </span><span class="quoted"><span class="quoted"><span>"</span><a class="entity_ref" href="../Collections/Diff_Array.html#Diff_Array.list_of_array|const"><span>list_of_array</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="../../HOL/HOL/Option.html#Option.option.the|const"><span>the</span></a><span> </span><span class="main"><span>(</span></span><a class="entity_ref" href="Gale_Shapley2.html#Gale_Shapley2.Gale_Shapley|const"><span>Gale_Shapley</span></a><span>
  </span><span class="main"><span>[</span></span><span class="main"><span>[</span></span><span class="numeral"><span>4</span></span><span class="main"><span>,</span></span><span class="numeral"><span>6</span></span><span class="main"><span>,</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>,</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>,</span></span><span class="numeral"><span>5</span></span><span class="main"><span>,</span></span><span class="numeral"><span>7</span></span><span class="main"><span>,</span></span><span class="numeral"><span>3</span></span><span class="main"><span>,</span></span><span class="numeral"><span>2</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>,</span></span><span class="numeral"><span>2</span></span><span class="main"><span>,</span></span><span class="numeral"><span>6</span></span><span class="main"><span>,</span></span><span class="numeral"><span>4</span></span><span class="main"><span>,</span></span><span class="numeral"><span>3</span></span><span class="main"><span>,</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>,</span></span><span class="numeral"><span>7</span></span><span class="main"><span>,</span></span><span class="numeral"><span>5</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="numeral"><span>7</span></span><span class="main"><span>,</span></span><span class="numeral"><span>4</span></span><span class="main"><span>,</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>,</span></span><span class="numeral"><span>3</span></span><span class="main"><span>,</span></span><span class="numeral"><span>5</span></span><span class="main"><span>,</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>,</span></span><span class="numeral"><span>2</span></span><span class="main"><span>,</span></span><span class="numeral"><span>6</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="numeral"><span>2</span></span><span class="main"><span>,</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>,</span></span><span class="numeral"><span>6</span></span><span class="main"><span>,</span></span><span class="numeral"><span>3</span></span><span class="main"><span>,</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>,</span></span><span class="numeral"><span>5</span></span><span class="main"><span>,</span></span><span class="numeral"><span>7</span></span><span class="main"><span>,</span></span><span class="numeral"><span>4</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
   </span><span class="main"><span>[</span></span><span class="numeral"><span>6</span></span><span class="main"><span>,</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>,</span></span><span class="numeral"><span>4</span></span><span class="main"><span>,</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>,</span></span><span class="numeral"><span>2</span></span><span class="main"><span>,</span></span><span class="numeral"><span>5</span></span><span class="main"><span>,</span></span><span class="numeral"><span>7</span></span><span class="main"><span>,</span></span><span class="numeral"><span>3</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>,</span></span><span class="numeral"><span>5</span></span><span class="main"><span>,</span></span><span class="numeral"><span>6</span></span><span class="main"><span>,</span></span><span class="numeral"><span>4</span></span><span class="main"><span>,</span></span><span class="numeral"><span>7</span></span><span class="main"><span>,</span></span><span class="numeral"><span>3</span></span><span class="main"><span>,</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>,</span></span><span class="numeral"><span>2</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>,</span></span><span class="numeral"><span>4</span></span><span class="main"><span>,</span></span><span class="numeral"><span>6</span></span><span class="main"><span>,</span></span><span class="numeral"><span>5</span></span><span class="main"><span>,</span></span><span class="numeral"><span>2</span></span><span class="main"><span>,</span></span><span class="numeral"><span>3</span></span><span class="main"><span>,</span></span><span class="numeral"><span>7</span></span><span class="main"><span>,</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="numeral"><span>2</span></span><span class="main"><span>,</span></span><span class="numeral"><span>7</span></span><span class="main"><span>,</span></span><span class="numeral"><span>3</span></span><span class="main"><span>,</span></span><span class="numeral"><span>4</span></span><span class="main"><span>,</span></span><span class="numeral"><span>6</span></span><span class="main"><span>,</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>,</span></span><span class="numeral"><span>5</span></span><span class="main"><span>,</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>]</span></span><span class="main"><span>]</span></span><span>
  </span><span class="main"><span>[</span></span><span class="main"><span>[</span></span><span class="numeral"><span>4</span></span><span class="main"><span>,</span></span><span class="numeral"><span>2</span></span><span class="main"><span>,</span></span><span class="numeral"><span>6</span></span><span class="main"><span>,</span></span><span class="numeral"><span>5</span></span><span class="main"><span>,</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>,</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>,</span></span><span class="numeral"><span>7</span></span><span class="main"><span>,</span></span><span class="numeral"><span>3</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="numeral"><span>7</span></span><span class="main"><span>,</span></span><span class="numeral"><span>5</span></span><span class="main"><span>,</span></span><span class="numeral"><span>2</span></span><span class="main"><span>,</span></span><span class="numeral"><span>4</span></span><span class="main"><span>,</span></span><span class="numeral"><span>6</span></span><span class="main"><span>,</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>,</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>,</span></span><span class="numeral"><span>3</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>,</span></span><span class="numeral"><span>4</span></span><span class="main"><span>,</span></span><span class="numeral"><span>5</span></span><span class="main"><span>,</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>,</span></span><span class="numeral"><span>3</span></span><span class="main"><span>,</span></span><span class="numeral"><span>7</span></span><span class="main"><span>,</span></span><span class="numeral"><span>6</span></span><span class="main"><span>,</span></span><span class="numeral"><span>2</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="numeral"><span>7</span></span><span class="main"><span>,</span></span><span class="numeral"><span>6</span></span><span class="main"><span>,</span></span><span class="numeral"><span>2</span></span><span class="main"><span>,</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>,</span></span><span class="numeral"><span>3</span></span><span class="main"><span>,</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>,</span></span><span class="numeral"><span>4</span></span><span class="main"><span>,</span></span><span class="numeral"><span>5</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span>
   </span><span class="main"><span>[</span></span><span class="numeral"><span>5</span></span><span class="main"><span>,</span></span><span class="numeral"><span>3</span></span><span class="main"><span>,</span></span><span class="numeral"><span>6</span></span><span class="main"><span>,</span></span><span class="numeral"><span>2</span></span><span class="main"><span>,</span></span><span class="numeral"><span>7</span></span><span class="main"><span>,</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>,</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>,</span></span><span class="numeral"><span>4</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>,</span></span><span class="numeral"><span>7</span></span><span class="main"><span>,</span></span><span class="numeral"><span>4</span></span><span class="main"><span>,</span></span><span class="numeral"><span>2</span></span><span class="main"><span>,</span></span><span class="numeral"><span>3</span></span><span class="main"><span>,</span></span><span class="numeral"><span>5</span></span><span class="main"><span>,</span></span><span class="numeral"><span>6</span></span><span class="main"><span>,</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="numeral"><span>6</span></span><span class="main"><span>,</span></span><span class="numeral"><span>4</span></span><span class="main"><span>,</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>,</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>,</span></span><span class="numeral"><span>7</span></span><span class="main"><span>,</span></span><span class="numeral"><span>5</span></span><span class="main"><span>,</span></span><span class="numeral"><span>3</span></span><span class="main"><span>,</span></span><span class="numeral"><span>2</span></span><span class="main"><span>]</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><span>[</span></span><span class="numeral"><span>6</span></span><span class="main"><span>,</span></span><span class="numeral"><span>3</span></span><span class="main"><span>,</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>,</span></span><span class="numeral"><span>4</span></span><span class="main"><span>,</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>,</span></span><span class="numeral"><span>2</span></span><span class="main"><span>,</span></span><span class="numeral"><span>5</span></span><span class="main"><span>,</span></span><span class="numeral"><span>7</span></span><span class="main"><span>]</span></span><span class="main"><span>]</span></span><span class="main"><span>)</span></span><span class="main"><span>)</span></span><span>
  </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eq|const"><span>=</span></a></span><span> </span><span class="main"><span>[</span></span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>,</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.one_class.one|const"><span>1</span></a></span><span class="main"><span>,</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>,</span></span><span> </span><span class="numeral"><span>5</span></span><span class="main"><span>,</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>,</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>,</span></span><span> </span><span class="main"><a class="entity_ref" href="../../HOL/HOL/Groups.html#Groups.zero_class.zero|const"><span>0</span></a></span><span class="main"><span>,</span></span><span> </span><span class="numeral"><span>2</span></span><span class="main"><span>]</span></span><span>"</span></span></span><span>
</span><span class="keyword1"><span class="command"><span>by</span></span></span><span> </span><a class="entity_ref" href="../../HOL/HOL/HOL.html#HOL.eval|method"><span class="operator"><span>eval</span></span></a><span>

</span><span class="keyword2"><span class="keyword"><span>end</span></span></span></pre></div>