<div id="RRI_Misc">
<div class="head">
<h1>Theory RRI_Misc</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Misc results about polynomials›</span></span>

<span class="keyword1"><span class="command">theory</span></span> RRI_Misc <span class="keyword2"><span class="keyword">imports</span></span> 
  <span class="quoted">"<a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL-Computational_Algebra/Computational_Algebra.html">HOL-Computational_Algebra.Computational_Algebra</a>"</span> 
  <span class="quoted">"<a href="../../budan_fourier/theories/#BF_Misc">Budan_Fourier.BF_Misc</a>"</span>
  <span class="quoted">"<a href="../../polynomial_interpolation/theories/#Ring_Hom_Poly">Polynomial_Interpolation.Ring_Hom_Poly</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Misc›</span></span>

<span class="keyword1"><span class="command">declare</span></span> pcompose_pCons<span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span>

<span class="keyword1" id="RRI_Misc-Setcompr_subset"><span class="command">lemma</span></span> Setcompr_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">f</span> <span class="bound">P</span> <span class="bound">S</span><span class="main">.</span> <span class="main">{</span><span class="bound">f</span> <span class="bound">x</span> <span class="main">|</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">P</span> <span class="bound">x</span><span class="main">}</span> <span class="main">⊆</span> <span class="bound">S</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">P</span> <span class="bound">x</span> <span class="main">⟶</span> <span class="bound">f</span> <span class="bound">x</span> <span class="main">∈</span> <span class="bound">S</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="RRI_Misc-map_cong'"><span class="command">lemma</span></span> map_cong'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">=</span> map <span class="free">h</span> <span class="free">ys</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> set <span class="free">ys</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">(</span><span class="free">h</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">g</span> <span class="bound">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"map <span class="free">f</span> <span class="free">xs</span> <span class="main">=</span> map <span class="free">g</span> <span class="free">ys</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms map_replicate_trivial <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="RRI_Misc-nth_default_replicate_eq"><span class="command">lemma</span></span> nth_default_replicate_eq<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"nth_default <span class="free">dflt</span> <span class="main">(</span>replicate <span class="free">n</span> <span class="free">x</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">i</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="keyword1">then</span> <span class="free">x</span> <span class="keyword1">else</span> <span class="free">dflt</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nth_default_def<span class="main">)</span>

<span class="keyword1" id="RRI_Misc-square_bounded_less"><span class="command">lemma</span></span> square_bounded_less<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="free">b</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> linordered_ring_strict"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">&lt;</span> <span class="free">a</span> <span class="main">⟹</span> <span class="free">b</span><span class="main">*</span><span class="free">b</span> <span class="main">&lt;</span> <span class="free">a</span><span class="main">*</span><span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> leD leI minus_less_iff minus_mult_minus mult_strict_mono'
      neg_less_eq_nonneg neg_less_pos verit_minus_simplify<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> zero_le_mult_iff zero_le_square<span class="main">)</span>

<span class="keyword1" id="RRI_Misc-square_bounded_le"><span class="command">lemma</span></span> square_bounded_le<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="free">b</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> linordered_ring_strict"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">a</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">≤</span> <span class="free">a</span> <span class="main">⟹</span> <span class="free">b</span><span class="main">*</span><span class="free">b</span> <span class="main">≤</span> <span class="free">a</span><span class="main">*</span><span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le_less minus_mult_minus square_bounded_less<span class="main">)</span>

<span class="keyword1"><span class="command">context</span></span> vector_space
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="RRI_Misc-card_le_dim_spanning"><span class="command">lemma</span></span> card_le_dim_spanning<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> BV<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">⊆</span> <span class="free">V</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> VB<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">V</span> <span class="main">⊆</span> span <span class="free">B</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> fB<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> dVB<span class="main">:</span> <span class="quoted"><span class="quoted">"dim <span class="free">V</span> <span class="main">≥</span> card <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"independent <span class="free">B</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span>
    <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> span <span class="main">(</span><span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> a fB <span class="keyword1"><span class="command">have</span></span> c0<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="free">B</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> a fB <span class="keyword1"><span class="command">have</span></span> cb<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> card <span class="free">B</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
      <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">V</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> a <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"insert <span class="skolem">a</span> <span class="main">(</span><span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="free">B</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> x VB <span class="keyword1"><span class="command">have</span></span> x'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> span <span class="free">B</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> span_trans<span class="main">[</span><span class="operator">OF</span> a<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">unfolded</span> eq<span class="main">,</span> <span class="operator">OF</span> x'<span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> span <span class="main">(</span><span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> th1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">V</span> <span class="main">⊆</span> span <span class="main">(</span><span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> th2<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> fB <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> dim_le_card<span class="main">[</span><span class="operator">OF</span> th1 th2<span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"dim <span class="free">V</span> <span class="main">≤</span> card <span class="main">(</span><span class="free">B</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">from</span></span> c c0 dVB cb <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> dependent_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Misc results about polynomials›</span></span>

<span class="keyword1" id="RRI_Misc-smult_power"><span class="command">lemma</span></span> smult_power<span class="main">:</span> <span class="quoted"><span class="quoted">"smult <span class="main">(</span><span class="free">x</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="main">(</span><span class="free">p</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="main">=</span> smult <span class="free">x</span> <span class="free">p</span> <span class="main">^</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> mult_smult_left mult_smult_right 
      power_Suc smult_smult<span class="main">)</span>

<span class="keyword1" id="RRI_Misc-reflect_poly_monom"><span class="command">lemma</span></span> reflect_poly_monom<span class="main">:</span> <span class="quoted"><span class="quoted">"reflect_poly <span class="main">(</span>monom <span class="free">n</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> monom <span class="free">n</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">i</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> coeffs_eq_iff coeffs_monom coeffs_reflect_poly<span class="main">)</span>

<span class="keyword1" id="RRI_Misc-poly_eq_by_eval"><span class="command">lemma</span></span> poly_eq_by_eval<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">P</span> <span class="free">Q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>comm_ring_1<span class="main">,</span>ring_no_zero_divisors<span class="main">,</span>ring_char_0<span class="main">}</span> poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">P</span> <span class="bound">x</span> <span class="main">=</span> poly <span class="free">Q</span> <span class="bound">x</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">=</span> <span class="free">Q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">P</span> <span class="main">=</span> poly <span class="free">Q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> h <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> poly_eq_poly_eq_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="RRI_Misc-poly_binomial"><span class="command">lemma</span></span> poly_binomial<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>comm_ring_1<span class="main">)</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">^</span><span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="free">n</span><span class="main">.</span> monom <span class="main">(</span>of_nat <span class="main">(</span><span class="free">n</span> <span class="keyword1">choose</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>comm_ring_1<span class="main">)</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">^</span><span class="free">n</span> <span class="main">=</span> <span class="main">(</span>monom <span class="main">1</span> <span class="main">1</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> add.left_neutral add.right_neutral add_pCons
        monom_altdef pCons_one power_one_right smult_1_left<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="free">n</span><span class="main">.</span> of_nat <span class="main">(</span><span class="free">n</span> <span class="keyword1">choose</span> <span class="bound">k</span><span class="main">)</span> <span class="main">*</span> monom <span class="main">1</span> <span class="main">1</span> <span class="main">^</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> binomial_ring<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="free">n</span><span class="main">.</span> monom <span class="main">(</span>of_nat <span class="main">(</span><span class="free">n</span> <span class="keyword1">choose</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> monom_altdef of_nat_poly<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="RRI_Misc-degree_0_iff"><span class="command">lemma</span></span> degree_0_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">P</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">a</span><span class="main">.</span> <span class="free">P</span> <span class="main">=</span> <span class="main">[:</span><span class="bound">a</span><span class="main">:]</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> degree_eq_zeroE degree_pCons_0<span class="main">)</span>

<span class="keyword1"><span class="command">interpretation</span></span> poly_vs<span class="main">:</span> vector_space <span class="quoted">smult</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vector_space_def smult_add_right smult_add_left<span class="main">)</span>

<span class="keyword1" id="RRI_Misc-degree_subspace"><span class="command">lemma</span></span> degree_subspace<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_vs.subspace <span class="main">{</span><span class="bound">x</span><span class="main">.</span> degree <span class="bound">x</span> <span class="main">≤</span> <span class="free">n</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> poly_vs.subspace_def degree_add_le<span class="main">)</span>

<span class="keyword1" id="RRI_Misc-monom_span"><span class="command">lemma</span></span> monom_span<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"poly_vs.span <span class="main">{</span>monom <span class="main">1</span> <span class="bound">x</span> <span class="main">|</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">p</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>field poly<span class="main">)</span><span class="main">.</span> degree <span class="bound">x</span> <span class="main">≤</span> <span class="free">p</span><span class="main">}</span>"</span></span>
<span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">=</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">⊆</span> <span class="var">?R</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="var">?L</span>"</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> hfin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">P</span><span class="main">.</span> <span class="main">∃</span><span class="bound">x</span> <span class="main">∈</span> <span class="main">{..</span><span class="free">p</span><span class="main">}</span><span class="main">.</span> <span class="bound">P</span> <span class="main">=</span> monom <span class="main">1</span> <span class="bound">x</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> 
      <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> range <span class="main">(</span><span class="main">λ</span><span class="bound">u</span><span class="main">.</span> <span class="main">∑</span><span class="bound">v</span><span class="main">∈</span><span class="main">{</span>monom <span class="main">1</span> <span class="bound">x</span> <span class="main">|</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{..</span><span class="free">p</span><span class="main">}</span><span class="main">}</span><span class="main">.</span> smult <span class="main">(</span><span class="bound">u</span> <span class="bound">v</span><span class="main">)</span> <span class="bound">v</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_vs.span_finite<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">u</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">v</span><span class="main">∈</span><span class="main">{</span>monom <span class="main">1</span> <span class="bound">x</span> <span class="main">|</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{..</span><span class="free">p</span><span class="main">}</span><span class="main">}</span><span class="main">.</span> smult <span class="main">(</span><span class="bound">u</span> <span class="bound">v</span><span class="main">)</span> <span class="bound">v</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> image_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> 
      <span class="keyword2"><span class="keyword">where</span></span> p'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">v</span><span class="main">∈</span><span class="main">{</span>monom <span class="main">1</span> <span class="bound">x</span> <span class="main">|</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{..</span><span class="free">p</span><span class="main">}</span><span class="main">}</span><span class="main">.</span> smult <span class="main">(</span><span class="skolem">u</span> <span class="bound">v</span><span class="main">)</span> <span class="bound">v</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∈</span> <span class="main">{</span>monom <span class="main">1</span> <span class="bound">x</span> <span class="main">|</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{..</span><span class="free">p</span><span class="main">}</span><span class="main">}</span> <span class="main">⟹</span> degree <span class="main">(</span>smult <span class="main">(</span><span class="skolem">u</span> <span class="bound">v</span><span class="main">)</span> <span class="bound">v</span><span class="main">)</span> <span class="main">≤</span> <span class="free">p</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> degree_monom_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">x</span> <span class="main">≤</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hfin
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> p'<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> degree_sum_le<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> degree <span class="bound">x</span> <span class="main">≤</span> <span class="free">p</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?R</span> <span class="main">⊆</span> <span class="var">?L</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="var">?R</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">x</span> <span class="main">≤</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">≤</span><span class="free">p</span><span class="main">.</span> monom <span class="main">(</span>coeff <span class="skolem">x</span> <span class="bound">i</span><span class="main">)</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_as_sum_of_monoms'<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">≤</span><span class="free">p</span><span class="main">.</span> smult <span class="main">(</span>coeff <span class="skolem">x</span> <span class="main">(</span>degree <span class="main">(</span>monom <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>monom <span class="main">1</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> smult_monom degree_monom_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">v</span><span class="main">∈</span><span class="main">{</span>monom <span class="main">1</span> <span class="bound">x</span> <span class="main">|</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{..</span><span class="free">p</span><span class="main">}</span><span class="main">}</span><span class="main">.</span> smult <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">v</span><span class="main">.</span> coeff <span class="skolem">x</span> <span class="main">(</span>degree <span class="bound">v</span><span class="main">)</span><span class="main">)</span> <span class="bound">v</span><span class="main">)</span> <span class="bound">v</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum.reindex_cong<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inj_on degree <span class="main">{</span>monom <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="bound">x</span> <span class="main">|</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{..</span><span class="free">p</span><span class="main">}</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> 
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span>monom <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="bound">x</span> <span class="main">|</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{..</span><span class="free">p</span><span class="main">}</span><span class="main">}</span>"</span></span> 
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">a</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">=</span> monom <span class="main">1</span> <span class="bound">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> hx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> monom <span class="main">1</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span> 
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="main">{</span>monom <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="bound">x</span> <span class="main">|</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{..</span><span class="free">p</span><span class="main">}</span><span class="main">}</span>"</span></span> 
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">b</span><span class="main">.</span> <span class="skolem">y</span> <span class="main">=</span> monom <span class="main">1</span> <span class="bound">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> hy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> monom <span class="main">1</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">x</span> <span class="main">=</span> degree <span class="skolem">y</span>"</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hx hy <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> degree_monom_eq<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{..</span><span class="free">p</span><span class="main">}</span> <span class="main">=</span> degree <span class="main">`</span> <span class="main">{</span>monom <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="bound">x</span> <span class="main">|</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{..</span><span class="free">p</span><span class="main">}</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{..</span><span class="free">p</span><span class="main">}</span> <span class="main">⊆</span> degree <span class="main">`</span> <span class="main">{</span>monom <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="bound">x</span> <span class="main">|</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{..</span><span class="free">p</span><span class="main">}</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{..</span><span class="free">p</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"monom <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span>monom <span class="main">1</span> <span class="bound">x</span> <span class="main">|</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{..</span><span class="free">p</span><span class="main">}</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>monom <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> degree_monom_eq<span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> degree <span class="main">`</span> <span class="main">{</span>monom <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="bound">x</span> <span class="main">|</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{..</span><span class="free">p</span><span class="main">}</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">`</span> <span class="main">{</span>monom <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="bound">x</span> <span class="main">|</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{..</span><span class="free">p</span><span class="main">}</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{..</span><span class="free">p</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> degree_monom_eq<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="main">{</span>monom <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="bound">x</span> <span class="main">|</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{..</span><span class="free">p</span><span class="main">}</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">z</span> <span class="main">∈</span> <span class="main">{..</span><span class="free">p</span><span class="main">}</span><span class="main">.</span> <span class="skolem">y</span> <span class="main">=</span> monom <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="bound">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> monom <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">thus</span></span> 
        <span class="quoted"><span class="quoted">"smult <span class="main">(</span>coeff <span class="skolem">x</span> <span class="main">(</span>degree <span class="main">(</span>monom <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">(</span>degree <span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>monom <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">(</span>degree <span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
         smult <span class="main">(</span>coeff <span class="skolem">x</span> <span class="main">(</span>degree <span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="skolem">y</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> smult_monom degree_monom_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">v</span><span class="main">∈</span><span class="main">{</span>monom <span class="main">1</span> <span class="bound">x</span> <span class="main">|</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{..</span><span class="free">p</span><span class="main">}</span><span class="main">}</span><span class="main">.</span> 
                      smult <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">v</span><span class="main">.</span> coeff <span class="skolem">x</span> <span class="main">(</span>degree <span class="bound">v</span><span class="main">)</span><span class="main">)</span> <span class="bound">v</span><span class="main">)</span> <span class="bound">v</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="var">?L</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_vs.span_finite<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="RRI_Misc-monom_independent"><span class="command">lemma</span></span> monom_independent<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"poly_vs.independent <span class="main">{</span>monom <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>field<span class="main">)</span> <span class="bound">x</span> <span class="main">|</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">p</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> poly_vs.independent_if_scalars_zero<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> poly <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span>monom <span class="main">1</span> <span class="bound">x</span> <span class="main">|</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">p</span><span class="main">}</span><span class="main">.</span> smult <span class="main">(</span><span class="skolem">f</span> <span class="bound">x</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> h'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">≤</span><span class="free">p</span><span class="main">.</span> monom <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span>monom <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> 
            <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span>monom <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="bound">x</span> <span class="main">|</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">p</span><span class="main">}</span><span class="main">.</span> smult <span class="main">(</span><span class="skolem">f</span> <span class="bound">x</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum.reindex_cong<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inj_on degree <span class="main">{</span>monom <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="bound">x</span> <span class="main">|</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">p</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">)</span></span> degree_monom_eq inj_on_def mem_Collect_eq zero_neq_one<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{..</span><span class="free">p</span><span class="main">}</span> <span class="main">=</span> degree <span class="main">`</span> <span class="main">{</span>monom <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="bound">x</span> <span class="main">|</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">p</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{..</span><span class="free">p</span><span class="main">}</span> <span class="main">⊆</span> degree <span class="main">`</span> <span class="main">{</span>monom <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="bound">x</span> <span class="main">|</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">p</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{..</span><span class="free">p</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> degree <span class="main">(</span>monom <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="free">p</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> degree_monom_eq<span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> degree <span class="main">`</span> <span class="main">{</span>monom <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="bound">x</span> <span class="main">|</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">p</span><span class="main">}</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">`</span> <span class="main">{</span>monom <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="bound">x</span> <span class="main">|</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">p</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{..</span><span class="free">p</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> degree_monom_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> degree_monom_eq smult_monom<span class="main">)</span>

  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> poly"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span>monom <span class="main">1</span> <span class="bound">x</span> <span class="main">|</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">p</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≤</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> monom <span class="main">1</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">x</span> <span class="main">=</span> coeff <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span>monom <span class="main">1</span> <span class="bound">x</span> <span class="main">|</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">p</span><span class="main">}</span><span class="main">.</span> smult <span class="main">(</span><span class="skolem">f</span> <span class="bound">x</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> coeff_sum h'<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> h <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">force</span>

<span class="keyword1" id="RRI_Misc-dim_degree"><span class="command">lemma</span></span> dim_degree<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_vs.dim <span class="main">{</span><span class="bound">x</span><span class="main">.</span> degree <span class="bound">x</span> <span class="main">≤</span> <span class="free">n</span><span class="main">}</span> <span class="main">=</span> <span class="free">n</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> poly_vs.dim_eq_card_independent<span class="main">[</span><span class="operator">OF</span> monom_independent<span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> monom_span<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> card_image image_Collect<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span>
      inj_on_def monom_eq_iff'<span class="main">)</span>

<span class="keyword1" id="RRI_Misc-degree_div"><span class="command">lemma</span></span> degree_div<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="free">q</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>idom_divide<span class="main">)</span> poly"</span></span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="keyword1">dvd</span> <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span><span class="free">p</span> <span class="keyword1">div</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> degree <span class="free">p</span> <span class="main">-</span> degree <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> add_diff_cancel_left' degree_0 degree_mult_eq 
      diff_add_zero diff_zero div_by_0 dvd_div_eq_0_iff dvd_mult_div_cancel<span class="main">)</span>

<span class="keyword1" id="RRI_Misc-lead_coeff_div"><span class="command">lemma</span></span> lead_coeff_div<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="free">q</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>idom_divide<span class="main">,</span> inverse<span class="main">}</span><span class="main">)</span> poly"</span></span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="keyword1">dvd</span> <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lead_coeff <span class="main">(</span><span class="free">p</span> <span class="keyword1">div</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> lead_coeff <span class="free">p</span> <span class="main">/</span> lead_coeff <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> div_by_0 dvd_div_mult_self lead_coeff_mult leading_coeff_0_iff
      nonzero_mult_div_cancel_right<span class="main">)</span>

<span class="keyword1" id="RRI_Misc-complex_poly_eq"><span class="command">lemma</span></span> complex_poly_eq<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">=</span> map_poly of_real <span class="main">(</span>map_poly Re <span class="free">r</span><span class="main">)</span> <span class="main">+</span> smult <span class="keyword1">𝗂</span> <span class="main">(</span>map_poly of_real <span class="main">(</span>map_poly Im <span class="free">r</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> poly_eq_iff coeff_map_poly complex_eq<span class="main">)</span>

<span class="keyword1" id="RRI_Misc-complex_poly_cong"><span class="command">lemma</span></span> complex_poly_cong<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">(</span>map_poly Re <span class="free">p</span> <span class="main">=</span> map_poly Re <span class="free">q</span> <span class="main">∧</span> map_poly Im <span class="free">p</span> <span class="main">=</span> map_poly Im <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">p</span> <span class="main">=</span> <span class="free">q</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> complex_poly_eq<span class="main">)</span>

<span class="keyword1" id="RRI_Misc-map_poly_Im_of_real"><span class="command">lemma</span></span> map_poly_Im_of_real<span class="main">:</span> <span class="quoted"><span class="quoted">"map_poly Im <span class="main">(</span>map_poly of_real <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> poly_eq_iff coeff_map_poly<span class="main">)</span>

<span class="keyword1" id="RRI_Misc-mult_map_poly_imp_map_poly"><span class="command">lemma</span></span> mult_map_poly_imp_map_poly<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"map_poly complex_of_real <span class="free">q</span> <span class="main">=</span> <span class="free">r</span> <span class="main">*</span> map_poly complex_of_real <span class="free">p</span>"</span></span> 
          <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">=</span> map_poly complex_of_real <span class="main">(</span>map_poly Re <span class="free">r</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"Im <span class="main">∘</span> <span class="main">(*)</span> <span class="keyword1">𝗂</span> <span class="main">∘</span> complex_of_real <span class="main">=</span> id"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"map_poly complex_of_real <span class="free">q</span> <span class="main">=</span> <span class="free">r</span> <span class="main">*</span> map_poly complex_of_real <span class="free">p</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>map_poly of_real <span class="main">(</span>map_poly Re <span class="free">r</span><span class="main">)</span> <span class="main">+</span> 
                    smult <span class="keyword1">𝗂</span> <span class="main">(</span>map_poly of_real <span class="main">(</span>map_poly Im <span class="free">r</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span>
                   map_poly complex_of_real <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> complex_poly_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> map_poly of_real <span class="main">(</span>map_poly Re <span class="free">r</span> <span class="main">*</span> <span class="free">p</span><span class="main">)</span> <span class="main">+</span> 
                   smult <span class="keyword1">𝗂</span> <span class="main">(</span>map_poly of_real <span class="main">(</span>map_poly Im <span class="free">r</span> <span class="main">*</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_poly_add_left<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"map_poly complex_of_real <span class="free">q</span> <span class="main">=</span> 
                map_poly of_real <span class="main">(</span>map_poly Re <span class="free">r</span> <span class="main">*</span> <span class="free">p</span><span class="main">)</span> <span class="main">+</span> 
                smult <span class="keyword1">𝗂</span> <span class="main">(</span>map_poly of_real <span class="main">(</span>map_poly Im <span class="free">r</span> <span class="main">*</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">=</span> map_poly Im <span class="main">(</span>map_poly of_real <span class="main">(</span>map_poly Re <span class="free">r</span> <span class="main">*</span> <span class="free">p</span><span class="main">)</span> <span class="main">+</span> 
             smult <span class="keyword1">𝗂</span> <span class="main">(</span>map_poly of_real <span class="main">(</span>map_poly Im <span class="free">r</span> <span class="main">*</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> complex_poly_cong<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> map_poly_Im_of_real<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> map_poly of_real <span class="main">(</span>map_poly Im <span class="free">r</span> <span class="main">*</span> <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> poly_eqI<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> coeff_map_poly coeff_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">=</span> map_poly complex_of_real <span class="main">(</span>map_poly Im <span class="free">r</span><span class="main">)</span> <span class="main">*</span>
                    map_poly complex_of_real <span class="free">p</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"map_poly complex_of_real <span class="main">(</span>map_poly Im <span class="free">r</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> complex_poly_eq<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="RRI_Misc-map_poly_dvd"><span class="command">lemma</span></span> map_poly_dvd<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="free">q</span><span class="main">::</span><span class="quoted"><span class="quoted">"real poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> hdvd<span class="main">:</span> <span class="quoted"><span class="quoted">"map_poly complex_of_real <span class="free">p</span> <span class="keyword1">dvd</span> 
                    map_poly complex_of_real <span class="free">q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">dvd</span> <span class="free">q</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> hdvd <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> 
    <span class="keyword2"><span class="keyword">where</span></span> h<span class="main">:</span><span class="quoted"><span class="quoted">"map_poly complex_of_real <span class="free">q</span> <span class="main">=</span> <span class="skolem">r</span> <span class="main">*</span> map_poly complex_of_real <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">=</span> map_poly complex_of_real <span class="main">(</span>map_poly Re <span class="skolem">r</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> mult_map_poly_imp_map_poly assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"map_poly complex_of_real <span class="free">q</span> <span class="main">=</span> map_poly complex_of_real <span class="main">(</span><span class="free">p</span> <span class="main">*</span> map_poly Re <span class="skolem">r</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> h <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> <span class="free">p</span> <span class="main">*</span> map_poly Re <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> of_real_poly_eq_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">dvd</span> <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="RRI_Misc-div_poly_eq_0"><span class="command">lemma</span></span> div_poly_eq_0<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="free">q</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>idom_divide<span class="main">)</span> poly"</span></span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="keyword1">dvd</span> <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span><span class="free">p</span> <span class="keyword1">div</span> <span class="free">q</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="RRI_Misc-poly_map_poly_of_real_cnj"><span class="command">lemma</span></span> poly_map_poly_of_real_cnj<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"poly <span class="main">(</span>map_poly of_real <span class="free">p</span><span class="main">)</span> <span class="main">(</span>cnj <span class="free">z</span><span class="main">)</span> <span class="main">=</span> cnj <span class="main">(</span>poly <span class="main">(</span>map_poly of_real <span class="free">p</span><span class="main">)</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
An induction rule on real polynomials, if $P \neq 0$ then either $(X-x)|P$ or 
$(X-z)(X-cnj z)|P$, we induct by dividing by these polynomials.
›</span></span>
<span class="keyword1" id="RRI_Misc-real_poly_roots_induct"><span class="command">lemma</span></span> real_poly_roots_induct<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">P</span><span class="main">::</span><span class="quoted"><span class="quoted">"real poly <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">p</span><span class="main">::</span><span class="quoted"><span class="quoted">"real poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> IH_real<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">p</span> <span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="bound">p</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span><span class="bound">p</span> <span class="main">*</span> <span class="main">[:</span><span class="main">-</span><span class="bound">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> IH_complex<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">p</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">b</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">p</span> 
              <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span><span class="bound">p</span> <span class="main">*</span> <span class="main">[:</span> <span class="bound">a</span><span class="main">*</span><span class="bound">a</span> <span class="main">+</span> <span class="bound">b</span><span class="main">*</span><span class="bound">b</span><span class="main">,</span> <span class="main">-</span><span class="numeral">2</span><span class="main">*</span><span class="bound">a</span><span class="main">,</span> <span class="main">1</span> <span class="main">:]</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> H0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> <span class="free">P</span> <span class="main">[:</span><span class="bound">a</span><span class="main">:]</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">≡</span> degree <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> d_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">d</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> less_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span><span class="main">::</span><span class="quoted"><span class="quoted">"real poly"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> IH<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">q</span><span class="main">.</span> degree <span class="bound">q</span> <span class="main">&lt;</span> degree <span class="skolem">p</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">q</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">p</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">=</span> degree <span class="skolem">p</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span><span class="main">::</span><span class="quoted"><span class="quoted">"real poly"</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">=</span> degree <span class="skolem">p</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">a</span><span class="main">.</span> <span class="skolem">p</span> <span class="main">=</span> <span class="main">[:</span><span class="bound">a</span><span class="main">:]</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> degree_0_iff<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> H0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> hdeg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≠</span> degree <span class="skolem">p</span>"</span></span> 
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> constant <span class="main">(</span>poly <span class="main">(</span>map_poly of_real <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> constant_def constant_degree
          of_real_eq_iff of_real_poly_map_poly<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z</span></span><span class="main">::</span><span class="quoted">complex</span> <span class="keyword2"><span class="keyword">where</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span>map_poly of_real <span class="skolem">p</span><span class="main">)</span> <span class="skolem">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> fundamental_theorem_of_algebra <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">p</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Im <span class="skolem">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">=</span> Re <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> complex_is_Real_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="main">-</span><span class="skolem">z</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="keyword1">dvd</span> map_poly of_real <span class="skolem">p</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> h poly_eq_0_iff_dvd <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="main">-</span><span class="main">(</span>Re <span class="skolem">z</span><span class="main">)</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="keyword1">dvd</span> <span class="skolem">p</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> dvd_iff_poly_eq_0 h of_real_0 of_real_eq_iff of_real_poly_map_poly<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> 2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span><span class="skolem">p</span> <span class="keyword1">div</span> <span class="main">[:</span><span class="main">-</span>Re <span class="skolem">z</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> IH<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> hdeg <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> degree_div<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">p</span> <span class="keyword1">div</span> <span class="main">[:</span><span class="main">-</span> Re <span class="skolem">z</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span> <span class="main">*</span> <span class="main">[:</span><span class="main">-</span>Re <span class="skolem">z</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="main">[:</span><span class="main">-</span> Re <span class="skolem">z</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="keyword1">dvd</span> <span class="skolem">p</span>›</span></span> dvd_div_mult_self<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">p</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> 1<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> IH_real<span class="main"><span class="main">[</span></span><span class="operator">OF</span> 2<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Im <span class="skolem">z</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> hcnj<span class="main">:</span> <span class="quoted"><span class="quoted">"cnj <span class="skolem">z</span> <span class="main">≠</span> <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> cnj.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> neg_equal_zero<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span>map_poly of_real <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>cnj <span class="skolem">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> h poly_map_poly_of_real_cnj <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="main">-</span><span class="skolem">z</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="main">[:</span><span class="main">-</span>cnj <span class="skolem">z</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="keyword1">dvd</span> map_poly of_real <span class="skolem">p</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> divides_mult<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">c</span><span class="main">.</span> <span class="bound">c</span> <span class="keyword1">dvd</span> <span class="main">[:</span><span class="main">-</span><span class="skolem">z</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">⟹</span> <span class="bound">c</span> <span class="keyword1">dvd</span> <span class="main">[:</span><span class="main">-</span> cnj <span class="skolem">z</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">⟹</span> is_unit <span class="bound">c</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span>
          <span class="keyword3"><span class="command">assume</span></span> h<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="keyword1">dvd</span> <span class="main">[:</span><span class="main">-</span><span class="skolem">z</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span>"</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">c</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> divides_degree <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">c</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> degree <span class="skolem">c</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="keyword1">dvd</span> <span class="main">[:</span><span class="main">-</span> cnj <span class="skolem">z</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">⟹</span> is_unit <span class="skolem">c</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">c</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> h <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_unit <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_unit_iff_degree<span class="main">)</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">assume</span></span> hdeg<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="skolem">c</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="main">-</span><span class="skolem">z</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">=</span> <span class="skolem">x</span><span class="main">*</span><span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> h <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">[:</span><span class="main">-</span><span class="skolem">z</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">=</span> degree <span class="skolem">x</span> <span class="main">+</span> degree <span class="skolem">c</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.inverse_neutral degree_mult_eq mult_cancel_right
                  mult_poly_0_left pCons_eq_0_iff zero_neq_neg_one<span class="main">)</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hdeg <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x'</span></span> <span class="keyword2"><span class="keyword">where</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">[:</span><span class="skolem">x'</span><span class="main">:]</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> degree_0_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="keyword1">dvd</span> <span class="main">[:</span><span class="main">-</span>cnj <span class="skolem">z</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span>"</span></span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="main">-</span>cnj <span class="skolem">z</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">=</span> <span class="skolem">y</span><span class="main">*</span><span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">[:</span><span class="main">-</span>cnj <span class="skolem">z</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">=</span> degree <span class="skolem">y</span> <span class="main">+</span> degree <span class="skolem">c</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.inverse_neutral degree_mult_eq mult_cancel_right
                  mult_poly_0_left pCons_eq_0_iff zero_neq_neg_one<span class="main">)</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hdeg <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y'</span></span> <span class="keyword2"><span class="keyword">where</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="main">[:</span><span class="skolem">y'</span><span class="main">:]</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> degree_0_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> hdeg <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> 5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> <span class="main">[:</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">:]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> degree_eq_oneE<span class="main">)</span>
            <span class="keyword1"><span class="command">from</span></span> 1 2 5 6 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x'</span> <span class="main">=</span> inverse <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> 3 4 5 6 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y'</span> <span class="main">=</span> inverse <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 2 4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">=</span> cnj <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 1 3 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> neg_equal_iff_equal pCons_eq_iff<span class="main">)</span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"is_unit <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hcnj <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"coprime <span class="main">[:</span><span class="main">-</span> <span class="skolem">z</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">[:</span><span class="main">-</span> cnj <span class="skolem">z</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> not_coprimeE<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="main">-</span> <span class="skolem">z</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="keyword1">dvd</span> map_poly complex_of_real <span class="skolem">p</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> h poly_eq_0_iff_dvd <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="main">-</span> cnj <span class="skolem">z</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="keyword1">dvd</span> map_poly complex_of_real <span class="skolem">p</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> h2 poly_eq_0_iff_dvd <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="main">-</span> <span class="skolem">z</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="main">[:</span><span class="main">-</span> cnj <span class="skolem">z</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">=</span> 
                     map_poly of_real <span class="main">[:</span>Re <span class="skolem">z</span><span class="main">*</span>Re <span class="skolem">z</span> <span class="main">+</span> Im <span class="skolem">z</span><span class="main">*</span>Im <span class="skolem">z</span><span class="main">,</span> <span class="main">-</span><span class="numeral">2</span><span class="main">*</span>Re <span class="skolem">z</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> complex_eqI<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> hdvd<span class="main">:</span> 
        <span class="quoted"><span class="quoted">"map_poly complex_of_real <span class="main">[:</span>Re <span class="skolem">z</span><span class="main">*</span>Re <span class="skolem">z</span> <span class="main">+</span> Im <span class="skolem">z</span><span class="main">*</span>Im <span class="skolem">z</span><span class="main">,</span> <span class="main">-</span><span class="numeral">2</span><span class="main">*</span>Re <span class="skolem">z</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="keyword1">dvd</span>
         map_poly complex_of_real <span class="skolem">p</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span>Re <span class="skolem">z</span><span class="main">*</span>Re <span class="skolem">z</span> <span class="main">+</span> Im <span class="skolem">z</span><span class="main">*</span>Im <span class="skolem">z</span><span class="main">,</span> <span class="main">-</span><span class="numeral">2</span><span class="main">*</span>Re <span class="skolem">z</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="keyword1">dvd</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> map_poly_dvd 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> 2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span><span class="skolem">p</span> <span class="keyword1">div</span> <span class="main">[:</span>Re <span class="skolem">z</span><span class="main">*</span>Re <span class="skolem">z</span> <span class="main">+</span> Im <span class="skolem">z</span><span class="main">*</span>Im <span class="skolem">z</span><span class="main">,</span> <span class="main">-</span><span class="numeral">2</span><span class="main">*</span>Re <span class="skolem">z</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> IH<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> hdeg <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> degree_div<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span>
        <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">p</span> <span class="keyword1">div</span> <span class="main">[:</span>Re <span class="skolem">z</span><span class="main">*</span>Re <span class="skolem">z</span> <span class="main">+</span> Im <span class="skolem">z</span><span class="main">*</span>Im <span class="skolem">z</span><span class="main">,</span> <span class="main">-</span><span class="numeral">2</span><span class="main">*</span>Re <span class="skolem">z</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span> <span class="main">*</span> 
                    <span class="main">[:</span>Re <span class="skolem">z</span><span class="main">*</span>Re <span class="skolem">z</span> <span class="main">+</span> Im <span class="skolem">z</span><span class="main">*</span>Im <span class="skolem">z</span><span class="main">,</span> <span class="main">-</span><span class="numeral">2</span><span class="main">*</span>Re <span class="skolem">z</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> dvd_div_mult_self<span class="main">)</span> 
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">[:</span>Re <span class="skolem">z</span><span class="main">*</span>Re <span class="skolem">z</span> <span class="main">+</span> Im <span class="skolem">z</span><span class="main">*</span>Im <span class="skolem">z</span><span class="main">,</span> <span class="main">-</span><span class="numeral">2</span><span class="main">*</span>Re <span class="skolem">z</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="keyword1">dvd</span> <span class="skolem">p</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">p</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> 1<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> IH_complex<span class="main"><span class="main">[</span></span><span class="operator">of</span>  <span class="quoted"><span class="quoted"><span class="quoted">"Im <span class="skolem"><span class="skolem">z</span></span>"</span></span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"Re <span class="skolem"><span class="skolem">z</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">‹Im <span class="skolem">z</span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The reciprocal polynomial›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">reciprocal_poly</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">::</span>zero poly <span class="main">⇒</span> <span class="tfree">'a</span> poly"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">reciprocal_poly</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">=</span> 
          Poly <span class="main">(</span>rev <span class="main">(</span><span class="main">(</span>coeffs <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">@</span> <span class="main">(</span>replicate <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">-</span> degree <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="RRI_Misc-reciprocal_0"><span class="command">lemma</span></span> reciprocal_0<span class="main">:</span> <span class="quoted"><span class="quoted">"reciprocal_poly <span class="free">p</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reciprocal_poly_def<span class="main">)</span>

<span class="keyword1" id="RRI_Misc-reciprocal_1"><span class="command">lemma</span></span> reciprocal_1<span class="main">:</span> <span class="quoted"><span class="quoted">"reciprocal_poly <span class="free">p</span> <span class="main">1</span> <span class="main">=</span> monom <span class="main">1</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reciprocal_poly_def monom_altdef Poly_append<span class="main">)</span>

<span class="keyword1" id="RRI_Misc-coeff_reciprocal"><span class="command">lemma</span></span> coeff_reciprocal<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> hi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≤</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> hP<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">P</span> <span class="main">≤</span> <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span>reciprocal_poly <span class="free">p</span> <span class="free">P</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> coeff <span class="free">P</span> <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="free">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">p</span> <span class="main">-</span> degree <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">P</span> <span class="main">&lt;</span> <span class="free">p</span> <span class="main">-</span> <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hP <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span>reciprocal_poly <span class="free">p</span> <span class="free">P</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> coeff <span class="free">P</span> <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="free">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> reciprocal_poly_def nth_default_append coeff_eq_0<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="free">i</span> <span class="main">&lt;</span> <span class="free">p</span> <span class="main">-</span> degree <span class="free">P</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span>reciprocal_poly <span class="free">p</span> <span class="free">P</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> coeff <span class="free">P</span> <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="free">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span>reciprocal_poly <span class="free">p</span> <span class="free">P</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> coeff <span class="free">P</span> <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="free">i</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reciprocal_0<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> hP'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">P</span> <span class="main">≥</span> <span class="free">p</span> <span class="main">-</span> <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> h hP <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">(</span><span class="free">p</span> <span class="main">-</span> degree <span class="free">P</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> length <span class="main">(</span>rev <span class="main">(</span>coeffs <span class="free">P</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> hP' hP hi <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> length_coeffs<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span>reciprocal_poly <span class="free">p</span> <span class="free">P</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> coeff <span class="free">P</span> <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="free">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> reciprocal_poly_def nth_default_append coeff_eq_0 hP hP' 
          nth_default_nth rev_nth calculation coeffs_nth length_coeffs_degree<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="RRI_Misc-coeff_reciprocal_less"><span class="command">lemma</span></span> coeff_reciprocal_less<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> hn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">&lt;</span> <span class="free">i</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> hP<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">P</span> <span class="main">≤</span> <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span>reciprocal_poly <span class="free">p</span> <span class="free">P</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> reciprocal_0<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> hn 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> reciprocal_poly_def nth_default_append 
        nth_default_eq_dflt_iff hP length_coeffs<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="RRI_Misc-reciprocal_monom"><span class="command">lemma</span></span> reciprocal_monom<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≤</span> <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"reciprocal_poly <span class="free">p</span> <span class="main">(</span>monom <span class="free">a</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> monom <span class="free">a</span> <span class="main">(</span><span class="free">p</span><span class="main">-</span><span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reciprocal_0<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">n</span><span class="main">≤</span><span class="free">p</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> poly_eqI<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> coeff_monom coeff_reciprocal coeff_reciprocal_less 
        diff_diff_cancel diff_le_self lead_coeff_monom not_le_imp_less<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="RRI_Misc-reciprocal_degree"><span class="command">lemma</span></span> reciprocal_degree<span class="main">:</span> <span class="quoted"><span class="quoted">"reciprocal_poly <span class="main">(</span>degree <span class="free">P</span><span class="main">)</span> <span class="free">P</span> <span class="main">=</span> reflect_poly <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reciprocal_poly_def reflect_poly_def<span class="main">)</span>

<span class="keyword1" id="RRI_Misc-degree_reciprocal"><span class="command">lemma</span></span> degree_reciprocal<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">P</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>zero<span class="main">)</span> poly"</span></span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> hP<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">P</span> <span class="main">≤</span> <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>reciprocal_poly <span class="free">p</span> <span class="free">P</span><span class="main">)</span> <span class="main">≤</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reciprocal_poly_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>reciprocal_poly <span class="free">p</span> <span class="free">P</span><span class="main">)</span> <span class="main">≤</span> 
        length <span class="main">(</span>replicate <span class="main">(</span><span class="free">p</span> <span class="main">-</span> degree <span class="free">P</span><span class="main">)</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">@</span> rev <span class="main">(</span>coeffs <span class="free">P</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> degree_Poly reciprocal_poly_def rev_append rev_replicate<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>Poly <span class="main">(</span>replicate <span class="main">(</span><span class="free">p</span> <span class="main">-</span> degree <span class="free">P</span><span class="main">)</span> <span class="main">0</span> <span class="main">@</span> rev <span class="main">(</span>coeffs <span class="free">P</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">p</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> Suc_le_mono add_Suc_right coeffs_Poly degree_0 hP le_SucE le_SucI 
        le_add_diff_inverse2 le_zero_eq length_append length_coeffs_degree
        length_replicate length_rev length_strip_while_le reciprocal_0
        reciprocal_poly_def rev_append rev_replicate<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="RRI_Misc-reciprocal_0_iff"><span class="command">lemma</span></span> reciprocal_0_iff<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> hP<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">P</span> <span class="main">≤</span> <span class="free">p</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>reciprocal_poly <span class="free">p</span> <span class="free">P</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"reciprocal_poly <span class="free">p</span> <span class="free">P</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> poly_eqI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"coeff <span class="free">P</span> <span class="skolem">n</span> <span class="main">=</span> coeff <span class="main">0</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
      <span class="keyword3"><span class="command">assume</span></span> hn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≤</span> <span class="free">p</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">-</span> <span class="skolem">n</span> <span class="main">≤</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span>reciprocal_poly <span class="free">p</span> <span class="free">P</span><span class="main">)</span> <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> coeff <span class="free">P</span> <span class="skolem">n</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> hP hn <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> coeff_reciprocal<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> h <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> hn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">n</span> <span class="main">≤</span> <span class="free">p</span>"</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> hP <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> coeff_0 dual_order.trans le_degree<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"reciprocal_poly <span class="free">p</span> <span class="free">P</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> reciprocal_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="RRI_Misc-poly_reciprocal"><span class="command">lemma</span></span> poly_reciprocal<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">P</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>field poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> hp<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">P</span> <span class="main">≤</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> hx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span>reciprocal_poly <span class="free">p</span> <span class="free">P</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span><span class="main">^</span><span class="free">p</span> <span class="main">*</span> <span class="main">(</span>poly <span class="free">P</span> <span class="main">(</span>inverse <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span>reciprocal_poly <span class="free">p</span> <span class="free">P</span><span class="main">)</span> <span class="free">x</span>
      <span class="main">=</span> poly <span class="main">(</span><span class="main">(</span>Poly <span class="main">(</span><span class="main">(</span>replicate <span class="main">(</span><span class="free">p</span> <span class="main">-</span> degree <span class="free">P</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="main">@</span> rev <span class="main">(</span>coeffs <span class="free">P</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hx reflect_poly_def reciprocal_poly_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> poly <span class="main">(</span><span class="main">(</span>monom <span class="main">1</span> <span class="main">(</span><span class="free">p</span> <span class="main">-</span> degree <span class="free">P</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>reflect_poly <span class="free">P</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reflect_poly_def Poly_append<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span><span class="main">^</span><span class="main">(</span><span class="free">p</span> <span class="main">-</span> degree <span class="free">P</span><span class="main">)</span> <span class="main">*</span>  <span class="free">x</span> <span class="main">^</span> degree <span class="free">P</span> <span class="main">*</span> poly <span class="free">P</span> <span class="main">(</span>inverse <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_reflect_poly_nz poly_monom hx<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span><span class="main">^</span><span class="free">p</span> <span class="main">*</span> poly <span class="free">P</span> <span class="main">(</span>inverse <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hp power_add<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="RRI_Misc-reciprocal_fcompose"><span class="command">lemma</span></span> reciprocal_fcompose<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">P</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>ring_char_0<span class="main">,</span>field<span class="main">}</span><span class="main">)</span> poly"</span></span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> hP<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">P</span> <span class="main">≤</span> <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"reciprocal_poly <span class="free">p</span> <span class="free">P</span> <span class="main">=</span> monom <span class="main">1</span> <span class="main">(</span><span class="free">p</span> <span class="main">-</span> degree <span class="free">P</span><span class="main">)</span> <span class="main">*</span> fcompose <span class="free">P</span> <span class="main">1</span> <span class="main">[:</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> poly_eq_by_eval<span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
  <span class="keyword3"><span class="command">assume</span></span> hx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span>reciprocal_poly <span class="free">p</span> <span class="free">P</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> coeff <span class="free">P</span> <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> hP <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> poly_0_coeff_0 coeff_reciprocal<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span>monom <span class="main">1</span> <span class="main">(</span><span class="free">p</span> <span class="main">-</span> degree <span class="free">P</span><span class="main">)</span> 
    <span class="main">*</span> fcompose <span class="free">P</span> <span class="main">1</span> <span class="main">[:</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> coeff <span class="free">P</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">P</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">P</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> hx <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> poly_monom degree_0_iff fcompose_pCons<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">P</span> <span class="main">≠</span> <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">P</span> <span class="main">&lt;</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hP <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> hx <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> poly_monom coeff_eq_0<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span>reciprocal_poly <span class="free">p</span> <span class="free">P</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> poly <span class="main">(</span>monom <span class="main">1</span> <span class="main">(</span><span class="free">p</span> <span class="main">-</span> degree <span class="free">P</span><span class="main">)</span> <span class="main">*</span> fcompose <span class="free">P</span> <span class="main">1</span> <span class="main">[:</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span>reciprocal_poly <span class="free">p</span> <span class="free">P</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> 
        poly <span class="main">(</span>monom <span class="main">1</span> <span class="main">(</span><span class="free">p</span> <span class="main">-</span> degree <span class="free">P</span><span class="main">)</span> <span class="main">*</span> fcompose <span class="free">P</span> <span class="main">1</span> <span class="main">[:</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> hP 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> poly_reciprocal poly_fcompose inverse_eq_divide
        poly_monom power_diff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="RRI_Misc-reciprocal_reciprocal"><span class="command">lemma</span></span> reciprocal_reciprocal<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">P</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field<span class="main">,</span>ring_char_0<span class="main">}</span> poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> hP<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">P</span> <span class="main">≤</span> <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"reciprocal_poly <span class="free">p</span> <span class="main">(</span>reciprocal_poly <span class="free">p</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> poly_eq_by_eval<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span>reciprocal_poly <span class="free">p</span> <span class="main">(</span>reciprocal_poly <span class="free">p</span> <span class="free">P</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> poly <span class="free">P</span> <span class="skolem">x</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span>reciprocal_poly <span class="free">p</span> <span class="main">(</span>reciprocal_poly <span class="free">p</span> <span class="free">P</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> poly <span class="free">P</span> <span class="skolem">x</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> hP
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> poly_0_coeff_0 coeff_reciprocal degree_reciprocal<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> hx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span>reciprocal_poly <span class="free">p</span> <span class="main">(</span>reciprocal_poly <span class="free">p</span> <span class="free">P</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span> 
        <span class="main">=</span> <span class="skolem">x</span> <span class="main">^</span> <span class="free">p</span> <span class="main">*</span> <span class="main">(</span>inverse <span class="skolem">x</span> <span class="main">^</span> <span class="free">p</span> <span class="main">*</span> poly <span class="free">P</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hP
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> poly_reciprocal degree_reciprocal<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span>reciprocal_poly <span class="free">p</span> <span class="main">(</span>reciprocal_poly <span class="free">p</span> <span class="free">P</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> poly <span class="free">P</span> <span class="skolem">x</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> hP hx left_right_inverse_power right_inverse <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="RRI_Misc-reciprocal_smult"><span class="command">lemma</span></span> reciprocal_smult<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">P</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>idom poly"</span></span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">P</span> <span class="main">≤</span> <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"reciprocal_poly <span class="free">p</span> <span class="main">(</span>smult <span class="free">n</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> smult <span class="free">n</span> <span class="main">(</span>reciprocal_poly <span class="free">p</span> <span class="free">P</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reciprocal_poly_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reciprocal_poly_def smult_Poly coeffs_smult 
        rev_map<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="RRI_Misc-reciprocal_add"><span class="command">lemma</span></span> reciprocal_add<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">P</span> <span class="free">Q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>comm_semiring_0 poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">P</span> <span class="main">≤</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">Q</span> <span class="main">≤</span> <span class="free">p</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"reciprocal_poly <span class="free">p</span> <span class="main">(</span><span class="free">P</span> <span class="main">+</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> reciprocal_poly <span class="free">p</span> <span class="free">P</span> <span class="main">+</span> reciprocal_poly <span class="free">p</span> <span class="free">Q</span>"</span></span> 
<span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">=</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> poly_eqI<span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≤</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"coeff <span class="var">?L</span> <span class="skolem">n</span> <span class="main">=</span> coeff <span class="var">?R</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> degree_add_le coeff_reciprocal<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="skolem">n</span> <span class="main">≤</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"coeff <span class="var">?L</span> <span class="skolem">n</span> <span class="main">=</span> coeff <span class="var">?R</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> degree_add_le coeff_reciprocal_less<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> 

<span class="keyword1" id="RRI_Misc-reciprocal_diff"><span class="command">lemma</span></span> reciprocal_diff<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">P</span> <span class="free">Q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>comm_ring poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">P</span> <span class="main">≤</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">Q</span> <span class="main">≤</span> <span class="free">p</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"reciprocal_poly <span class="free">p</span> <span class="main">(</span><span class="free">P</span> <span class="main">-</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> reciprocal_poly <span class="free">p</span> <span class="free">P</span> <span class="main">-</span> reciprocal_poly <span class="free">p</span> <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> ab_group_add_class.ab_diff_conv_add_uminus assms
      add_diff_cancel degree_add_le degree_minus diff_add_cancel reciprocal_add<span class="main">)</span>

<span class="keyword1" id="RRI_Misc-reciprocal_sum"><span class="command">lemma</span></span> reciprocal_sum<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">P</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>comm_semiring_0 poly"</span></span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> hP<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">k</span><span class="main">.</span> degree <span class="main">(</span><span class="free">P</span> <span class="bound">k</span><span class="main">)</span> <span class="main">≤</span> <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"reciprocal_poly <span class="free">p</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> reciprocal_poly <span class="free">p</span> <span class="main">(</span><span class="free">P</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">A</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>infinite <span class="skolem">A</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reciprocal_0<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> empty
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reciprocal_0<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">F</span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> <span class="skolem">F</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"reciprocal_poly <span class="free">p</span> <span class="main">(</span>sum <span class="free">P</span> <span class="skolem">F</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="skolem">F</span><span class="main">.</span> reciprocal_poly <span class="free">p</span> <span class="main">(</span><span class="free">P</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">F</span>"</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span> <span class="quoted"><span class="quoted">"reciprocal_poly <span class="free">p</span> <span class="main">(</span>sum <span class="free">P</span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">F</span><span class="main">)</span><span class="main">)</span> 
      <span class="main">=</span> reciprocal_poly <span class="free">p</span> <span class="main">(</span><span class="free">P</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">+</span> reciprocal_poly <span class="free">p</span> <span class="main">(</span>sum <span class="free">P</span> <span class="skolem">F</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reciprocal_add hP degree_sum_le<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"reciprocal_poly <span class="free">p</span> <span class="main">(</span>sum <span class="free">P</span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">F</span><span class="main">)</span><span class="main">)</span> 
      <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span>insert <span class="skolem">x</span> <span class="skolem">F</span><span class="main">.</span> reciprocal_poly <span class="free">p</span> <span class="main">(</span><span class="free">P</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Groups_Big.comm_monoid_add_class.sum.insert_if<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="RRI_Misc-reciprocal_mult"><span class="command">lemma</span></span> reciprocal_mult<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">P</span> <span class="free">Q</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>ring_char_0<span class="main">,</span>field<span class="main">}</span> poly"</span></span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span><span class="free">P</span> <span class="main">*</span> <span class="free">Q</span><span class="main">)</span> <span class="main">≤</span> <span class="free">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">P</span> <span class="main">≤</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">Q</span> <span class="main">≤</span> <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"monom <span class="main">1</span> <span class="free">p</span> <span class="main">*</span> reciprocal_poly <span class="free">p</span> <span class="main">(</span><span class="free">P</span> <span class="main">*</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> 
         reciprocal_poly <span class="free">p</span> <span class="free">P</span> <span class="main">*</span> reciprocal_poly <span class="free">p</span> <span class="free">Q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">P</span><span class="main">=</span><span class="main">0</span> <span class="main">∨</span> <span class="free">Q</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> reciprocal_fcompose fcompose_mult<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> degree_mult_eq mult_monom reciprocal_fcompose fcompose_mult<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="RRI_Misc-reciprocal_reflect_poly"><span class="command">lemma</span></span> reciprocal_reflect_poly<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">P</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>ring_char_0<span class="main">,</span>field<span class="main">}</span> poly"</span></span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> hP<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">P</span> <span class="main">≤</span> <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"reciprocal_poly <span class="free">p</span> <span class="free">P</span> <span class="main">=</span> monom <span class="main">1</span> <span class="main">(</span><span class="free">p</span> <span class="main">-</span> degree <span class="free">P</span><span class="main">)</span> <span class="main">*</span> reflect_poly <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> poly_eqI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span>reciprocal_poly <span class="free">p</span> <span class="free">P</span><span class="main">)</span> <span class="skolem">n</span> <span class="main">=</span> 
    coeff <span class="main">(</span>monom <span class="main">1</span> <span class="main">(</span><span class="free">p</span> <span class="main">-</span> degree <span class="free">P</span><span class="main">)</span> <span class="main">*</span> reflect_poly <span class="free">P</span><span class="main">)</span> <span class="skolem">n</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≤</span> <span class="free">p</span>"</span></span> 
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> hP
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> coeff_reciprocal coeff_monom_mult coeff_reflect_poly coeff_eq_0<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">n</span> <span class="main">≤</span> <span class="free">p</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> hP
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> coeff_reciprocal_less coeff_monom_mult coeff_reflect_poly<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="RRI_Misc-map_poly_reciprocal"><span class="command">lemma</span></span> map_poly_reciprocal<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">P</span> <span class="main">≤</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"map_poly <span class="free">f</span> <span class="main">(</span>reciprocal_poly <span class="free">p</span> <span class="free">P</span><span class="main">)</span>  <span class="main">=</span> reciprocal_poly <span class="free">p</span> <span class="main">(</span>map_poly <span class="free">f</span> <span class="free">P</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> poly_eqI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span>map_poly <span class="free">f</span> <span class="main">(</span>reciprocal_poly <span class="free">p</span> <span class="free">P</span><span class="main">)</span><span class="main">)</span> <span class="skolem">n</span> <span class="main">=</span>
         coeff <span class="main">(</span>reciprocal_poly <span class="free">p</span> <span class="main">(</span>map_poly <span class="free">f</span> <span class="free">P</span><span class="main">)</span><span class="main">)</span> <span class="skolem">n</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">≤</span><span class="free">p</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> coeff_reciprocal<span class="main"><span class="main">[</span></span><span class="operator">OF</span> True<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> degree_map_poly_le le_trans<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> coeff_map_poly coeff_reciprocal<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> coeff_map_poly coeff_reciprocal_less 
          degree_map_poly_le dual_order.trans leI<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹More about <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">proots_count</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1" id="RRI_Misc-proots_count_monom"><span class="command">lemma</span></span> proots_count_monom<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> <span class="free">A</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="main">(</span>monom <span class="main">1</span> <span class="free">d</span><span class="main">)</span> <span class="free">A</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> proots_count_def poly_monom<span class="main">)</span>

<span class="keyword1" id="RRI_Misc-proots_count_reciprocal"><span class="command">lemma</span></span> proots_count_reciprocal<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">P</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>ring_char_0<span class="main">,</span>field<span class="main">}</span> poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> hP<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">P</span> <span class="main">≤</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h0'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="main">(</span>reciprocal_poly <span class="free">p</span> <span class="free">P</span><span class="main">)</span> <span class="free">A</span> <span class="main">=</span> proots_count <span class="free">P</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> inverse <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="main">(</span>reciprocal_poly <span class="free">p</span> <span class="free">P</span><span class="main">)</span> <span class="free">A</span> <span class="main">=</span> 
        proots_count <span class="main">(</span>fcompose <span class="free">P</span> <span class="main">1</span> <span class="main">[:</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> reciprocal_fcompose<span class="main"><span class="main">[</span></span><span class="operator">OF</span> hP<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> proots_count_times<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> h0 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> hP reciprocal_0_iff reciprocal_fcompose<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> h0' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> proots_count_monom<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> proots_count <span class="free">P</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> inverse <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> proots_fcompose_bij_eq<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="main">1</span> <span class="bound">x</span> <span class="main">/</span> poly <span class="main">[:</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="bound">x</span><span class="main">)</span> <span class="free">A</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> inverse <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betw_imageI<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="main">1</span> <span class="bound">x</span> <span class="main">/</span> poly <span class="main">[:</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="bound">x</span><span class="main">)</span> <span class="free">A</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inj_on_def<span class="main">)</span>

      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="main">1</span> <span class="bound">x</span> <span class="main">/</span> poly <span class="main">[:</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="bound">x</span><span class="main">)</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> inverse <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="main">1</span> <span class="bound">x</span> <span class="main">/</span> poly <span class="main">[:</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="bound">x</span><span class="main">)</span> <span class="main">`</span> <span class="free">A</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> inverse <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> inverse <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="main">1</span> <span class="bound">x</span> <span class="main">/</span> poly <span class="main">[:</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="bound">x</span><span class="main">)</span> <span class="main">`</span> <span class="free">A</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">x</span><span class="main">::</span><span class="tfree">'a</span><span class="main">.</span> inverse <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> poly <span class="main">1</span> <span class="main">(</span>inverse <span class="skolem">x</span><span class="main">)</span> <span class="main">/</span> poly <span class="main">[:</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">(</span>inverse <span class="skolem">x</span><span class="main">)</span> <span class="main">∧</span> inverse <span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inverse_eq_divide<span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="main">1</span> <span class="bound">x</span> <span class="main">/</span> poly <span class="main">[:</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="bound">x</span><span class="main">)</span> <span class="main">`</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">c</span><span class="main">.</span> <span class="main">1</span> <span class="main">≠</span> smult <span class="bound">c</span> <span class="main">[:</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> coeff_pCons_0 degree_1 lead_coeff_1 pCons_0_0 pcompose_0'
          pcompose_smult smult_0_right zero_neq_one<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> assms infinite_UNIV_char_0<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="RRI_Misc-proots_count_reciprocal'"><span class="command">lemma</span></span> proots_count_reciprocal'<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">P</span><span class="main">::</span><span class="quoted"><span class="quoted">"real poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> hP<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">P</span> <span class="main">≤</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="free">P</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="main">1</span><span class="main">}</span> <span class="main">=</span> 
         proots_count <span class="main">(</span>reciprocal_poly <span class="free">p</span> <span class="free">P</span><span class="main">)</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">&lt;</span> <span class="bound">x</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> proots_count_reciprocal<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="free">P</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="main">1</span><span class="main">}</span> <span class="main">=</span>
      proots_count <span class="free">P</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> inverse <span class="bound">x</span> <span class="main">∈</span> Collect <span class="main">(</span><span class="main">(&lt;)</span> <span class="main">1</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> arg_cong<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"proots_count <span class="free"><span class="free">P</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> one_less_inverse_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="RRI_Misc-proots_count_pos"><span class="command">lemma</span></span> proots_count_pos<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="free">P</span> <span class="free">S</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">S</span><span class="main">.</span> poly <span class="free">P</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> poly <span class="free">P</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">⟹</span> poly <span class="free">P</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">⟹</span> order <span class="bound">x</span> <span class="free">P</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> order_0I <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="free">P</span> <span class="free">S</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> proots_count_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="RRI_Misc-proots_count_of_root_set"><span class="command">lemma</span></span> proots_count_of_root_set<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">⊆</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span><span class="free">R</span> <span class="main">⟹</span> poly <span class="free">P</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="free">P</span> <span class="free">S</span> <span class="main">≥</span> card <span class="free">R</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="free">R</span> <span class="main">≤</span> card <span class="main">(</span>proots_within <span class="free">P</span> <span class="free">S</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> card_mono<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> proots_within_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> proots_count <span class="free">P</span> <span class="free">S</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> card_proots_within_leq<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="RRI_Misc-proots_count_of_root"><span class="command">lemma</span></span> proots_count_of_root<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">∈</span><span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">P</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="free">P</span> <span class="free">S</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> proots_count_of_root_set<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">P</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">x</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="free">S</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹More about <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">changes</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1" id="RRI_Misc-changes_nonneg"><span class="command">lemma</span></span> changes_nonneg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> changes <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> changes.induct<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>

<span class="keyword1" id="RRI_Misc-changes_replicate_0"><span class="command">lemma</span></span> changes_replicate_0<span class="main">:</span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"changes <span class="main">(</span>replicate <span class="free">n</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="RRI_Misc-changes_append_replicate_0"><span class="command">lemma</span></span> changes_append_replicate_0<span class="main">:</span> <span class="quoted"><span class="quoted">"changes <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> replicate <span class="free">n</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> changes <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> changes.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">uu</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> changes_replicate_0<span class="main">)</span>

<span class="keyword1" id="RRI_Misc-changes_scale_Cons"><span class="command">lemma</span></span> changes_scale_Cons<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">xs</span><span class="main">::</span> <span class="quoted"><span class="quoted">"real list"</span></span> <span class="keyword2"><span class="keyword">assumes</span></span> hs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"changes <span class="main">(</span><span class="free">s</span> <span class="main">*</span> <span class="free">x</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> changes <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> changes.induct<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mult_less_0_iff zero_less_mult_iff<span class="main">)</span>

<span class="keyword1" id="RRI_Misc-changes_scale"><span class="command">lemma</span></span> changes_scale<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">xs</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>linordered_idom<span class="main">)</span> list"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> hs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">⟹</span> <span class="free">s</span> <span class="bound">i</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> hn<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">≤</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"changes <span class="main">[</span><span class="free">s</span> <span class="bound">i</span> <span class="main">*</span> <span class="main">(</span>nth_default <span class="main">0</span> <span class="free">xs</span> <span class="bound">i</span><span class="main">)</span><span class="main">.</span> i <span class="main">←</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">]</span><span class="main">]</span> <span class="main">=</span> changes <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">s</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> changes.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 1
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> map_replicate_const changes_replicate_0<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">uu</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"map <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">s</span> <span class="bound">i</span> <span class="main">*</span> nth_default <span class="main">0</span> <span class="main">[</span><span class="skolem">uu</span><span class="main">]</span> <span class="bound">i</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">n</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">s</span> <span class="main">0</span> <span class="main">*</span> <span class="skolem">uu</span><span class="main">]</span> <span class="main">@</span> replicate <span class="skolem">m</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">m</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">n</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">m</span> <span class="skolem">n</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> Suc <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"map <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">s</span> <span class="bound">i</span> <span class="main">*</span> nth_default <span class="main">0</span> <span class="main">[</span><span class="skolem">uu</span><span class="main">]</span> <span class="bound">i</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">m</span><span class="main">]</span> <span class="main">=</span> 
                     <span class="main">[</span><span class="skolem">s</span> <span class="main">0</span> <span class="main">*</span> <span class="skolem">uu</span><span class="main">]</span> <span class="main">@</span> replicate <span class="skolem">m</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"map <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">s</span> <span class="bound">i</span> <span class="main">*</span> nth_default <span class="main">0</span> <span class="main">[</span><span class="skolem">uu</span><span class="main">]</span> <span class="bound">i</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">n</span><span class="main">]</span> <span class="main">=</span>
             <span class="main">[</span><span class="skolem">s</span> <span class="main">0</span> <span class="main">*</span> <span class="skolem">uu</span><span class="main">]</span> <span class="main">@</span> replicate <span class="skolem">m</span> <span class="main">0</span> <span class="main">@</span> <span class="main">[</span><span class="main">0</span><span class="main">]</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">s</span> <span class="main">0</span> <span class="main">*</span> <span class="skolem">uu</span><span class="main">]</span> <span class="main">@</span> replicate <span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> replicate_append_same<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> changes.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> changes_append_replicate_0<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">xs</span> <span class="skolem">s</span> <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> hn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="skolem">m</span> <span class="main">+</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 3<span class="main">(</span>5<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_2_eq_Suc' diff_diff_cancel diff_le_self length_Suc_conv 
        nat_arith.suc1 ordered_cancel_comm_monoid_diff_class.add_diff_inverse<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> h<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"map <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">s</span> <span class="bound">i</span> <span class="main">*</span> nth_default <span class="main">0</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">b</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="bound">i</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">n</span><span class="main">]</span> <span class="main">=</span> 
      <span class="skolem">s</span> <span class="main">0</span> <span class="main">*</span> <span class="skolem">a</span> <span class="main">#</span> <span class="skolem">s</span> <span class="main">1</span> <span class="main">*</span> <span class="skolem">b</span> <span class="main">#</span> map <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> 
      <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> <span class="skolem">s</span> <span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="bound">i</span> <span class="main">*</span> nth_default <span class="main">0</span> <span class="main">(</span><span class="skolem">xs</span><span class="main">)</span> <span class="bound">i</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">m</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">m</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">n</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">consider</span></span> <span class="main">(</span>neg<span class="main">)</span><span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">*</span><span class="skolem">b</span><span class="main">&lt;</span><span class="main">0</span>"</span></span> <span class="main">|</span> <span class="main">(</span>nil<span class="main">)</span><span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="main">|</span> <span class="main">(</span>pos<span class="main">)</span><span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="skolem">a</span><span class="main">*</span><span class="skolem">b</span><span class="main">&lt;</span><span class="main">0</span> <span class="main">∧</span> <span class="main">¬</span><span class="skolem">b</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> neg
    <span class="keyword1"><span class="command">hence</span></span> 
      <span class="quoted"><span class="quoted">"changes <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">s</span> <span class="bound">i</span> <span class="main">*</span> nth_default <span class="main">0</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">b</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="bound">i</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">n</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span>
        <span class="main">1</span> <span class="main">+</span> changes <span class="main">(</span><span class="skolem">s</span> <span class="main">1</span> <span class="main">*</span> <span class="skolem">b</span> <span class="main">#</span> map <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> <span class="skolem">s</span> <span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="bound">i</span> 
                                        <span class="main">*</span> nth_default <span class="main">0</span> <span class="main">(</span><span class="skolem">xs</span><span class="main">)</span> <span class="bound">i</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">m</span><span class="main">]</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> h<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> 3<span class="main">(</span>4<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> 3<span class="main">(</span>4<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> hn
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> changes.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> mult_less_0_iff pos2
          mult_pos_pos one_less_numeral_iff semiring_norm<span class="main"><span class="main">(</span></span>76<span class="main"><span class="main">)</span></span> trans_less_add2<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> 
      <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span> changes <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">s</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> nth_default <span class="main">0</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="bound">i</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">m</span><span class="main">]</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> arg_cong<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span> <span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> <span class="main"><span class="main">1</span></span> <span class="main"><span class="main">+</span></span> changes <span class="bound"><span class="bound">x</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">m</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> changes <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">b</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> 3<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> neg<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> 3 neg hn <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> nil
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"changes <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">s</span> <span class="bound">i</span> <span class="main">*</span> nth_default <span class="main">0</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">b</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="bound">i</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">n</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span>
           changes <span class="main">(</span><span class="skolem">s</span> <span class="main">0</span> <span class="main">*</span> <span class="skolem">a</span> <span class="main">#</span> map <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> <span class="skolem">s</span> <span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="bound">i</span> <span class="main">*</span> nth_default <span class="main">0</span> <span class="main">(</span><span class="skolem">xs</span><span class="main">)</span> <span class="bound">i</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">m</span><span class="main">]</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> h<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> 3<span class="main">(</span>4<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> 3<span class="main">(</span>4<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> hn
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> 
      <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> changes <span class="main">(</span>map 
               <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">s</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> Suc <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> nth_default <span class="main">0</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="bound">i</span><span class="main">)</span> 
              <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">m</span><span class="main">]</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> arg_cong<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span> <span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> changes <span class="bound"><span class="bound">x</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">m</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> changes <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">b</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> 3<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> 3 nil hn <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> pos
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"changes <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">s</span> <span class="bound">i</span> <span class="main">*</span> nth_default <span class="main">0</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">b</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="bound">i</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">n</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span>
           changes <span class="main">(</span><span class="skolem">s</span> <span class="main">1</span> <span class="main">*</span> <span class="skolem">b</span> <span class="main">#</span> map <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> <span class="skolem">s</span> <span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="bound">i</span> <span class="main">*</span> nth_default <span class="main">0</span> <span class="main">(</span><span class="skolem">xs</span><span class="main">)</span> <span class="bound">i</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">m</span><span class="main">]</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> h<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> 3<span class="main">(</span>4<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> 3<span class="main">(</span>4<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> hn
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> changes.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> divisors_zero 
          mult_less_0_iff nat_1_add_1 not_square_less_zero one_less_numeral_iff
          semiring_norm<span class="main"><span class="main">(</span></span>76<span class="main"><span class="main">)</span></span> trans_less_add2 zero_less_mult_pos zero_less_two<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> changes <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">s</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> nth_default <span class="main">0</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="bound">i</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">m</span><span class="main">]</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> arg_cong<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span> <span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> changes <span class="bound"><span class="bound">x</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">m</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> changes <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">b</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> 3<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> 3 pos hn <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="RRI_Misc-changes_scale_const"><span class="command">lemma</span></span> changes_scale_const<span class="main">:</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">xs</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>linordered_idom list"</span></span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> hs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"changes <span class="main">(</span>map <span class="main">(</span><span class="main">(*)</span> <span class="free">s</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> changes <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> changes.induct<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> hs <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mult_less_0_iff zero_less_mult_iff<span class="main">)</span>

<span class="keyword1" id="RRI_Misc-changes_snoc"><span class="command">lemma</span></span> changes_snoc<span class="main">:</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">xs</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>linordered_idom list"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"changes <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">b</span><span class="main">,</span> <span class="free">a</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="main">+</span> changes <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">b</span><span class="main">]</span><span class="main">)</span>
         <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free">b</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> changes <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">a</span><span class="main">]</span><span class="main">)</span> <span class="keyword1">else</span> changes <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">b</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> changes.induct<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mult_less_0_iff<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mult_less_0_iff<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="RRI_Misc-changes_rev"><span class="command">lemma</span></span> changes_rev<span class="main">:</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">xs</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>linordered_idom list"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"changes <span class="main">(</span>rev <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> changes <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> changes.induct<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> changes_snoc<span class="main">)</span>

<span class="keyword1" id="RRI_Misc-changes_rev_about"><span class="command">lemma</span></span> changes_rev_about<span class="main">:</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">xs</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>linordered_idom list"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"changes <span class="main">(</span>replicate <span class="main">(</span><span class="free">p</span> <span class="main">-</span> length <span class="free">xs</span><span class="main">)</span> <span class="main">0</span> <span class="main">@</span> rev <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> changes <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>Suc <span class="skolem">p</span> <span class="main">≤</span> length <span class="free">xs</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">p</span> <span class="main">-</span> length <span class="free">xs</span> <span class="main">=</span> Suc <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> length <span class="free">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Suc.IH changes_rev <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> changes_rev<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> changes_rev<span class="main">)</span>

<span class="keyword1" id="RRI_Misc-changes_add_between"><span class="command">lemma</span></span> changes_add_between<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≤</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"changes <span class="main">(</span><span class="free">as</span> <span class="main">@</span> <span class="main">[</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">]</span> <span class="main">@</span> <span class="free">bs</span><span class="main">)</span> <span class="main">=</span> changes <span class="main">(</span><span class="free">as</span> <span class="main">@</span> <span class="main">[</span><span class="free">a</span><span class="main">,</span> <span class="free">x</span><span class="main">,</span> <span class="free">b</span><span class="main">]</span> <span class="main">@</span> <span class="free">bs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">as</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> changes.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 1
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">bs</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mult_less_0_iff<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">c</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">bs</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mult_less_0_iff<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">y</span> <span class="skolem">z</span> <span class="skolem">as</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mult_less_0_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="RRI_Misc-changes_all_nonneg"><span class="command">lemma</span></span> changes_all_nonneg<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> nth_default <span class="main">0</span> <span class="free">xs</span> <span class="bound">i</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"changes <span class="free">xs</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> changes.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">x1</span> <span class="skolem">x2</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> nth_default <span class="main">0</span> <span class="main">(</span><span class="skolem">x1</span> <span class="main">#</span> <span class="skolem">x2</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> nth_default <span class="main">0</span> <span class="main">(</span><span class="skolem">x1</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="bound">i</span><span class="main">)</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> nth_default <span class="main">0</span> <span class="main">(</span><span class="skolem">x2</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x1</span> <span class="main">*</span> <span class="skolem">x2</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
    <span class="keyword3"><span class="command">assume</span></span> h<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> nth_default <span class="main">0</span> <span class="main">(</span><span class="skolem">x1</span> <span class="main">#</span> <span class="skolem">x2</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> nth_default <span class="main">0</span> <span class="main">(</span><span class="skolem">x1</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="skolem">i</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">i</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> 0
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> h<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">nat</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> h<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>Suc <span class="skolem">nat</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> nth_default <span class="main">0</span> <span class="main">(</span><span class="skolem">x2</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> h<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">i</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x1</span><span class="main">*</span><span class="skolem">x2</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> h<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> h<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="RRI_Misc-changes_pCons"><span class="command">lemma</span></span> changes_pCons<span class="main">:</span> <span class="quoted"><span class="quoted">"changes <span class="main">(</span>coeffs <span class="main">(</span>pCons <span class="main">0</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> changes <span class="main">(</span>coeffs <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cCons_def<span class="main">)</span>

<span class="keyword1" id="RRI_Misc-changes_increasing"><span class="command">lemma</span></span> changes_increasing<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> length <span class="free">xs</span> <span class="main">-</span> <span class="main">1</span> <span class="main">⟹</span> <span class="free">xs</span> <span class="main">!</span> <span class="main">(</span><span class="bound">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">≥</span> <span class="free">xs</span> <span class="main">!</span> <span class="bound">i</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"hd <span class="free">xs</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"last <span class="free">xs</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"changes <span class="free">xs</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>changes.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">consider</span></span> <span class="main">(</span>neg<span class="main">)</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">*</span><span class="skolem">y</span><span class="main">&lt;</span><span class="main">0</span>"</span></span> <span class="main">|</span> <span class="main">(</span>nil<span class="main">)</span><span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="main">|</span> <span class="main">(</span>pos<span class="main">)</span><span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="skolem">x</span><span class="main">*</span><span class="skolem">y</span><span class="main">&lt;</span><span class="main">0</span> <span class="main">∧</span> <span class="main">¬</span><span class="skolem">y</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
    <span class="keyword3"><span class="command">case</span></span> neg
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"changes <span class="main">(</span><span class="skolem">y</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> changes_all_nonneg<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> nth_default <span class="main">0</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="skolem">i</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">y</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> 3<span class="main">(</span>4<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">i</span></span><span class="main">]</span> 
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">i</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> 3<span class="main">(</span>6<span class="main">)</span> neg <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mult_less_0_iff<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> 3<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nth_default_def<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nth_default_def<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"changes <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">y</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> neg <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> nil
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 3<span class="main">(</span>7<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">have</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span> <span class="main">⟹</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">≤</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">!</span> <span class="main">(</span><span class="bound">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">≤</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> 3<span class="main">(</span>4<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> 3<span class="main">(</span>4<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">xs</span> <span class="main">≠</span> <span class="main">[]</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword1"><span class="command">using</span></span> 3<span class="main">(</span>4<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">+</span><span class="main">1</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"changes <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> 3<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> nil h <span class="quoted"><span class="quoted">‹<span class="skolem">xs</span> <span class="main">≠</span> <span class="main">[]</span>›</span></span> 3<span class="main">(</span>6<span class="main">)</span> 3<span class="main">(</span>7<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> nil <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> pos
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 3<span class="main">(</span>6<span class="main">)</span> 3<span class="main">(</span>7<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mult_less_0_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"changes <span class="main">(</span><span class="skolem">y</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> 3<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">x</span> <span class="main">*</span> <span class="skolem">y</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> pos <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">y</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span> 
        <span class="main">⟹</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">≤</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">!</span> <span class="main">(</span><span class="bound">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 3<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">y</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">xs</span> <span class="main">≠</span> <span class="main">[]</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"hd <span class="main">(</span><span class="skolem">y</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 3<span class="main">(</span>6<span class="main">)</span> pos <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mult_less_0_iff<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> last <span class="main">(</span><span class="skolem">y</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 3<span class="main">(</span>7<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> pos <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Bernstein_01">
<div class="head">
<h1>Theory Bernstein_01</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Bernstein Polynomials over the interval [0, 1]›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Bernstein_01
  <span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL-Computational_Algebra/Computational_Algebra.html">HOL-Computational_Algebra.Computational_Algebra</a>"</span> 
    <span class="quoted">"<a href="../../budan_fourier/theories/#Budan_Fourier">Budan_Fourier.Budan_Fourier</a>"</span>
    <span class="quoted">"<a href="#RRI_Misc">RRI_Misc</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The theorem of three circles is a statement about the Bernstein coefficients of a polynomial, the
coefficients when a polynomial is expressed as a sum of Bernstein polynomials. These coefficients
behave nicely under translations and rescaling and are the coefficients of a particular polynomial
in the [0, 1] case. We shall define the [0, 1] case now and consider the general case later,
deriving all the results by rescaling.
›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Definition and basic results›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Bernstein_Poly_01</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat <span class="main">⇒</span> real poly"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Bernstein_Poly_01</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="main">(</span>monom <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="keyword1">choose</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span> 
                              <span class="main">*</span> <span class="main">(</span>monom <span class="main">1</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">-</span><span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">1</span><span class="main">,</span> <span class="main">-</span><span class="main">1</span><span class="main">:]</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Bernstein_01-degree_Bernstein"><span class="command">lemma</span></span> degree_Bernstein<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> hb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">≤</span> <span class="free">p</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>Bernstein_Poly_01 <span class="free">j</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> ha<span class="main">:</span> <span class="quoted"><span class="quoted">"monom <span class="main">(</span><span class="free">p</span> <span class="keyword1">choose</span> <span class="free">j</span><span class="main">)</span> <span class="free">j</span> <span class="main">≠</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>real poly<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hb <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">have</span></span> hb<span class="main">:</span> <span class="quoted"><span class="quoted">"monom <span class="main">1</span> <span class="main">(</span><span class="free">p</span><span class="main">-</span><span class="free">j</span><span class="main">)</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">1</span><span class="main">,</span> <span class="main">-</span><span class="main">1</span><span class="main">:]</span> <span class="main">≠</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>real poly<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"monom <span class="main">1</span> <span class="main">(</span><span class="free">p</span><span class="main">-</span><span class="free">j</span><span class="main">)</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">1</span><span class="main">,</span> <span class="main">-</span><span class="main">1</span><span class="main">:]</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>real poly<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lead_coeff <span class="main">(</span>monom <span class="main">1</span> <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="free">j</span><span class="main">)</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">1</span><span class="main">,</span> <span class="main">-</span><span class="main">1</span><span class="main">:]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>real<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> leading_coeff_0_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lead_coeff <span class="main">(</span>monom <span class="main">(</span><span class="main">1</span><span class="main">::</span>real<span class="main">)</span> <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="free">j</span><span class="main">)</span> 
        <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">1</span><span class="main">,</span> <span class="main">-</span><span class="main">1</span><span class="main">:]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span><span class="main">::</span>real<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> lead_coeff_comp<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> degree_monom_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> ha hb <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Bernstein_Poly_01_def degree_mult_eq 
          degree_monom_eq degree_pcompose<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Bernstein_01-coeff_gt"><span class="command">lemma</span></span> coeff_gt<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> hb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&gt;</span> <span class="free">p</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Bernstein_Poly_01 <span class="free">j</span> <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hb Bernstein_Poly_01_def<span class="main">)</span>

<span class="keyword1" id="Bernstein_01-degree_Bernstein_le"><span class="command">lemma</span></span> degree_Bernstein_le<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>Bernstein_Poly_01 <span class="free">j</span> <span class="free">p</span><span class="main">)</span> <span class="main">≤</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">≤</span> <span class="free">p</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> degree_Bernstein coeff_gt<span class="main">)</span>

<span class="keyword1" id="Bernstein_01-poly_Bernstein_nonneg"><span class="command">lemma</span></span> poly_Bernstein_nonneg<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≥</span> <span class="free">x</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span>Bernstein_Poly_01 <span class="free">j</span> <span class="free">p</span><span class="main">)</span> <span class="free">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_monom poly_pcompose Bernstein_Poly_01_def<span class="main">)</span>

<span class="keyword1" id="Bernstein_01-Bernstein_symmetry"><span class="command">lemma</span></span> Bernstein_symmetry<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">≤</span> <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Bernstein_Poly_01 <span class="free">j</span> <span class="free">p</span><span class="main">)</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">1</span><span class="main">,</span> <span class="main">-</span><span class="main">1</span><span class="main">:]</span> <span class="main">=</span> Bernstein_Poly_01 <span class="main">(</span><span class="free">p</span><span class="main">-</span><span class="free">j</span><span class="main">)</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Bernstein_Poly_01 <span class="free">j</span> <span class="free">p</span><span class="main">)</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">1</span><span class="main">,</span> <span class="main">-</span><span class="main">1</span><span class="main">:]</span>
         <span class="main">=</span> <span class="main">(</span><span class="main">(</span>monom <span class="main">(</span><span class="free">p</span> <span class="keyword1">choose</span> <span class="free">j</span><span class="main">)</span> <span class="free">j</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>monom <span class="main">1</span> <span class="main">(</span><span class="free">p</span><span class="main">-</span><span class="free">j</span><span class="main">)</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">1</span><span class="main">,</span> <span class="main">-</span><span class="main">1</span><span class="main">:]</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">1</span><span class="main">,</span> <span class="main">-</span><span class="main">1</span><span class="main">:]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Bernstein_Poly_01_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>monom <span class="main">(</span><span class="free">p</span> <span class="keyword1">choose</span> <span class="main">(</span><span class="free">p</span><span class="main">-</span><span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="free">j</span> <span class="main">*</span> 
                    <span class="main">(</span>monom <span class="main">1</span> <span class="main">(</span><span class="free">p</span><span class="main">-</span><span class="free">j</span><span class="main">)</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">1</span><span class="main">,</span> <span class="main">-</span><span class="main">1</span><span class="main">:]</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">1</span><span class="main">,</span> <span class="main">-</span><span class="main">1</span><span class="main">:]</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> binomial_symmetric<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> monom <span class="main">(</span><span class="free">p</span> <span class="keyword1">choose</span> <span class="main">(</span><span class="free">p</span><span class="main">-</span><span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="free">j</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">1</span><span class="main">,</span> <span class="main">-</span><span class="main">1</span><span class="main">:]</span> <span class="main">*</span> 
                   <span class="main">(</span>monom <span class="main">1</span> <span class="main">(</span><span class="free">p</span><span class="main">-</span><span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">(</span><span class="main">[:</span><span class="main">1</span><span class="main">,</span> <span class="main">-</span><span class="main">1</span><span class="main">:]</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">1</span><span class="main">,</span> <span class="main">-</span><span class="main">1</span><span class="main">:]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pcompose_mult pcompose_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>monom <span class="main">(</span><span class="free">p</span> <span class="keyword1">choose</span> <span class="main">(</span><span class="free">p</span><span class="main">-</span><span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="free">j</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">1</span><span class="main">,</span> <span class="main">-</span><span class="main">1</span><span class="main">:]</span><span class="main">)</span> <span class="main">*</span> monom <span class="main">1</span> <span class="main">(</span><span class="free">p</span><span class="main">-</span><span class="free">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pcompose_pCons<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> smult <span class="main">(</span><span class="free">p</span> <span class="keyword1">choose</span> <span class="main">(</span><span class="free">p</span><span class="main">-</span><span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>monom <span class="main">1</span> <span class="free">j</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">1</span><span class="main">,</span> <span class="main">-</span><span class="main">1</span><span class="main">:]</span><span class="main">)</span> 
                    <span class="main">*</span> monom <span class="main">1</span> <span class="main">(</span><span class="free">p</span><span class="main">-</span><span class="free">j</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms smult_monom pcompose_smult<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>monom <span class="main">1</span> <span class="free">j</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">1</span><span class="main">,</span> <span class="main">-</span><span class="main">1</span><span class="main">:]</span><span class="main">)</span> <span class="main">*</span> monom <span class="main">(</span><span class="free">p</span> <span class="keyword1">choose</span> <span class="main">(</span><span class="free">p</span><span class="main">-</span><span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">p</span><span class="main">-</span><span class="free">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> mult_smult_left<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> mult_smult_right<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> smult_monom<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> Bernstein_Poly_01 <span class="main">(</span><span class="free">p</span><span class="main">-</span><span class="free">j</span><span class="main">)</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Bernstein_Poly_01_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">Bernstein_Poly_01</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">reciprocal_poly</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1" id="Bernstein_01-Bernstein_reciprocal"><span class="command">lemma</span></span> Bernstein_reciprocal<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"reciprocal_poly <span class="free">p</span> <span class="main">(</span>Bernstein_Poly_01 <span class="free">i</span> <span class="free">p</span><span class="main">)</span> 
    <span class="main">=</span> smult <span class="main">(</span><span class="free">p</span> <span class="keyword1">choose</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="main">[:</span><span class="main">-</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">^</span><span class="main">(</span><span class="free">p</span><span class="main">-</span><span class="free">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≤</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"reciprocal_poly <span class="free">p</span> <span class="main">(</span>Bernstein_Poly_01 <span class="free">i</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> 
         reciprocal_poly <span class="main">(</span>degree <span class="main">(</span>Bernstein_Poly_01 <span class="free">i</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Bernstein_Poly_01 <span class="free">i</span> <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> degree_Bernstein<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> reflect_poly <span class="main">(</span>Bernstein_Poly_01 <span class="free">i</span> <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> reciprocal_degree<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> smult <span class="main">(</span><span class="free">p</span> <span class="keyword1">choose</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="main">[:</span><span class="main">-</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">^</span><span class="main">(</span><span class="free">p</span><span class="main">-</span><span class="free">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Bernstein_Poly_01_def reflect_poly_simps monom_altdef
         pcompose_pCons reflect_poly_pCons' <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> h<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">i</span> <span class="main">≤</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"reciprocal_poly <span class="free">p</span> <span class="main">(</span>Bernstein_Poly_01 <span class="free">i</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>real poly<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> coeff_gt reciprocal_poly_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> smult <span class="main">(</span><span class="free">p</span> <span class="keyword1">choose</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="main">[:</span><span class="main">-</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">^</span><span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> h
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Bernstein_01-Bernstein_reciprocal_translate"><span class="command">lemma</span></span> Bernstein_reciprocal_translate<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"reciprocal_poly <span class="free">p</span> <span class="main">(</span>Bernstein_Poly_01 <span class="free">i</span> <span class="free">p</span><span class="main">)</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">=</span> 
   monom <span class="main">(</span><span class="free">p</span> <span class="keyword1">choose</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="free">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Bernstein_reciprocal pcompose_smult pcompose_pCons monom_altdef <span class="dynamic"><span class="dynamic">hom_distribs</span></span><span class="main">)</span>

<span class="keyword1" id="Bernstein_01-coeff_Bernstein_sum_01"><span class="command">lemma</span></span> coeff_Bernstein_sum_01<span class="main">:</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">b</span><span class="main">::</span><span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">assumes</span></span> hi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≥</span> <span class="free">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> 
    <span class="quoted"><span class="quoted">"coeff <span class="main">(</span>reciprocal_poly <span class="free">p</span> 
            <span class="main">(</span><span class="main">∑</span><span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">..</span><span class="free">p</span><span class="main">.</span> smult <span class="main">(</span><span class="free">b</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span>Bernstein_Poly_01 <span class="bound">x</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span> 
      <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">p</span> <span class="keyword1">choose</span> <span class="free">i</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">b</span> <span class="free">i</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">=</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">P</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">≡</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">..</span><span class="free">p</span><span class="main">.</span> <span class="main">(</span>smult <span class="main">(</span><span class="free">b</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span>Bernstein_Poly_01 <span class="bound">x</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> degree <span class="main">(</span>smult <span class="main">(</span><span class="free">b</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span>Bernstein_Poly_01 <span class="bound">x</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>smult <span class="main">(</span><span class="free">b</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>Bernstein_Poly_01 <span class="skolem">x</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">p</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="free">p</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> degree_Bernstein coeff_gt<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"reciprocal_poly <span class="free">p</span> <span class="skolem">P</span> <span class="main">=</span> 
         <span class="main">(</span><span class="main">∑</span><span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">..</span><span class="free">p</span><span class="main">.</span> reciprocal_poly <span class="free">p</span> <span class="main">(</span>smult <span class="main">(</span><span class="free">b</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span>Bernstein_Poly_01 <span class="bound">x</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> P_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> reciprocal_sum<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">..</span><span class="free">p</span><span class="main">.</span> <span class="main">(</span>smult <span class="main">(</span><span class="free">b</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">p</span> <span class="keyword1">choose</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">[:</span><span class="main">-</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">^</span><span class="main">(</span><span class="free">p</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum.cong<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">p</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"reciprocal_poly <span class="free">p</span> <span class="main">(</span>smult <span class="main">(</span><span class="free">b</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>Bernstein_Poly_01 <span class="skolem">x</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
          smult <span class="main">(</span><span class="main">(</span><span class="free">b</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">p</span> <span class="keyword1">choose</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">[:</span><span class="main">-</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">^</span><span class="main">(</span><span class="free">p</span><span class="main">-</span><span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reciprocal_smult degree_Bernstein Bernstein_reciprocal<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 
    <span class="quoted"><span class="quoted">"reciprocal_poly <span class="free">p</span> <span class="skolem">P</span> <span class="main">=</span> 
     <span class="main">(</span><span class="main">∑</span><span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">..</span><span class="free">p</span><span class="main">.</span> <span class="main">(</span>smult <span class="main">(</span><span class="main">(</span><span class="free">b</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">p</span> <span class="keyword1">choose</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">[:</span><span class="main">-</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">^</span><span class="main">(</span><span class="free">p</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">hence</span></span> 
    <span class="quoted"><span class="quoted">"<span class="main">(</span>reciprocal_poly <span class="free">p</span> <span class="skolem">P</span><span class="main">)</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">=</span> 
     <span class="main">(</span><span class="main">∑</span><span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">..</span><span class="free">p</span><span class="main">.</span> <span class="main">(</span>smult <span class="main">(</span><span class="main">(</span><span class="free">b</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">p</span> <span class="keyword1">choose</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">[:</span><span class="main">-</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">^</span><span class="main">(</span><span class="free">p</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pcompose_sum pcompose_add<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">..</span><span class="free">p</span><span class="main">.</span> <span class="main">(</span>monom <span class="main">(</span><span class="main">(</span><span class="free">b</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">p</span> <span class="keyword1">choose</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum.cong<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">p</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"smult <span class="main">(</span><span class="free">b</span> <span class="skolem">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">p</span> <span class="keyword1">choose</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">[:</span><span class="main">-</span> <span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">=</span>
          monom <span class="main">(</span><span class="free">b</span> <span class="skolem">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">p</span> <span class="keyword1">choose</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">hom_distribs</span></span> pcompose_smult pcompose_pCons monom_altdef<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>reciprocal_poly <span class="free">p</span> <span class="skolem">P</span><span class="main">)</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">=</span> 
                <span class="main">(</span><span class="main">∑</span><span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">..</span><span class="free">p</span><span class="main">.</span> <span class="main">(</span>monom <span class="main">(</span><span class="main">(</span><span class="free">b</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">p</span> <span class="keyword1">choose</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">..</span><span class="free">p</span><span class="main">.</span> <span class="keyword1">if</span> <span class="free">p</span> <span class="main">-</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">p</span> <span class="main">-</span> <span class="free">i</span> <span class="keyword1">then</span> <span class="free">b</span> <span class="bound">x</span> <span class="main">*</span> real <span class="main">(</span><span class="free">p</span> <span class="keyword1">choose</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> P_def coeff_sum<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">..</span><span class="free">p</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">i</span> <span class="keyword1">then</span> <span class="free">b</span> <span class="bound">x</span> <span class="main">*</span> real <span class="main">(</span><span class="free">p</span> <span class="keyword1">choose</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum.cong<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">p</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">if</span> <span class="free">p</span> <span class="main">-</span> <span class="skolem">x</span> <span class="main">=</span> <span class="free">p</span> <span class="main">-</span> <span class="free">i</span> <span class="keyword1">then</span> <span class="free">b</span> <span class="skolem">x</span> <span class="main">*</span> real <span class="main">(</span><span class="free">p</span> <span class="keyword1">choose</span> <span class="skolem">x</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span>
          <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">x</span> <span class="main">=</span> <span class="free">i</span> <span class="keyword1">then</span> <span class="free">b</span> <span class="skolem">x</span> <span class="main">*</span> real <span class="main">(</span><span class="free">p</span> <span class="keyword1">choose</span> <span class="skolem">x</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hi
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> leI<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?R</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Bernstein_01-Bernstein_sum_01"><span class="command">lemma</span></span> Bernstein_sum_01<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> hP<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">P</span> <span class="main">≤</span> <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span> <span class="main">=</span> <span class="main">0</span><span class="main">..</span><span class="free">p</span><span class="main">.</span> smult 
     <span class="main">(</span>inverse <span class="main">(</span>real <span class="main">(</span><span class="free">p</span> <span class="keyword1">choose</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> 
      coeff <span class="main">(</span>reciprocal_poly <span class="free">p</span> <span class="free">P</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span> <span class="main">(</span><span class="free">p</span><span class="main">-</span><span class="bound">j</span><span class="main">)</span><span class="main">)</span>
   <span class="main">(</span>Bernstein_Poly_01 <span class="bound">j</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="main">≡</span> reciprocal_poly <span class="free">p</span> <span class="free">P</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> hP Q_def <span class="keyword1"><span class="command">have</span></span> hQ<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="skolem">Q</span> <span class="main">≤</span> <span class="free">p</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> degree_reciprocal degree_pcompose<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"reciprocal_poly <span class="free">p</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span> <span class="main">=</span> <span class="main">0</span><span class="main">..</span><span class="free">p</span><span class="main">.</span> 
        smult <span class="main">(</span>inverse <span class="main">(</span>real <span class="main">(</span><span class="free">p</span> <span class="keyword1">choose</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">Q</span> <span class="main">(</span><span class="free">p</span><span class="main">-</span><span class="bound">j</span><span class="main">)</span><span class="main">)</span> 
        <span class="main">(</span>Bernstein_Poly_01 <span class="bound">j</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">=</span> <span class="skolem">Q</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> poly_eqI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span>reciprocal_poly <span class="free">p</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span> <span class="main">=</span> <span class="main">0</span><span class="main">..</span><span class="free">p</span><span class="main">.</span> 
          smult <span class="main">(</span>inverse <span class="main">(</span>real <span class="main">(</span><span class="free">p</span> <span class="keyword1">choose</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">Q</span> <span class="main">(</span><span class="free">p</span><span class="main">-</span><span class="bound">j</span><span class="main">)</span><span class="main">)</span>
          <span class="main">(</span>Bernstein_Poly_01 <span class="bound">j</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span> <span class="skolem">n</span> <span class="main">=</span> coeff <span class="skolem">Q</span> <span class="skolem">n</span>"</span></span> 
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">=</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
      <span class="keyword3"><span class="command">assume</span></span> hn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≤</span> <span class="free">p</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">=</span> coeff <span class="main">(</span>reciprocal_poly <span class="free">p</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span> <span class="main">=</span> <span class="main">0</span><span class="main">..</span><span class="free">p</span><span class="main">.</span> 
             smult <span class="main">(</span>inverse <span class="main">(</span>real <span class="main">(</span><span class="free">p</span> <span class="keyword1">choose</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">Q</span> <span class="main">(</span><span class="free">p</span><span class="main">-</span><span class="bound">j</span><span class="main">)</span><span class="main">)</span> 
             <span class="main">(</span>Bernstein_Poly_01 <span class="bound">j</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span> <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">p</span> <span class="keyword1">choose</span> <span class="main">(</span><span class="free">p</span><span class="main">-</span><span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> 
                       <span class="main">(</span>inverse <span class="main">(</span>real <span class="main">(</span><span class="free">p</span> <span class="keyword1">choose</span> <span class="main">(</span><span class="free">p</span><span class="main">-</span><span class="skolem">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> 
                        coeff <span class="skolem">Q</span> <span class="main">(</span><span class="free">p</span><span class="main">-</span><span class="main">(</span><span class="free">p</span><span class="main">-</span><span class="skolem">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> coeff_Bernstein_sum_01<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?R</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hn
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">=</span> <span class="var">?R</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> hn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">n</span> <span class="main">≤</span> <span class="free">p</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span><span class="main">∑</span><span class="bound">j</span> <span class="main">=</span> <span class="main">0</span><span class="main">..</span><span class="free">p</span><span class="main">.</span>
            smult <span class="main">(</span>inverse <span class="main">(</span>real <span class="main">(</span><span class="free">p</span> <span class="keyword1">choose</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">Q</span> <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>
            <span class="main">(</span>Bernstein_Poly_01 <span class="bound">j</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">p</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> degree_sum_le<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">q</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">p</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">≤</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>smult <span class="main">(</span>inverse <span class="main">(</span>real <span class="main">(</span><span class="free">p</span> <span class="keyword1">choose</span> <span class="skolem">q</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> 
              coeff <span class="skolem">Q</span> <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="skolem">q</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Bernstein_Poly_01 <span class="skolem">q</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">p</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> degree_Bernstein degree_smult_le<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>reciprocal_poly <span class="free">p</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span> <span class="main">=</span> <span class="main">0</span><span class="main">..</span><span class="free">p</span><span class="main">.</span>
            smult <span class="main">(</span>inverse <span class="main">(</span>real <span class="main">(</span><span class="free">p</span> <span class="keyword1">choose</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">Q</span> <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> 
            <span class="main">(</span>Bernstein_Poly_01 <span class="bound">j</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span> <span class="main">≤</span> <span class="free">p</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> degree_pcompose degree_reciprocal<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hn <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> coeff_eq_0<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">=</span> <span class="var">?R</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hQ hn <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> coeff_eq_0<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"reciprocal_poly <span class="free">p</span> <span class="free">P</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">=</span> 
         reciprocal_poly <span class="free">p</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span> <span class="main">=</span> <span class="main">0</span><span class="main">..</span><span class="free">p</span><span class="main">.</span> 
         smult <span class="main">(</span>inverse <span class="main">(</span>real <span class="main">(</span><span class="free">p</span> <span class="keyword1">choose</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span>
         coeff <span class="main">(</span>reciprocal_poly <span class="free">p</span> <span class="free">P</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span> <span class="main">(</span><span class="free">p</span><span class="main">-</span><span class="bound">j</span><span class="main">)</span><span class="main">)</span>
         <span class="main">(</span>Bernstein_Poly_01 <span class="bound">j</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> degree_reciprocal degree_pcompose Q_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"reciprocal_poly <span class="free">p</span> <span class="free">P</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">(</span><span class="main">[:</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">-</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span> <span class="main">=</span>
         reciprocal_poly <span class="free">p</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span> <span class="main">=</span> <span class="main">0</span><span class="main">..</span><span class="free">p</span><span class="main">.</span> smult <span class="main">(</span>inverse <span class="main">(</span>real <span class="main">(</span><span class="free">p</span> <span class="keyword1">choose</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> 
         coeff <span class="main">(</span>reciprocal_poly <span class="free">p</span> <span class="free">P</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span> <span class="main">(</span><span class="free">p</span><span class="main">-</span><span class="bound">j</span><span class="main">)</span><span class="main">)</span> 
         <span class="main">(</span>Bernstein_Poly_01 <span class="bound">j</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">(</span><span class="main">[:</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">-</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pcompose_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"reciprocal_poly <span class="free">p</span> <span class="free">P</span> <span class="main">=</span> reciprocal_poly <span class="free">p</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span> <span class="main">=</span> <span class="main">0</span><span class="main">..</span><span class="free">p</span><span class="main">.</span> 
         smult <span class="main">(</span>inverse <span class="main">(</span>real <span class="main">(</span><span class="free">p</span> <span class="keyword1">choose</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span>
         coeff <span class="main">(</span>reciprocal_poly <span class="free">p</span> <span class="free">P</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span> <span class="main">(</span><span class="free">p</span><span class="main">-</span><span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Bernstein_Poly_01 <span class="bound">j</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pcompose_pCons<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"reciprocal_poly <span class="free">p</span> <span class="main">(</span>reciprocal_poly <span class="free">p</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> 
         reciprocal_poly <span class="free">p</span> <span class="main">(</span>reciprocal_poly <span class="free">p</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span> <span class="main">=</span> <span class="main">0</span><span class="main">..</span><span class="free">p</span><span class="main">.</span> 
         smult <span class="main">(</span>inverse <span class="main">(</span>real <span class="main">(</span><span class="free">p</span> <span class="keyword1">choose</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span>
         coeff <span class="main">(</span>reciprocal_poly <span class="free">p</span> <span class="free">P</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span> <span class="main">(</span><span class="free">p</span><span class="main">-</span><span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Bernstein_Poly_01 <span class="bound">j</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span> <span class="main">=</span> <span class="main">0</span><span class="main">..</span><span class="free">p</span><span class="main">.</span> smult <span class="main">(</span>inverse <span class="main">(</span>real <span class="main">(</span><span class="free">p</span> <span class="keyword1">choose</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> 
        coeff <span class="main">(</span>reciprocal_poly <span class="free">p</span> <span class="free">P</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span> <span class="main">(</span><span class="free">p</span><span class="main">-</span><span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Bernstein_Poly_01 <span class="bound">j</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> hP <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> reciprocal_reciprocal degree_sum_le degree_smult_le 
                 degree_Bernstein degree_add_le<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Bernstein_01-Bernstein_Poly_01_span1"><span class="command">lemma</span></span> Bernstein_Poly_01_span1<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> hP<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">P</span> <span class="main">≤</span> <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">∈</span> poly_vs.span <span class="main">{</span>Bernstein_Poly_01 <span class="bound">x</span> <span class="free">p</span> <span class="main">|</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">p</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Bernstein_Poly_01 <span class="skolem">x</span> <span class="free">p</span>
         <span class="main">∈</span> poly_vs.span <span class="main">{</span>Bernstein_Poly_01 <span class="bound">x</span> <span class="free">p</span> <span class="main">|</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">p</span><span class="main">}</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">p</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span><span class="main">.</span> Bernstein_Poly_01 <span class="skolem">x</span> <span class="free">p</span> <span class="main">=</span> Bernstein_Poly_01 <span class="bound">n</span> <span class="free">p</span> <span class="main">∧</span> <span class="bound">n</span> <span class="main">≤</span> <span class="free">p</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> 
      <span class="quoted"><span class="quoted">"Bernstein_Poly_01 <span class="skolem">x</span> <span class="free">p</span> <span class="main">∈</span> poly_vs.span <span class="main">{</span>Bernstein_Poly_01 <span class="bound">n</span> <span class="free">p</span> <span class="main">|</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">≤</span> <span class="free">p</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_vs.span_base<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Bernstein_sum_01<span class="main"><span class="main">[</span></span><span class="operator">OF</span> hP<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> poly_vs.span_sum<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> poly_vs.span_scale<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Bernstein_01-Bernstein_Poly_01_span"><span class="command">lemma</span></span> Bernstein_Poly_01_span<span class="main">:</span>
  <span class="quoted"><span class="quoted">"poly_vs.span <span class="main">{</span>Bernstein_Poly_01 <span class="bound">x</span> <span class="free">p</span> <span class="main">|</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">p</span><span class="main">}</span> 
      <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> degree <span class="bound">x</span> <span class="main">≤</span> <span class="free">p</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> monom_span<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> poly_vs.span_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> monom_span degree_Bernstein_le
      Bernstein_Poly_01_span1 degree_monom_eq<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Bernstein coefficients and changes›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Bernstein_coeffs_01</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> real poly <span class="main">⇒</span> real list"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">Bernstein_coeffs_01</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">=</span> 
   <span class="main">[</span><span class="main">(</span>inverse <span class="main">(</span>real <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="keyword1">choose</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> 
    coeff <span class="main">(</span>reciprocal_poly <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">-</span><span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> j <span class="main">←</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">]</span><span class="main">]</span>"</span></span>

<span class="keyword1" id="Bernstein_01-length_Bernstein_coeffs_01"><span class="command">lemma</span></span> length_Bernstein_coeffs_01<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>Bernstein_coeffs_01 <span class="free">p</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Bernstein_coeffs_01_def<span class="main">)</span>

<span class="keyword1" id="Bernstein_01-nth_default_Bernstein_coeffs_01"><span class="command">lemma</span></span> nth_default_Bernstein_coeffs_01<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">P</span> <span class="main">≤</span> <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"nth_default <span class="main">0</span> <span class="main">(</span>Bernstein_coeffs_01 <span class="free">p</span> <span class="free">P</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> 
         inverse <span class="main">(</span><span class="free">p</span> <span class="keyword1">choose</span> <span class="free">i</span><span class="main">)</span> <span class="main">*</span> coeff <span class="main">(</span>reciprocal_poly <span class="free">p</span> <span class="free">P</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span> <span class="main">(</span><span class="free">p</span><span class="main">-</span><span class="free">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="free">i</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Bernstein_coeffs_01_def nth_default_append
                  nth_default_Cons Nitpick.case_nat_unfold binomial_eq_0<span class="main">)</span>

<span class="keyword1" id="Bernstein_01-Bernstein_coeffs_01_sum"><span class="command">lemma</span></span> Bernstein_coeffs_01_sum<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">P</span> <span class="main">≤</span> <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span> <span class="main">=</span> <span class="main">0</span><span class="main">..</span><span class="free">p</span><span class="main">.</span> smult <span class="main">(</span>nth_default <span class="main">0</span> <span class="main">(</span>Bernstein_coeffs_01 <span class="free">p</span> <span class="free">P</span><span class="main">)</span> <span class="bound">j</span><span class="main">)</span> 
             <span class="main">(</span>Bernstein_Poly_01 <span class="bound">j</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> nth_default_Bernstein_coeffs_01<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Bernstein_sum_01<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Bernstein_changes_01</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> real poly <span class="main">⇒</span> int"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Bernstein_changes_01</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">=</span> nat <span class="main">(</span>changes <span class="main">(</span>Bernstein_coeffs_01 <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Bernstein_01-Bernstein_changes_01_def'"><span class="command">lemma</span></span> Bernstein_changes_01_def'<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"Bernstein_changes_01 <span class="free">p</span> <span class="free">P</span> <span class="main">=</span> nat <span class="main">(</span>changes <span class="main">[</span><span class="main">(</span>inverse <span class="main">(</span>real <span class="main">(</span><span class="free">p</span> <span class="keyword1">choose</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> 
     coeff <span class="main">(</span>reciprocal_poly <span class="free">p</span> <span class="free">P</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span> <span class="main">(</span><span class="free">p</span><span class="main">-</span><span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> j <span class="main">←</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">]</span><span class="main">]</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Bernstein_changes_01_def Bernstein_coeffs_01_def<span class="main">)</span>

<span class="keyword1" id="Bernstein_01-Bernstein_changes_01_eq_changes"><span class="command">lemma</span></span> Bernstein_changes_01_eq_changes<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> hP<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">P</span> <span class="main">≤</span> <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Bernstein_changes_01 <span class="free">p</span> <span class="free">P</span> <span class="main">=</span> 
         changes <span class="main">(</span>coeffs <span class="main">(</span><span class="main">(</span>reciprocal_poly <span class="free">p</span> <span class="free">P</span><span class="main">)</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> Bernstein_changes_01_def'<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> h<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"map <span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> inverse <span class="main">(</span>real <span class="main">(</span><span class="free">p</span> <span class="keyword1">choose</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> 
     coeff <span class="main">(</span>reciprocal_poly <span class="free">p</span> <span class="free">P</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span> <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">]</span> <span class="main">=</span> 
     map <span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> inverse <span class="main">(</span>real <span class="main">(</span><span class="free">p</span> <span class="keyword1">choose</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> 
     nth_default <span class="main">0</span> <span class="main">[</span>nth_default <span class="main">0</span> <span class="main">(</span>coeffs <span class="main">(</span>reciprocal_poly <span class="free">p</span> <span class="free">P</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span><span class="main">)</span>
                    <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> j <span class="main">←</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">]</span><span class="main">]</span> <span class="bound">j</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> map_cong<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">p</span><span class="main">+</span><span class="main">1</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> hx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span>
      <span class="quoted"><span class="quoted">"length <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> nth_default <span class="main">0</span> 
       <span class="main">(</span>coeffs <span class="main">(</span>reciprocal_poly <span class="free">p</span> <span class="free">P</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">]</span><span class="main">)</span> <span class="main">≤</span> Suc <span class="free">p</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>coeffs <span class="main">(</span>reciprocal_poly <span class="free">p</span> <span class="free">P</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> Suc <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">P</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"reciprocal_poly <span class="free">p</span> <span class="free">P</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> hP <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Missing_Polynomial.pcompose_eq_0 reciprocal_0_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>degree <span class="main">(</span>reciprocal_poly <span class="free">p</span> <span class="free">P</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> Suc <span class="free">p</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> hP <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> degree_pcompose degree_reciprocal<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">using</span></span> length_coeffs_degree <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> reciprocal_0<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> h<span class="main">:</span> 
      <span class="quoted"><span class="quoted">"nth_default <span class="main">0</span> <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> nth_default <span class="main">0</span> <span class="main">(</span>coeffs 
       <span class="main">(</span>reciprocal_poly <span class="free">p</span> <span class="free">P</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">]</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span>
       nth_default <span class="main">0</span> <span class="main">(</span>coeffs <span class="main">(</span>reciprocal_poly <span class="free">p</span> <span class="free">P</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">=</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">=</span> <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> nth_default <span class="main">0</span> <span class="main">(</span>coeffs
            <span class="main">(</span>reciprocal_poly <span class="free">p</span> <span class="free">P</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">]</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> hx <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nth_default_nth<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>  nth_default <span class="main">0</span> 
          <span class="main">(</span>coeffs <span class="main">(</span>reciprocal_poly <span class="free">p</span> <span class="free">P</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">]</span> <span class="main">!</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> nth_map<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> hx <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?R</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> nth_upt<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> hx <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inverse <span class="main">(</span>real <span class="main">(</span><span class="free">p</span> <span class="keyword1">choose</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span>
          coeff <span class="main">(</span>reciprocal_poly <span class="free">p</span> <span class="free">P</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span> <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span>
          inverse <span class="main">(</span>real <span class="main">(</span><span class="free">p</span> <span class="keyword1">choose</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span>
          nth_default <span class="main">0</span> <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> nth_default <span class="main">0</span> 
          <span class="main">(</span>coeffs <span class="main">(</span>reciprocal_poly <span class="free">p</span> <span class="free">P</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">]</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> h<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> nth_default_coeffs_eq<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"rev <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> nth_default <span class="main">0</span> <span class="main">(</span>coeffs <span class="main">(</span>reciprocal_poly <span class="free">p</span> <span class="free">P</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span><span class="main">)</span> 
     <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> map <span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> nth_default <span class="main">0</span> <span class="main">(</span>coeffs 
     <span class="main">(</span>reciprocal_poly <span class="free">p</span> <span class="free">P</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span><span class="main">)</span> <span class="bound">j</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> rev_map<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> map_cong'<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">q</span><span class="main">.</span> <span class="main">(</span><span class="bound">q</span> <span class="main">≥</span> <span class="free">p</span> <span class="main">⟶</span> rev <span class="main">[</span><span class="bound">q</span><span class="main">-</span><span class="free">p</span><span class="main">..&lt;</span><span class="bound">q</span><span class="main">+</span><span class="main">1</span><span class="main">]</span> <span class="main">=</span> map <span class="main">(</span><span class="main">(-)</span> <span class="bound">q</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">p</span><span class="main">+</span><span class="main">1</span><span class="main">]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> 0
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">p</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> IH<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">q</span><span class="main">.</span> <span class="main">(</span><span class="bound">q</span> <span class="main">≥</span> <span class="skolem">p</span> <span class="main">⟶</span> rev <span class="main">[</span><span class="bound">q</span><span class="main">-</span><span class="skolem">p</span><span class="main">..&lt;</span><span class="bound">q</span><span class="main">+</span><span class="main">1</span><span class="main">]</span> <span class="main">=</span> map <span class="main">(</span><span class="main">(-)</span> <span class="bound">q</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">p</span><span class="main">+</span><span class="main">1</span><span class="main">]</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Suc.IH <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">assume</span></span> hq<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">p</span> <span class="main">≤</span> <span class="skolem">q</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"rev <span class="main">[</span><span class="skolem">q</span> <span class="main">-</span> <span class="skolem">p</span><span class="main">..&lt;</span><span class="skolem">q</span> <span class="main">+</span> <span class="main">1</span><span class="main">]</span> <span class="main">=</span> map <span class="main">(</span><span class="main">(-)</span> <span class="main">(</span><span class="skolem">q</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">]</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> IH<span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> hq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">q</span> <span class="main">-</span> Suc <span class="skolem">p</span><span class="main">..&lt;</span><span class="skolem">q</span> <span class="main">+</span> <span class="main">1</span><span class="main">]</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">q</span> <span class="main">-</span> Suc <span class="skolem">p</span><span class="main">)</span> <span class="main">#</span> <span class="main">[</span><span class="skolem">q</span> <span class="main">-</span> <span class="skolem">p</span><span class="main">..&lt;</span><span class="skolem">q</span> <span class="main">+</span> <span class="main">1</span><span class="main">]</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Suc_diff_Suc Suc_le_lessD hq upt_conv_Cons<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"rev <span class="main">[</span><span class="skolem">q</span> <span class="main">-</span> Suc <span class="skolem">p</span><span class="main">..&lt;</span><span class="skolem">q</span> <span class="main">+</span> <span class="main">1</span><span class="main">]</span> <span class="main">=</span> rev <span class="main">[</span><span class="skolem">q</span> <span class="main">-</span> <span class="skolem">p</span><span class="main">..&lt;</span><span class="skolem">q</span> <span class="main">+</span> <span class="main">1</span><span class="main">]</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">q</span> <span class="main">-</span> Suc <span class="skolem">p</span><span class="main">]</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> map <span class="main">(</span><span class="main">(-)</span> <span class="main">(</span><span class="skolem">q</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">]</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">q</span> <span class="main">-</span> Suc <span class="skolem">p</span><span class="main">]</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> h <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> map <span class="main">(</span><span class="main">(-)</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">]</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"rev <span class="main">[</span><span class="skolem">q</span> <span class="main">-</span> Suc <span class="skolem">p</span><span class="main">..&lt;</span><span class="skolem">q</span> <span class="main">+</span> <span class="main">1</span><span class="main">]</span> <span class="main">=</span> map <span class="main">(</span><span class="main">(-)</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"rev <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">]</span> <span class="main">=</span> map <span class="main">(</span><span class="main">(-)</span> <span class="free">p</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> set <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≤</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"nth_default <span class="main">0</span> <span class="main">(</span>coeffs <span class="main">(</span>reciprocal_poly <span class="free">p</span> <span class="free">P</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
          nth_default <span class="main">0</span> <span class="main">(</span>coeffs <span class="main">(</span>reciprocal_poly <span class="free">p</span> <span class="free">P</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span><span class="main">)</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟶</span> degree <span class="bound">f</span> <span class="main">≤</span> <span class="free">p</span> <span class="main">⟶</span>
           map <span class="main">(</span>nth_default <span class="main">0</span> <span class="main">(</span>coeffs <span class="bound">f</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">]</span> <span class="main">=</span> 
           coeffs <span class="bound">f</span> <span class="main">@</span> replicate <span class="main">(</span><span class="free">p</span> <span class="main">-</span> degree <span class="bound">f</span><span class="main">)</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> degree_0_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">p</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> IH<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟶</span>
                degree <span class="skolem">f</span> <span class="main">≤</span> <span class="skolem">p</span> <span class="main">⟶</span>
                map <span class="main">(</span>nth_default <span class="main">0</span> <span class="main">(</span>coeffs <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">]</span> <span class="main">=</span>
                coeffs <span class="skolem">f</span> <span class="main">@</span> replicate <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> degree <span class="skolem">f</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> h'<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">p</span> <span class="main">=</span> degree <span class="skolem">f</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="main">(</span>coeffs <span class="skolem">f</span><span class="main">)</span><span class="main">]</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_is_0 degree_0 length_coeffs plus_1_eq_Suc zero_neq_one<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> h<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> map_nth_default<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> h' <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> h'<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">p</span> <span class="main">≠</span> degree <span class="skolem">f</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">assume</span></span> hf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">f</span> <span class="main">≤</span> Suc <span class="skolem">p</span> <span class="main">⟶</span>
            map <span class="main">(</span>nth_default <span class="main">0</span> <span class="main">(</span>coeffs <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">]</span> <span class="main">=</span>
            coeffs <span class="skolem">f</span> <span class="main">@</span> replicate <span class="main">(</span>Suc <span class="skolem">p</span> <span class="main">-</span> degree <span class="skolem">f</span><span class="main">)</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">f</span> <span class="main">≤</span> Suc <span class="skolem">p</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="skolem">f</span> <span class="main">≤</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> h' <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
          <span class="keyword1"><span class="command">hence</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"map <span class="main">(</span>nth_default <span class="main">0</span> <span class="main">(</span>coeffs <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">]</span> <span class="main">=</span>
                  coeffs <span class="skolem">f</span> <span class="main">@</span> replicate <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> degree <span class="skolem">f</span><span class="main">)</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> IH hf <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"map <span class="main">(</span>nth_default <span class="main">0</span> <span class="main">(</span>coeffs <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">]</span> <span class="main">=</span> 
                map <span class="main">(</span>nth_default <span class="main">0</span> <span class="main">(</span>coeffs <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">]</span> <span class="main">@</span>
                     <span class="main">[</span>nth_default <span class="main">0</span> <span class="main">(</span>coeffs <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span>Suc <span class="skolem">p</span><span class="main">)</span><span class="main">]</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span>
            <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> coeffs <span class="skolem">f</span> <span class="main">@</span> replicate <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> degree <span class="skolem">f</span><span class="main">)</span> <span class="main">0</span> <span class="main">@</span> <span class="main">[</span>coeff <span class="skolem">f</span> <span class="main">(</span>Suc <span class="skolem">p</span><span class="main">)</span><span class="main">]</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> 2 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nth_default_coeffs_eq<span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> coeffs <span class="skolem">f</span> <span class="main">@</span> replicate <span class="main">(</span><span class="skolem">p</span> <span class="main">-</span> degree <span class="skolem">f</span><span class="main">)</span> <span class="main">0</span> <span class="main">@</span> <span class="main">[</span><span class="main">0</span><span class="main">]</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹degree <span class="skolem">f</span> <span class="main">≤</span> Suc <span class="skolem">p</span>›</span></span> h' le_antisym le_degree <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> coeffs <span class="skolem">f</span> <span class="main">@</span> replicate <span class="main">(</span>Suc <span class="skolem">p</span> <span class="main">-</span> degree <span class="skolem">f</span><span class="main">)</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 1
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Suc_diff_le replicate_app_Cons_same<span class="main">)</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"map <span class="main">(</span>nth_default <span class="main">0</span> <span class="main">(</span>coeffs <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">]</span> <span class="main">=</span>
                coeffs <span class="skolem">f</span> <span class="main">@</span> replicate <span class="main">(</span>Suc <span class="skolem">p</span> <span class="main">-</span> degree <span class="skolem">f</span><span class="main">)</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"int <span class="main">(</span>nat <span class="main">(</span>changes <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> inverse <span class="main">(</span>real <span class="main">(</span><span class="free">p</span> <span class="keyword1">choose</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span>
        coeff <span class="main">(</span>reciprocal_poly <span class="free">p</span> <span class="free">P</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span> <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
        changes <span class="main">(</span>coeffs <span class="main">(</span>reciprocal_poly <span class="free">p</span> <span class="free">P</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
    <span class="keyword3"><span class="command">assume</span></span> hP<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"int <span class="main">(</span>nat <span class="main">(</span>changes <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> inverse <span class="main">(</span>real <span class="main">(</span><span class="free">p</span> <span class="keyword1">choose</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span>
          coeff <span class="main">(</span>reciprocal_poly <span class="free">p</span> <span class="free">P</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span> <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
          changes <span class="main">(</span>coeffs <span class="main">(</span>reciprocal_poly <span class="free">p</span> <span class="free">P</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">=</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">=</span> int <span class="main">(</span>nat <span class="main">(</span>changes <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> <span class="main">0</span><span class="main">::</span>real<span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">p</span><span class="main">+</span><span class="main">1</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> hP <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> reciprocal_0 changes_nonneg<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> map_replicate_trivial changes_nonneg
            replicate_app_Cons_same<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">=</span> changes <span class="main">(</span><span class="main">[]</span><span class="main">::</span>real list<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?R</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hP <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> reciprocal_0<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> hP'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> h<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> changes_scale<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>2<span class="main"><span class="keyword3">]</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> changes_rev<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> 1<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> 2<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pcompose_eq_0 hP reciprocal_0_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> degree_reciprocal<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> changes_append_replicate_0 changes_nonneg<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Bernstein_01-Bernstein_changes_01_test"><span class="command">lemma</span></span> Bernstein_changes_01_test<span class="main">:</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">P</span><span class="main">::</span><span class="quoted"><span class="quoted">"real poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> hP<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">P</span> <span class="main">≤</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="free">P</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="main">1</span><span class="main">}</span> <span class="main">≤</span> Bernstein_changes_01 <span class="free">p</span> <span class="free">P</span> <span class="main">∧</span>
        even <span class="main">(</span>Bernstein_changes_01 <span class="free">p</span> <span class="free">P</span> <span class="main">-</span> proots_count <span class="free">P</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="main">1</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Q</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>reciprocal_poly <span class="free">p</span> <span class="free">P</span><span class="main">)</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"changes <span class="main">(</span>coeffs <span class="var">?Q</span><span class="main">)</span> <span class="main">≥</span> proots_count <span class="var">?Q</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">x</span><span class="main">}</span> <span class="main">∧</span> 
        even <span class="main">(</span>changes <span class="main">(</span>coeffs <span class="var">?Q</span><span class="main">)</span> <span class="main">-</span> proots_count <span class="var">?Q</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">x</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> descartes_sign<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Missing_Polynomial.pcompose_eq_0 h0 hP reciprocal_0_iff<span class="main">)</span>
  
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(+)</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>real<span class="main">)</span> <span class="main">`</span> Collect <span class="main">(</span><span class="main">(&lt;)</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>real<span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>real<span class="main">)</span><span class="main">&lt;</span><span class="bound">x</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="main">1</span> <span class="main">&lt;</span> <span class="bound">x</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">(+)</span> <span class="main">1</span> <span class="main">`</span> Collect <span class="main">(</span><span class="main">(&lt;)</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span><span class="main">::</span><span class="quoted">real</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">&lt;</span> <span class="bound">x</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">&lt;</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">∈</span> Collect <span class="main">(</span><span class="main">(&lt;)</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(+)</span> <span class="main">1</span> <span class="main">`</span> Collect <span class="main">(</span><span class="main">(&lt;)</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(+)</span> <span class="main">1</span> <span class="main">`</span> Collect <span class="main">(</span><span class="main">(&lt;)</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> 2<span class="main">:</span>  <span class="quoted"><span class="quoted">"proots_count <span class="free">P</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="main">1</span><span class="main">}</span> <span class="main">=</span> proots_count <span class="var">?Q</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">x</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> proots_pcompose reciprocal_0_iff proots_count_reciprocal'<span class="main">)</span>
  
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Bernstein_changes_01_eq_changes<span class="main"><span class="main">[</span></span><span class="operator">OF</span> hP<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Bernstein_changes_01_eq_changes<span class="main"><span class="main">[</span></span><span class="operator">OF</span> hP<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> 2<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> 2<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 1<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Expression as a Bernstein sum›</span></span>

<span class="keyword1" id="Bernstein_01-Bernstein_coeffs_01_0"><span class="command">lemma</span></span> Bernstein_coeffs_01_0<span class="main">:</span> <span class="quoted"><span class="quoted">"Bernstein_coeffs_01 <span class="free">p</span> <span class="main">0</span> <span class="main">=</span> replicate <span class="main">(</span><span class="free">p</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Bernstein_coeffs_01_def reciprocal_0 map_replicate_trivial
      replicate_append_same<span class="main">)</span>

<span class="keyword1" id="Bernstein_01-Bernstein_coeffs_01_1"><span class="command">lemma</span></span> Bernstein_coeffs_01_1<span class="main">:</span> <span class="quoted"><span class="quoted">"Bernstein_coeffs_01 <span class="free">p</span> <span class="main">1</span> <span class="main">=</span> replicate <span class="main">(</span><span class="free">p</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Bernstein_coeffs_01 <span class="free">p</span> <span class="main">1</span> <span class="main">=</span>
     map <span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> inverse <span class="main">(</span>real <span class="main">(</span><span class="free">p</span> <span class="keyword1">choose</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span>
     coeff <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="free">p</span><span class="main">.</span> smult <span class="main">(</span>real <span class="main">(</span><span class="free">p</span> <span class="keyword1">choose</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">[:</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="main">(</span><span class="free">p</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Bernstein_coeffs_01_def reciprocal_1 monom_altdef
        <span class="dynamic"><span class="dynamic">hom_distribs</span></span> pcompose_pCons poly_0_coeff_0<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> poly_binomial<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> map <span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> inverse <span class="main">(</span>real <span class="main">(</span><span class="free">p</span> <span class="keyword1">choose</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> 
             real <span class="main">(</span><span class="free">p</span> <span class="keyword1">choose</span> <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="main">(</span><span class="free">p</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> monom_altdef<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> coeff_sum binomial<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> map <span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> <span class="main">1</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="main">(</span><span class="free">p</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> map_cong<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> binomial_symmetric<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> replicate <span class="main">(</span><span class="free">p</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> map_replicate_trivial replicate_append_same<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Bernstein_01-Bernstein_coeffs_01_x"><span class="command">lemma</span></span> Bernstein_coeffs_01_x<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Bernstein_coeffs_01 <span class="free">p</span> <span class="main">(</span>monom <span class="main">1</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span><span class="bound">i</span><span class="main">/</span><span class="free">p</span><span class="main">.</span> i <span class="main">←</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="main">(</span><span class="free">p</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">]</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 
    <span class="quoted"><span class="quoted">"Bernstein_coeffs_01 <span class="free">p</span> <span class="main">(</span>monom <span class="main">1</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> map <span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> inverse <span class="main">(</span>real <span class="main">(</span><span class="free">p</span> <span class="keyword1">choose</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span>
     coeff <span class="main">(</span>monom <span class="main">1</span> <span class="main">(</span><span class="free">p</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span> <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="main">(</span><span class="free">p</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Bernstein_coeffs_01_def reciprocal_monom<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> 
    <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> map <span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> inverse <span class="main">(</span>real <span class="main">(</span><span class="free">p</span> <span class="keyword1">choose</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span>
     <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="free">p</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">.</span> coeff <span class="main">(</span>monom <span class="main">(</span>real <span class="main">(</span><span class="free">p</span> <span class="main">-</span>  <span class="main">1</span> <span class="keyword1">choose</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="bound">k</span><span class="main">)</span> <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="main">(</span><span class="free">p</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> monom_altdef <span class="dynamic"><span class="dynamic">hom_distribs</span></span> pcompose_pCons poly_binomial coeff_sum<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span><span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> map <span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> inverse <span class="main">(</span>real <span class="main">(</span><span class="free">p</span> <span class="keyword1">choose</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span>
            real <span class="main">(</span><span class="free">p</span> <span class="main">-</span>  <span class="main">1</span> <span class="keyword1">choose</span> <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="main">(</span><span class="free">p</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> map <span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> <span class="bound">j</span><span class="main">/</span><span class="free">p</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="main">(</span><span class="free">p</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> map_cong<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="main">(</span><span class="free">p</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"inverse <span class="main">(</span>real <span class="main">(</span><span class="free">p</span> <span class="keyword1">choose</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> real <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="main">1</span> <span class="keyword1">choose</span> <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
          real <span class="skolem">x</span> <span class="main">/</span> real <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="var">?thesis</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">-</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="free">p</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="main">1</span> <span class="keyword1">choose</span> <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="main">1</span> <span class="keyword1">choose</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> binomial_symmetric<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> 1 2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">p</span> <span class="keyword1">choose</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span> <span class="main">*</span> <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="main">1</span> <span class="keyword1">choose</span> <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> 2 times_binomial_minus1_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
       <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"real <span class="skolem">x</span> <span class="main">*</span> real <span class="main">(</span><span class="free">p</span> <span class="keyword1">choose</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> real <span class="free">p</span> <span class="main">*</span> real <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="main">1</span> <span class="keyword1">choose</span> <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> of_nat_mult<span class="main">)</span>
       <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> 1 2
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Bernstein_01-Bernstein_coeffs_01_add"><span class="command">lemma</span></span> Bernstein_coeffs_01_add<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">P</span> <span class="main">≤</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">Q</span> <span class="main">≤</span> <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"nth_default <span class="main">0</span> <span class="main">(</span>Bernstein_coeffs_01 <span class="free">p</span> <span class="main">(</span><span class="free">P</span> <span class="main">+</span> <span class="free">Q</span><span class="main">)</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> 
    nth_default <span class="main">0</span> <span class="main">(</span>Bernstein_coeffs_01 <span class="free">p</span> <span class="free">P</span><span class="main">)</span> <span class="free">i</span> <span class="main">+</span>
    nth_default <span class="main">0</span> <span class="main">(</span>Bernstein_coeffs_01 <span class="free">p</span> <span class="free">Q</span><span class="main">)</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nth_default_Bernstein_coeffs_01 degree_add_le
                    reciprocal_add pcompose_add <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>

<span class="keyword1" id="Bernstein_01-Bernstein_coeffs_01_smult"><span class="command">lemma</span></span> Bernstein_coeffs_01_smult<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">P</span> <span class="main">≤</span> <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"nth_default <span class="main">0</span> <span class="main">(</span>Bernstein_coeffs_01 <span class="free">p</span> <span class="main">(</span>smult <span class="free">a</span> <span class="free">P</span><span class="main">)</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span>
          <span class="free">a</span> <span class="main">*</span> nth_default <span class="main">0</span> <span class="main">(</span>Bernstein_coeffs_01 <span class="free">p</span> <span class="free">P</span><span class="main">)</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nth_default_Bernstein_coeffs_01 reciprocal_smult
      pcompose_smult<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Bernstein">
<div class="head">
<h1>Theory Bernstein</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Bernstein Polynomials over any finite interval›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Bernstein
  <span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="#Bernstein_01">Bernstein_01</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Definition and relation to Bernstein Polynomials over [0, 1]›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Bernstein_Poly</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat <span class="main">⇒</span> real <span class="main">⇒</span> real <span class="main">⇒</span> real poly"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Bernstein_Poly</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">=</span> smult <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="keyword1">choose</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span><span class="main">^</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span>
      <span class="main">(</span><span class="main">(</span><span class="main">(</span>monom <span class="main">1</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">-</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>monom <span class="main">1</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">-</span><span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span> <span class="main">-</span><span class="main">1</span><span class="main">:]</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Bernstein-Bernstein_Poly_altdef"><span class="command">lemma</span></span> Bernstein_Poly_altdef<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">≠</span> <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">≤</span> <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Bernstein_Poly <span class="free">j</span> <span class="free">p</span> <span class="free">c</span> <span class="free">d</span> <span class="main">=</span> smult <span class="main">(</span><span class="free">p</span> <span class="keyword1">choose</span> <span class="free">j</span><span class="main">)</span> 
            <span class="main">(</span><span class="main">[:</span><span class="main">-</span><span class="free">c</span><span class="main">/</span><span class="main">(</span><span class="free">d</span><span class="main">-</span><span class="free">c</span><span class="main">)</span><span class="main">,</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="free">d</span><span class="main">-</span><span class="free">c</span><span class="main">)</span><span class="main">:]</span><span class="main">^</span><span class="free">j</span> <span class="main">*</span> <span class="main">[:</span><span class="free">d</span><span class="main">/</span><span class="main">(</span><span class="free">d</span><span class="main">-</span><span class="free">c</span><span class="main">)</span><span class="main">,</span> <span class="main">-</span><span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="free">d</span><span class="main">-</span><span class="free">c</span><span class="main">)</span><span class="main">:]</span><span class="main">^</span><span class="main">(</span><span class="free">p</span><span class="main">-</span><span class="free">j</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">=</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">=</span> smult <span class="main">(</span><span class="free">p</span> <span class="keyword1">choose</span> <span class="free">j</span><span class="main">)</span> <span class="main">(</span>smult <span class="main">(</span><span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="free">d</span> <span class="main">-</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="free">j</span><span class="main">)</span>
        <span class="main">(</span>smult <span class="main">(</span><span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="free">d</span> <span class="main">-</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">p</span><span class="main">-</span><span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">[:</span><span class="main">-</span><span class="free">c</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">^</span><span class="free">j</span> <span class="main">*</span> <span class="main">[:</span><span class="free">d</span><span class="main">,</span> <span class="main">-</span><span class="main">1</span><span class="main">:]</span><span class="main">^</span><span class="main">(</span><span class="free">p</span><span class="main">-</span><span class="free">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Bernstein_Poly_def monom_altdef <span class="dynamic"><span class="dynamic">hom_distribs</span></span>
                    pcompose_pCons smult_eq_iff <span class="dynamic"><span class="dynamic">field_simps</span></span> power_add<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?R</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> mult_smult_right<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> mult_smult_left<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> smult_power<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> smult_power<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Bernstein-Bernstein_Poly_nonneg"><span class="command">lemma</span></span> Bernstein_Poly_nonneg<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">≤</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">d</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span>Bernstein_Poly <span class="free">j</span> <span class="free">p</span> <span class="free">c</span> <span class="free">d</span><span class="main">)</span> <span class="free">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Bernstein_Poly_def poly_pcompose poly_monom<span class="main">)</span>

<span class="keyword1" id="Bernstein-Bernstein_Poly_01"><span class="command">lemma</span></span> Bernstein_Poly_01<span class="main">:</span> <span class="quoted"><span class="quoted">"Bernstein_Poly <span class="free">j</span> <span class="free">p</span> <span class="main">0</span> <span class="main">1</span> <span class="main">=</span> Bernstein_Poly_01 <span class="free">j</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Bernstein_Poly_def Bernstein_Poly_01_def monom_altdef<span class="main">)</span>

<span class="keyword1" id="Bernstein-Bernstein_Poly_rescale"><span class="command">lemma</span></span> Bernstein_Poly_rescale<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Bernstein_Poly <span class="free">j</span> <span class="free">p</span> <span class="free">c</span> <span class="free">d</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="free">a</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">0</span><span class="main">,</span> <span class="free">b</span><span class="main">-</span><span class="free">a</span><span class="main">:]</span> 
            <span class="main">=</span> Bernstein_Poly <span class="free">j</span> <span class="free">p</span> <span class="main">(</span><span class="main">(</span><span class="free">c</span><span class="main">-</span><span class="free">a</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="free">b</span><span class="main">-</span><span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="free">d</span><span class="main">-</span><span class="free">a</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="free">b</span><span class="main">-</span><span class="free">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">=</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?R</span> <span class="main">=</span> smult <span class="main">(</span>real <span class="main">(</span><span class="free">p</span> <span class="keyword1">choose</span> <span class="free">j</span><span class="main">)</span> 
      <span class="main">/</span> <span class="main">(</span><span class="main">(</span><span class="free">d</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="free">c</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">^</span> <span class="free">p</span><span class="main">)</span>
      <span class="main">(</span><span class="main">[:</span><span class="main">-</span> <span class="main">(</span><span class="main">(</span><span class="free">c</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> <span class="free">j</span> 
      <span class="main">*</span> <span class="main">[:</span><span class="main">(</span><span class="free">d</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span><span class="main">,</span> <span class="main">-</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Bernstein_Poly_def monom_altdef <span class="dynamic"><span class="dynamic">hom_distribs</span></span> 
        pcompose_pCons<span class="main">)</span> 
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> smult <span class="main">(</span>real <span class="main">(</span><span class="free">p</span> <span class="keyword1">choose</span> <span class="free">j</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">(</span><span class="free">d</span> <span class="main">-</span> <span class="free">c</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">^</span> <span class="free">p</span><span class="main">)</span>
              <span class="main">(</span><span class="main">[:</span><span class="main">-</span> <span class="main">(</span><span class="main">(</span><span class="free">c</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> <span class="free">j</span> <span class="main">*</span> <span class="main">[:</span><span class="main">(</span><span class="free">d</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span><span class="main">,</span> <span class="main">-</span> <span class="main">1</span><span class="main">:]</span> 
            <span class="main">^</span> <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> smult <span class="main">(</span>real <span class="main">(</span><span class="free">p</span> <span class="keyword1">choose</span> <span class="free">j</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free">d</span> <span class="main">-</span> <span class="free">c</span><span class="main">)</span> <span class="main">^</span> <span class="free">p</span><span class="main">)</span> 
      <span class="main">(</span>smult <span class="main">(</span><span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>smult <span class="main">(</span><span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">^</span> <span class="free">j</span><span class="main">)</span>
      <span class="main">(</span><span class="main">[:</span><span class="main">-</span> <span class="main">(</span><span class="main">(</span><span class="free">c</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> <span class="free">j</span> <span class="main">*</span> <span class="main">[:</span><span class="main">(</span><span class="free">d</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span><span class="main">,</span> <span class="main">-</span> <span class="main">1</span><span class="main">:]</span> 
      <span class="main">^</span> <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> power_add<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> power_divide<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> smult <span class="main">(</span>real <span class="main">(</span><span class="free">p</span> <span class="keyword1">choose</span> <span class="free">j</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free">d</span> <span class="main">-</span> <span class="free">c</span><span class="main">)</span> <span class="main">^</span> <span class="free">p</span><span class="main">)</span>
              <span class="main">(</span><span class="main">[:</span><span class="main">-</span> <span class="main">(</span><span class="free">c</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span><span class="main">,</span> <span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">:]</span> <span class="main">^</span> <span class="free">j</span> <span class="main">*</span> <span class="main">[:</span><span class="free">d</span> <span class="main">-</span> <span class="free">a</span><span class="main">,</span> <span class="main">-</span><span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span><span class="main">:]</span> <span class="main">^</span> <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> mult_smult_left<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> mult_smult_right<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> smult_power<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?L</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Bernstein_Poly_def monom_altdef pcompose_mult 
        pcompose_smult <span class="dynamic"><span class="dynamic">hom_distribs</span></span> pcompose_pCons<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Bernstein-Bernstein_Poly_rescale_01"><span class="command">lemma</span></span> Bernstein_Poly_rescale_01<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">≠</span> <span class="free">d</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Bernstein_Poly <span class="free">j</span> <span class="free">p</span> <span class="free">c</span> <span class="free">d</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="free">c</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">0</span><span class="main">,</span> <span class="free">d</span><span class="main">-</span><span class="free">c</span><span class="main">:]</span> 
          <span class="main">=</span> Bernstein_Poly_01 <span class="free">j</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Bernstein_Poly_rescale<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Bernstein_Poly_01<span class="main">)</span>

<span class="keyword1" id="Bernstein-Bernstein_Poly_eq_rescale_01"><span class="command">lemma</span></span> Bernstein_Poly_eq_rescale_01<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">≠</span> <span class="free">d</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Bernstein_Poly <span class="free">j</span> <span class="free">p</span> <span class="free">c</span> <span class="free">d</span> <span class="main">=</span> Bernstein_Poly_01 <span class="free">j</span> <span class="free">p</span> 
            <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="free">d</span><span class="main">-</span><span class="free">c</span><span class="main">)</span><span class="main">:]</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">-</span><span class="free">c</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Bernstein_Poly_rescale_01<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pcompose_pCons pcompose_assoc<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1" id="Bernstein-coeff_Bernstein_sum"><span class="command">lemma</span></span> coeff_Bernstein_sum<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">b</span><span class="main">::</span><span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">p</span><span class="main">::</span><span class="quoted">nat</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">c</span> <span class="free">d</span><span class="main">::</span><span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">≡</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span> <span class="main">=</span> <span class="main">0</span><span class="main">..</span><span class="free">p</span><span class="main">.</span> <span class="main">(</span>smult <span class="main">(</span><span class="free">b</span> <span class="bound">j</span><span class="main">)</span> <span class="main">(</span>Bernstein_Poly <span class="bound">j</span> <span class="free">p</span> <span class="free">c</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≤</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">≠</span> <span class="free">d</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span><span class="main">(</span>reciprocal_poly <span class="free">p</span> <span class="main">(</span><span class="free">P</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="free">c</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> 
      <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">0</span><span class="main">,</span> <span class="free">d</span><span class="main">-</span><span class="free">c</span><span class="main">:]</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span> <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">p</span> <span class="keyword1">choose</span> <span class="free">i</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">b</span> <span class="free">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="free">c</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">0</span><span class="main">,</span> <span class="free">d</span><span class="main">-</span><span class="free">c</span><span class="main">:]</span> 
      <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span> <span class="main">=</span> <span class="main">0</span><span class="main">..</span><span class="free">p</span><span class="main">.</span> <span class="main">(</span>smult <span class="main">(</span><span class="free">b</span> <span class="bound">j</span><span class="main">)</span> <span class="main">(</span>Bernstein_Poly_01 <span class="bound">j</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> P_def pcompose_sum pcompose_smult 
          pcompose_add Bernstein_Poly_rescale_01<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> coeff_Bernstein_sum_01 assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Bernstein-Bernstein_sum"><span class="command">lemma</span></span> Bernstein_sum<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">≠</span> <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">P</span> <span class="main">≤</span> <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span> <span class="main">=</span> <span class="main">0</span><span class="main">..</span><span class="free">p</span><span class="main">.</span> smult <span class="main">(</span>inverse <span class="main">(</span>real <span class="main">(</span><span class="free">p</span> <span class="keyword1">choose</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>
     <span class="main">*</span> coeff <span class="main">(</span>reciprocal_poly <span class="free">p</span> <span class="main">(</span><span class="free">P</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="free">c</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">0</span><span class="main">,</span> <span class="free">d</span><span class="main">-</span><span class="free">c</span><span class="main">:]</span><span class="main">)</span> 
      <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span> <span class="main">(</span><span class="free">p</span><span class="main">-</span><span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Bernstein_Poly <span class="bound">j</span> <span class="free">p</span> <span class="free">c</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Bernstein_Poly_eq_rescale_01<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> pcompose_smult<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> pcompose_sum<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> pcompose_smult<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> pcompose_sum<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Bernstein_sum_01<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> degree_pcompose pcompose_assoc<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> 
        pcompose_pCons<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Bernstein-Bernstein_Poly_span1"><span class="command">lemma</span></span> Bernstein_Poly_span1<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">≠</span> <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">P</span> <span class="main">≤</span> <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">∈</span> poly_vs.span <span class="main">{</span>Bernstein_Poly <span class="bound">x</span> <span class="free">p</span> <span class="free">c</span> <span class="free">d</span> <span class="main">|</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">p</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> Bernstein_sum<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> poly_vs.span_sum<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">p</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span><span class="main">.</span> Bernstein_Poly <span class="skolem">x</span> <span class="free">p</span> <span class="free">c</span> <span class="free">d</span> <span class="main">=</span> Bernstein_Poly <span class="bound">n</span> <span class="free">p</span> <span class="free">c</span> <span class="free">d</span> <span class="main">∧</span> <span class="bound">n</span> <span class="main">≤</span> <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 
    <span class="quoted"><span class="quoted">"Bernstein_Poly <span class="skolem">x</span> <span class="free">p</span> <span class="free">c</span> <span class="free">d</span> <span class="main">∈</span> poly_vs.span <span class="main">{</span>Bernstein_Poly <span class="bound">n</span> <span class="free">p</span> <span class="free">c</span> <span class="free">d</span> <span class="main">|</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">≤</span> <span class="free">p</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_vs.span_base<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"smult <span class="main">(</span>inverse <span class="main">(</span>real <span class="main">(</span><span class="free">p</span> <span class="keyword1">choose</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span>
        coeff <span class="main">(</span>reciprocal_poly <span class="free">p</span> <span class="main">(</span><span class="free">P</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="free">c</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">0</span><span class="main">,</span> <span class="free">d</span> <span class="main">-</span> <span class="free">c</span><span class="main">:]</span><span class="main">)</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span>
        <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Bernstein_Poly <span class="skolem">x</span> <span class="free">p</span> <span class="free">c</span> <span class="free">d</span><span class="main">)</span>
         <span class="main">∈</span> poly_vs.span <span class="main">{</span>Bernstein_Poly <span class="bound">x</span> <span class="free">p</span> <span class="free">c</span> <span class="free">d</span> <span class="main">|</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">p</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> poly_vs.span_scale<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Bernstein-Bernstein_Poly_span"><span class="command">lemma</span></span> Bernstein_Poly_span<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">≠</span> <span class="free">d</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poly_vs.span <span class="main">{</span>Bernstein_Poly <span class="bound">x</span> <span class="free">p</span> <span class="free">c</span> <span class="free">d</span> <span class="main">|</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">p</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> degree <span class="bound">x</span> <span class="main">≤</span> <span class="free">p</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> Bernstein_Poly_01_span<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> poly_vs.span_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span>Bernstein_Poly <span class="bound">x</span> <span class="free">p</span> <span class="free">c</span> <span class="free">d</span> <span class="main">|</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">p</span><span class="main">}</span>
      <span class="main">⊆</span> poly_vs.span <span class="main">{</span>Bernstein_Poly_01 <span class="bound">x</span> <span class="free">p</span> <span class="main">|</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">p</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Setcompr_subset<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> impI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Bernstein_Poly_01_span1<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> degree_Bernstein_le Bernstein_Poly_eq_rescale_01
                    degree_pcompose<span class="main">)</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span>Bernstein_Poly_01 <span class="bound">x</span> <span class="free">p</span> <span class="main">|</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">p</span><span class="main">}</span>
      <span class="main">⊆</span> poly_vs.span <span class="main">{</span>Bernstein_Poly <span class="bound">x</span> <span class="free">p</span> <span class="free">c</span> <span class="free">d</span> <span class="main">|</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">p</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Setcompr_subset<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> impI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Bernstein_Poly_span1<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> degree_Bernstein_le<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Bernstein-Bernstein_Poly_independent"><span class="command">lemma</span></span> Bernstein_Poly_independent<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">≠</span> <span class="free">d</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poly_vs.independent <span class="main">{</span>Bernstein_Poly <span class="bound">x</span> <span class="free">p</span> <span class="free">c</span> <span class="free">d</span> <span class="main">|</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{..</span><span class="free">p</span><span class="main">}</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> poly_vs.card_le_dim_spanning<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span>Bernstein_Poly <span class="bound">x</span> <span class="free">p</span> <span class="free">c</span> <span class="free">d</span> <span class="main">|</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{..</span> <span class="free">p</span><span class="main">}</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> degree <span class="bound">x</span> <span class="main">≤</span> <span class="free">p</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> degree_Bernstein Bernstein_Poly_eq_rescale_01 degree_pcompose<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> degree <span class="bound">x</span> <span class="main">≤</span> <span class="free">p</span><span class="main">}</span> <span class="main">⊆</span> poly_vs.span <span class="main">{</span>Bernstein_Poly <span class="bound">x</span> <span class="free">p</span> <span class="free">c</span> <span class="free">d</span> <span class="main">|</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{..</span><span class="free">p</span><span class="main">}</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Bernstein_Poly_span1<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span>Bernstein_Poly <span class="bound">x</span> <span class="free">p</span> <span class="free">c</span> <span class="free">d</span> <span class="main">|</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{..</span><span class="free">p</span><span class="main">}</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span>Bernstein_Poly <span class="bound">x</span> <span class="free">p</span> <span class="free">c</span> <span class="free">d</span> <span class="main">|</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{..</span><span class="free">p</span><span class="main">}</span><span class="main">}</span> <span class="main">≤</span> poly_vs.dim <span class="main">{</span><span class="bound">x</span><span class="main">.</span> degree <span class="bound">x</span> <span class="main">≤</span> <span class="free">p</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> le_trans<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> image_Collect<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> card_image_le<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> dim_degree<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Bernstein coefficients and changes over any interval›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Bernstein_coeffs</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> real <span class="main">⇒</span> real <span class="main">⇒</span> real poly <span class="main">⇒</span> real list"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">Bernstein_coeffs</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">=</span> 
    <span class="main">[</span><span class="main">(</span>inverse <span class="main">(</span>real <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="keyword1">choose</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> 
      coeff <span class="main">(</span>reciprocal_poly <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">0</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">-</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">:]</span><span class="main">)</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">-</span><span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> 
     j <span class="main">←</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">]</span><span class="main">]</span>"</span></span>

<span class="keyword1" id="Bernstein-Bernstein_coeffs_eq_rescale"><span class="command">lemma</span></span> Bernstein_coeffs_eq_rescale<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">≠</span> <span class="free">d</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Bernstein_coeffs <span class="free">p</span> <span class="free">c</span> <span class="free">d</span> <span class="free">P</span> <span class="main">=</span> Bernstein_coeffs_01 <span class="free">p</span> <span class="main">(</span><span class="free">P</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="free">c</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">0</span><span class="main">,</span> <span class="free">d</span><span class="main">-</span><span class="free">c</span><span class="main">:]</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pcompose_pCons pcompose_assoc<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span>
                  Bernstein_coeffs_def Bernstein_coeffs_01_def<span class="main">)</span>

<span class="keyword1" id="Bernstein-nth_default_Bernstein_coeffs"><span class="command">lemma</span></span> nth_default_Bernstein_coeffs<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">P</span> <span class="main">≤</span> <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"nth_default <span class="main">0</span> <span class="main">(</span>Bernstein_coeffs <span class="free">p</span> <span class="free">c</span> <span class="free">d</span> <span class="free">P</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span>
         inverse <span class="main">(</span><span class="free">p</span> <span class="keyword1">choose</span> <span class="free">i</span><span class="main">)</span> <span class="main">*</span> coeff
         <span class="main">(</span>reciprocal_poly <span class="free">p</span> <span class="main">(</span><span class="free">P</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="free">c</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">0</span><span class="main">,</span> <span class="free">d</span><span class="main">-</span><span class="free">c</span><span class="main">:]</span><span class="main">)</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span> <span class="main">(</span><span class="free">p</span><span class="main">-</span><span class="free">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="free">i</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Bernstein_coeffs_def nth_default_append
                  nth_default_Cons Nitpick.case_nat_unfold binomial_eq_0<span class="main">)</span>

<span class="keyword1" id="Bernstein-Bernstein_coeffs_sum"><span class="command">lemma</span></span> Bernstein_coeffs_sum<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">≠</span> <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> hP<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">P</span> <span class="main">≤</span> <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">j</span> <span class="main">=</span> <span class="main">0</span><span class="main">..</span><span class="free">p</span><span class="main">.</span> smult <span class="main">(</span>nth_default <span class="main">0</span> <span class="main">(</span>Bernstein_coeffs <span class="free">p</span> <span class="free">c</span> <span class="free">d</span> <span class="free">P</span><span class="main">)</span> <span class="bound">j</span><span class="main">)</span>
         <span class="main">(</span>Bernstein_Poly <span class="bound">j</span> <span class="free">p</span> <span class="free">c</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> nth_default_Bernstein_coeffs<span class="main"><span class="main">[</span></span><span class="operator">OF</span> hP<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Bernstein_sum<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Bernstein_changes</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> real <span class="main">⇒</span> real <span class="main">⇒</span> real poly <span class="main">⇒</span> int"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Bernstein_changes</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">=</span> nat <span class="main">(</span>changes <span class="main">(</span>Bernstein_coeffs <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Bernstein-Bernstein_changes_eq_rescale"><span class="command">lemma</span></span> Bernstein_changes_eq_rescale<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">≠</span> <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">P</span> <span class="main">≤</span> <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Bernstein_changes <span class="free">p</span> <span class="free">c</span> <span class="free">d</span> <span class="free">P</span> <span class="main">=</span>
         Bernstein_changes_01 <span class="free">p</span> <span class="main">(</span><span class="free">P</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="free">c</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">0</span><span class="main">,</span> <span class="free">d</span><span class="main">-</span><span class="free">c</span><span class="main">:]</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Bernstein_coeffs_eq_rescale Bernstein_changes_def
                  Bernstein_changes_01_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This is related and mostly equivalent to previous Descartes test \cite{li2019counting}›</span></span>
<span class="keyword1" id="Bernstein-Bernstein_changes_test"><span class="command">lemma</span></span> Bernstein_changes_test<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">P</span><span class="main">::</span><span class="quoted"><span class="quoted">"real poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">P</span> <span class="main">≤</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">&lt;</span> <span class="free">d</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="free">P</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">d</span><span class="main">}</span> <span class="main">≤</span> Bernstein_changes <span class="free">p</span> <span class="free">c</span> <span class="free">d</span> <span class="free">P</span> <span class="main">∧</span>
        even <span class="main">(</span>Bernstein_changes <span class="free">p</span> <span class="free">c</span> <span class="free">d</span> <span class="free">P</span> <span class="main">-</span> proots_count <span class="free">P</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">d</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span><span class="main">=</span><span class="free">P</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="free">c</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">0</span><span class="main">,</span> <span class="free">d</span> <span class="main">-</span> <span class="free">c</span><span class="main">:]</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"int <span class="main">(</span>proots_count <span class="skolem">Q</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="main">1</span><span class="main">}</span><span class="main">)</span> 
          <span class="main">≤</span> Bernstein_changes_01 <span class="free">p</span> <span class="skolem">Q</span> <span class="main">∧</span>
              even <span class="main">(</span>Bernstein_changes_01 <span class="free">p</span> <span class="skolem">Q</span> <span class="main">-</span> 
                  int <span class="main">(</span>proots_count <span class="skolem">Q</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="main">1</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Q_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Bernstein_changes_01_test<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pcompose_eq_0<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="free">P</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">d</span><span class="main">}</span> <span class="main">=</span>
            proots_count <span class="skolem">Q</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Q_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> proots_pcompose<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">[:</span><span class="free">c</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">`</span> poly <span class="main">[:</span><span class="main">0</span><span class="main">,</span> <span class="free">d</span> <span class="main">-</span> <span class="free">c</span><span class="main">:]</span> <span class="main">`</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="main">1</span><span class="main">}</span> <span class="main">=</span>
        <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">d</span><span class="main">}</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">=</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">d</span> <span class="main">-</span> <span class="free">c</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">d</span> <span class="main">-</span> <span class="free">c</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">*</span> <span class="main">(</span><span class="free">d</span> <span class="main">-</span> <span class="free">c</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span> <span class="main">&lt;</span> <span class="free">d</span>›</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">⊆</span> <span class="var">?R</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?R</span> <span class="main">⊆</span> <span class="var">?L</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span><span class="main">::</span><span class="quoted">real</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="var">?R</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">&lt;</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&lt;</span> <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="var">?L</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> image_eqI<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> poly <span class="main">[:</span><span class="free">c</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="free">c</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">&lt;</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&lt;</span> <span class="free">d</span>"</span></span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">-</span> <span class="free">c</span> <span class="main">∈</span> poly <span class="main">[:</span><span class="main">0</span><span class="main">,</span> <span class="free">d</span> <span class="main">-</span> <span class="free">c</span><span class="main">:]</span> <span class="main">`</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="main">1</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> image_eqI<span class="main">)</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">-</span> <span class="free">c</span> <span class="main">=</span> poly <span class="main">[:</span><span class="main">0</span><span class="main">,</span> <span class="free">d</span> <span class="main">-</span> <span class="free">c</span><span class="main">:]</span> <span class="main">(</span><span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="free">c</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="free">d</span> <span class="main">-</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">&lt;</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&lt;</span> <span class="free">d</span>"</span></span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="free">c</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free">d</span> <span class="main">-</span> <span class="free">c</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="main">1</span><span class="main">}</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">qed</span></span> <span class="operator">fast</span>
        <span class="keyword1"><span class="command">qed</span></span> <span class="operator">fast</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="free">P</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">d</span><span class="main">}</span> <span class="main">=</span>
        proots_count <span class="main">(</span><span class="free">P</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="free">c</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span> 
        <span class="main">(</span>poly <span class="main">[:</span><span class="main">0</span><span class="main">,</span> <span class="free">d</span> <span class="main">-</span> <span class="free">c</span><span class="main">:]</span> <span class="main">`</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="main">1</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>proots_pcompose<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="free">c</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pcompose_eq_0 assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">[:</span><span class="main">0</span><span class="main">,</span> <span class="free">d</span> <span class="main">-</span> <span class="free">c</span><span class="main">:]</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" Bernstein_changes <span class="free">p</span> <span class="free">c</span> <span class="free">d</span> <span class="free">P</span> <span class="main">=</span> Bernstein_changes_01 <span class="free">p</span> <span class="skolem">Q</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Q_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Bernstein_changes_eq_rescale<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The control polygon of a polynomial›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">control_points</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> real <span class="main">⇒</span> real <span class="main">⇒</span> real poly <span class="main">⇒</span> <span class="main">(</span>real <span class="main">×</span> real<span class="main">)</span> list"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">control_points</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">=</span> 
   <span class="main">[</span><span class="main">(</span><span class="main">(</span><span class="main">(</span>real <span class="bound">i</span><span class="main">)</span><span class="main">*</span><span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">+</span> <span class="main">(</span>real <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">-</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span><span class="main">/</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">,</span> 
      nth_default <span class="main">0</span> <span class="main">(</span>Bernstein_coeffs <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="bound">i</span><span class="main">)</span><span class="main">.</span>
      i <span class="main">←</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">]</span><span class="main">]</span>"</span></span>

<span class="keyword1" id="Bernstein-line_above"><span class="command">lemma</span></span> line_above<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="free">d</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">P</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> hline<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">p</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span>real <span class="bound">i</span><span class="main">)</span><span class="main">*</span><span class="free">d</span> <span class="main">+</span> <span class="main">(</span>real <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="free">c</span><span class="main">)</span><span class="main">/</span><span class="free">p</span><span class="main">)</span> <span class="main">+</span> <span class="free">b</span> <span class="main">≥</span>
                  nth_default <span class="main">0</span> <span class="main">(</span>Bernstein_coeffs <span class="free">p</span> <span class="free">c</span> <span class="free">d</span> <span class="free">P</span><span class="main">)</span> <span class="bound">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> hp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> hcd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">≠</span> <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> hP<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">P</span> <span class="main">≤</span> <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">d</span> <span class="main">⟹</span> <span class="free">a</span><span class="main">*</span><span class="bound">x</span> <span class="main">+</span> <span class="free">b</span> <span class="main">≥</span> poly <span class="free">P</span> <span class="bound">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">assume</span></span> hc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>  hd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="free">d</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> bern_eq<span class="main">:</span><span class="quoted"><span class="quoted">"Bernstein_coeffs <span class="free">p</span> <span class="free">c</span> <span class="free">d</span> <span class="main">[:</span><span class="free">b</span><span class="main">,</span> <span class="free">a</span><span class="main">:]</span> <span class="main">=</span>
           <span class="main">[</span><span class="free">a</span><span class="main">*</span><span class="main">(</span>real <span class="bound">i</span> <span class="main">*</span> <span class="free">d</span> <span class="main">+</span> real <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> <span class="free">c</span><span class="main">)</span><span class="main">/</span><span class="free">p</span> <span class="main">+</span> <span class="free">b</span><span class="main">.</span> i <span class="main">←</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="main">(</span><span class="free">p</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">]</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Bernstein_coeffs <span class="free">p</span> <span class="free">c</span> <span class="free">d</span> <span class="main">[:</span><span class="free">b</span><span class="main">,</span> <span class="free">a</span><span class="main">:]</span> <span class="main">=</span> map <span class="main">(</span>nth_default <span class="main">0</span>
          <span class="main">(</span>Bernstein_coeffs_01 <span class="free">p</span> <span class="main">(</span><span class="main">[:</span><span class="free">b</span><span class="main">,</span> <span class="free">a</span><span class="main">:]</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="free">c</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">0</span><span class="main">,</span> <span class="free">d</span> <span class="main">-</span> <span class="free">c</span><span class="main">:]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
         <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">p</span><span class="main">+</span><span class="main">1</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Bernstein_coeffs_eq_rescale<span class="main"><span class="main">[</span></span><span class="quoted"><span class="operator">"OF"</span></span> hcd<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> map_nth_default<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> length_Bernstein_coeffs_01<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> 
      <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> map <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">a</span> <span class="main">*</span> <span class="main">(</span>real <span class="bound">i</span> <span class="main">*</span> <span class="free">d</span> <span class="main">+</span> real <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> <span class="free">c</span><span class="main">)</span> <span class="main">/</span> real <span class="free">p</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> map_cong<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> hx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nth_default <span class="main">0</span> <span class="main">(</span>Bernstein_coeffs_01 <span class="free">p</span>
            <span class="main">(</span><span class="main">[:</span><span class="free">b</span><span class="main">,</span> <span class="free">a</span><span class="main">:]</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="free">c</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">0</span><span class="main">,</span> <span class="free">d</span> <span class="main">-</span> <span class="free">c</span><span class="main">:]</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span>
            nth_default <span class="main">0</span> <span class="main">(</span>Bernstein_coeffs_01 <span class="free">p</span>
            <span class="main">(</span>smult <span class="main">(</span><span class="free">b</span> <span class="main">+</span> <span class="free">a</span><span class="main">*</span><span class="free">c</span><span class="main">)</span> <span class="main">1</span> <span class="main">+</span> smult <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="main">(</span><span class="free">d</span> <span class="main">-</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>monom <span class="main">1</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="free">b</span><span class="main">,</span> <span class="free">a</span><span class="main">:]</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="free">c</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">0</span><span class="main">,</span> <span class="free">d</span> <span class="main">-</span> <span class="free">c</span><span class="main">:]</span> <span class="main">=</span>
                  smult <span class="main">(</span><span class="free">b</span> <span class="main">+</span> <span class="free">a</span><span class="main">*</span><span class="free">c</span><span class="main">)</span> <span class="main">1</span> <span class="main">+</span> smult <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="main">(</span><span class="free">d</span> <span class="main">-</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>monom <span class="main">1</span> <span class="main">1</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> monom_altdef pcompose_pCons<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> 
          nth_default <span class="main">0</span> <span class="main">(</span>Bernstein_coeffs_01 <span class="free">p</span> <span class="main">(</span>smult <span class="main">(</span><span class="free">b</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="free">c</span><span class="main">)</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">+</span>
          nth_default <span class="main">0</span> <span class="main">(</span>Bernstein_coeffs_01 <span class="free">p</span> <span class="main">(</span>smult <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="main">(</span><span class="free">d</span> <span class="main">-</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>monom <span class="main">1</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Bernstein_coeffs_01_add<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> hp <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> degree_monom_eq<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span>  <span class="main">=</span>
            <span class="main">(</span><span class="free">b</span> <span class="main">+</span> <span class="free">a</span><span class="main">*</span><span class="free">c</span><span class="main">)</span> <span class="main">*</span> nth_default <span class="main">0</span> <span class="main">(</span>Bernstein_coeffs_01 <span class="free">p</span> <span class="main">1</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">+</span>
            <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="main">(</span><span class="free">d</span> <span class="main">-</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> nth_default <span class="main">0</span> <span class="main">(</span>Bernstein_coeffs_01 <span class="free">p</span> <span class="main">(</span>monom <span class="main">1</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Bernstein_coeffs_01_smult<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> hp <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Bernstein_coeffs_01_smult degree_monom_eq<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>
          <span class="main">(</span><span class="free">b</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="free">c</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">x</span> <span class="main">&lt;</span> <span class="free">p</span> <span class="main">+</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">+</span>
           <span class="free">a</span> <span class="main">*</span> <span class="main">(</span><span class="free">d</span> <span class="main">-</span> <span class="free">c</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>real <span class="main">(</span>nth_default <span class="main">0</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">]</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">/</span> real <span class="free">p</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Bernstein_coeffs_01_1<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> Bernstein_coeffs_01_x<span class="main"><span class="main">[</span></span><span class="operator">OF</span> hp<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> nth_default_replicate_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> nth_default_map_eq<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>
              <span class="main">(</span><span class="free">b</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="free">c</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">x</span> <span class="main">&lt;</span> <span class="free">p</span> <span class="main">+</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">+</span>
              <span class="free">a</span> <span class="main">*</span> <span class="main">(</span><span class="free">d</span> <span class="main">-</span> <span class="free">c</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>real <span class="main">(</span><span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">]</span> <span class="main">!</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">/</span> real <span class="free">p</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> nth_default_nth<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> hx <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">b</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="free">c</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">x</span> <span class="main">&lt;</span> <span class="free">p</span> <span class="main">+</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">+</span>
              <span class="free">a</span> <span class="main">*</span> <span class="main">(</span><span class="free">d</span> <span class="main">-</span> <span class="free">c</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>real <span class="main">(</span><span class="main">0</span> <span class="main">+</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">/</span> real <span class="free">p</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> nth_upt<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> hx <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">a</span> <span class="main">*</span> <span class="main">(</span>real <span class="skolem">x</span> <span class="main">*</span> <span class="free">d</span> <span class="main">+</span> real <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">*</span> <span class="free">c</span><span class="main">)</span> <span class="main">/</span> real <span class="free">p</span> <span class="main">+</span> <span class="free">b</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> of_nat_diff<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> hx hp <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"nth_default <span class="main">0</span> <span class="main">(</span>Bernstein_coeffs_01 <span class="free">p</span>
                    <span class="main">(</span><span class="main">[:</span><span class="free">b</span><span class="main">,</span> <span class="free">a</span><span class="main">:]</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="free">c</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">0</span><span class="main">,</span> <span class="free">d</span> <span class="main">-</span> <span class="free">c</span><span class="main">:]</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span>
                    <span class="free">a</span> <span class="main">*</span> <span class="main">(</span>real <span class="skolem">x</span> <span class="main">*</span> <span class="free">d</span> <span class="main">+</span> real <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">*</span> <span class="free">c</span><span class="main">)</span> <span class="main">/</span> real <span class="free">p</span> <span class="main">+</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> nth_default_geq<span class="main">:</span><span class="quoted"><span class="quoted">"nth_default <span class="main">0</span> <span class="main">(</span>Bernstein_coeffs <span class="free">p</span> <span class="free">c</span> <span class="free">d</span> <span class="main">[:</span><span class="free">b</span><span class="main">,</span> <span class="free">a</span><span class="main">:]</span><span class="main">)</span> <span class="skolem">i</span> <span class="main">≥</span>
           nth_default <span class="main">0</span> <span class="main">(</span>Bernstein_coeffs <span class="free">p</span> <span class="free">c</span> <span class="free">d</span> <span class="free">P</span><span class="main">)</span> <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"nth_default <span class="main">0</span> <span class="main">(</span>Bernstein_coeffs <span class="free">p</span> <span class="free">c</span> <span class="free">d</span> <span class="main">[:</span><span class="free">b</span><span class="main">,</span> <span class="free">a</span><span class="main">:]</span><span class="main">)</span> <span class="skolem">i</span> <span class="main">≥</span>
          nth_default <span class="main">0</span> <span class="main">(</span>Bernstein_coeffs <span class="free">p</span> <span class="free">c</span> <span class="free">d</span> <span class="free">P</span><span class="main">)</span> <span class="skolem">i</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">p1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p1</span> <span class="main">≡</span> <span class="free">p</span><span class="main">+</span><span class="main">1</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≤</span> <span class="free">p</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"nth_default <span class="main">0</span> <span class="main">(</span>Bernstein_coeffs <span class="free">p</span> <span class="free">c</span> <span class="free">d</span> <span class="free">P</span><span class="main">)</span> <span class="skolem">i</span> <span class="main">≤</span>
             <span class="free">a</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span>real <span class="skolem">i</span><span class="main">)</span><span class="main">*</span><span class="free">d</span> <span class="main">+</span> <span class="main">(</span>real <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="free">c</span><span class="main">)</span><span class="main">/</span><span class="free">p</span><span class="main">)</span> <span class="main">+</span> <span class="free">b</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> hline<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> nth_default <span class="main">0</span> <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">a</span> <span class="main">*</span> <span class="main">(</span>real <span class="bound">i</span> <span class="main">*</span> <span class="free">d</span> 
          <span class="main">+</span> real <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> <span class="free">c</span><span class="main">)</span> <span class="main">/</span> real <span class="free">p</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">]</span><span class="main">)</span> <span class="skolem">i</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> p1_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> h <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nth_default_def<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> p1_def<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> nth_default <span class="main">0</span> <span class="main">(</span>Bernstein_coeffs <span class="free">p</span> <span class="free">c</span> <span class="free">d</span> <span class="main">[:</span><span class="free">b</span><span class="main">,</span> <span class="free">a</span><span class="main">:]</span><span class="main">)</span> <span class="skolem">i</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> bern_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="skolem">i</span> <span class="main">≤</span> <span class="free">p</span>"</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> assms 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nth_default_def Bernstein_coeffs_eq_rescale
                        length_Bernstein_coeffs_01<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">P</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">=</span> <span class="main">0</span><span class="main">..</span><span class="free">p</span><span class="main">.</span>
        poly <span class="main">(</span>smult <span class="main">(</span>nth_default <span class="main">0</span> <span class="main">(</span>Bernstein_coeffs <span class="free">p</span> <span class="free">c</span> <span class="free">d</span> <span class="free">P</span><span class="main">)</span> <span class="bound">k</span><span class="main">)</span>
        <span class="main">(</span>Bernstein_Poly <span class="bound">k</span> <span class="free">p</span> <span class="free">c</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Bernstein_coeffs_sum<span class="main"><span class="main">[</span></span><span class="operator">OF</span> hcd hP<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> poly_sum<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span> <span class="main">=</span> <span class="main">0</span><span class="main">..</span><span class="free">p</span><span class="main">.</span>
      poly <span class="main">(</span>smult <span class="main">(</span>nth_default <span class="main">0</span> <span class="main">(</span>Bernstein_coeffs <span class="free">p</span> <span class="free">c</span> <span class="free">d</span> <span class="main">[:</span><span class="free">b</span><span class="main">,</span> <span class="free">a</span><span class="main">:]</span><span class="main">)</span> <span class="bound">k</span><span class="main">)</span>
        <span class="main">(</span>Bernstein_Poly <span class="bound">k</span> <span class="free">p</span> <span class="free">c</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sum_mono<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> mult_right_mono<span class="main">[</span><span class="operator">OF</span> nth_default_geq<span class="main">]</span> Bernstein_Poly_nonneg<span class="main">[</span><span class="operator">OF</span> hc hd<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> poly <span class="main">[:</span><span class="free">b</span><span class="main">,</span> <span class="free">a</span><span class="main">:]</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span><span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> Bernstein_coeffs_sum<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">c</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">d</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">[:</span></span><span class="free"><span class="free">b</span></span><span class="main"><span class="main">,</span></span> <span class="free"><span class="free">a</span></span><span class="main"><span class="main">:]</span></span>"</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">p</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>2<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> poly_sum<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">a</span><span class="main">*</span><span class="skolem">x</span> <span class="main">+</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">P</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="free">a</span><span class="main">*</span><span class="skolem">x</span> <span class="main">+</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Normal_Poly">
<div class="head">
<h1>Theory Normal_Poly</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Normal Polynomials›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Normal_Poly
  <span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="#RRI_Misc">RRI_Misc</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Here we define normal polynomials as defined in
  Basu, S., Pollack, R., Roy, M.-F.: Algorithms in Real Algebraic Geometry. 
  Springer Berlin Heidelberg, Berlin, Heidelberg (2016).
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">normal_poly</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>comm_ring_1<span class="main">,</span>ord<span class="main">}</span><span class="main">)</span> poly <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">normal_poly</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≡</span>
  <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">∧</span>
  <span class="main">(</span><span class="main">∀</span> <span class="bound">i</span><span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> coeff <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="bound">i</span><span class="main">)</span> <span class="main">∧</span>
  <span class="main">(</span><span class="main">∀</span> <span class="bound">i</span><span class="main">.</span> coeff <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="bound">i</span> <span class="main">*</span> coeff <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="numeral">2</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span>coeff <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">∧</span>
  <span class="main">(</span><span class="main">∀</span> <span class="bound">i</span> <span class="bound">j</span> <span class="bound">k</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≤</span> <span class="bound">j</span> <span class="main">⟶</span> <span class="bound">j</span> <span class="main">≤</span> <span class="bound">k</span> <span class="main">⟶</span> <span class="main">0</span> <span class="main">&lt;</span> coeff <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="bound">i</span> 
      <span class="main">⟶</span> <span class="main">0</span> <span class="main">&lt;</span> coeff <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="bound">k</span> <span class="main">⟶</span> <span class="main">0</span> <span class="main">&lt;</span> coeff <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="bound">j</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Normal_Poly-normal_non_zero"><span class="command">lemma</span></span> normal_non_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"normal_poly <span class="free">p</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> normal_poly_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Normal_Poly-normal_coeff_nonneg"><span class="command">lemma</span></span> normal_coeff_nonneg<span class="main">:</span> <span class="quoted"><span class="quoted">"normal_poly <span class="free">p</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">≤</span> coeff <span class="free">p</span> <span class="free">i</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> normal_poly_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword1" id="Normal_Poly-normal_poly_coeff_mult"><span class="command">lemma</span></span> normal_poly_coeff_mult<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"normal_poly <span class="free">p</span> <span class="main">⟹</span> coeff <span class="free">p</span> <span class="free">i</span> <span class="main">*</span> coeff <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="numeral">2</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span>coeff <span class="free">p</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> normal_poly_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Normal_Poly-normal_poly_pos_interval"><span class="command">lemma</span></span> normal_poly_pos_interval<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"normal_poly <span class="free">p</span> <span class="main">⟹</span> <span class="free">i</span> <span class="main">≤</span> <span class="free">j</span> <span class="main">⟹</span> <span class="free">j</span> <span class="main">≤</span> <span class="free">k</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">&lt;</span> coeff <span class="free">p</span> <span class="free">i</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">&lt;</span> coeff <span class="free">p</span> <span class="free">k</span> 
      <span class="main">⟹</span> <span class="main">0</span> <span class="main">&lt;</span> coeff <span class="free">p</span> <span class="free">j</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> normal_poly_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Normal_Poly-normal_polyI"><span class="command">lemma</span></span> normal_polyI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span> <span class="bound">i</span><span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> coeff <span class="free">p</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span> <span class="bound">i</span><span class="main">.</span> coeff <span class="free">p</span> <span class="bound">i</span> <span class="main">*</span> coeff <span class="free">p</span> <span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="numeral">2</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span>coeff <span class="free">p</span> <span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span> <span class="bound">i</span> <span class="bound">j</span> <span class="bound">k</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≤</span> <span class="bound">j</span> <span class="main">⟹</span> <span class="bound">j</span> <span class="main">≤</span> <span class="bound">k</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">&lt;</span> coeff <span class="free">p</span> <span class="bound">i</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">&lt;</span> coeff <span class="free">p</span> <span class="bound">k</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">&lt;</span> coeff <span class="free">p</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"normal_poly <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> normal_poly_def<span class="main">)</span>

<span class="keyword1" id="Normal_Poly-linear_normal_iff"><span class="command">lemma</span></span> linear_normal_iff<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span><span class="main">::</span><span class="quoted">real</span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"normal_poly <span class="main">[:</span><span class="main">-</span><span class="free">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">≤</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"normal_poly <span class="main">[:</span><span class="main">-</span><span class="free">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> normal_coeff_nonneg<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="main">-</span><span class="free">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span>"</span></span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> coeff <span class="main">[:</span><span class="main">-</span> <span class="free">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">i</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pCons_one<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> coeff <span class="main">[:</span><span class="main">-</span> <span class="free">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="skolem">j</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≤</span> <span class="skolem">j</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≤</span> <span class="skolem">k</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> coeff <span class="main">[:</span><span class="main">-</span> <span class="free">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="skolem">i</span>"</span></span> 
        <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> coeff <span class="main">[:</span><span class="main">-</span> <span class="free">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="skolem">k</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="skolem">k</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">=</span><span class="main">0</span> <span class="main">∨</span> <span class="skolem">i</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> that 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> bot_nat_0.extremum_uniqueI degree_pCons_eq_if 
          le_antisym le_degree not_less_eq_eq<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> that 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> One_nat_def degree_pCons_eq_if le_degree less_one
          not_le one_neq_zero pCons_one verit_la_disequality<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"normal_poly <span class="main">[:</span><span class="main">-</span><span class="free">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> normal_poly_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Normal_Poly-quadratic_normal_iff"><span class="command">lemma</span></span> quadratic_normal_iff<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">z</span><span class="main">::</span><span class="quoted">complex</span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"normal_poly <span class="main">[:</span><span class="main">(</span>cmod <span class="free">z</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">,</span> <span class="main">-</span><span class="numeral">2</span><span class="main">*</span>Re <span class="free">z</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> 
          <span class="main">⟷</span> Re <span class="free">z</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">∧</span> <span class="numeral">4</span><span class="main">*</span><span class="main">(</span>Re <span class="free">z</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">≥</span> <span class="main">(</span>cmod <span class="free">z</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"normal_poly <span class="main">[:</span><span class="main">(</span>cmod <span class="free">z</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">,</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> Re <span class="free">z</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="numeral">2</span><span class="main">*</span>Re <span class="free">z</span> <span class="main">≥</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">(</span>cmod <span class="free">z</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">≥</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">(</span><span class="main">-</span><span class="numeral">2</span><span class="main">*</span>Re <span class="free">z</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">≥</span> <span class="main">(</span>cmod <span class="free">z</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> normal_coeff_nonneg<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> normal_poly_coeff_mult<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">z</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">∧</span> <span class="numeral">4</span><span class="main">*</span><span class="main">(</span>Re <span class="free">z</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">≥</span> <span class="main">(</span>cmod <span class="free">z</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span><span class="quoted"><span class="quoted">"Re <span class="free">z</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">∧</span> <span class="numeral">4</span><span class="main">*</span><span class="main">(</span>Re <span class="free">z</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">≥</span> <span class="main">(</span>cmod <span class="free">z</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">P</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span><span class="main">=</span><span class="main">[:</span><span class="main">(</span>cmod <span class="free">z</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">,</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> Re <span class="free">z</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> coeff <span class="skolem">P</span> <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> 
    <span class="keyword1"><span class="command">unfolding</span></span> P_def <span class="keyword1"><span class="command">using</span></span> asm
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">=</span><span class="main">0</span><span class="main">∨</span><span class="skolem">i</span><span class="main">=</span><span class="main">1</span><span class="main">∨</span><span class="skolem">i</span><span class="main">=</span><span class="numeral">2</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>numeral_2_eq_2 coeff_eq_0<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coeff <span class="skolem">P</span> <span class="skolem">i</span> <span class="main">*</span> coeff <span class="skolem">P</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span>coeff <span class="skolem">P</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">=</span><span class="main">0</span><span class="main">∨</span><span class="skolem">i</span><span class="main">=</span><span class="main">1</span><span class="main">∨</span><span class="skolem">i</span><span class="main">=</span><span class="numeral">2</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> asm 
    <span class="keyword1"><span class="command">unfolding</span></span> P_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>coeff_eq_0<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> coeff <span class="skolem">P</span> <span class="skolem">j</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> coeff <span class="skolem">P</span> <span class="skolem">k</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> coeff <span class="skolem">P</span> <span class="skolem">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≤</span> <span class="skolem">k</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≤</span> <span class="skolem">j</span>"</span></span>
    <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="skolem">k</span>
    <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> P_def 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">=</span><span class="main">0</span> <span class="main">∨</span> <span class="skolem">k</span><span class="main">=</span><span class="main">1</span> <span class="main">∨</span> <span class="skolem">k</span><span class="main">=</span><span class="numeral">2</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> asm
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> One_nat_def Suc_1 bot_nat_0.extremum_uniqueI 
          coeff_pCons_0 coeff_pCons_Suc le_Suc_eq 
          zero_less_power2<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>coeff_eq_0<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> P_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"normal_poly <span class="skolem">P</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> normal_poly_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Normal_Poly-normal_of_no_zero_root"><span class="command">lemma</span></span> normal_of_no_zero_root<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span><span class="main">::</span><span class="quoted"><span class="quoted">"real poly"</span></span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> hzero<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="free">f</span> <span class="main">0</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> hdeg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≤</span> degree <span class="free">f</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> hnorm<span class="main">:</span> <span class="quoted"><span class="quoted">"normal_poly <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> coeff <span class="free">f</span> <span class="free">i</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coeff <span class="free">f</span> <span class="main">0</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hzero normal_coeff_nonneg<span class="main">[</span><span class="operator">OF</span> hnorm<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> eq_iff not_le_imp_less poly_0_coeff_0<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coeff <span class="free">f</span> <span class="main">(</span>degree <span class="free">f</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> normal_coeff_nonneg<span class="main">[</span><span class="operator">OF</span> hnorm<span class="main">]</span> normal_non_zero<span class="main">[</span><span class="operator">OF</span> hnorm<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> dual_order.irrefl eq_iff eq_zero_or_degree_less not_le_imp_less<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> coeff <span class="free">f</span> <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hdeg normal_poly_pos_interval<span class="main">[</span><span class="operator">OF</span> hnorm<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Normal_Poly-normal_divide_x"><span class="command">lemma</span></span> normal_divide_x<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span><span class="main">::</span><span class="quoted"><span class="quoted">"real poly"</span></span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> hnorm<span class="main">:</span> <span class="quoted"><span class="quoted">"normal_poly <span class="main">(</span><span class="free">f</span><span class="main">*</span><span class="main">[:</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"normal_poly <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> normal_polyI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> normal_non_zero<span class="main">[</span><span class="operator">OF</span> hnorm<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> coeff <span class="free">f</span> <span class="skolem">i</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> normal_coeff_nonneg<span class="main">[</span><span class="operator">OF</span> hnorm<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">i</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> coeff_pCons<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"coeff <span class="free">f</span> <span class="skolem">i</span> <span class="main">*</span> coeff <span class="free">f</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span>coeff <span class="free">f</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> normal_poly_coeff_mult<span class="main">[</span><span class="operator">OF</span> hnorm<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">i</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> coeff_pCons<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="skolem">k</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≤</span> <span class="skolem">j</span> <span class="main">⟹</span> <span class="skolem">j</span> <span class="main">≤</span> <span class="skolem">k</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">&lt;</span> coeff <span class="free">f</span> <span class="skolem">i</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">&lt;</span> coeff <span class="free">f</span> <span class="skolem">k</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">&lt;</span> coeff <span class="free">f</span> <span class="skolem">j</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> normal_poly_pos_interval<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">i</span>"</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">j</span>"</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">k</span>"</span></span><span class="main">,</span> <span class="operator">OF</span> hnorm<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> coeff_pCons<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Normal_Poly-normal_mult_x"><span class="command">lemma</span></span> normal_mult_x<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span><span class="main">::</span><span class="quoted"><span class="quoted">"real poly"</span></span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> hnorm<span class="main">:</span> <span class="quoted"><span class="quoted">"normal_poly <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"normal_poly <span class="main">(</span><span class="free">f</span> <span class="main">*</span> <span class="main">[:</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> normal_polyI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">*</span> <span class="main">[:</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> normal_non_zero<span class="main">[</span><span class="operator">OF</span> hnorm<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> coeff <span class="main">(</span><span class="free">f</span> <span class="main">*</span> <span class="main">[:</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span> <span class="skolem">i</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> normal_coeff_nonneg<span class="main">[</span><span class="operator">OF</span> hnorm<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">-</span><span class="main">1</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">i</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> coeff_pCons<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span><span class="free">f</span> <span class="main">*</span> <span class="main">[:</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span> <span class="skolem">i</span> <span class="main">*</span> coeff <span class="main">(</span><span class="free">f</span> <span class="main">*</span> <span class="main">[:</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span>coeff <span class="main">(</span><span class="free">f</span> <span class="main">*</span> <span class="main">[:</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> normal_poly_coeff_mult<span class="main">[</span><span class="operator">OF</span> hnorm<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">-</span><span class="main">1</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">i</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> coeff_pCons<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="skolem">k</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≤</span> <span class="skolem">j</span> <span class="main">⟹</span> <span class="skolem">j</span> <span class="main">≤</span> <span class="skolem">k</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">&lt;</span> coeff <span class="main">(</span><span class="free">f</span> <span class="main">*</span> <span class="main">[:</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span> <span class="skolem">i</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">&lt;</span> coeff <span class="main">(</span><span class="free">f</span> <span class="main">*</span> <span class="main">[:</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span> <span class="skolem">k</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">&lt;</span> coeff <span class="main">(</span><span class="free">f</span> <span class="main">*</span> <span class="main">[:</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span> <span class="skolem">j</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> normal_poly_pos_interval<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">-</span><span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span><span class="main">-</span><span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">-</span><span class="main">1</span>"</span></span><span class="main">,</span> <span class="operator">OF</span> hnorm<span class="main">]</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">i</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">j</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">k</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> coeff_pCons<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Normal_Poly-normal_poly_general_coeff_mult"><span class="command">lemma</span></span> normal_poly_general_coeff_mult<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span><span class="main">::</span><span class="quoted"><span class="quoted">"real poly"</span></span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"normal_poly <span class="free">f</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">≤</span> <span class="free">j</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"coeff <span class="free">f</span> <span class="main">(</span><span class="free">h</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> coeff <span class="free">f</span> <span class="main">(</span><span class="free">j</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">≥</span> coeff <span class="free">f</span> <span class="free">h</span> <span class="main">*</span> coeff <span class="free">f</span> <span class="main">(</span><span class="free">j</span><span class="main">+</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">j</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> normal_poly_coeff_mult <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> power2_eq_square<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">=</span> Suc <span class="skolem">j</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">=</span> Suc <span class="skolem">j</span>"</span></span> <span class="quoted"><span class="quoted">"normal_poly <span class="free">f</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> normal_poly_coeff_mult <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> power2_eq_square<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>normal_poly <span class="free">f</span> <span class="main">⟹</span>
       <span class="free">h</span> <span class="main">≤</span> <span class="skolem">j</span> <span class="main">⟹</span> coeff <span class="free">f</span> <span class="free">h</span> <span class="main">*</span> coeff <span class="free">f</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">≤</span> coeff <span class="free">f</span> <span class="main">(</span><span class="free">h</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> coeff <span class="free">f</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"normal_poly <span class="free">f</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">≤</span> Suc <span class="skolem">j</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">≠</span> Suc <span class="skolem">j</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> IH<span class="main">:</span> <span class="quoted"><span class="quoted">"coeff <span class="free">f</span> <span class="free">h</span> <span class="main">*</span> coeff <span class="free">f</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">≤</span> coeff <span class="free">f</span> <span class="main">(</span><span class="free">h</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> coeff <span class="free">f</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"coeff <span class="free">f</span> <span class="main">(</span>Suc <span class="skolem">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"coeff <span class="free">f</span> <span class="main">(</span>Suc <span class="skolem">j</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"coeff <span class="free">f</span> <span class="main">(</span>Suc <span class="skolem">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> coeff <span class="free">f</span> <span class="main">(</span>Suc <span class="skolem">j</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span>
        coeff <span class="free">f</span> <span class="free">h</span> <span class="main">*</span> coeff <span class="free">f</span> <span class="main">(</span>Suc <span class="skolem">j</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">≤</span> coeff <span class="free">f</span> <span class="main">(</span><span class="free">h</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> coeff <span class="free">f</span> <span class="main">(</span>Suc <span class="skolem">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> mult_zero_right normal_coeff_nonneg<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"coeff <span class="free">f</span> <span class="main">(</span>Suc <span class="skolem">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"coeff <span class="free">f</span> <span class="main">(</span>Suc <span class="skolem">j</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"coeff <span class="free">f</span> <span class="main">(</span>Suc <span class="skolem">j</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>coeff <span class="free">f</span> <span class="main">(</span>Suc <span class="skolem">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> normal_coeff_nonneg<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">j</span> <span class="main">+</span> <span class="numeral">2</span>"</span></span><span class="main">]</span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"coeff <span class="free">f</span> <span class="free">h</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> False"</span></span>
        <span class="keyword1"><span class="command">using</span></span> normal_poly_pos_interval<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">h</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">j</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">j</span> <span class="main">+</span> <span class="numeral">2</span>"</span></span><span class="main">]</span> assms<span class="main">(</span>1<span class="main">)</span> h <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"coeff <span class="free">f</span> <span class="free">h</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> normal_coeff_nonneg<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> less_eq_real_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"coeff <span class="free">f</span> <span class="free">h</span> <span class="main">*</span> coeff <span class="free">f</span> <span class="main">(</span>Suc <span class="skolem">j</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">≤</span> coeff <span class="free">f</span> <span class="main">(</span><span class="free">h</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> coeff <span class="free">f</span> <span class="main">(</span>Suc <span class="skolem">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"coeff <span class="free">f</span> <span class="main">(</span>Suc <span class="skolem">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"coeff <span class="free">f</span> <span class="free">h</span> <span class="main">*</span> coeff <span class="free">f</span> <span class="main">(</span>Suc <span class="skolem">j</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">≤</span> coeff <span class="free">f</span> <span class="main">(</span><span class="free">h</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> coeff <span class="free">f</span> <span class="main">(</span>Suc <span class="skolem">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"coeff <span class="free">f</span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"coeff <span class="free">f</span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"coeff <span class="free">f</span> <span class="main">(</span>Suc <span class="skolem">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>coeff <span class="free">f</span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> normal_coeff_nonneg<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">j</span> <span class="main">+</span> <span class="main">1</span>"</span></span><span class="main">]</span> assms<span class="main">(</span>1<span class="main">)</span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"coeff <span class="free">f</span> <span class="free">h</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> False"</span></span>
          <span class="keyword1"><span class="command">using</span></span> normal_poly_pos_interval<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">h</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">j</span>"</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">j</span> <span class="main">+</span> <span class="main">1</span>"</span></span><span class="main">]</span> assms<span class="main">(</span>1<span class="main">)</span> h <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"coeff <span class="free">f</span> <span class="free">h</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> normal_coeff_nonneg<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> less_eq_real_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"coeff <span class="free">f</span> <span class="free">h</span> <span class="main">*</span> coeff <span class="free">f</span> <span class="main">(</span>Suc <span class="skolem">j</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">≤</span> coeff <span class="free">f</span> <span class="main">(</span><span class="free">h</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> coeff <span class="free">f</span> <span class="main">(</span>Suc <span class="skolem">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> normal_coeff_nonneg<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"coeff <span class="free">f</span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> normal_poly_coeff_mult<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">j</span>"</span></span><span class="main">]</span> normal_coeff_nonneg<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">j</span>"</span></span><span class="main">]</span>
          normal_coeff_nonneg<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span>"</span></span><span class="main">]</span> 1 2 
        <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"coeff <span class="free">f</span> <span class="main">(</span>Suc <span class="skolem">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> coeff <span class="free">f</span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span> <span class="main">≥</span> coeff <span class="free">f</span> <span class="main">(</span>Suc <span class="skolem">j</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">/</span> coeff <span class="free">f</span> <span class="main">(</span>Suc <span class="skolem">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> power2_eq_square <span class="dynamic"><span class="dynamic">divide_simps</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>coeff <span class="free">f</span> <span class="free">h</span> <span class="main">*</span> coeff <span class="free">f</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>coeff <span class="free">f</span> <span class="main">(</span>Suc <span class="skolem">j</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">/</span> coeff <span class="free">f</span> <span class="main">(</span>Suc <span class="skolem">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span>coeff <span class="free">f</span> <span class="main">(</span><span class="free">h</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> coeff <span class="free">f</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>coeff <span class="free">f</span> <span class="main">(</span>Suc <span class="skolem">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> coeff <span class="free">f</span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> mult_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> IH<span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> 3 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> normal_coeff_nonneg<span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"coeff <span class="free">f</span> <span class="free">h</span> <span class="main">*</span> coeff <span class="free">f</span> <span class="main">(</span>Suc <span class="skolem">j</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">≤</span> coeff <span class="free">f</span> <span class="main">(</span><span class="free">h</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> coeff <span class="free">f</span> <span class="main">(</span>Suc <span class="skolem">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> 1 2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Normal_Poly-normal_mult"><span class="command">lemma</span></span> normal_mult<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="free">g</span><span class="main">::</span><span class="quoted"><span class="quoted">"real poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> hf<span class="main">:</span> <span class="quoted"><span class="quoted">"normal_poly <span class="free">f</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> hg<span class="main">:</span> <span class="quoted"><span class="quoted">"normal_poly <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">df</span> <span class="main">≡</span> degree <span class="free">f</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">dg</span> <span class="main">≡</span> degree <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"normal_poly <span class="main">(</span><span class="free">f</span><span class="main">*</span><span class="free">g</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> df_def hf <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">df</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">f</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We shall first show that without loss of generality we may assume <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>poly f 0 ≠ 0›</span></span></span></span>,
      this is done by induction on the degree, if 0 is a root then we derive the result from <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>f/[:0,1:]›</span></span></span></span>.›</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span><span class="main">::</span><span class="quoted"><span class="quoted">"real poly"</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span><span class="main">::</span><span class="quoted">nat</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">=</span> degree <span class="skolem">f</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> hf<span class="main">:</span> <span class="quoted"><span class="quoted">"normal_poly <span class="skolem">f</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> <span class="main">[:</span><span class="skolem">a</span><span class="main">:]</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> degree_0_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"normal_poly <span class="main">(</span><span class="skolem">f</span><span class="main">*</span><span class="free">g</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> normal_polyI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> normal_non_zero<span class="main">[</span><span class="operator">OF</span> hf<span class="main">]</span> normal_non_zero<span class="main">[</span><span class="operator">OF</span> hg<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> 
      <span class="keyword1"><span class="command">using</span></span> normal_coeff_nonneg<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="main">0</span></span><span class="main">,</span> <span class="operator">OF</span> hf<span class="main">]</span> normal_coeff_nonneg<span class="main">[</span><span class="operator">OF</span> hg<span class="main">]</span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> 
      <span class="keyword1"><span class="command">using</span></span> normal_coeff_nonneg<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="main">0</span></span><span class="main">,</span> <span class="operator">OF</span> hf<span class="main">]</span> normal_poly_coeff_mult<span class="main">[</span><span class="operator">OF</span> hg<span class="main">]</span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> power2_eq_square mult_left_mono<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> 
      <span class="keyword1"><span class="command">using</span></span> normal_non_zero<span class="main">[</span><span class="operator">OF</span> hf<span class="main">]</span> normal_coeff_nonneg<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="main">0</span></span><span class="main">,</span> <span class="operator">OF</span> hf<span class="main">]</span> normal_poly_pos_interval<span class="main">[</span><span class="operator">OF</span> hg<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zero_less_mult_iff<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">df</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"poly <span class="skolem">f</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">f</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> hf<span class="main">:</span><span class="quoted"><span class="quoted">"normal_poly <span class="skolem">f</span>"</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f'</span></span> <span class="keyword2"><span class="keyword">where</span></span> hdiv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> <span class="skolem">f'</span><span class="main">*</span><span class="main">[:</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">)</span></span> dvdE mult.commute poly_eq_0_iff_dvd<span class="main">)</span> 
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> hf'<span class="main">:</span> <span class="quoted"><span class="quoted">"normal_poly <span class="skolem">f'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> normal_divide_x <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">df</span> <span class="main">=</span> degree <span class="skolem">f</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">f'</span> <span class="main">=</span> <span class="skolem">df</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hdiv normal_non_zero<span class="main">[</span><span class="operator">OF</span> hf'<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> degree_mult_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">f</span><span class="main">.</span> <span class="skolem">df</span> <span class="main">=</span> degree <span class="bound">f</span> <span class="main">⟹</span> normal_poly <span class="bound">f</span> <span class="main">⟹</span> normal_poly <span class="main">(</span><span class="bound">f</span> <span class="main">*</span> <span class="free">g</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"normal_poly <span class="main">(</span><span class="skolem">f'</span><span class="main">*</span><span class="free">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hf' <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"normal_poly <span class="main">(</span><span class="skolem">f</span><span class="main">*</span><span class="free">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hdiv normal_mult_x <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> hf<span class="main">:</span> <span class="quoted"><span class="quoted">"normal_poly <span class="skolem">f</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> hf0<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="skolem">f</span> <span class="main">0</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">dg</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">dg</span> <span class="main">≡</span> degree <span class="free">g</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"normal_poly <span class="main">(</span><span class="skolem">f</span> <span class="main">*</span> <span class="free">g</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> dg_def hg <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">dg</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">g</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Similarly we may assume <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>poly g 0 ≠ 0›</span></span></span></span>.›</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">g</span><span class="main">::</span><span class="quoted"><span class="quoted">"real poly"</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span><span class="main">::</span><span class="quoted">nat</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">=</span> degree <span class="skolem">g</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> hg<span class="main">:</span> <span class="quoted"><span class="quoted">"normal_poly <span class="skolem">g</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> <span class="main">[:</span><span class="skolem">a</span><span class="main">:]</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> degree_0_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"normal_poly <span class="main">(</span><span class="skolem">f</span><span class="main">*</span><span class="skolem">g</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> normal_polyI<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> 
          <span class="keyword1"><span class="command">using</span></span> normal_non_zero<span class="main">[</span><span class="operator">OF</span> hg<span class="main">]</span> normal_non_zero<span class="main">[</span><span class="operator">OF</span> hf<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> 
          <span class="keyword1"><span class="command">using</span></span> normal_coeff_nonneg<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="main">0</span></span><span class="main">,</span> <span class="operator">OF</span> hg<span class="main">]</span> normal_coeff_nonneg<span class="main">[</span><span class="operator">OF</span> hf<span class="main">]</span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> 
          <span class="keyword1"><span class="command">using</span></span> normal_coeff_nonneg<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="main">0</span></span><span class="main">,</span> <span class="operator">OF</span> hg<span class="main">]</span> normal_poly_coeff_mult<span class="main">[</span><span class="operator">OF</span> hf<span class="main">]</span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> power2_eq_square mult_left_mono<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> 
          <span class="keyword1"><span class="command">using</span></span> normal_non_zero<span class="main">[</span><span class="operator">OF</span> hf<span class="main">]</span> normal_coeff_nonneg<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="main">0</span></span><span class="main">,</span> <span class="operator">OF</span> hg<span class="main">]</span> 
            normal_poly_pos_interval<span class="main">[</span><span class="operator">OF</span> hf<span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zero_less_mult_iff<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">dg</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"poly <span class="skolem">g</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">g</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> hg<span class="main">:</span><span class="quoted"><span class="quoted">"normal_poly <span class="skolem">g</span>"</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g'</span></span> <span class="keyword2"><span class="keyword">where</span></span> hdiv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> <span class="skolem">g'</span><span class="main">*</span><span class="main">[:</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">)</span></span> dvdE mult.commute poly_eq_0_iff_dvd<span class="main">)</span> 
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> hg'<span class="main">:</span> <span class="quoted"><span class="quoted">"normal_poly <span class="skolem">g'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> normal_divide_x <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">dg</span> <span class="main">=</span> degree <span class="skolem">g</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">g'</span> <span class="main">=</span> <span class="skolem">dg</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hdiv normal_non_zero<span class="main">[</span><span class="operator">OF</span> hg'<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> degree_mult_eq<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">g</span><span class="main">.</span> <span class="skolem">dg</span> <span class="main">=</span> degree <span class="bound">g</span> <span class="main">⟹</span> normal_poly <span class="bound">g</span> <span class="main">⟹</span> normal_poly <span class="main">(</span><span class="skolem">f</span> <span class="main">*</span> <span class="bound">g</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"normal_poly <span class="main">(</span><span class="skolem">f</span><span class="main">*</span><span class="skolem">g'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hg' <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"normal_poly <span class="main">(</span><span class="skolem">f</span><span class="main">*</span><span class="skolem">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hdiv normal_mult_x <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹It now remains to show that $(fg)_i \geq 0$. This follows by decomposing $\{(h, j) \in
              \mathbf{Z}^2 | h &gt; j\} = \{(h, j) \in \mathbf{Z}^2 | h \leq j\} \cup \{(h, h - 1) \in 
              \mathbf{Z}^2 | h \in \mathbf{Z}\}$.
              Note in order to avoid working with infinite sums over integers all these sets are
              bounded, which adds some complexity compared to the proof of lemma 2.55 in
              Basu, S., Pollack, R., Roy, M.-F.: Algorithms in Real Algebraic Geometry.
              Springer Berlin Heidelberg, Berlin, Heidelberg (2016).›</span></span>
        <span class="keyword3"><span class="command">assume</span></span> hg0<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="skolem">g</span> <span class="main">0</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> hg<span class="main">:</span> <span class="quoted"><span class="quoted">"normal_poly <span class="skolem">g</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">*</span> <span class="skolem">g</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hf hg <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> normal_non_zero Suc.prems<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> coeff <span class="main">(</span><span class="skolem">f</span><span class="main">*</span><span class="skolem">g</span><span class="main">)</span> <span class="bound">i</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> coeff_mult<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> sum_nonneg<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> mult_nonneg_nonneg<span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> normal_coeff_nonneg<span class="main">[</span><span class="operator">OF</span> hf<span class="main">]</span> normal_coeff_nonneg<span class="main">[</span><span class="operator">OF</span> hg<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"
          coeff <span class="main">(</span><span class="skolem">f</span><span class="main">*</span><span class="skolem">g</span><span class="main">)</span> <span class="skolem">i</span> <span class="main">*</span> coeff <span class="main">(</span><span class="skolem">f</span><span class="main">*</span><span class="skolem">g</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">+</span><span class="numeral">2</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span>coeff <span class="main">(</span><span class="skolem">f</span><span class="main">*</span><span class="skolem">g</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>

          <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹$(fg)_{i+1}^2 - (fg)_i(fg)_{i+2} = \left(\sum_x f_xg_{i+1-x}\right)^2 - 
                \left(\sum_x f_xg_{i+2-x}\right)\left(\sum_x f_xg_{i-x}\right)$›</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>coeff <span class="main">(</span><span class="skolem">f</span><span class="main">*</span><span class="skolem">g</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">-</span> coeff <span class="main">(</span><span class="skolem">f</span><span class="main">*</span><span class="skolem">g</span><span class="main">)</span> <span class="skolem">i</span> <span class="main">*</span> coeff <span class="main">(</span><span class="skolem">f</span><span class="main">*</span><span class="skolem">g</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span><span class="main">+</span><span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> 
              <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">≤</span><span class="skolem">i</span><span class="main">+</span><span class="main">1</span><span class="main">.</span> coeff <span class="skolem">f</span> <span class="bound">x</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span>
              <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">≤</span><span class="skolem">i</span><span class="main">+</span><span class="main">1</span><span class="main">.</span> coeff <span class="skolem">f</span> <span class="bound">x</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span>
              <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">≤</span><span class="skolem">i</span><span class="main">+</span><span class="numeral">2</span><span class="main">.</span> coeff <span class="skolem">f</span> <span class="bound">x</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span>
              <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">≤</span><span class="skolem">i</span><span class="main">.</span> coeff <span class="skolem">f</span> <span class="bound">x</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> coeff_mult power2_eq_square <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
          
          <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹$\dots = \sum_{x, y} f_xg_{i+1-x}f_yg_{i+1-y} - \sum_{x, y} f_xg_{i+2-x}f_yg_{i-y}$›</span></span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>
              <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">≤</span><span class="skolem">i</span><span class="main">+</span><span class="main">1</span><span class="main">.</span> <span class="main">∑</span><span class="bound">y</span><span class="main">≤</span><span class="skolem">i</span><span class="main">+</span><span class="main">1</span><span class="main">.</span> coeff <span class="skolem">f</span> <span class="bound">x</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span>
                                  coeff <span class="skolem">f</span> <span class="bound">y</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span>
              <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">≤</span><span class="skolem">i</span><span class="main">+</span><span class="numeral">2</span><span class="main">.</span> <span class="main">∑</span><span class="bound">y</span><span class="main">≤</span><span class="skolem">i</span><span class="main">.</span> coeff <span class="skolem">f</span> <span class="bound">x</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span>
                                coeff <span class="skolem">f</span> <span class="bound">y</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum_product<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> sum_product<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>

          <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹$\dots = \sum_{h \leq j} f_hg_{i+1-h}f_jg_{i+1-j} + \sum_{h&gt;j} f_hg_{i+1-h}f_jg_{i+1-j}
                       - \sum_{h \leq j} f_hg_{i+2-h}f_jg_{i-j} - \sum_{h&gt;j} f_hg_{i+2-h}f_jg_{i-j}$›</span></span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>
              <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="skolem">i</span><span class="main">+</span><span class="main">1</span> <span class="main">≥</span> <span class="bound">j</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">≥</span> <span class="bound">h</span><span class="main">}</span><span class="main">.</span> 
                coeff <span class="skolem">f</span> <span class="bound">h</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="bound">j</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>
              <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="skolem">i</span><span class="main">+</span><span class="main">1</span> <span class="main">≥</span> <span class="bound">h</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">&gt;</span> <span class="bound">j</span><span class="main">}</span><span class="main">.</span> 
                coeff <span class="skolem">f</span> <span class="bound">h</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="bound">j</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span>
             <span class="main">(</span><span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="skolem">i</span> <span class="main">≥</span> <span class="bound">j</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">≥</span> <span class="bound">h</span><span class="main">}</span><span class="main">.</span> 
                coeff <span class="skolem">f</span> <span class="bound">h</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="bound">j</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>
              <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="skolem">i</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">≥</span> <span class="bound">h</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">&gt;</span> <span class="bound">j</span> <span class="main">∧</span> <span class="skolem">i</span> <span class="main">≥</span> <span class="bound">j</span><span class="main">}</span><span class="main">.</span>
                coeff <span class="skolem">f</span> <span class="bound">h</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="bound">j</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">≤</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">.</span> <span class="main">∑</span><span class="bound">y</span><span class="main">≤</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">.</span> coeff <span class="skolem">f</span> <span class="bound">x</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="bound">y</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
              <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span><span class="main">}</span><span class="main">.</span>
                 coeff <span class="skolem">f</span> <span class="bound">h</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="bound">j</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>
              <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">h</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="bound">h</span><span class="main">}</span><span class="main">.</span>
                 coeff <span class="skolem">f</span> <span class="bound">h</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="bound">j</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> sum.union_disjoint<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
              <span class="keyword1"><span class="command">have</span></span> H<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{..</span><span class="skolem">i</span><span class="main">+</span><span class="main">1</span><span class="main">}</span> <span class="main">×</span> <span class="main">{..</span><span class="skolem">i</span><span class="main">+</span><span class="main">1</span><span class="main">}</span>"</span></span>
                     <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">h</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="bound">h</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{..</span><span class="skolem">i</span><span class="main">+</span><span class="main">1</span><span class="main">}</span> <span class="main">×</span> <span class="main">{..</span><span class="skolem">i</span><span class="main">+</span><span class="main">1</span><span class="main">}</span>"</span></span>
                     <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="main">{..</span><span class="skolem">i</span><span class="main">+</span><span class="main">1</span><span class="main">}</span> <span class="main">×</span> <span class="main">{..</span><span class="skolem">i</span><span class="main">+</span><span class="main">1</span><span class="main">}</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">fastforce</span><span class="main">)</span>
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span><span class="main">}</span>"</span></span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> H <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">h</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="bound">h</span><span class="main">}</span>"</span></span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> H <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span><span class="main">}</span> <span class="main">∩</span> <span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">h</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="bound">h</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">≤</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">.</span> <span class="main">∑</span><span class="bound">y</span><span class="main">≤</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">.</span> coeff <span class="skolem">f</span> <span class="bound">x</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="bound">y</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
                  <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">h</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="bound">h</span><span class="main">}</span><span class="main">.</span>
                    coeff <span class="skolem">f</span> <span class="bound">h</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="bound">j</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> sum.cartesian_product<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> sum.cong<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">≤</span><span class="skolem">i</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">.</span> <span class="main">∑</span><span class="bound">y</span><span class="main">≤</span><span class="skolem">i</span><span class="main">.</span> coeff <span class="skolem">f</span> <span class="bound">x</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="bound">y</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
               <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span><span class="main">}</span><span class="main">.</span>
                  coeff <span class="skolem">f</span> <span class="bound">h</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="bound">j</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>
               <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="skolem">i</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">≥</span> <span class="bound">h</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">&gt;</span> <span class="bound">j</span> <span class="main">∧</span> <span class="skolem">i</span> <span class="main">≥</span> <span class="bound">j</span><span class="main">}</span><span class="main">.</span>
                  coeff <span class="skolem">f</span> <span class="bound">h</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="bound">j</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> sum.union_disjoint<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
              <span class="keyword1"><span class="command">have</span></span> H<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{..</span><span class="skolem">i</span><span class="main">+</span><span class="numeral">2</span><span class="main">}</span> <span class="main">×</span> <span class="main">{..</span><span class="skolem">i</span><span class="main">}</span>"</span></span>
                     <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="skolem">i</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">≥</span> <span class="bound">h</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">&gt;</span> <span class="bound">j</span> <span class="main">∧</span> <span class="skolem">i</span> <span class="main">≥</span> <span class="bound">j</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{..</span><span class="skolem">i</span><span class="main">+</span><span class="numeral">2</span><span class="main">}</span> <span class="main">×</span> <span class="main">{..</span><span class="skolem">i</span><span class="main">}</span>"</span></span>
                     <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="main">{..</span><span class="skolem">i</span><span class="main">+</span><span class="numeral">2</span><span class="main">}</span> <span class="main">×</span> <span class="main">{..</span><span class="skolem">i</span><span class="main">}</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">fastforce</span><span class="main">)</span>
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span><span class="main">}</span>"</span></span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> H <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="skolem">i</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">≥</span> <span class="bound">h</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">&gt;</span> <span class="bound">j</span> <span class="main">∧</span> <span class="skolem">i</span> <span class="main">≥</span> <span class="bound">j</span><span class="main">}</span>"</span></span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> H <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span><span class="main">}</span> <span class="main">∩</span> <span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="skolem">i</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">≥</span> <span class="bound">h</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">&gt;</span> <span class="bound">j</span> <span class="main">∧</span> <span class="skolem">i</span> <span class="main">≥</span> <span class="bound">j</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">≤</span><span class="skolem">i</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">.</span> <span class="main">∑</span><span class="bound">y</span><span class="main">≤</span><span class="skolem">i</span><span class="main">.</span> coeff <span class="skolem">f</span> <span class="bound">x</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="bound">y</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
                  <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="skolem">i</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">≥</span> <span class="bound">h</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">&gt;</span> <span class="bound">j</span> <span class="main">∧</span> <span class="skolem">i</span> <span class="main">≥</span> <span class="bound">j</span><span class="main">}</span><span class="main">.</span>
                     coeff <span class="skolem">f</span> <span class="bound">h</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="bound">j</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> sum.cartesian_product<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> sum.cong<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
          <span class="keyword1"><span class="command">qed</span></span>

          <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹$\dots = \sum_{h \leq j} f_hg_{i+1-h}f_jg_{i+1-j} + \sum_{h \leq j} f_{j+1}g_{i-j}f_{h-2}g_{i+2-h} 
                       + \sum_h f_hg_{i+1-h}f_{h-1}g_{i+2-h} - \sum_{h \leq j} f_hg_{i+2-h}f_jg_{i-j}
                       - \sum_{h \leq j} f_{j+1}g_{i+1-j}f_{h-2}g_{i+1-h} - \sum_h f_hg_{i+2-h}f_{h-1}g_{i+1-h}$›</span></span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>
              <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span><span class="main">}</span><span class="main">.</span>
                 coeff <span class="skolem">f</span> <span class="bound">h</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="bound">j</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>
              <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">h</span><span class="main">}</span><span class="main">.</span>
                 coeff <span class="skolem">f</span> <span class="main">(</span><span class="bound">j</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="main">(</span><span class="bound">h</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>
              <span class="main">(</span><span class="main">∑</span><span class="bound">h</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="skolem">i</span><span class="main">+</span><span class="main">1</span><span class="main">}</span><span class="main">.</span>
                 coeff <span class="skolem">f</span> <span class="bound">h</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="main">(</span><span class="bound">h</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span>
              <span class="main">(</span><span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span><span class="main">}</span><span class="main">.</span>
                  coeff <span class="skolem">f</span> <span class="bound">h</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="bound">j</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>
               <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">h</span><span class="main">}</span><span class="main">.</span>
                  coeff <span class="skolem">f</span> <span class="main">(</span><span class="bound">j</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="main">(</span><span class="bound">h</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>
               <span class="main">(</span><span class="main">∑</span><span class="bound">h</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="skolem">i</span><span class="main">+</span><span class="main">1</span><span class="main">}</span><span class="main">.</span>
                  coeff <span class="skolem">f</span> <span class="bound">h</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="main">(</span><span class="bound">h</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">h</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="bound">h</span><span class="main">}</span><span class="main">.</span>
                   coeff <span class="skolem">f</span> <span class="bound">h</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="bound">j</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
                  <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">h</span><span class="main">}</span><span class="main">.</span>
                   coeff <span class="skolem">f</span> <span class="main">(</span><span class="bound">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="main">(</span><span class="bound">h</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>
                  <span class="main">(</span><span class="main">∑</span><span class="bound">h</span> <span class="main">=</span> <span class="main">1</span><span class="main">..</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">.</span> coeff <span class="skolem">f</span> <span class="bound">h</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="main">(</span><span class="bound">h</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
              <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">h</span><span class="main">}</span><span class="main">.</span>
                     coeff <span class="skolem">f</span> <span class="main">(</span><span class="bound">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="main">(</span><span class="bound">h</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
                    <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">h</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="bound">h</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≠</span> <span class="bound">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">}</span><span class="main">.</span>
                     coeff <span class="skolem">f</span> <span class="bound">h</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="bound">j</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum.reindex_cong<span class="main">)</span>
                <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">h</span><span class="main">}</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">j</span><span class="main">+</span><span class="main">1</span><span class="main">,</span> <span class="bound">h</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">h</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="bound">h</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≠</span> <span class="bound">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">}</span>"</span></span>
                <span class="keyword1"><span class="command">proof</span></span>
                  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">,</span> <span class="bound">h</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">h</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="bound">h</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≠</span> <span class="bound">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">h</span><span class="main">}</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
                  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">h</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">,</span> <span class="bound">h</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">h</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="bound">h</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≠</span> <span class="bound">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">}</span>"</span></span>
                  <span class="keyword1"><span class="command">proof</span></span>
                    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
                    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">h</span><span class="main">}</span>"</span></span>
                    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≤</span> <span class="skolem">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">≤</span> <span class="skolem">j</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">h</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="skolem">h</span> <span class="main">-</span> <span class="main">1</span> <span class="main">&lt;</span> <span class="skolem">j</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="skolem">j</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≠</span> <span class="skolem">h</span> <span class="main">-</span> <span class="main">1</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="skolem">h</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">,</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">,</span> <span class="bound">h</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">h</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="bound">h</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≠</span> <span class="bound">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">}</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> image_iff<span class="main">)</span>
                  <span class="keyword1"><span class="command">qed</span></span>
                <span class="keyword1"><span class="command">qed</span></span>
                <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">,</span> <span class="bound">h</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">h</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="bound">h</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≠</span> <span class="bound">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">}</span>"</span></span>
                <span class="keyword1"><span class="command">proof</span></span>
                  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span><span class="main">::</span><span class="quoted"><span class="quoted">"nat<span class="main">×</span>nat"</span></span>
                  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">h</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="bound">h</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≠</span> <span class="bound">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">h</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="bound">h</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≠</span> <span class="bound">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">}</span>"</span></span>
                  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">case</span> <span class="skolem">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="bound">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">,</span> <span class="bound">h</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="skolem">y</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="bound">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">,</span> <span class="bound">h</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">qed</span></span>
                <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">h</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="bound">h</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≠</span> <span class="bound">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">}</span> <span class="main">⟹</span>
                 <span class="main">(</span><span class="keyword1">case</span> <span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="bound">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">,</span> <span class="bound">h</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">of</span>
                  <span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span> <span class="main">⇒</span> coeff <span class="skolem">f</span> <span class="main">(</span><span class="bound">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="main">(</span><span class="bound">h</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
                 <span class="main">(</span><span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span> <span class="main">⇒</span> coeff <span class="skolem">f</span> <span class="bound">h</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="bound">j</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
              <span class="keyword1"><span class="command">qed</span></span>
              <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">h</span> <span class="main">=</span> <span class="main">1</span><span class="main">..</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">.</span> coeff <span class="skolem">f</span> <span class="bound">h</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="main">(</span><span class="bound">h</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
                    <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">h</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="bound">h</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">=</span> <span class="bound">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">}</span><span class="main">.</span>
                     coeff <span class="skolem">f</span> <span class="bound">h</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="bound">j</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum.reindex_cong<span class="main">)</span>
                <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">}</span> <span class="main">=</span> fst <span class="main">`</span> <span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">h</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="bound">h</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">=</span> <span class="bound">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">}</span>"</span></span>
                <span class="keyword1"><span class="command">proof</span></span>
                  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">}</span> <span class="main">⊆</span> fst <span class="main">`</span> <span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">h</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="bound">h</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">=</span> <span class="bound">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">}</span>"</span></span>
                  <span class="keyword1"><span class="command">proof</span></span>
                    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
                    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">}</span>"</span></span>
                    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">-</span> <span class="main">1</span> <span class="main">&lt;</span> <span class="skolem">x</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">-</span> <span class="main">1</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">=</span> fst <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">x</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> fst <span class="main">`</span> <span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">h</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="bound">h</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">=</span> <span class="bound">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">}</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                  <span class="keyword1"><span class="command">qed</span></span>
                  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> <span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">h</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="bound">h</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">=</span> <span class="bound">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">}</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
                <span class="keyword1"><span class="command">qed</span></span>
                <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inj_on fst <span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">h</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="bound">h</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">=</span> <span class="bound">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">}</span>"</span></span>
                <span class="keyword1"><span class="command">proof</span></span>
                  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
                  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">h</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="bound">h</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">=</span> <span class="bound">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">}</span>"</span></span>
                         <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">h</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="bound">h</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">=</span> <span class="bound">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">}</span>"</span></span>
                  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span>fst <span class="skolem">x</span><span class="main">,</span> fst <span class="skolem">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="main">(</span>fst <span class="skolem">y</span><span class="main">,</span> fst <span class="skolem">y</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"fst <span class="skolem">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"fst <span class="skolem">y</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"fst <span class="skolem">x</span> <span class="main">=</span> fst <span class="skolem">y</span> <span class="main">⟹</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
                <span class="keyword1"><span class="command">qed</span></span>
                <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">h</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="bound">h</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">=</span> <span class="bound">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">}</span> <span class="main">⟹</span>
                   coeff <span class="skolem">f</span> <span class="main">(</span>fst <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> fst <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="main">(</span>fst <span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">-</span> fst <span class="bound">x</span><span class="main">)</span> <span class="main">=</span>
                   <span class="main">(</span><span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span> <span class="main">⇒</span> coeff <span class="skolem">f</span> <span class="bound">h</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="bound">j</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
              <span class="keyword1"><span class="command">qed</span></span>
              <span class="keyword1"><span class="command">have</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">h</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="bound">h</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≠</span> <span class="bound">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="skolem">i</span><span class="main">+</span><span class="main">1</span><span class="main">}</span><span class="main">×</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="skolem">i</span><span class="main">+</span><span class="main">1</span><span class="main">}</span>"</span></span>
                      <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">h</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="bound">h</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">=</span> <span class="bound">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="skolem">i</span><span class="main">+</span><span class="main">1</span><span class="main">}</span><span class="main">×</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="skolem">i</span><span class="main">+</span><span class="main">1</span><span class="main">}</span>"</span></span>
                      <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="skolem">i</span><span class="main">+</span><span class="main">1</span><span class="main">}</span><span class="main">×</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="skolem">i</span><span class="main">+</span><span class="main">1</span><span class="main">}</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">fastforce</span><span class="main">)</span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">h</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="bound">h</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≠</span> <span class="bound">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">}</span>"</span></span>
                   <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">h</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="bound">h</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">=</span> <span class="bound">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">}</span>"</span></span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> H <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> H <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
              <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> 1<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> 2<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> sum.union_disjoint<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
                   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>3<span class="main"><span class="keyword3">]</span></span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sum.cong<span class="main">)</span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">h</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="bound">h</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">≤</span> <span class="skolem">i</span><span class="main">}</span><span class="main">.</span>
                  coeff <span class="skolem">f</span> <span class="bound">h</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="bound">j</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
               <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">h</span><span class="main">}</span><span class="main">.</span>
                  coeff <span class="skolem">f</span> <span class="main">(</span><span class="bound">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="main">(</span><span class="bound">h</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>
               <span class="main">(</span><span class="main">∑</span><span class="bound">h</span> <span class="main">=</span> <span class="main">1</span><span class="main">..</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">.</span> coeff <span class="skolem">f</span> <span class="bound">h</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="main">(</span><span class="bound">h</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
              <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">h</span><span class="main">}</span><span class="main">.</span>
                     coeff <span class="skolem">f</span> <span class="main">(</span><span class="bound">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="main">(</span><span class="bound">h</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
                    <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">h</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="bound">h</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≠</span> <span class="bound">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">}</span><span class="main">.</span>
                     coeff <span class="skolem">f</span> <span class="bound">h</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="bound">j</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum.reindex_cong<span class="main">)</span>
                <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">h</span><span class="main">}</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">j</span><span class="main">+</span><span class="main">1</span><span class="main">,</span> <span class="bound">h</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">h</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="bound">h</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≠</span> <span class="bound">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">}</span>"</span></span>
                <span class="keyword1"><span class="command">proof</span></span>
                  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">,</span> <span class="bound">h</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">h</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="bound">h</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≠</span> <span class="bound">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">h</span><span class="main">}</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
                  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">h</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">,</span> <span class="bound">h</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">h</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="bound">h</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≠</span> <span class="bound">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">}</span>"</span></span>
                  <span class="keyword1"><span class="command">proof</span></span>
                    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
                    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">h</span><span class="main">}</span>"</span></span>
                    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">≤</span> <span class="skolem">j</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">h</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">∧</span> <span class="skolem">h</span> <span class="main">-</span> <span class="main">1</span> <span class="main">&lt;</span> <span class="skolem">j</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="skolem">h</span> <span class="main">-</span> <span class="main">1</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">∧</span> <span class="skolem">j</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≠</span> <span class="skolem">h</span> <span class="main">-</span> <span class="main">1</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="skolem">h</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">,</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">,</span> <span class="bound">h</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">h</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="bound">h</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≠</span> <span class="bound">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">}</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> image_iff<span class="main">)</span>
                  <span class="keyword1"><span class="command">qed</span></span>
                <span class="keyword1"><span class="command">qed</span></span>
                <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">,</span> <span class="bound">h</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">h</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="bound">h</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≠</span> <span class="bound">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">}</span>"</span></span>
                <span class="keyword1"><span class="command">proof</span></span>
                  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span><span class="main">::</span><span class="quoted"><span class="quoted">"nat<span class="main">×</span>nat"</span></span>
                  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">h</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="bound">h</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≠</span> <span class="bound">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">h</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="bound">h</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≠</span> <span class="bound">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">}</span>"</span></span>
                  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">case</span> <span class="skolem">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="bound">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">,</span> <span class="bound">h</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="skolem">y</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="bound">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">,</span> <span class="bound">h</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">qed</span></span>
                <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">h</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="bound">h</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≠</span> <span class="bound">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">}</span> <span class="main">⟹</span>
                   <span class="main">(</span><span class="keyword1">case</span> <span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="bound">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">,</span> <span class="bound">h</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">of</span>
                    <span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span> <span class="main">⇒</span> coeff <span class="skolem">f</span> <span class="main">(</span><span class="bound">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="main">(</span><span class="bound">h</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
                   <span class="main">(</span><span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span> <span class="main">⇒</span> coeff <span class="skolem">f</span> <span class="bound">h</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="bound">j</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
              <span class="keyword1"><span class="command">qed</span></span>
              <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">h</span> <span class="main">=</span> <span class="main">1</span><span class="main">..</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">.</span> coeff <span class="skolem">f</span> <span class="bound">h</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="main">(</span><span class="bound">h</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
                    <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">h</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="bound">h</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">=</span> <span class="bound">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">}</span><span class="main">.</span>
                     coeff <span class="skolem">f</span> <span class="bound">h</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="bound">j</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum.reindex_cong<span class="main">)</span>
                <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">}</span> <span class="main">=</span> fst <span class="main">`</span> <span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">h</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="bound">h</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">=</span> <span class="bound">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">}</span>"</span></span>
                <span class="keyword1"><span class="command">proof</span></span>
                  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">}</span> <span class="main">⊆</span> fst <span class="main">`</span> <span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">h</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="bound">h</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">=</span> <span class="bound">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">}</span>"</span></span>
                  <span class="keyword1"><span class="command">proof</span></span>
                    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
                    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">}</span>"</span></span>
                    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">-</span> <span class="main">1</span> <span class="main">&lt;</span> <span class="skolem">x</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">-</span> <span class="main">1</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">-</span> <span class="main">1</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">=</span> fst <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">x</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> fst <span class="main">`</span> <span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">h</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="bound">h</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">=</span> <span class="bound">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">}</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                  <span class="keyword1"><span class="command">qed</span></span>
                  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> <span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">h</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="bound">h</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">=</span> <span class="bound">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">}</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
                <span class="keyword1"><span class="command">qed</span></span>
                <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inj_on fst <span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">h</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="bound">h</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">=</span> <span class="bound">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">}</span>"</span></span>
                <span class="keyword1"><span class="command">proof</span></span>
                  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
                  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">h</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="bound">h</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">=</span> <span class="bound">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">}</span>"</span></span>
                         <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">h</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="bound">h</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">=</span> <span class="bound">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">}</span>"</span></span>
                  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span>fst <span class="skolem">x</span><span class="main">,</span> fst <span class="skolem">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="main">(</span>fst <span class="skolem">y</span><span class="main">,</span> fst <span class="skolem">y</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"fst <span class="skolem">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"fst <span class="skolem">y</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"fst <span class="skolem">x</span> <span class="main">=</span> fst <span class="skolem">y</span> <span class="main">⟹</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
                <span class="keyword1"><span class="command">qed</span></span>
                <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">h</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="bound">h</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">=</span> <span class="bound">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">}</span> <span class="main">⟹</span>
                   coeff <span class="skolem">f</span> <span class="main">(</span>fst <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">-</span> fst <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="main">(</span>fst <span class="bound">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> fst <span class="bound">x</span><span class="main">)</span> <span class="main">=</span>
                   <span class="main">(</span><span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span> <span class="main">⇒</span> coeff <span class="skolem">f</span> <span class="bound">h</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="bound">j</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
              <span class="keyword1"><span class="command">qed</span></span>
              <span class="keyword1"><span class="command">have</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">h</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="bound">h</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≠</span> <span class="bound">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="skolem">i</span><span class="main">+</span><span class="numeral">2</span><span class="main">}</span><span class="main">×</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="skolem">i</span><span class="main">}</span>"</span></span>
                      <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">h</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="bound">h</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">=</span> <span class="bound">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="skolem">i</span><span class="main">+</span><span class="numeral">2</span><span class="main">}</span><span class="main">×</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="skolem">i</span><span class="main">}</span>"</span></span>
                      <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="skolem">i</span><span class="main">+</span><span class="numeral">2</span><span class="main">}</span><span class="main">×</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="skolem">i</span><span class="main">}</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">fastforce</span><span class="main">)</span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">h</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="bound">h</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≠</span> <span class="bound">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">}</span>"</span></span>
                   <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">h</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="bound">h</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">=</span> <span class="bound">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">}</span>"</span></span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> H <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> H <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
              <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> 1<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> 2<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> sum.union_disjoint<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
                   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>3<span class="main"><span class="keyword3">]</span></span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sum.cong<span class="main">)</span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">algebra</span>
          <span class="keyword1"><span class="command">qed</span></span>

          <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹$\dots = \sum_{h \leq j} f_hf_j\left(g_{i+1-h}g_{i+1-j} - g_{i+2-h}g_{i-j}\right) + 
                         \sum_{h \leq j} f_{j+1}f_{h-1}\left(g_{i-j}g_{i+2-h} - g_{i+1-j}f_jg_{i+1-h}\right)$

                Note we have to also consider the edge cases caused by making these sums finite.›</span></span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>
              <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">=</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span><span class="main">}</span><span class="main">.</span>
                 coeff <span class="skolem">f</span> <span class="bound">h</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="bound">j</span> <span class="main">*</span> <span class="main">(</span>coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>
              <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span><span class="main">}</span><span class="main">.</span>
                 coeff <span class="skolem">f</span> <span class="bound">h</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="bound">j</span> <span class="main">*</span> <span class="main">(</span>coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span> <span class="main">-</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>
              <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">h</span><span class="main">}</span><span class="main">.</span>
                 coeff <span class="skolem">f</span> <span class="main">(</span><span class="bound">j</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="main">(</span><span class="bound">h</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span> <span class="main">-</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span>
              <span class="main">(</span><span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">=</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">h</span><span class="main">}</span><span class="main">.</span>
                  coeff <span class="skolem">f</span> <span class="main">(</span><span class="bound">j</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="main">(</span><span class="bound">h</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">=</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?R</span> <span class="main">=</span> 
              <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">=</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span><span class="main">}</span><span class="main">.</span>
                 coeff <span class="skolem">f</span> <span class="bound">h</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="bound">j</span> <span class="main">*</span> <span class="main">(</span>coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>
              <span class="main">(</span><span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span><span class="main">}</span><span class="main">.</span>
                 coeff <span class="skolem">f</span> <span class="bound">h</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="bound">j</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span>
              <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span><span class="main">}</span><span class="main">.</span>
                 coeff <span class="skolem">f</span> <span class="bound">h</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="bound">j</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>
              <span class="main">(</span><span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">h</span><span class="main">}</span><span class="main">.</span>
                 coeff <span class="skolem">f</span> <span class="main">(</span><span class="bound">j</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="main">(</span><span class="bound">h</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> 
              <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">h</span><span class="main">}</span><span class="main">.</span>
                 coeff <span class="skolem">f</span> <span class="main">(</span><span class="bound">j</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="main">(</span><span class="bound">h</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span>
              <span class="main">(</span><span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">=</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">h</span><span class="main">}</span><span class="main">.</span>
                  coeff <span class="skolem">f</span> <span class="main">(</span><span class="bound">j</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="main">(</span><span class="bound">h</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> sum_subtractf<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> sum_subtractf<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> split_beta<span class="main">)</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>
                <span class="main">(</span><span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">=</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span><span class="main">}</span><span class="main">.</span>
                   coeff <span class="skolem">f</span> <span class="bound">h</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="bound">j</span> <span class="main">*</span> <span class="main">(</span>coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>
                <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span><span class="main">}</span><span class="main">.</span>
                   coeff <span class="skolem">f</span> <span class="bound">h</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="bound">j</span> <span class="main">*</span> <span class="main">(</span>coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span>
                 <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span><span class="main">}</span><span class="main">.</span>
                    coeff <span class="skolem">f</span> <span class="bound">h</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="bound">j</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>
                <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">h</span><span class="main">}</span><span class="main">.</span>
                    coeff <span class="skolem">f</span> <span class="main">(</span><span class="bound">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="main">(</span><span class="bound">h</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span>
                <span class="main">(</span><span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">h</span><span class="main">}</span><span class="main">.</span>
                   coeff <span class="skolem">f</span> <span class="main">(</span><span class="bound">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="main">(</span><span class="bound">h</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>
                <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">=</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">h</span><span class="main">}</span><span class="main">.</span>
                   coeff <span class="skolem">f</span> <span class="main">(</span><span class="bound">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="main">(</span><span class="bound">h</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?L</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">=</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span><span class="main">}</span><span class="main">.</span>
                       coeff <span class="skolem">f</span> <span class="bound">h</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="bound">j</span> <span class="main">*</span> <span class="main">(</span>coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>
                    <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span><span class="main">}</span><span class="main">.</span>
                       coeff <span class="skolem">f</span> <span class="bound">h</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="bound">j</span> <span class="main">*</span> <span class="main">(</span>coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
                    <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span><span class="main">}</span><span class="main">.</span>
                       coeff <span class="skolem">f</span> <span class="bound">h</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="bound">j</span> <span class="main">*</span> <span class="main">(</span>coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> sum.union_disjoint<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
                <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">=</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{..</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">}</span> <span class="main">×</span> <span class="main">{..</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">}</span>"</span></span>
                     <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{..</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">}</span> <span class="main">×</span> <span class="main">{..</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">}</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">fastforce</span><span class="main">)</span>
                <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">=</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span><span class="main">}</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> finite_subset<span class="main">)</span>
                <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">=</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span><span class="main">}</span> <span class="main">∩</span> <span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
              <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">rule</span> sum.cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
              <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">h</span><span class="main">}</span><span class="main">.</span>
                    coeff <span class="skolem">f</span> <span class="main">(</span><span class="bound">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="main">(</span><span class="bound">h</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>
                 <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">=</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">h</span><span class="main">}</span><span class="main">.</span>
                    coeff <span class="skolem">f</span> <span class="main">(</span><span class="bound">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="main">(</span><span class="bound">h</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
                 <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">h</span><span class="main">}</span><span class="main">.</span>
                    coeff <span class="skolem">f</span> <span class="main">(</span><span class="bound">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="main">(</span><span class="bound">h</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> sum.union_disjoint<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
                <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">h</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{..</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">}</span> <span class="main">×</span> <span class="main">{..</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">}</span>"</span></span>
                     <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">=</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">h</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{..</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">}</span> <span class="main">×</span> <span class="main">{..</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">}</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">fastforce</span><span class="main">)</span>
                <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">h</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">=</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">h</span><span class="main">}</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> finite_subset<span class="main">)</span>
                <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">h</span><span class="main">}</span> <span class="main">∩</span> <span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">=</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">h</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
              <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">rule</span> sum.cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
              <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
          <span class="keyword1"><span class="command">qed</span></span>

          <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹$\dots = \sum_{h \leq j} \left(f_hf_j - f_{j+1}f_{h-1}\right)
                                         \left(g_{i+1-h}g_{i+1-j} - g_{i+2-h}g_{i-j}\right)$›</span></span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> 
              <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">h</span><span class="main">}</span><span class="main">.</span>
                 <span class="main">-</span><span class="main">(</span>coeff <span class="skolem">f</span> <span class="bound">h</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="bound">j</span> <span class="main">-</span> coeff <span class="skolem">f</span> <span class="main">(</span><span class="bound">j</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="main">(</span><span class="bound">h</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span> <span class="main">-</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>
              <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span><span class="main">.</span>
                 coeff <span class="skolem">f</span> <span class="bound">h</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="bound">j</span> <span class="main">*</span> <span class="main">(</span>coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span> <span class="main">-</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>
              <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">=</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span><span class="main">}</span><span class="main">.</span>
                 coeff <span class="skolem">f</span> <span class="bound">h</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="bound">j</span> <span class="main">*</span> <span class="main">(</span>coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span>
              <span class="main">(</span><span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">=</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">h</span><span class="main">}</span><span class="main">.</span>
                  coeff <span class="skolem">f</span> <span class="main">(</span><span class="bound">j</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="main">(</span><span class="bound">h</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">=</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span><span class="main">}</span><span class="main">.</span>
               coeff <span class="skolem">f</span> <span class="bound">h</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="bound">j</span> <span class="main">*</span>
               <span class="main">(</span>coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span> <span class="main">-</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
             <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">h</span><span class="main">}</span><span class="main">.</span>
               coeff <span class="skolem">f</span> <span class="bound">h</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="bound">j</span> <span class="main">*</span>
               <span class="main">(</span>coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span> <span class="main">-</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>
             <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">=</span> <span class="bound">h</span><span class="main">}</span><span class="main">.</span>
               coeff <span class="skolem">f</span> <span class="bound">h</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="bound">j</span> <span class="main">*</span>
               <span class="main">(</span>coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span> <span class="main">-</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> sum.union_disjoint<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">h</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{..</span><span class="skolem">i</span><span class="main">}</span><span class="main">×</span><span class="main">{..</span><span class="skolem">i</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">=</span> <span class="bound">h</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{..</span><span class="skolem">i</span><span class="main">}</span><span class="main">×</span><span class="main">{..</span><span class="skolem">i</span><span class="main">}</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span>
              <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">h</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">=</span> <span class="bound">h</span><span class="main">}</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> finite_subset<span class="main">)</span>
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">h</span><span class="main">}</span> <span class="main">∩</span> <span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">=</span> <span class="bound">h</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
            <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">rule</span> sum.cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
            
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">h</span><span class="main">}</span><span class="main">.</span>
               <span class="main">(</span><span class="main">-</span>coeff <span class="skolem">f</span> <span class="bound">h</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="bound">j</span> <span class="main">+</span> coeff <span class="skolem">f</span> <span class="main">(</span><span class="bound">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="main">(</span><span class="bound">h</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span>
               <span class="main">(</span>coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span> <span class="main">-</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
                <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">h</span><span class="main">}</span><span class="main">.</span>
                   coeff <span class="skolem">f</span> <span class="bound">h</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="bound">j</span> <span class="main">*</span> <span class="main">(</span>coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span> <span class="main">-</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>
                <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">h</span><span class="main">}</span><span class="main">.</span>
                   coeff <span class="skolem">f</span> <span class="main">(</span><span class="bound">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="main">(</span><span class="bound">h</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span>
                   <span class="main">(</span>coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span> <span class="main">-</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum.distrib<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> sum.cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">fast</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>

            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span>

          <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹$\dots \geq 0$ by <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>normal_poly_general_coeff_mult›</span></span></span></span>›</span></span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">h</span><span class="main">}</span><span class="main">.</span>
                        <span class="main">-</span> <span class="main">(</span>coeff <span class="skolem">f</span> <span class="bound">h</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="bound">j</span> <span class="main">-</span> coeff <span class="skolem">f</span> <span class="main">(</span><span class="bound">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="main">(</span><span class="bound">h</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span>
                        <span class="main">(</span>coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span> <span class="main">-</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum_nonneg<span class="main">)</span>
              <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">h</span><span class="main">}</span>"</span></span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≤</span> <span class="skolem">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">≤</span> <span class="skolem">j</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">h</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">-</span> <span class="main">1</span> <span class="main">≤</span> <span class="skolem">j</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
              <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"coeff <span class="skolem">f</span> <span class="skolem">h</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="skolem">j</span> <span class="main">-</span> coeff <span class="skolem">f</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="main">(</span><span class="skolem">h</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> normal_poly_general_coeff_mult<span class="main">[</span><span class="operator">OF</span> hf<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span><span class="main">-</span><span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span><span class="main">-</span><span class="main">1</span>"</span></span><span class="main">]</span> H
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
              <span class="keyword1"><span class="command">from</span></span> H <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">-</span> <span class="skolem">j</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">-</span> <span class="skolem">h</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
              <span class="keyword1"><span class="command">hence</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">-</span> <span class="skolem">h</span><span class="main">)</span> <span class="main">-</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="skolem">h</span><span class="main">)</span> <span class="main">≤</span> <span class="main">0</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> normal_poly_general_coeff_mult<span class="main">[</span><span class="operator">OF</span> hg<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">-</span> <span class="skolem">j</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">-</span> <span class="skolem">h</span>"</span></span><span class="main">]</span> H
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> del_insts<span class="main"><span class="main">)</span></span> Nat.add_diff_assoc2 le_trans<span class="main">)</span>
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="main">(</span><span class="keyword1">case</span> <span class="skolem">x</span> <span class="keyword1">of</span>
               <span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span> <span class="main">⇒</span>
                 <span class="main">-</span> <span class="main">(</span>coeff <span class="skolem">f</span> <span class="bound">h</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="bound">j</span> <span class="main">-</span> coeff <span class="skolem">f</span> <span class="main">(</span><span class="bound">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="main">(</span><span class="bound">h</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span>
                 <span class="main">(</span>coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span> <span class="main">-</span>
                  coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> H<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> split<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> mult_nonpos_nonpos<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> neg_le_0_iff_le<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span><span class="main">.</span>
                        coeff <span class="skolem">f</span> <span class="bound">h</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="bound">j</span> <span class="main">*</span>
                        <span class="main">(</span>coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span> <span class="main">-</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum_nonneg<span class="main">)</span>
              <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≤</span> <span class="skolem">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">≤</span> <span class="skolem">j</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
              <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"coeff <span class="skolem">f</span> <span class="skolem">h</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="skolem">j</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hf normal_coeff_nonneg<span class="main">)</span>
              <span class="keyword1"><span class="command">from</span></span> H <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">-</span> <span class="skolem">j</span> <span class="main">≤</span> <span class="skolem">i</span> <span class="main">-</span> <span class="skolem">h</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
              <span class="keyword1"><span class="command">hence</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">-</span> <span class="skolem">h</span><span class="main">)</span> <span class="main">-</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="skolem">h</span><span class="main">)</span> <span class="main">≤</span> <span class="main">0</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> normal_poly_general_coeff_mult<span class="main">[</span><span class="operator">OF</span> hg<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">-</span> <span class="skolem">j</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">-</span> <span class="skolem">h</span>"</span></span><span class="main">]</span> H
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> del_insts<span class="main"><span class="main">)</span></span> Nat.add_diff_assoc2 le_trans<span class="main">)</span>
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="main">(</span><span class="keyword1">case</span> <span class="skolem">x</span> <span class="keyword1">of</span>
               <span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span> <span class="main">⇒</span>
                 coeff <span class="skolem">f</span> <span class="bound">h</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="bound">j</span> <span class="main">*</span>
                 <span class="main">(</span>coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span> <span class="main">-</span>
                  coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> H<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> split<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> mult_nonneg_nonneg<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">=</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span><span class="main">}</span><span class="main">.</span> coeff <span class="skolem">f</span> <span class="bound">h</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="bound">j</span> <span class="main">*</span> <span class="main">(</span>coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span>
                 <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">=</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">h</span><span class="main">}</span><span class="main">.</span>
                    coeff <span class="skolem">f</span> <span class="main">(</span><span class="bound">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="main">(</span><span class="bound">h</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">=</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span><span class="main">}</span><span class="main">.</span> coeff <span class="skolem">f</span> <span class="bound">h</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="bound">j</span> <span class="main">*</span> <span class="main">(</span>coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span>
                 <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">=</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">h</span><span class="main">}</span><span class="main">.</span>
                    coeff <span class="skolem">f</span> <span class="main">(</span><span class="bound">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="main">(</span><span class="bound">h</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
                 <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">=</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span><span class="main">.</span> coeff <span class="skolem">f</span> <span class="bound">h</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="bound">j</span> <span class="main">*</span> <span class="main">(</span>coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>
                 <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">=</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">h</span><span class="main">}</span><span class="main">.</span> coeff <span class="skolem">f</span> <span class="bound">h</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="bound">j</span> <span class="main">*</span> <span class="main">(</span>coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span>
                 <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">=</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">h</span><span class="main">}</span><span class="main">.</span>
                    coeff <span class="skolem">f</span> <span class="main">(</span><span class="bound">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="main">(</span><span class="bound">h</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> sum.union_disjoint<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
                <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">=</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">}</span>"</span></span>
                     <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">=</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">h</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="skolem">i</span><span class="main">+</span><span class="main">1</span><span class="main">}</span> <span class="main">×</span> <span class="main">{</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">}</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span>
                <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">=</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
                     <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">=</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">h</span><span class="main">}</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">=</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">∩</span> <span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">=</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">h</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> 
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
                <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">=</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">=</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">h</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">=</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span><span class="main">}</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
                <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">=</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span><span class="main">}</span><span class="main">.</span> coeff <span class="skolem">f</span> <span class="bound">h</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="bound">j</span> <span class="main">*</span> <span class="main">(</span>coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span>
                      <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">=</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">h</span><span class="main">}</span><span class="main">.</span>
                         coeff <span class="skolem">f</span> <span class="main">(</span><span class="bound">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="main">(</span><span class="bound">h</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
                      <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">=</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">=</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">h</span><span class="main">}</span><span class="main">.</span>
                         coeff <span class="skolem">f</span> <span class="bound">h</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="bound">j</span> <span class="main">*</span> <span class="main">(</span>coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span>
                      <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">=</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">h</span><span class="main">}</span><span class="main">.</span>
                         coeff <span class="skolem">f</span> <span class="main">(</span><span class="bound">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="main">(</span><span class="bound">h</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
              <span class="keyword1"><span class="command">qed</span></span>
              <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>
                <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">=</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span><span class="main">.</span> coeff <span class="skolem">f</span> <span class="bound">h</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="bound">j</span> <span class="main">*</span> <span class="main">(</span>coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>
                <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">=</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">h</span><span class="main">}</span><span class="main">.</span> 
                   <span class="main">(</span>coeff <span class="skolem">f</span> <span class="bound">h</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="bound">j</span> <span class="main">-</span> coeff <span class="skolem">f</span> <span class="main">(</span><span class="bound">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="main">(</span><span class="bound">h</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> add_diff_eq<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> sum_subtractf<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> add_left_cancel<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> sum.cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
              <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
              <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> add_nonneg_nonneg<span class="main">)</span>
                <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">=</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">h</span><span class="main">}</span><span class="main">.</span>
                        <span class="main">(</span>coeff <span class="skolem">f</span> <span class="bound">h</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="bound">j</span> <span class="main">-</span> coeff <span class="skolem">f</span> <span class="main">(</span><span class="bound">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="main">(</span><span class="bound">h</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span>
                        <span class="main">(</span>coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum_nonneg<span class="main">)</span>
                  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">j</span> <span class="main">=</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">h</span> <span class="main">≤</span> <span class="bound">j</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">h</span><span class="main">}</span>"</span></span>
                  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">h</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">=</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">≤</span> <span class="skolem">j</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">h</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
                  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">-</span> <span class="main">1</span> <span class="main">≤</span> <span class="skolem">j</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
                  <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"coeff <span class="skolem">f</span> <span class="skolem">h</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="skolem">j</span> <span class="main">-</span> coeff <span class="skolem">f</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="main">(</span><span class="skolem">h</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> normal_poly_general_coeff_mult<span class="main">[</span><span class="operator">OF</span> hf<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span><span class="main">-</span><span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span><span class="main">-</span><span class="main">1</span>"</span></span><span class="main">]</span> H
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
                  <span class="keyword1"><span class="command">hence</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="skolem">h</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="skolem">j</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> hg mult_nonneg_nonneg normal_coeff_nonneg<span class="main">)</span>
                  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="main">(</span><span class="keyword1">case</span> <span class="skolem">x</span> <span class="keyword1">of</span>
                   <span class="main">(</span><span class="bound">h</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span> <span class="main">⇒</span>
                     <span class="main">(</span>coeff <span class="skolem">f</span> <span class="bound">h</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="bound">j</span> <span class="main">-</span> coeff <span class="skolem">f</span> <span class="main">(</span><span class="bound">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="main">(</span><span class="bound">h</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span>
                     <span class="main">(</span>coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">h</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">g</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> H<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> split<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> mult_nonneg_nonneg<span class="main">)</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
                <span class="keyword1"><span class="command">qed</span></span>
              <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">rule</span> sum_nonneg<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> hf hg normal_coeff_nonneg<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
              <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"coeff <span class="main">(</span><span class="skolem">f</span> <span class="main">*</span> <span class="skolem">g</span><span class="main">)</span> <span class="skolem">i</span> <span class="main">*</span> coeff <span class="main">(</span><span class="skolem">f</span> <span class="main">*</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span>coeff <span class="main">(</span><span class="skolem">f</span> <span class="main">*</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> power2_eq_square<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span> <span class="bound">j</span> <span class="bound">k</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≤</span> <span class="bound">j</span> <span class="main">⟹</span> <span class="bound">j</span> <span class="main">≤</span> <span class="bound">k</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">&lt;</span> coeff <span class="main">(</span><span class="skolem">f</span><span class="main">*</span><span class="skolem">g</span><span class="main">)</span> <span class="bound">i</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">&lt;</span> coeff <span class="main">(</span><span class="skolem">f</span><span class="main">*</span><span class="skolem">g</span><span class="main">)</span> <span class="bound">k</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">&lt;</span> coeff <span class="main">(</span><span class="skolem">f</span><span class="main">*</span><span class="skolem">g</span><span class="main">)</span> <span class="bound">j</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span> <span class="skolem">k</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> coeff <span class="main">(</span><span class="skolem">f</span> <span class="main">*</span> <span class="skolem">g</span><span class="main">)</span> <span class="skolem">k</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≤</span> degree <span class="main">(</span><span class="skolem">f</span> <span class="main">*</span> <span class="skolem">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> le_degree <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≤</span> <span class="skolem">k</span>"</span></span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≤</span> degree <span class="main">(</span><span class="skolem">f</span> <span class="main">*</span> <span class="skolem">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≤</span> degree <span class="skolem">f</span> <span class="main">+</span> degree <span class="skolem">g</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> degree_mult_eq hf hg normal_non_zero<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> coeff <span class="main">(</span><span class="skolem">f</span> <span class="main">*</span> <span class="skolem">g</span><span class="main">)</span> <span class="skolem">j</span>"</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> coeff_mult<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> sum_pos2<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"min <span class="skolem"><span class="skolem">j</span></span> <span class="main"><span class="main">(</span></span>degree <span class="skolem"><span class="skolem">f</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> mult_pos_pos<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> normal_of_no_zero_root<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hf0<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
            <span class="keyword1"><span class="command">using</span></span> hf <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
             <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> normal_of_no_zero_root<span class="main">)</span>
               <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hg0<span class="main">)</span>
            <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
            <span class="keyword1"><span class="command">using</span></span> hg <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hf hg normal_coeff_nonneg<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"normal_poly <span class="main">(</span><span class="skolem">f</span><span class="main">*</span><span class="skolem">g</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> normal_polyI<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Normal_Poly-normal_poly_of_roots"><span class="command">lemma</span></span> normal_poly_of_roots<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span><span class="main">::</span><span class="quoted"><span class="quoted">"real poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">z</span><span class="main">.</span> poly <span class="main">(</span>map_poly complex_of_real <span class="free">p</span><span class="main">)</span> <span class="bound">z</span> <span class="main">=</span> <span class="main">0</span> 
        <span class="main">⟹</span> Re <span class="bound">z</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">∧</span> <span class="numeral">4</span><span class="main">*</span><span class="main">(</span>Re <span class="bound">z</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">≥</span> <span class="main">(</span>cmod <span class="bound">z</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"lead_coeff <span class="free">p</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"normal_poly <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> real_poly_roots_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span><span class="main">::</span><span class="quoted"><span class="quoted">"real poly"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">x</span><span class="main">::</span><span class="quoted">real</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"lead_coeff <span class="main">(</span><span class="skolem">p</span> <span class="main">*</span> <span class="main">[:</span><span class="main">-</span> <span class="skolem">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"lead_coeff <span class="skolem">p</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> coeff_degree_mult lead_coeff_pCons<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> mult_cancel_left1 pCons_one zero_neq_one<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">z</span><span class="main">.</span> poly <span class="main">(</span>map_poly complex_of_real <span class="main">(</span><span class="skolem">p</span> <span class="main">*</span> <span class="main">[:</span><span class="main">-</span> <span class="skolem">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span><span class="main">)</span> <span class="bound">z</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span>
                 Re <span class="bound">z</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">(</span>cmod <span class="bound">z</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">≤</span> <span class="numeral">4</span> <span class="main">*</span> <span class="main">(</span>Re <span class="bound">z</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">z</span><span class="main">.</span> poly <span class="main">(</span>map_poly complex_of_real <span class="skolem">p</span><span class="main">)</span> <span class="bound">z</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span>
                 Re <span class="bound">z</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">(</span>cmod <span class="bound">z</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">≤</span> <span class="numeral">4</span> <span class="main">*</span> <span class="main">(</span>Re <span class="bound">z</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> four_x_squared mult.commute mult_cancel_left1 of_real_poly_map_mult poly_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"normal_poly <span class="main">[:</span><span class="main">-</span><span class="skolem">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> linear_normal_iff<span class="main"><span class="keyword3">,</span></span> 
        <span class="operator">subst</span> Re_complex_of_real<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> conjunct1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> h<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">x</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> of_real_poly_map_poly<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">z</span><span class="main">.</span> poly <span class="main">(</span>map_poly complex_of_real <span class="skolem">p</span><span class="main">)</span> <span class="bound">z</span> <span class="main">=</span> <span class="main">0</span>
             <span class="main">⟹</span> Re <span class="bound">z</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">(</span>cmod <span class="bound">z</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">≤</span> <span class="numeral">4</span> <span class="main">*</span> <span class="main">(</span>Re <span class="bound">z</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">⟹</span>
            lead_coeff <span class="skolem">p</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⟹</span> normal_poly <span class="skolem">p</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"normal_poly <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 1 2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"normal_poly <span class="main">(</span><span class="skolem">p</span> <span class="main">*</span> <span class="main">[:</span><span class="main">-</span><span class="skolem">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> 3 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> normal_mult<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span><span class="main">::</span><span class="quoted"><span class="quoted">"real poly"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">a</span> <span class="skolem">b</span><span class="main">::</span><span class="quoted">real</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"lead_coeff <span class="main">(</span><span class="skolem">p</span> <span class="main">*</span> <span class="main">[:</span><span class="skolem">a</span> <span class="main">*</span> <span class="skolem">a</span> <span class="main">+</span> <span class="skolem">b</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">,</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">a</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"lead_coeff <span class="skolem">p</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">)</span></span> coeff_degree_mult lead_coeff_pCons<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> mult_cancel_left1 pCons_eq_0_iff pCons_one<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">z</span><span class="main">.</span> poly <span class="main">(</span>map_poly complex_of_real <span class="main">(</span><span class="skolem">p</span> <span class="main">*</span> <span class="main">[:</span><span class="skolem">a</span> <span class="main">*</span> <span class="skolem">a</span> <span class="main">+</span> <span class="skolem">b</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">,</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">a</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span><span class="main">)</span> <span class="bound">z</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span>
                 Re <span class="bound">z</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">(</span>cmod <span class="bound">z</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">≤</span> <span class="numeral">4</span> <span class="main">*</span> <span class="main">(</span>Re <span class="bound">z</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">z</span><span class="main">.</span> poly <span class="main">(</span>map_poly complex_of_real <span class="skolem">p</span><span class="main">)</span> <span class="bound">z</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span>
                 Re <span class="bound">z</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">(</span>cmod <span class="bound">z</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">≤</span> <span class="numeral">4</span> <span class="main">*</span> <span class="main">(</span>Re <span class="bound">z</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span> <span class="main">::</span> <span class="quoted">complex</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span>map_poly complex_of_real <span class="skolem">p</span><span class="main">)</span> <span class="skolem">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">q</span><span class="main">.</span> <span class="main">0</span> <span class="main">=</span> poly <span class="main">(</span>map_poly complex_of_real <span class="main">(</span><span class="skolem">p</span> <span class="main">*</span> <span class="bound">q</span><span class="main">)</span><span class="main">)</span> <span class="skolem">z</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">z</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">(</span>cmod <span class="skolem">z</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">≤</span> <span class="numeral">4</span> <span class="main">*</span> <span class="main">(</span>Re <span class="skolem">z</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> h <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="skolem">a</span> <span class="main">*</span> <span class="skolem">a</span> <span class="main">+</span> <span class="skolem">b</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">,</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">a</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">=</span> <span class="main">[:</span>cmod <span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="keyword1">𝗂</span><span class="main">*</span><span class="skolem">b</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">,</span> <span class="main">-</span><span class="numeral">2</span> <span class="main">*</span> Re <span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="keyword1">𝗂</span><span class="main">*</span><span class="skolem">b</span><span class="main">)</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cmod_def power2_eq_square<span class="main">)</span>
  <span class="keyword1"><span class="command">interpret</span></span> map_poly_idom_hom <span class="quoted">complex_of_real</span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"normal_poly <span class="main">[:</span><span class="skolem">a</span> <span class="main">*</span> <span class="skolem">a</span> <span class="main">+</span> <span class="skolem">b</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">,</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">a</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> 3<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> quadratic_normal_iff<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> h<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> hom_mult poly_mult<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">z</span><span class="main">.</span> poly <span class="main">(</span>map_poly complex_of_real <span class="skolem">p</span><span class="main">)</span> <span class="bound">z</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> Re <span class="bound">z</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">(</span>cmod <span class="bound">z</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">≤</span> <span class="numeral">4</span> <span class="main">*</span> <span class="main">(</span>Re <span class="bound">z</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">⟹</span>
            lead_coeff <span class="skolem">p</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⟹</span> normal_poly <span class="skolem">p</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"normal_poly <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 1 2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"normal_poly <span class="main">(</span><span class="skolem">p</span> <span class="main">*</span> <span class="main">[:</span><span class="skolem">a</span> <span class="main">*</span> <span class="skolem">a</span> <span class="main">+</span> <span class="skolem">b</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">,</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">a</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> 4 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> normal_mult<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span><span class="main">::</span><span class="quoted">real</span> 
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"lead_coeff <span class="main">[:</span><span class="skolem">a</span><span class="main">:]</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span> <span class="bound">j</span> <span class="bound">k</span><span class="main">.</span>
       lead_coeff <span class="main">[:</span><span class="skolem">a</span><span class="main">:]</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⟹</span>
       <span class="bound">i</span> <span class="main">≤</span> <span class="bound">j</span> <span class="main">⟹</span>
       <span class="bound">j</span> <span class="main">≤</span> <span class="bound">k</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">&lt;</span> coeff <span class="main">[:</span><span class="skolem">a</span><span class="main">:]</span> <span class="bound">i</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">&lt;</span> coeff <span class="main">[:</span><span class="skolem">a</span><span class="main">:]</span> <span class="bound">k</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">&lt;</span> coeff <span class="main">[:</span><span class="skolem">a</span><span class="main">:]</span> <span class="bound">j</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bot_nat_0.extremum_uniqueI coeff_eq_0 degree_pCons_0 leI 
        less_numeral_extra<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"normal_poly <span class="main">[:</span><span class="skolem">a</span><span class="main">:]</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> normal_polyI<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>pCons_one<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Normal_Poly-normal_changes"><span class="command">lemma</span></span> normal_changes<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span><span class="main">::</span><span class="quoted"><span class="quoted">"real poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> hf<span class="main">:</span> <span class="quoted"><span class="quoted">"normal_poly <span class="free">f</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> hx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">df</span> <span class="main">≡</span> degree <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"changes <span class="main">(</span>coeffs <span class="main">(</span><span class="free">f</span><span class="main">*</span><span class="main">[:</span><span class="main">-</span><span class="free">x</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> df_def hf 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">df</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">f</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> <span class="main">[:</span><span class="skolem">a</span><span class="main">:]</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> degree_0_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"changes <span class="main">(</span>coeffs <span class="main">(</span><span class="skolem">f</span><span class="main">*</span><span class="main">[:</span><span class="main">-</span><span class="free">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> normal_non_zero<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹normal_poly <span class="skolem">f</span>›</span></span><span class="main">]</span> hx 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> zero_less_mult_iff mult_less_0_iff<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">df</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"poly <span class="skolem">f</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">f</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> hf<span class="main">:</span><span class="quoted"><span class="quoted">"normal_poly <span class="skolem">f</span>"</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f'</span></span> <span class="keyword2"><span class="keyword">where</span></span> hdiv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> <span class="skolem">f'</span><span class="main">*</span><span class="main">[:</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">)</span></span> dvdE mult.commute poly_eq_0_iff_dvd<span class="main">)</span> 
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> hf'<span class="main">:</span> <span class="quoted"><span class="quoted">"normal_poly <span class="skolem">f'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> normal_divide_x <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">df</span> <span class="main">=</span> degree <span class="skolem">f</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">f'</span> <span class="main">=</span> <span class="skolem">df</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hdiv normal_non_zero<span class="main">[</span><span class="operator">OF</span> hf'<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> degree_mult_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">f</span><span class="main">::</span>real poly<span class="main">.</span> <span class="skolem">df</span> <span class="main">=</span> degree <span class="bound">f</span> <span class="main">⟹</span> normal_poly <span class="bound">f</span> <span class="main">⟹</span> changes <span class="main">(</span>coeffs <span class="main">(</span><span class="bound">f</span> <span class="main">*</span> <span class="main">[:</span><span class="main">-</span> <span class="free">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"changes <span class="main">(</span>coeffs <span class="main">(</span><span class="skolem">f'</span> <span class="main">*</span> <span class="main">[:</span><span class="main">-</span> <span class="free">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hf' <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"changes <span class="main">(</span>coeffs <span class="main">(</span><span class="skolem">f</span> <span class="main">*</span> <span class="main">[:</span><span class="main">-</span> <span class="free">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> hdiv<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> mult_pCons_right<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> smult_0_left<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> add_0<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> mult_pCons_left<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> smult_0_left<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> add_0<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> changes_pCons<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> hf<span class="main">:</span><span class="quoted"><span class="quoted">"normal_poly <span class="skolem">f</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">f</span> <span class="main">0</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> h'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≤</span> degree <span class="skolem">f</span> <span class="main">⟹</span> coeff <span class="skolem">f</span> <span class="bound">i</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> normal_of_no_zero_root<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> degree <span class="skolem">f</span> <span class="main">-</span> <span class="main">1</span> <span class="main">⟹</span> <span class="main">(</span>coeff <span class="skolem">f</span> <span class="bound">i</span><span class="main">)</span><span class="main">/</span><span class="main">(</span>coeff <span class="skolem">f</span> <span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span>coeff <span class="skolem">f</span> <span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="main">(</span>coeff <span class="skolem">f</span> <span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> normal_poly_coeff_mult<span class="main">[</span><span class="operator">OF</span> hf<span class="main">]</span> normal_coeff_nonneg<span class="main">[</span><span class="operator">OF</span> hf<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span> power2_eq_square<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> h''<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> degree <span class="skolem">f</span> <span class="main">-</span> <span class="main">1</span> <span class="main">⟹</span> <span class="main">(</span>coeff <span class="skolem">f</span> <span class="bound">i</span><span class="main">)</span><span class="main">/</span><span class="main">(</span>coeff <span class="skolem">f</span> <span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="free">x</span> <span class="main">≤</span> <span class="main">(</span>coeff <span class="skolem">f</span> <span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="main">(</span>coeff <span class="skolem">f</span> <span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="free">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">have</span></span> hdeg<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>pCons <span class="main">0</span> <span class="skolem">f</span> <span class="main">-</span> smult <span class="free">x</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">=</span> degree <span class="skolem">f</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> diff_conv_add_uminus<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> degree_add_eq_left<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> hf normal_non_zero<span class="main">)</span>

    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">z</span> <span class="bound">w</span><span class="main">.</span> <span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span><span class="main">=</span><span class="main">0</span> <span class="keyword1">then</span> <span class="bound">z</span><span class="main">/</span><span class="main">(</span><span class="free">x</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="main">0</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> degree <span class="main">(</span>pCons <span class="main">0</span> <span class="skolem">f</span> <span class="main">-</span> smult <span class="free">x</span> <span class="skolem">f</span><span class="main">)</span> <span class="keyword1">then</span> <span class="bound">w</span><span class="main">/</span><span class="main">(</span>lead_coeff <span class="skolem">f</span><span class="main">)</span> <span class="keyword1">else</span> inverse <span class="main">(</span>coeff <span class="skolem">f</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>

    <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">z</span> <span class="bound">w</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">z</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">w</span> <span class="main">⟹</span> changes <span class="main">(</span>coeffs <span class="main">(</span><span class="skolem">f</span> <span class="main">*</span> <span class="main">[:</span><span class="main">-</span><span class="free">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
          changes <span class="main">(</span><span class="main">-</span><span class="bound">z</span> <span class="main">#</span> map <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span>coeff <span class="skolem">f</span> <span class="main">(</span><span class="bound">i</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="main">(</span>coeff <span class="skolem">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">-</span> <span class="free">x</span><span class="main">)</span> <span class="main">[</span><span class="main">1</span><span class="main">..&lt;</span>degree <span class="main">(</span>pCons <span class="main">0</span> <span class="skolem">f</span> <span class="main">-</span> smult <span class="free">x</span> <span class="skolem">f</span><span class="main">)</span><span class="main">]</span> <span class="main">@</span> <span class="main">[</span><span class="bound">w</span><span class="main">]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span> <span class="skolem">w</span> <span class="main">::</span> <span class="quoted">real</span>
      <span class="keyword3"><span class="command">assume</span></span> hz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">z</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> hw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">w</span>"</span></span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="skolem">z</span> <span class="main">#</span> map <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span>coeff <span class="skolem">f</span> <span class="main">(</span><span class="bound">i</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="main">(</span>coeff <span class="skolem">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">-</span> <span class="free">x</span><span class="main">)</span> <span class="main">[</span><span class="main">1</span><span class="main">..&lt;</span>degree <span class="main">(</span>pCons <span class="main">0</span> <span class="skolem">f</span> <span class="main">-</span> smult <span class="free">x</span> <span class="skolem">f</span><span class="main">)</span><span class="main">]</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">w</span><span class="main">]</span> <span class="main">=</span>
            map <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">-</span><span class="skolem">z</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> degree <span class="main">(</span>pCons <span class="main">0</span> <span class="skolem">f</span> <span class="main">-</span> smult <span class="free">x</span> <span class="skolem">f</span><span class="main">)</span> <span class="keyword1">then</span> <span class="skolem">w</span> <span class="keyword1">else</span> 
              <span class="main">(</span>coeff <span class="skolem">f</span> <span class="main">(</span><span class="bound">i</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="main">(</span>coeff <span class="skolem">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">-</span> <span class="free">x</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>degree <span class="main">(</span>pCons <span class="main">0</span> <span class="skolem">f</span> <span class="main">-</span> smult <span class="free">x</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> nth_equalityI<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="main">-</span> <span class="skolem">z</span> <span class="main">#</span> map <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> coeff <span class="skolem">f</span> <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> coeff <span class="skolem">f</span> <span class="bound">i</span> <span class="main">-</span> <span class="free">x</span><span class="main">)</span> <span class="main">[</span><span class="main">1</span><span class="main">..&lt;</span>degree <span class="main">(</span>pCons <span class="main">0</span> <span class="skolem">f</span> <span class="main">-</span> smult <span class="free">x</span> <span class="skolem">f</span><span class="main">)</span><span class="main">]</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">w</span><span class="main">]</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≤</span> degree <span class="main">(</span>pCons <span class="main">0</span> <span class="skolem">f</span> <span class="main">-</span> smult <span class="free">x</span> <span class="skolem">f</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> hdeg Suc.hyps<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">consider</span></span> <span class="main">(</span>a<span class="main">)</span><span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="main">|</span> <span class="main">(</span>b<span class="main">)</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">i</span> <span class="main">∧</span> <span class="skolem">i</span> <span class="main">&lt;</span> degree <span class="main">(</span>pCons <span class="main">0</span> <span class="skolem">f</span> <span class="main">-</span> smult <span class="free">x</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">|</span>
          <span class="main">(</span>c<span class="main">)</span><span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> degree <span class="main">(</span>pCons <span class="main">0</span> <span class="skolem">f</span> <span class="main">-</span> smult <span class="free">x</span> <span class="skolem">f</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span> <span class="skolem">z</span> <span class="main">#</span>
              map <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> coeff <span class="skolem">f</span> <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> coeff <span class="skolem">f</span> <span class="bound">i</span> <span class="main">-</span> <span class="free">x</span><span class="main">)</span>
               <span class="main">[</span><span class="main">1</span><span class="main">..&lt;</span>degree <span class="main">(</span>pCons <span class="main">0</span> <span class="skolem">f</span> <span class="main">-</span> smult <span class="free">x</span> <span class="skolem">f</span><span class="main">)</span><span class="main">]</span> <span class="main">@</span>
              <span class="main">[</span><span class="skolem">w</span><span class="main">]</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">=</span>
             map <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">-</span> <span class="skolem">z</span>
                      <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> degree <span class="main">(</span>pCons <span class="main">0</span> <span class="skolem">f</span> <span class="main">-</span> smult <span class="free">x</span> <span class="skolem">f</span><span class="main">)</span> <span class="keyword1">then</span> <span class="skolem">w</span>
                           <span class="keyword1">else</span> coeff <span class="skolem">f</span> <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> coeff <span class="skolem">f</span> <span class="bound">i</span> <span class="main">-</span> <span class="free">x</span><span class="main">)</span>
              <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>degree <span class="main">(</span>pCons <span class="main">0</span> <span class="skolem">f</span> <span class="main">-</span> smult <span class="free">x</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">]</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nth_append<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> hdeg<span class="main">)</span>      

      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">[</span><span class="var">?f</span> <span class="skolem">z</span> <span class="skolem">w</span> <span class="bound">i</span> <span class="main">*</span> <span class="main">(</span>nth_default <span class="main">0</span> <span class="main">(</span>coeffs <span class="main">(</span><span class="skolem">f</span> <span class="main">*</span> <span class="main">[:</span><span class="main">-</span><span class="free">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span><span class="main">)</span> <span class="bound">i</span><span class="main">)</span><span class="main">.</span> 
                        i <span class="main">←</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">(</span>degree <span class="main">(</span>pCons <span class="main">0</span> <span class="skolem">f</span> <span class="main">-</span> smult <span class="free">x</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span><span class="main">]</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> map_cong<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> set <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">(</span>degree <span class="main">(</span>pCons <span class="main">0</span> <span class="skolem">f</span> <span class="main">-</span> smult <span class="free">x</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span><span class="main">]</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">consider</span></span> <span class="main">(</span>a<span class="main">)</span><span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="main">|</span> <span class="main">(</span>b<span class="main">)</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span> <span class="main">≠</span> <span class="skolem">i</span> <span class="main">∧</span> <span class="skolem">i</span> <span class="main">&lt;</span> degree <span class="main">(</span>pCons <span class="main">0</span> <span class="skolem">f</span> <span class="main">-</span> smult <span class="free">x</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">|</span>
          <span class="main">(</span>c<span class="main">)</span><span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> degree <span class="main">(</span>pCons <span class="main">0</span> <span class="skolem">f</span> <span class="main">-</span> smult <span class="free">x</span> <span class="skolem">f</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">if</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">-</span> <span class="skolem">z</span>
           <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="skolem">i</span> <span class="main">=</span> degree <span class="main">(</span>pCons <span class="main">0</span> <span class="skolem">f</span> <span class="main">-</span> smult <span class="free">x</span> <span class="skolem">f</span><span class="main">)</span> <span class="keyword1">then</span> <span class="skolem">w</span>
                <span class="keyword1">else</span> coeff <span class="skolem">f</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> coeff <span class="skolem">f</span> <span class="skolem">i</span> <span class="main">-</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span>
          <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="skolem">z</span> <span class="main">/</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="main">0</span><span class="main">)</span>
           <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="skolem">i</span> <span class="main">=</span> degree <span class="main">(</span>pCons <span class="main">0</span> <span class="skolem">f</span> <span class="main">-</span> smult <span class="free">x</span> <span class="skolem">f</span><span class="main">)</span> <span class="keyword1">then</span> <span class="skolem">w</span> <span class="main">/</span> lead_coeff <span class="skolem">f</span>
                <span class="keyword1">else</span> inverse <span class="main">(</span>coeff <span class="skolem">f</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span>
          nth_default <span class="main">0</span> <span class="main">(</span>coeffs <span class="main">(</span><span class="skolem">f</span> <span class="main">*</span> <span class="main">[:</span><span class="main">-</span> <span class="free">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span><span class="main">)</span> <span class="skolem">i</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>a<span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> hx <span class="quoted"><span class="quoted">‹poly <span class="skolem">f</span> <span class="main">0</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nth_default_coeffs_eq poly_0_coeff_0<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>b<span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> hx h'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">i</span></span><span class="main">]</span> hdeg
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> nth_default_coeffs_eq coeff_pCons nat.split poly_0_coeff_0<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>c<span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> hdeg <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nth_default_coeffs_eq coeff_eq_0<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="operator">force</span>

      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">-</span> <span class="skolem">z</span> <span class="main">#</span>
        map <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> coeff <span class="skolem">f</span> <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> coeff <span class="skolem">f</span> <span class="bound">i</span> <span class="main">-</span> <span class="free">x</span><span class="main">)</span> <span class="main">[</span><span class="main">1</span><span class="main">..&lt;</span>degree <span class="main">(</span>pCons <span class="main">0</span> <span class="skolem">f</span> <span class="main">-</span> smult <span class="free">x</span> <span class="skolem">f</span><span class="main">)</span><span class="main">]</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">w</span><span class="main">]</span> <span class="main">=</span>
        map <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="skolem">z</span> <span class="main">/</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="main">0</span><span class="main">)</span>
                  <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> degree <span class="main">(</span>pCons <span class="main">0</span> <span class="skolem">f</span> <span class="main">-</span> smult <span class="free">x</span> <span class="skolem">f</span><span class="main">)</span> <span class="keyword1">then</span> <span class="skolem">w</span> <span class="main">/</span> lead_coeff <span class="skolem">f</span>
                       <span class="keyword1">else</span> inverse <span class="main">(</span>coeff <span class="skolem">f</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span>
                 nth_default <span class="main">0</span> <span class="main">(</span>coeffs <span class="main">(</span><span class="skolem">f</span> <span class="main">*</span> <span class="main">[:</span><span class="main">-</span> <span class="free">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span><span class="main">)</span> <span class="bound">i</span><span class="main">)</span>
         <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="main">(</span>degree <span class="main">(</span>pCons <span class="main">0</span> <span class="skolem">f</span> <span class="main">-</span> smult <span class="free">x</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">*</span> <span class="main">[:</span><span class="main">-</span><span class="free">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hdeg <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"changes <span class="main">(</span>coeffs <span class="main">(</span><span class="skolem">f</span> <span class="main">*</span> <span class="main">[:</span><span class="main">-</span> <span class="free">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
           changes
            <span class="main">(</span><span class="main">-</span> <span class="skolem">z</span> <span class="main">#</span>
             map <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> coeff <span class="skolem">f</span> <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> coeff <span class="skolem">f</span> <span class="bound">i</span> <span class="main">-</span> <span class="free">x</span><span class="main">)</span>
              <span class="main">[</span><span class="main">1</span><span class="main">..&lt;</span>degree <span class="main">(</span>pCons <span class="main">0</span> <span class="skolem">f</span> <span class="main">-</span> smult <span class="free">x</span> <span class="skolem">f</span><span class="main">)</span><span class="main">]</span> <span class="main">@</span>
             <span class="main">[</span><span class="skolem">w</span><span class="main">]</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> 1<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> changes_scale<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> hz hw hx h' hdeg <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> hdeg <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">*</span> <span class="main">[:</span><span class="main">-</span><span class="free">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> length_coeffs<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"changes <span class="main">(</span>coeffs <span class="main">(</span><span class="skolem">f</span> <span class="main">*</span> <span class="main">[:</span><span class="main">-</span> <span class="free">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
        changes
         <span class="main">(</span><span class="main">-</span> <span class="main">(</span>max <span class="main">1</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span>coeff <span class="skolem">f</span> <span class="main">0</span> <span class="main">/</span> coeff <span class="skolem">f</span> <span class="main">1</span> <span class="main">-</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">#</span>
          map <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> coeff <span class="skolem">f</span> <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> coeff <span class="skolem">f</span> <span class="bound">i</span> <span class="main">-</span> <span class="free">x</span><span class="main">)</span>
           <span class="main">[</span><span class="main">1</span><span class="main">..&lt;</span>degree <span class="main">(</span>pCons <span class="main">0</span> <span class="skolem">f</span> <span class="main">-</span> smult <span class="free">x</span> <span class="skolem">f</span><span class="main">)</span><span class="main">]</span> <span class="main">@</span>
          <span class="main">[</span>max <span class="main">1</span> <span class="main">(</span>coeff <span class="skolem">f</span> <span class="main">(</span>degree <span class="skolem">f</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> lead_coeff <span class="skolem">f</span> <span class="main">-</span> <span class="free">x</span><span class="main">)</span><span class="main">]</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> changes_increasing<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length
              <span class="main">(</span><span class="main">-</span> max <span class="main">1</span> <span class="main">(</span><span class="main">-</span> <span class="main">(</span>coeff <span class="skolem">f</span> <span class="main">0</span> <span class="main">/</span> coeff <span class="skolem">f</span> <span class="main">1</span> <span class="main">-</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">#</span>
               map <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> coeff <span class="skolem">f</span> <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> coeff <span class="skolem">f</span> <span class="bound">i</span> <span class="main">-</span> <span class="free">x</span><span class="main">)</span> <span class="main">[</span><span class="main">1</span><span class="main">..&lt;</span>degree <span class="main">(</span>pCons <span class="main">0</span> <span class="skolem">f</span> <span class="main">-</span> smult <span class="free">x</span> <span class="skolem">f</span><span class="main">)</span><span class="main">]</span> <span class="main">@</span>
               <span class="main">[</span>max <span class="main">1</span> <span class="main">(</span>coeff <span class="skolem">f</span> <span class="main">(</span>degree <span class="skolem">f</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> lead_coeff <span class="skolem">f</span> <span class="main">-</span> <span class="free">x</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> degree <span class="main">(</span>pCons <span class="main">0</span> <span class="skolem">f</span> <span class="main">-</span> smult <span class="free">x</span> <span class="skolem">f</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> hdeg Suc.hyps<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">consider</span></span> <span class="main">(</span>a<span class="main">)</span><span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="main">|</span> <span class="main">(</span>b<span class="main">)</span><span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≠</span> <span class="skolem">i</span> <span class="main">∧</span> <span class="skolem">i</span> <span class="main">&lt;</span> degree <span class="main">(</span>pCons <span class="main">0</span> <span class="skolem">f</span> <span class="main">-</span> smult <span class="free">x</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="main">|</span>
        <span class="main">(</span>c<span class="main">)</span><span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> degree <span class="main">(</span>pCons <span class="main">0</span> <span class="skolem">f</span> <span class="main">-</span> smult <span class="free">x</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span> max <span class="main">1</span> <span class="main">(</span><span class="main">-</span> <span class="main">(</span>coeff <span class="skolem">f</span> <span class="main">0</span> <span class="main">/</span> coeff <span class="skolem">f</span> <span class="main">1</span> <span class="main">-</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">#</span>
          map <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> coeff <span class="skolem">f</span> <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> coeff <span class="skolem">f</span> <span class="bound">i</span> <span class="main">-</span> <span class="free">x</span><span class="main">)</span>
           <span class="main">[</span><span class="main">1</span><span class="main">..&lt;</span>degree <span class="main">(</span>pCons <span class="main">0</span> <span class="skolem">f</span> <span class="main">-</span> smult <span class="free">x</span> <span class="skolem">f</span><span class="main">)</span><span class="main">]</span> <span class="main">@</span>
          <span class="main">[</span>max <span class="main">1</span> <span class="main">(</span>coeff <span class="skolem">f</span> <span class="main">(</span>degree <span class="skolem">f</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> lead_coeff <span class="skolem">f</span> <span class="main">-</span> <span class="free">x</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">!</span>
         <span class="skolem">i</span>
         <span class="main">≤</span> <span class="main">(</span><span class="main">-</span> max <span class="main">1</span> <span class="main">(</span><span class="main">-</span> <span class="main">(</span>coeff <span class="skolem">f</span> <span class="main">0</span> <span class="main">/</span> coeff <span class="skolem">f</span> <span class="main">1</span> <span class="main">-</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">#</span>
             map <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> coeff <span class="skolem">f</span> <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> coeff <span class="skolem">f</span> <span class="bound">i</span> <span class="main">-</span> <span class="free">x</span><span class="main">)</span>
              <span class="main">[</span><span class="main">1</span><span class="main">..&lt;</span>degree <span class="main">(</span>pCons <span class="main">0</span> <span class="skolem">f</span> <span class="main">-</span> smult <span class="free">x</span> <span class="skolem">f</span><span class="main">)</span><span class="main">]</span> <span class="main">@</span>
             <span class="main">[</span>max <span class="main">1</span> <span class="main">(</span>coeff <span class="skolem">f</span> <span class="main">(</span>degree <span class="skolem">f</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> lead_coeff <span class="skolem">f</span> <span class="main">-</span> <span class="free">x</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">!</span>
            <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> a
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nth_append<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> b
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coeff <span class="skolem">f</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">f</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span>coeff <span class="skolem">f</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> normal_poly_coeff_mult<span class="main"><span class="main">[</span></span><span class="operator">OF</span> hf<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem">i</span></span></span> <span class="main"><span class="main"><span class="main">-</span></span></span> <span class="main"><span class="main"><span class="main">1</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"coeff <span class="skolem">f</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> coeff <span class="skolem">f</span> <span class="skolem">i</span> <span class="main">≤</span> coeff <span class="skolem">f</span> <span class="skolem">i</span> <span class="main">/</span> coeff <span class="skolem">f</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> h'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">i</span></span><span class="main">]</span> h'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">+</span><span class="main">1</span>"</span></span><span class="main">]</span> h'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">-</span><span class="main">1</span>"</span></span><span class="main">]</span> h' b hdeg
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> power2_eq_square <span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> b <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nth_append<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> c
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> hdeg <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nth_append not_le<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"changes <span class="main">(</span>coeffs <span class="main">(</span><span class="skolem">f</span> <span class="main">*</span> <span class="main">[:</span><span class="main">-</span><span class="free">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Three_Circles">
<div class="head">
<h1>Theory Three_Circles</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Proof of the theorem of three circles›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Three_Circles
  <span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="#Bernstein">Bernstein</a>"</span> <span class="quoted">"<a href="#Normal_Poly">Normal_Poly</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The theorem of three circles is a result in real algebraic geometry about the number of real roots
in an interval. It says if the number of roots in certain circles in the complex plane are zero or 
one then the number of roots in the circles is equal to the sign changes of the Bernstein
coefficients on that interval for which the circles intersect the real line. This can then be used
to determine if an interval has a real root in the bisection procedure, which is more efficient than
Descartes' rule of signs.

The proof here follows Theorem 10.50 in
  Basu, S., Pollack, R., Roy, M.-F.: Algorithms in Real Algebraic Geometry. 
  Springer Berlin Heidelberg, Berlin, Heidelberg (2016).

This theorem has also been fomalised in Coq \cite{zsido2014theorem}. The relationship
between this theorem and root isolation has been elaborated in Eigenwillig's PhD
thesis \cite{eigenwillig2008real}.
›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹No sign changes case›</span></span>

<span class="keyword1"><span class="command">declare</span></span> degree_pcompose<span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span>

<span class="keyword1"><span class="command">corollary</span></span> descartes_sign_zero<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span><span class="main">::</span><span class="quoted"><span class="quoted">"real poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">::</span>complex<span class="main">.</span> poly <span class="main">(</span>map_poly of_real <span class="free">p</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> Re <span class="bound">x</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"lead_coeff <span class="free">p</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"coeff <span class="free">p</span> <span class="free">i</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">i</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> real_poly_roots_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">p</span> <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">interpret</span></span> map_poly_idom_hom <span class="quoted">complex_of_real</span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">have</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">i</span><span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> coeff <span class="skolem">p</span> <span class="bound">i</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> 1<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> 1<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> lambda_zero of_real_poly_map_mult poly_mult<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> 1<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> lead_coeff_1 lead_coeff_mult lead_coeff_pCons<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span>
                      mult_cancel_right2 pCons_one zero_neq_one<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Re_complex_of_real<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> 1<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> hom_mult<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">i</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> h<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">i</span></span><span class="main">]</span> h<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">-</span><span class="main">1</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> coeff_pCons mult_nonneg_nonpos2<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> h<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">i</span></span><span class="main">]</span> h<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">-</span><span class="main">1</span>"</span></span><span class="main">]</span> mult_left_mono_neg
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> coeff_pCons<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">p</span> <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span>
  <span class="keyword1"><span class="command">interpret</span></span> map_poly_idom_hom <span class="quoted">complex_of_real</span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">have</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">i</span><span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> coeff <span class="skolem">p</span> <span class="bound">i</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> 2<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> lambda_zero of_real_poly_map_mult poly_mult<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> lead_coeff_1 lead_coeff_mult lead_coeff_pCons<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span>
                      mult_cancel_right2 pCons_one zero_neq_one<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="skolem">b</span> <span class="main">*</span> <span class="keyword1">𝗂</span><span class="main">)</span> <span class="main">≤</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> 2<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> hom_mult<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">a</span> <span class="main">+</span> <span class="skolem">b</span> <span class="main">*</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span><span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> coeff <span class="main">[:</span><span class="skolem">a</span> <span class="main">*</span> <span class="skolem">a</span> <span class="main">+</span> <span class="skolem">b</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">,</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">a</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="bound">x</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> coeff <span class="main">[:</span><span class="skolem">a</span> <span class="main">*</span> <span class="skolem">a</span> <span class="main">+</span> <span class="skolem">b</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">,</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">a</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">fastforce</span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">1</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">fastforce</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> coeff_pCons<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> coeff_eq_0<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> mult.commute<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> coeff_mult<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sum_nonneg<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> mult_nonneg_nonneg<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ h<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">a</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> bot_nat_0.extremum_uniqueI degree_1 le_degree
        lead_coeff_pCons<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> pCons_one<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">circle_01_diam</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">circle_01_diam</span> <span class="main">=</span>
 <span class="main">{</span><span class="bound">x</span><span class="main">.</span> cmod <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="main">(</span>of_nat <span class="main">1</span> <span class="main">::</span> complex<span class="main">)</span><span class="main">/</span><span class="main">(</span>of_nat <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span>real <span class="main">1</span><span class="main">)</span><span class="main">/</span><span class="main">(</span>real <span class="numeral">2</span><span class="main">)</span><span class="main">}</span>"</span></span>

<span class="keyword1" id="Three_Circles-pos_real_map"><span class="command">lemma</span></span> pos_real_map<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">::</span>complex<span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> Re <span class="bound">x</span><span class="main">}</span><span class="main">}</span> <span class="main">=</span> circle_01_diam"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> Re <span class="bound">x</span><span class="main">}</span><span class="main">}</span> <span class="main">⊆</span> circle_01_diam"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> Re <span class="bound">x</span><span class="main">}</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">/</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> hy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> Re <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> hy'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="main">1</span> <span class="main">/</span> <span class="skolem">x</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">hence</span></span> hy''<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> h hy <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> h
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> div_by_1 divide_divide_eq_right mult.left_neutral<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>Re <span class="skolem">y</span> <span class="main">-</span> <span class="main">1</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="main">¦</span>Re <span class="skolem">y</span> <span class="main">+</span> <span class="main">1</span><span class="main">¦</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hy <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"cmod <span class="main">(</span><span class="skolem">y</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">&lt;</span> cmod <span class="main">(</span><span class="skolem">y</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> cmod_Re_le_iff minus_complex.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> minus_complex.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span>
          one_complex.simps plus_complex.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> plus_complex.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"cmod <span class="main">(</span><span class="main">(</span><span class="skolem">y</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="skolem">y</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">)</span></span> divide_less_eq_1_pos nonzero_norm_divide zero_less_norm_iff<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> circle_01_diam"</span></span> <span class="keyword1"><span class="command">using</span></span> hy' hy''
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> norm_minus_commute circle_01_diam_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"circle_01_diam <span class="main">⊆</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> Re <span class="bound">x</span><span class="main">}</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> circle_01_diam"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"cmod <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> circle_01_diam_def<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"cmod <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> cmod <span class="numeral">2</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"cmod <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">)</span></span> dbl_simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> dbl_simps<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> div_self times_divide_eq_left
          left_diff_distrib_numeral mult.commute mult_numeral_1
          norm_eq_zero norm_mult norm_numeral norm_one numeral_One<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"cmod <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span>  <span class="main">1</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span> norm_minus_commute<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"cmod <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span>  <span class="main">1</span><span class="main">)</span><span class="main">/</span> cmod <span class="main">(</span><span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> abs_norm_cancel norm_divide norm_of_real<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"cmod <span class="main">(</span><span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">&lt;</span> cmod <span class="main">(</span><span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> h
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">)</span></span> diff_add_cancel divide_eq_0_iff divide_less_eq_1_pos
          norm_divide norm_of_real zero_less_norm_iff zero_neq_one<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>Re <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="main">¦</span>Re <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">¦</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> cmod_Re_le_iff minus_complex.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> minus_complex.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span>
          one_complex.simps plus_complex.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> plus_complex.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> Re <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">/</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> Re <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">∧</span> <span class="main">1</span> <span class="main">/</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">xa</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> Re <span class="bound">xa</span> <span class="main">∧</span> <span class="main">1</span> <span class="main">/</span> <span class="skolem">x</span> <span class="main">=</span> <span class="bound">xa</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> Re <span class="bound">x</span><span class="main">}</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Three_Circles-one_circle_01"><span class="command">lemma</span></span> one_circle_01<span class="main">:</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">P</span><span class="main">::</span><span class="quoted"><span class="quoted">"real poly"</span></span> <span class="keyword2"><span class="keyword">assumes</span></span> hP<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">P</span> <span class="main">≤</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="main">(</span>map_poly of_real <span class="free">P</span><span class="main">)</span> circle_01_diam <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Bernstein_changes_01 <span class="free">p</span> <span class="free">P</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Q</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>reciprocal_poly <span class="free">p</span> <span class="free">P</span><span class="main">)</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> hQ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?Q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Missing_Polynomial.pcompose_eq_0 reciprocal_0_iff<span class="main">)</span>

  <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"changes <span class="main">(</span>coeffs <span class="var">?Q</span><span class="main">)</span> <span class="main">≥</span> proots_count <span class="var">?Q</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">x</span><span class="main">}</span> <span class="main">∧</span> 
        even <span class="main">(</span>changes <span class="main">(</span>coeffs <span class="var">?Q</span><span class="main">)</span> <span class="main">-</span> proots_count <span class="var">?Q</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">x</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> descartes_sign<span class="main">)</span>
    
  <span class="keyword1"><span class="command">have</span></span> hdeg<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>map_poly complex_of_real <span class="free">P</span><span class="main">)</span> <span class="main">≤</span> <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> le_trans<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> degree_map_poly_le<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> hx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">&lt;</span> Re <span class="bound">x</span> <span class="main">⟹</span> False"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span><span class="main">::</span><span class="quoted">complex</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">algebra</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> Re <span class="skolem">x</span> <span class="main">⟹</span> False"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"proots_count <span class="main">(</span>map_poly of_real <span class="free">P</span><span class="main">)</span> circle_01_diam <span class="main">=</span>
           proots_count <span class="main">(</span>map_poly of_real <span class="var">?Q</span><span class="main">)</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> Re <span class="bound">x</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> pos_real_map<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> of_real_hom.map_poly_pcompose<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> map_poly_reciprocal<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>2<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> proots_pcompose<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> reciprocal_0_iff degree_map_poly<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>2<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> proots_count_reciprocal<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> degree_map_poly inverse_eq_divide<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>2<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command">using</span></span> hx <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inverse_eq_divide <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>

  <span class="keyword1"><span class="command">hence</span></span> 3<span class="main">:</span><span class="quoted"><span class="quoted">"proots_count <span class="main">(</span>map_poly of_real <span class="var">?Q</span><span class="main">)</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> Re <span class="bound">x</span><span class="main">}</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>

  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">::</span>complex<span class="main">.</span>
         poly <span class="main">(</span>map_poly of_real <span class="main">(</span>smult <span class="main">(</span>inverse <span class="main">(</span>lead_coeff <span class="var">?Q</span><span class="main">)</span><span class="main">)</span> <span class="var">?Q</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span>
         Re <span class="bound">x</span> <span class="main">≤</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span><span class="main">::</span><span class="quoted">complex</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">x</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">⟹</span> Re <span class="skolem">x</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span> 
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>Re <span class="skolem">x</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">hence</span></span> h<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> Re <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span>map_poly of_real <span class="main">(</span>smult <span class="main">(</span>inverse <span class="main">(</span>lead_coeff <span class="var">?Q</span><span class="main">)</span><span class="main">)</span> <span class="var">?Q</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted">"poly <span class="main">(</span>map_poly of_real <span class="var">?Q</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"order <span class="skolem">x</span> <span class="main">(</span>map_poly complex_of_real <span class="main">(</span>reciprocal_poly <span class="free">p</span> <span class="free">P</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> order_root pcompose_eq_0 reciprocal_0_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="main">(</span>map_poly of_real <span class="var">?Q</span><span class="main">)</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> Re <span class="bound">x</span><span class="main">}</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> h3<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="main">(</span>map_poly complex_of_real 
                <span class="main">(</span>reciprocal_poly <span class="free">p</span> <span class="free">P</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> poly_roots_finite<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> order_root pcompose_eq_0 reciprocal_0_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> order <span class="skolem">x</span> <span class="main">(</span>map_poly complex_of_real <span class="main">(</span>reciprocal_poly <span class="free">p</span> <span class="free">P</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> h2 assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> order_root pcompose_eq_0 reciprocal_0_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∑</span><span class="bound">r</span><span class="main">∈</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> Re <span class="bound">x</span> <span class="main">∧</span>
                  poly <span class="main">(</span>map_poly complex_of_real <span class="main">(</span>reciprocal_poly <span class="free">p</span> <span class="free">P</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span>
                  <span class="main">0</span><span class="main">}</span><span class="main">.</span>
           order <span class="bound">r</span> <span class="main">(</span>map_poly complex_of_real <span class="main">(</span>reciprocal_poly <span class="free">p</span> <span class="free">P</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> member_le_sum<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> h h2 h3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 
        <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="main">(</span><span class="main">∑</span><span class="bound">r</span><span class="main">∈</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> Re <span class="bound">x</span> <span class="main">∧</span>
         poly <span class="main">(</span>map_poly complex_of_real <span class="main">(</span>reciprocal_poly <span class="free">p</span> <span class="free">P</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span><span class="main">.</span>
         order <span class="bound">r</span> <span class="main">(</span>map_poly complex_of_real <span class="main">(</span>reciprocal_poly <span class="free">p</span> <span class="free">P</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword3"><span class="command">thus</span></span> 
        <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> order <span class="skolem">x</span> <span class="main">(</span>map_poly complex_of_real <span class="main">(</span>reciprocal_poly <span class="free">p</span> <span class="free">P</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
         proots_count <span class="main">(</span>map_poly complex_of_real <span class="main">(</span>reciprocal_poly <span class="free">p</span> <span class="free">P</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span><span class="main">)</span>
         <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> Re <span class="bound">x</span><span class="main">}</span> <span class="main">≠</span> <span class="main">0</span> "</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> proots_count_def proots_within_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">x</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> coeff <span class="main">(</span>smult <span class="main">(</span>inverse <span class="main">(</span>lead_coeff <span class="var">?Q</span><span class="main">)</span><span class="main">)</span> <span class="var">?Q</span><span class="main">)</span> <span class="bound">i</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> descartes_sign_zero<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pcompose_eq_0 reciprocal_0_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"changes <span class="main">(</span>coeffs <span class="main">(</span>smult <span class="main">(</span>inverse <span class="main">(</span>lead_coeff <span class="var">?Q</span><span class="main">)</span><span class="main">)</span> <span class="var">?Q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> changes_all_nonneg<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nth_default_coeffs_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"changes <span class="main">(</span>coeffs <span class="var">?Q</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> hQ <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> coeffs_smult changes_scale_const<span class="main">)</span>

  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Bernstein_changes_01_eq_changes<span class="main"><span class="main">[</span></span><span class="quoted"><span class="operator">"OF"</span></span> hP<span class="main"><span class="main">]</span></span><span class="main">)</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">circle_diam</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real <span class="main">⇒</span> complex set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">circle_diam</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> cmod <span class="main">(</span><span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span><span class="main">}</span>"</span></span>

<span class="keyword1" id="Three_Circles-circle_diam_rescale"><span class="command">lemma</span></span> circle_diam_rescale<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">&lt;</span> <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"circle_diam <span class="free">l</span> <span class="free">r</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span> <span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">*</span><span class="main">(</span><span class="free">r</span> <span class="main">-</span> <span class="free">l</span><span class="main">)</span> <span class="main">+</span> <span class="free">l</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> circle_01_diam"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"circle_diam <span class="free">l</span> <span class="free">r</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span>complex_of_real <span class="free">r</span> <span class="main">-</span> complex_of_real <span class="free">l</span><span class="main">)</span> <span class="main">+</span>
        complex_of_real <span class="free">l</span><span class="main">)</span> <span class="main">`</span> circle_01_diam"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> circle_diam <span class="free">l</span> <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"cmod <span class="main">(</span><span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="free">l</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="free">r</span> <span class="main">-</span> <span class="free">l</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="free">r</span> <span class="main">-</span> <span class="free">l</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> circle_diam_def<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"cmod <span class="main">(</span><span class="main">(</span><span class="free">r</span> <span class="main">-</span> <span class="free">l</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="free">l</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="free">r</span> <span class="main">-</span> <span class="free">l</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="free">r</span> <span class="main">-</span> <span class="free">l</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> right_diff_distrib<span class="main"><span class="keyword3">,</span></span> <span class="operator">fastforce</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span> <span class="main">-</span> <span class="free">l</span><span class="main">)</span> <span class="main">*</span> cmod <span class="main">(</span><span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="free">l</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="free">r</span> <span class="main">-</span> <span class="free">l</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="free">r</span> <span class="main">-</span> <span class="free">l</span><span class="main">)</span> <span class="main">*</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span><span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> abs_of_pos<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> norm_scaleR<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> scaleR_conv_of_real<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"cmod <span class="main">(</span><span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="free">l</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="free">r</span> <span class="main">-</span> <span class="free">l</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> mult_less_cancel_left_pos<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">r</span></span><span class="main"><span class="main">-</span></span><span class="free"><span class="free">l</span></span>"</span></span></span><span class="main"><span class="main">,</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span>
      <span class="quoted"><span class="quoted">"cmod <span class="main">(</span><span class="main">(</span><span class="skolem">x</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="free">r</span><span class="main">-</span><span class="free">l</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">∧</span>
       <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span><span class="main">-</span><span class="free">l</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="free">r</span><span class="main">-</span><span class="free">l</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>complex_of_real <span class="free">r</span> <span class="main">-</span> complex_of_real <span class="free">l</span><span class="main">)</span> <span class="main">+</span> complex_of_real <span class="free">l</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span>complex_of_real <span class="free">r</span> <span class="main">-</span> complex_of_real <span class="free">l</span><span class="main">)</span> <span class="main">+</span> complex_of_real <span class="free">l</span><span class="main">)</span> <span class="main">`</span>
          circle_01_diam"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> circle_01_diam_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span>complex_of_real <span class="free">r</span> <span class="main">-</span> complex_of_real <span class="free">l</span><span class="main">)</span> <span class="main">+</span> complex_of_real <span class="free">l</span><span class="main">)</span> <span class="main">`</span>
        circle_01_diam <span class="main">⊆</span> circle_diam <span class="free">l</span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span><span class="main">::</span><span class="quoted">complex</span>
    <span class="keyword3"><span class="command">assume</span></span>
      <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span>complex_of_real <span class="free">r</span> <span class="main">-</span> complex_of_real <span class="free">l</span><span class="main">)</span> <span class="main">+</span> complex_of_real <span class="free">l</span><span class="main">)</span> <span class="main">`</span>
       circle_01_diam"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span><span class="main">::</span><span class="quoted">complex</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">*</span> <span class="main">(</span><span class="free">r</span> <span class="main">-</span> <span class="free">l</span><span class="main">)</span> <span class="main">+</span> <span class="free">l</span>"</span></span> <span class="quoted"><span class="quoted">"cmod <span class="main">(</span><span class="skolem">y</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> circle_01_diam_def<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="free">l</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free">r</span> <span class="main">-</span> <span class="free">l</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cmod <span class="main">(</span><span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="free">l</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free">r</span> <span class="main">-</span> <span class="free">l</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span> <span class="main">-</span> <span class="free">l</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>cmod <span class="main">(</span><span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="free">l</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free">r</span> <span class="main">-</span> <span class="free">l</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="free">r</span> <span class="main">-</span> <span class="free">l</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> mult_less_cancel_left_pos<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"cmod <span class="main">(</span><span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="free">l</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="free">r</span> <span class="main">-</span> <span class="free">l</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="free">r</span> <span class="main">-</span> <span class="free">l</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span><span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> abs_of_pos<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">argo</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span><span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> norm_scaleR<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> del_insts<span class="main"><span class="main">)</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">*</span> complex_of_real <span class="main">(</span><span class="free">r</span> <span class="main">-</span> <span class="free">l</span><span class="main">)</span> <span class="main">+</span> complex_of_real <span class="free">l</span>›</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> complex_of_real <span class="free">l</span><span class="main">)</span> <span class="main">/</span> complex_of_real <span class="main">(</span><span class="free">r</span> <span class="main">-</span> <span class="free">l</span><span class="main">)</span>›</span></span>
          add_diff_cancel divide_divide_eq_right divide_numeral_1 mult.commute
          of_real_1 of_real_add of_real_divide one_add_one scaleR_conv_of_real
          scale_right_diff_distrib times_divide_eq_right<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> circle_diam <span class="free">l</span> <span class="free">r</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> circle_diam_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Three_Circles-one_circle"><span class="command">lemma</span></span> one_circle<span class="main">:</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">P</span><span class="main">::</span><span class="quoted"><span class="quoted">"real poly"</span></span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">&lt;</span> <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="main">(</span>map_poly of_real <span class="free">P</span><span class="main">)</span> <span class="main">(</span>circle_diam <span class="free">l</span> <span class="free">r</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">P</span> <span class="main">≤</span> <span class="free">p</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Bernstein_changes <span class="free">p</span> <span class="free">l</span> <span class="free">r</span> <span class="free">P</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> Bernstein_changes_eq_rescale<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">≠</span> <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">P</span> <span class="main">≤</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Bernstein_changes_01 <span class="free">p</span> <span class="main">(</span><span class="free">P</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="free">l</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">0</span><span class="main">,</span> <span class="free">r</span> <span class="main">-</span> <span class="free">l</span><span class="main">:]</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> one_circle_01<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span><span class="free">P</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="free">l</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">0</span><span class="main">,</span> <span class="free">r</span> <span class="main">-</span> <span class="free">l</span><span class="main">:]</span><span class="main">)</span> <span class="main">≤</span> <span class="free">p</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> degree_pcompose<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="free">l</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">0</span><span class="main">,</span> <span class="free">r</span> <span class="main">-</span> <span class="free">l</span><span class="main">:]</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> degree_0_iff gr_zeroI pCons_eq_0_iff pCons_eq_iff
                      pcompose_eq_0<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="main">(</span>map_poly of_real <span class="free">P</span><span class="main">)</span> <span class="main">(</span>circle_diam <span class="free">l</span> <span class="free">r</span><span class="main">)</span> <span class="main">=</span> 
          proots_count <span class="main">(</span>map_poly complex_of_real <span class="main">(</span><span class="free">P</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="free">l</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">0</span><span class="main">,</span> <span class="free">r</span> <span class="main">-</span> <span class="free">l</span><span class="main">:]</span><span class="main">)</span><span class="main">)</span>
          circle_01_diam"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> of_real_hom.map_poly_pcompose<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> proots_pcompose<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> degree_eq_zeroE of_real_poly_eq_0_iff
          pCons_eq_iff pCons_one pcompose_eq_0 zero_neq_one<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> of_real_hom.map_poly_pcompose<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> proots_pcompose<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>2<span class="main"><span class="keyword3">]</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> circle_diam_rescale<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> arg_cong<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"proots_count <span class="main"><span class="main">(</span></span>map_poly complex_of_real <span class="free"><span class="free">P</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="main">(</span>map_poly complex_of_real <span class="main">(</span><span class="free">P</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="free">l</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">0</span><span class="main">,</span> <span class="free">r</span> <span class="main">-</span> <span class="free">l</span><span class="main">:]</span><span class="main">)</span><span class="main">)</span>
          circle_01_diam <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹One sign change case›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">upper_circle_01</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">upper_circle_01</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> cmod <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">+</span> sqrt<span class="main">(</span><span class="numeral">3</span><span class="main">)</span><span class="main">/</span><span class="numeral">6</span> <span class="main">*</span> <span class="keyword1">𝗂</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> sqrt <span class="numeral">3</span> <span class="main">/</span> <span class="numeral">3</span><span class="main">}</span>"</span></span>

<span class="keyword1" id="Three_Circles-upper_circle_map"><span class="command">lemma</span></span> upper_circle_map<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">::</span>complex<span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> Im <span class="bound">x</span> <span class="main">&lt;</span> sqrt <span class="numeral">3</span> <span class="main">*</span> Re <span class="bound">x</span><span class="main">}</span><span class="main">}</span> <span class="main">=</span> upper_circle_01"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">::</span>complex<span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> Im <span class="bound">x</span> <span class="main">&lt;</span> sqrt <span class="numeral">3</span> <span class="main">*</span> Re <span class="bound">x</span><span class="main">}</span><span class="main">}</span> <span class="main">⊆</span> upper_circle_01"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> Im <span class="bound">x</span> <span class="main">&lt;</span> sqrt <span class="numeral">3</span> <span class="main">*</span> Re <span class="bound">x</span><span class="main">}</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">/</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"Im <span class="skolem">y</span> <span class="main">&lt;</span> sqrt <span class="numeral">3</span> <span class="main">*</span> Re <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">hence</span></span> hy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="skolem">x</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> hx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="skolem">y</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> h <span class="keyword1"><span class="command">have</span></span> hy1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≠</span> <span class="main">-</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">hence</span></span> hx0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hy <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">from</span></span> h <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> Re <span class="main">(</span><span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">+</span> sqrt <span class="numeral">3</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"cmod <span class="main">(</span><span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">+</span> sqrt <span class="numeral">3</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">y</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">&lt;</span> cmod <span class="main">(</span><span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">+</span> sqrt <span class="numeral">3</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">y</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cmod_def power2_eq_square <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"cmod <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">+</span> sqrt <span class="numeral">3</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">y</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">+</span> sqrt <span class="numeral">3</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">y</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> norm_divide <span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cmod <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">+</span> sqrt <span class="numeral">3</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">y</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">+</span> sqrt <span class="numeral">3</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">y</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
               cmod <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">+</span> sqrt <span class="numeral">3</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">y</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">+</span> sqrt <span class="numeral">3</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">y</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> mult_divide_mult_cancel_right<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> hx0<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> ring_distribs<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">x</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> left_diff_distrib<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">x</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> cmod
       <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="main">1</span> <span class="main">-</span> complex_of_real <span class="main">(</span>sqrt <span class="numeral">3</span><span class="main">)</span> <span class="main">-</span> <span class="keyword1">𝗂</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">+</span> <span class="main">(</span>complex_of_real <span class="main">(</span>sqrt <span class="numeral">3</span><span class="main">)</span> <span class="main">+</span> <span class="keyword1">𝗂</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span>
       <span class="main">(</span><span class="main">(</span> <span class="main">1</span> <span class="main">-</span> complex_of_real <span class="main">(</span>sqrt <span class="numeral">3</span><span class="main">)</span> <span class="main">-</span> <span class="keyword1">𝗂</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">+</span> <span class="main">(</span>complex_of_real <span class="main">(</span>sqrt <span class="numeral">3</span><span class="main">)</span> <span class="main">+</span> <span class="keyword1">𝗂</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> hy <span class="dynamic"><span class="dynamic">algebra_simps</span></span> hx0<span class="main">)</span>

    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> 
      <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> cmod <span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="main">1</span> <span class="main">-</span> complex_of_real <span class="main">(</span>sqrt <span class="numeral">3</span><span class="main">)</span> <span class="main">-</span> <span class="keyword1">𝗂</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">+</span>
                   <span class="main">(</span>complex_of_real <span class="main">(</span>sqrt <span class="numeral">3</span><span class="main">)</span> <span class="main">+</span> <span class="keyword1">𝗂</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span>
             cmod <span class="main">(</span><span class="main">(</span> <span class="main">1</span> <span class="main">-</span> complex_of_real <span class="main">(</span>sqrt <span class="numeral">3</span><span class="main">)</span> <span class="main">-</span> <span class="keyword1">𝗂</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">+</span>
                   <span class="main">(</span>complex_of_real <span class="main">(</span>sqrt <span class="numeral">3</span><span class="main">)</span> <span class="main">+</span> <span class="keyword1">𝗂</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> norm_divide<span class="main">)</span>
    
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 
      <span class="quoted"><span class="quoted">"cmod <span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="main">1</span> <span class="main">-</span> complex_of_real <span class="main">(</span>sqrt <span class="numeral">3</span><span class="main">)</span> <span class="main">-</span> <span class="keyword1">𝗂</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">+</span> <span class="main">(</span>complex_of_real <span class="main">(</span>sqrt <span class="numeral">3</span><span class="main">)</span> <span class="main">+</span> <span class="keyword1">𝗂</span><span class="main">)</span><span class="main">)</span>
       <span class="main">&lt;</span> cmod <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> complex_of_real <span class="main">(</span>sqrt <span class="numeral">3</span><span class="main">)</span> <span class="main">-</span> <span class="keyword1">𝗂</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">+</span> <span class="main">(</span>complex_of_real <span class="main">(</span>sqrt <span class="numeral">3</span><span class="main">)</span> <span class="main">+</span> <span class="keyword1">𝗂</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> divide_less_eq_1_pos<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> zero_less_norm_iff<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> complex_of_real <span class="main">(</span>sqrt <span class="numeral">3</span><span class="main">)</span> <span class="main">-</span> <span class="keyword1">𝗂</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">+</span> <span class="main">(</span>complex_of_real <span class="main">(</span>sqrt <span class="numeral">3</span><span class="main">)</span> <span class="main">+</span> <span class="keyword1">𝗂</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="keyword1">𝗂</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≠</span> complex_of_real <span class="main">(</span>sqrt <span class="numeral">3</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> complex_eq_iff<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> complex_of_real <span class="main">(</span>sqrt <span class="numeral">3</span><span class="main">)</span> <span class="main">-</span> <span class="keyword1">𝗂</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">+</span> <span class="main">(</span>complex_of_real <span class="main">(</span>sqrt <span class="numeral">3</span><span class="main">)</span> <span class="main">+</span> <span class="keyword1">𝗂</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span>
          <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span>complex_of_real <span class="main">(</span>sqrt <span class="numeral">3</span><span class="main">)</span> <span class="main">-</span> <span class="keyword1">𝗂</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> complex_of_real <span class="main">(</span>sqrt <span class="numeral">3</span><span class="main">)</span> <span class="main">-</span> <span class="keyword1">𝗂</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
          <span class="keyword1"><span class="command">using</span></span> h <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> hy <span class="dynamic"><span class="dynamic">field_simps</span></span> Im_divide Re_divide<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"cmod <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">+</span> sqrt<span class="main">(</span><span class="numeral">3</span><span class="main">)</span><span class="main">/</span><span class="numeral">6</span> <span class="main">*</span> <span class="keyword1">𝗂</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> sqrt <span class="numeral">3</span> <span class="main">/</span> <span class="numeral">3</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span><span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> abs_of_pos<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral">3</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> real_sqrt_abs2<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> real_sqrt_divide<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> cmod_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> real_sqrt_less_iff<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> mult_right_less_imp_less<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"sqrt <span class="numeral"><span class="numeral">3</span></span> <span class="main"><span class="main">/</span></span><span class="numeral"><span class="numeral">3</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cmod_def power2_eq_square <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>

    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> upper_circle_01"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> upper_circle_01_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"upper_circle_01 <span class="main">⊆</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> sqrt <span class="numeral">3</span> <span class="main">*</span> Re <span class="bound">x</span> <span class="main">&gt;</span> Im <span class="bound">x</span><span class="main">}</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> upper_circle_01"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"cmod <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">+</span> sqrt<span class="main">(</span><span class="numeral">3</span><span class="main">)</span><span class="main">/</span><span class="numeral">6</span> <span class="main">*</span> <span class="keyword1">𝗂</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> sqrt <span class="numeral">3</span> <span class="main">/</span> <span class="numeral">3</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> upper_circle_01_def<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sqrt <span class="main">(</span><span class="main">(</span>Re <span class="skolem">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="main">(</span>Im <span class="skolem">x</span> <span class="main">-</span> sqrt<span class="main">(</span><span class="numeral">3</span><span class="main">)</span><span class="main">/</span><span class="numeral">6</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">&lt;</span> sqrt <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">3</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cmod_def sqrt_divide_self_eq real_sqrt_inverse<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span> Im <span class="skolem">x</span> <span class="main">*</span> sqrt <span class="numeral">3</span> <span class="main">+</span> <span class="main">(</span>Im <span class="skolem">x</span> <span class="main">*</span> <span class="main">(</span>Im <span class="skolem">x</span> <span class="main">*</span> <span class="numeral">3</span><span class="main">)</span> <span class="main">+</span> Re <span class="skolem">x</span> <span class="main">*</span> <span class="main">(</span>Re <span class="skolem">x</span> <span class="main">*</span> <span class="numeral">3</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> Re <span class="skolem">x</span> <span class="main">*</span> <span class="numeral">3</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> power2_eq_square <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span> Im <span class="skolem">x</span> <span class="main">+</span> <span class="main">(</span>Im <span class="skolem">x</span> <span class="main">*</span> <span class="main">(</span>Im <span class="skolem">x</span> <span class="main">*</span> sqrt <span class="numeral">3</span><span class="main">)</span> <span class="main">+</span> Re <span class="skolem">x</span> <span class="main">*</span> <span class="main">(</span>Re <span class="skolem">x</span> <span class="main">*</span> sqrt <span class="numeral">3</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> Re <span class="skolem">x</span> <span class="main">*</span> sqrt <span class="numeral">3</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> mult_right_less_imp_less<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"sqrt <span class="numeral"><span class="numeral">3</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> mult.assoc<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"sqrt <span class="numeral"><span class="numeral">3</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> real_sqrt_mult_self<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sqrt <span class="numeral">3</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span>Im <span class="skolem">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>Im <span class="skolem">x</span> <span class="main">*</span> Im <span class="skolem">x</span> <span class="main">+</span> Re <span class="skolem">x</span> <span class="main">*</span> Re <span class="skolem">x</span><span class="main">)</span> <span class="main">&lt;</span>
          Re <span class="skolem">x</span> <span class="main">*</span> sqrt <span class="numeral">3</span> <span class="main">/</span> <span class="main">(</span>Im <span class="skolem">x</span> <span class="main">*</span> Im <span class="skolem">x</span> <span class="main">+</span> Re <span class="skolem">x</span> <span class="main">*</span> Re <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> mult_right_less_imp_less<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span>Im <span class="skolem"><span class="skolem">x</span></span> <span class="main"><span class="main">*</span></span> Im <span class="skolem"><span class="skolem">x</span></span> <span class="main"><span class="main">+</span></span> Re <span class="skolem"><span class="skolem">x</span></span> <span class="main"><span class="main">*</span></span> Re <span class="skolem"><span class="skolem">x</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subst<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> arg_cong2<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">(&lt;)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 3 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> 2<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> distrib_right<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>

    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="main">-</span> Im <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">x</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">+</span> sqrt <span class="numeral">3</span> <span class="main">*</span> Re <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">x</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> power2_eq_square <span class="dynamic"><span class="dynamic">algebra_simps</span></span> Re_divide Im_divide<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sqrt <span class="numeral">3</span> <span class="main">*</span> Re <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">x</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">&gt;</span> Im <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">x</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">x</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> sqrt <span class="numeral">3</span> <span class="main">*</span> Re <span class="bound">x</span> <span class="main">&gt;</span> Im <span class="bound">x</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">x</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> sqrt <span class="numeral">3</span> <span class="main">*</span> Re <span class="bound">x</span> <span class="main">&gt;</span> Im <span class="bound">x</span><span class="main">}</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">lower_circle_01</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">lower_circle_01</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> cmod <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">-</span> sqrt<span class="main">(</span><span class="numeral">3</span><span class="main">)</span><span class="main">/</span><span class="numeral">6</span> <span class="main">*</span> <span class="keyword1">𝗂</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> sqrt <span class="numeral">3</span> <span class="main">/</span> <span class="numeral">3</span><span class="main">}</span>"</span></span>

<span class="keyword1" id="Three_Circles-cnj_upper_circle_01"><span class="command">lemma</span></span> cnj_upper_circle_01<span class="main">:</span> <span class="quoted"><span class="quoted">"cnj <span class="main">`</span> upper_circle_01 <span class="main">=</span> lower_circle_01"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"cnj <span class="main">`</span> upper_circle_01 <span class="main">⊆</span> lower_circle_01"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> cnj <span class="main">`</span> upper_circle_01"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> upper_circle_01"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> cnj <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> lower_circle_01"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> lower_circle_01_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> complex_mod_cnj<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> upper_circle_01_def <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> complex_mod_cnj<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"lower_circle_01 <span class="main">⊆</span> cnj <span class="main">`</span> upper_circle_01"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> lower_circle_01"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"cnj <span class="skolem">x</span> <span class="main">∈</span> upper_circle_01"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> cnj <span class="main">(</span>cnj <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> upper_circle_01_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> complex_mod_cnj<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lower_circle_01_def <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> complex_mod_cnj<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> cnj <span class="main">`</span> upper_circle_01"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Three_Circles-lower_circle_map"><span class="command">lemma</span></span> lower_circle_map<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">::</span>complex<span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> Im <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">-</span> sqrt <span class="numeral">3</span> <span class="main">*</span> Re <span class="bound">x</span><span class="main">}</span><span class="main">}</span> <span class="main">=</span> lower_circle_01"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> cnj_upper_circle_01<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> upper_circle_map<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span> sqrt <span class="numeral">3</span> <span class="main">*</span> Re <span class="bound">x</span> <span class="main">&lt;</span> Im <span class="bound">x</span><span class="main">}</span><span class="main">}</span> <span class="main">=</span> 
        <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> sqrt <span class="numeral">3</span> <span class="main">*</span> Re <span class="main">(</span>cnj <span class="bound">x</span><span class="main">)</span> <span class="main">&gt;</span> Im <span class="main">(</span>cnj <span class="bound">x</span><span class="main">)</span><span class="main">}</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">`</span> cnj <span class="main">`</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> sqrt <span class="numeral">3</span> <span class="main">*</span> Re <span class="bound">x</span> <span class="main">&gt;</span> Im <span class="bound">x</span><span class="main">}</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span><span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> bij_image_Collect_eq<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> bijI' complex_cnj_cnj<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inj_def inj_imp_inv_eq<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted">cnj</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">x</span> <span class="main">∈</span> cnj <span class="main">`</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> sqrt <span class="numeral">3</span> <span class="main">*</span> Re <span class="bound">x</span> <span class="main">&gt;</span> Im <span class="bound">x</span><span class="main">}</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> image_image<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> cnj <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> sqrt <span class="numeral">3</span> <span class="main">*</span> Re <span class="bound">x</span> <span class="main">&gt;</span> Im <span class="bound">x</span><span class="main">}</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> complex_cnj_cnj image_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> cnj <span class="main">`</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> sqrt <span class="numeral">3</span> <span class="main">*</span> Re <span class="bound">x</span> <span class="main">&gt;</span> Im <span class="bound">x</span><span class="main">}</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span><span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> bij_image_Collect_eq<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> bijI' complex_cnj_cnj<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inj_def inj_imp_inv_eq<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted">cnj</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span> sqrt <span class="numeral">3</span> <span class="main">*</span> Re <span class="bound">x</span> <span class="main">&lt;</span> Im <span class="bound">x</span><span class="main">}</span><span class="main">}</span> <span class="main">=</span>
          cnj <span class="main">`</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> Im <span class="bound">x</span> <span class="main">&lt;</span> sqrt <span class="numeral">3</span> <span class="main">*</span> Re <span class="bound">x</span><span class="main">}</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Three_Circles-two_circles_01"><span class="command">lemma</span></span> two_circles_01<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">P</span><span class="main">::</span><span class="quoted"><span class="quoted">"real poly"</span></span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> hP<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">P</span> <span class="main">≤</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> hP0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> hp0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"proots_count <span class="main">(</span>map_poly of_real <span class="free">P</span><span class="main">)</span> 
          <span class="main">(</span>upper_circle_01 <span class="main">∪</span> lower_circle_01<span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Bernstein_changes_01 <span class="free">p</span> <span class="free">P</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> Bernstein_changes_01_eq_changes<span class="main"><span class="main">[</span></span><span class="operator">OF</span> hP<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Q</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"reciprocal_poly <span class="free">p</span> <span class="free">P</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> hQ0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?Q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hP0
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pcompose_eq_0 hP reciprocal_0_iff<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> h <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x'</span></span> <span class="keyword2"><span class="keyword">where</span></span> hroot'<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span>map_poly of_real <span class="free">P</span><span class="main">)</span> <span class="skolem">x'</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> hx'<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x'</span> <span class="main">∈</span> upper_circle_01 <span class="main">∪</span> lower_circle_01"</span></span>
    <span class="keyword1"><span class="command">using</span></span> proots_count_pos <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_numeral_extra<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>

  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> hxx'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x'</span> <span class="main">=</span> complex_of_real <span class="skolem">x</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Im <span class="skolem">x'</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Im <span class="skolem">x'</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">x'</span> <span class="main">=</span> complex_of_real <span class="bound">x</span> <span class="main">⟹</span> <span class="skolem">thesis</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="skolem">thesis</span></span> <span class="keyword1"><span class="command">using</span></span> h<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Re <span class="skolem">x'</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> complex_is_Real_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> hx''<span class="main">:</span> <span class="quoted"><span class="quoted">"Im <span class="skolem">x'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="skolem">x'</span><span class="main">,</span> cnj <span class="skolem">x'</span><span class="main">}</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> card_2_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> hx'' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x'</span> <span class="main">≠</span> cnj <span class="skolem">x'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">x'</span><span class="main">,</span> cnj <span class="skolem">x'</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">x'</span><span class="main">,</span> cnj <span class="skolem">x'</span><span class="main">}</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> cnj.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> neg_equal_zero<span class="main"><span class="keyword3">,</span></span> <span class="operator">argo</span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">{</span><span class="skolem">x'</span><span class="main">,</span> cnj <span class="skolem">x'</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">}</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≠</span> <span class="bound">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">x'</span><span class="main">,</span> cnj <span class="skolem">x'</span><span class="main">}</span> <span class="main">⊆</span> upper_circle_01 <span class="main">∪</span> lower_circle_01"</span></span> <span class="keyword1"><span class="command">using</span></span> hx'
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> UnE<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cnj_upper_circle_01<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">x'</span><span class="main">,</span> cnj <span class="skolem">x'</span><span class="main">}</span> <span class="main">⟹</span> poly <span class="main">(</span>map_poly of_real <span class="free">P</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> hroot' poly_map_poly_of_real_cnj <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span>
      <span class="quoted"><span class="quoted">"proots_count <span class="main">(</span>map_poly of_real <span class="free">P</span><span class="main">)</span> <span class="main">(</span>upper_circle_01 <span class="main">∪</span> lower_circle_01<span class="main">)</span> <span class="main">≥</span> <span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> 1<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> proots_count_of_root_set<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> of_real_poly_eq_0_iff <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="skolem">thesis</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> hroot<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="free">P</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> hroot' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> of_real_0 of_real_eq_iff of_real_poly_map_poly<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> that<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span> <span class="main">*</span> sqrt <span class="main">(</span><span class="skolem">x</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">+</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">3</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">&lt;</span> sqrt <span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hx'
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> UnE<span class="main">)</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cmod_def power2_eq_square <span class="dynamic"><span class="dynamic">algebra_simps</span></span> upper_circle_01_def
        lower_circle_01_def hxx'<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> hx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">x</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span> <span class="main">*</span> sqrt <span class="main">(</span><span class="skolem">x</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">+</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">3</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> sqrt <span class="main">(</span><span class="numeral">9</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">+</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">3</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> real_sqrt_mult<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">9</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">+</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">3</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that real_sqrt_less_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">*</span><span class="skolem">x</span> <span class="main">-</span> <span class="skolem">x</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">x</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> mult_eq_0_iff mult_less_cancel_right_disj <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?y</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="skolem">x</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> hroot hx assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="var">?Q</span> <span class="var">?y</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> poly_pcompose poly_reciprocal<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="main">-</span><span class="var">?y</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="keyword1">dvd</span> <span class="var">?Q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> poly_eq_0_iff_dvd <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">R</span></span> <span class="keyword2"><span class="keyword">where</span></span> hR<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?Q</span> <span class="main">=</span> <span class="skolem">R</span> <span class="main">*</span> <span class="main">[:</span><span class="main">-</span><span class="var">?y</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> hR0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hQ0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">interpret</span></span> map_poly_idom_hom <span class="quoted">complex_of_real</span> <span class="keyword1"><span class="command">..</span></span>


  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"normal_poly <span class="main">(</span>smult <span class="main">(</span>inverse <span class="main">(</span>lead_coeff <span class="main">(</span>reciprocal_poly <span class="free">p</span> <span class="free">P</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">R</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> normal_poly_of_roots<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">z</span><span class="main">.</span> poly <span class="main">(</span>map_poly complex_of_real
          <span class="main">(</span>smult <span class="main">(</span>inverse <span class="main">(</span>lead_coeff <span class="main">(</span>reciprocal_poly <span class="free">p</span> <span class="free">P</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">R</span><span class="main">)</span><span class="main">)</span> <span class="bound">z</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span>
          Re <span class="bound">z</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">(</span>cmod <span class="bound">z</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">≤</span> <span class="numeral">4</span> <span class="main">*</span> <span class="main">(</span>Re <span class="bound">z</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span>
      <span class="keyword3"><span class="command">assume</span></span>
        <span class="quoted"><span class="quoted">"poly <span class="main">(</span>map_poly complex_of_real
         <span class="main">(</span>smult <span class="main">(</span>inverse <span class="main">(</span>lead_coeff <span class="main">(</span>reciprocal_poly <span class="free">p</span> <span class="free">P</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">R</span><span class="main">)</span><span class="main">)</span> <span class="skolem">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> hroot2<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span>map_poly complex_of_real <span class="skolem">R</span><span class="main">)</span> <span class="skolem">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> map_poly_smult hQ0<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">z</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">(</span>cmod <span class="skolem">z</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">≤</span> <span class="numeral">4</span> <span class="main">*</span> <span class="main">(</span>Re <span class="skolem">z</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>Re <span class="skolem">z</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">(</span>cmod <span class="skolem">z</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">≤</span> <span class="numeral">4</span> <span class="main">*</span> <span class="main">(</span>Re <span class="skolem">z</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> Re <span class="skolem">z</span> <span class="main">∨</span> <span class="numeral">4</span> <span class="main">*</span> <span class="main">(</span>Re <span class="skolem">z</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&lt;</span> <span class="main">(</span>cmod <span class="skolem">z</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
        <span class="keyword1"><span class="command">hence</span></span> hz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≠</span> <span class="main">-</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Im <span class="skolem">z</span> <span class="main">&gt;</span> <span class="main">-</span> sqrt <span class="numeral">3</span> <span class="main">*</span> Re <span class="skolem">z</span> <span class="main">∨</span> sqrt <span class="numeral">3</span> <span class="main">*</span> Re <span class="skolem">z</span> <span class="main">&gt;</span> Im <span class="skolem">z</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Im <span class="skolem">z</span> <span class="main">≥</span> sqrt <span class="numeral">3</span> <span class="main">*</span> Re <span class="skolem">z</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">-</span> sqrt <span class="numeral">3</span> <span class="main">*</span> Re <span class="skolem">z</span> <span class="main">≥</span> Im <span class="skolem">z</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">assume</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"sqrt <span class="numeral">3</span> <span class="main">*</span> Re <span class="skolem">z</span> <span class="main">≤</span> Im <span class="skolem">z</span>"</span></span> <span class="quoted"><span class="quoted">"Im <span class="skolem">z</span> <span class="main">≤</span> <span class="main">-</span> sqrt <span class="numeral">3</span> <span class="main">*</span> Re <span class="skolem">z</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sqrt <span class="numeral">3</span> <span class="main">*</span> Re <span class="skolem">z</span> <span class="main">≤</span> sqrt <span class="numeral">3</span> <span class="main">*</span> <span class="main">-</span> Re <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">z</span> <span class="main">≤</span> <span class="main">-</span> Re <span class="skolem">z</span>"</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> mult_left_le_imp_le<span class="main">)</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">z</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Im <span class="skolem">z</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">≤</span> <span class="main">(</span><span class="main">-</span>sqrt <span class="numeral">3</span> <span class="main">*</span> Re <span class="skolem">z</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> power2_eq_square<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> power2_eq_square<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> square_bounded_le<span class="main">)</span>
            <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> 1 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> power2_eq_square cmod_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
        <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">z</span><span class="main">.</span> <span class="main">-</span> sqrt <span class="numeral">3</span> <span class="main">*</span> Re <span class="bound">z</span> <span class="main">&lt;</span> Im <span class="bound">z</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">z</span><span class="main">.</span> Im <span class="bound">z</span> <span class="main">&lt;</span> sqrt <span class="numeral">3</span> <span class="main">*</span> Re <span class="bound">z</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

        <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"inverse <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">∈</span> upper_circle_01 <span class="main">∪</span> lower_circle_01"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inverse_eq_divide upper_circle_map<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span>
              lower_circle_map<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        
        <span class="keyword1"><span class="command">have</span></span> hRdeg'<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="skolem">R</span> <span class="main">&lt;</span> <span class="free">p</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> less_le_trans<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"degree <span class="skolem"><span class="skolem">R</span></span>"</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"degree <span class="var"><span class="var">?Q</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> hR<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> degree_mult_eq<span class="main"><span class="main">[</span></span><span class="operator">OF</span> hR0<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">fastforce</span><span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> degree_pcompose degree_reciprocal hP<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> hRdeg<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="skolem">R</span> <span class="main">≤</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"map_poly complex_of_real <span class="main">(</span>reciprocal_poly <span class="free">p</span> <span class="main">(</span><span class="skolem">R</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">-</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> of_real_poly_eq_0_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> reciprocal_0_iff<span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> hRdeg degree_pcompose<span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> hR0 pcompose_eq_0
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> degree_eq_zeroE gr_zeroI pCons_eq_iff pCons_one zero_neq_one<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> 
          <span class="quoted"><span class="quoted">"poly <span class="main">(</span>map_poly complex_of_real <span class="main">(</span>reciprocal_poly <span class="free">p</span> <span class="main">(</span><span class="skolem">R</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">-</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                 <span class="main">(</span>inverse <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> map_poly_reciprocal<span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> hRdeg <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> degree_pcompose<span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> poly_reciprocal<span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> hRdeg <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> degree_map_poly degree_pcompose<span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> hz <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> inverse_nonzero_iff_nonzero neg_eq_iff_add_eq_0<span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> of_real_hom.map_poly_pcompose poly_pcompose hroot2<span class="main">)</span>
        
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="main">(</span>map_poly of_real <span class="main">(</span>reciprocal_poly <span class="free">p</span> <span class="main">(</span><span class="skolem">R</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">-</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
               <span class="main">(</span>upper_circle_01 <span class="main">∪</span> lower_circle_01<span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> proots_count_of_root<span class="main"><span class="main">[</span></span><span class="operator">OF</span> 2 1 3<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_count
                     <span class="main">(</span>map_poly complex_of_real
                     <span class="main">(</span>reciprocal_poly <span class="free">p</span> <span class="main">(</span><span class="main">[:</span><span class="main">1</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="skolem">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">-</span> <span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                     <span class="main">(</span>upper_circle_01 <span class="main">∪</span> lower_circle_01<span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> map_poly_reciprocal<span class="main">)</span>
            <span class="keyword1"><span class="command">using</span></span> hp0 less_eq_Suc_le <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> degree_pcompose<span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> proots_count_reciprocal<span class="main">)</span>
            <span class="keyword1"><span class="command">using</span></span> hp0 less_eq_Suc_le
               <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> degree_pcompose degree_map_poly<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pcompose_pCons<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
             <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cmod_def power2_eq_square real_sqrt_divide
                    real_div_sqrt upper_circle_01_def lower_circle_01_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> of_real_hom.map_poly_pcompose<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> proots_pcompose<span class="main"><span class="keyword3">,</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> lower_circle_map<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> upper_circle_map<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> proots_count_of_root<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"of_real <span class="main"><span class="main">(</span></span><span class="main"><span class="main">1</span></span><span class="main"><span class="main">/</span></span><span class="skolem"><span class="skolem">x</span></span> <span class="main"><span class="main">-</span></span> <span class="main"><span class="main">1</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
             <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bij_image_Collect_eq bij_def inj_def image_iff
                    inverse_eq_divide inj_imp_inv_eq<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">+</span><span class="main">1</span>"</span></span><span class="main"><span class="main">]</span></span> hx<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_count
                 <span class="main">(</span>map_poly complex_of_real <span class="main">(</span>reciprocal_poly <span class="free">p</span> <span class="main">(</span><span class="skolem">R</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">-</span> <span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                 <span class="main">(</span>upper_circle_01 <span class="main">∪</span> lower_circle_01<span class="main">)</span> <span class="main">+</span>
            proots_count
             <span class="main">(</span>map_poly complex_of_real
               <span class="main">(</span>reciprocal_poly <span class="free">p</span> <span class="main">(</span><span class="main">[:</span><span class="main">1</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="skolem">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">-</span> <span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
             <span class="main">(</span>upper_circle_01 <span class="main">∪</span> lower_circle_01<span class="main">)</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> proots_count <span class="main">(</span>map_poly complex_of_real
                   <span class="main">(</span>monom <span class="main">1</span> <span class="free">p</span> <span class="main">*</span> reciprocal_poly <span class="free">p</span> <span class="main">(</span><span class="var">?Q</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">-</span> <span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
           <span class="main">(</span>upper_circle_01 <span class="main">∪</span> lower_circle_01<span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> eq_commute<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> hR<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> pcompose_mult<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> reciprocal_mult<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> degree_mult_eq<span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> hR0 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pcompose_eq_0<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pcompose_pCons<span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> hRdeg' <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> degree_pcompose<span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> hRdeg <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> degree_pcompose<span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> hp0 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> degree_pcompose<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> hom_mult<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> proots_count_times<span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> hp0 hRdeg' hR0
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> reciprocal_0_iff degree_pcompose pcompose_eq_0
                 pcompose_pCons<span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> proots_count
           <span class="main">(</span>map_poly complex_of_real
             <span class="main">(</span>reciprocal_poly <span class="free">p</span> <span class="main">(</span>reciprocal_poly <span class="free">p</span> <span class="free">P</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">-</span> <span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
           <span class="main">(</span>upper_circle_01 <span class="main">∪</span> lower_circle_01<span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> hom_mult<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> proots_count_times<span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> hp0 hP hP0 
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> map_poly_reciprocal degree_pcompose
                  degree_reciprocal of_real_hom.map_poly_pcompose
                  reciprocal_0_iff degree_map_poly pcompose_eq_0<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> map_poly_monom<span class="main"><span class="keyword3">,</span></span> <span class="operator">fastforce</span><span class="main">)</span> 
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> of_real_1<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> proots_count_monom<span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cmod_def power2_eq_square real_sqrt_divide
                  real_div_sqrt upper_circle_01_def lower_circle_01_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pcompose_assoc<span class="main"><span class="main">[</span></span><span class="quoted"><span class="operator">"symmetric"</span></span><span class="main"><span class="main">]</span></span> pcompose_pCons
              reciprocal_reciprocal hP h<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
   <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"lead_coeff
         <span class="main">(</span>smult <span class="main">(</span>inverse <span class="main">(</span>lead_coeff <span class="main">(</span>reciprocal_poly <span class="free">p</span> <span class="free">P</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">R</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> hR degree_add_eq_right hR0 coeff_eq_0<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"changes <span class="main">(</span>coeffs <span class="main">(</span>smult <span class="main">(</span>inverse <span class="main">(</span>lead_coeff <span class="var">?Q</span><span class="main">)</span><span class="main">)</span> <span class="var">?Q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> hR<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> mult_smult_left<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> normal_changes<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> hx<span class="main">)</span>
  
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"changes <span class="main">(</span>coeffs <span class="main">(</span>reciprocal_poly <span class="free">p</span> <span class="free">P</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
      changes <span class="main">(</span>coeffs <span class="main">(</span>smult <span class="main">(</span>inverse <span class="main">(</span>lead_coeff <span class="main">(</span>reciprocal_poly <span class="free">p</span> <span class="free">P</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
        <span class="main">(</span>reciprocal_poly <span class="free">p</span> <span class="free">P</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pcompose_eq_0 reciprocal_0_iff hP hP0 coeffs_smult
        changes_scale_const<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"changes <span class="main">(</span>coeffs <span class="main">(</span>reciprocal_poly <span class="free">p</span> <span class="free">P</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">upper_circle</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real <span class="main">⇒</span> complex set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">upper_circle</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">::</span>complex<span class="main">.</span>
  cmod <span class="main">(</span><span class="main">(</span><span class="bound">x</span><span class="main">-</span>of_real <span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span><span class="main">/</span><span class="main">(</span>of_real <span class="main">(</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">-</span><span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">+</span> of_real <span class="main">(</span>sqrt<span class="main">(</span><span class="numeral">3</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="numeral">6</span> <span class="main">*</span> <span class="keyword1">𝗂</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> sqrt <span class="numeral">3</span> <span class="main">/</span> <span class="numeral">3</span><span class="main">}</span>"</span></span>

<span class="keyword1" id="Three_Circles-upper_circle_rescale"><span class="command">lemma</span></span> upper_circle_rescale<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">&lt;</span> <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"upper_circle <span class="free">l</span> <span class="free">r</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span> <span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">*</span><span class="main">(</span><span class="free">r</span> <span class="main">-</span> <span class="free">l</span><span class="main">)</span> <span class="main">+</span> <span class="free">l</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> upper_circle_01"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"upper_circle <span class="free">l</span> <span class="free">r</span> <span class="main">⊆</span>
        <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span>of_real <span class="free">r</span> <span class="main">-</span> of_real <span class="free">l</span><span class="main">)</span> <span class="main">+</span> of_real <span class="free">l</span><span class="main">)</span> <span class="main">`</span> upper_circle_01"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subsetI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> image_eqI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span><span class="main"><span class="main">_</span></span> <span class="main"><span class="main">-</span></span> of_real <span class="free"><span class="free">l</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">/</span></span><span class="main"><span class="main">(</span></span>of_real <span class="free"><span class="free">r</span></span> <span class="main"><span class="main">-</span></span> of_real <span class="free"><span class="free">l</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> upper_circle_01_def upper_circle_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span>of_real <span class="free">r</span> <span class="main">-</span> of_real <span class="free">l</span><span class="main">)</span> <span class="main">+</span> of_real <span class="free">l</span><span class="main">)</span> <span class="main">`</span> upper_circle_01 <span class="main">⊆</span>
        upper_circle <span class="free">l</span> <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subsetI<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span><span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> image_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> upper_circle_01_def upper_circle_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">lower_circle</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real <span class="main">⇒</span> complex set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">lower_circle</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">::</span>complex<span class="main">.</span>
 cmod <span class="main">(</span><span class="main">(</span><span class="bound">x</span><span class="main">-</span>of_real <span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span><span class="main">/</span><span class="main">(</span>of_real <span class="main">(</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">-</span><span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">-</span> of_real <span class="main">(</span>sqrt<span class="main">(</span><span class="numeral">3</span><span class="main">)</span><span class="main">)</span><span class="main">/</span><span class="numeral">6</span> <span class="main">*</span> <span class="keyword1">𝗂</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> sqrt <span class="numeral">3</span> <span class="main">/</span> <span class="numeral">3</span><span class="main">}</span>"</span></span>

<span class="keyword1" id="Three_Circles-lower_circle_rescale"><span class="command">lemma</span></span> lower_circle_rescale<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">&lt;</span> <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lower_circle <span class="free">l</span> <span class="free">r</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span> <span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">*</span><span class="main">(</span><span class="free">r</span> <span class="main">-</span> <span class="free">l</span><span class="main">)</span> <span class="main">+</span> <span class="free">l</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> lower_circle_01"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"lower_circle <span class="free">l</span> <span class="free">r</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span>of_real <span class="free">r</span> <span class="main">-</span> of_real <span class="free">l</span><span class="main">)</span> <span class="main">+</span> of_real <span class="free">l</span><span class="main">)</span> <span class="main">`</span>
        lower_circle_01"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subsetI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> image_eqI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span><span class="main"><span class="main">_</span></span> <span class="main"><span class="main">-</span></span> of_real <span class="free"><span class="free">l</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">/</span></span><span class="main"><span class="main">(</span></span>of_real <span class="free"><span class="free">r</span></span> <span class="main"><span class="main">-</span></span> of_real <span class="free"><span class="free">l</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lower_circle_01_def lower_circle_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span>of_real <span class="free">r</span> <span class="main">-</span> of_real <span class="free">l</span><span class="main">)</span> <span class="main">+</span> of_real <span class="free">l</span><span class="main">)</span> <span class="main">`</span> lower_circle_01 <span class="main">⊆</span>
        lower_circle <span class="free">l</span> <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subsetI<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span><span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> image_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lower_circle_01_def lower_circle_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Three_Circles-two_circles"><span class="command">lemma</span></span> two_circles<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">P</span><span class="main">::</span><span class="quoted"><span class="quoted">"real poly"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">l</span> <span class="free">r</span><span class="main">::</span><span class="quoted">real</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> hlr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">&lt;</span> <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> hP<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">P</span> <span class="main">≤</span> <span class="free">p</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> hP0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> hp0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"proots_count <span class="main">(</span>map_poly of_real <span class="free">P</span><span class="main">)</span> 
       <span class="main">(</span>upper_circle <span class="free">l</span> <span class="free">r</span> <span class="main">∪</span> lower_circle <span class="free">l</span> <span class="free">r</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Bernstein_changes <span class="free">p</span> <span class="free">l</span> <span class="free">r</span> <span class="free">P</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"Bernstein_changes <span class="free">p</span> <span class="free">l</span> <span class="free">r</span> <span class="free">P</span> <span class="main">=</span>
           Bernstein_changes_01 <span class="free">p</span> <span class="main">(</span><span class="free">P</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="free">l</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">0</span><span class="main">,</span> <span class="free">r</span> <span class="main">-</span> <span class="free">l</span><span class="main">:]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Bernstein_changes_eq_rescale<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="main">(</span>map_poly complex_of_real <span class="main">(</span><span class="free">P</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="free">l</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">0</span><span class="main">,</span> <span class="free">r</span> <span class="main">-</span> <span class="free">l</span><span class="main">:]</span><span class="main">)</span><span class="main">)</span>
     <span class="main">(</span>upper_circle_01 <span class="main">∪</span> lower_circle_01<span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> upper_circle_rescale lower_circle_rescale proots_pcompose image_Un
        of_real_hom.map_poly_pcompose pcompose_eq_0 image_image <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> 1<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> two_circles_01<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> hP <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> degree_pcompose<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> hP0 hlr <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pcompose_eq_0<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> hp0 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The theorem of three circles›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> three_circles<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">P</span><span class="main">::</span><span class="quoted"><span class="quoted">"real poly"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">l</span> <span class="free">r</span><span class="main">::</span><span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">&lt;</span> <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> hP<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">P</span> <span class="main">≤</span> <span class="free">p</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> hP0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> hp0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="main">(</span>map_poly of_real <span class="free">P</span><span class="main">)</span> <span class="main">(</span>circle_diam <span class="free">l</span> <span class="free">r</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span>
       Bernstein_changes <span class="free">p</span> <span class="free">l</span> <span class="free">r</span> <span class="free">P</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proots_count <span class="main">(</span>map_poly of_real <span class="free">P</span><span class="main">)</span> 
       <span class="main">(</span>upper_circle <span class="free">l</span> <span class="free">r</span> <span class="main">∪</span> lower_circle <span class="free">l</span> <span class="free">r</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⟹</span>
       Bernstein_changes <span class="free">p</span> <span class="free">l</span> <span class="free">r</span> <span class="free">P</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> one_circle<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>4<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> two_circles<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div>