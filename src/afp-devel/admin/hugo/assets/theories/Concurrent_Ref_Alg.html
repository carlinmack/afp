<div id="Refinement_Lattice">
<div class="head">
<h1>Theory Refinement_Lattice</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Refinement Lattice \label{S:lattice}›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Refinement_Lattice
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL/Main.html">Main</a>
  <span class="quoted">"<a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL-Library/Lattice_Syntax.html">HOL-Library.Lattice_Syntax</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The underlying lattice of commands is complete and distributive.
  We follow the refinement calculus tradition so that $\nondet$ 
  is non-deterministic choice and $c \refsto d$ means $c$ is refined 
  (or implemented) by $d$.
›</span></span>

<span class="keyword1"><span class="command">declare</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">show_sorts</span><span class="main">]</span><span class="main">]</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Remove existing notation for quotient as it interferes with the rely quotient›</span></span>
<span class="keyword1"><span class="command">no_notation</span></span> Equiv_Relations.quotient  <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">'/'/</span>"</span> 90<span class="main">)</span>

<span class="keyword1"><span class="command">class</span></span> refinement_lattice <span class="main">=</span> complete_distrib_lattice
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The refinement lattice infimum corresponds to non-deterministic choice for commands.›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span>
  <span class="entity">refine</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊑</span>"</span> 50<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main"><span class="free">⊑</span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">≡</span> less_eq <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span>
  <span class="entity">refine_strict</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊏</span>"</span> 50<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main"><span class="free">⊏</span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">≡</span> less <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Non-deterministic choice is monotonic in both arguments›</span></span>
<span class="keyword1" id="Refinement_Lattice-inf_mono_left"><span class="command">lemma</span></span> inf_mono_left<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">⊑</span> <span class="free">b</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">⊓</span> <span class="free">c</span> <span class="main">⊑</span> <span class="free">b</span> <span class="main">⊓</span> <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> inf_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Refinement_Lattice-inf_mono_right"><span class="command">lemma</span></span> inf_mono_right<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">⊑</span> <span class="free">d</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">⊓</span> <span class="free">c</span> <span class="main">⊑</span> <span class="free">a</span> <span class="main">⊓</span> <span class="free">d</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> inf_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Binary choice is a special case of choice over a set.›</span></span>
<span class="keyword1" id="Refinement_Lattice-Inf2_inf"><span class="command">lemma</span></span> Inf2_inf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⨅</span><span class="main">{</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">|</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="free">c</span><span class="main">,</span> <span class="free">d</span><span class="main">}</span><span class="main">}</span> <span class="main">=</span> <span class="free">f</span> <span class="free">c</span> <span class="main">⊓</span> <span class="free">f</span> <span class="free">d</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">|</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="free">c</span><span class="main">,</span> <span class="free">d</span><span class="main">}</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="free">f</span> <span class="free">c</span><span class="main">,</span> <span class="free">f</span> <span class="free">d</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⨅</span><span class="main">{</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">|</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="free">c</span><span class="main">,</span> <span class="free">d</span><span class="main">}</span><span class="main">}</span> <span class="main">=</span> <span class="main">⨅</span><span class="main">{</span><span class="free">f</span> <span class="free">c</span><span class="main">,</span> <span class="free">f</span> <span class="free">d</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">f</span> <span class="free">c</span> <span class="main">⊓</span> <span class="free">f</span> <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Helper lemma for choice over indexed set.›</span></span>
<span class="keyword1" id="Refinement_Lattice-INF_Inf"><span class="command">lemma</span></span> INF_Inf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨅</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span><span class="main">{</span><span class="free">f</span> <span class="bound">x</span> <span class="main">|</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Setcompr_eq_image<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> -<span class="main">)</span> INF_absorb_args<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨅</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span><span class="main">::</span>nat <span class="main">⇒</span> <span class="tfree">'c</span><span class="main">::</span>complete_lattice<span class="main">)</span> <span class="main">(</span><span class="bound">i</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span><span class="bound">k</span><span class="main">.</span> <span class="free">f</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> order_class.order.antisym<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨅</span><span class="bound">k</span><span class="main">.</span> <span class="free">f</span> <span class="bound">k</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="main">⨅</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">i</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> complete_lattice_class.INF_lower complete_lattice_class.le_INF_iff<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">k</span><span class="main">.</span> <span class="main">∃</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">i</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span> <span class="main">≤</span> <span class="free">f</span> <span class="bound">k</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Nat.add_0_right order_refl<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">k</span><span class="main">.</span> <span class="main">∃</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="main">⨅</span><span class="bound">j</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">i</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">f</span> <span class="bound">k</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> UNIV_I complete_lattice_class.INF_lower2<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨅</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">i</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="main">⨅</span><span class="bound">k</span><span class="main">.</span> <span class="free">f</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> complete_lattice_class.INF_mono<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> -<span class="main">)</span> nested_Collect<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">f</span> <span class="bound">y</span> <span class="main">|</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> <span class="main">{</span><span class="free">g</span> <span class="bound">x</span> <span class="main">|</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span><span class="main">}</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="free">f</span> <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">|</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹A transition lemma for INF distributivity properties, going from Inf to INF,
  qualified version followed by a straightforward one.›</span></span>

<span class="keyword1" id="Refinement_Lattice-Inf_distrib_INF_qual"><span class="command">lemma</span></span> Inf_distrib_INF_qual<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> qual<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">{</span><span class="free">d</span> <span class="bound">x</span> <span class="main">|</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f_Inf_distrib<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">c</span> <span class="bound">D</span><span class="main">.</span> <span class="free">P</span> <span class="bound">D</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">c</span> <span class="main">(</span><span class="main">⨅</span> <span class="bound">D</span><span class="main">)</span> <span class="main">=</span> <span class="main">⨅</span> <span class="main">{</span><span class="free">f</span> <span class="bound">c</span> <span class="bound">d</span> <span class="main">|</span> <span class="bound">d</span> <span class="main">.</span> <span class="bound">d</span> <span class="main">∈</span> <span class="bound">D</span> <span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">c</span> <span class="main">(</span><span class="main">⨅</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> <span class="free">d</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> <span class="free">f</span> <span class="free">c</span> <span class="main">(</span><span class="free">d</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">c</span> <span class="main">(</span><span class="main">⨅</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> <span class="free">d</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="free">c</span> <span class="main">(</span><span class="main">⨅</span><span class="main">{</span><span class="free">d</span> <span class="bound">x</span> <span class="main">|</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> INF_Inf<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span><span class="main">{</span><span class="free">f</span> <span class="free">c</span> <span class="bound">dx</span> <span class="main">|</span><span class="bound">dx</span><span class="main">.</span> <span class="bound">dx</span> <span class="main">∈</span> <span class="main">{</span><span class="free">d</span> <span class="bound">x</span> <span class="main">|</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span><span class="main">}</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> qual f_Inf_distrib<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span><span class="main">{</span><span class="free">f</span> <span class="free">c</span> <span class="main">(</span><span class="free">d</span> <span class="bound">x</span><span class="main">)</span> <span class="main">|</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> nested_Collect<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> <span class="free">f</span> <span class="free">c</span> <span class="main">(</span><span class="free">d</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> INF_Inf<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Refinement_Lattice-Inf_distrib_INF"><span class="command">lemma</span></span> Inf_distrib_INF<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f_Inf_distrib<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">c</span> <span class="bound">D</span><span class="main">.</span> <span class="free">f</span> <span class="bound">c</span> <span class="main">(</span><span class="main">⨅</span> <span class="bound">D</span><span class="main">)</span> <span class="main">=</span> <span class="main">⨅</span> <span class="main">{</span><span class="free">f</span> <span class="bound">c</span> <span class="bound">d</span> <span class="main">|</span> <span class="bound">d</span> <span class="main">.</span> <span class="bound">d</span> <span class="main">∈</span> <span class="bound">D</span> <span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">c</span> <span class="main">(</span><span class="main">⨅</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> <span class="free">d</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> <span class="free">f</span> <span class="free">c</span> <span class="main">(</span><span class="free">d</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Setcompr_eq_image f_Inf_distrib image_comp<span class="main">)</span>

    
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> refine_trans <span class="main">=</span> order.trans

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹More transitivity rules to make calculational reasoning smoother›</span></span>
<span class="keyword1"><span class="command">declare</span></span> ord_eq_le_trans<span class="main">[</span><span class="operator">trans</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> ord_le_eq_trans<span class="main">[</span><span class="operator">trans</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> dual_order.trans<span class="main">[</span><span class="operator">trans</span><span class="main">]</span>


<span class="keyword1"><span class="command">abbreviation</span></span>
  <span class="entity">dist_over_sup</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>refinement_lattice <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">dist_over_sup</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">X</span> <span class="main">.</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">(</span><span class="main">⨆</span> <span class="bound">X</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆</span><span class="bound">x</span><span class="main">∈</span><span class="bound">X</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span>
  <span class="entity">dist_over_inf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>refinement_lattice <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">dist_over_inf</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">X</span> <span class="main">.</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">(</span><span class="main">⨅</span> <span class="bound">X</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span><span class="bound">x</span><span class="main">∈</span><span class="bound">X</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Sequential">
<div class="head">
<h1>Theory Sequential</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Sequential Operator \label{S:sequential}›</span></span>


<span class="keyword1"><span class="command">theory</span></span> Sequential
<span class="keyword2"><span class="keyword">imports</span></span> <a href="#Refinement_Lattice">Refinement_Lattice</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Basic sequential›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The sequential composition operator ``$;$'' is associative and 
  has identity nil but it is not commutative. 
  It has $\bot$ as a left annihilator.
›</span></span>

<span class="keyword1"><span class="command">locale</span></span> seq <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">seq</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>refinement_lattice <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1"><span class="keyword1">;</span></span>"</span> 90<span class="main">)</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> seq_bot <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊥</span> <span class="main"><span class="free">;</span></span> <span class="free">c</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>   <span class="comment1">(* 35 *)</span>

<span class="keyword1"><span class="command">locale</span></span> nil <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">nil</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>refinement_lattice"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1">nil</span></span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The monoid axioms imply ``;'' is associative and has identity nil.
  Abort is a left annihilator of sequential composition.
›</span></span>
<span class="keyword1"><span class="command">locale</span></span> sequential <span class="main">=</span> seq <span class="main">+</span> nil <span class="main">+</span> seq<span class="main">:</span> monoid <span class="quoted"><span class="free">seq</span></span> <span class="quoted"><span class="keyword1"><span class="free">nil</span></span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">declare</span></span> seq.assoc <span class="main">[</span><span class="operator">algebra_simps</span><span class="main">,</span> <span class="operator">field_simps</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemmas</span></span> seq_assoc <span class="main">=</span> seq.assoc             <span class="comment1">(* 30 *)</span>
<span class="keyword1"><span class="command">lemmas</span></span> seq_nil_right <span class="main">=</span> seq.right_neutral <span class="comment1">(* 31 *)</span>
<span class="keyword1"><span class="command">lemmas</span></span> seq_nil_left <span class="main">=</span> seq.left_neutral   <span class="comment1">(* 32 *)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Distributed sequential›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Sequential composition distributes across arbitrary infima 
  from the right but only across the binary (finite) infima from the left
  and hence it is monotonic in both arguments. 
  We consider left distribution first.
  Note that Section \ref{S:conjunctive-sequential} considers the
  case in which the weak-seq-inf-distrib axiom is strengthened to
  an equality.
›</span></span>

<span class="keyword1"><span class="command">locale</span></span> seq_distrib_left <span class="main">=</span> sequential <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> weak_seq_inf_distrib<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>refinement_lattice<span class="main">)</span><span class="main"><span class="free">;</span></span><span class="main">(</span><span class="free">d<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">⊓</span> <span class="free">d<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">⊑</span> <span class="main">(</span><span class="free">c</span><span class="main"><span class="free">;</span></span><span class="free">d<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">⊓</span> <span class="free">c</span><span class="main"><span class="free">;</span></span><span class="free">d<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>"</span></span>  <span class="comment1">(* 33 *)</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Left distribution implies sequential composition is monotonic is its right argument›</span></span>
<span class="keyword1" id="Sequential-seq_mono_right"><span class="command">lemma</span></span> seq_mono_right<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">⊑</span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟹</span> <span class="free">d</span> <span class="main"><span class="free">;</span></span> <span class="free">c<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">⊑</span> <span class="free">d</span> <span class="main"><span class="free">;</span></span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf.absorb_iff2 le_inf_iff weak_seq_inf_distrib<span class="main">)</span>

<span class="comment1">(* Nec? *)</span>
<span class="keyword1" id="Sequential-seq_bot_right"><span class="command">lemma</span></span> seq_bot_right <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main"><span class="free">;</span></span><span class="main">⊥</span> <span class="main">⊑</span> <span class="free">c</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bot.extremum seq.right_neutral seq_mono_right<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> seq_distrib_right <span class="main">=</span> sequential <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> Inf_seq_distrib<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨅</span> <span class="free">C</span><span class="main">)</span> <span class="main"><span class="free">;</span></span> <span class="free">d</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span><span class="main">(</span><span class="bound">c</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>refinement_lattice<span class="main">)</span><span class="main">∈</span><span class="free">C</span><span class="main">.</span> <span class="bound">c</span> <span class="main"><span class="free">;</span></span> <span class="free">d</span><span class="main">)</span>"</span></span> <span class="comment1">(* 34 *)</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Sequential-INF_seq_distrib"><span class="command">lemma</span></span> INF_seq_distrib<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨅</span><span class="bound">c</span><span class="main">∈</span><span class="free">C</span><span class="main">.</span> <span class="free">f</span> <span class="bound">c</span><span class="main">)</span> <span class="main"><span class="free">;</span></span> <span class="free">d</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span><span class="bound">c</span><span class="main">∈</span><span class="free">C</span><span class="main">.</span> <span class="free">f</span> <span class="bound">c</span> <span class="main"><span class="free">;</span></span> <span class="free">d</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Inf_seq_distrib <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> image_comp<span class="main">)</span>

<span class="keyword1" id="Sequential-inf_seq_distrib"><span class="command">lemma</span></span> inf_seq_distrib<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">⊓</span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main"><span class="free">;</span></span> <span class="free">d</span> <span class="main">=</span> <span class="main">(</span><span class="free">c<span class="hidden">⇩</span><sub>0</sub></span> <span class="main"><span class="free">;</span></span> <span class="free">d</span> <span class="main">⊓</span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="main"><span class="free">;</span></span> <span class="free">d</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">⊓</span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main"><span class="free">;</span></span> <span class="free">d</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span> <span class="main">{</span><span class="free">c<span class="hidden">⇩</span><sub>0</sub></span><span class="main">,</span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">}</span><span class="main">)</span> <span class="main"><span class="free">;</span></span> <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span><span class="bound">c</span><span class="main">∈</span><span class="main">{</span><span class="free">c<span class="hidden">⇩</span><sub>0</sub></span><span class="main">,</span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">}</span><span class="main">.</span> <span class="bound">c</span> <span class="main"><span class="free">;</span></span> <span class="free">d</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> Inf_seq_distrib<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">c<span class="hidden">⇩</span><sub>0</sub></span> <span class="main"><span class="free">;</span></span> <span class="free">d</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="main"><span class="free">;</span></span> <span class="free">d</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Sequential-seq_mono_left"><span class="command">lemma</span></span> seq_mono_left<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">⊑</span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟹</span> <span class="free">c<span class="hidden">⇩</span><sub>0</sub></span> <span class="main"><span class="free">;</span></span> <span class="free">d</span> <span class="main">⊑</span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="main"><span class="free">;</span></span> <span class="free">d</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf.absorb_iff2 inf_seq_distrib<span class="main">)</span>

<span class="keyword1" id="Sequential-seq_top"><span class="command">lemma</span></span> seq_top <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊤</span> <span class="main"><span class="free">;</span></span> <span class="free">c</span> <span class="main">=</span> <span class="main">⊤</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊤</span> <span class="main"><span class="free">;</span></span> <span class="free">c</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span><span class="bound">a</span><span class="main">∈</span><span class="main">{}</span><span class="main">.</span> <span class="bound">a</span> <span class="main"><span class="free">;</span></span> <span class="free">c</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Inf_empty Inf_seq_distrib<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">seq_power</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1"><span class="hidden">⇧</span><sup>;</sup>^</span>"</span> 80<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
    seq_power_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main"><span class="free"><span class="hidden">⇧</span><sup>;</sup>^</span></span> <span class="main">0</span> <span class="main">=</span> <span class="keyword1"><span class="free">nil</span></span>"</span></span>
  <span class="main">|</span> seq_power_Suc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main"><span class="free"><span class="hidden">⇧</span><sup>;</sup>^</span></span> Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main"><span class="free">;</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main"><span class="free"><span class="hidden">⇧</span><sup>;</sup>^</span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">notation</span></span> <span class="main">(</span>latex <span class="keyword2"><span class="keyword">output</span></span><span class="main">)</span>
  seq_power <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_<span class="keyword1">⇗</span>_<span class="keyword1">⇖</span><span class="keyword3">)</span>"</span> <span class="main">[</span>1000<span class="main">]</span> 1000<span class="main">)</span>

<span class="keyword1"><span class="command">notation</span></span> <span class="main">(</span>HTML <span class="keyword2"><span class="keyword">output</span></span><span class="main">)</span>
  seq_power <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_<span class="keyword1">⇗</span>_<span class="keyword1">⇖</span><span class="keyword3">)</span>"</span> <span class="main">[</span>1000<span class="main">]</span> 1000<span class="main">)</span>


<span class="keyword1" id="Sequential-seq_power_front"><span class="command">lemma</span></span> seq_power_front<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span> <span class="main"><span class="hidden">⇧</span><sup>;</sup>^</span> <span class="free">n</span><span class="main">)</span> <span class="main"><span class="free">;</span></span> <span class="free">a</span> <span class="main">=</span> <span class="free">a</span> <span class="main"><span class="free">;</span></span> <span class="main">(</span><span class="free">a</span> <span class="main"><span class="hidden">⇧</span><sup>;</sup>^</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> seq_assoc<span class="main">)</span>

<span class="keyword1" id="Sequential-seq_power_split_less"><span class="command">lemma</span></span> seq_power_split_less<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">j</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">b</span> <span class="main"><span class="hidden">⇧</span><sup>;</sup>^</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">b</span> <span class="main"><span class="hidden">⇧</span><sup>;</sup>^</span> <span class="free">i</span><span class="main">)</span> <span class="main"><span class="free">;</span></span> <span class="main">(</span><span class="free">b</span> <span class="main"><span class="hidden">⇧</span><sup>;</sup>^</span> <span class="main">(</span><span class="free">j</span> <span class="main">-</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">j</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">i</span></span> <span class="quasi_keyword">type</span><span class="main"><span class="main">:</span></span> nat<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main"><span class="hidden">⇧</span><sup>;</sup>^</span> Suc <span class="skolem">j</span> <span class="main">=</span> <span class="free">b</span> <span class="main"><span class="free">;</span></span> <span class="main">(</span><span class="free">b</span> <span class="main"><span class="hidden">⇧</span><sup>;</sup>^</span> <span class="skolem">i</span><span class="main">)</span> <span class="main"><span class="free">;</span></span> <span class="main">(</span><span class="free">b</span> <span class="main"><span class="hidden">⇧</span><sup>;</sup>^</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">-</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Suc.hyps Suc.prems less_Suc_eq seq_assoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">b</span> <span class="main"><span class="hidden">⇧</span><sup>;</sup>^</span> <span class="skolem">i</span><span class="main">)</span> <span class="main"><span class="free">;</span></span> <span class="free">b</span> <span class="main"><span class="free">;</span></span> <span class="main">(</span><span class="free">b</span> <span class="main"><span class="hidden">⇧</span><sup>;</sup>^</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">-</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> seq_power_front<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">b</span> <span class="main"><span class="hidden">⇧</span><sup>;</sup>^</span> <span class="skolem">i</span><span class="main">)</span> <span class="main"><span class="free">;</span></span> <span class="main">(</span><span class="free">b</span> <span class="main"><span class="hidden">⇧</span><sup>;</sup>^</span> <span class="main">(</span>Suc <span class="skolem">j</span> <span class="main">-</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Suc.prems Suc_diff_le seq_assoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> seq_distrib <span class="main">=</span> seq_distrib_right <span class="main">+</span> seq_distrib_left
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Sequential-seq_mono"><span class="command">lemma</span></span> seq_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊑</span> <span class="free">d<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟹</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊑</span> <span class="free">d<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⟹</span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main"><span class="free">;</span></span><span class="free">c<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊑</span> <span class="free">d<span class="hidden">⇩</span><sub>1</sub></span><span class="main"><span class="free">;</span></span><span class="free">d<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> seq_mono_left seq_mono_right <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf.orderE le_infI2<span class="main">)</span> 

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Parallel">
<div class="head">
<h1>Theory Parallel</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Parallel Operator \label{S:parallel}›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Parallel
<span class="keyword2"><span class="keyword">imports</span></span> <a href="#Refinement_Lattice">Refinement_Lattice</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Basic parallel operator›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The parallel operator is associative, commutative and has unit skip
  and has as an annihilator the lattice bottom. 
›</span></span>

<span class="keyword1"><span class="command">locale</span></span> skip <span class="main">=</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">skip</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>refinement_lattice"</span></span>  <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1">skip</span></span>"</span><span class="main">)</span> 

<span class="keyword1"><span class="command">locale</span></span> par <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">par</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>refinement_lattice <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1"><span class="keyword1">∥</span></span>"</span> 75<span class="main">)</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> abort_par<span class="main">:</span>   <span class="quoted"><span class="quoted">"<span class="main">⊥</span> <span class="main"><span class="free">∥</span></span> <span class="free">c</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>    <span class="comment1">(* ++ *)</span>

<span class="keyword1"><span class="command">locale</span></span> parallel <span class="main">=</span> par <span class="main">+</span> skip <span class="main">+</span> par<span class="main">:</span> comm_monoid <span class="quoted"><span class="free">par</span></span> <span class="quoted"><span class="keyword1"><span class="free">skip</span></span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> <span class="main">[</span><span class="operator">algebra_simps</span><span class="main">,</span> <span class="operator">field_simps</span><span class="main">]</span> <span class="main">=</span>
  par.assoc
  par.commute
  par.left_commute

<span class="keyword1"><span class="command">lemmas</span></span> par_assoc <span class="main">=</span> par.assoc            <span class="comment1">(* 36 *)</span>
<span class="keyword1"><span class="command">lemmas</span></span> par_commute <span class="main">=</span> par.commute        <span class="comment1">(* 37 *)</span>
<span class="keyword1"><span class="command">lemmas</span></span> par_skip <span class="main">=</span> par.right_neutral     <span class="comment1">(* 38 *)</span>
<span class="keyword1"><span class="command">lemmas</span></span> par_skip_left <span class="main">=</span> par.left_neutral <span class="comment1">(* 38 + 37 *)</span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Distributed parallel›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The parallel operator distributes across arbitrary non-empty infima.
›</span></span>
<span class="keyword1"><span class="command">locale</span></span> par_distrib <span class="main">=</span> parallel <span class="main">+</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> par_Inf_distrib<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">D</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="free">c</span> <span class="main"><span class="free">∥</span></span> <span class="main">(</span><span class="main">⨅</span> <span class="free">D</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span><span class="bound">d</span><span class="main">∈</span><span class="free">D</span><span class="main">.</span> <span class="free">c</span> <span class="main"><span class="free">∥</span></span> <span class="bound">d</span><span class="main">)</span>"</span></span>    <span class="comment1">(* 39+ *)</span>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Parallel-Inf_par_distrib"><span class="command">lemma</span></span> Inf_par_distrib<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">D</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⨅</span> <span class="free">D</span><span class="main">)</span> <span class="main"><span class="free">∥</span></span> <span class="free">c</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span><span class="bound">d</span><span class="main">∈</span><span class="free">D</span><span class="main">.</span> <span class="bound">d</span> <span class="main"><span class="free">∥</span></span> <span class="free">c</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> par_Inf_distrib par_commute <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Parallel-par_INF_distrib"><span class="command">lemma</span></span> par_INF_distrib<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="free">c</span> <span class="main"><span class="free">∥</span></span> <span class="main">(</span><span class="main">⨅</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> <span class="free">d</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> <span class="free">c</span> <span class="main"><span class="free">∥</span></span> <span class="free">d</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> par_Inf_distrib <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> image_comp<span class="main">)</span>

<span class="keyword1" id="Parallel-INF_par_distrib"><span class="command">lemma</span></span> INF_par_distrib<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⨅</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> <span class="free">d</span> <span class="bound">x</span><span class="main">)</span> <span class="main"><span class="free">∥</span></span> <span class="free">c</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> <span class="free">d</span> <span class="bound">x</span> <span class="main"><span class="free">∥</span></span> <span class="free">c</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> par_INF_distrib par_commute <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> INF_cong<span class="main">)</span> 

<span class="keyword1" id="Parallel-INF_INF_par_distrib"><span class="command">lemma</span></span> INF_INF_par_distrib<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="free">Y</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⨅</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> <span class="free">c</span> <span class="bound">x</span><span class="main">)</span> <span class="main"><span class="free">∥</span></span> <span class="main">(</span><span class="main">⨅</span><span class="bound">y</span><span class="main">∈</span><span class="free">Y</span><span class="main">.</span> <span class="free">d</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> <span class="main">⨅</span><span class="bound">y</span><span class="main">∈</span><span class="free">Y</span><span class="main">.</span> <span class="free">c</span> <span class="bound">x</span> <span class="main"><span class="free">∥</span></span> <span class="free">d</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> nonempty_X<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> nonempty_Y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Y</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨅</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> <span class="free">c</span> <span class="bound">x</span><span class="main">)</span> <span class="main"><span class="free">∥</span></span> <span class="main">(</span><span class="main">⨅</span><span class="bound">y</span><span class="main">∈</span><span class="free">Y</span><span class="main">.</span> <span class="free">d</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> <span class="free">c</span> <span class="bound">x</span> <span class="main"><span class="free">∥</span></span> <span class="main">(</span><span class="main">⨅</span><span class="bound">y</span><span class="main">∈</span><span class="free">Y</span><span class="main">.</span> <span class="free">d</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> INF_par_distrib <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> nonempty_X<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> <span class="main">⨅</span><span class="bound">y</span><span class="main">∈</span><span class="free">Y</span><span class="main">.</span> <span class="free">c</span> <span class="bound">x</span> <span class="main"><span class="free">∥</span></span> <span class="free">d</span> <span class="bound">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> par_INF_distrib <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> nonempty_Y<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> calculation<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span> 

<span class="keyword1" id="Parallel-inf_par_distrib"><span class="command">lemma</span></span> inf_par_distrib<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">⊓</span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main"><span class="free">∥</span></span> <span class="free">d</span> <span class="main">=</span> <span class="main">(</span><span class="free">c<span class="hidden">⇩</span><sub>0</sub></span> <span class="main"><span class="free">∥</span></span> <span class="free">d</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="main"><span class="free">∥</span></span> <span class="free">d</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">⊓</span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main"><span class="free">∥</span></span> <span class="free">d</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span> <span class="main">{</span><span class="free">c<span class="hidden">⇩</span><sub>0</sub></span><span class="main">,</span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">}</span><span class="main">)</span> <span class="main"><span class="free">∥</span></span> <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span><span class="bound">c</span> <span class="main">∈</span> <span class="main">{</span><span class="free">c<span class="hidden">⇩</span><sub>0</sub></span><span class="main">,</span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">}</span><span class="main">.</span> <span class="bound">c</span> <span class="main"><span class="free">∥</span></span> <span class="free">d</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Inf_par_distrib <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> insert_not_empty<span class="main">)</span> 
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">c<span class="hidden">⇩</span><sub>0</sub></span> <span class="main"><span class="free">∥</span></span> <span class="free">d</span> <span class="main">⊓</span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="main"><span class="free">∥</span></span> <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Parallel-inf_par_distrib2"><span class="command">lemma</span></span> inf_par_distrib2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main"><span class="free">∥</span></span> <span class="main">(</span><span class="free">c<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">⊓</span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">d</span> <span class="main"><span class="free">∥</span></span> <span class="free">c<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">d</span> <span class="main"><span class="free">∥</span></span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> inf_par_distrib par_commute <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Parallel-inf_par_product"><span class="command">lemma</span></span> inf_par_product<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span> <span class="main">⊓</span> <span class="free">b</span><span class="main">)</span> <span class="main"><span class="free">∥</span></span> <span class="main">(</span><span class="free">c</span> <span class="main">⊓</span> <span class="free">d</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span> <span class="main"><span class="free">∥</span></span> <span class="free">c</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">a</span> <span class="main"><span class="free">∥</span></span> <span class="free">d</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">b</span> <span class="main"><span class="free">∥</span></span> <span class="free">c</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">b</span> <span class="main"><span class="free">∥</span></span> <span class="free">d</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_commute inf_par_distrib inf_par_distrib2 inf_sup_aci<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1" id="Parallel-par_mono"><span class="command">lemma</span></span> par_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊑</span> <span class="free">d<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟹</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊑</span> <span class="free">d<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⟹</span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="main"><span class="free">∥</span></span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊑</span> <span class="free">d<span class="hidden">⇩</span><sub>1</sub></span> <span class="main"><span class="free">∥</span></span> <span class="free">d<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf.orderE le_inf_iff order_refl inf_par_distrib par_commute<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Conjunction">
<div class="head">
<h1>Theory Conjunction</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Weak Conjunction Operator \label{S:conjunction}›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Conjunction
<span class="keyword2"><span class="keyword">imports</span></span> <a href="#Refinement_Lattice">Refinement_Lattice</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The weak conjunction operator $\doublecap$ is similar to
  least upper bound ($\sqcup$) 
  but is abort strict,
  i.e.\ the lattice bottom is an annihilator: $c \doublecap \bot = \bot$. 
  It has identity the command chaos that allows any non-aborting behaviour.
›</span></span>

<span class="keyword1"><span class="command">locale</span></span> chaos <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">chaos</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>refinement_lattice"</span></span>    <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1">chaos</span></span>"</span><span class="main">)</span> 
<span class="comment1">(*
The weak conjunction operator uses a special symbol: double intersection.
To see this symbol in your Isabelle PIDE, install DejaVu Sans fonts
(available freely online at http://dejavu-fonts.org/wiki/Download)
and add the following line to ~/.isabelle/Isabelle2015/etc/symbols
(create the file if it does not exist):

\&lt;iinter&gt;               code: 0x0022d2  group: operator  font: DejaVuSans

Note: if the symbol is rendering correctly, you do not need to do anything.
*)</span>
<span class="keyword1"><span class="command">locale</span></span> conj <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">conj</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>refinement_lattice <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>   <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1"><span class="keyword1">\&lt;iinter&gt;</span></span>"</span> 80<span class="main">)</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> conj_bot_right<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="main">⊥</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Conjunction forms an idempotent, commutative monoid
  (i.e. a semi-lattice), with identity chaos.
›</span></span>

<span class="keyword1"><span class="command">locale</span></span> conjunction <span class="main">=</span> conj <span class="main">+</span> chaos <span class="main">+</span> conj<span class="main">:</span> semilattice_neutr <span class="quoted"><span class="free">conj</span></span> <span class="quoted"><span class="keyword1"><span class="free">chaos</span></span></span>

<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lemmas</span></span> <span class="main">[</span><span class="operator">algebra_simps</span><span class="main">,</span> <span class="operator">field_simps</span><span class="main">]</span> <span class="main">=</span>
  conj.assoc
  conj.commute
  conj.left_commute

<span class="keyword1"><span class="command">lemmas</span></span> conj_assoc <span class="main">=</span> conj.assoc             <span class="comment1">(* 42 *)</span>
<span class="keyword1"><span class="command">lemmas</span></span> conj_commute <span class="main">=</span> conj.commute         <span class="comment1">(* 43 *)</span>
<span class="keyword1"><span class="command">lemmas</span></span> conj_idem <span class="main">=</span> conj.idem               <span class="comment1">(* 44 *)</span>
<span class="keyword1"><span class="command">lemmas</span></span> conj_chaos <span class="main">=</span> conj.right_neutral     <span class="comment1">(* 45 *)</span>            
<span class="keyword1"><span class="command">lemmas</span></span> conj_chaos_left <span class="main">=</span> conj.left_neutral <span class="comment1">(* 45 + 43 *)</span>

<span class="keyword1" id="Conjunction-conj_bot_left"><span class="command">lemma</span></span> conj_bot_left <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊥</span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="free">c</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> conj_bot_right local.conj_commute <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Conjunction-conj_not_bot"><span class="command">lemma</span></span> conj_not_bot<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="free">b</span> <span class="main">≠</span> <span class="main">⊥</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">≠</span> <span class="main">⊥</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">≠</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> conj_bot_right <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Conjunction-conj_distrib1"><span class="command">lemma</span></span> conj_distrib1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="main">(</span><span class="free">d<span class="hidden">⇩</span><sub>0</sub></span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="free">d<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">c</span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="free">d<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="main">(</span><span class="free">c</span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="free">d<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conj_assoc conj_commute conj_idem<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Distributed weak conjunction›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The weak conjunction operator distributes across arbitrary non-empty infima.
›</span></span>

<span class="keyword1"><span class="command">locale</span></span> conj_distrib <span class="main">=</span> conjunction <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> Inf_conj_distrib<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">D</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⨅</span> <span class="free">D</span><span class="main">)</span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="free">c</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span><span class="bound">d</span><span class="main">∈</span><span class="free">D</span><span class="main">.</span> <span class="bound">d</span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="free">c</span><span class="main">)</span>"</span></span>   <span class="comment1">(* 48 *)</span>
  <span class="comment1">(* and sup_conj_distrib: "(c<span class="hidden">⇩</span><sub>0</sub> ⊔ c<span class="hidden">⇩</span><sub>1</sub>) \&lt;iinter&gt; d = (c<span class="hidden">⇩</span><sub>0</sub> \&lt;iinter&gt; d) ⊔ (c<span class="hidden">⇩</span><sub>1</sub> \&lt;iinter&gt; d)"  *)</span>       <span class="comment1">(* 49+ *)</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Conjunction-conj_Inf_distrib"><span class="command">lemma</span></span> conj_Inf_distrib<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">D</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="free">c</span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="main">(</span><span class="main">⨅</span> <span class="free">D</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span><span class="bound">d</span><span class="main">∈</span><span class="free">D</span><span class="main">.</span> <span class="free">c</span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="bound">d</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Inf_conj_distrib conj_commute <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Conjunction-inf_conj_distrib"><span class="command">lemma</span></span> inf_conj_distrib<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">⊓</span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="free">d</span> <span class="main">=</span> <span class="main">(</span><span class="free">c<span class="hidden">⇩</span><sub>0</sub></span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="free">d</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="free">d</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">⊓</span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="free">d</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span> <span class="main">{</span><span class="free">c<span class="hidden">⇩</span><sub>0</sub></span><span class="main">,</span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">}</span><span class="main">)</span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span><span class="bound">c</span> <span class="main">∈</span> <span class="main">{</span><span class="free">c<span class="hidden">⇩</span><sub>0</sub></span><span class="main">,</span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">}</span><span class="main">.</span> <span class="bound">c</span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="free">d</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Inf_conj_distrib<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">c<span class="hidden">⇩</span><sub>0</sub></span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="free">d</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="free">d</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Conjunction-inf_conj_product"><span class="command">lemma</span></span> inf_conj_product<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span> <span class="main">⊓</span> <span class="free">b</span><span class="main">)</span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="main">(</span><span class="free">c</span> <span class="main">⊓</span> <span class="free">d</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="free">c</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">a</span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="free">d</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">b</span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="free">c</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">b</span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="free">d</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_conj_distrib conj_commute inf_assoc<span class="main">)</span>

<span class="keyword1" id="Conjunction-conj_mono"><span class="command">lemma</span></span> conj_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">⊑</span> <span class="free">d<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">⟹</span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊑</span> <span class="free">d<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟹</span> <span class="free">c<span class="hidden">⇩</span><sub>0</sub></span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊑</span> <span class="free">d<span class="hidden">⇩</span><sub>0</sub></span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="free">d<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf.absorb_iff1 inf_conj_product inf_right_idem<span class="main">)</span>

<span class="keyword1" id="Conjunction-conj_mono_left"><span class="command">lemma</span></span> conj_mono_left<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">⊑</span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟹</span> <span class="free">c<span class="hidden">⇩</span><sub>0</sub></span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="free">d</span> <span class="main">⊑</span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="free">d</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conj_mono<span class="main">)</span>

<span class="keyword1" id="Conjunction-conj_mono_right"><span class="command">lemma</span></span> conj_mono_right<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">⊑</span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟹</span> <span class="free">d</span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="free">c<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">⊑</span> <span class="free">d</span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conj_mono<span class="main">)</span>

<span class="keyword1" id="Conjunction-conj_refine"><span class="command">lemma</span></span> conj_refine<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">⊑</span> <span class="free">d</span> <span class="main">⟹</span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊑</span> <span class="free">d</span> <span class="main">⟹</span> <span class="free">c<span class="hidden">⇩</span><sub>0</sub></span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊑</span> <span class="free">d</span>"</span></span> <span class="comment1">(* law 'refine-conjunction' *)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conj_idem conj_mono<span class="main">)</span>

<span class="keyword1" id="Conjunction-refine_to_conj"><span class="command">lemma</span></span> refine_to_conj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">⊑</span> <span class="free">d<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">⟹</span> <span class="free">c</span> <span class="main">⊑</span> <span class="free">d<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟹</span> <span class="free">c</span> <span class="main">⊑</span> <span class="free">d<span class="hidden">⇩</span><sub>0</sub></span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="free">d<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conj_idem conj_mono<span class="main">)</span>

<span class="keyword1" id="Conjunction-conjoin_non_aborting"><span class="command">lemma</span></span> conjoin_non_aborting<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">chaos</span></span> <span class="main">⊑</span> <span class="free">c</span> <span class="main">⟹</span> <span class="free">d</span> <span class="main">⊑</span> <span class="free">d</span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conj_mono order.refl conj_chaos<span class="main">)</span>

<span class="keyword1" id="Conjunction-conjunction_sup"><span class="command">lemma</span></span> conjunction_sup<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="free">d</span> <span class="main">⊑</span> <span class="free">c</span> <span class="main">⊔</span> <span class="free">d</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conj_refine<span class="main">)</span>

<span class="keyword1" id="Conjunction-conjunction_sup_nonaborting"><span class="command">lemma</span></span> conjunction_sup_nonaborting<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">chaos</span></span> <span class="main">⊑</span> <span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">chaos</span></span> <span class="main">⊑</span> <span class="free">d</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="free">d</span> <span class="main">=</span> <span class="free">c</span> <span class="main">⊔</span> <span class="free">d</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">⊔</span> <span class="free">d</span> <span class="main">⊑</span> <span class="free">c</span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> conjoin_non_aborting local.conj_commute <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="free">d</span> <span class="main">⊑</span> <span class="free">c</span> <span class="main">⊔</span> <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conjunction_sup<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Conjunction-conjoin_top"><span class="command">lemma</span></span> conjoin_top<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">chaos</span></span> <span class="main">⊑</span> <span class="free">c</span> <span class="main">⟹</span> <span class="free">c</span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="main">⊤</span> <span class="main">=</span> <span class="main">⊤</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conjunction_sup_nonaborting<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="CRA">
<div class="head">
<h1>Theory CRA</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Concurrent Refinement Algebra \label{S:CRA}›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  This theory brings together the three main operators:
  sequential composition,
  parallel composition and
  conjunction,
  as well as the iteration operators. 
›</span></span>

<span class="keyword1"><span class="command">theory</span></span> CRA
<span class="keyword2"><span class="keyword">imports</span></span> 
  <a href="#Sequential">Sequential</a>
  <a href="#Conjunction">Conjunction</a>
  <a href="#Parallel">Parallel</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Locale sequential-parallel brings together the sequential and parallel
  operators and relates their identities.
›</span></span>
<span class="keyword1"><span class="command">locale</span></span> sequential_parallel <span class="main">=</span> seq_distrib <span class="main">+</span> par_distrib <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> nil_par_nil<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">nil</span></span> <span class="main"><span class="free">∥</span></span> <span class="keyword1"><span class="free">nil</span></span> <span class="main">⊑</span> <span class="keyword1"><span class="free">nil</span></span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> skip_nil<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">skip</span></span> <span class="main">⊑</span> <span class="keyword1"><span class="free">nil</span></span>"</span></span>           <span class="comment1">(* 41 *)</span>
  <span class="keyword2"><span class="keyword">and</span></span> skip_skip<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">skip</span></span> <span class="main">⊑</span> <span class="keyword1"><span class="free">skip</span></span><span class="main"><span class="free">;</span></span><span class="keyword1"><span class="free">skip</span></span>"</span></span>    <span class="comment1">(* 40 *)</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="CRA-nil_absorb"><span class="command">lemma</span></span> nil_absorb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">nil</span></span> <span class="main"><span class="free">∥</span></span> <span class="keyword1"><span class="free">nil</span></span> <span class="main">=</span> <span class="keyword1"><span class="free">nil</span></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> nil_par_nil skip_nil par_skip
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf.absorb_iff2 inf.orderE inf_par_distrib2<span class="main">)</span>

<span class="keyword1" id="CRA-skip_absorb"><span class="command">lemma</span></span> skip_absorb <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">skip</span></span><span class="main"><span class="free">;</span></span><span class="keyword1"><span class="free">skip</span></span> <span class="main">=</span> <span class="keyword1"><span class="free">skip</span></span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> antisym seq_mono_right seq_nil_right skip_skip skip_nil<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Locale conjunction-parallel brings together the weak conjunction and
  parallel operators and relates their identities.
  It also introduces the interchange axiom for conjunction and parallel.
›</span></span>

<span class="keyword1"><span class="command">locale</span></span> conjunction_parallel <span class="main">=</span> conj_distrib <span class="main">+</span> par_distrib <span class="main">+</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> chaos_par_top<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊤</span> <span class="main">⊑</span> <span class="keyword1"><span class="free">chaos</span></span> <span class="main"><span class="free">∥</span></span> <span class="main">⊤</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> chaos_par_chaos<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">chaos</span></span> <span class="main">⊑</span> <span class="keyword1"><span class="free">chaos</span></span> <span class="main"><span class="free">∥</span></span> <span class="keyword1"><span class="free">chaos</span></span>"</span></span>     <span class="comment1">(* 47 *)</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> parallel_interchange<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c<span class="hidden">⇩</span><sub>0</sub></span> <span class="main"><span class="free">∥</span></span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="main">(</span><span class="free">d<span class="hidden">⇩</span><sub>0</sub></span> <span class="main"><span class="free">∥</span></span> <span class="free">d<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">⊑</span> <span class="main">(</span><span class="free">c<span class="hidden">⇩</span><sub>0</sub></span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="free">d<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span> <span class="main"><span class="free">∥</span></span> <span class="main">(</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="free">d<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>"</span></span> <span class="comment1">(* 50 *)</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="CRA-chaos_skip"><span class="command">lemma</span></span> chaos_skip<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">chaos</span></span> <span class="main">⊑</span> <span class="keyword1"><span class="free">skip</span></span>"</span></span>  <span class="comment1">(* 46 *)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">chaos</span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1"><span class="free">chaos</span></span> <span class="main"><span class="free">∥</span></span> <span class="keyword1"><span class="free">skip</span></span><span class="main">)</span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="main">(</span><span class="keyword1"><span class="free">skip</span></span> <span class="main"><span class="free">∥</span></span> <span class="keyword1"><span class="free">chaos</span></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊑</span> <span class="main">(</span><span class="keyword1"><span class="free">chaos</span></span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="keyword1"><span class="free">skip</span></span><span class="main">)</span> <span class="main"><span class="free">∥</span></span> <span class="main">(</span><span class="keyword1"><span class="free">skip</span></span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="keyword1"><span class="free">chaos</span></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> parallel_interchange <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="CRA-chaos_par_chaos_eq"><span class="command">lemma</span></span> chaos_par_chaos_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">chaos</span></span> <span class="main">=</span> <span class="keyword1"><span class="free">chaos</span></span> <span class="main"><span class="free">∥</span></span> <span class="keyword1"><span class="free">chaos</span></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> antisym chaos_par_chaos chaos_skip order_refl par_mono par_skip<span class="main">)</span>

<span class="keyword1" id="CRA-nonabort_par_top"><span class="command">lemma</span></span> nonabort_par_top<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">chaos</span></span> <span class="main">⊑</span> <span class="free">c</span> <span class="main">⟹</span> <span class="free">c</span> <span class="main"><span class="free">∥</span></span> <span class="main">⊤</span> <span class="main">=</span> <span class="main">⊤</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> chaos_par_top par_mono top.extremum_uniqueI<span class="main">)</span>

<span class="keyword1" id="CRA-skip_conj_top"><span class="command">lemma</span></span> skip_conj_top<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">skip</span></span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="main">⊤</span> <span class="main">=</span> <span class="main">⊤</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> chaos_skip conjoin_top<span class="main">)</span>

<span class="keyword1" id="CRA-conj_distrib2"><span class="command">lemma</span></span> conj_distrib2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">⊑</span> <span class="free">c</span> <span class="main"><span class="free">∥</span></span> <span class="free">c</span> <span class="main">⟹</span> <span class="free">c</span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="main">(</span><span class="free">d<span class="hidden">⇩</span><sub>0</sub></span> <span class="main"><span class="free">∥</span></span> <span class="free">d<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">⊑</span> <span class="main">(</span><span class="free">c</span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="free">d<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span> <span class="main"><span class="free">∥</span></span> <span class="main">(</span><span class="free">c</span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="free">d<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">⊑</span> <span class="free">c</span> <span class="main"><span class="free">∥</span></span> <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="main">(</span><span class="free">d<span class="hidden">⇩</span><sub>0</sub></span> <span class="main"><span class="free">∥</span></span> <span class="free">d<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">⊑</span> <span class="main">(</span><span class="free">c</span> <span class="main"><span class="free">∥</span></span> <span class="free">c</span><span class="main">)</span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="main">(</span><span class="free">d<span class="hidden">⇩</span><sub>0</sub></span> <span class="main"><span class="free">∥</span></span> <span class="free">d<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conj_mono order.refl<span class="main">)</span> 
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> parallel_interchange refine_trans<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Locale conjunction-sequential brings together the weak conjunction and
  sequential operators.
  It also introduces the interchange axiom for conjunction and sequential.
›</span></span>

<span class="keyword1"><span class="command">locale</span></span> conjunction_sequential <span class="main">=</span> conj_distrib <span class="main">+</span> seq_distrib <span class="main">+</span> <span class="comment1">(* iteration + *)</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> chaos_seq_chaos<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">chaos</span></span> <span class="main">⊑</span> <span class="keyword1"><span class="free">chaos</span></span><span class="main"><span class="free">;</span></span><span class="keyword1"><span class="free">chaos</span></span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> sequential_interchange<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c<span class="hidden">⇩</span><sub>0</sub></span><span class="main"><span class="free">;</span></span><span class="free">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="main">(</span><span class="free">d<span class="hidden">⇩</span><sub>0</sub></span><span class="main"><span class="free">;</span></span><span class="free">d<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">⊑</span> <span class="main">(</span><span class="free">c<span class="hidden">⇩</span><sub>0</sub></span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="free">d<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span><span class="main"><span class="free">;</span></span><span class="main">(</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="free">d<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>"</span></span>  <span class="comment1">(* 51 *)</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="CRA-chaos_nil"><span class="command">lemma</span></span> chaos_nil<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">chaos</span></span> <span class="main">⊑</span> <span class="keyword1"><span class="free">nil</span></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conj_chaos local.conj_commute seq_nil_left seq_nil_right
       sequential_interchange<span class="main">)</span>

<span class="keyword1" id="CRA-chaos_seq_absorb"><span class="command">lemma</span></span> chaos_seq_absorb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">chaos</span></span> <span class="main">=</span> <span class="keyword1"><span class="free">chaos</span></span><span class="main"><span class="free">;</span></span><span class="keyword1"><span class="free">chaos</span></span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">chaos</span></span> <span class="main">⊑</span> <span class="keyword1"><span class="free">chaos</span></span><span class="main"><span class="free">;</span></span><span class="keyword1"><span class="free">chaos</span></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> chaos_seq_chaos<span class="main">)</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">chaos</span></span><span class="main"><span class="free">;</span></span><span class="keyword1"><span class="free">chaos</span></span> <span class="main">⊑</span> <span class="keyword1"><span class="free">chaos</span></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> chaos_nil
    <span class="keyword1"><span class="command">using</span></span> seq_mono_left seq_nil_left <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="CRA-seq_bot_conj"><span class="command">lemma</span></span> seq_bot_conj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main"><span class="free">;</span></span><span class="main">⊥</span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="free">d</span> <span class="main">⊑</span> <span class="main">(</span><span class="free">c</span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="free">d</span><span class="main">)</span><span class="main"><span class="free">;</span></span><span class="main">⊥</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> conj_bot_left seq_nil_right sequential_interchange<span class="main">)</span> 

<span class="keyword1" id="CRA-conj_seq_bot_right"><span class="command">lemma</span></span> conj_seq_bot_right <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main"><span class="free">;</span></span><span class="main">⊥</span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="free">c</span> <span class="main">=</span>  <span class="free">c</span><span class="main"><span class="free">;</span></span><span class="main">⊥</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> lr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main"><span class="free">;</span></span><span class="main">⊥</span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="free">c</span> <span class="main">⊑</span>  <span class="free">c</span><span class="main"><span class="free">;</span></span><span class="main">⊥</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> seq_bot_conj conj_idem<span class="main">)</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> rl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main"><span class="free">;</span></span><span class="main">⊥</span> <span class="main">⊑</span> <span class="free">c</span><span class="main"><span class="free">;</span></span><span class="main">⊥</span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="free">c</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conj_idem conj_mono_right seq_bot_right<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="CRA-conj_distrib3"><span class="command">lemma</span></span> conj_distrib3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">⊑</span> <span class="free">c</span><span class="main"><span class="free">;</span></span><span class="free">c</span> <span class="main">⟹</span> <span class="free">c</span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="main">(</span><span class="free">d<span class="hidden">⇩</span><sub>0</sub></span> <span class="main"><span class="free">;</span></span> <span class="free">d<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">⊑</span> <span class="main">(</span><span class="free">c</span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="free">d<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span><span class="main"><span class="free">;</span></span><span class="main">(</span><span class="free">c</span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="free">d<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">⊑</span> <span class="free">c</span><span class="main"><span class="free">;</span></span><span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="main">(</span><span class="free">d<span class="hidden">⇩</span><sub>0</sub></span><span class="main"><span class="free">;</span></span><span class="free">d<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">⊑</span> <span class="main">(</span><span class="free">c</span><span class="main"><span class="free">;</span></span><span class="free">c</span><span class="main">)</span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="main">(</span><span class="free">d<span class="hidden">⇩</span><sub>0</sub></span><span class="main"><span class="free">;</span></span><span class="free">d<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conj_mono order.refl<span class="main">)</span> 
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sequential_interchange refine_trans<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(*
lemma iter_conj_distrib:
  assumes nil: "c ⊑ nil"
    and repeat: "c ⊑ c ; c"
  shows "c \&lt;iinter&gt; d<span class="hidden">⇧</span><sup>ω</sup> ⊑ (c \&lt;iinter&gt; d)<span class="hidden">⇧</span><sup>ω</sup>"
proof (unfold iter_def)
  def F ≡ "(λ x. c \&lt;iinter&gt; x)"
  def G ≡ "(λ x. nil ⊓ d;x)"
  def H ≡ "(λ x. nil ⊓ ((c \&lt;iinter&gt; d);x))"

  have FG: "F ∘ G = (λ x. c \&lt;iinter&gt; (nil ⊓ d;x))"  by (metis comp_def F_def G_def) 
  have HF: "H ∘ F = (λ x. (nil ⊓ (c \&lt;iinter&gt; d);(c \&lt;iinter&gt; x)))" by (metis comp_def H_def F_def) 

  have "F (lfp G) ⊑ lfp H"
  proof (rule fusion_lfp_leq)
    show "mono H" by (simp add: H_def iter_step_mono)
  next
    show "dist_over_sup F" by (simp add: F_def conj_Sup_distrib)
  next
    fix x
    have "c \&lt;iinter&gt; (nil ⊓ d;x) = (c \&lt;iinter&gt; nil) ⊓ (c \&lt;iinter&gt; d;x)" by (metis inf_conj_distrib conj_commute)
    also have "... ⊑ nil ⊓ (c \&lt;iinter&gt; d;x)" by (metis conjunction_sup inf_mono_left le_iff_sup nil)
    also have "... ⊑ nil ⊓ (c;c \&lt;iinter&gt; d;x)" by (metis inf_conj_distrib inf.absorb_iff2 inf_mono_right repeat)
    also have "... ⊑ nil ⊓ (c \&lt;iinter&gt; d);(c \&lt;iinter&gt; x)" by (meson inf_mono_right sequential_interchange)
    finally show "(F ∘ G) x ⊑ (H ∘ F) x" by (simp add: FG HF)
  qed

  then show "c \&lt;iinter&gt; lfp(λx. nil ⊓ d ; x) ⊑ lfp (λx. nil ⊓ (c \&lt;iinter&gt; d) ; x)" using F_def G_def H_def by simp
qed

lemma iter_conj_distrib1: "c<span class="hidden">⇧</span><sup>ω</sup> \&lt;iinter&gt; d<span class="hidden">⇧</span><sup>ω</sup> ⊑ (c<span class="hidden">⇧</span><sup>ω</sup> \&lt;iinter&gt; d)<span class="hidden">⇧</span><sup>ω</sup>"
  by (simp add: iter0 iter_conj_distrib)

lemma iter_conj_distrib2: "c<span class="hidden">⇧</span><sup>ω</sup> \&lt;iinter&gt; d<span class="hidden">⇧</span><sup>ω</sup> ⊑ (c \&lt;iinter&gt; d)<span class="hidden">⇧</span><sup>ω</sup>"
proof -
  have a: "c<span class="hidden">⇧</span><sup>ω</sup> ⊑ c" by (metis iter1)
  have b: "c<span class="hidden">⇧</span><sup>ω</sup> \&lt;iinter&gt; d<span class="hidden">⇧</span><sup>ω</sup> ⊑ (c<span class="hidden">⇧</span><sup>ω</sup> \&lt;iinter&gt; d)<span class="hidden">⇧</span><sup>ω</sup>" by (metis iter_conj_distrib1)
  have "c<span class="hidden">⇧</span><sup>ω</sup> \&lt;iinter&gt; d ⊑ c \&lt;iinter&gt; d" by (metis a conj_mono order.refl) 
  thus ?thesis using a b by (metis refine_trans iter_mono) 
qed
*)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Locale cra brings together sequential, parallel and weak conjunction.
›</span></span>

<span class="keyword1"><span class="command">locale</span></span> cra <span class="main">=</span> sequential_parallel <span class="main">+</span> conjunction_parallel <span class="main">+</span> conjunction_sequential

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Galois_Connections">
<div class="head">
<h1>Theory Galois_Connections</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Galois Connections and Fusion Theorems \label{S:galois}›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Galois_Connections
<span class="keyword2"><span class="keyword">imports</span></span> <a href="#Refinement_Lattice">Refinement_Lattice</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The concept of Galois connections is introduced here to prove the fixed-point fusion lemmas. 
  The definition of Galois connections used is quite simple but encodes a lot of 
  information.
  The material in this section is largely based on the work of the Eindhoven
  Mathematics of Program Construction Group \cite{fixedpointcalculus1995}
  and the reader is referred to their work for a full explanation of this section.
›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Lower Galois connections›</span></span>

<span class="comment1">(* auxiliary lemma to prefer 2-element sets rather than disjunction *)</span>
<span class="keyword1" id="Galois_Connections-Collect_2set"><span class="command">lemma</span></span> Collect_2set <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">F</span> <span class="bound">x</span> <span class="main">|</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">a</span> <span class="main">∨</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">b</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="free">F</span> <span class="free">a</span><span class="main">,</span> <span class="free">F</span> <span class="free">b</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">locale</span></span> lower_galois_connections  
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">l_adjoint</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>refinement_lattice <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="quoted">"_<span class="keyword1"><span class="hidden">⇧</span><sup>♭</sup></span>"</span> <span class="main">[</span>201<span class="main">]</span> 200<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main"><span class="free"><span class="hidden">⇧</span><sup>♭</sup></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="main">⨅</span><span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊑</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="bound">y</span><span class="main">}</span>"</span></span>

<span class="keyword1" id="Galois_Connections-dist_inf_mono"><span class="command">lemma</span></span> dist_inf_mono<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> distF<span class="main">:</span> <span class="quoted"><span class="quoted">"dist_over_inf <span class="free">F</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mono <span class="free">F</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">y</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊑</span> <span class="skolem">y</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="skolem">x</span> <span class="main">=</span> <span class="free">F</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">⊓</span> <span class="skolem">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_iff_inf<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">F</span> <span class="skolem">x</span> <span class="main">⊓</span> <span class="free">F</span> <span class="skolem">y</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> distF
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">(</span><span class="main">⨅</span><span class="main">{</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">⨅</span><span class="main">{</span><span class="free">F</span> <span class="skolem">x</span><span class="main">,</span> <span class="free">F</span> <span class="skolem">y</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">drule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">⊓</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">F</span> <span class="skolem">x</span> <span class="main">⊓</span> <span class="free">F</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="skolem">x</span> <span class="main">⊑</span> <span class="free">F</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le_iff_inf<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Galois_Connections-l_cancellation"><span class="command">lemma</span></span> l_cancellation<span class="main">:</span> <span class="quoted"><span class="quoted">"dist_over_inf <span class="free">F</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">⊑</span> <span class="main">(</span><span class="free">F</span> <span class="main">∘</span> <span class="free">F</span><span class="main"><span class="hidden">⇧</span><sup>♭</sup></span><span class="main">)</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> dist<span class="main">:</span> <span class="quoted"><span class="quoted">"dist_over_inf <span class="free">F</span>"</span></span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">=</span> <span class="main">{</span><span class="free">F</span> <span class="bound">y</span> <span class="main">|</span> <span class="bound">y</span><span class="main">.</span> <span class="free">x</span> <span class="main">⊑</span> <span class="free">F</span> <span class="bound">y</span><span class="main">}</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">X</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">=</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span> <span class="bound">y</span> <span class="main">∈</span> <span class="skolem">Y</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">X</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⊑</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> X_def Y_def CollectD singletonI <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⨅</span> <span class="skolem">X</span> <span class="main">⊑</span> <span class="main">⨅</span> <span class="skolem">Y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Inf_mono<span class="main">)</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊑</span> <span class="main">⨅</span><span class="main">{</span><span class="free">F</span> <span class="bound">y</span> <span class="main">|</span> <span class="bound">y</span><span class="main">.</span> <span class="free">x</span> <span class="main">⊑</span> <span class="free">F</span> <span class="bound">y</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> X_def Y_def<span class="main">)</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊑</span> <span class="free">F</span> <span class="main">(</span><span class="main">⨅</span><span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="free">x</span> <span class="main">⊑</span> <span class="free">F</span> <span class="bound">y</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dist le_INF_iff<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_def l_adjoint_def<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Galois_Connections-l_galois_connection"><span class="command">lemma</span></span> l_galois_connection<span class="main">:</span> <span class="quoted"><span class="quoted">"dist_over_inf <span class="free">F</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span><span class="free">F</span><span class="main"><span class="hidden">⇧</span><sup>♭</sup></span><span class="main">)</span> <span class="free">x</span> <span class="main">⊑</span> <span class="free">y</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊑</span> <span class="free">F</span> <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊑</span> <span class="free">F</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⨅</span><span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="free">x</span> <span class="main">⊑</span> <span class="free">F</span> <span class="bound">y</span><span class="main">}</span> <span class="main">⊑</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Inf_lower<span class="main">)</span> 
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">F</span><span class="main"><span class="hidden">⇧</span><sup>♭</sup></span><span class="main">)</span> <span class="free">x</span> <span class="main">⊑</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> l_adjoint_def<span class="main">)</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> dist<span class="main">:</span> <span class="quoted"><span class="quoted">"dist_over_inf <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> monoF<span class="main">:</span> <span class="quoted"><span class="quoted">"mono <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dist_inf_mono<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">F</span><span class="main"><span class="hidden">⇧</span><sup>♭</sup></span><span class="main">)</span> <span class="free">x</span> <span class="main">⊑</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">(</span><span class="main">(</span><span class="free">F</span><span class="main"><span class="hidden">⇧</span><sup>♭</sup></span><span class="main">)</span> <span class="free">x</span><span class="main">)</span> <span class="main">⊑</span> <span class="free">F</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> monoD monoF<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊑</span> <span class="free">F</span> <span class="main">(</span><span class="main">(</span><span class="free">F</span><span class="main"><span class="hidden">⇧</span><sup>♭</sup></span><span class="main">)</span> <span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> dist l_cancellation <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊑</span> <span class="free">F</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Galois_Connections-v_simple_fusion"><span class="command">lemma</span></span> v_simple_fusion<span class="main">:</span> <span class="quoted"><span class="quoted">"mono <span class="free">G</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="free">F</span> <span class="main">∘</span> <span class="free">G</span><span class="main">)</span> <span class="bound">x</span> <span class="main">⊑</span> <span class="main">(</span><span class="free">H</span> <span class="main">∘</span> <span class="free">F</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">F</span> <span class="main">(</span>gfp <span class="free">G</span><span class="main">)</span> <span class="main">⊑</span> gfp <span class="free">H</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_eq_dest_lhs gfp_unfold gfp_upperbound<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Greatest fixpoint fusion theorems›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Combining lower Galois connections and greatest fixed points allows 
  elegant proofs of the weak fusion lemmas. 
›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> fusion_gfp_geq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> monoH<span class="main">:</span> <span class="quoted"><span class="quoted">"mono <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> distribF<span class="main">:</span> <span class="quoted"><span class="quoted">"dist_over_inf <span class="free">F</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> comp_geq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="free">H</span> <span class="main">∘</span> <span class="free">F</span><span class="main">)</span> <span class="bound">x</span> <span class="main">⊑</span> <span class="main">(</span><span class="free">F</span> <span class="main">∘</span> <span class="free">G</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"gfp <span class="free">H</span> <span class="main">⊑</span> <span class="free">F</span> <span class="main">(</span>gfp <span class="free">G</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>gfp <span class="free">H</span><span class="main">)</span> <span class="main">⊑</span> <span class="main">(</span><span class="free">F</span> <span class="main">∘</span> <span class="free">F</span><span class="main"><span class="hidden">⇧</span><sup>♭</sup></span><span class="main">)</span> <span class="main">(</span>gfp <span class="free">H</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> distribF l_cancellation <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">(</span>gfp <span class="free">H</span><span class="main">)</span> <span class="main">⊑</span> <span class="free">H</span> <span class="main">(</span><span class="main">(</span><span class="free">F</span> <span class="main">∘</span> <span class="free">F</span><span class="main"><span class="hidden">⇧</span><sup>♭</sup></span><span class="main">)</span> <span class="main">(</span>gfp <span class="free">H</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> monoD monoH<span class="main">)</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">(</span>gfp <span class="free">H</span><span class="main">)</span> <span class="main">⊑</span> <span class="free">F</span> <span class="main">(</span><span class="main">(</span><span class="free">G</span> <span class="main">∘</span> <span class="free">F</span><span class="main"><span class="hidden">⇧</span><sup>♭</sup></span><span class="main">)</span> <span class="main">(</span>gfp <span class="free">H</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> comp_geq <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_def refine_trans<span class="main">)</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">F</span><span class="main"><span class="hidden">⇧</span><sup>♭</sup></span><span class="main">)</span> <span class="main">(</span><span class="free">H</span> <span class="main">(</span>gfp <span class="free">H</span><span class="main">)</span><span class="main">)</span> <span class="main">⊑</span> <span class="main">(</span><span class="free">G</span> <span class="main">∘</span> <span class="free">F</span><span class="main"><span class="hidden">⇧</span><sup>♭</sup></span><span class="main">)</span> <span class="main">(</span>gfp <span class="free">H</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> distribF <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> l_galois_connection<span class="main">)</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">F</span><span class="main"><span class="hidden">⇧</span><sup>♭</sup></span><span class="main">)</span> <span class="main">(</span>gfp <span class="free">H</span><span class="main">)</span> <span class="main">⊑</span> <span class="main">(</span>gfp <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_apply gfp_unfold gfp_upperbound monoH<span class="main">)</span> 
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"gfp <span class="free">H</span> <span class="main">⊑</span> <span class="free">F</span> <span class="main">(</span>gfp <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> distribF <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> l_galois_connection<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> fusion_gfp_eq<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> monoH<span class="main">:</span> <span class="quoted"><span class="quoted">"mono <span class="free">H</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> monoG<span class="main">:</span> <span class="quoted"><span class="quoted">"mono <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> distF<span class="main">:</span> <span class="quoted"><span class="quoted">"dist_over_inf <span class="free">F</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> fgh_comp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="free">F</span> <span class="main">∘</span> <span class="free">G</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">(</span><span class="free">H</span> <span class="main">∘</span> <span class="free">F</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">(</span>gfp <span class="free">G</span><span class="main">)</span> <span class="main">=</span> gfp <span class="free">H</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">(</span>gfp <span class="free">G</span><span class="main">)</span> <span class="main">⊑</span> <span class="main">(</span>gfp <span class="free">H</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fgh_comp le_less v_simple_fusion monoG<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="free">H</span> <span class="main">∘</span> <span class="free">F</span><span class="main">)</span> <span class="bound">x</span> <span class="main">⊑</span> <span class="main">(</span><span class="free">F</span> <span class="main">∘</span> <span class="free">G</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fgh_comp <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"gfp <span class="free">H</span> <span class="main">⊑</span> <span class="free">F</span> <span class="main">(</span>gfp <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> monoH distF fusion_gfp_geq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Upper Galois connections›</span></span>

<span class="keyword1"><span class="command">locale</span></span> upper_galois_connections
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">u_adjoint</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>refinement_lattice <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="quoted">"_<span class="keyword1"><span class="hidden">⇧</span><sup>#</sup></span>"</span> <span class="main">[</span>201<span class="main">]</span> 200<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main"><span class="free"><span class="hidden">⇧</span><sup>#</sup></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="main">⨆</span><span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="bound">y</span> <span class="main">⊑</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">}</span>"</span></span>


<span class="keyword1" id="Galois_Connections-dist_sup_mono"><span class="command">lemma</span></span> dist_sup_mono<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> distF<span class="main">:</span> <span class="quoted"><span class="quoted">"dist_over_sup <span class="free">F</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mono <span class="free">F</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">y</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊑</span> <span class="skolem">y</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="skolem">y</span> <span class="main">=</span> <span class="free">F</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="skolem">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_iff_sup<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">F</span> <span class="skolem">x</span> <span class="main">⊔</span> <span class="free">F</span> <span class="skolem">y</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> distF
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">(</span><span class="main">⨆</span><span class="main">{</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">⨆</span><span class="main">{</span><span class="free">F</span> <span class="skolem">x</span><span class="main">,</span> <span class="free">F</span> <span class="skolem">y</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">drule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">F</span> <span class="skolem">x</span> <span class="main">⊔</span> <span class="free">F</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="skolem">x</span> <span class="main">⊑</span> <span class="free">F</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le_iff_sup<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Galois_Connections-u_cancellation"><span class="command">lemma</span></span> u_cancellation<span class="main">:</span> <span class="quoted"><span class="quoted">"dist_over_sup <span class="free">F</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">F</span> <span class="main">∘</span> <span class="free">F</span><span class="main"><span class="hidden">⇧</span><sup>#</sup></span><span class="main">)</span> <span class="free">x</span> <span class="main">⊑</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> dist<span class="main">:</span> <span class="quoted"><span class="quoted">"dist_over_sup <span class="free">F</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">=</span> <span class="main">{</span><span class="free">F</span> <span class="bound">y</span> <span class="main">|</span> <span class="bound">y</span><span class="main">.</span> <span class="free">F</span> <span class="bound">y</span> <span class="main">⊑</span> <span class="free">x</span><span class="main">}</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">X</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">=</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span> <span class="bound">y</span> <span class="main">∈</span> <span class="skolem">Y</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">X</span><span class="main">.</span> <span class="bound">y</span> <span class="main">⊑</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> X_def Y_def CollectD singletonI <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⨆</span> <span class="skolem">Y</span> <span class="main">⊑</span> <span class="main">⨆</span> <span class="skolem">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Sup_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⨆</span><span class="main">{</span><span class="free">F</span> <span class="bound">y</span> <span class="main">|</span> <span class="bound">y</span><span class="main">.</span> <span class="free">F</span> <span class="bound">y</span> <span class="main">⊑</span> <span class="free">x</span><span class="main">}</span> <span class="main">⊑</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> X_def Y_def<span class="main">)</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">(</span><span class="main">⨆</span><span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="free">F</span> <span class="bound">y</span> <span class="main">⊑</span> <span class="free">x</span><span class="main">}</span><span class="main">)</span> <span class="main">⊑</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> SUP_le_iff dist <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_def u_adjoint_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Galois_Connections-u_galois_connection"><span class="command">lemma</span></span> u_galois_connection<span class="main">:</span> <span class="quoted"><span class="quoted">"dist_over_sup <span class="free">F</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">F</span> <span class="free">x</span> <span class="main">⊑</span> <span class="free">y</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊑</span> <span class="main">(</span><span class="free">F</span><span class="main"><span class="hidden">⇧</span><sup>#</sup></span><span class="main">)</span> <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> dist<span class="main">:</span> <span class="quoted"><span class="quoted">"dist_over_sup <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> monoF<span class="main">:</span> <span class="quoted"><span class="quoted">"mono <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dist_sup_mono<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊑</span> <span class="main">(</span><span class="free">F</span><span class="main"><span class="hidden">⇧</span><sup>#</sup></span><span class="main">)</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="free">x</span> <span class="main">⊑</span> <span class="free">F</span> <span class="main">(</span><span class="main">(</span><span class="free">F</span><span class="main"><span class="hidden">⇧</span><sup>#</sup></span><span class="main">)</span> <span class="free">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> monoD monoF<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">(</span><span class="main">(</span><span class="free">F</span><span class="main"><span class="hidden">⇧</span><sup>#</sup></span><span class="main">)</span> <span class="free">y</span><span class="main">)</span> <span class="main">⊑</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> dist u_cancellation <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="free">x</span> <span class="main">⊑</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="free">x</span> <span class="main">⊑</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊑</span> <span class="main">⨆</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">F</span> <span class="bound">x</span> <span class="main">⊑</span> <span class="free">y</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Sup_upper<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊑</span> <span class="main">(</span><span class="free">F</span><span class="main"><span class="hidden">⇧</span><sup>#</sup></span><span class="main">)</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> u_adjoint_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Galois_Connections-u_simple_fusion"><span class="command">lemma</span></span> u_simple_fusion<span class="main">:</span> <span class="quoted"><span class="quoted">"mono <span class="free">H</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="free">F</span> <span class="main">∘</span> <span class="free">G</span><span class="main">)</span> <span class="bound">x</span> <span class="main">⊑</span> <span class="main">(</span><span class="free">G</span> <span class="main">∘</span> <span class="free">H</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟹</span> lfp <span class="free">F</span> <span class="main">⊑</span> <span class="free">G</span> <span class="main">(</span>lfp <span class="free">H</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_def lfp_lowerbound lfp_unfold<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Least fixpoint fusion theorems›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Combining upper Galois connections and least fixed points allows elegant proofs 
  of the strong fusion lemmas.
›</span></span>


<span class="keyword1"><span class="command">theorem</span></span> fusion_lfp_leq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> monoH<span class="main">:</span> <span class="quoted"><span class="quoted">"mono <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> distribF<span class="main">:</span> <span class="quoted"><span class="quoted">"dist_over_sup <span class="free">F</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> comp_leq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="free">F</span> <span class="main">∘</span> <span class="free">G</span><span class="main">)</span> <span class="bound">x</span> <span class="main">⊑</span> <span class="main">(</span><span class="free">H</span> <span class="main">∘</span> <span class="free">F</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">(</span>lfp <span class="free">G</span><span class="main">)</span> <span class="main">⊑</span> <span class="main">(</span>lfp <span class="free">H</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">F</span> <span class="main">∘</span> <span class="free">F</span><span class="main"><span class="hidden">⇧</span><sup>#</sup></span><span class="main">)</span> <span class="main">(</span>lfp <span class="free">H</span><span class="main">)</span><span class="main">)</span> <span class="main">⊑</span> lfp <span class="free">H</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> distribF u_cancellation <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">(</span><span class="main">(</span><span class="free">F</span> <span class="main">∘</span> <span class="free">F</span><span class="main"><span class="hidden">⇧</span><sup>#</sup></span><span class="main">)</span> <span class="main">(</span>lfp <span class="free">H</span><span class="main">)</span><span class="main">)</span> <span class="main">⊑</span> <span class="free">H</span> <span class="main">(</span>lfp <span class="free">H</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> monoD monoH<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">(</span><span class="main">(</span><span class="free">G</span> <span class="main">∘</span> <span class="free">F</span><span class="main"><span class="hidden">⇧</span><sup>#</sup></span><span class="main">)</span> <span class="main">(</span>lfp <span class="free">H</span><span class="main">)</span><span class="main">)</span> <span class="main">⊑</span> <span class="free">H</span> <span class="main">(</span>lfp <span class="free">H</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> comp_leq <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_def refine_trans<span class="main">)</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">∘</span> <span class="free">F</span><span class="main"><span class="hidden">⇧</span><sup>#</sup></span><span class="main">)</span> <span class="main">(</span>lfp <span class="free">H</span><span class="main">)</span> <span class="main">⊑</span> <span class="main">(</span><span class="free">F</span><span class="main"><span class="hidden">⇧</span><sup>#</sup></span><span class="main">)</span> <span class="main">(</span><span class="free">H</span> <span class="main">(</span>lfp <span class="free">H</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> distribF <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> u_galois_connection<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>lfp <span class="free">G</span><span class="main">)</span> <span class="main">⊑</span> <span class="main">(</span><span class="free">F</span><span class="main"><span class="hidden">⇧</span><sup>#</sup></span><span class="main">)</span> <span class="main">(</span>lfp <span class="free">H</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_def def_lfp_unfold lfp_lowerbound monoH<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">(</span>lfp <span class="free">G</span><span class="main">)</span> <span class="main">⊑</span> <span class="main">(</span>lfp <span class="free">H</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> distribF <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> u_galois_connection<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">theorem</span></span> fusion_lfp_eq<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> monoH<span class="main">:</span> <span class="quoted"><span class="quoted">"mono <span class="free">H</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> monoG<span class="main">:</span> <span class="quoted"><span class="quoted">"mono <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> distF<span class="main">:</span> <span class="quoted"><span class="quoted">"dist_over_sup <span class="free">F</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> fgh_comp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="free">F</span> <span class="main">∘</span> <span class="free">G</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">(</span><span class="free">H</span> <span class="main">∘</span> <span class="free">F</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">(</span>lfp <span class="free">G</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>lfp <span class="free">H</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"lfp <span class="free">H</span> <span class="main">⊑</span> <span class="free">F</span> <span class="main">(</span>lfp <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> monoG fgh_comp eq_iff upper_galois_connections.u_simple_fusion<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">F</span> <span class="main">∘</span> <span class="free">G</span><span class="main">)</span> <span class="bound">x</span> <span class="main">⊑</span> <span class="main">(</span><span class="free">H</span> <span class="main">∘</span> <span class="free">F</span><span class="main">)</span> <span class="bound">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fgh_comp <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">(</span>lfp <span class="free">G</span><span class="main">)</span> <span class="main">⊑</span> <span class="main">(</span>lfp <span class="free">H</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> monoH distF fusion_lfp_leq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword2"><span class="keyword">end</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

</pre>
</div><div id="Iteration">
<div class="head">
<h1>Theory Iteration</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Iteration \label{S:iteration}›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Iteration
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="#Galois_Connections">Galois_Connections</a>
  <a href="#CRA">CRA</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Possibly infinite iteration›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Iteration of finite or infinite steps can be defined using a least fixed point.
›</span></span>


<span class="comment1">(* hide_fact (open) Random_Sequence.iter_def *)</span>

<span class="keyword1"><span class="command">locale</span></span> finite_or_infinite_iteration <span class="main">=</span> seq_distrib <span class="main">+</span> upper_galois_connections
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">iter</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"_<span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span>"</span> <span class="main">[</span>103<span class="main">]</span> 102<span class="main">)</span> <span class="comment1">(* this can be entered as \sup\circ *)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="keyword1"><span class="free"><span class="hidden">⇧</span><sup>ω</sup></span></span> <span class="main">≡</span> lfp <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="keyword1"><span class="free">nil</span></span> <span class="main">⊓</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">;</span></span><span class="bound">x</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Iteration-iter_step_mono"><span class="command">lemma</span></span> iter_step_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"mono <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="keyword1"><span class="free">nil</span></span> <span class="main">⊓</span> <span class="free">c</span><span class="main"><span class="free">;</span></span><span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> inf_mono order_refl seq_mono_right mono_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  This fixed point definition leads to the two core iteration lemmas:
  folding and induction.
›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> iter_unfold<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span> <span class="main">=</span> <span class="keyword1"><span class="free">nil</span></span> <span class="main">⊓</span> <span class="free">c</span><span class="main"><span class="free">;</span></span><span class="free">c</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> iter_def iter_step_mono lfp_unfold <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Iteration-iter_induct_nil"><span class="command">lemma</span></span> iter_induct_nil<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">nil</span></span> <span class="main">⊓</span> <span class="free">c</span><span class="main"><span class="free">;</span></span><span class="free">x</span> <span class="main">⊑</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">c</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span> <span class="main">⊑</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iter_def lfp_lowerbound<span class="main">)</span>

<span class="keyword1" id="Iteration-iter0"><span class="command">lemma</span></span> iter0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span> <span class="main">⊑</span> <span class="keyword1"><span class="free">nil</span></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> iter_unfold sup.orderI sup_inf_absorb<span class="main">)</span>

<span class="keyword1" id="Iteration-iter1"><span class="command">lemma</span></span> iter1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span> <span class="main">⊑</span> <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_le2 iter0 iter_unfold order.trans seq_mono_right seq_nil_right<span class="main">)</span>

<span class="keyword1" id="Iteration-iter2"><span class="command">lemma</span></span> iter2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span><span class="main"><span class="free">;</span></span><span class="free">c</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span> <span class="main">=</span> <span class="free">c</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span><span class="main"><span class="free">;</span></span><span class="free">c</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span> <span class="main">⊑</span> <span class="free">c</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> iter0 seq_mono_right <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">nil</span></span> <span class="main">⊓</span> <span class="free">c</span><span class="main"><span class="free">;</span></span><span class="free">c</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span><span class="main"><span class="free">;</span></span><span class="free">c</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span> <span class="main">⊑</span> <span class="keyword1"><span class="free">nil</span></span> <span class="main">⊓</span> <span class="free">c</span><span class="main"><span class="free">;</span></span><span class="free">c</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span> <span class="main">⊓</span> <span class="free">c</span><span class="main"><span class="free">;</span></span><span class="free">c</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span><span class="main"><span class="free">;</span></span><span class="free">c</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_greatest inf_le2 inf_mono iter0 order_refl seq_distrib_left.seq_mono_right seq_distrib_left_axioms seq_nil_right<span class="main">)</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">c</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span> <span class="main">⊓</span> <span class="free">c</span><span class="main"><span class="free">;</span></span><span class="free">c</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span><span class="main"><span class="free">;</span></span><span class="free">c</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> iter_unfold <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1"><span class="free">nil</span></span> <span class="main">⊓</span> <span class="free">c</span><span class="main"><span class="free">;</span></span><span class="free">c</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span><span class="main">)</span><span class="main"><span class="free">;</span></span><span class="free">c</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_seq_distrib<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span> <span class="main">⊑</span> <span class="free">c</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span><span class="main"><span class="free">;</span></span><span class="free">c</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a iter_induct_nil iter_unfold seq_assoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Iteration-iter_mono"><span class="command">lemma</span></span> iter_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">⊑</span> <span class="free">d</span> <span class="main">⟹</span> <span class="free">c</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span> <span class="main">⊑</span> <span class="free">d</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">⊑</span> <span class="free">d</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">nil</span></span> <span class="main">⊓</span> <span class="free">c</span><span class="main"><span class="free">;</span></span><span class="free">d</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span> <span class="main">⊑</span> <span class="free">d</span><span class="main"><span class="free">;</span></span><span class="free">d</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf.absorb_iff2 inf_left_commute inf_seq_distrib<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">nil</span></span> <span class="main">⊓</span> <span class="free">c</span><span class="main"><span class="free">;</span></span><span class="free">d</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span> <span class="main">⊑</span> <span class="free">d</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf.bounded_iff inf_sup_ord<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> iter_unfold<span class="main">)</span> 
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iter_induct_nil<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Iteration-iter_abort"><span class="command">lemma</span></span> iter_abort<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊥</span> <span class="main">=</span> <span class="keyword1"><span class="free">nil</span></span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> antisym iter_induct_nil<span class="main">)</span>

<span class="keyword1" id="Iteration-nil_iter"><span class="command">lemma</span></span> nil_iter<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊤</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span> <span class="main">=</span> <span class="keyword1"><span class="free">nil</span></span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> inf_top.right_neutral iter_unfold seq_top<span class="main">)</span>
<span class="comment1">(*
lemma iter_conj_distrib:
  assumes nil: "c ⊑ nil"
    and repeat: "c ⊑ c ; c"
  shows "c \&lt;iinter&gt; d<span class="hidden">⇧</span><sup>ω</sup> ⊑ (c \&lt;iinter&gt; d)<span class="hidden">⇧</span><sup>ω</sup>"
proof (unfold iter_def)
  def F ≡ "(λ x. c \&lt;iinter&gt; x)"
  def G ≡ "(λ x. nil ⊓ d;x)"
  def H ≡ "(λ x. nil ⊓ ((c \&lt;iinter&gt; d);x))"

  have FG: "F ∘ G = (λ x. c \&lt;iinter&gt; (nil ⊓ d;x))"  by (metis comp_def F_def G_def) 
  have HF: "H ∘ F = (λ x. (nil ⊓ (c \&lt;iinter&gt; d);(c \&lt;iinter&gt; x)))" by (metis comp_def H_def F_def) 

  have "F (lfp G) ⊑ lfp H"
  proof (rule fusion_lfp_leq)
    show "mono H" by (simp add: H_def iter_step_mono)
  next
    show "dist_over_sup F" by (simp add: F_def conj_Sup_distrib)
  next
    fix x
    have "c \&lt;iinter&gt; (nil ⊓ d;x) = (c \&lt;iinter&gt; nil) ⊓ (c \&lt;iinter&gt; d;x)" by (metis inf_conj_distrib conj_commute)
    also have "... ⊑ nil ⊓ (c \&lt;iinter&gt; d;x)" by (metis conjunction_sup inf_mono_left le_iff_sup nil)
    also have "... ⊑ nil ⊓ (c;c \&lt;iinter&gt; d;x)" by (metis inf_conj_distrib inf.absorb_iff2 inf_mono_right repeat)
    also have "... ⊑ nil ⊓ (c \&lt;iinter&gt; d);(c \&lt;iinter&gt; x)" by (meson inf_mono_right sequential_interchange)
    finally show "(F ∘ G) x ⊑ (H ∘ F) x" by (simp add: FG HF)
  qed

  then show "c \&lt;iinter&gt; lfp(λx. nil ⊓ d ; x) ⊑ lfp (λx. nil ⊓ (c \&lt;iinter&gt; d) ; x)" using F_def G_def H_def by simp
qed

lemma iter_conj_distrib1: "c<span class="hidden">⇧</span><sup>ω</sup> \&lt;iinter&gt; d<span class="hidden">⇧</span><sup>ω</sup> ⊑ (c<span class="hidden">⇧</span><sup>ω</sup> \&lt;iinter&gt; d)<span class="hidden">⇧</span><sup>ω</sup>"
  by (simp add: iter0 iter_conj_distrib)

lemma iter_conj_distrib2: "c<span class="hidden">⇧</span><sup>ω</sup> \&lt;iinter&gt; d<span class="hidden">⇧</span><sup>ω</sup> ⊑ (c \&lt;iinter&gt; d)<span class="hidden">⇧</span><sup>ω</sup>"
proof -
  have a: "c<span class="hidden">⇧</span><sup>ω</sup> ⊑ c" by (metis iter1)
  have b: "c<span class="hidden">⇧</span><sup>ω</sup> \&lt;iinter&gt; d<span class="hidden">⇧</span><sup>ω</sup> ⊑ (c<span class="hidden">⇧</span><sup>ω</sup> \&lt;iinter&gt; d)<span class="hidden">⇧</span><sup>ω</sup>" by (metis iter_conj_distrib1)
  have "c<span class="hidden">⇧</span><sup>ω</sup> \&lt;iinter&gt; d ⊑ c \&lt;iinter&gt; d" by (metis a conj_mono order.refl) 
  thus ?thesis using a b by (metis refine_trans iter_mono) 
qed
*)</span>
<span class="keyword2"><span class="keyword">end</span></span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Finite iteration›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Iteration of a finite number of steps (Kleene star) is defined
  using the greatest fixed point.
›</span></span>

<span class="keyword1"><span class="command">locale</span></span> finite_iteration <span class="main">=</span> seq_distrib <span class="main">+</span> lower_galois_connections
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">fiter</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"_<span class="keyword1"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span> <span class="main">[</span>101<span class="main">]</span> 100<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free"><span class="hidden">⇧</span><sup>⋆</sup></span></span> <span class="main">≡</span> gfp <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="keyword1"><span class="free">nil</span></span> <span class="main">⊓</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">;</span></span><span class="bound">x</span><span class="main">)</span>"</span></span>


<span class="keyword1" id="Iteration-fin_iter_step_mono"><span class="command">lemma</span></span> fin_iter_step_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"mono <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="keyword1"><span class="free">nil</span></span> <span class="main">⊓</span> <span class="free">c</span><span class="main"><span class="free">;</span></span><span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> inf_mono order_refl seq_mono_right mono_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  This definition leads to the two core iteration lemmas:
  folding and induction.
›</span></span>

<span class="keyword1" id="Iteration-fiter_unfold"><span class="command">lemma</span></span> fiter_unfold<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="keyword1"><span class="free">nil</span></span> <span class="main">⊓</span> <span class="free">c</span><span class="main"><span class="free">;</span></span><span class="free">c</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> fiter_def gfp_unfold fin_iter_step_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Iteration-fiter_induct_nil"><span class="command">lemma</span></span> fiter_induct_nil<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊑</span> <span class="keyword1"><span class="free">nil</span></span> <span class="main">⊓</span> <span class="free">c</span><span class="main"><span class="free">;</span></span><span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">⊑</span> <span class="free">c</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fiter_def gfp_upperbound<span class="main">)</span>

<span class="keyword1" id="Iteration-fiter0"><span class="command">lemma</span></span> fiter0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊑</span> <span class="keyword1"><span class="free">nil</span></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fiter_unfold inf.cobounded1<span class="main">)</span>

<span class="keyword1" id="Iteration-fiter1"><span class="command">lemma</span></span> fiter1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊑</span> <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fiter0 fiter_unfold inf_le2 order.trans seq_mono_right seq_nil_right<span class="main">)</span>

<span class="keyword1" id="Iteration-fiter_induct_eq"><span class="command">lemma</span></span> fiter_induct_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main"><span class="free">;</span></span><span class="free">d</span> <span class="main">=</span> gfp <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="free">c</span><span class="main"><span class="free">;</span></span><span class="bound">x</span> <span class="main">⊓</span> <span class="free">d</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">F</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main"><span class="free">;</span></span><span class="free">d</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">G</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="keyword1"><span class="free">nil</span></span> <span class="main">⊓</span> <span class="free">c</span><span class="main"><span class="free">;</span></span><span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">H</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="free">c</span><span class="main"><span class="free">;</span></span><span class="bound">x</span> <span class="main">⊓</span> <span class="free">d</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> FG<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">∘</span> <span class="skolem">G</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="free">c</span><span class="main"><span class="free">;</span></span><span class="bound">x</span><span class="main"><span class="free">;</span></span><span class="free">d</span> <span class="main">⊓</span> <span class="free">d</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> F_def G_def comp_def inf_commute inf_seq_distrib<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> HF<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">∘</span> <span class="skolem">F</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="free">c</span><span class="main"><span class="free">;</span></span><span class="bound">x</span><span class="main"><span class="free">;</span></span><span class="free">d</span> <span class="main">⊓</span> <span class="free">d</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_def seq_assoc H_def F_def<span class="main">)</span> 

  <span class="keyword1"><span class="command">have</span></span> adjoint<span class="main">:</span> <span class="quoted"><span class="quoted">"dist_over_inf <span class="skolem">F</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Inf_seq_distrib F_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> monoH<span class="main">:</span> <span class="quoted"><span class="quoted">"mono <span class="skolem">H</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> H_def inf_mono_left monoI seq_distrib_left.seq_mono_right seq_distrib_left_axioms<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> monoG<span class="main">:</span> <span class="quoted"><span class="quoted">"mono <span class="skolem">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> G_def inf_mono_right mono_def seq_mono_right<span class="main">)</span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="skolem">F</span> <span class="main">∘</span> <span class="skolem">G</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">H</span> <span class="main">∘</span> <span class="skolem">F</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> FG HF <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">(</span>gfp <span class="skolem">G</span><span class="main">)</span> <span class="main">=</span> gfp <span class="skolem">H</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> adjoint monoG monoH fusion_gfp_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>gfp <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="keyword1"><span class="free">nil</span></span> <span class="main">⊓</span> <span class="free">c</span><span class="main"><span class="free">;</span></span><span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="free">;</span></span><span class="free">d</span> <span class="main">=</span> gfp <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="free">c</span><span class="main"><span class="free">;</span></span><span class="bound">x</span> <span class="main">⊓</span> <span class="free">d</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> F_def G_def H_def inf_commute <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fiter_def<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> fiter_induct<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊑</span> <span class="free">d</span> <span class="main">⊓</span> <span class="free">c</span><span class="main"><span class="free">;</span></span><span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">⊑</span> <span class="free">c</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main"><span class="free">;</span></span><span class="free">d</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊑</span> <span class="free">d</span> <span class="main">⊓</span> <span class="free">c</span><span class="main"><span class="free">;</span></span><span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊑</span> <span class="free">c</span><span class="main"><span class="free">;</span></span><span class="free">x</span> <span class="main">⊓</span> <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> inf_commute <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊑</span> gfp <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="free">c</span><span class="main"><span class="free">;</span></span><span class="bound">x</span> <span class="main">⊓</span> <span class="free">d</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gfp_upperbound<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> fiter_induct_eq<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Iteration-fiter2"><span class="command">lemma</span></span> fiter2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main"><span class="free">;</span></span><span class="free">c</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="free">c</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> lr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main"><span class="free">;</span></span><span class="free">c</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊑</span> <span class="free">c</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fiter0 seq_mono_right seq_nil_right <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
  <span class="keyword1"><span class="command">have</span></span> rl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊑</span> <span class="free">c</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main"><span class="free">;</span></span><span class="free">c</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fiter_induct fiter_unfold inf.right_idem order_refl<span class="main">)</span> 
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> antisym lr<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Iteration-fiter3"><span class="command">lemma</span></span> fiter3 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="free">c</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dual_order.refl fiter0 fiter1 fiter2 fiter_induct inf.commute inf_absorb1 seq_nil_right<span class="main">)</span>

<span class="keyword1" id="Iteration-fiter_mono"><span class="command">lemma</span></span> fiter_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">⊑</span> <span class="free">d</span> <span class="main">⟹</span> <span class="free">c</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊑</span> <span class="free">d</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">⊑</span> <span class="free">d</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊑</span> <span class="keyword1"><span class="free">nil</span></span> <span class="main">⊓</span> <span class="free">d</span><span class="main"><span class="free">;</span></span><span class="free">c</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fiter0 fiter1 fiter2 inf.bounded_iff refine_trans seq_mono_left<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> seq_nil_right fiter_induct<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Infinite iteration›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Iteration of infinite number of steps can be defined
  using a least fixed point.
›</span></span>

<span class="keyword1"><span class="command">locale</span></span> infinite_iteration <span class="main">=</span> seq_distrib <span class="main">+</span> lower_galois_connections
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">infiter</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span>  <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"_<span class="keyword1"><span class="hidden">⇧</span><sup>∞</sup></span>"</span> <span class="main">[</span>105<span class="main">]</span> 106<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free"><span class="hidden">⇧</span><sup>∞</sup></span></span> <span class="main">≡</span> lfp <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">;</span></span><span class="bound">x</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Iteration-infiter_step_mono"><span class="command">lemma</span></span> infiter_step_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"mono <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="free">c</span><span class="main"><span class="free">;</span></span><span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> inf_mono order_refl seq_mono_right mono_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  This definition leads to the two core iteration lemmas:
  folding and induction.
›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> infiter_unfold<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span> <span class="main">=</span> <span class="free">c</span><span class="main"><span class="free">;</span></span><span class="free">c</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> infiter_def infiter_step_mono lfp_unfold <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Iteration-infiter_induct"><span class="command">lemma</span></span> infiter_induct<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main"><span class="free">;</span></span><span class="free">x</span> <span class="main">⊑</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">c</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span> <span class="main">⊑</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> infiter_def lfp_lowerbound<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> infiter_unfold_any<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span> <span class="main">=</span> <span class="main">(</span><span class="free">c</span> <span class="main"><span class="hidden">⇧</span><sup>;</sup>^</span> <span class="free">i</span><span class="main">)</span> <span class="main"><span class="free">;</span></span> <span class="free">c</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">i</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> infiter_unfold seq_assoc seq_power_Suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Iteration-infiter_annil"><span class="command">lemma</span></span> infiter_annil<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main"><span class="free">;</span></span><span class="free">x</span> <span class="main">=</span> <span class="free">c</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">.</span> <span class="main">(</span><span class="main">⊥</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">⊑</span> <span class="bound">a</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> eq_iff inf.cobounded2 infiter_induct infiter_unfold inf_sup_ord<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> seq_assoc seq_bot weak_seq_inf_distrib seq_nil_right<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Combined iteration›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The three different iteration operators can be combined to show that 
  finite iteration refines finite-or-infinite iteration.
›</span></span>

<span class="keyword1"><span class="command">locale</span></span> iteration <span class="main">=</span> finite_or_infinite_iteration <span class="main">+</span> finite_iteration <span class="main">+</span> 
                   infinite_iteration
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Iteration-refine_iter"><span class="command">lemma</span></span> refine_iter<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span> <span class="main">⊑</span> <span class="free">c</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> seq_nil_right order.refl iter_unfold fiter_induct<span class="main">)</span>

<span class="keyword1" id="Iteration-iter_absorption"><span class="command">lemma</span></span> iter_absorption <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="free">c</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊑</span> <span class="free">c</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fiter1<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span> <span class="main">⊑</span> <span class="main">(</span><span class="free">c</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fiter1 fiter_induct inf_left_idem iter2 iter_unfold seq_nil_right sup.cobounded2 sup.orderE sup_commute<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Iteration-infiter_inf_top"><span class="command">lemma</span></span> infiter_inf_top<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span> <span class="main">=</span> <span class="free">c</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span> <span class="main"><span class="free">;</span></span> <span class="main">⊤</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> lr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span> <span class="main">⊑</span> <span class="free">c</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span> <span class="main"><span class="free">;</span></span> <span class="main">⊤</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main"><span class="free">;</span></span> <span class="main">(</span><span class="free">c</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span> <span class="main"><span class="free">;</span></span> <span class="main">⊤</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1"><span class="free">nil</span></span> <span class="main"><span class="free">;</span></span> <span class="main">⊤</span> <span class="main">⊓</span> <span class="free">c</span> <span class="main"><span class="free">;</span></span> <span class="free">c</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span> <span class="main"><span class="free">;</span></span> <span class="main">⊤</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> semigroup.assoc seq.semigroup_axioms <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> eq_refl finite_or_infinite_iteration.iter_unfold 
         finite_or_infinite_iteration_axioms infiter_induct 
         seq_distrib_right.inf_seq_distrib seq_distrib_right_axioms<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> 
  <span class="keyword1"><span class="command">have</span></span> rl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span> <span class="main"><span class="free">;</span></span> <span class="main">⊤</span> <span class="main">⊑</span> <span class="free">c</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_le2 infiter_annil infiter_unfold iter_induct_nil seq_mono_left<span class="main">)</span> 
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> antisym_conv lr <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Iteration-infiter_fiter_top"><span class="command">lemma</span></span> infiter_fiter_top<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span> <span class="main">⊑</span> <span class="free">c</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main"><span class="free">;</span></span> <span class="main">⊤</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> eq_iff fiter_induct inf_top_left infiter_unfold<span class="main">)</span>

<span class="keyword1" id="Iteration-inf_ref_infiter"><span class="command">lemma</span></span> inf_ref_infiter<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span> <span class="main">⊑</span> <span class="free">c</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> infiter_unfold iter_induct_nil <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

</pre>
</div><div id="Conjunctive_Sequential">
<div class="head">
<h1>Theory Conjunctive_Sequential</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Sequential composition for conjunctive models \label{S:conjunctive-sequential}›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Conjunctive_Sequential
<span class="keyword2"><span class="keyword">imports</span></span> <a href="#Sequential">Sequential</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Sequential left-distributivity is only supported by conjunctive models
  but does not apply in general. The relational model is one such example.
›</span></span>

<span class="keyword1"><span class="command">locale</span></span> seq_finite_conjunctive <span class="main">=</span> seq_distrib_right <span class="main">+</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> seq_inf_distrib<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main"><span class="free">;</span></span><span class="main">(</span><span class="free">d<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">⊓</span> <span class="free">d<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">=</span> <span class="free">c</span><span class="main"><span class="free">;</span></span><span class="free">d<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">⊓</span> <span class="free">c</span><span class="main"><span class="free">;</span></span><span class="free">d<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> seq_distrib_left
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> seq_distrib_left.intro seq_distrib_left_axioms.intro 
        seq_inf_distrib sequential_axioms<span class="main">)</span> 
<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">locale</span></span> seq_infinite_conjunctive <span class="main">=</span> seq_distrib_right <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> seq_Inf_distrib<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">D</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="free">c</span> <span class="main"><span class="free">;</span></span> <span class="main">⨅</span><span class="free">D</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span><span class="bound">d</span><span class="main">∈</span><span class="free">D</span><span class="main">.</span> <span class="free">c</span> <span class="main"><span class="free">;</span></span> <span class="bound">d</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> seq_distrib
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">unfold_locales</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">d<span class="hidden">⇩</span><sub>0</sub></span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">d<span class="hidden">⇩</span><sub>1</sub></span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">d<span class="hidden">⇩</span><sub>0</sub></span><span class="main">,</span> <span class="skolem">d<span class="hidden">⇩</span><sub>1</sub></span><span class="main">}</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main"><span class="free">;</span></span> <span class="main">⨅</span><span class="main">{</span><span class="skolem">d<span class="hidden">⇩</span><sub>0</sub></span><span class="main">,</span> <span class="skolem">d<span class="hidden">⇩</span><sub>1</sub></span><span class="main">}</span> <span class="main">=</span> <span class="main">⨅</span><span class="main">{</span><span class="skolem">c</span> <span class="main"><span class="free">;</span></span> <span class="bound">d</span> <span class="main">|</span><span class="bound">d</span><span class="main">.</span> <span class="bound">d</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">d<span class="hidden">⇩</span><sub>0</sub></span><span class="main">,</span> <span class="skolem">d<span class="hidden">⇩</span><sub>1</sub></span><span class="main">}</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> seq_Inf_distrib
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⨅</span> <span class="main">(</span><span class="main"><span class="free">(;)</span></span> <span class="skolem">c</span> <span class="main">`</span> <span class="main">{</span><span class="skolem">d<span class="hidden">⇩</span><sub>0</sub></span><span class="main">,</span> <span class="skolem">d<span class="hidden">⇩</span><sub>1</sub></span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">⨅</span><span class="main">{</span><span class="skolem">c</span> <span class="main"><span class="free">;</span></span> <span class="bound">a</span> <span class="main">|</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">d<span class="hidden">⇩</span><sub>0</sub></span><span class="main">,</span> <span class="skolem">d<span class="hidden">⇩</span><sub>1</sub></span><span class="main">}</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> INF_Inf <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="main">(</span><span class="bound">c</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>refinement_lattice<span class="main">)</span> <span class="bound">D</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>refinement_lattice set<span class="main">.</span> <span class="bound">D</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="bound">c</span> <span class="main"><span class="free">;</span></span> <span class="main">⨅</span><span class="bound">D</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span><span class="bound">d</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>refinement_lattice<span class="main">∈</span><span class="bound">D</span><span class="main">.</span> <span class="bound">c</span> <span class="main"><span class="free">;</span></span> <span class="bound">d</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="skolem">d<span class="hidden">⇩</span><sub>0</sub></span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>refinement_lattice<span class="main">,</span> <span class="skolem">d<span class="hidden">⇩</span><sub>1</sub></span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>refinement_lattice<span class="main">}</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">c</span> <span class="main"><span class="free">;</span></span> <span class="skolem">d<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">⊓</span> <span class="skolem">c</span> <span class="main"><span class="free">;</span></span> <span class="skolem">d<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> Inf2_inf<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main"><span class="free">;</span></span> <span class="main">(</span><span class="skolem">d<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">⊓</span> <span class="skolem">d<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">⊑</span> <span class="skolem">c</span> <span class="main"><span class="free">;</span></span> <span class="skolem">d<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">⊓</span> <span class="skolem">c</span> <span class="main"><span class="free">;</span></span> <span class="skolem">d<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Conjunctive_Sequential-seq_INF_distrib"><span class="command">lemma</span></span> seq_INF_distrib<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="free">c</span> <span class="main"><span class="free">;</span></span> <span class="main">(</span><span class="main">⨅</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> <span class="free">d</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> <span class="free">c</span> <span class="main"><span class="free">;</span></span> <span class="free">d</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> xne<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main"><span class="free">;</span></span> <span class="main">(</span><span class="main">⨅</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> <span class="free">d</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">c</span> <span class="main"><span class="free">;</span></span> <span class="main">⨅</span><span class="main">(</span><span class="free">d</span> <span class="main">`</span> <span class="free">X</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span><span class="bound">d</span><span class="main">∈</span><span class="main">(</span><span class="free">d</span> <span class="main">`</span> <span class="free">X</span><span class="main">)</span><span class="main">.</span> <span class="free">c</span> <span class="main"><span class="free">;</span></span> <span class="bound">d</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> image_is_empty seq_Inf_distrib xne<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> <span class="free">c</span> <span class="main"><span class="free">;</span></span> <span class="free">d</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> image_comp<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> b image_comp<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Conjunctive_Sequential-seq_INF_distrib_UNIV"><span class="command">lemma</span></span> seq_INF_distrib_UNIV<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main"><span class="free">;</span></span> <span class="main">(</span><span class="main">⨅</span><span class="bound">x</span><span class="main">.</span> <span class="free">d</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span> <span class="main"><span class="free">;</span></span> <span class="free">d</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> seq_INF_distrib<span class="main">)</span>

<span class="keyword1" id="Conjunctive_Sequential-INF_INF_seq_distrib"><span class="command">lemma</span></span> INF_INF_seq_distrib<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Y</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⨅</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> <span class="free">c</span> <span class="bound">x</span><span class="main">)</span> <span class="main"><span class="free">;</span></span> <span class="main">(</span><span class="main">⨅</span><span class="bound">y</span><span class="main">∈</span><span class="free">Y</span><span class="main">.</span> <span class="free">d</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> <span class="main">⨅</span><span class="bound">y</span><span class="main">∈</span><span class="free">Y</span><span class="main">.</span> <span class="free">c</span> <span class="bound">x</span> <span class="main"><span class="free">;</span></span> <span class="free">d</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> INF_seq_distrib seq_INF_distrib<span class="main">)</span>

<span class="keyword1" id="Conjunctive_Sequential-INF_INF_seq_distrib_UNIV"><span class="command">lemma</span></span> INF_INF_seq_distrib_UNIV<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨅</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span> <span class="bound">x</span><span class="main">)</span> <span class="main"><span class="free">;</span></span> <span class="main">(</span><span class="main">⨅</span><span class="bound">y</span><span class="main">.</span> <span class="free">d</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span><span class="bound">x</span><span class="main">.</span> <span class="main">⨅</span><span class="bound">y</span><span class="main">.</span> <span class="free">c</span> <span class="bound">x</span> <span class="main"><span class="free">;</span></span> <span class="free">d</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> INF_INF_seq_distrib<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

</pre>
</div><div id="Infimum_Nat">
<div class="head">
<h1>Theory Infimum_Nat</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Infimum nat lemmas \label{S:infimum-nat}›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Infimum_Nat
<span class="keyword2"><span class="keyword">imports</span></span> 
  <a href="#Refinement_Lattice">Refinement_Lattice</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">locale</span></span> infimum_nat
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Infimum_Nat-INF_partition_nat3"><span class="command">lemma</span></span> INF_partition_nat3<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">::</span>refinement_lattice"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨅</span><span class="bound">j</span><span class="main">.</span> <span class="free">f</span> <span class="free">i</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span><span class="main">⨅</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="bound">j</span><span class="main">.</span> <span class="free">i</span> <span class="main">=</span> <span class="bound">j</span><span class="main">}</span><span class="main">.</span> <span class="free">f</span> <span class="free">i</span> <span class="bound">j</span><span class="main">)</span> <span class="main">⊓</span>
    <span class="main">(</span><span class="main">⨅</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="bound">j</span><span class="main">.</span> <span class="free">i</span> <span class="main">&lt;</span> <span class="bound">j</span><span class="main">}</span><span class="main">.</span> <span class="free">f</span> <span class="free">i</span> <span class="bound">j</span><span class="main">)</span> <span class="main">⊓</span>
    <span class="main">(</span><span class="main">⨅</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="bound">j</span><span class="main">.</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="free">i</span><span class="main">}</span><span class="main">.</span> <span class="free">f</span> <span class="free">i</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> univ_part<span class="main">:</span> <span class="quoted"><span class="quoted">"UNIV <span class="main">=</span> <span class="main">{</span><span class="bound">j</span><span class="main">.</span> <span class="free">i</span> <span class="main">=</span> <span class="bound">j</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">j</span><span class="main">.</span> <span class="free">i</span> <span class="main">&lt;</span> <span class="bound">j</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">j</span><span class="main">.</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="free">i</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨅</span><span class="bound">j</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">j</span><span class="main">.</span> <span class="free">i</span> <span class="main">=</span> <span class="bound">j</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">j</span><span class="main">.</span> <span class="free">i</span> <span class="main">&lt;</span> <span class="bound">j</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">j</span><span class="main">.</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="free">i</span><span class="main">}</span><span class="main">.</span> <span class="free">f</span> <span class="free">i</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span>
          <span class="main">(</span><span class="main">⨅</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="bound">j</span><span class="main">.</span> <span class="free">i</span> <span class="main">=</span> <span class="bound">j</span><span class="main">}</span><span class="main">.</span> <span class="free">f</span> <span class="free">i</span> <span class="bound">j</span><span class="main">)</span> <span class="main">⊓</span>
          <span class="main">(</span><span class="main">⨅</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="bound">j</span><span class="main">.</span> <span class="free">i</span> <span class="main">&lt;</span> <span class="bound">j</span><span class="main">}</span><span class="main">.</span> <span class="free">f</span> <span class="free">i</span> <span class="bound">j</span><span class="main">)</span> <span class="main">⊓</span>
          <span class="main">(</span><span class="main">⨅</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="bound">j</span><span class="main">.</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="free">i</span><span class="main">}</span><span class="main">.</span> <span class="free">f</span> <span class="free">i</span> <span class="bound">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> INF_union<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> univ_part <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Infimum_Nat-INF_INF_partition_nat3"><span class="command">lemma</span></span> INF_INF_partition_nat3<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">::</span>refinement_lattice"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨅</span><span class="bound">i</span><span class="main">.</span> <span class="main">⨅</span><span class="bound">j</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span><span class="main">⨅</span><span class="bound">i</span><span class="main">.</span> <span class="main">⨅</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="bound">j</span><span class="main">.</span> <span class="bound">i</span> <span class="main">=</span> <span class="bound">j</span><span class="main">}</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">)</span> <span class="main">⊓</span>
    <span class="main">(</span><span class="main">⨅</span><span class="bound">i</span><span class="main">.</span> <span class="main">⨅</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="bound">j</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="bound">j</span><span class="main">}</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">)</span> <span class="main">⊓</span>
    <span class="main">(</span><span class="main">⨅</span><span class="bound">i</span><span class="main">.</span> <span class="main">⨅</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="bound">j</span><span class="main">.</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="bound">i</span><span class="main">}</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨅</span><span class="bound">i</span><span class="main">.</span> <span class="main">⨅</span><span class="bound">j</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">⨅</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="bound">j</span><span class="main">.</span> <span class="bound">i</span> <span class="main">=</span> <span class="bound">j</span><span class="main">}</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">)</span> <span class="main">⊓</span>
                                  <span class="main">(</span><span class="main">⨅</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="bound">j</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="bound">j</span><span class="main">}</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">)</span> <span class="main">⊓</span>
                                  <span class="main">(</span><span class="main">⨅</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="bound">j</span><span class="main">.</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="bound">i</span><span class="main">}</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> INF_partition_nat3<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span><span class="bound">i</span><span class="main">.</span> <span class="main">⨅</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="bound">j</span><span class="main">.</span> <span class="bound">i</span> <span class="main">=</span> <span class="bound">j</span><span class="main">}</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">)</span> <span class="main">⊓</span>
                   <span class="main">(</span><span class="main">⨅</span><span class="bound">i</span><span class="main">.</span> <span class="main">⨅</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="bound">j</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="bound">j</span><span class="main">}</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">)</span> <span class="main">⊓</span>
                   <span class="main">(</span><span class="main">⨅</span><span class="bound">i</span><span class="main">.</span> <span class="main">⨅</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="bound">j</span><span class="main">.</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="bound">i</span><span class="main">}</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> INF_inf_distrib<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Infimum_Nat-INF_nat_shift"><span class="command">lemma</span></span> INF_nat_shift<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨅</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">i</span><span class="main">}</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span><span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> greaterThan_0 greaterThan_def range_composition<span class="main">)</span>

<span class="keyword1" id="Infimum_Nat-INF_nat_minus"><span class="command">lemma</span></span> INF_nat_minus<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">::</span>refinement_lattice"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨅</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="bound">j</span><span class="main">.</span> <span class="free">i</span> <span class="main">&lt;</span> <span class="bound">j</span><span class="main">}</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">j</span> <span class="main">-</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="bound">k</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">k</span><span class="main">}</span><span class="main">.</span> <span class="free">f</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> INF_mono<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> add.right_neutral add_diff_cancel_left' add_less_cancel_left order_refl<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> INF_mono<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> order_refl zero_less_diff<span class="main">)</span>

<span class="comment1">(* TODO: generalise to P j i? *)</span>
<span class="keyword1" id="Infimum_Nat-INF_INF_guarded_switch"><span class="command">lemma</span></span> INF_INF_guarded_switch<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">::</span>refinement_lattice"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨅</span><span class="bound">i</span><span class="main">.</span> <span class="main">⨅</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="bound">j</span><span class="main">.</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="bound">i</span><span class="main">}</span><span class="main">.</span> <span class="free">f</span> <span class="bound">j</span> <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span><span class="bound">j</span><span class="main">.</span> <span class="main">⨅</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="bound">i</span><span class="main">}</span><span class="main">.</span> <span class="free">f</span> <span class="bound">j</span> <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">jj</span> <span class="bound">ii</span><span class="main">.</span> <span class="bound">jj</span> <span class="main">&lt;</span> <span class="bound">ii</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">i</span><span class="main">.</span> <span class="main">∃</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span><span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="bound">j</span> <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span> <span class="main">⊑</span> <span class="free">f</span> <span class="bound">jj</span> <span class="main">(</span><span class="bound">ii</span> <span class="main">-</span> <span class="bound">jj</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">jj</span> <span class="bound">ii</span><span class="main">.</span> <span class="bound">jj</span> <span class="main">&lt;</span> <span class="bound">ii</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="main">⨅</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="bound">j</span><span class="main">.</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="bound">i</span><span class="main">}</span><span class="main">.</span> <span class="free">f</span> <span class="bound">j</span> <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">⊑</span> <span class="free">f</span> <span class="bound">jj</span> <span class="main">(</span><span class="bound">ii</span> <span class="main">-</span> <span class="bound">jj</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> INF_lower mem_Collect_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">jj</span> <span class="bound">ii</span><span class="main">.</span> <span class="bound">jj</span> <span class="main">&lt;</span> <span class="bound">ii</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⨅</span><span class="bound">i</span><span class="main">.</span> <span class="main">⨅</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="bound">j</span><span class="main">.</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="bound">i</span><span class="main">}</span><span class="main">.</span> <span class="free">f</span> <span class="bound">j</span> <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">⊑</span> <span class="free">f</span> <span class="bound">jj</span> <span class="main">(</span><span class="bound">ii</span> <span class="main">-</span> <span class="bound">jj</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> UNIV_I INF_lower dual_order.trans<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">jj</span><span class="main">.</span> <span class="main">(</span><span class="main">⨅</span><span class="bound">i</span><span class="main">.</span> <span class="main">⨅</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="bound">j</span><span class="main">.</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="bound">i</span><span class="main">}</span><span class="main">.</span> <span class="free">f</span> <span class="bound">j</span> <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">⊑</span> <span class="main">(</span><span class="main">⨅</span><span class="bound">ii</span><span class="main">∈</span><span class="main">{</span><span class="bound">ii</span><span class="main">.</span> <span class="bound">jj</span> <span class="main">&lt;</span> <span class="bound">ii</span><span class="main">}</span><span class="main">.</span> <span class="free">f</span> <span class="bound">jj</span> <span class="main">(</span><span class="bound">ii</span> <span class="main">-</span> <span class="bound">jj</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> INF_greatest mem_Collect_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨅</span><span class="bound">i</span><span class="main">.</span> <span class="main">⨅</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="bound">j</span><span class="main">.</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="bound">i</span><span class="main">}</span><span class="main">.</span> <span class="free">f</span> <span class="bound">j</span> <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">⊑</span> <span class="main">(</span><span class="main">⨅</span><span class="bound">jj</span><span class="main">.</span> <span class="main">⨅</span><span class="bound">ii</span><span class="main">∈</span><span class="main">{</span><span class="bound">ii</span><span class="main">.</span> <span class="bound">jj</span> <span class="main">&lt;</span> <span class="bound">ii</span><span class="main">}</span><span class="main">.</span> <span class="free">f</span> <span class="bound">jj</span> <span class="main">(</span><span class="bound">ii</span> <span class="main">-</span> <span class="bound">jj</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> INF_greatest<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨅</span><span class="bound">i</span><span class="main">.</span> <span class="main">⨅</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="bound">j</span><span class="main">.</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="bound">i</span><span class="main">}</span><span class="main">.</span> <span class="free">f</span> <span class="bound">j</span> <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">⊑</span> <span class="main">(</span><span class="main">⨅</span><span class="bound">j</span><span class="main">.</span> <span class="main">⨅</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="bound">i</span><span class="main">}</span><span class="main">.</span> <span class="free">f</span> <span class="bound">j</span> <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ii</span> <span class="bound">jj</span><span class="main">.</span> <span class="bound">jj</span> <span class="main">&lt;</span> <span class="bound">ii</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">j</span><span class="main">.</span> <span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">&gt;</span><span class="bound">j</span><span class="main">.</span> <span class="free">f</span> <span class="bound">j</span> <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span> <span class="main">⊑</span> <span class="free">f</span> <span class="bound">jj</span> <span class="main">(</span><span class="bound">ii</span> <span class="main">-</span> <span class="bound">jj</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ii</span> <span class="bound">jj</span><span class="main">.</span> <span class="bound">jj</span> <span class="main">&lt;</span> <span class="bound">ii</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">j</span><span class="main">.</span> <span class="main">(</span><span class="main">⨅</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="bound">i</span><span class="main">}</span><span class="main">.</span> <span class="free">f</span> <span class="bound">j</span> <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">⊑</span> <span class="free">f</span> <span class="bound">jj</span> <span class="main">(</span><span class="bound">ii</span> <span class="main">-</span> <span class="bound">jj</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> INF_lower mem_Collect_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ii</span> <span class="bound">jj</span><span class="main">.</span> <span class="bound">jj</span> <span class="main">&lt;</span> <span class="bound">ii</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⨅</span><span class="bound">j</span><span class="main">.</span> <span class="main">⨅</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="bound">i</span><span class="main">}</span><span class="main">.</span> <span class="free">f</span> <span class="bound">j</span> <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">⊑</span> <span class="free">f</span> <span class="bound">jj</span> <span class="main">(</span><span class="bound">ii</span> <span class="main">-</span> <span class="bound">jj</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> UNIV_I INF_lower dual_order.trans<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ii</span><span class="main">.</span> <span class="main">(</span><span class="main">⨅</span><span class="bound">j</span><span class="main">.</span> <span class="main">⨅</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="bound">i</span><span class="main">}</span><span class="main">.</span> <span class="free">f</span> <span class="bound">j</span> <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">⊑</span> <span class="main">(</span><span class="main">⨅</span><span class="bound">jj</span><span class="main">∈</span><span class="main">{</span><span class="bound">jj</span><span class="main">.</span> <span class="bound">jj</span> <span class="main">&lt;</span> <span class="bound">ii</span><span class="main">}</span><span class="main">.</span> <span class="free">f</span> <span class="bound">jj</span> <span class="main">(</span><span class="bound">ii</span> <span class="main">-</span> <span class="bound">jj</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> INF_greatest mem_Collect_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨅</span><span class="bound">j</span><span class="main">.</span> <span class="main">⨅</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="bound">i</span><span class="main">}</span><span class="main">.</span> <span class="free">f</span> <span class="bound">j</span> <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">⊑</span> <span class="main">(</span><span class="main">⨅</span><span class="bound">ii</span><span class="main">.</span> <span class="main">⨅</span><span class="bound">jj</span><span class="main">∈</span><span class="main">{</span><span class="bound">jj</span><span class="main">.</span> <span class="bound">jj</span> <span class="main">&lt;</span> <span class="bound">ii</span><span class="main">}</span><span class="main">.</span> <span class="free">f</span> <span class="bound">jj</span> <span class="main">(</span><span class="bound">ii</span> <span class="main">-</span> <span class="bound">jj</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> INF_greatest<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨅</span><span class="bound">j</span><span class="main">.</span> <span class="main">⨅</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="bound">i</span><span class="main">}</span><span class="main">.</span> <span class="free">f</span> <span class="bound">j</span> <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">⊑</span> <span class="main">(</span><span class="main">⨅</span><span class="bound">i</span><span class="main">.</span> <span class="main">⨅</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="bound">j</span><span class="main">.</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="bound">i</span><span class="main">}</span><span class="main">.</span> <span class="free">f</span> <span class="bound">j</span> <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Conjunctive_Iteration">
<div class="head">
<h1>Theory Conjunctive_Iteration</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Iteration for conjunctive models \label{S:conjunctive-iteration}›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Conjunctive_Iteration
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="#Conjunctive_Sequential">Conjunctive_Sequential</a>
  <a href="#Iteration">Iteration</a>
  <a href="#Infimum_Nat">Infimum_Nat</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Sequential left-distributivity is only supported by conjunctive models
  but does not apply in general. The relational model is one such example.
›</span></span>

<span class="keyword1"><span class="command">locale</span></span> iteration_finite_conjunctive <span class="main">=</span> seq_finite_conjunctive <span class="main">+</span> iteration

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Conjunctive_Iteration-isolation"><span class="command">lemma</span></span> isolation<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span> <span class="main">=</span> <span class="free">c</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊓</span> <span class="free">c</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">F</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="free">c</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊓</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">G</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="free">c</span><span class="main"><span class="free">;</span></span><span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">H</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="keyword1"><span class="free">nil</span></span> <span class="main">⊓</span> <span class="free">c</span><span class="main"><span class="free">;</span></span><span class="bound">x</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> FG<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">∘</span> <span class="skolem">G</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="free">c</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊓</span> <span class="free">c</span><span class="main"><span class="free">;</span></span><span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> F_def G_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> HF<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">∘</span> <span class="skolem">F</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="keyword1"><span class="free">nil</span></span> <span class="main">⊓</span> <span class="free">c</span><span class="main"><span class="free">;</span></span><span class="main">(</span><span class="free">c</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊓</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> F_def H_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> adjoint<span class="main">:</span> <span class="quoted"><span class="quoted">"dist_over_sup <span class="skolem">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> F_def inf_Sup<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> monoH<span class="main">:</span> <span class="quoted"><span class="quoted">"mono <span class="skolem">H</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> H_def inf_mono monoI order_refl seq_mono_right<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> monoG<span class="main">:</span> <span class="quoted"><span class="quoted">"mono <span class="skolem">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> G_def inf.absorb_iff2 monoI seq_inf_distrib<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="skolem">F</span> <span class="main">∘</span> <span class="skolem">G</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">H</span> <span class="main">∘</span> <span class="skolem">F</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> FG HF 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fiter_unfold inf_sup_aci<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> seq_inf_distrib<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">(</span>lfp <span class="skolem">G</span><span class="main">)</span> <span class="main">=</span> lfp <span class="skolem">H</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> adjoint monoH monoG fusion_lfp_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊓</span> lfp <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="free">c</span><span class="main"><span class="free">;</span></span><span class="bound">x</span><span class="main">)</span> <span class="main">=</span> lfp <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="keyword1"><span class="free">nil</span></span> <span class="main">⊓</span> <span class="free">c</span><span class="main"><span class="free">;</span></span><span class="bound">x</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> F_def G_def H_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> infiter_def iter_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Conjunctive_Iteration-iter_induct_isolate"><span class="command">lemma</span></span> iter_induct_isolate<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main"><span class="free">;</span></span><span class="free">d</span> <span class="main">⊓</span> <span class="free">c</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span> <span class="main">=</span> lfp <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="free">d</span> <span class="main">⊓</span> <span class="free">c</span><span class="main"><span class="free">;</span></span><span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">F</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="free">c</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main"><span class="free">;</span></span><span class="free">d</span> <span class="main">⊓</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">G</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="free">c</span><span class="main"><span class="free">;</span></span><span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">H</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="free">d</span> <span class="main">⊓</span> <span class="free">c</span><span class="main"><span class="free">;</span></span><span class="bound">x</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> FG<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">∘</span> <span class="skolem">G</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="free">c</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main"><span class="free">;</span></span><span class="free">d</span> <span class="main">⊓</span> <span class="free">c</span><span class="main"><span class="free">;</span></span><span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> F_def G_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> HF<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">∘</span> <span class="skolem">F</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="free">d</span> <span class="main">⊓</span> <span class="free">c</span><span class="main"><span class="free">;</span></span><span class="free">c</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main"><span class="free">;</span></span><span class="free">d</span> <span class="main">⊓</span> <span class="free">c</span><span class="main"><span class="free">;</span></span><span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> F_def H_def weak_seq_inf_distrib
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_apply inf.commute inf.left_commute seq_assoc seq_inf_distrib<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> unroll<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main"><span class="free">;</span></span><span class="free">d</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1"><span class="free">nil</span></span> <span class="main">⊓</span> <span class="free">c</span><span class="main"><span class="free">;</span></span><span class="free">c</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main"><span class="free">;</span></span><span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fiter_unfold <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> distribute<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main"><span class="free">;</span></span><span class="free">d</span> <span class="main">=</span> <span class="free">d</span> <span class="main">⊓</span> <span class="free">c</span><span class="main"><span class="free">;</span></span><span class="free">c</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main"><span class="free">;</span></span><span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> unroll inf_seq_distrib<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> FGx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">F</span> <span class="main">∘</span> <span class="skolem">G</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="free">d</span> <span class="main">⊓</span> <span class="free">c</span><span class="main"><span class="free">;</span></span><span class="free">c</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main"><span class="free">;</span></span><span class="free">d</span> <span class="main">⊓</span> <span class="free">c</span><span class="main"><span class="free">;</span></span><span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> FG distribute <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">have</span></span> adjoint<span class="main">:</span> <span class="quoted"><span class="quoted">"dist_over_sup <span class="skolem">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> F_def inf_Sup<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> monoH<span class="main">:</span> <span class="quoted"><span class="quoted">"mono <span class="skolem">H</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> H_def inf_mono monoI order_refl seq_mono_right<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> monoG<span class="main">:</span> <span class="quoted"><span class="quoted">"mono <span class="skolem">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> G_def inf.absorb_iff2 monoI seq_inf_distrib<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="skolem">F</span> <span class="main">∘</span> <span class="skolem">G</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">H</span> <span class="main">∘</span> <span class="skolem">F</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> FGx HF <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> FG distribute<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">(</span>lfp <span class="skolem">G</span><span class="main">)</span> <span class="main">=</span> lfp <span class="skolem">H</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> adjoint monoH monoG fusion_lfp_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main"><span class="free">;</span></span><span class="free">d</span> <span class="main">⊓</span> lfp <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="free">c</span><span class="main"><span class="free">;</span></span><span class="bound">x</span><span class="main">)</span> <span class="main">=</span> lfp <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="free">d</span> <span class="main">⊓</span> <span class="free">c</span><span class="main"><span class="free">;</span></span><span class="bound">x</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> F_def G_def H_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> infiter_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> 

<span class="keyword1" id="Conjunctive_Iteration-iter_induct_eq"><span class="command">lemma</span></span> iter_induct_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span><span class="main"><span class="free">;</span></span><span class="free">d</span> <span class="main">=</span> lfp <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="free">d</span> <span class="main">⊓</span> <span class="free">c</span><span class="main"><span class="free">;</span></span><span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span><span class="main"><span class="free">;</span></span><span class="free">d</span> <span class="main">=</span> <span class="free">c</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main"><span class="free">;</span></span><span class="free">d</span> <span class="main">⊓</span> <span class="free">c</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main"><span class="free">;</span></span><span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> isolation inf_seq_distrib<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main"><span class="free">;</span></span><span class="free">d</span> <span class="main">⊓</span> <span class="free">c</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main"><span class="free">;</span></span><span class="free">d</span> <span class="main">=</span> <span class="free">c</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main"><span class="free">;</span></span><span class="free">d</span> <span class="main">⊓</span> <span class="free">c</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> infiter_annil<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main"><span class="free">;</span></span><span class="free">d</span> <span class="main">⊓</span> <span class="free">c</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span> <span class="main">=</span> lfp <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="free">d</span> <span class="main">⊓</span> <span class="free">c</span><span class="main"><span class="free">;</span></span><span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iter_induct_isolate<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span> <span class="main"><span class="free">;</span></span> <span class="free">d</span> <span class="main">=</span> <span class="free">c</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main"><span class="free">;</span></span> <span class="free">d</span> <span class="main">⊓</span> <span class="free">c</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span> <span class="main"><span class="free">;</span></span> <span class="free">d</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main"><span class="free">;</span></span> <span class="free">d</span> <span class="main">⊓</span> <span class="free">c</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span> <span class="main"><span class="free">;</span></span> <span class="free">d</span> <span class="main">=</span> <span class="free">c</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main"><span class="free">;</span></span> <span class="free">d</span> <span class="main">⊓</span> <span class="free">c</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span>›</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Conjunctive_Iteration-iter_induct"><span class="command">lemma</span></span> iter_induct<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">⊓</span> <span class="free">c</span><span class="main"><span class="free">;</span></span><span class="free">x</span> <span class="main">⊑</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">c</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span><span class="main"><span class="free">;</span></span><span class="free">d</span> <span class="main">⊑</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iter_induct_eq lfp_lowerbound<span class="main">)</span>

<span class="keyword1" id="Conjunctive_Iteration-iter_isolate"><span class="command">lemma</span></span> iter_isolate<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main"><span class="free">;</span></span><span class="free">d</span> <span class="main">⊓</span> <span class="free">c</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span> <span class="main">=</span> <span class="free">c</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span><span class="main"><span class="free">;</span></span><span class="free">d</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iter_induct_eq iter_induct_isolate<span class="main">)</span>

<span class="keyword1" id="Conjunctive_Iteration-iter_isolate2"><span class="command">lemma</span></span> iter_isolate2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main"><span class="free">;</span></span><span class="free">c</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main"><span class="free">;</span></span><span class="free">d</span> <span class="main">⊓</span> <span class="free">c</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span> <span class="main">=</span> <span class="free">c</span><span class="main"><span class="free">;</span></span><span class="free">c</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span><span class="main"><span class="free">;</span></span><span class="free">d</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> infiter_unfold iter_isolate seq_assoc seq_inf_distrib<span class="main">)</span>

<span class="keyword1" id="Conjunctive_Iteration-iter_decomp"><span class="command">lemma</span></span> iter_decomp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span> <span class="main">⊓</span> <span class="free">d</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span> <span class="main">=</span> <span class="free">c</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span><span class="main"><span class="free">;</span></span><span class="main">(</span><span class="free">d</span><span class="main"><span class="free">;</span></span><span class="free">c</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span>      <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main"><span class="free">;</span></span><span class="free">c</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span><span class="main"><span class="free">;</span></span><span class="main">(</span><span class="free">d</span><span class="main"><span class="free">;</span></span><span class="free">c</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span> <span class="main">⊓</span> <span class="main">(</span><span class="free">d</span><span class="main"><span class="free">;</span></span><span class="free">c</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span> <span class="main">⊑</span> <span class="free">c</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span><span class="main"><span class="free">;</span></span><span class="main">(</span><span class="free">d</span><span class="main"><span class="free">;</span></span><span class="free">c</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_commute order.refl inf_seq_distrib seq_nil_left iter_unfold<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span> <span class="main">⊓</span> <span class="free">d</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span> <span class="main">⊑</span> <span class="free">c</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span><span class="main"><span class="free">;</span></span><span class="main">(</span><span class="free">d</span><span class="main"><span class="free">;</span></span><span class="free">c</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf.left_commute iter_induct_nil iter_unfold seq_assoc inf_seq_distrib<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main"><span class="free">;</span></span><span class="main">(</span><span class="free">c</span> <span class="main">⊓</span> <span class="free">d</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span> <span class="main">⊓</span> <span class="free">d</span><span class="main"><span class="free">;</span></span><span class="main">(</span><span class="free">c</span> <span class="main">⊓</span> <span class="free">d</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span><span class="main">)</span> <span class="main">⊓</span> <span class="keyword1"><span class="free">nil</span></span> <span class="main">⊑</span> <span class="main">(</span><span class="free">c</span> <span class="main">⊓</span> <span class="free">d</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_commute order.refl inf_seq_distrib iter_unfold<span class="main">)</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span><span class="main"><span class="free">;</span></span><span class="main">(</span><span class="free">d</span><span class="main"><span class="free">;</span></span><span class="main">(</span><span class="free">c</span> <span class="main">⊓</span> <span class="free">d</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span> <span class="main">⊓</span> <span class="keyword1"><span class="free">nil</span></span><span class="main">)</span> <span class="main">⊑</span> <span class="main">(</span><span class="free">c</span> <span class="main">⊓</span> <span class="free">d</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">nil</span></span> <span class="main">⊓</span> <span class="free">d</span><span class="main"><span class="free">;</span></span><span class="main">(</span><span class="free">c</span> <span class="main">⊓</span> <span class="free">d</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span> <span class="main">⊓</span> <span class="free">c</span><span class="main"><span class="free">;</span></span><span class="main">(</span><span class="free">c</span> <span class="main">⊓</span> <span class="free">d</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span> <span class="main">⊑</span> <span class="main">(</span><span class="free">c</span> <span class="main">⊓</span> <span class="free">d</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> eq_iff inf.semigroup_axioms inf_commute inf_seq_distrib iter_unfold semigroup.assoc<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> iter_induct_eq <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_sup_aci<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> iter_induct<span class="main">)</span> 
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span><span class="main"><span class="free">;</span></span><span class="free">c</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span><span class="main"><span class="free">;</span></span><span class="main">(</span><span class="free">d</span><span class="main"><span class="free">;</span></span><span class="main">(</span><span class="free">c</span> <span class="main">⊓</span> <span class="free">d</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span> <span class="main">⊓</span> <span class="keyword1"><span class="free">nil</span></span><span class="main">)</span> <span class="main">⊓</span> <span class="keyword1"><span class="free">nil</span></span> <span class="main">⊑</span> <span class="free">d</span><span class="main"><span class="free">;</span></span><span class="main">(</span><span class="free">c</span> <span class="main">⊓</span> <span class="free">d</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span> <span class="main">⊓</span> <span class="keyword1"><span class="free">nil</span></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_mono order.refl seq_assoc seq_mono<span class="main">)</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">d</span><span class="main"><span class="free">;</span></span><span class="free">c</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span> <span class="main">⊑</span> <span class="free">d</span><span class="main"><span class="free">;</span></span><span class="main">(</span><span class="free">c</span> <span class="main">⊓</span> <span class="free">d</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span> <span class="main">⊓</span> <span class="keyword1"><span class="free">nil</span></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_commute iter_induct_nil<span class="main">)</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span><span class="main"><span class="free">;</span></span><span class="main">(</span><span class="free">d</span><span class="main"><span class="free">;</span></span><span class="free">c</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span> <span class="main">⊑</span> <span class="free">c</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span><span class="main"><span class="free">;</span></span><span class="main">(</span><span class="free">d</span><span class="main"><span class="free">;</span></span><span class="main">(</span><span class="free">c</span> <span class="main">⊓</span> <span class="free">d</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span> <span class="main">⊓</span> <span class="keyword1"><span class="free">nil</span></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> order.refl seq_mono<span class="main">)</span> 
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span><span class="main"><span class="free">;</span></span><span class="main">(</span><span class="free">d</span><span class="main"><span class="free">;</span></span><span class="free">c</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span> <span class="main">⊑</span> <span class="main">(</span><span class="free">c</span> <span class="main">⊓</span> <span class="free">d</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a refine_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Conjunctive_Iteration-iter_leapfrog_var"><span class="command">lemma</span></span> iter_leapfrog_var<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main"><span class="free">;</span></span><span class="free">d</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span><span class="main"><span class="free">;</span></span><span class="free">c</span> <span class="main">⊑</span> <span class="free">c</span><span class="main"><span class="free">;</span></span><span class="main">(</span><span class="free">d</span><span class="main"><span class="free">;</span></span><span class="free">c</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">⊓</span> <span class="free">c</span><span class="main"><span class="free">;</span></span><span class="free">d</span><span class="main"><span class="free">;</span></span><span class="free">c</span><span class="main"><span class="free">;</span></span><span class="main">(</span><span class="free">d</span><span class="main"><span class="free">;</span></span><span class="free">c</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span> <span class="main">⊑</span> <span class="free">c</span><span class="main"><span class="free">;</span></span><span class="main">(</span><span class="free">d</span><span class="main"><span class="free">;</span></span><span class="free">c</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> iter_unfold order_refl seq_assoc seq_inf_distrib seq_nil_right<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> iter_induct_eq <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> iter_induct seq_assoc<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Conjunctive_Iteration-iter_leapfrog"><span class="command">lemma</span></span> iter_leapfrog<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main"><span class="free">;</span></span><span class="main">(</span><span class="free">d</span><span class="main"><span class="free">;</span></span><span class="free">c</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span> <span class="main">=</span> <span class="main">(</span><span class="free">c</span><span class="main"><span class="free">;</span></span><span class="free">d</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span><span class="main"><span class="free">;</span></span><span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main"><span class="free">;</span></span><span class="free">d</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span><span class="main"><span class="free">;</span></span><span class="free">c</span> <span class="main">⊑</span> <span class="free">c</span><span class="main"><span class="free">;</span></span><span class="main">(</span><span class="free">d</span><span class="main"><span class="free">;</span></span><span class="free">c</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> iter_leapfrog_var<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">d</span><span class="main"><span class="free">;</span></span><span class="free">c</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span> <span class="main">⊑</span> <span class="main">(</span><span class="main">(</span><span class="free">d</span><span class="main"><span class="free">;</span></span><span class="free">c</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span><span class="main"><span class="free">;</span></span><span class="free">d</span><span class="main">)</span><span class="main"><span class="free">;</span></span><span class="free">c</span> <span class="main">⊓</span> <span class="keyword1"><span class="free">nil</span></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf.bounded_iff order.refl seq_assoc seq_mono iter_unfold iter1 iter2<span class="main">)</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">d</span><span class="main"><span class="free">;</span></span><span class="free">c</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span> <span class="main">⊑</span> <span class="main">(</span><span class="free">d</span><span class="main"><span class="free">;</span></span><span class="main">(</span><span class="free">c</span><span class="main"><span class="free">;</span></span><span class="free">d</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span><span class="main">)</span><span class="main"><span class="free">;</span></span><span class="free">c</span> <span class="main">⊓</span> <span class="keyword1"><span class="free">nil</span></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf.absorb_iff2 inf.boundedE inf_assoc iter_leapfrog_var inf_seq_distrib<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main"><span class="free">;</span></span><span class="main">(</span><span class="free">d</span><span class="main"><span class="free">;</span></span><span class="free">c</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span> <span class="main">⊑</span> <span class="free">c</span><span class="main"><span class="free">;</span></span><span class="free">d</span><span class="main"><span class="free">;</span></span><span class="main">(</span><span class="free">c</span><span class="main"><span class="free">;</span></span><span class="free">d</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span><span class="main"><span class="free">;</span></span><span class="free">c</span> <span class="main">⊓</span> <span class="keyword1"><span class="free">nil</span></span><span class="main"><span class="free">;</span></span><span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> inf.bounded_iff seq_assoc seq_mono_right seq_nil_left seq_nil_right <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main"><span class="free">;</span></span><span class="main">(</span><span class="free">d</span><span class="main"><span class="free">;</span></span><span class="free">c</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span> <span class="main">⊑</span> <span class="main">(</span><span class="free">c</span><span class="main"><span class="free">;</span></span><span class="free">d</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span><span class="main"><span class="free">;</span></span><span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_commute inf_seq_distrib iter_unfold<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Conjunctive_Iteration-fiter_leapfrog"><span class="command">lemma</span></span> fiter_leapfrog<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main"><span class="free">;</span></span><span class="main">(</span><span class="free">d</span><span class="main"><span class="free">;</span></span><span class="free">c</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="main">(</span><span class="free">c</span><span class="main"><span class="free">;</span></span><span class="free">d</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main"><span class="free">;</span></span><span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> lr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main"><span class="free">;</span></span><span class="main">(</span><span class="free">d</span><span class="main"><span class="free">;</span></span><span class="free">c</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊑</span> <span class="main">(</span><span class="free">c</span><span class="main"><span class="free">;</span></span><span class="free">d</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main"><span class="free">;</span></span><span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">d</span> <span class="main"><span class="free">;</span></span> <span class="free">c</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="keyword1"><span class="free">nil</span></span> <span class="main">⊓</span> <span class="free">d</span> <span class="main"><span class="free">;</span></span> <span class="free">c</span> <span class="main"><span class="free">;</span></span> <span class="main">(</span><span class="free">d</span> <span class="main"><span class="free">;</span></span> <span class="free">c</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> finite_iteration.fiter_unfold finite_iteration_axioms<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fiter_induct seq_assoc seq_distrib_left.weak_seq_inf_distrib 
          seq_distrib_left_axioms seq_nil_right<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> rl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main"><span class="free">;</span></span><span class="free">d</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main"><span class="free">;</span></span><span class="free">c</span> <span class="main">⊑</span> <span class="free">c</span><span class="main"><span class="free">;</span></span><span class="main">(</span><span class="free">d</span><span class="main"><span class="free">;</span></span><span class="free">c</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main"><span class="free">;</span></span><span class="free">d</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main"><span class="free">;</span></span><span class="free">c</span> <span class="main">=</span> <span class="free">c</span> <span class="main">⊓</span> <span class="free">c</span><span class="main"><span class="free">;</span></span><span class="free">d</span><span class="main"><span class="free">;</span></span><span class="main">(</span><span class="free">c</span><span class="main"><span class="free">;</span></span><span class="free">d</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main"><span class="free">;</span></span><span class="free">c</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> finite_iteration.fiter_unfold finite_iteration_axioms 
           inf_seq_distrib seq_nil_left<span class="main">)</span>  
    <span class="keyword1"><span class="command">have</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main"><span class="free">;</span></span><span class="free">d</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main"><span class="free">;</span></span><span class="free">c</span> <span class="main">⊑</span> <span class="free">c</span><span class="main"><span class="free">;</span></span><span class="main">(</span><span class="free">d</span><span class="main"><span class="free">;</span></span><span class="free">c</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⟷</span> <span class="free">c</span> <span class="main">⊓</span> <span class="free">c</span><span class="main"><span class="free">;</span></span><span class="free">d</span><span class="main"><span class="free">;</span></span><span class="main">(</span><span class="free">c</span><span class="main"><span class="free">;</span></span><span class="free">d</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main"><span class="free">;</span></span><span class="free">c</span> <span class="main">⊑</span> <span class="free">c</span><span class="main"><span class="free">;</span></span><span class="main">(</span><span class="free">d</span><span class="main"><span class="free">;</span></span><span class="free">c</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a1<span class="main">)</span>  
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> a3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⟷</span> <span class="free">c</span><span class="main"><span class="free">;</span></span><span class="main">(</span> <span class="keyword1"><span class="free">nil</span></span> <span class="main">⊓</span> <span class="free">d</span><span class="main"><span class="free">;</span></span><span class="main">(</span><span class="free">c</span><span class="main"><span class="free">;</span></span><span class="free">d</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main"><span class="free">;</span></span><span class="free">c</span><span class="main">)</span> <span class="main">⊑</span> <span class="free">c</span><span class="main"><span class="free">;</span></span><span class="main">(</span><span class="free">d</span><span class="main"><span class="free">;</span></span><span class="free">c</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a1 eq_iff fiter_unfold lr seq_assoc seq_inf_distrib seq_nil_right<span class="main">)</span>  
    <span class="keyword1"><span class="command">have</span></span> a4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1"><span class="free">nil</span></span> <span class="main">⊓</span> <span class="free">d</span><span class="main"><span class="free">;</span></span><span class="main">(</span><span class="free">c</span><span class="main"><span class="free">;</span></span><span class="free">d</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main"><span class="free">;</span></span><span class="free">c</span><span class="main">)</span> <span class="main">⊑</span> <span class="main">(</span><span class="free">d</span><span class="main"><span class="free">;</span></span><span class="free">c</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⟹</span> <span class="free">c</span><span class="main"><span class="free">;</span></span><span class="main">(</span> <span class="keyword1"><span class="free">nil</span></span> <span class="main">⊓</span> <span class="free">d</span><span class="main"><span class="free">;</span></span><span class="main">(</span><span class="free">c</span><span class="main"><span class="free">;</span></span><span class="free">d</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main"><span class="free">;</span></span><span class="free">c</span><span class="main">)</span> <span class="main">⊑</span> <span class="free">c</span><span class="main"><span class="free">;</span></span><span class="main">(</span><span class="free">d</span><span class="main"><span class="free">;</span></span><span class="free">c</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> seq_mono_right <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> a5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1"><span class="free">nil</span></span> <span class="main">⊓</span> <span class="free">d</span><span class="main"><span class="free">;</span></span><span class="main">(</span><span class="free">c</span><span class="main"><span class="free">;</span></span><span class="free">d</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main"><span class="free">;</span></span><span class="free">c</span><span class="main">)</span> <span class="main">⊑</span> <span class="main">(</span><span class="free">d</span><span class="main"><span class="free">;</span></span><span class="free">c</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main"><span class="free">;</span></span> <span class="main">(</span><span class="free">c</span> <span class="main"><span class="free">;</span></span> <span class="free">d</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main"><span class="free">;</span></span> <span class="free">c</span> <span class="main">⊓</span> <span class="keyword1"><span class="free">nil</span></span> <span class="main">=</span> <span class="free">d</span> <span class="main"><span class="free">;</span></span> <span class="main">(</span><span class="main">(</span><span class="free">c</span> <span class="main"><span class="free">;</span></span> <span class="free">d</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main"><span class="free">;</span></span> <span class="free">c</span><span class="main">)</span> <span class="main">⊓</span> <span class="keyword1"><span class="free">nil</span></span> <span class="main">⊓</span> <span class="keyword1"><span class="free">nil</span></span>"</span></span>
           <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> seq_assoc<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main"><span class="free">;</span></span> <span class="free">c</span> <span class="main"><span class="free">;</span></span> <span class="main">(</span><span class="free">d</span> <span class="main"><span class="free">;</span></span> <span class="main">(</span><span class="free">c</span> <span class="main"><span class="free">;</span></span> <span class="free">d</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main"><span class="free">;</span></span> <span class="free">c</span> <span class="main">⊓</span> <span class="keyword1"><span class="free">nil</span></span><span class="main">)</span> <span class="main">=</span> <span class="free">d</span> <span class="main"><span class="free">;</span></span> <span class="main">(</span><span class="main">(</span><span class="free">c</span> <span class="main"><span class="free">;</span></span> <span class="free">d</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main"><span class="free">;</span></span> <span class="free">c</span><span class="main">)</span>"</span></span>
           <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> a1 inf_sup_aci<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> seq_assoc 
                seq_finite_conjunctive.seq_inf_distrib seq_finite_conjunctive_axioms 
                seq_nil_right<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
           <span class="keyword1"><span class="command">using</span></span> f1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> finite_iteration.fiter_induct finite_iteration_axioms 
                           inf.cobounded1 inf_sup_aci<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> seq_nil_right<span class="main">)</span>
     <span class="keyword1"><span class="command">qed</span></span>
   <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> a2 a3 a4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_iff lr<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">locale</span></span> iteration_infinite_conjunctive <span class="main">=</span> seq_infinite_conjunctive <span class="main">+</span> iteration <span class="main">+</span> infimum_nat

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Conjunctive_Iteration-fiter_seq_choice"><span class="command">lemma</span></span> fiter_seq_choice<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span><span class="bound">i</span><span class="main">::</span>nat<span class="main">.</span> <span class="free">c</span> <span class="main"><span class="hidden">⇧</span><sup>;</sup>^</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊑</span> <span class="main">(</span><span class="main">⨅</span><span class="bound">i</span><span class="main">.</span> <span class="free">c</span> <span class="main"><span class="hidden">⇧</span><sup>;</sup>^</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> INF_greatest<span class="main">)</span> 
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊑</span> <span class="free">c</span> <span class="main"><span class="hidden">⇧</span><sup>;</sup>^</span> <span class="skolem">i</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">i</span></span> <span class="quasi_keyword">type</span><span class="main"><span class="main">:</span></span> nat<span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> 0
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊑</span> <span class="free">c</span> <span class="main"><span class="hidden">⇧</span><sup>;</sup>^</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fiter0<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊑</span> <span class="free">c</span> <span class="main"><span class="free">;</span></span> <span class="free">c</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fiter_unfold inf_le2<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⊑</span> <span class="free">c</span> <span class="main"><span class="free">;</span></span> <span class="main">(</span><span class="free">c</span> <span class="main"><span class="hidden">⇧</span><sup>;</sup>^</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Suc.hyps <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> seq_mono_right<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">c</span> <span class="main"><span class="hidden">⇧</span><sup>;</sup>^</span> Suc <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊑</span> <span class="free">c</span> <span class="main"><span class="hidden">⇧</span><sup>;</sup>^</span> Suc <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨅</span><span class="bound">i</span><span class="main">.</span> <span class="free">c</span> <span class="main"><span class="hidden">⇧</span><sup>;</sup>^</span> <span class="bound">i</span><span class="main">)</span> <span class="main">⊑</span> <span class="main">(</span><span class="free">c</span> <span class="main"><span class="hidden">⇧</span><sup>;</sup>^</span> <span class="main">0</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="main">⨅</span><span class="bound">i</span><span class="main">.</span> <span class="free">c</span> <span class="main"><span class="hidden">⇧</span><sup>;</sup>^</span> Suc <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> INF_greatest INF_lower UNIV_I le_inf_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1"><span class="free">nil</span></span> <span class="main">⊓</span> <span class="main">(</span><span class="main">⨅</span><span class="bound">i</span><span class="main">.</span> <span class="free">c</span> <span class="main"><span class="free">;</span></span> <span class="main">(</span><span class="free">c</span> <span class="main"><span class="hidden">⇧</span><sup>;</sup>^</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1"><span class="free">nil</span></span> <span class="main">⊓</span> <span class="free">c</span> <span class="main"><span class="free">;</span></span> <span class="main">(</span><span class="main">⨅</span><span class="bound">i</span><span class="main">.</span> <span class="free">c</span> <span class="main"><span class="hidden">⇧</span><sup>;</sup>^</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> seq_INF_distrib<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨅</span><span class="bound">i</span><span class="main">.</span> <span class="free">c</span> <span class="main"><span class="hidden">⇧</span><sup>;</sup>^</span> <span class="bound">i</span><span class="main">)</span> <span class="main">⊑</span> <span class="free">c</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fiter_induct <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Conjunctive_Iteration-fiter_seq_choice_nonempty"><span class="command">lemma</span></span> fiter_seq_choice_nonempty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main"><span class="free">;</span></span> <span class="free">c</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">i</span><span class="main">}</span><span class="main">.</span> <span class="free">c</span> <span class="main"><span class="hidden">⇧</span><sup>;</sup>^</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨅</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">i</span><span class="main">}</span><span class="main">.</span> <span class="free">c</span> <span class="main"><span class="hidden">⇧</span><sup>;</sup>^</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span><span class="bound">i</span><span class="main">.</span> <span class="free">c</span> <span class="main"><span class="hidden">⇧</span><sup>;</sup>^</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> INF_nat_shift<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span><span class="bound">i</span><span class="main">.</span> <span class="free">c</span> <span class="main"><span class="free">;</span></span> <span class="main">(</span><span class="free">c</span> <span class="main"><span class="hidden">⇧</span><sup>;</sup>^</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">c</span> <span class="main"><span class="free">;</span></span> <span class="main">(</span><span class="main">⨅</span><span class="bound">i</span><span class="main">.</span> <span class="free">c</span> <span class="main"><span class="hidden">⇧</span><sup>;</sup>^</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> seq_INF_distrib_UNIV<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">c</span> <span class="main"><span class="free">;</span></span> <span class="free">c</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fiter_seq_choice<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> conj_iteration <span class="main">=</span> cra <span class="main">+</span> iteration_infinite_conjunctive

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Conjunctive_Iteration-conj_distrib4"><span class="command">lemma</span></span> conj_distrib4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="free">d</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊑</span> <span class="main">(</span><span class="free">c</span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="free">d</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="free">d</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1"><span class="free">nil</span></span> <span class="main">⊓</span> <span class="main">(</span><span class="free">c</span><span class="main"><span class="free">;</span></span><span class="free">c</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="free">d</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fiter_unfold<span class="main">)</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="free">d</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1"><span class="free">nil</span></span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="free">d</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="main">(</span><span class="free">c</span><span class="main"><span class="free">;</span></span><span class="free">c</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="free">d</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_conj_distrib<span class="main">)</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="free">d</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊑</span> <span class="keyword1"><span class="free">nil</span></span> <span class="main">⊓</span> <span class="main">(</span><span class="main">(</span><span class="free">c</span><span class="main"><span class="free">;</span></span><span class="free">c</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="main">(</span><span class="free">d</span><span class="main"><span class="free">;</span></span><span class="free">d</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conj_idem fiter0 fiter_unfold inf.bounded_iff inf_le2 local.conj_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="free">d</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊑</span> <span class="keyword1"><span class="free">nil</span></span> <span class="main">⊓</span> <span class="main">(</span><span class="main">(</span><span class="free">c</span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="free">d</span><span class="main">)</span><span class="main"><span class="free">;</span></span><span class="main">(</span><span class="free">c</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="free">d</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> inf_mono_right order.trans sequential_interchange<span class="main">)</span> 
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> seq_nil_right fiter_induct<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

</pre>
</div><div id="Rely_Quotient">
<div class="head">
<h1>Theory Rely_Quotient</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Rely Quotient Operator \label{S:rely-quotient}›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The rely quotient operator is used to generalise a Jones-style rely condition
  to a process \cite{jon83a}.
  It is defined in terms of the parallel operator and a process $i$
  representing interference from the environment.
›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Rely_Quotient
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="#CRA">CRA</a>
  <a href="#Conjunctive_Iteration">Conjunctive_Iteration</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Basic rely quotient›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The rely quotient of a process $c$ and an interference process $i$
  is the most general process $d$ such that $c$ is refined by $d \parallel i$.
  The following locale introduces the definition of the 
  rely quotient $c \quotient i$ as a non-deterministic choice over 
  all processes $d$ such that $c$ is refined by $d \parallel i$. 
›</span></span>

<span class="keyword1"><span class="command">locale</span></span> rely_quotient <span class="main">=</span> par_distrib <span class="main">+</span> conjunction_parallel
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">rely_quotient</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">'/'/</span>"</span> 85<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main"><span class="free">//</span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">≡</span> <span class="main">⨅</span><span class="main">{</span> <span class="bound">d</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">⊑</span> <span class="bound">d</span> <span class="main"><span class="free">∥</span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Any process $c$ is implemented by itself if the interference is skip.
›</span></span>
<span class="keyword1" id="Rely_Quotient-quotient_identity"><span class="command">lemma</span></span> quotient_identity<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">//</span> <span class="keyword1"><span class="free">skip</span></span> <span class="main">=</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">//</span> <span class="keyword1"><span class="free">skip</span></span> <span class="main">=</span> <span class="main">⨅</span><span class="main">{</span> <span class="bound">d</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span> <span class="main">⊑</span> <span class="bound">d</span> <span class="main"><span class="free">∥</span></span> <span class="keyword1"><span class="free">skip</span></span><span class="main">)</span> <span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> rely_quotient_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">//</span> <span class="keyword1"><span class="free">skip</span></span> <span class="main">=</span> <span class="main">⨅</span><span class="main">{</span> <span class="bound">d</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span> <span class="main">⊑</span> <span class="bound">d</span><span class="main">)</span>  <span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Collect_cong par_skip<span class="main">)</span> 
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Inf_greatest Inf_lower2 dual_order.antisym dual_order.refl mem_Collect_eq<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Provided the interference process $i$ is non-aborting (i.e. it refines chaos), 
  any process $c$ is refined by its rely quotient with $i$ in parallel with $i$.
  If interference $i$ was allowed to be aborting then, 
  because $(c \quotient \bot) \parallel \bot$ equals $\bot$,
  it does not refine $c$ in general. 
›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> rely_quotient<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> nonabort_i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">chaos</span></span> <span class="main">⊑</span> <span class="free">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">⊑</span> <span class="main">(</span><span class="free">c</span> <span class="main">//</span> <span class="free">i</span><span class="main">)</span> <span class="main"><span class="free">∥</span></span> <span class="free">i</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">D</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">D</span> <span class="main">=</span> <span class="main">{</span> <span class="bound">d</span> <span class="main"><span class="free">∥</span></span> <span class="free">i</span> <span class="main">|</span> <span class="bound">d</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span> <span class="main">⊑</span> <span class="bound">d</span> <span class="main"><span class="free">∥</span></span> <span class="free">i</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">=</span> <span class="main">{</span><span class="free">c</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">d</span> <span class="main">∈</span> <span class="skolem">D</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">c</span> <span class="main">∈</span> <span class="skolem">C</span><span class="main">.</span> <span class="bound">c</span> <span class="main">⊑</span> <span class="bound">d</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> D_def C_def CollectD singletonI <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⨅</span> <span class="skolem">C</span> <span class="main">⊑</span> <span class="main">(</span><span class="main">⨅</span> <span class="skolem">D</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Inf_mono<span class="main">)</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">⊑</span> <span class="main">⨅</span><span class="main">{</span> <span class="bound">d</span> <span class="main"><span class="free">∥</span></span> <span class="free">i</span> <span class="main">|</span> <span class="bound">d</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span> <span class="main">⊑</span> <span class="bound">d</span> <span class="main"><span class="free">∥</span></span> <span class="free">i</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C_def D_def<span class="main">)</span> 
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">⨅</span><span class="main">{</span> <span class="bound">d</span> <span class="main"><span class="free">∥</span></span> <span class="free">i</span> <span class="main">|</span> <span class="bound">d</span><span class="main">.</span> <span class="bound">d</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">d</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span> <span class="main">⊑</span> <span class="bound">d</span> <span class="main"><span class="free">∥</span></span> <span class="free">i</span><span class="main">)</span><span class="main">}</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span><span class="bound">d</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">d</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span> <span class="main">⊑</span> <span class="bound">d</span> <span class="main"><span class="free">∥</span></span> <span class="free">i</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="bound">d</span> <span class="main"><span class="free">∥</span></span> <span class="free">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> INF_Inf<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">⨅</span><span class="main">{</span> <span class="bound">d</span> <span class="main">|</span> <span class="bound">d</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span> <span class="main">⊑</span> <span class="bound">d</span> <span class="main"><span class="free">∥</span></span> <span class="free">i</span><span class="main">)</span><span class="main">}</span> <span class="main"><span class="free">∥</span></span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">{</span> <span class="bound">d</span> <span class="main">|</span> <span class="bound">d</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span> <span class="main">⊑</span> <span class="bound">d</span> <span class="main"><span class="free">∥</span></span> <span class="free">i</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span> <span class="bound">d</span> <span class="main">|</span> <span class="bound">d</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span> <span class="main">⊑</span> <span class="bound">d</span> <span class="main"><span class="free">∥</span></span> <span class="free">i</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨅</span><span class="bound">d</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">d</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span> <span class="main">⊑</span> <span class="bound">d</span> <span class="main"><span class="free">∥</span></span> <span class="free">i</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="bound">d</span> <span class="main"><span class="free">∥</span></span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">⨅</span><span class="main">{</span> <span class="bound">d</span> <span class="main">|</span> <span class="bound">d</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span> <span class="main">⊑</span> <span class="bound">d</span> <span class="main"><span class="free">∥</span></span> <span class="free">i</span><span class="main">)</span><span class="main">}</span> <span class="main"><span class="free">∥</span></span> <span class="free">i</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> nonabort_i Collect_empty_eq top_greatest
            nonabort_par_top par_commute <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
  <span class="keyword1"><span class="command">next</span></span> 
    <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span> <span class="bound">d</span> <span class="main">|</span> <span class="bound">d</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span> <span class="main">⊑</span> <span class="bound">d</span> <span class="main"><span class="free">∥</span></span> <span class="free">i</span><span class="main">)</span><span class="main">}</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">d</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span> <span class="main">⊑</span> <span class="bound">d</span> <span class="main"><span class="free">∥</span></span> <span class="free">i</span><span class="main">)</span><span class="main">}</span>  <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨅</span><span class="bound">d</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">d</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span> <span class="main">⊑</span> <span class="bound">d</span> <span class="main"><span class="free">∥</span></span> <span class="free">i</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> <span class="bound">d</span> <span class="main"><span class="free">∥</span></span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">⨅</span><span class="main">{</span> <span class="bound">d</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span> <span class="main">⊑</span> <span class="bound">d</span> <span class="main"><span class="free">∥</span></span> <span class="free">i</span><span class="main">)</span><span class="main">}</span> <span class="main"><span class="free">∥</span></span> <span class="free">i</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Inf_par_distrib <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">c</span> <span class="main">//</span> <span class="free">i</span><span class="main">)</span> <span class="main"><span class="free">∥</span></span> <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> rely_quotient_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The following theorem represents the Galois connection between 
  the parallel operator (upper adjoint) and the rely quotient operator
  (lower adjoint). This basic relationship is used to prove the majority
  of the theorems about rely quotient.
›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> rely_refinement<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> nonabort_i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">chaos</span></span> <span class="main">⊑</span> <span class="free">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">//</span> <span class="free">i</span> <span class="main">⊑</span> <span class="free">d</span> <span class="main">⟷</span> <span class="free">c</span> <span class="main">⊑</span> <span class="free">d</span> <span class="main"><span class="free">∥</span></span> <span class="free">i</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">//</span> <span class="free">i</span> <span class="main">⊑</span> <span class="free">d</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">⊑</span> <span class="main">(</span><span class="free">c</span> <span class="main">//</span> <span class="free">i</span><span class="main">)</span> <span class="main"><span class="free">∥</span></span> <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> rely_quotient nonabort_i <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">⊑</span> <span class="free">d</span> <span class="main"><span class="free">∥</span></span> <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> par_mono a
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf.absorb_iff2 inf_commute le_infI2 order_refl<span class="main">)</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">⊑</span> <span class="free">d</span> <span class="main"><span class="free">∥</span></span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⨅</span><span class="main">{</span> <span class="bound">d</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span> <span class="main">⊑</span> <span class="bound">d</span> <span class="main"><span class="free">∥</span></span> <span class="free">i</span><span class="main">)</span><span class="main">}</span> <span class="main">⊑</span> <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Inf_lower<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">//</span> <span class="free">i</span> <span class="main">⊑</span> <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> rely_quotient_def<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Refining the ``numerator'' in a quotient, refines the quotient.
›</span></span>

<span class="keyword1" id="Rely_Quotient-rely_mono"><span class="command">lemma</span></span> rely_mono<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> c_refsto_d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">⊑</span> <span class="free">d</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span> <span class="main">//</span> <span class="free">i</span><span class="main">)</span> <span class="main">⊑</span> <span class="main">(</span><span class="free">d</span> <span class="main">//</span> <span class="free">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">f</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="free">d</span> <span class="main">⊑</span> <span class="bound">f</span> <span class="main"><span class="free">∥</span></span> <span class="free">i</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">∃</span> <span class="bound">e</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span> <span class="main">⊑</span> <span class="bound">e</span> <span class="main"><span class="free">∥</span></span> <span class="free">i</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">e</span> <span class="main">⊑</span> <span class="bound">f</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> c_refsto_d order.trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⨅</span><span class="main">{</span> <span class="bound">e</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span> <span class="main">⊑</span> <span class="bound">e</span> <span class="main"><span class="free">∥</span></span> <span class="free">i</span><span class="main">)</span><span class="main">}</span> <span class="main">⊑</span>  <span class="main">⨅</span><span class="main">{</span> <span class="bound">f</span><span class="main">.</span> <span class="main">(</span><span class="free">d</span> <span class="main">⊑</span> <span class="bound">f</span> <span class="main"><span class="free">∥</span></span> <span class="free">i</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Inf_mono mem_Collect_eq<span class="main">)</span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> rely_quotient_def b <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Refining the ``denominator'' in a quotient, gives a reverse refinement 
  for the quotients. This corresponds to weaken rely condition law of
  Jones \cite{jon83a}, 
  i.e. assuming less about the environment.
›</span></span>

<span class="keyword1" id="Rely_Quotient-weaken_rely"><span class="command">lemma</span></span> weaken_rely<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> i_refsto_j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">⊑</span> <span class="free">j</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span> <span class="main">//</span> <span class="free">j</span><span class="main">)</span> <span class="main">⊑</span> <span class="main">(</span><span class="free">c</span> <span class="main">//</span> <span class="free">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">f</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="free">c</span> <span class="main">⊑</span> <span class="bound">f</span> <span class="main"><span class="free">∥</span></span> <span class="free">i</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">∃</span> <span class="bound">e</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span> <span class="main">⊑</span> <span class="bound">e</span> <span class="main"><span class="free">∥</span></span> <span class="free">j</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">e</span> <span class="main">⊑</span> <span class="bound">f</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> i_refsto_j order.trans
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf.absorb_iff2 inf_le1 inf_par_distrib inf_sup_ord<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> par_commute<span class="main">)</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⨅</span><span class="main">{</span> <span class="bound">e</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span> <span class="main">⊑</span> <span class="bound">e</span> <span class="main"><span class="free">∥</span></span> <span class="free">j</span><span class="main">)</span><span class="main">}</span> <span class="main">⊑</span>  <span class="main">⨅</span><span class="main">{</span> <span class="bound">f</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span> <span class="main">⊑</span> <span class="bound">f</span> <span class="main"><span class="free">∥</span></span> <span class="free">i</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Inf_mono mem_Collect_eq<span class="main">)</span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> rely_quotient_def b <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rely_Quotient-par_nonabort"><span class="command">lemma</span></span> par_nonabort<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> nonabort_i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">chaos</span></span> <span class="main">⊑</span> <span class="free">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> nonabort_j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">chaos</span></span> <span class="main">⊑</span> <span class="free">j</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">chaos</span></span> <span class="main">⊑</span> <span class="free">i</span> <span class="main"><span class="free">∥</span></span> <span class="free">j</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> chaos_par_chaos nonabort_i nonabort_j order_trans par_mono<span class="main">)</span> 

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Nesting rely quotients of $j$ and $i$ means the same as a single quotient
  which is the parallel composition of $i$ and $j$.
›</span></span>

<span class="keyword1" id="Rely_Quotient-nested_rely"><span class="command">lemma</span></span> nested_rely<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> j_nonabort<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">chaos</span></span> <span class="main">⊑</span> <span class="free">j</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">c</span> <span class="main">//</span> <span class="free">j</span><span class="main">)</span> <span class="main">//</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">c</span> <span class="main">//</span> <span class="main">(</span><span class="free">i</span> <span class="main"><span class="free">∥</span></span> <span class="free">j</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">c</span> <span class="main">//</span> <span class="free">j</span><span class="main">)</span> <span class="main">//</span> <span class="free">i</span><span class="main">)</span> <span class="main">⊑</span> <span class="free">c</span> <span class="main">//</span> <span class="main">(</span><span class="free">i</span> <span class="main"><span class="free">∥</span></span> <span class="free">j</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">f</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="free">c</span> <span class="main">⊑</span> <span class="bound">f</span> <span class="main"><span class="free">∥</span></span> <span class="free">i</span> <span class="main"><span class="free">∥</span></span> <span class="free">j</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">∃</span> <span class="bound">e</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span> <span class="main">⊑</span> <span class="bound">e</span> <span class="main"><span class="free">∥</span></span> <span class="free">j</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">e</span> <span class="main">⊑</span> <span class="bound">f</span> <span class="main"><span class="free">∥</span></span> <span class="free">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⨅</span><span class="main">{</span> <span class="bound">d</span><span class="main">.</span> <span class="main">(</span><span class="main">⨅</span><span class="main">{</span> <span class="bound">e</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span> <span class="main">⊑</span> <span class="bound">e</span> <span class="main"><span class="free">∥</span></span> <span class="free">j</span><span class="main">)</span><span class="main">}</span> <span class="main">⊑</span> <span class="bound">d</span> <span class="main"><span class="free">∥</span></span> <span class="free">i</span><span class="main">)</span><span class="main">}</span> <span class="main">⊑</span>  <span class="main">⨅</span><span class="main">{</span> <span class="bound">f</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span> <span class="main">⊑</span> <span class="bound">f</span> <span class="main"><span class="free">∥</span></span> <span class="free">i</span> <span class="main"><span class="free">∥</span></span> <span class="free">j</span><span class="main">)</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Collect_mono Inf_lower Inf_superset_mono<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> local.rely_quotient_def par_assoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">//</span> <span class="main">(</span><span class="free">i</span> <span class="main"><span class="free">∥</span></span> <span class="free">j</span><span class="main">)</span> <span class="main">⊑</span> <span class="main">(</span><span class="main">(</span><span class="free">c</span> <span class="main">//</span> <span class="free">j</span><span class="main">)</span> <span class="main">//</span> <span class="free">i</span><span class="main">)</span> "</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">⊑</span> <span class="main">⨅</span><span class="main">{</span> <span class="bound">e</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span> <span class="main">⊑</span> <span class="bound">e</span> <span class="main"><span class="free">∥</span></span> <span class="free">j</span><span class="main">)</span><span class="main">}</span> <span class="main"><span class="free">∥</span></span> <span class="free">j</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> j_nonabort local.rely_quotient_def rely_quotient <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">d</span><span class="main">.</span> <span class="main">⨅</span><span class="main">{</span> <span class="bound">e</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span> <span class="main">⊑</span> <span class="bound">e</span> <span class="main"><span class="free">∥</span></span> <span class="free">j</span><span class="main">)</span><span class="main">}</span> <span class="main">⊑</span> <span class="bound">d</span> <span class="main"><span class="free">∥</span></span> <span class="free">i</span>  <span class="main">⟹</span> <span class="main">(</span><span class="free">c</span> <span class="main">⊑</span> <span class="bound">d</span> <span class="main"><span class="free">∥</span></span> <span class="free">i</span> <span class="main"><span class="free">∥</span></span> <span class="free">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> j_nonabort order_trans rely_refinement<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Collect_mono Inf_superset_mono local.rely_quotient_def par_assoc<span class="main">)</span> 
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Distributed rely quotient›</span></span>

<span class="keyword1"><span class="command">locale</span></span> rely_distrib <span class="main">=</span> rely_quotient <span class="main">+</span> conjunction_sequential
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The following is a fundamental law for introducing a parallel composition
  of process to refine a conjunction of specifications. 
  It represents an abstract view of the parallel introduction law of Jones \cite{jon83a}.
›</span></span>

<span class="keyword1" id="Rely_Quotient-introduce_parallel"><span class="command">lemma</span></span> introduce_parallel<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> nonabort_i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">chaos</span></span> <span class="main">⊑</span>  <span class="free">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> nonabort_j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">chaos</span></span> <span class="main">⊑</span>  <span class="free">j</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="free">d</span> <span class="main">⊑</span>  <span class="main">(</span><span class="free">j</span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="main">(</span><span class="free">c</span> <span class="main">//</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">∥</span></span> <span class="main">(</span><span class="free">i</span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="main">(</span><span class="free">d</span> <span class="main">//</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">⊑</span> <span class="main">(</span><span class="free">c</span> <span class="main">//</span> <span class="free">i</span><span class="main">)</span> <span class="main"><span class="free">∥</span></span> <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> nonabort_i nonabort_j rely_quotient <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">⊑</span> <span class="free">j</span> <span class="main"><span class="free">∥</span></span> <span class="main">(</span><span class="free">d</span> <span class="main">//</span> <span class="free">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> rely_quotient par_commute 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nonabort_j<span class="main">)</span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="free">d</span> <span class="main">⊑</span>  <span class="main">(</span><span class="main">(</span><span class="free">c</span> <span class="main">//</span> <span class="free">i</span><span class="main">)</span> <span class="main"><span class="free">∥</span></span> <span class="free">i</span><span class="main">)</span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="main">(</span> <span class="free">j</span> <span class="main"><span class="free">∥</span></span> <span class="main">(</span><span class="free">d</span> <span class="main">//</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a b <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conj_mono<span class="main">)</span> 
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> interchange<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="free">d</span> <span class="main">⊑</span>  <span class="main">(</span><span class="main">(</span><span class="free">c</span> <span class="main">//</span> <span class="free">i</span><span class="main">)</span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="free">j</span><span class="main">)</span> <span class="main"><span class="free">∥</span></span> <span class="main">(</span> <span class="free">i</span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="main">(</span><span class="free">d</span> <span class="main">//</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span>"</span></span> 
   <span class="keyword1"><span class="command">using</span></span> parallel_interchange refine_trans calculation <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> interchange <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.conj_commute<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Rely quotients satisfy a range of distribution properties with respect
  to the other operators.
›</span></span>

<span class="keyword1" id="Rely_Quotient-distribute_rely_conjunction"><span class="command">lemma</span></span> distribute_rely_conjunction<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> nonabort_i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">chaos</span></span> <span class="main">⊑</span>  <span class="free">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="free">d</span><span class="main">)</span> <span class="main">//</span> <span class="free">i</span>  <span class="main">⊑</span>  <span class="main">(</span><span class="free">c</span> <span class="main">//</span> <span class="free">i</span><span class="main">)</span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="main">(</span><span class="free">d</span> <span class="main">//</span> <span class="free">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="free">d</span> <span class="main">⊑</span> <span class="main">(</span><span class="main">(</span><span class="free">c</span> <span class="main">//</span> <span class="free">i</span><span class="main">)</span> <span class="main"><span class="free">∥</span></span> <span class="free">i</span><span class="main">)</span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="main">(</span><span class="main">(</span><span class="free">d</span> <span class="main">//</span> <span class="free">i</span><span class="main">)</span> <span class="main"><span class="free">∥</span></span> <span class="free">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> conj_mono rely_quotient
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nonabort_i<span class="main">)</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="free">d</span> <span class="main">⊑</span> <span class="main">(</span><span class="main">(</span><span class="free">c</span> <span class="main">//</span> <span class="free">i</span><span class="main">)</span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="main">(</span><span class="free">d</span> <span class="main">//</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">∥</span></span> <span class="main">(</span><span class="free">i</span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="free">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> parallel_interchange refine_trans<span class="main">)</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="free">d</span> <span class="main">⊑</span> <span class="main">(</span><span class="main">(</span><span class="free">c</span> <span class="main">//</span> <span class="free">i</span><span class="main">)</span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="main">(</span><span class="free">d</span> <span class="main">//</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">∥</span></span> <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conj_idem<span class="main">)</span> 
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> rely_refinement <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nonabort_i<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rely_Quotient-distribute_rely_choice"><span class="command">lemma</span></span> distribute_rely_choice<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> nonabort_i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">chaos</span></span> <span class="main">⊑</span>  <span class="free">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span> <span class="main">⊓</span> <span class="free">d</span><span class="main">)</span> <span class="main">//</span> <span class="free">i</span>  <span class="main">⊑</span>  <span class="main">(</span><span class="free">c</span> <span class="main">//</span> <span class="free">i</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">d</span> <span class="main">//</span> <span class="free">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">⊓</span> <span class="free">d</span> <span class="main">⊑</span> <span class="main">(</span><span class="main">(</span><span class="free">c</span> <span class="main">//</span> <span class="free">i</span><span class="main">)</span> <span class="main"><span class="free">∥</span></span> <span class="free">i</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="main">(</span><span class="free">d</span> <span class="main">//</span> <span class="free">i</span><span class="main">)</span> <span class="main"><span class="free">∥</span></span> <span class="free">i</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> nonabort_i inf_mono rely_quotient<span class="main">)</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">⊓</span> <span class="free">d</span> <span class="main">⊑</span> <span class="main">(</span><span class="main">(</span><span class="free">c</span> <span class="main">//</span> <span class="free">i</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">d</span> <span class="main">//</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">∥</span></span> <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_par_distrib<span class="main">)</span> 
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> nonabort_i rely_refinement<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rely_Quotient-distribute_rely_parallel1"><span class="command">lemma</span></span> distribute_rely_parallel1<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> nonabort_i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">chaos</span></span> <span class="main">⊑</span>  <span class="free">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> nonabort_j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">chaos</span></span> <span class="main">⊑</span>  <span class="free">j</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span> <span class="main"><span class="free">∥</span></span> <span class="free">d</span><span class="main">)</span> <span class="main">//</span> <span class="main">(</span><span class="free">i</span> <span class="main"><span class="free">∥</span></span> <span class="free">j</span><span class="main">)</span>  <span class="main">⊑</span>  <span class="main">(</span><span class="free">c</span> <span class="main">//</span> <span class="free">i</span><span class="main">)</span> <span class="main"><span class="free">∥</span></span> <span class="main">(</span><span class="free">d</span> <span class="main">//</span> <span class="free">j</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span> <span class="main"><span class="free">∥</span></span> <span class="free">d</span><span class="main">)</span> <span class="main">⊑</span> <span class="main">(</span><span class="main">(</span><span class="free">c</span> <span class="main">//</span> <span class="free">i</span><span class="main">)</span> <span class="main"><span class="free">∥</span></span> <span class="free">i</span><span class="main">)</span> <span class="main"><span class="free">∥</span></span> <span class="main">(</span><span class="main">(</span><span class="free">d</span> <span class="main">//</span> <span class="free">j</span><span class="main">)</span> <span class="main"><span class="free">∥</span></span> <span class="free">j</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> par_mono rely_quotient nonabort_i nonabort_j <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span> <span class="main"><span class="free">∥</span></span> <span class="free">d</span><span class="main">)</span> <span class="main">⊑</span> <span class="main">(</span><span class="free">c</span> <span class="main">//</span> <span class="free">i</span><span class="main">)</span> <span class="main"><span class="free">∥</span></span> <span class="main">(</span><span class="free">d</span> <span class="main">//</span> <span class="free">j</span><span class="main">)</span> <span class="main"><span class="free">∥</span></span> <span class="free">j</span> <span class="main"><span class="free">∥</span></span> <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> par_assoc par_commute<span class="main">)</span> 
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> par_assoc par_commute rely_refinement
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> nonabort_i nonabort_j par_nonabort<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rely_Quotient-distribute_rely_parallel2"><span class="command">lemma</span></span> distribute_rely_parallel2<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> nonabort_i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">chaos</span></span> <span class="main">⊑</span> <span class="free">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> i_par_i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main"><span class="free">∥</span></span> <span class="free">i</span> <span class="main">⊑</span> <span class="free">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span> <span class="main"><span class="free">∥</span></span> <span class="free">d</span><span class="main">)</span> <span class="main">//</span> <span class="free">i</span>  <span class="main">⊑</span>  <span class="main">(</span><span class="free">c</span> <span class="main">//</span> <span class="free">i</span><span class="main">)</span> <span class="main"><span class="free">∥</span></span> <span class="main">(</span><span class="free">d</span> <span class="main">//</span> <span class="free">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span> <span class="main"><span class="free">∥</span></span> <span class="free">d</span><span class="main">)</span> <span class="main">//</span> <span class="free">i</span> <span class="main">⊑</span> <span class="main">(</span><span class="main">(</span><span class="free">c</span> <span class="main"><span class="free">∥</span></span> <span class="free">d</span><span class="main">)</span> <span class="main">//</span> <span class="main">(</span><span class="free">i</span> <span class="main"><span class="free">∥</span></span> <span class="free">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> weaken_rely
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i_par_i par_nonabort<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> distribute_rely_parallel1 refine_trans nonabort_i<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rely_Quotient-distribute_rely_sequential"><span class="command">lemma</span></span> distribute_rely_sequential<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> nonabort_i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">chaos</span></span> <span class="main">⊑</span> <span class="free">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span> <span class="bound">c</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">d</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="bound">c</span> <span class="main"><span class="free">∥</span></span> <span class="free">i</span><span class="main">)</span><span class="main"><span class="free">;</span></span><span class="main">(</span><span class="bound">d</span> <span class="main"><span class="free">∥</span></span> <span class="free">i</span><span class="main">)</span> <span class="main">⊑</span> <span class="main">(</span><span class="bound">c</span><span class="main"><span class="free">;</span></span><span class="bound">d</span><span class="main">)</span> <span class="main"><span class="free">∥</span></span> <span class="free">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main"><span class="free">;</span></span><span class="free">d</span><span class="main">)</span> <span class="main">//</span> <span class="free">i</span> <span class="main">⊑</span> <span class="main">(</span><span class="free">c</span> <span class="main">//</span> <span class="free">i</span><span class="main">)</span><span class="main"><span class="free">;</span></span><span class="main">(</span><span class="free">d</span> <span class="main">//</span> <span class="free">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main"><span class="free">;</span></span><span class="free">d</span> <span class="main">⊑</span> <span class="main">(</span><span class="main">(</span><span class="free">c</span> <span class="main">//</span> <span class="free">i</span><span class="main">)</span> <span class="main"><span class="free">∥</span></span> <span class="free">i</span><span class="main">)</span><span class="main"><span class="free">;</span></span><span class="main">(</span><span class="main">(</span><span class="free">d</span> <span class="main">//</span> <span class="free">i</span><span class="main">)</span> <span class="main"><span class="free">∥</span></span> <span class="free">i</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> rely_quotient nonabort_i seq_mono<span class="main">)</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main"><span class="free">;</span></span><span class="free">d</span> <span class="main">⊑</span> <span class="main">(</span><span class="free">c</span> <span class="main">//</span> <span class="free">i</span><span class="main">)</span> <span class="main"><span class="free">;</span></span> <span class="main">(</span><span class="free">d</span> <span class="main">//</span> <span class="free">i</span><span class="main">)</span> <span class="main"><span class="free">∥</span></span> <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> refine_trans<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> rely_refinement nonabort_i<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rely_Quotient-distribute_rely_sequential_event"><span class="command">lemma</span></span> distribute_rely_sequential_event<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> nonabort_i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">chaos</span></span> <span class="main">⊑</span> <span class="free">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> nonabort_j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">chaos</span></span> <span class="main">⊑</span> <span class="free">j</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> nonabort_e<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">chaos</span></span> <span class="main">⊑</span> <span class="free">e</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span> <span class="bound">c</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">d</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="bound">c</span> <span class="main"><span class="free">∥</span></span> <span class="free">i</span><span class="main">)</span><span class="main"><span class="free">;</span></span><span class="free">e</span><span class="main"><span class="free">;</span></span><span class="main">(</span><span class="bound">d</span> <span class="main"><span class="free">∥</span></span> <span class="free">j</span><span class="main">)</span> <span class="main">⊑</span> <span class="main">(</span><span class="bound">c</span><span class="main"><span class="free">;</span></span><span class="free">e</span><span class="main"><span class="free">;</span></span><span class="bound">d</span><span class="main">)</span> <span class="main"><span class="free">∥</span></span> <span class="main">(</span><span class="free">i</span><span class="main"><span class="free">;</span></span><span class="free">e</span><span class="main"><span class="free">;</span></span><span class="free">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main"><span class="free">;</span></span><span class="free">e</span><span class="main"><span class="free">;</span></span><span class="free">d</span><span class="main">)</span> <span class="main">//</span> <span class="main">(</span><span class="free">i</span><span class="main"><span class="free">;</span></span><span class="free">e</span><span class="main"><span class="free">;</span></span><span class="free">j</span><span class="main">)</span> <span class="main">⊑</span> <span class="main">(</span><span class="free">c</span> <span class="main">//</span> <span class="free">i</span><span class="main">)</span><span class="main"><span class="free">;</span></span><span class="free">e</span><span class="main"><span class="free">;</span></span><span class="main">(</span><span class="free">d</span> <span class="main">//</span> <span class="free">j</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main"><span class="free">;</span></span><span class="free">e</span><span class="main"><span class="free">;</span></span><span class="free">d</span> <span class="main">⊑</span> <span class="main">(</span><span class="main">(</span><span class="free">c</span> <span class="main">//</span> <span class="free">i</span><span class="main">)</span> <span class="main"><span class="free">∥</span></span> <span class="free">i</span><span class="main">)</span><span class="main"><span class="free">;</span></span><span class="free">e</span><span class="main"><span class="free">;</span></span><span class="main">(</span><span class="main">(</span><span class="free">d</span> <span class="main">//</span> <span class="free">j</span><span class="main">)</span> <span class="main"><span class="free">∥</span></span> <span class="free">j</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> order.refl rely_quotient nonabort_i nonabort_j seq_mono<span class="main">)</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main"><span class="free">;</span></span><span class="free">e</span><span class="main"><span class="free">;</span></span><span class="free">d</span> <span class="main">⊑</span> <span class="main">(</span><span class="main">(</span><span class="free">c</span> <span class="main">//</span> <span class="free">i</span><span class="main">)</span><span class="main"><span class="free">;</span></span><span class="free">e</span><span class="main"><span class="free">;</span></span><span class="main">(</span><span class="free">d</span> <span class="main">//</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">∥</span></span> <span class="main">(</span><span class="free">i</span><span class="main"><span class="free">;</span></span><span class="free">e</span><span class="main"><span class="free">;</span></span><span class="free">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> refine_trans<span class="main">)</span> 
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> rely_refinement nonabort_i nonabort_j nonabort_e
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Inf_lower local.rely_quotient_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rely_Quotient-introduce_parallel_with_rely"><span class="command">lemma</span></span> introduce_parallel_with_rely<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> nonabort_i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">chaos</span></span> <span class="main">⊑</span> <span class="free">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> nonabort_j0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">chaos</span></span> <span class="main">⊑</span>  <span class="free">j<span class="hidden">⇩</span><sub>0</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> nonabort_j1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">chaos</span></span> <span class="main">⊑</span>  <span class="free">j<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="free">d</span><span class="main">)</span> <span class="main">//</span> <span class="free">i</span> <span class="main">⊑</span> <span class="main">(</span><span class="free">j<span class="hidden">⇩</span><sub>1</sub></span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="main">(</span><span class="free">c</span> <span class="main">//</span> <span class="main">(</span><span class="free">j<span class="hidden">⇩</span><sub>0</sub></span> <span class="main"><span class="free">∥</span></span> <span class="free">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">∥</span></span> <span class="main">(</span><span class="free">j<span class="hidden">⇩</span><sub>0</sub></span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="main">(</span><span class="free">d</span> <span class="main">//</span> <span class="main">(</span><span class="free">j<span class="hidden">⇩</span><sub>1</sub></span> <span class="main"><span class="free">∥</span></span> <span class="free">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="free">d</span><span class="main">)</span> <span class="main">//</span> <span class="free">i</span> <span class="main">⊑</span> <span class="main">(</span><span class="free">c</span> <span class="main">//</span> <span class="free">i</span><span class="main">)</span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="main">(</span><span class="free">d</span> <span class="main">//</span> <span class="free">i</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> distribute_rely_conjunction nonabort_i<span class="main">)</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="free">d</span><span class="main">)</span> <span class="main">//</span> <span class="free">i</span> <span class="main">⊑</span> <span class="main">(</span><span class="free">j<span class="hidden">⇩</span><sub>1</sub></span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="main">(</span><span class="main">(</span><span class="free">c</span> <span class="main">//</span> <span class="free">i</span><span class="main">)</span> <span class="main">//</span> <span class="free">j<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">∥</span></span> <span class="main">(</span><span class="free">j<span class="hidden">⇩</span><sub>0</sub></span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="main">(</span><span class="main">(</span><span class="free">d</span> <span class="main">//</span> <span class="free">i</span><span class="main">)</span> <span class="main">//</span> <span class="free">j<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> introduce_parallel nonabort_j0 nonabort_j1 inf_assoc inf.absorb_iff1<span class="main">)</span> 
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nested_rely nonabort_i<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rely_Quotient-introduce_parallel_with_rely_guarantee"><span class="command">lemma</span></span> introduce_parallel_with_rely_guarantee<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> nonabort_i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">chaos</span></span> <span class="main">⊑</span>  <span class="free">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> nonabort_j0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">chaos</span></span> <span class="main">⊑</span>  <span class="free">j<span class="hidden">⇩</span><sub>0</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> nonabort_j1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">chaos</span></span> <span class="main">⊑</span>  <span class="free">j<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">j<span class="hidden">⇩</span><sub>1</sub></span> <span class="main"><span class="free">∥</span></span> <span class="free">j<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="main">(</span><span class="free">c</span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="free">d</span><span class="main">)</span> <span class="main">//</span> <span class="free">i</span> <span class="main">⊑</span> <span class="main">(</span><span class="free">j<span class="hidden">⇩</span><sub>1</sub></span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="main">(</span><span class="free">c</span> <span class="main">//</span> <span class="main">(</span><span class="free">j<span class="hidden">⇩</span><sub>0</sub></span> <span class="main"><span class="free">∥</span></span> <span class="free">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">∥</span></span> <span class="main">(</span><span class="free">j<span class="hidden">⇩</span><sub>0</sub></span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="main">(</span><span class="free">d</span> <span class="main">//</span> <span class="main">(</span><span class="free">j<span class="hidden">⇩</span><sub>1</sub></span> <span class="main"><span class="free">∥</span></span> <span class="free">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">j<span class="hidden">⇩</span><sub>1</sub></span> <span class="main"><span class="free">∥</span></span> <span class="free">j<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="main">(</span><span class="free">c</span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="free">d</span><span class="main">)</span> <span class="main">//</span> <span class="free">i</span> <span class="main">⊑</span> <span class="main">(</span><span class="free">j<span class="hidden">⇩</span><sub>1</sub></span> <span class="main"><span class="free">∥</span></span> <span class="free">j<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="main">(</span><span class="main">(</span><span class="free">j<span class="hidden">⇩</span><sub>1</sub></span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="main">(</span><span class="free">c</span> <span class="main">//</span> <span class="main">(</span><span class="free">j<span class="hidden">⇩</span><sub>0</sub></span> <span class="main"><span class="free">∥</span></span> <span class="free">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">∥</span></span> <span class="main">(</span><span class="free">j<span class="hidden">⇩</span><sub>0</sub></span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="main">(</span><span class="free">d</span> <span class="main">//</span> <span class="main">(</span><span class="free">j<span class="hidden">⇩</span><sub>1</sub></span> <span class="main"><span class="free">∥</span></span> <span class="free">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> introduce_parallel_with_rely nonabort_i nonabort_j0 nonabort_j1 
        conj_mono order.refl<span class="main">)</span> 
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⊑</span> <span class="main">(</span><span class="free">j<span class="hidden">⇩</span><sub>1</sub></span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="free">j<span class="hidden">⇩</span><sub>1</sub></span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="main">(</span><span class="free">c</span> <span class="main">//</span> <span class="main">(</span><span class="free">j<span class="hidden">⇩</span><sub>0</sub></span> <span class="main"><span class="free">∥</span></span> <span class="free">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">∥</span></span> <span class="main">(</span><span class="free">j<span class="hidden">⇩</span><sub>0</sub></span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="free">j<span class="hidden">⇩</span><sub>0</sub></span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="main">(</span><span class="free">d</span> <span class="main">//</span> <span class="main">(</span><span class="free">j<span class="hidden">⇩</span><sub>1</sub></span> <span class="main"><span class="free">∥</span></span> <span class="free">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conj_assoc parallel_interchange<span class="main">)</span> 
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conj_idem<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rely_Quotient-wrap_rely_guar"><span class="command">lemma</span></span> wrap_rely_guar<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> nonabort_rg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">chaos</span></span> <span class="main">⊑</span> <span class="free">rg</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> skippable<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">rg</span> <span class="main">⊑</span> <span class="keyword1"><span class="free">skip</span></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">⊑</span> <span class="free">rg</span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="free">c</span> <span class="main">//</span> <span class="free">rg</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">=</span> <span class="free">c</span> <span class="main">//</span> <span class="keyword1"><span class="free">skip</span></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> quotient_identity<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⊑</span> <span class="free">c</span> <span class="main">//</span> <span class="free">rg</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> skippable weaken_rely nonabort_rg<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⊑</span> <span class="free">rg</span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="free">c</span> <span class="main">//</span> <span class="free">rg</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> conjoin_non_aborting conj_commute nonabort_rg 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">⊑</span> <span class="free">rg</span> <span class="main"><span class="free">\&lt;iinter&gt;</span></span> <span class="free">c</span> <span class="main">//</span> <span class="free">rg</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">locale</span></span> rely_distrib_iteration <span class="main">=</span> rely_distrib <span class="main">+</span> iteration_finite_conjunctive

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Rely_Quotient-distribute_rely_iteration"><span class="command">lemma</span></span> distribute_rely_iteration<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> nonabort_i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">chaos</span></span> <span class="main">⊑</span> <span class="free">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span> <span class="bound">c</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">d</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="bound">c</span> <span class="main"><span class="free">∥</span></span> <span class="free">i</span><span class="main">)</span><span class="main"><span class="free">;</span></span><span class="main">(</span><span class="bound">d</span> <span class="main"><span class="free">∥</span></span> <span class="free">i</span><span class="main">)</span> <span class="main">⊑</span> <span class="main">(</span><span class="bound">c</span><span class="main"><span class="free">;</span></span><span class="bound">d</span><span class="main">)</span> <span class="main"><span class="free">∥</span></span> <span class="free">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span><span class="main"><span class="free">;</span></span><span class="free">d</span><span class="main">)</span> <span class="main">//</span> <span class="free">i</span> <span class="main">⊑</span> <span class="main">(</span><span class="free">c</span> <span class="main">//</span> <span class="free">i</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span><span class="main"><span class="free">;</span></span><span class="main">(</span><span class="free">d</span> <span class="main">//</span> <span class="free">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">⊓</span> <span class="free">c</span> <span class="main"><span class="free">;</span></span> <span class="main">(</span><span class="main">(</span><span class="free">c</span> <span class="main">//</span> <span class="free">i</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span><span class="main"><span class="free">;</span></span><span class="main">(</span><span class="free">d</span> <span class="main">//</span> <span class="free">i</span><span class="main">)</span> <span class="main"><span class="free">∥</span></span> <span class="free">i</span><span class="main">)</span> <span class="main">⊑</span> <span class="main">(</span><span class="main">(</span><span class="free">d</span> <span class="main">//</span> <span class="free">i</span><span class="main">)</span> <span class="main"><span class="free">∥</span></span> <span class="free">i</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="main">(</span><span class="free">c</span> <span class="main">//</span> <span class="free">i</span><span class="main">)</span> <span class="main"><span class="free">∥</span></span> <span class="free">i</span><span class="main">)</span><span class="main"><span class="free">;</span></span><span class="main">(</span><span class="main">(</span><span class="free">c</span> <span class="main">//</span> <span class="free">i</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span><span class="main"><span class="free">;</span></span><span class="main">(</span><span class="free">d</span> <span class="main">//</span> <span class="free">i</span><span class="main">)</span> <span class="main"><span class="free">∥</span></span> <span class="free">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_mono order.refl rely_quotient nonabort_i seq_mono<span class="main">)</span> 
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⊑</span> <span class="main">(</span><span class="main">(</span><span class="free">d</span> <span class="main">//</span> <span class="free">i</span><span class="main">)</span> <span class="main"><span class="free">∥</span></span> <span class="free">i</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="main">(</span><span class="free">c</span> <span class="main">//</span> <span class="free">i</span><span class="main">)</span><span class="main"><span class="free">;</span></span><span class="main">(</span><span class="free">c</span> <span class="main">//</span> <span class="free">i</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span><span class="main"><span class="free">;</span></span><span class="main">(</span><span class="free">d</span> <span class="main">//</span> <span class="free">i</span><span class="main">)</span> <span class="main"><span class="free">∥</span></span> <span class="free">i</span> <span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms inf_mono_right seq_assoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⊑</span> <span class="main">(</span><span class="main">(</span><span class="free">d</span> <span class="main">//</span> <span class="free">i</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">c</span> <span class="main">//</span> <span class="free">i</span><span class="main">)</span><span class="main"><span class="free">;</span></span><span class="main">(</span><span class="free">c</span> <span class="main">//</span> <span class="free">i</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span><span class="main"><span class="free">;</span></span><span class="main">(</span><span class="free">d</span> <span class="main">//</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">∥</span></span> <span class="free">i</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_par_distrib<span class="main">)</span> 
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">c</span> <span class="main">//</span> <span class="free">i</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span><span class="main"><span class="free">;</span></span><span class="main">(</span><span class="free">d</span> <span class="main">//</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">∥</span></span> <span class="free">i</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> iter_unfold inf_seq_distrib seq_nil_left<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> rely_refinement nonabort_i iter_induct<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>