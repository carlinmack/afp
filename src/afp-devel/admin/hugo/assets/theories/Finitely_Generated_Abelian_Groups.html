<div id="Set_Multiplication">
<div class="head">
<h1>Theory Set_Multiplication</h1>
</div>
<pre class="source"><span class="comment1">(*
    File:     Set_Multiplication.thy
    Author:   Joseph Thommes, TU München
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Set Multiplication›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Set_Multiplication
  <span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL-Algebra/Algebra.html">HOL-Algebra.Algebra</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This theory/section is of auxiliary nature and is mainly used to establish a connection
between the set multiplication and the multiplication of subgroups via the <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>IDirProd›</span></span></span></span> (although this
particular notion is introduced later). However, as in every section of this entry, there are some
lemmas that do not have any further usage in this entry, but are of interest just by themselves.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> group<span class="main">)</span> set_mult_union<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">&lt;#&gt;</span> <span class="main">(</span><span class="free">B</span> <span class="main">∪</span> <span class="free">C</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">A</span> <span class="main">&lt;#&gt;</span> <span class="free">B</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="free">A</span> <span class="main">&lt;#&gt;</span> <span class="free">C</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> set_mult_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> group<span class="main">)</span> set_mult_card_single_el_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">J</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>l_coset <span class="free">G</span> <span class="free">x</span> <span class="free">J</span><span class="main">)</span> <span class="main">=</span> card <span class="free">J</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> l_coset_def
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="main">(⊗</span><span class="main">)</span> <span class="free">x</span> <span class="main">`</span> <span class="free">J</span><span class="main">)</span> <span class="main">=</span> card <span class="free">J</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> inj_on_cmult<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> card_image<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(⊗</span><span class="main">)</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="free">J</span></span><span class="main">]</span> assms inj_on_subset<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(⊗</span><span class="main">)</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="free">J</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="bound">y</span><span class="main">∈</span><span class="free">J</span><span class="main">.</span> <span class="main">{</span><span class="free">x</span> <span class="main">⊗</span> <span class="bound">y</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">(⊗</span><span class="main">)</span> <span class="free">x</span> <span class="main">`</span> <span class="free">J</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> image_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(⊗</span><span class="main">)</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="free">J</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="main">⋃</span><span class="bound">h</span><span class="main">∈</span><span class="free">J</span><span class="main">.</span> <span class="main">{</span><span class="free">x</span> <span class="main">⊗</span> <span class="bound">h</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> card <span class="free">J</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We find an upper bound for the cardinality of a set product.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> group<span class="main">)</span> set_mult_card_le<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">J</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="free">H</span> <span class="main">&lt;#&gt;</span> <span class="free">J</span><span class="main">)</span> <span class="main">≤</span> card <span class="free">H</span> <span class="main">*</span> card <span class="free">J</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"card <span class="free">H</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">H</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> set_mult_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="skolem">H</span></span> <span class="quoted"><span class="free">J</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> a_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="skolem">H</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> c_n<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="skolem">H</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="main">(</span><span class="skolem">H</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span><span class="main">)</span> <span class="main">&lt;#&gt;</span> <span class="free">J</span><span class="main">)</span> <span class="main">≤</span> card <span class="main">(</span><span class="skolem">H</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span><span class="main">)</span> <span class="main">*</span> card <span class="free">J</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="main">{</span><span class="skolem">a</span><span class="main">}</span> <span class="main">&lt;#&gt;</span> <span class="free">J</span><span class="main">)</span> <span class="main">=</span> card <span class="free">J</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Suc<span class="main">(</span>4<span class="main">,</span> 5<span class="main">)</span> a_def set_mult_card_single_el_eq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">J</span></span> <span class="quoted"><span class="skolem">a</span></span><span class="main">]</span> l_coset_eq_set_mult<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="free">J</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">&lt;#&gt;</span> <span class="free">J</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">H</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span> <span class="main">&lt;#&gt;</span> <span class="free">J</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="main">{</span><span class="skolem">a</span><span class="main">}</span> <span class="main">&lt;#&gt;</span> <span class="free">J</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> set_mult_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">G</span></span> <span class="main">_</span> <span class="quoted"><span class="free">J</span></span><span class="main">]</span> a_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="skolem">H</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span><span class="main">)</span> <span class="main">*</span> card <span class="free">J</span> <span class="main">+</span> card <span class="free">J</span> <span class="main">=</span> Suc <span class="skolem">n</span> <span class="main">*</span> card <span class="free">J</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c_n mult_Suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> card_Un_le<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span> <span class="main">&lt;#&gt;</span> <span class="free">J</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">a</span><span class="main">}</span> <span class="main">&lt;#&gt;</span> <span class="free">J</span>"</span></span><span class="main">]</span> c_n <span class="quoted"><span class="quoted">‹Suc <span class="skolem">n</span> <span class="main">=</span> card <span class="skolem">H</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> group<span class="main">)</span> set_mult_finite<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">J</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">J</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="free">H</span> <span class="main">&lt;#&gt;</span> <span class="free">J</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms set_mult_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="free">H</span></span> <span class="quoted"><span class="free">J</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The next lemma allows us to later to derive that two finite subgroups $J$ and $H$ are complementary
if and only if their product has the cardinality $|J| \cdot |H|$.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> group<span class="main">)</span> set_mult_card_eq_impl_empty_inter<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">J</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">J</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="free">H</span> <span class="main">&lt;#&gt;</span> <span class="free">J</span><span class="main">)</span> <span class="main">=</span> card <span class="free">H</span> <span class="main">*</span> card <span class="free">J</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">a</span> <span class="main">∈</span> <span class="free">H</span><span class="main">;</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free">H</span><span class="main">;</span> <span class="bound">a</span> <span class="main">≠</span> <span class="bound">b</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(⊗</span><span class="main">)</span> <span class="bound">a</span> <span class="main">`</span> <span class="free">J</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span><span class="main">(⊗</span><span class="main">)</span> <span class="bound">b</span> <span class="main">`</span> <span class="free">J</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">H</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> finite_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> empty
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> step<span class="main">:</span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">H</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> step <span class="keyword1"><span class="command">have</span></span> x_c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> step <span class="keyword1"><span class="command">have</span></span> H_c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> set_mult_card_single_el_eq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">J</span></span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> card_x<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="main">{</span><span class="skolem">x</span><span class="main">}</span> <span class="main">&lt;#&gt;</span> <span class="free">J</span><span class="main">)</span> <span class="main">=</span> card <span class="free">J</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">J</span> <span class="main">⊆</span> carrier <span class="free">G</span>›</span></span> x_c l_coset_eq_set_mult <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> ins<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">H</span><span class="main">)</span> <span class="main">&lt;#&gt;</span> <span class="free">J</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">H</span> <span class="main">&lt;#&gt;</span> <span class="free">J</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="main">{</span><span class="skolem">x</span><span class="main">}</span> <span class="main">&lt;#&gt;</span> <span class="free">J</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> set_mult_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">G</span></span> <span class="main">_</span> <span class="quoted"><span class="free">J</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="skolem">H</span> <span class="main">&lt;#&gt;</span> <span class="free">J</span><span class="main">)</span> <span class="main">≥</span> card <span class="skolem">H</span> <span class="main">*</span> card <span class="free">J</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> card_Un_le<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">&lt;#&gt;</span> <span class="free">J</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">x</span><span class="main">}</span> <span class="main">&lt;#&gt;</span> <span class="free">J</span>"</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹card <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">H</span> <span class="main">&lt;#&gt;</span> <span class="free">J</span><span class="main">)</span> <span class="main">=</span> card <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">H</span><span class="main">)</span> <span class="main">*</span> card <span class="free">J</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> step.hyps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> step.hyps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> card_eq<span class="main">:</span><span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="skolem">H</span> <span class="main">&lt;#&gt;</span> <span class="free">J</span><span class="main">)</span> <span class="main">=</span> card <span class="skolem">H</span> <span class="main">*</span> card <span class="free">J</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> set_mult_card_le<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">H</span></span> <span class="quoted"><span class="free">J</span></span><span class="main">]</span> step H_c <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ih<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">a</span> <span class="main">∈</span> <span class="skolem">H</span><span class="main">;</span> <span class="bound">b</span> <span class="main">∈</span> <span class="skolem">H</span><span class="main">;</span> <span class="bound">a</span> <span class="main">≠</span> <span class="bound">b</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(⊗</span><span class="main">)</span> <span class="bound">a</span> <span class="main">`</span> <span class="free">J</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span><span class="main">(⊗</span><span class="main">)</span> <span class="bound">b</span> <span class="main">`</span> <span class="free">J</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> step H_c <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">H</span><span class="main">)</span> <span class="main">*</span> card <span class="free">J</span> <span class="main">=</span> card <span class="skolem">H</span> <span class="main">*</span> card <span class="free">J</span> <span class="main">+</span> card <span class="free">J</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∉</span> <span class="skolem">H</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> step <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">{</span><span class="skolem">x</span><span class="main">}</span> <span class="main">&lt;#&gt;</span> <span class="free">J</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span><span class="skolem">H</span> <span class="main">&lt;#&gt;</span> <span class="free">J</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> card_eq card_x ins card_Un_Int<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">&lt;#&gt;</span> <span class="free">J</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">x</span><span class="main">}</span> <span class="main">&lt;#&gt;</span> <span class="free">J</span>"</span></span><span class="main">]</span> step set_mult_finite <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="skolem">H</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">y</span><span class="main">∈</span><span class="free">J</span><span class="main">.</span> <span class="main">{</span><span class="bound">a</span> <span class="main">⊗</span> <span class="bound">y</span><span class="main">}</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">y</span><span class="main">∈</span><span class="free">J</span><span class="main">.</span> <span class="main">{</span><span class="skolem">x</span> <span class="main">⊗</span> <span class="bound">y</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> set_mult_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">G</span></span> <span class="main">_</span> <span class="quoted"><span class="free">J</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">a</span> <span class="main">∈</span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">H</span><span class="main">)</span><span class="main">;</span> <span class="bound">b</span> <span class="main">∈</span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">H</span><span class="main">)</span><span class="main">;</span> <span class="bound">a</span> <span class="main">≠</span> <span class="bound">b</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(⊗</span><span class="main">)</span> <span class="bound">a</span> <span class="main">`</span> <span class="free">J</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span><span class="main">(⊗</span><span class="main">)</span> <span class="bound">b</span> <span class="main">`</span> <span class="free">J</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∉</span> <span class="skolem">H</span>›</span></span> ih <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> step <span class="keyword1"><span class="command">by</span></span> <span class="operator">algebra</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> group<span class="main">)</span> set_mult_card_eq_impl_empty_inter'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">J</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">J</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="free">H</span> <span class="main">&lt;#&gt;</span> <span class="free">J</span><span class="main">)</span> <span class="main">=</span> card <span class="free">H</span> <span class="main">*</span> card <span class="free">J</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">a</span> <span class="main">∈</span> <span class="free">H</span><span class="main">;</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free">H</span><span class="main">;</span> <span class="bound">a</span> <span class="main">≠</span> <span class="bound">b</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span>l_coset <span class="free">G</span> <span class="bound">a</span> <span class="free">J</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span>l_coset <span class="free">G</span> <span class="bound">b</span> <span class="free">J</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> l_coset_def
  <span class="keyword1"><span class="command">using</span></span> set_mult_card_eq_impl_empty_inter image_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(⊗</span><span class="main">)</span> <span class="main">_</span>"</span></span> <span class="quoted"><span class="free">J</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> comm_group<span class="main">)</span> set_mult_comm<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">J</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">H</span> <span class="main">&lt;#&gt;</span> <span class="free">J</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">J</span> <span class="main">&lt;#&gt;</span> <span class="free">H</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> set_mult_def
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">a</span> <span class="main">∈</span> carrier <span class="free">G</span><span class="main">;</span> <span class="bound">b</span> <span class="main">∈</span> carrier <span class="free">G</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">{</span><span class="bound">a</span> <span class="main">⊗</span> <span class="bound">b</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">b</span> <span class="main">⊗</span> <span class="bound">a</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> m_comm <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span><span class="main">⟦</span><span class="bound">a</span> <span class="main">∈</span> <span class="free">H</span><span class="main">;</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free">J</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">{</span><span class="bound">a</span> <span class="main">⊗</span> <span class="bound">b</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">b</span> <span class="main">⊗</span> <span class="bound">a</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span><span class="main">⟦</span><span class="bound">b</span> <span class="main">∈</span> <span class="free">H</span><span class="main">;</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">J</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">{</span><span class="bound">a</span> <span class="main">⊗</span> <span class="bound">b</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">b</span> <span class="main">⊗</span> <span class="bound">a</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="bound">h</span><span class="main">∈</span><span class="free">H</span><span class="main">.</span> <span class="main">⋃</span><span class="bound">k</span><span class="main">∈</span><span class="free">J</span><span class="main">.</span> <span class="main">{</span><span class="bound">h</span> <span class="main">⊗</span> <span class="bound">k</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">k</span><span class="main">∈</span><span class="free">J</span><span class="main">.</span> <span class="main">⋃</span><span class="bound">h</span><span class="main">∈</span><span class="free">H</span><span class="main">.</span> <span class="main">{</span><span class="bound">k</span> <span class="main">⊗</span> <span class="bound">h</span><span class="main">}</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> group<span class="main">)</span> set_mult_one_imp_inc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">𝟭</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">⊆</span> <span class="main">(</span><span class="free">B</span> <span class="main">&lt;#&gt;</span> <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">B</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span><span class="free">B</span> <span class="main">&lt;#&gt;</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> set_mult_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹In all cases, we know that the product of two sets is always contained in the subgroup
generated by them.›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> group<span class="main">)</span> set_mult_subset_generate<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">&lt;#&gt;</span> <span class="free">B</span> <span class="main">⊆</span> generate <span class="free">G</span> <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="free">B</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">&lt;#&gt;</span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">⊗</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> set_mult_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> generate <span class="free">G</span> <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="free">B</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> generate <span class="free">G</span> <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="free">B</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> generate.incl<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∪</span> <span class="free">B</span>"</span></span> <span class="quoted"><span class="free">G</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> generate <span class="free">G</span> <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="free">B</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ab generate.eng <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹In the case of subgroups, the set product is just the subgroup generated by both
of the subgroups.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> comm_group<span class="main">)</span> set_mult_eq_generate_subgroup<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="free">H</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="free">J</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"generate <span class="free">G</span> <span class="main">(</span><span class="free">H</span> <span class="main">∪</span> <span class="free">J</span><span class="main">)</span> <span class="main">=</span> <span class="free">H</span> <span class="main">&lt;#&gt;</span> <span class="free">J</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">=</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">⊆</span> <span class="var">?R</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="var">?L</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="var">?R</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> generate.induct<span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> one
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">𝟭</span> <span class="main">⊗</span> <span class="main">𝟭</span> <span class="main">=</span> <span class="main">𝟭</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> nat_pow_one<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">2</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> assms subgroup.one_closed<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span>
              subgroup.one_closed<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> set_mult_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="free">H</span></span> <span class="quoted"><span class="free">J</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>incl <span class="skolem">x</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> H1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">𝟭</span> <span class="main">∈</span> <span class="free">H</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms subgroup.one_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> J1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">𝟭</span> <span class="main">∈</span> <span class="free">J</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms subgroup.one_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> lx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊗</span> <span class="main">𝟭</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> r_one<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> incl subgroup.subset assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> rx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">𝟭</span> <span class="main">⊗</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> l_one<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> incl subgroup.subset assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">H</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> set_mult_def J1 lx <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> set_mult_def H1 rx incl <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>inv <span class="skolem">h</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> inv_in<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">inv</span> <span class="skolem">h</span><span class="main">)</span> <span class="main">∈</span> <span class="free">H</span> <span class="main">∪</span> <span class="free">J</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?iv</span> <span class="main">∈</span> <span class="free">H</span> <span class="main">∪</span> <span class="free">J</span>"</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> assms subgroup.m_inv_closed<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="skolem">h</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> <span class="free">H</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">blast</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> H1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">𝟭</span> <span class="main">∈</span> <span class="free">H</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms subgroup.one_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> J1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">𝟭</span> <span class="main">∈</span> <span class="free">J</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms subgroup.one_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> lx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?iv</span> <span class="main">⊗</span> <span class="main">𝟭</span> <span class="main">=</span> <span class="var">?iv</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> r_one<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="var">?iv</span>"</span></span><span class="main">]</span> subgroup.subset inv_in assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> rx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">𝟭</span> <span class="main">⊗</span> <span class="var">?iv</span> <span class="main">=</span> <span class="var">?iv</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> l_one<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="var">?iv</span>"</span></span><span class="main">]</span> incl subgroup.subset inv_in assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="var">?iv</span> <span class="main">∈</span> <span class="free">H</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> set_mult_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="free">H</span></span> <span class="quoted"><span class="free">J</span></span><span class="main">]</span> J1 lx <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> set_mult_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="free">H</span></span> <span class="quoted"><span class="free">J</span></span><span class="main">]</span> H1 rx inv_in <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>eng <span class="skolem">h</span> <span class="skolem">g</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> eng<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> aH<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">H</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> bJ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="free">J</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">⊗</span> <span class="skolem">b</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> set_mult_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="free">H</span></span> <span class="quoted"><span class="free">J</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
      <span class="keyword1"><span class="command">have</span></span> a_carr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> subgroup.mem_carrier assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> aH<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> b_carr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> subgroup.mem_carrier assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> bJ<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> eng<span class="main">(</span>4<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> cH<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> <span class="free">H</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> dJ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">∈</span> <span class="free">J</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> g_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> <span class="skolem">c</span> <span class="main">⊗</span> <span class="skolem">d</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> set_mult_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="free">H</span></span> <span class="quoted"><span class="free">J</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
      <span class="keyword1"><span class="command">have</span></span> c_carr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> subgroup.mem_carrier assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> cH<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> d_carr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> subgroup.mem_carrier assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> dJ<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">⊗</span> <span class="skolem">g</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">⊗</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">⊗</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">⊗</span> <span class="skolem">d</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> a_carr b_carr c_carr d_carr g_def h_def m_assoc m_comm <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">⊗</span> <span class="skolem">c</span> <span class="main">∈</span> <span class="free">H</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> aH cH subgroup.m_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">⊗</span> <span class="skolem">d</span> <span class="main">∈</span> <span class="free">J</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> bJ dJ subgroup.m_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> set_mult_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?R</span> <span class="main">⊆</span> <span class="var">?L</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> set_mult_subset_generate<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">H</span></span> <span class="quoted"><span class="free">J</span></span><span class="main">]</span> subgroup.subset assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Miscellaneous_Groups">
<div class="head">
<h1>Theory Miscellaneous_Groups</h1>
</div>
<pre class="source"><span class="comment1">(*
    File:     Miscellaneous_Groups.thy
    Author:   Joseph Thommes, TU München
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Miscellaneous group facts›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Miscellaneous_Groups
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="#Set_Multiplication">Set_Multiplication</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹As the name suggests, this section contains several smaller lemmas about groups.›</span></span>

<span class="comment1">(* Manuel Eberl *)</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> subgroup<span class="main">)</span> nat_pow_closed <span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">H</span> <span class="main">⟹</span> pow <span class="free">G</span> <span class="free">a</span> <span class="main">(</span><span class="free">n</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">∈</span> <span class="free">H</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nat_pow_def<span class="main">)</span>

<span class="comment1">(* Manuel Eberl *)</span>
<span class="keyword1" id="Miscellaneous_Groups-nat_pow_modify_carrier"><span class="command">lemma</span></span> nat_pow_modify_carrier<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">[^]</span><span class="hidden">⇘</span><sub><span class="free">G</span><span class="main">⦇</span>carrier <span class="main">:=</span> <span class="free">H</span><span class="main">⦈</span></sub><span class="hidden">⇙</span> <span class="free">b</span> <span class="main">=</span> <span class="free">a</span> <span class="main">[^]</span><span class="hidden">⇘</span><sub><span class="free">G</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="free">b</span><span class="main">::</span>nat<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nat_pow_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> group<span class="main">)</span> subgroup_card_dvd_group_ord<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="free">H</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="free">H</span> <span class="keyword1">dvd</span> order <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Coset.group.lagrange<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="free">H</span></span><span class="main">]</span> assms group_axioms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dvd_triv_right<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> group<span class="main">)</span> subgroup_card_eq_order<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="free">H</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="free">H</span> <span class="main">=</span> order <span class="main">(</span><span class="free">G</span><span class="main">⦇</span>carrier <span class="main">:=</span> <span class="free">H</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> order_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> group<span class="main">)</span> finite_subgroup_card_neq_0<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="free">H</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="free">H</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> subgroup_nonempty assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> group<span class="main">)</span> subgroup_order_dvd_group_order<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="free">H</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"order <span class="main">(</span><span class="free">G</span><span class="main">⦇</span>carrier <span class="main">:=</span> <span class="free">H</span><span class="main">⦈</span><span class="main">)</span> <span class="keyword1">dvd</span> order <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> subgroup_card_dvd_group_ord<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">H</span></span></span></span></span></span><span class="main"><span class="main">]</span></span> assms subgroup_card_eq_order<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> group<span class="main">)</span> sub_subgroup_dvd_card<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="free">H</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="free">J</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">J</span> <span class="main">⊆</span> <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="free">J</span> <span class="keyword1">dvd</span> card <span class="free">H</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> subgroup_incl<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">J</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">H</span></span></span></span></span></span><span class="main"><span class="main">]</span></span> subgroup_card_eq_order<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">H</span></span></span></span></span></span><span class="main"><span class="main">]</span></span>
            group.subgroup_card_dvd_group_ord<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">(</span></span></span><span class="free"><span class="free"><span class="free">G</span></span></span><span class="main"><span class="main"><span class="main">⦇</span></span></span>carrier <span class="main"><span class="main"><span class="main">:=</span></span></span> <span class="free"><span class="free"><span class="free">H</span></span></span><span class="main"><span class="main"><span class="main">⦈</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span>"</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">J</span></span></span></span></span></span><span class="main"><span class="main">]</span></span> assms
            subgroup.subgroup_is_group<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">H</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">G</span></span></span></span></span></span><span class="main"><span class="main">]</span></span> group_axioms<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> group<span class="main">)</span> inter_subgroup_dvd_card<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="free">H</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="free">J</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="free">H</span> <span class="main">∩</span> <span class="free">J</span><span class="main">)</span> <span class="keyword1">dvd</span> card <span class="free">H</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> subgroups_Inter_pair<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">H</span></span> <span class="quoted"><span class="free">J</span></span><span class="main">]</span> assms sub_subgroup_dvd_card<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">H</span></span> <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">∩</span> <span class="free">J</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> group<span class="main">)</span> subgroups_card_coprime_inter_card_one<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="free">H</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="free">J</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"coprime <span class="main">(</span>card <span class="free">H</span><span class="main">)</span> <span class="main">(</span>card <span class="free">J</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="free">H</span> <span class="main">∩</span> <span class="free">J</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms inter_subgroup_dvd_card <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_unit <span class="main">(</span>card <span class="main">(</span><span class="free">H</span> <span class="main">∩</span> <span class="free">J</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> coprime_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Int_lower2 sub_subgroup_dvd_card subgroup_Int<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> group<span class="main">)</span> coset_neq_imp_empty_inter<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="free">H</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">#&gt;</span> <span class="free">a</span> <span class="main">≠</span> <span class="free">H</span> <span class="main">#&gt;</span> <span class="free">b</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">H</span> <span class="main">#&gt;</span> <span class="free">a</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span><span class="free">H</span> <span class="main">#&gt;</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Int_emptyI assms repr_independence<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> comm_group<span class="main">)</span> subgroup_is_comm_group<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="free">H</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"comm_group <span class="main">(</span><span class="free">G</span><span class="main">⦇</span>carrier <span class="main">:=</span> <span class="free">H</span><span class="main">⦈</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> comm_group_def
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">interpret</span></span> H<span class="main">:</span> subgroup <span class="quoted"><span class="free">H</span></span> <span class="quoted"><span class="free">G</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">interpret</span></span> H<span class="main">:</span> submonoid <span class="quoted"><span class="free">H</span></span> <span class="quoted"><span class="free">G</span></span> <span class="keyword1"><span class="command">using</span></span> H.subgroup_is_submonoid <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Group.group <span class="main">(</span><span class="free">G</span><span class="main">⦇</span>carrier <span class="main">:=</span> <span class="free">H</span><span class="main">⦈</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"comm_monoid <span class="main">(</span><span class="free">G</span><span class="main">⦇</span>carrier <span class="main">:=</span> <span class="free">H</span><span class="main">⦈</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> submonoid_is_comm_monoid H.submonoid_axioms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> group<span class="main">)</span> pow_int_mod_ord<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"ord <span class="free">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">[^]</span> <span class="main">(</span><span class="free">n</span><span class="main">::</span>int<span class="main">)</span> <span class="main">=</span> <span class="free">a</span> <span class="main">[^]</span> <span class="main">(</span><span class="free">n</span> <span class="keyword1">mod</span> ord <span class="free">a</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> <span class="free">n</span> <span class="keyword1">div</span> ord <span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">=</span> <span class="free">n</span> <span class="keyword1">mod</span> ord <span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="skolem">q</span> <span class="main">*</span> ord <span class="free">a</span> <span class="main">+</span> <span class="skolem">r</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mod_div_decomp <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">[^]</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span> <span class="main">[^]</span> int <span class="main">(</span>ord <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">[^]</span> <span class="skolem">q</span> <span class="main">⊗</span> <span class="free">a</span> <span class="main">[^]</span> <span class="skolem">r</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> int_pow_mult int_pow_pow
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_of_nat_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">𝟭</span> <span class="main">[^]</span> <span class="skolem">q</span> <span class="main">⊗</span> <span class="free">a</span> <span class="main">[^]</span> <span class="skolem">r</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> int_pow_int<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">a</span> <span class="main">[^]</span> <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> d<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> group<span class="main">)</span> pow_nat_mod_ord<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"ord <span class="free">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">[^]</span> <span class="main">(</span><span class="free">n</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">=</span> <span class="free">a</span> <span class="main">[^]</span> <span class="main">(</span><span class="free">n</span> <span class="keyword1">mod</span> ord <span class="free">a</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> <span class="free">n</span> <span class="keyword1">div</span> ord <span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">=</span> <span class="free">n</span> <span class="keyword1">mod</span> ord <span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="skolem">q</span> <span class="main">*</span> ord <span class="free">a</span> <span class="main">+</span> <span class="skolem">r</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mod_div_decomp <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">[^]</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span> <span class="main">[^]</span> ord <span class="free">a</span><span class="main">)</span> <span class="main">[^]</span> <span class="skolem">q</span> <span class="main">⊗</span> <span class="free">a</span> <span class="main">[^]</span> <span class="skolem">r</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> nat_pow_mult nat_pow_pow <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">𝟭</span> <span class="main">[^]</span> <span class="skolem">q</span> <span class="main">⊗</span> <span class="free">a</span> <span class="main">[^]</span> <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">a</span> <span class="main">[^]</span> <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> d<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> group<span class="main">)</span> ord_min<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">[^]</span> <span class="free">m</span> <span class="main">=</span> <span class="main">𝟭</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"ord <span class="free">x</span> <span class="main">≤</span> <span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms pow_eq_id <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="comment1">(* Manuel Eberl *)</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> group<span class="main">)</span> bij_betw_mult_left<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">x</span> <span class="main">⊗</span> <span class="bound">y</span><span class="main">)</span> <span class="main">(</span>carrier <span class="free">G</span><span class="main">)</span> <span class="main">(</span>carrier <span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> bij_betwI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="var">?g</span> <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="bound"><span class="bound"><span class="bound">y</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="keyword1"><span class="keyword1"><span class="keyword1">inv</span></span></span> <span class="free"><span class="free"><span class="free">x</span></span></span> <span class="main"><span class="main"><span class="main">⊗</span></span></span> <span class="bound"><span class="bound"><span class="bound">y</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
     <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> m_assoc <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="comment1">(* Manuel Eberl *)</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> subgroup<span class="main">)</span> inv_in_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"group <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="keyword1">inv</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">H</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">H</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">inv</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">H</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">inv</span> <span class="main">(</span><span class="keyword1">inv</span> <span class="free">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">H</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">inv</span> <span class="main">(</span><span class="keyword1">inv</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> group.inv_inv<span class="main">)</span> <span class="main">(</span><span class="operator">use</span> assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">H</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="comment1">(* Manuel Eberl *)</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> subgroup<span class="main">)</span> mult_in_cancel_left<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"group <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊗</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">H</span> <span class="main">⟷</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">H</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊗</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">H</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">inv</span> <span class="free">x</span> <span class="main">⊗</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊗</span> <span class="free">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">H</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">inv</span> <span class="free">x</span> <span class="main">⊗</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊗</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">⊗</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">H</span>›</span></span> group.inv_solve_left'<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">H</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="comment1">(* Manuel Eberl *)</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> subgroup<span class="main">)</span> mult_in_cancel_right<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"group <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊗</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">H</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">H</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊗</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">H</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊗</span> <span class="free">y</span><span class="main">)</span> <span class="main">⊗</span> <span class="keyword1">inv</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">H</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊗</span> <span class="free">y</span><span class="main">)</span> <span class="main">⊗</span> <span class="keyword1">inv</span> <span class="free">y</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">⊗</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">H</span>›</span></span> group.inv_solve_right'<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">H</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> group<span class="main">)</span> <span class="comment1">(* Manuel Eberl *)</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">[^]</span> <span class="free">n</span> <span class="main">=</span> <span class="main">𝟭</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   ord_le<span class="main">:</span> <span class="quoted"><span class="quoted">"ord <span class="free">x</span> <span class="main">≤</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ord_pos<span class="main">:</span> <span class="quoted"><span class="quoted">"ord <span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ord <span class="free">x</span> <span class="keyword1">dvd</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> pow_eq_id<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">n</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"ord <span class="free">x</span> <span class="main">≤</span> <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"ord <span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> dvd_imp_le<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> group<span class="main">)</span> ord_conv_Least<span class="main">:</span> <span class="comment1">(* Manuel Eberl *)</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">n</span></span><span class="main">::</span>nat <span class="main">&gt;</span> <span class="main">0</span><span class="main">.</span> <span class="free">x</span> <span class="main">[^]</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">𝟭</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"ord <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">n</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">[^]</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">𝟭</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ord <span class="free">x</span> <span class="main">≤</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">n</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">[^]</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">𝟭</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms LeastI_ex<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> ord_le<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ord <span class="free">x</span> <span class="main">≥</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">n</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">[^]</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">𝟭</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Least_le<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> pow_ord_eq_1 ord_pos<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> group<span class="main">)</span> ord_conv_Gcd<span class="main">:</span> <span class="comment1">(* Manuel Eberl *)</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"ord <span class="free">x</span> <span class="main">=</span> Gcd <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="free">x</span> <span class="main">[^]</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">𝟭</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sym<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> Gcd_eqI<span class="main">)</span> <span class="main">(</span><span class="operator">use</span> assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main">:</span> pow_eq_id›</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> group<span class="main">)</span> subgroup_ord_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="free">H</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"group.ord <span class="main">(</span><span class="free">G</span><span class="main">⦇</span>carrier <span class="main">:=</span> <span class="free">H</span><span class="main">⦈</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> ord <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> nat_pow_consistent ord_def group.ord_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span><span class="main">⦇</span>carrier <span class="main">:=</span> <span class="free">H</span><span class="main">⦈</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span>
        subgroup.subgroup_is_group<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">H</span></span> <span class="quoted"><span class="free">G</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> group<span class="main">)</span> ord_FactGroup<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="free">P</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"group <span class="main">(</span><span class="free">G</span> <span class="keyword1">Mod</span> <span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"order <span class="main">(</span><span class="free">G</span> <span class="keyword1">Mod</span> <span class="free">P</span><span class="main">)</span> <span class="main">*</span> card <span class="free">P</span> <span class="main">=</span> order <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> lagrange<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">P</span></span><span class="main">]</span> FactGroup_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="free">P</span></span><span class="main">]</span> assms order_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="keyword1">Mod</span> <span class="free">P</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> group<span class="main">)</span> one_is_same<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="free">H</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">𝟭</span><span class="hidden">⇘</span><sub><span class="free">G</span><span class="main">⦇</span>carrier <span class="main">:=</span> <span class="free">H</span><span class="main">⦈</span></sub><span class="hidden">⇙</span> <span class="main">=</span> <span class="main">𝟭</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> group<span class="main">)</span> kernel_FactGroup<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">⊲</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"kernel <span class="free">G</span> <span class="main">(</span><span class="free">G</span> <span class="keyword1">Mod</span> <span class="free">P</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="main">#&gt;</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> equalityI<span class="main"><span class="keyword3">;</span></span> <span class="operator">rule</span> subsetI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> kernel <span class="free">G</span> <span class="main">(</span><span class="free">G</span> <span class="keyword1">Mod</span> <span class="free">P</span><span class="main">)</span> <span class="main">(</span><span class="main">(#&gt;</span><span class="main">)</span> <span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">#&gt;</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">𝟭</span><span class="hidden">⇘</span><sub><span class="free">G</span> <span class="keyword1">Mod</span> <span class="free">P</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> kernel_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">with</span></span> coset_join1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">P</span></span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">P</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> normal_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> xc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms subgroup.subset <span class="keyword1"><span class="command">unfolding</span></span> normal_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">from</span></span> x <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">#&gt;</span> <span class="skolem">x</span> <span class="main">=</span> <span class="free">P</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> normal_imp_subgroup subgroup.rcos_const<span class="main">)</span> 
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> kernel <span class="free">G</span> <span class="main">(</span><span class="free">G</span> <span class="keyword1">Mod</span> <span class="free">P</span><span class="main">)</span> <span class="main">(</span><span class="main">(#&gt;</span><span class="main">)</span> <span class="free">P</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> kernel_def <span class="keyword1"><span class="command">using</span></span> xc <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> group<span class="main">)</span> sub_subgroup_coprime<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="free">H</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="free">J</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"coprime <span class="main">(</span>card <span class="free">H</span><span class="main">)</span> <span class="main">(</span>card <span class="free">J</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="free">sH</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="free">sJ</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">sH</span> <span class="main">⊆</span> <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">sJ</span> <span class="main">⊆</span> <span class="free">J</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"coprime <span class="main">(</span>card <span class="free">sH</span><span class="main">)</span> <span class="main">(</span>card <span class="free">sJ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> coprime_divisors sub_subgroup_dvd_card<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> group<span class="main">)</span> pow_eq_nat_mod<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">[^]</span> <span class="free">n</span> <span class="main">=</span> <span class="free">a</span> <span class="main">[^]</span> <span class="free">m</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="keyword1">mod</span> <span class="main">(</span>ord <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="free">m</span> <span class="keyword1">mod</span> <span class="main">(</span>ord <span class="free">a</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">[^]</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span> <span class="main">𝟭</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pow_eq_div2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ord <span class="free">a</span> <span class="keyword1">dvd</span> <span class="free">n</span> <span class="main">-</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> pow_eq_id <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms mod_eq_dvd_iff_nat nat_le_linear pow_eq_div2 pow_eq_id<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> group<span class="main">)</span> pow_eq_int_mod<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">n</span> <span class="free">m</span><span class="main">::</span><span class="quoted">int</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">[^]</span> <span class="free">n</span> <span class="main">=</span> <span class="free">a</span> <span class="main">[^]</span> <span class="free">m</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="keyword1">mod</span> <span class="main">(</span>ord <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="free">m</span> <span class="keyword1">mod</span> <span class="main">(</span>ord <span class="free">a</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">[^]</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span> <span class="main">𝟭</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> int_pow_closed int_pow_diff r_inv <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ord <span class="free">a</span> <span class="keyword1">dvd</span> <span class="free">n</span> <span class="main">-</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> int_pow_eq_id <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> mod_eq_dvd_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Generated_Groups_Extend">
<div class="head">
<h1>Theory Generated_Groups_Extend</h1>
</div>
<pre class="source"><span class="comment1">(*
    File:     Generated_Groups_Extend.thy
    Author:   Joseph Thommes, TU München
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Generated Groups›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Generated_Groups_Extend
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="#Miscellaneous_Groups">Miscellaneous_Groups</a> <span class="quoted">"<a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL-Algebra/Algebra.html">HOL-Algebra.Algebra</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This section extends the lemmas and facts about <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>generate›</span></span></span></span>. Starting with a basic fact.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> group<span class="main">)</span> generate_sincl<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> generate <span class="free">G</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> generate.incl <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The following lemmas reflect some of the idempotence characteristics of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>generate›</span></span></span></span> and have
proved useful at several occasions.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> group<span class="main">)</span> generate_idem<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"generate <span class="free">G</span> <span class="main">(</span>generate <span class="free">G</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> generate <span class="free">G</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms generateI group.generate_is_subgroup <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> group<span class="main">)</span> generate_idem'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"generate <span class="free">G</span> <span class="main">(</span>generate <span class="free">G</span> <span class="free">A</span> <span class="main">∪</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> generate <span class="free">G</span> <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="free">B</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"generate <span class="free">G</span> <span class="main">(</span>generate <span class="free">G</span> <span class="free">A</span> <span class="main">∪</span> <span class="free">B</span><span class="main">)</span> <span class="main">⊆</span> generate <span class="free">G</span> <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="free">B</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"generate <span class="free">G</span> <span class="free">A</span> <span class="main">∪</span> <span class="free">B</span> <span class="main">⊆</span> generate <span class="free">G</span> <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="free">B</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"generate <span class="free">G</span> <span class="free">A</span> <span class="main">⊆</span> generate <span class="free">G</span> <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="free">B</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mono_generate <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">⊆</span> generate <span class="free">G</span> <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="free">B</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> generate.incl subset_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"generate <span class="free">G</span> <span class="main">(</span>generate <span class="free">G</span> <span class="free">A</span> <span class="main">∪</span> <span class="free">B</span><span class="main">)</span> <span class="main">⊆</span> generate <span class="free">G</span> <span class="main">(</span>generate <span class="free">G</span> <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="free">B</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> mono_generate <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> generate_idem<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∪</span> <span class="free">B</span>"</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"generate <span class="free">G</span> <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="free">B</span><span class="main">)</span> <span class="main">⊆</span> generate <span class="free">G</span> <span class="main">(</span>generate <span class="free">G</span> <span class="free">A</span> <span class="main">∪</span> <span class="free">B</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> generate <span class="free">G</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> generate.incl <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> mono_generate<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∪</span> <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"generate <span class="free">G</span> <span class="free">A</span> <span class="main">∪</span> <span class="free">B</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> group<span class="main">)</span> generate_idem'_right<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"generate <span class="free">G</span> <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> generate <span class="free">G</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> generate <span class="free">G</span> <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="free">B</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> generate_idem'<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sup_commute<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> group<span class="main">)</span> generate_idem_Un<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"generate <span class="free">G</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> generate <span class="free">G</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> generate.incl <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"generate <span class="free">G</span> <span class="free">A</span> <span class="main">⊆</span> generate <span class="free">G</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mono_generate <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span> <span class="main">⊆</span> generate <span class="free">G</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mono_generate <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">)</span> <span class="main">⊆</span> generate <span class="free">G</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"generate <span class="free">G</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">)</span> <span class="main">⊆</span> generate <span class="free">G</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> generate_idem<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> mono_generate <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> group<span class="main">)</span> generate_idem_fUn<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">A</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"generate <span class="free">G</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">{</span>generate <span class="free">G</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span> <span class="main">|</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">f</span> <span class="free">A</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> generate <span class="free">G</span> <span class="main">(</span><span class="free">f</span> <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">A</span> <span class="main">⊆</span> <span class="main">⋃</span> <span class="main">{</span>generate <span class="free">G</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span> <span class="main">|</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">f</span> <span class="free">A</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">f</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> generate <span class="free">G</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> generate.incl <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">⋃</span> <span class="main">{</span>generate <span class="free">G</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span> <span class="main">|</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">f</span> <span class="free">A</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"generate <span class="free">G</span> <span class="main">(</span><span class="free">f</span> <span class="free">A</span><span class="main">)</span> <span class="main">⊆</span> generate <span class="free">G</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">{</span>generate <span class="free">G</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span> <span class="main">|</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">f</span> <span class="free">A</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mono_generate <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">f</span> <span class="free">A</span> <span class="main">⟹</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span> <span class="main">⊆</span> generate <span class="free">G</span> <span class="main">(</span><span class="free">f</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mono_generate <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span> <span class="main">{</span>generate <span class="free">G</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span> <span class="main">|</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">f</span> <span class="free">A</span><span class="main">}</span><span class="main">)</span> <span class="main">⊆</span> generate <span class="free">G</span> <span class="main">(</span><span class="free">f</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> mono_generate<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"generate <span class="free">G</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">{</span>generate <span class="free">G</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span> <span class="main">|</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">f</span> <span class="free">A</span><span class="main">}</span><span class="main">)</span> <span class="main">⊆</span> generate <span class="free">G</span> <span class="main">(</span><span class="free">f</span> <span class="free">A</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> generate_idem<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> group<span class="main">)</span> generate_idem_fim_Un<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span><span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"generate <span class="free">G</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">S</span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">(</span><span class="free">f</span> <span class="bound">S</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> generate <span class="free">G</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">{</span>generate <span class="free">G</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span> <span class="main">|</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">S</span><span class="main">.</span> <span class="bound">S</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> generate <span class="free">G</span> <span class="main">(</span><span class="free">f</span> <span class="bound">S</span><span class="main">)</span> <span class="main">=</span> generate <span class="free">G</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">{</span>generate <span class="free">G</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span> <span class="main">|</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">f</span> <span class="bound">S</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> generate_idem_fUn<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"generate <span class="free">G</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">S</span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">(</span><span class="free">f</span> <span class="bound">S</span><span class="main">)</span><span class="main">)</span>
           <span class="main">=</span> generate <span class="free">G</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">S</span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">{</span>generate <span class="free">G</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span> <span class="main">|</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">f</span> <span class="bound">S</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span> <span class="main">{</span>generate <span class="free">G</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span> <span class="main">|</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">S</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">(</span><span class="free">f</span> <span class="bound">S</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">⋃</span> <span class="main">{</span>generate <span class="free">G</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span> <span class="main">|</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> generate <span class="free">G</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">M</span></span> <span class="keyword2"><span class="keyword">where</span></span> M<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">f</span> <span class="skolem">M</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"generate <span class="free">G</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span> <span class="main">⊆</span> generate <span class="free">G</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">M</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> generate.incl<span class="main">[</span><span class="operator">OF</span> M<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">G</span></span><span class="main">]</span> mono_generate<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">a</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"generate <span class="free">G</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">M</span><span class="main">)</span>"</span></span><span class="main">]</span>
            generate_idem assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> generate <span class="free">G</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">M</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">S</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">(</span><span class="free">f</span> <span class="bound">S</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> M <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"generate <span class="free">G</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">{</span>generate <span class="free">G</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span> <span class="main">|</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">}</span><span class="main">)</span> <span class="main">⊆</span> generate <span class="free">G</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">S</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">(</span><span class="free">f</span> <span class="bound">S</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mono_generate <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"generate <span class="free">G</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">S</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">(</span><span class="free">f</span> <span class="bound">S</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> generate <span class="free">G</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">S</span><span class="main">.</span> <span class="bound">S</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> generate <span class="free">G</span> <span class="main">(</span><span class="free">f</span> <span class="bound">S</span><span class="main">)</span> <span class="main">⊆</span> generate <span class="free">G</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> mono_generate<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span> <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="bound">S</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">(</span><span class="free">f</span> <span class="bound">S</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> generate <span class="free">G</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"generate <span class="free">G</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">S</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">(</span><span class="free">f</span> <span class="bound">S</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> generate <span class="free">G</span> <span class="main">(</span>generate <span class="free">G</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> mono_generate <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"generate <span class="free">G</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">S</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">(</span><span class="free">f</span> <span class="bound">S</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span>  generate <span class="free">G</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> generate_idem assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span> <span class="main">{</span>generate <span class="free">G</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span> <span class="main">|</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span><span class="main">⋃</span> <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> generate_idem_Un<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"generate <span class="free">G</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">{</span>generate <span class="free">G</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span> <span class="main">|</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> generate <span class="free">G</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> a <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"generate <span class="free">G</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">S</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">(</span><span class="free">f</span> <span class="bound">S</span><span class="main">)</span><span class="main">)</span>
             <span class="main">⊆</span> generate <span class="free">G</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">{</span>generate <span class="free">G</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span> <span class="main">|</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The following two rules allow for convenient proving of the equality of two generated sets.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> group<span class="main">)</span> generate_eqI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> generate <span class="free">G</span> <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">⊆</span> generate <span class="free">G</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"generate <span class="free">G</span> <span class="free">A</span> <span class="main">=</span> generate <span class="free">G</span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms generate_idem <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> generate_idem' inf_sup_aci<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> sup.absorb2<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> group<span class="main">)</span> generate_one_switched_eqI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">=</span> <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> generate <span class="free">G</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> generate <span class="free">G</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"generate <span class="free">G</span> <span class="free">A</span> <span class="main">=</span> generate <span class="free">G</span> <span class="free">B</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> generate_eqI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms generate_incl <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> generate <span class="free">G</span> <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms generate_sincl<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">B</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">⊆</span> generate <span class="free">G</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms generate_sincl<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> group<span class="main">)</span> generate_subset_eqI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">-</span> <span class="free">B</span> <span class="main">⊆</span> generate <span class="free">G</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"generate <span class="free">G</span> <span class="free">A</span> <span class="main">=</span> generate <span class="free">G</span> <span class="free">B</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"generate <span class="free">G</span> <span class="free">B</span> <span class="main">⊆</span> generate <span class="free">G</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mono_generate<span class="main"><span class="keyword3">,</span></span> <span class="operator">fact</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"generate <span class="free">G</span> <span class="free">A</span> <span class="main">⊆</span> generate <span class="free">G</span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">subst</span> generate_idem<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">B</span></span>"</span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"generate <span class="free">G</span> <span class="free">A</span> <span class="main">⊆</span> generate <span class="free">G</span> <span class="main">(</span>generate <span class="free">G</span> <span class="free">B</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mono_generate<span class="main"><span class="keyword3">,</span></span> <span class="operator">use</span> assms generate_sincl<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">B</span></span></span></span></span></span><span class="main"><span class="main">]</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">blast</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Some smaller lemmas about <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>generate›</span></span></span></span>.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> group<span class="main">)</span> generate_subset_change_eqI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"generate <span class="free">G</span> <span class="free">A</span> <span class="main">=</span> generate <span class="free">G</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"generate <span class="free">G</span> <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="free">C</span><span class="main">)</span> <span class="main">=</span> generate <span class="free">G</span> <span class="main">(</span><span class="free">B</span> <span class="main">∪</span> <span class="free">C</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms generate_idem'<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> group<span class="main">)</span> generate_subgroup_id<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="free">H</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"generate <span class="free">G</span> <span class="free">H</span> <span class="main">=</span> <span class="free">H</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms generateI <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> group<span class="main">)</span> generate_consistent'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="free">H</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span> <span class="main">=</span> generate <span class="main">(</span><span class="free">G</span><span class="main">⦇</span>carrier <span class="main">:=</span> <span class="free">H</span><span class="main">⦈</span><span class="main">)</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> generate_consistent assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> group<span class="main">)</span> generate_singleton_one<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"generate <span class="free">G</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">𝟭</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="main">𝟭</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> generate.incl<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">a</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="free">G</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> group<span class="main">)</span> generate_inv_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"generate <span class="free">G</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">=</span> generate <span class="free">G</span> <span class="main">{</span><span class="keyword1">inv</span> <span class="free">a</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> generate_eqI<span class="main"><span class="keyword3">;</span></span>
      <span class="operator">use</span> assms generate.inv<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">a</span></span></span></span></span></span><span class="main"><span class="main">]</span></span> generate.inv<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1">inv</span></span></span> <span class="free"><span class="free"><span class="free">a</span></span></span>"</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">{</span></span></span><span class="keyword1"><span class="keyword1"><span class="keyword1">inv</span></span></span> <span class="free"><span class="free"><span class="free">a</span></span></span><span class="main"><span class="main"><span class="main">}</span></span></span>"</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">G</span></span></span></span></span></span><span class="main"><span class="main">]</span></span> inv_inv<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">]</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> group<span class="main">)</span> generate_eq_imp_subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"generate <span class="free">G</span> <span class="free">A</span> <span class="main">=</span> generate <span class="free">G</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> generate <span class="free">G</span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> generate.incl assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The neutral element does not play a role when generating a subgroup.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> group<span class="main">)</span> generate_one_irrel<span class="main">:</span>
  <span class="quoted"><span class="quoted">"generate <span class="free">G</span> <span class="free">A</span> <span class="main">=</span> generate <span class="free">G</span> <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="main">{</span><span class="main">𝟭</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"generate <span class="free">G</span> <span class="free">A</span> <span class="main">⊆</span> generate <span class="free">G</span> <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="main">{</span><span class="main">𝟭</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mono_generate<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"generate <span class="free">G</span> <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="main">{</span><span class="main">𝟭</span><span class="main">}</span><span class="main">)</span> <span class="main">⊆</span> generate <span class="free">G</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> subsetI<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> generate <span class="free">G</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> generate <span class="free">G</span> <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="main">{</span><span class="main">𝟭</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="keyword1"><span class="command">using</span></span> that
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> generate.induct<span class="main"><span class="keyword3">;</span></span>
          <span class="operator">use</span> generate.one generate.incl generate.inv generate.eng <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> group<span class="main">)</span> generate_one_irrel'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"generate <span class="free">G</span> <span class="free">A</span> <span class="main">=</span> generate <span class="free">G</span> <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="main">𝟭</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> generate_one_irrel <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Un_Diff_cancel2<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Also, we can express the subgroup generated by a singleton with finite order using just its
powers up to its order.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> group<span class="main">)</span> generate_nat_pow<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ord <span class="free">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"generate <span class="free">G</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="free">a</span> <span class="main">[^]</span> <span class="bound">k</span> <span class="main">|</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span>ord <span class="free">a</span> <span class="main">-</span> <span class="main">1</span><span class="main">}</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms generate_pow_nat ord_elems_inf_carrier <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> group<span class="main">)</span> generate_nat_pow'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ord <span class="free">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"generate <span class="free">G</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="free">a</span> <span class="main">[^]</span> <span class="bound">k</span> <span class="main">|</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">∈</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span>ord <span class="free">a</span><span class="main">}</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">a</span> <span class="main">[^]</span> <span class="bound">k</span> <span class="main">|</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">∈</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span>ord <span class="free">a</span><span class="main">}</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="free">a</span> <span class="main">[^]</span> <span class="bound">k</span> <span class="main">|</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span>ord <span class="free">a</span> <span class="main">-</span> <span class="main">1</span><span class="main">}</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">[^]</span> <span class="skolem">k</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span> <span class="main">[^]</span> <span class="bound">k</span> <span class="main">|</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span>ord <span class="free">a</span> <span class="main">-</span> <span class="main">1</span><span class="main">}</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">∈</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span>ord <span class="free">a</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
      <span class="keyword1"><span class="command">using</span></span> that pow_nat_mod_ord<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">,</span></span> 1<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"ord <span class="free">a</span>"</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> ord <span class="free">a</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">force</span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">[^]</span> <span class="skolem">k</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span> <span class="main">[^]</span> <span class="bound">k</span> <span class="main">|</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">∈</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span>ord <span class="free">a</span><span class="main">}</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span>ord <span class="free">a</span> <span class="main">-</span> <span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">[^]</span> <span class="skolem">k</span> <span class="main">=</span> <span class="free">a</span> <span class="main">[^]</span> ord <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pow_ord_eq_1<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ord <span class="free">a</span> <span class="main">∈</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span>ord <span class="free">a</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> atLeastAtMost_def atLeast_def atMost_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span> 
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> generate_nat_pow<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="General_Auxiliary">
<div class="head">
<h1>Theory General_Auxiliary</h1>
</div>
<pre class="source"><span class="comment1">(*
    File:     General_Auxiliary.thy
    Author:   Joseph Thommes, TU München; Manuel Eberl, TU München
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Auxiliary lemmas›</span></span>

<span class="keyword1"><span class="command">theory</span></span> General_Auxiliary
  <span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL-Algebra/Algebra.html">HOL-Algebra.Algebra</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="General_Auxiliary-inter_imp_subset"><span class="command">lemma</span></span> inter_imp_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∩</span> <span class="free">B</span> <span class="main">=</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">A</span> <span class="main">⊆</span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="General_Auxiliary-card_inter_eq"><span class="command">lemma</span></span> card_inter_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> card <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> <span class="free">B</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∩</span> <span class="free">B</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∩</span> <span class="free">B</span> <span class="main">=</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> card_subset_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="General_Auxiliary-coprime_eq_empty_prime_inter"><span class="command">lemma</span></span> coprime_eq_empty_prime_inter<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">n</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"coprime <span class="free">n</span> <span class="free">m</span> <span class="main">⟷</span> <span class="main">(</span>prime_factors <span class="free">n</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span>prime_factors <span class="free">m</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"coprime <span class="free">n</span> <span class="free">m</span> <span class="main">⟹</span> prime_factors <span class="free">n</span> <span class="main">∩</span> prime_factors <span class="free">m</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> cp<span class="main">:</span> <span class="quoted"><span class="quoted">"coprime <span class="free">n</span> <span class="free">m</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> pf<span class="main">:</span> <span class="quoted"><span class="quoted">"prime_factors <span class="free">n</span> <span class="main">∩</span> prime_factors <span class="free">m</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> prime_factors <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> prime_factors <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> p_dvd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="keyword1">dvd</span> <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="keyword1">dvd</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>is_unit <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> p <span class="keyword1"><span class="command">using</span></span> not_prime_unit <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">using</span></span> cp <span class="keyword1"><span class="command">unfolding</span></span> coprime_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span> <span class="quoted"><span class="quoted">"prime_factors <span class="free">n</span> <span class="main">∩</span> prime_factors <span class="free">m</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"coprime <span class="free">n</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> coprime_def
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="keyword1">dvd</span> <span class="free">n</span> <span class="main">⟶</span> <span class="skolem">c</span> <span class="keyword1">dvd</span> <span class="free">m</span> <span class="main">⟶</span> is_unit <span class="skolem">c</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">rule</span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="keyword1">dvd</span> <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="keyword1">dvd</span> <span class="free">m</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prime_factors <span class="skolem">c</span> <span class="main">⊆</span> prime_factors <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"prime_factors <span class="skolem">c</span> <span class="main">⊆</span> prime_factors <span class="free">m</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms dvd_prime_factors <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prime_factors <span class="skolem">c</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assm <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"is_unit <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms c
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dvd_0_left_iff prime_factorization_empty_iff set_mset_eq_empty_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="General_Auxiliary-prime_factors_Prod"><span class="command">lemma</span></span> prime_factors_Prod<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"prime_factors <span class="main">(</span>prod <span class="free">f</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span> <span class="main">⋃</span><span class="main">(</span>prime_factors <span class="main">`</span> <span class="free">f</span> <span class="main">`</span> <span class="free">S</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">S</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> finite_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> empty
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> i<span class="main">:</span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">F</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> i <span class="keyword1"><span class="command">have</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> i <span class="keyword1"><span class="command">have</span></span> F<span class="main">:</span> <span class="quoted"><span class="quoted">"prod <span class="free">f</span> <span class="skolem">F</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> i <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prime_factors<span class="main">(</span>prod <span class="free">f</span> <span class="skolem">F</span><span class="main">)</span> <span class="main">=</span> <span class="main">⋃</span> <span class="main">(</span>prime_factors <span class="main">`</span> <span class="free">f</span> <span class="main">`</span> <span class="skolem">F</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prod <span class="free">f</span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">F</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>prod <span class="free">f</span> <span class="skolem">F</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i mult.commute <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prime_factors <span class="main">(</span>prod <span class="free">f</span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">F</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="main">(</span>prime_factors <span class="main">`</span> <span class="free">f</span> <span class="main">`</span> <span class="skolem">F</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span> prime_factors <span class="main">(</span><span class="free">f</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> prime_factors_product<span class="main">[</span><span class="operator">OF</span> F x<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="General_Auxiliary-lcm_is_Min_multiple_nat"><span class="command">lemma</span></span> lcm_is_Min_multiple_nat<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">::</span>nat<span class="main">)</span> <span class="keyword1">dvd</span> <span class="free">c</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">b</span><span class="main">::</span>nat<span class="main">)</span> <span class="keyword1">dvd</span> <span class="free">c</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">≥</span> lcm <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> lcm_least<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">c</span></span> <span class="quoted"><span class="free">b</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="General_Auxiliary-diff_prime_power_imp_coprime"><span class="command">lemma</span></span> diff_prime_power_imp_coprime<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>"</span></span> <span class="quoted"><span class="quoted">"Factorial_Ring.prime <span class="main">(</span><span class="free">p</span><span class="main">::</span>nat<span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"Factorial_Ring.prime <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"coprime <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">q</span> <span class="main">^</span> <span class="free">m</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> power_0 power_one_right prime_dvd_power prime_imp_power_coprime_nat
            prime_nat_iff prime_power_inj''<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>prime_factors <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> finite_set_mset <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="General_Auxiliary-card_ge_1_two_diff"><span class="command">lemma</span></span> card_ge_1_two_diff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"card <span class="free">A</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">x</span> <span class="free">y</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> fA<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> card.infinite not_one_less_zero<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">with</span></span> assms fA <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> card_gt_0_iff ex_in_conv<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="skolem">y</span></span><span class="main">]</span> x <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="General_Auxiliary-infinite_two_diff"><span class="command">lemma</span></span> infinite_two_diff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"infinite <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">x</span> <span class="free">y</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ex_in_conv finite.emptyI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="skolem">y</span></span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> x y <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="General_Auxiliary-Inf_le"><span class="command">lemma</span></span> Inf_le<span class="main">:</span>
  <span class="quoted"><span class="quoted">"Inf <span class="free">A</span> <span class="main">≤</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="main">(</span><span class="free">A</span><span class="main">::</span>nat set<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">x</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Inf <span class="free">A</span> <span class="main">≤</span> Inf <span class="main">{</span><span class="free">x</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cInf_lower<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Inf <span class="free">A</span> <span class="main">≤</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="General_Auxiliary-switch_elem_card_le"><span class="command">lemma</span></span> switch_elem_card_le<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="main">≤</span> card <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Diff_insert_absorb Set.set_insert Un_commute card.infinite card_insert_disjoint
            card_mono finite_insert insert_is_Un insert_subset order_refl<span class="main">)</span>

<span class="keyword1" id="General_Auxiliary-pairwise_coprime_dvd"><span class="command">lemma</span></span> pairwise_coprime_dvd<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"pairwise coprime <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">n</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">=</span> prod id <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="bound">a</span> <span class="keyword1">dvd</span> <span class="free">j</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="keyword1">dvd</span> <span class="free">j</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">A</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> i<span class="main">:</span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">F</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prod id <span class="skolem">F</span> <span class="keyword1">dvd</span> <span class="free">j</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="keyword1">dvd</span> <span class="free">j</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i <span class="keyword1"><span class="command">unfolding</span></span> pairwise_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coprime <span class="main">(</span>prod id <span class="skolem">F</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> i<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">,</span></span> 4<span class="main"><span class="main">)</span></span> id_apply pairwise_insert prod_coprime_left<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> i<span class="main">(</span>1<span class="main">,</span> 2<span class="main">,</span> 5<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> coprime_commute divides_mult<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1" id="General_Auxiliary-pairwise_coprime_dvd'"><span class="command">lemma</span></span> pairwise_coprime_dvd'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">i</span> <span class="main">∈</span> <span class="free">A</span><span class="main">;</span> <span class="bound">j</span> <span class="main">∈</span> <span class="free">A</span><span class="main">;</span> <span class="bound">i</span> <span class="main">≠</span> <span class="bound">j</span><span class="main">⟧</span> <span class="main">⟹</span> coprime <span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">n</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">=</span> prod <span class="free">f</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">a</span> <span class="keyword1">dvd</span> <span class="free">j</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="keyword1">dvd</span> <span class="free">j</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">A</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> i<span class="main">:</span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">F</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prod <span class="free">f</span> <span class="skolem">F</span> <span class="keyword1">dvd</span> <span class="free">j</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="keyword1">dvd</span> <span class="free">j</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i <span class="keyword1"><span class="command">unfolding</span></span> pairwise_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coprime <span class="main">(</span>prod <span class="free">f</span> <span class="skolem">F</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">intro</span> prod_coprime_left<span class="main"><span class="keyword3">,</span></span> <span class="operator">use</span> i <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">blast</span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> i <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> coprime_commute divides_mult<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1" id="General_Auxiliary-transp_successively_remove1"><span class="command">lemma</span></span> transp_successively_remove1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"transp <span class="free">f</span>"</span></span> <span class="quoted"><span class="quoted">"successively <span class="free">f</span> <span class="free">l</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"successively <span class="free">f</span> <span class="main">(</span>remove1 <span class="free">a</span> <span class="free">l</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">l</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> induct_list012<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">zs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> 3<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">unfolded</span> successively.simps<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> fs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"successively <span class="free">f</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">#</span> <span class="skolem">zs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>2<span class="main">)</span> successively.simps <span class="keyword1"><span class="command">have</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"successively <span class="free">f</span> <span class="skolem">zs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">zs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> s2<span class="main">:</span> <span class="quoted"><span class="quoted">"successively <span class="free">f</span> <span class="main">(</span>remove1 <span class="free">a</span> <span class="skolem">zs</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"successively <span class="free">f</span> <span class="main">(</span>remove1 <span class="free">a</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">#</span> <span class="skolem">zs</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">consider</span></span> <span class="main">(</span>x<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="free">a</span>"</span></span> <span class="main">|</span> <span class="main">(</span>y<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="free">a</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">≠</span> <span class="free">a</span>"</span></span> <span class="main">|</span> <span class="main">(</span>zs<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="skolem">x</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">≠</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> x
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> 3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> y
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">zs</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> Nil
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> fs <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">list</span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">y</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fs <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fs<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">unfolded</span> transp_def<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Cons y s <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> zs
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> s2 fs <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>


<span class="keyword1" id="General_Auxiliary-exp_one_2pi_iff"><span class="command">lemma</span></span> exp_one_2pi_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span><span class="main">::</span><span class="quoted">real</span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"exp <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> of_real pi <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">∈</span> <span class="main">ℤ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"cis <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">x</span> <span class="main">*</span> pi<span class="main">)</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">∈</span> <span class="main">ℤ</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> complex_eq_iff sin_times_pi_eq_0 cos_one_2pi_int<span class="main"><span class="keyword3">,</span></span> <span class="operator">meson</span> Ints_cases<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"exp <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> of_real pi <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> exp <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> complex_of_real <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">x</span> <span class="main">*</span> pi<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> of_real pi <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="main">*</span> <span class="free">x</span> <span class="main">=</span> <span class="keyword1">𝗂</span> <span class="main">*</span> complex_of_real <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">x</span> <span class="main">*</span> pi<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> cis_conv_exp <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> cis <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">x</span> <span class="main">*</span> pi<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> c <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* Manuel Eberl *)</span>
<span class="keyword1" id="General_Auxiliary-of_int_divide_in_Ints_iff"><span class="command">lemma</span></span> of_int_divide_in_Ints_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span>of_int <span class="free">a</span> <span class="main">/</span> of_int <span class="free">b</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> field_char_0<span class="main">)</span> <span class="main">∈</span> <span class="main">ℤ</span> <span class="main">⟷</span> <span class="free">b</span> <span class="keyword1">dvd</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>of_int <span class="free">a</span> <span class="main">/</span> of_int <span class="free">b</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> field_char_0<span class="main">)</span> <span class="main">∈</span> <span class="main">ℤ</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> * <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"of_int <span class="free">a</span> <span class="main">/</span> of_int <span class="free">b</span> <span class="main">=</span> <span class="main">(</span>of_int <span class="skolem">n</span> <span class="main">::</span> <span class="tfree">'a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> Ints_cases<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"of_int <span class="main">(</span><span class="free">b</span> <span class="main">*</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>of_int <span class="free">a</span> <span class="main">::</span> <span class="tfree">'a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> of_int_mult<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">*</span> <span class="skolem">n</span> <span class="main">=</span> <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> of_int_eq_iff<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="keyword1">dvd</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="comment1">(* Manuel Eberl *)</span>
<span class="keyword1" id="General_Auxiliary-of_nat_divide_in_Ints_iff"><span class="command">lemma</span></span> of_nat_divide_in_Ints_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span>of_nat <span class="free">a</span> <span class="main">/</span> of_nat <span class="free">b</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> field_char_0<span class="main">)</span> <span class="main">∈</span> <span class="main">ℤ</span> <span class="main">⟷</span> <span class="free">b</span> <span class="keyword1">dvd</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> of_int_divide_in_Ints_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"int <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"int <span class="free">a</span>"</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="General_Auxiliary-true_nth_unity_root"><span class="command">lemma</span></span> true_nth_unity_root<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">n</span><span class="main">::</span><span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">x</span><span class="main">::</span><span class="quoted">complex</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">^</span> <span class="free">n</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">m</span><span class="main">.</span> <span class="main">⟦</span><span class="main">0</span><span class="main">&lt;</span><span class="bound">m</span><span class="main">;</span> <span class="bound">m</span><span class="main">&lt;</span><span class="free">n</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">^</span> <span class="bound">m</span> <span class="main">≠</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> that<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"cis <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">/</span> <span class="free">n</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> DeMoivre<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span> <span class="keyword3"><span class="command">assume</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cis <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">/</span> <span class="free">n</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">m</span> <span class="main">=</span> cis <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">*</span> <span class="skolem">m</span> <span class="main">/</span> <span class="free">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> DeMoivre <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⟷</span> real <span class="skolem">m</span> <span class="main">/</span> real <span class="free">n</span> <span class="main">∈</span> <span class="main">ℤ</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> exp_one_2pi_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">/</span> <span class="free">n</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cis_conv_exp <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="free">n</span> <span class="keyword1">dvd</span> <span class="skolem">m</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> m <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> of_nat_divide_in_Ints_iff<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="free">n</span> <span class="keyword1">dvd</span> <span class="skolem">m</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> m <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"cis <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> pi <span class="main">/</span> real <span class="free">n</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">m</span> <span class="main">≠</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1" id="General_Auxiliary-finite_bij_betwI"><span class="command">lemma</span></span> finite_bij_betwI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="free">f</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">→</span> <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"card <span class="free">A</span> <span class="main">=</span> card <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="free">f</span> <span class="free">A</span> <span class="free">B</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> bij_betw_imageI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="free">f</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> card <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_image<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> <span class="free">A</span> <span class="main">⊆</span> <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> card_subset_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="General_Auxiliary-powi_mod"><span class="command">lemma</span></span> powi_mod<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">powi</span> <span class="free">m</span> <span class="main">=</span> <span class="free">x</span> <span class="keyword1">powi</span> <span class="main">(</span><span class="free">m</span> <span class="keyword1">mod</span> <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">^</span> <span class="free">n</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">x</span><span class="main">::</span><span class="quoted">complex</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">m</span><span class="main">::</span><span class="quoted">int</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> xnz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> zero_neq_one zero_power<span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span><span class="main">::</span><span class="quoted">int</span> <span class="keyword2"><span class="keyword">where</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">=</span> <span class="skolem">k</span><span class="main">*</span><span class="free">n</span> <span class="main">+</span> <span class="main">(</span><span class="free">m</span> <span class="keyword1">mod</span> <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> div_mod_decomp_int <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">powi</span> <span class="free">m</span> <span class="main">=</span> <span class="free">x</span> <span class="keyword1">powi</span> <span class="main">(</span><span class="skolem">k</span><span class="main">*</span><span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="free">x</span> <span class="keyword1">powi</span> <span class="main">(</span><span class="free">m</span> <span class="keyword1">mod</span> <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> k<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> power_int_add<span class="main"><span class="keyword3">,</span></span> <span class="operator">use</span> xnz <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">powi</span> <span class="main">(</span><span class="skolem">k</span><span class="main">*</span><span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult.commute power_int_1_left power_int_mult power_int_of_nat<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* Manuel Eberl *)</span>
<span class="keyword1" id="General_Auxiliary-Sigma_insert"><span class="command">lemma</span></span> Sigma_insert<span class="main">:</span> <span class="quoted"><span class="quoted">"Sigma <span class="main">(</span>insert <span class="free">x</span> <span class="free">A</span><span class="main">)</span> <span class="free">B</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="free">B</span> <span class="free">x</span> <span class="main">∪</span> Sigma <span class="free">A</span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="IDirProds">
<div class="head">
<h1>Theory IDirProds</h1>
</div>
<pre class="source"><span class="comment1">(*
    File:     IDirProds.thy
    Author:   Joseph Thommes, TU München
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Internal direct product›</span></span>

<span class="keyword1"><span class="command">theory</span></span> IDirProds
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="#Generated_Groups_Extend">Generated_Groups_Extend</a> <a href="#General_Auxiliary">General_Auxiliary</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Complementarity›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We introduce the notion of complementarity, that plays a central role in the internal
direct group product and prove some basic properties about it.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> group<span class="main">)</span> <span class="entity">complementary</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">complementary</span> <span class="free"><span class="bound"><span class="entity">H1</span></span></span> <span class="free"><span class="bound"><span class="entity">H2</span></span></span> <span class="main">⟷</span> <span class="free"><span class="bound"><span class="entity">H1</span></span></span> <span class="main">∩</span> <span class="free"><span class="bound"><span class="entity">H2</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="main">𝟭</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> group<span class="main">)</span> complementary_symm<span class="main">:</span> <span class="quoted"><span class="quoted">"complementary <span class="free">A</span> <span class="free">B</span> <span class="main">⟷</span> complementary <span class="free">B</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> complementary_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> group<span class="main">)</span> subgroup_carrier_complementary<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"complementary <span class="free">H</span> <span class="free">J</span>"</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="free">I</span> <span class="main">(</span><span class="free">G</span><span class="main">⦇</span>carrier <span class="main">:=</span> <span class="free">H</span><span class="main">⦈</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="free">K</span> <span class="main">(</span><span class="free">G</span><span class="main">⦇</span>carrier <span class="main">:=</span> <span class="free">J</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"complementary <span class="free">I</span> <span class="free">K</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">𝟭</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="main">𝟭</span> <span class="main">∈</span> <span class="free">K</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> subgroup.one_closed assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">∩</span> <span class="free">K</span> <span class="main">⊆</span> <span class="free">H</span> <span class="main">∩</span> <span class="free">J</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> subgroup.subset assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> complementary_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> group<span class="main">)</span> subgroup_subset_complementary<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="free">H</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="free">J</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="free">I</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">⊆</span> <span class="free">J</span>"</span></span> <span class="quoted"><span class="quoted">"complementary <span class="free">H</span> <span class="free">J</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"complementary <span class="free">H</span> <span class="free">I</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> subgroup_carrier_complementary<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">H</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">I</span></span></span></span></span></span><span class="main"><span class="main">]</span></span> subgroup_incl<span class="main"><span class="keyword3">,</span></span> <span class="operator">use</span> assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> group<span class="main">)</span> complementary_subgroup_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="free">H</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"complementary <span class="free">A</span> <span class="free">B</span> <span class="main">⟷</span> group.complementary <span class="main">(</span><span class="free">G</span><span class="main">⦇</span>carrier <span class="main">:=</span> <span class="free">H</span><span class="main">⦈</span><span class="main">)</span> <span class="free">A</span> <span class="free">B</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> H<span class="main">:</span> group <span class="quoted"><span class="quoted">"<span class="free">G</span><span class="main">⦇</span>carrier <span class="main">:=</span> <span class="free">H</span><span class="main">⦈</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> subgroup.subgroup_is_group assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">𝟭</span><span class="hidden">⇘</span><sub><span class="free">G</span></sub><span class="hidden">⇙</span> <span class="main">=</span> <span class="main">𝟭</span><span class="hidden">⇘</span><sub><span class="free">G</span><span class="main">⦇</span>carrier <span class="main">:=</span> <span class="free">H</span><span class="main">⦈</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> complementary_def H.complementary_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> group<span class="main">)</span> subgroups_card_coprime_imp_compl<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="free">H</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="free">J</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"coprime <span class="main">(</span>card <span class="free">H</span><span class="main">)</span> <span class="main">(</span>card <span class="free">J</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"complementary <span class="free">H</span> <span class="free">J</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> complementary_def
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> JH<span class="main">:</span> subgroup <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">H</span> <span class="main">∩</span> <span class="free">J</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">G</span></span> <span class="keyword1"><span class="command">using</span></span> assms subgroups_Inter_pair <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> subgroups_card_coprime_inter_card_one<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">∩</span> <span class="free">J</span> <span class="main">=</span> <span class="main">{</span><span class="main">𝟭</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> JH.one_closed
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> card_1_singletonE singletonD<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> group<span class="main">)</span> prime_power_complementary_groups<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Factorial_Ring.prime <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"Factorial_Ring.prime <span class="free">q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="free">P</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"card <span class="free">P</span> <span class="main">=</span> <span class="free">p</span> <span class="main">^</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="free">Q</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"card <span class="free">Q</span> <span class="main">=</span> <span class="free">q</span> <span class="main">^</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"complementary <span class="free">P</span> <span class="free">Q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coprime <span class="main">(</span>card <span class="free">P</span><span class="main">)</span> <span class="main">(</span>card <span class="free">Q</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> coprime_power_right_iff primes_coprime coprime_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> subgroups_card_coprime_imp_compl assms complementary_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹With the previous work from the theory about set multiplication we can characterize
complementarity of two subgroups in abelian groups by the cardinality of their product.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> comm_group<span class="main">)</span> compl_imp_diff_cosets<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="free">H</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="free">J</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">J</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"complementary <span class="free">H</span> <span class="free">J</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">a</span> <span class="main">∈</span> <span class="free">J</span><span class="main">;</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free">J</span><span class="main">;</span> <span class="bound">a</span> <span class="main">≠</span> <span class="bound">b</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">H</span> <span class="main">#&gt;</span> <span class="bound">a</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span><span class="free">H</span> <span class="main">#&gt;</span> <span class="bound">b</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main"><span class="keyword3">;</span></span> <span class="operator">safe</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span>
  <span class="keyword3"><span class="command">assume</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">J</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="free">J</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≠</span> <span class="skolem">b</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms subgroup.subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">#&gt;</span> <span class="skolem">a</span> <span class="main">=</span> <span class="free">H</span> <span class="main">#&gt;</span> <span class="skolem">b</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">⊗</span> <span class="keyword1">inv</span> <span class="skolem">b</span> <span class="main">∈</span> <span class="free">H</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span> 2<span class="main">)</span> ab
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comm_group_axioms comm_group_def rcos_self
              subgroup.mem_carrier subgroup.rcos_module_imp<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">⊗</span> <span class="keyword1">inv</span> <span class="skolem">b</span> <span class="main">∈</span> <span class="free">J</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subgroup.m_closed<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> ab<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> subgroup.m_inv_closed<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> ab<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">⊗</span> <span class="keyword1">inv</span> <span class="skolem">b</span> <span class="main">≠</span> <span class="main">𝟭</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ab inv_equality <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">∩</span> <span class="free">J</span> <span class="main">≠</span> <span class="main">{</span><span class="main">𝟭</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> complementary_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> comm_group<span class="main">)</span> finite_sub_card_eq_mult_imp_comp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="free">H</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="free">J</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">J</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="free">H</span> <span class="main">&lt;#&gt;</span> <span class="free">J</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>card <span class="free">J</span> <span class="main">*</span> card <span class="free">H</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"complementary <span class="free">H</span> <span class="free">J</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> complementary_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">∩</span> <span class="free">J</span> <span class="main">≠</span> <span class="main">{</span><span class="main">𝟭</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">𝟭</span> <span class="main">∈</span> <span class="free">H</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> subgroup.one_closed assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">𝟭</span> <span class="main">∈</span> <span class="free">J</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> subgroup.one_closed assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">𝟭</span> <span class="main">∈</span> <span class="main">(</span><span class="free">H</span> <span class="main">∩</span> <span class="free">J</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> a_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="main">(</span><span class="free">H</span> <span class="main">∩</span> <span class="free">J</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">a</span> <span class="main">≠</span> <span class="main">𝟭</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">H</span> <span class="main">∩</span> <span class="free">J</span> <span class="main">≠</span> <span class="main">{</span><span class="main">𝟭</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> aH<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">H</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> a_inv_H<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">inv</span> <span class="skolem">a</span> <span class="main">∈</span> <span class="free">H</span> <span class="main">∧</span> <span class="keyword1">inv</span> <span class="skolem">a</span> <span class="main">≠</span> <span class="main">𝟭</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> a_def inv_eq_1_iff subgroup.mem_carrier subgroupE<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> a_def <span class="keyword1"><span class="command">have</span></span> aJ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">J</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> a_inv_J<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">inv</span> <span class="skolem">a</span> <span class="main">∈</span> <span class="free">J</span> <span class="main">∧</span> <span class="keyword1">inv</span> <span class="skolem">a</span> <span class="main">≠</span> <span class="main">𝟭</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> a_def inv_eq_1_iff subgroup.mem_carrier subgroupE<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> a_def <span class="keyword1"><span class="command">have</span></span> a_c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> subgroup.subset<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">J</span></span> <span class="quoted"><span class="free">G</span></span><span class="main">]</span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">from</span></span> set_mult_card_eq_impl_empty_inter'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">H</span></span> <span class="quoted"><span class="free">J</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> empty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">a</span> <span class="main">∈</span> <span class="free">H</span><span class="main">;</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free">H</span><span class="main">;</span> <span class="bound">a</span> <span class="main">≠</span> <span class="bound">b</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span>l_coset <span class="free">G</span> <span class="bound">a</span> <span class="free">J</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span>l_coset <span class="free">G</span> <span class="bound">b</span> <span class="free">J</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms subgroup.subset<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="free">G</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">𝟭</span> <span class="main">∈</span> <span class="main">𝟭</span> <span class="main">&lt;#</span> <span class="free">J</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">𝟭</span> <span class="main">∈</span> <span class="free">J</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> l_coset_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">𝟭</span> <span class="main">∈</span> <span class="skolem">a</span> <span class="main">&lt;#</span> <span class="free">J</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a_inv_J aJ a_c assms <span class="quoted"><span class="quoted">‹<span class="main">𝟭</span> <span class="main">∈</span> <span class="free">J</span>›</span></span> coset_join3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>l_coset <span class="free">G</span> <span class="main">𝟭</span> <span class="free">J</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span>l_coset <span class="free">G</span> <span class="skolem">a</span> <span class="free">J</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">using</span></span> empty<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">𝟭</span>"</span></span> <span class="quoted"><span class="skolem">a</span></span><span class="main">]</span> a_def aH <span class="quoted"><span class="quoted">‹<span class="main">𝟭</span> <span class="main">∈</span> <span class="free">H</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> comm_group<span class="main">)</span> finite_sub_comp_imp_card_eq_mult<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="free">H</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="free">J</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">J</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"complementary <span class="free">H</span> <span class="free">J</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="free">H</span> <span class="main">&lt;#&gt;</span> <span class="free">J</span><span class="main">)</span> <span class="main">=</span> card <span class="free">J</span> <span class="main">*</span> card <span class="free">H</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> carr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">J</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms subgroup.subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">from</span></span> coset_neq_imp_empty_inter<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> compl_imp_diff_cosets<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> em_inter<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">a</span> <span class="main">∈</span> <span class="free">J</span><span class="main">;</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free">J</span><span class="main">;</span> <span class="bound">a</span> <span class="main">≠</span> <span class="bound">b</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">H</span> <span class="main">#&gt;</span> <span class="bound">a</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span><span class="free">H</span> <span class="main">#&gt;</span> <span class="bound">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms subgroup.mem_carrier<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="main">⋃</span><span class="bound">a</span><span class="main">∈</span><span class="free">J</span><span class="main">.</span> <span class="main">(</span><span class="free">H</span> <span class="main">#&gt;</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> card <span class="free">J</span> <span class="main">*</span> card <span class="free">H</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span> carr<span class="main">(</span>2<span class="main">)</span> em_inter
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">J</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> finite_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> empty
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> i<span class="main">:</span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">F</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> cF<span class="main">:</span><span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span><span class="main">(#&gt;</span><span class="main">)</span> <span class="free">H</span> <span class="main">`</span> <span class="skolem">F</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> card <span class="skolem">F</span> <span class="main">*</span> card <span class="free">H</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> xc<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?J</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"insert <span class="skolem">x</span> <span class="skolem">F</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> i<span class="main">(</span>2<span class="main">,</span> 4<span class="main">,</span> 5<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> em<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">H</span> <span class="main">#&gt;</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">y</span><span class="main">∈</span><span class="skolem">F</span><span class="main">.</span> <span class="main">(</span><span class="free">H</span> <span class="main">#&gt;</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="free">H</span> <span class="main">#&gt;</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> carr<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rcosetsI rcosets_finite assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> xc<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="free">H</span> <span class="main">&lt;#&gt;</span> <span class="skolem">F</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> set_mult_finite<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> i<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> carr<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> i<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">&lt;#&gt;</span> <span class="skolem">F</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">a</span><span class="main">∈</span><span class="skolem">F</span><span class="main">.</span> <span class="main">(</span><span class="free">H</span> <span class="main">#&gt;</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> set_mult_def <span class="keyword1"><span class="command">using</span></span> r_coset_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="free">H</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card<span class="main">(</span><span class="free">H</span> <span class="main">#&gt;</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">+</span> card<span class="main">(</span><span class="main">⋃</span><span class="bound">y</span><span class="main">∈</span><span class="skolem">F</span><span class="main">.</span> <span class="main">(</span><span class="free">H</span> <span class="main">#&gt;</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span>
                   <span class="main">=</span> card<span class="main">(</span><span class="main">(</span><span class="free">H</span> <span class="main">#&gt;</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">y</span><span class="main">∈</span><span class="skolem">F</span><span class="main">.</span> <span class="main">(</span><span class="free">H</span> <span class="main">#&gt;</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> card<span class="main">(</span><span class="main">(</span><span class="free">H</span> <span class="main">#&gt;</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">y</span><span class="main">∈</span><span class="skolem">F</span><span class="main">.</span> <span class="main">(</span><span class="free">H</span> <span class="main">#&gt;</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> card_Un_Int <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card<span class="main">(</span><span class="free">H</span> <span class="main">#&gt;</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">+</span> card<span class="main">(</span><span class="main">⋃</span><span class="bound">y</span><span class="main">∈</span><span class="skolem">F</span><span class="main">.</span> <span class="main">(</span><span class="free">H</span> <span class="main">#&gt;</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> card<span class="main">(</span><span class="main">(</span><span class="free">H</span> <span class="main">#&gt;</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">y</span><span class="main">∈</span><span class="skolem">F</span><span class="main">.</span> <span class="main">(</span><span class="free">H</span> <span class="main">#&gt;</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> i<span class="main">(</span>5<span class="main">)</span> em <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="free">H</span> <span class="main">#&gt;</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> card <span class="free">H</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> card_rcosets_equal<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="free">H</span></span><span class="main">]</span> rcosetsI<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">H</span></span><span class="main">]</span> carr<span class="main">(</span>1<span class="main">)</span> xc <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">F</span><span class="main">)</span> <span class="main">*</span> card <span class="free">H</span> <span class="main">=</span> card <span class="skolem">F</span> <span class="main">*</span> card <span class="free">H</span> <span class="main">+</span> card <span class="free">H</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> cF <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">&lt;#&gt;</span> <span class="free">J</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">a</span><span class="main">∈</span><span class="free">J</span><span class="main">.</span> <span class="main">(</span><span class="free">H</span> <span class="main">#&gt;</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> set_mult_def <span class="keyword1"><span class="command">using</span></span> r_coset_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="free">H</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="free">H</span> <span class="main">&lt;#&gt;</span> <span class="free">J</span><span class="main">)</span> <span class="main">=</span> card <span class="free">J</span> <span class="main">*</span> card <span class="free">H</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> comm_group<span class="main">)</span> finite_sub_comp_iff_card_eq_mult<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="free">H</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="free">J</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">J</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="free">H</span> <span class="main">&lt;#&gt;</span> <span class="free">J</span><span class="main">)</span> <span class="main">=</span> card <span class="free">J</span> <span class="main">*</span> card <span class="free">H</span>  <span class="main">⟷</span> complementary <span class="free">H</span> <span class="free">J</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> finite_sub_comp_imp_card_eq_mult<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> finite_sub_card_eq_mult_imp_comp<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>IDirProd›</span></span></span></span> - binary internal direct product›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We introduce the internal direct product formed by two subgroups (so in its binary form).›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">IDirProd</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> monoid_scheme <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">IDirProd</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">Y</span></span></span> <span class="free"><span class="bound"><span class="entity">Z</span></span></span> <span class="main">=</span> generate <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Y</span></span></span> <span class="main">∪</span> <span class="free"><span class="bound"><span class="entity">Z</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Some trivial lemmas about the binary internal direct product.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> group<span class="main">)</span> IDirProd_comm<span class="main">:</span>
  <span class="quoted"><span class="quoted">"IDirProd <span class="free">G</span> <span class="free">A</span> <span class="free">B</span> <span class="main">=</span> IDirProd <span class="free">G</span> <span class="free">B</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> IDirProd_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sup_commute<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> group<span class="main">)</span> IDirProd_empty_right<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"IDirProd <span class="free">G</span> <span class="free">A</span> <span class="main">{}</span> <span class="main">=</span> generate <span class="free">G</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> IDirProd_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> group<span class="main">)</span> IDirProd_empty_left<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"IDirProd <span class="free">G</span> <span class="main">{}</span> <span class="free">A</span> <span class="main">=</span> generate <span class="free">G</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> IDirProd_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> group<span class="main">)</span> IDirProd_one_right<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"IDirProd <span class="free">G</span> <span class="free">A</span> <span class="main">{</span><span class="main">𝟭</span><span class="main">}</span> <span class="main">=</span> generate <span class="free">G</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> IDirProd_def
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">interpret</span></span> sA<span class="main">:</span> subgroup <span class="quoted"><span class="quoted">"<span class="main">(</span>generate <span class="free">G</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">G</span></span> <span class="keyword1"><span class="command">using</span></span> assms generate_is_subgroup <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">interpret</span></span> sAone<span class="main">:</span> subgroup <span class="quoted"><span class="quoted">"<span class="main">(</span>generate <span class="free">G</span> <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="main">{</span><span class="main">𝟭</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">G</span></span> <span class="keyword1"><span class="command">using</span></span> assms generate_is_subgroup <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"generate <span class="free">G</span> <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="main">{</span><span class="main">𝟭</span><span class="main">}</span><span class="main">)</span> <span class="main">⊆</span> generate <span class="free">G</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> generate_subgroup_incl<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∪</span> <span class="main">{</span><span class="main">𝟭</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"generate <span class="free">G</span> <span class="free">A</span>"</span></span><span class="main">]</span>
          generate.incl assms sA.one_closed sA.subgroup_axioms <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"generate <span class="free">G</span> <span class="free">A</span> <span class="main">⊆</span> generate <span class="free">G</span> <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="main">{</span><span class="main">𝟭</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mono_generate<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∪</span> <span class="main">{</span><span class="main">𝟭</span><span class="main">}</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> group<span class="main">)</span> IDirProd_one_left<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"IDirProd <span class="free">G</span> <span class="main">{</span><span class="main">𝟭</span><span class="main">}</span> <span class="free">A</span> <span class="main">=</span> generate <span class="free">G</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> IDirProd_one_right<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">unfolding</span></span> IDirProd_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> group<span class="main">)</span> IDirProd_is_subgroup<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">Y</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Z</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="main">(</span>IDirProd <span class="free">G</span> <span class="free">Y</span> <span class="free">Z</span><span class="main">)</span> <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> IDirProd_def <span class="keyword1"><span class="command">using</span></span> generate_is_subgroup<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">Y</span> <span class="main">∪</span> <span class="free">Z</span>"</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Using the theory about set multiplication we can also show the connection of the underlying
set in the internal direct product with the set multiplication in the case of an abelian group.
Together with the facts about complementarity and the set multiplication we can characterize
complementarity by the cardinality of the internal direct product and vice versa.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> comm_group<span class="main">)</span> IDirProd_eq_subgroup_mult<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="free">H</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="free">J</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"IDirProd <span class="free">G</span> <span class="free">H</span> <span class="free">J</span> <span class="main">=</span> <span class="free">H</span> <span class="main">&lt;#&gt;</span> <span class="free">J</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> IDirProd_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> set_mult_eq_generate_subgroup<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> comm_group<span class="main">)</span> finite_sub_comp_iff_card_eq_IDirProd<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="free">H</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="free">J</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">J</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>IDirProd <span class="free">G</span> <span class="free">H</span> <span class="free">J</span><span class="main">)</span> <span class="main">=</span> card <span class="free">J</span> <span class="main">*</span> card <span class="free">H</span>  <span class="main">⟷</span> complementary <span class="free">H</span> <span class="free">J</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> finite_sub_comp_iff_card_eq_mult IDirProd_eq_subgroup_mult assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>IDirProds›</span></span></span></span> - indexed internal direct product›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The indexed version of the internal direct product acting on a family of subgroups.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">IDirProds</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> monoid_scheme <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'c</span> <span class="main">⇒</span> <span class="tfree">'a</span> set<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'c</span> set <span class="main">⇒</span> <span class="tfree">'a</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">IDirProds</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">=</span> generate <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">(</span><span class="main">⋃</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">`</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Lemmas about the indexed internal direct product.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> group<span class="main">)</span> IDirProds_incl<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="free">i</span> <span class="main">⊆</span> IDirProds <span class="free">G</span> <span class="free">S</span> <span class="free">I</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> IDirProds_def <span class="keyword1"><span class="command">using</span></span> assms generate.incl<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span><span class="main">(</span><span class="free">S</span> <span class="main">`</span> <span class="free">I</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">G</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> group<span class="main">)</span> IDirProds_empty<span class="main">:</span>
  <span class="quoted"><span class="quoted">"IDirProds <span class="free">G</span> <span class="free">S</span> <span class="main">{}</span> <span class="main">=</span> <span class="main">{</span><span class="main">𝟭</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> IDirProds_def <span class="keyword1"><span class="command">using</span></span> generate_empty <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> group<span class="main">)</span> IDirProds_is_subgroup<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span><span class="main">(</span><span class="free">S</span> <span class="main">`</span> <span class="free">I</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span>carrier <span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="main">(</span>IDirProds <span class="free">G</span> <span class="free">S</span> <span class="free">I</span><span class="main">)</span> <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> IDirProds_def <span class="keyword1"><span class="command">using</span></span> generate_is_subgroup<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span><span class="main">(</span><span class="free">S</span> <span class="main">`</span> <span class="free">I</span><span class="main">)</span>"</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> group<span class="main">)</span> IDirProds_subgroup_id<span class="main">:</span> <span class="quoted"><span class="quoted">"subgroup <span class="main">(</span><span class="free">S</span> <span class="free">i</span><span class="main">)</span> <span class="free">G</span> <span class="main">⟹</span> IDirProds <span class="free">G</span> <span class="free">S</span> <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="main">=</span> <span class="free">S</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> generate_subgroup_id IDirProds_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> comm_group<span class="main">)</span> IDirProds_Un<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> subgroup <span class="main">(</span><span class="free">S</span> <span class="bound">i</span><span class="main">)</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">j</span><span class="main">∈</span><span class="free">B</span><span class="main">.</span> subgroup <span class="main">(</span><span class="free">S</span> <span class="bound">j</span><span class="main">)</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"IDirProds <span class="free">G</span> <span class="free">S</span> <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> IDirProds <span class="free">G</span> <span class="free">S</span> <span class="free">A</span> <span class="main">&lt;#&gt;</span> IDirProds <span class="free">G</span> <span class="free">S</span> <span class="free">B</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span> <span class="main">(</span><span class="free">S</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span> <span class="main">(</span><span class="free">S</span> <span class="main">`</span> <span class="free">B</span><span class="main">)</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> subgroup.subset assms<span class="main">(</span>1<span class="main">,</span> 2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"IDirProds <span class="free">G</span> <span class="free">S</span> <span class="free">A</span> <span class="main">&lt;#&gt;</span> IDirProds <span class="free">G</span> <span class="free">S</span> <span class="free">B</span> <span class="main">=</span> IDirProd <span class="free">G</span> <span class="main">(</span>IDirProds <span class="free">G</span> <span class="free">S</span> <span class="free">A</span><span class="main">)</span> <span class="main">(</span>IDirProds <span class="free">G</span> <span class="free">S</span> <span class="free">B</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> IDirProd_eq_subgroup_mult <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> IDirProds_is_subgroup subset<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> generate <span class="free">G</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span><span class="free">S</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">∪</span> IDirProds <span class="free">G</span> <span class="free">S</span> <span class="free">B</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> IDirProds_def IDirProd_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> generate_idem' generate_incl subset<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> generate <span class="free">G</span> <span class="main">(</span><span class="main">⋃</span><span class="main">(</span><span class="free">S</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">∪</span> <span class="main">⋃</span><span class="main">(</span><span class="free">S</span> <span class="main">`</span> <span class="free">B</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> IDirProds_def IDirProd_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> generate_idem'_right generate_incl subset<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span><span class="main">(</span><span class="free">S</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">∪</span> <span class="main">⋃</span><span class="main">(</span><span class="free">S</span> <span class="main">`</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> <span class="main">⋃</span><span class="main">(</span><span class="free">S</span> <span class="main">`</span> <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="free">B</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"generate <span class="free">G</span> <span class="main">…</span> <span class="main">=</span> IDirProds <span class="free">G</span> <span class="free">S</span> <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="free">B</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> IDirProds_def <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> comm_group<span class="main">)</span> IDirProds_finite<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> subgroup <span class="main">(</span><span class="free">S</span> <span class="bound">i</span><span class="main">)</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> finite <span class="main">(</span><span class="free">S</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>IDirProds <span class="free">G</span> <span class="free">S</span> <span class="free">I</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">I</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> finite_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> empty
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> IDirProds_empty<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">S</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> i<span class="main">:</span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">I</span><span class="main">)</span>
  <span class="keyword1"><span class="command">interpret</span></span> Sx<span class="main">:</span> subgroup <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="free">G</span></span> <span class="keyword1"><span class="command">using</span></span> i <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> cx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">S</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">have</span></span> cI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span><span class="main">(</span><span class="free">S</span> <span class="main">`</span> <span class="skolem">I</span><span class="main">)</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i subgroup.subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">interpret</span></span> subgroup <span class="quoted"><span class="quoted">"IDirProds <span class="free">G</span> <span class="free">S</span> <span class="skolem">I</span>"</span></span> <span class="quoted"><span class="free">G</span></span> <span class="keyword1"><span class="command">using</span></span> IDirProds_is_subgroup<span class="main">[</span><span class="operator">OF</span> cI<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> cIP<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>IDirProds <span class="free">G</span> <span class="free">S</span> <span class="skolem">I</span><span class="main">)</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">from</span></span> i <span class="keyword1"><span class="command">have</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="free">S</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>IDirProds <span class="free">G</span> <span class="free">S</span> <span class="skolem">I</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="skolem">x</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">from</span></span> IDirProds_Un<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">x</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="free">S</span></span> <span class="quoted"><span class="skolem">I</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"IDirProds <span class="free">G</span> <span class="free">S</span> <span class="main">(</span><span class="main">{</span><span class="skolem">x</span><span class="main">}</span> <span class="main">∪</span> <span class="skolem">I</span><span class="main">)</span> <span class="main">=</span> IDirProds <span class="free">G</span> <span class="free">S</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span> <span class="main">&lt;#&gt;</span> IDirProds <span class="free">G</span> <span class="free">S</span> <span class="skolem">I</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">S</span> <span class="skolem">x</span> <span class="main">&lt;#&gt;</span> IDirProds <span class="free">G</span> <span class="free">S</span> <span class="skolem">I</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> IDirProds_subgroup_id<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">S</span></span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> Sx.subgroup_axioms <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="main">…</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> set_mult_finite<span class="main">[</span><span class="operator">OF</span> f<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span> 2<span class="main"><span class="main">)</span></span> cx cIP<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> insert_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> comm_group<span class="main">)</span> IDirProds_compl_imp_compl<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="main">∈</span> <span class="free">I</span><span class="main">.</span> subgroup <span class="main">(</span><span class="free">S</span> <span class="bound">i</span><span class="main">)</span> <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="free">H</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"complementary <span class="free">H</span> <span class="main">(</span>IDirProds <span class="free">G</span> <span class="free">S</span> <span class="free">I</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"complementary <span class="free">H</span> <span class="main">(</span><span class="free">S</span> <span class="free">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="free">i</span> <span class="main">⊆</span> IDirProds <span class="free">G</span> <span class="free">S</span> <span class="free">I</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms IDirProds_incl <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">∩</span> <span class="main">(</span><span class="free">S</span> <span class="free">i</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">H</span> <span class="main">∩</span> IDirProds <span class="free">G</span> <span class="free">S</span> <span class="free">I</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">𝟭</span> <span class="main">∈</span> <span class="free">H</span> <span class="main">∩</span> <span class="main">(</span><span class="free">S</span> <span class="free">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> subgroup.one_closed assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"complementary <span class="free">H</span> <span class="main">(</span><span class="free">S</span> <span class="free">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> complementary_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Using the knowledge about the binary internal direct product, we can - in case that all
subgroups in the family have coprime orders - also derive the cardinality of the indexed internal
direct product.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> comm_group<span class="main">)</span> IDirProds_card<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> subgroup <span class="main">(</span><span class="free">S</span> <span class="bound">i</span><span class="main">)</span> <span class="free">G</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> finite <span class="main">(</span><span class="free">S</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"pairwise <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> coprime <span class="main">(</span>card <span class="main">(</span><span class="free">S</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>card <span class="main">(</span><span class="free">S</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>IDirProds <span class="free">G</span> <span class="free">S</span> <span class="free">I</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">i</span> <span class="main">∈</span> <span class="free">I</span><span class="main">.</span> card <span class="main">(</span><span class="free">S</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">I</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> finite_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> empty
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> IDirProds_empty<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">S</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> i<span class="main">:</span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">I</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> sx<span class="main">:</span> <span class="quoted"><span class="quoted">"subgroup <span class="main">(</span><span class="free">S</span> <span class="skolem">x</span><span class="main">)</span> <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> cx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">S</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> subgroup.subset<span class="main">[</span><span class="operator">OF</span> sx<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> fx<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="free">S</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> cI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span><span class="main">(</span><span class="free">S</span> <span class="main">`</span> <span class="skolem">I</span><span class="main">)</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> subgroup.subset<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="free">G</span></span><span class="main">]</span> i<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> generate_is_subgroup<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> sIP<span class="main">:</span> <span class="quoted"><span class="quoted">"subgroup <span class="main">(</span>IDirProds <span class="free">G</span> <span class="free">S</span> <span class="skolem">I</span><span class="main">)</span> <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> IDirProds_def <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> cIP<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>IDirProds <span class="free">G</span> <span class="free">S</span> <span class="skolem">I</span><span class="main">)</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> subgroup.subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> fIP<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>IDirProds <span class="free">G</span> <span class="free">S</span> <span class="skolem">I</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> IDirProds_finite<span class="main">[</span><span class="operator">OF</span> i<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> i <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">from</span></span> i <span class="keyword1"><span class="command">have</span></span> ih<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>IDirProds <span class="free">G</span> <span class="free">S</span> <span class="skolem">I</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">∈</span><span class="skolem">I</span><span class="main">.</span> card <span class="main">(</span><span class="free">S</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> pairwise_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> cop<span class="main">:</span> <span class="quoted"><span class="quoted">"coprime <span class="main">(</span>card <span class="main">(</span>IDirProds <span class="free">G</span> <span class="free">S</span> <span class="skolem">I</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>card <span class="main">(</span><span class="free">S</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> cFI0<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>IDirProds <span class="free">G</span> <span class="free">S</span> <span class="skolem">I</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> finite_subgroup_card_neq_0<span class="main">[</span><span class="operator">OF</span> sIP fIP<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> cx0<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="free">S</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> finite_subgroup_card_neq_0<span class="main">[</span><span class="operator">OF</span> sx fx<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"prime_factors <span class="main">(</span>card <span class="main">(</span>IDirProds <span class="free">G</span> <span class="free">S</span> <span class="skolem">I</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> prime_factors <span class="main">(</span>card <span class="main">(</span><span class="free">S</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> n0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="skolem">I</span> <span class="main">⟹</span> card <span class="main">(</span><span class="free">S</span> <span class="bound">i</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> finite_subgroup_card_neq_0 i<span class="main">(</span>4<span class="main">,</span> 5<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"prime_factors <span class="main">(</span>card <span class="main">(</span>IDirProds <span class="free">G</span> <span class="free">S</span> <span class="skolem">I</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> prime_factors <span class="main">(</span>card <span class="main">(</span><span class="free">S</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prime_factors <span class="main">(</span>card <span class="main">(</span>IDirProds <span class="free">G</span> <span class="free">S</span> <span class="skolem">I</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">⋃</span><span class="main">(</span>prime_factors <span class="main">`</span> <span class="main">(</span>card <span class="main">∘</span> <span class="free">S</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">I</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> n0 prime_factors_Prod<span class="main">[</span><span class="operator">OF</span> i<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"card <span class="main">∘</span> <span class="free">S</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> ih<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="skolem">I</span> <span class="main">⟹</span> prime_factors <span class="main">(</span>card <span class="main">(</span><span class="free">S</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> prime_factors <span class="main">(</span>card <span class="main">(</span><span class="free">S</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
        <span class="keyword3"><span class="command">assume</span></span> ind<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="skolem">I</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> coPx<span class="main">:</span> <span class="quoted"><span class="quoted">"coprime <span class="main">(</span>card <span class="main">(</span><span class="free">S</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>card <span class="main">(</span><span class="free">S</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> i<span class="main">(</span>2<span class="main">,</span> 6<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> pairwise_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="free">S</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> n0 ind <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">from</span></span> coprime_eq_empty_prime_inter<span class="main">[</span><span class="operator">OF</span> this cx0<span class="main">]</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"prime_factors <span class="main">(</span>card <span class="main">(</span><span class="free">S</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> prime_factors <span class="main">(</span>card <span class="main">(</span><span class="free">S</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> coPx <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> coprime_eq_empty_prime_inter <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>IDirProds <span class="free">G</span> <span class="free">S</span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">I</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> card <span class="main">(</span><span class="free">S</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">*</span> card <span class="main">(</span>IDirProds <span class="free">G</span> <span class="free">S</span> <span class="skolem">I</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> finite_sub_comp_iff_card_eq_IDirProd<span class="main">[</span><span class="operator">OF</span> sIP sx fIP fx<span class="main">]</span>
         subgroups_card_coprime_imp_compl<span class="main">[</span><span class="operator">OF</span> sIP sx cop<span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>IDirProd <span class="free">G</span> <span class="main">(</span>IDirProds <span class="free">G</span> <span class="free">S</span> <span class="skolem">I</span><span class="main">)</span> <span class="main">(</span><span class="free">S</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> card <span class="main">(</span><span class="free">S</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">*</span> card <span class="main">(</span>IDirProds <span class="free">G</span> <span class="free">S</span> <span class="skolem">I</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"generate <span class="free">G</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span><span class="free">S</span> <span class="main">`</span> insert <span class="skolem">x</span> <span class="skolem">I</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> generate <span class="free">G</span> <span class="main">(</span>generate <span class="free">G</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span><span class="free">S</span> <span class="main">`</span> <span class="skolem">I</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span> <span class="free">S</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Un_commute cI cx generate_idem'_right<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> IDirProds_def IDirProd_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> card <span class="main">(</span><span class="free">S</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">*</span> prod <span class="main">(</span>card <span class="main">∘</span> <span class="free">S</span><span class="main">)</span> <span class="skolem">I</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ih <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> prod <span class="main">(</span>card <span class="main">∘</span> <span class="free">S</span><span class="main">)</span> <span class="main">(</span><span class="main">{</span><span class="skolem">x</span><span class="main">}</span> <span class="main">∪</span> <span class="skolem">I</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i.hyps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Complementary family of subgroups"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The notion of a complementary family is introduced. Note that the subgroups are complementary
not only to the other subgroups but to the product of the other subgroups.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> group<span class="main">)</span> <span class="entity">compl_fam</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'c</span> <span class="main">⇒</span> <span class="tfree">'a</span> set<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'c</span> set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">compl_fam</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span><span class="main">.</span> complementary <span class="main">(</span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span>IDirProds <span class="free">G</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">-</span> <span class="main">{</span><span class="bound">i</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Some lemmas about <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>compl_fam›</span></span></span></span>.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> group<span class="main">)</span> compl_fam_empty<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"compl_fam <span class="free">S</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> compl_fam_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> group<span class="main">)</span> compl_fam_cong<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"compl_fam <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="free">g</span><span class="main">)</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="free">g</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"compl_fam <span class="free">f</span> <span class="main">(</span><span class="free">g</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="free">g</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">i</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>  <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="main">(</span><span class="free">g</span> <span class="main">`</span> <span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="free">g</span> <span class="skolem">i</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
    <span class="keyword1"><span class="command">using</span></span> assms that <span class="keyword1"><span class="command">unfolding</span></span> inj_on_def comp_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> compl_fam_def IDirProds_def complementary_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We now connect <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>compl_fam›</span></span></span></span> with <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>generate›</span></span></span></span> as this will be its main application.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> comm_group<span class="main">)</span> compl_fam_imp_generate_inj<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">gs</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"compl_fam <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">g</span><span class="main">}</span><span class="main">)</span> <span class="free">gs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">g</span><span class="main">}</span><span class="main">)</span> <span class="free">gs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
  <span class="keyword3"><span class="command">assume</span></span> xy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">gs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">gs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">y</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> gen<span class="main">:</span> <span class="quoted"><span class="quoted">"generate <span class="free">G</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">g</span><span class="main">∈</span><span class="free">gs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">y</span><span class="main">}</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">g</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> generate <span class="free">G</span> <span class="main">(</span><span class="free">gs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">y</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> generate_idem_Un<span class="main"><span class="keyword3">,</span></span> <span class="operator">use</span> assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">blast</span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"generate <span class="free">G</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span> <span class="main">=</span> generate <span class="free">G</span> <span class="main">{</span><span class="skolem">y</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> xy <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"generate <span class="free">G</span> <span class="main">{</span><span class="skolem">y</span><span class="main">}</span> <span class="main">⊆</span> generate <span class="free">G</span> <span class="main">(</span><span class="free">gs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">y</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mono_generate<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">x</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">gs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">y</span><span class="main">}</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> xy <span class="keyword1"><span class="command">have</span></span> gyo<span class="main">:</span> <span class="quoted"><span class="quoted">"generate <span class="free">G</span> <span class="main">{</span><span class="skolem">y</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">𝟭</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> generate.one gen
    <span class="keyword1"><span class="command">unfolding</span></span> compl_fam_def complementary_def IDirProds_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> yo<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="main">𝟭</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> generate_singleton_one <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> gyo g generate_singleton_one <span class="keyword1"><span class="command">have</span></span> xo<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">𝟭</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> xy yo xo <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>  

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> comm_group<span class="main">)</span> compl_fam_generate_subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"compl_fam <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">g</span><span class="main">}</span><span class="main">)</span> <span class="free">gs</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">gs</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> <span class="free">gs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"compl_fam <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">g</span><span class="main">}</span><span class="main">)</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">unfold</span> compl_fam_def complementary_def IDirProds_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> generate_idem_Un<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="bound">i</span><span class="main">}</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"generate <span class="free">G</span> <span class="main">{</span><span class="skolem">i</span><span class="main">}</span> <span class="main">∩</span> generate <span class="free">G</span> <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">i</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">𝟭</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">𝟭</span> <span class="main">∈</span> generate <span class="free">G</span> <span class="main">{</span><span class="skolem">i</span><span class="main">}</span> <span class="main">∩</span> generate <span class="free">G</span> <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">i</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> generate.one <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"generate <span class="free">G</span> <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">i</span><span class="main">}</span><span class="main">)</span> <span class="main">⊆</span> generate <span class="free">G</span> <span class="main">(</span><span class="free">gs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">i</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mono_generate<span class="main"><span class="keyword3">,</span></span> <span class="operator">use</span> assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">fast</span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"generate <span class="free">G</span> <span class="main">{</span><span class="skolem">i</span><span class="main">}</span> <span class="main">∩</span> generate <span class="free">G</span> <span class="main">(</span><span class="free">gs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">i</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">𝟭</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms that generate_idem_Un<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">gs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">i</span><span class="main">}</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">unfolding</span></span> compl_fam_def IDirProds_def complementary_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">i</span><span class="main">}</span> <span class="main">∩</span> generate <span class="free">G</span> <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="bound">i</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">𝟭</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>is_idirprod›</span></span></span></span>›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹In order to identify a group as the internal direct product of a family of subgroups, they all
have to be normal subgroups, complementary to the product of the rest of the subgroups and generate
all of the group - this is captured in the definition of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>is_idirprod›</span></span></span></span>.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> group<span class="main">)</span> <span class="entity">is_idirprod</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'c</span> <span class="main">⇒</span> <span class="tfree">'a</span> set<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'c</span> set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">is_idirprod</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">∀</span><span class="bound">i</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="bound">i</span> <span class="main">⊲</span> <span class="free">G</span><span class="main">)</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> IDirProds <span class="free">G</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">∧</span> compl_fam <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Very basic lemmas about <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>is_idirprod›</span></span></span></span>.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> comm_group<span class="main">)</span> is_idirprod_subgroup_suffices<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">=</span> IDirProds <span class="free">G</span> <span class="free">S</span> <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> subgroup <span class="main">(</span><span class="free">S</span> <span class="bound">i</span><span class="main">)</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"compl_fam <span class="free">S</span> <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_idirprod <span class="free">A</span> <span class="free">S</span> <span class="free">I</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> is_idirprod_def <span class="keyword1"><span class="command">using</span></span> assms subgroup_imp_normal <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> comm_group<span class="main">)</span> is_idirprod_generate<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">=</span> generate <span class="free">G</span> <span class="free">gs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">gs</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"compl_fam <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">g</span><span class="main">}</span><span class="main">)</span> <span class="free">gs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_idirprod <span class="free">A</span> <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">g</span><span class="main">}</span><span class="main">)</span> <span class="free">gs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> is_idirprod_subgroup_suffices<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">=</span> IDirProds <span class="free">G</span> <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">g</span><span class="main">}</span><span class="main">)</span> <span class="free">gs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms generate_idem_Un<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> IDirProds_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">∈</span><span class="free">gs</span><span class="main">.</span> subgroup <span class="main">(</span>generate <span class="free">G</span> <span class="main">{</span><span class="bound">i</span><span class="main">}</span><span class="main">)</span> <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms generate_is_subgroup <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"compl_fam <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">g</span><span class="main">}</span><span class="main">)</span> <span class="free">gs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> comm_group<span class="main">)</span> is_idirprod_imp_compl_fam<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_idirprod <span class="free">A</span> <span class="free">S</span> <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"compl_fam <span class="free">S</span> <span class="free">I</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> is_idirprod_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> comm_group<span class="main">)</span> is_idirprod_generate_imp_generate<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_idirprod <span class="free">A</span> <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">g</span><span class="main">}</span><span class="main">)</span> <span class="free">gs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">=</span> generate <span class="free">G</span> <span class="free">gs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">gs</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="free">gs</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">g</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">interpret</span></span> g<span class="main">:</span> subgroup <span class="quoted"><span class="quoted">"generate <span class="free">G</span> <span class="main">{</span><span class="skolem">g</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="free">G</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms that normal_imp_subgroup <span class="keyword1"><span class="command">unfolding</span></span> is_idirprod_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> g.subset generate.incl <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms generate_idem_Un <span class="keyword1"><span class="command">unfolding</span></span> is_idirprod_def IDirProds_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Finite_Product_Extend">
<div class="head">
<h1>Theory Finite_Product_Extend</h1>
</div>
<pre class="source"><span class="comment1">(*
    File:     Finite_Product_Extend.thy
    Author:   Joseph Thommes, TU München; Manuel Eberl, TU München
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Finite Product›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Finite_Product_Extend
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="#IDirProds">IDirProds</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹In this section, some general facts about <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>finprod›</span></span></span></span> as well as some tailored for the rest of
this entry are proven.›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹It is often needed to split a product in a single factor and the rest. Thus these two lemmas.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> comm_group<span class="main">)</span> finprod_minus<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">→</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finprod <span class="free">G</span> <span class="free">f</span> <span class="free">A</span> <span class="main">=</span> <span class="free">f</span> <span class="free">a</span> <span class="main">⊗</span> finprod <span class="free">G</span> <span class="free">f</span> <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">=</span> insert <span class="free">a</span> <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finprod <span class="free">G</span> <span class="free">f</span> <span class="free">A</span> <span class="main">=</span> finprod <span class="free">G</span> <span class="free">f</span> <span class="main">(</span>insert <span class="free">a</span> <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">f</span> <span class="free">a</span> <span class="main">⊗</span> finprod <span class="free">G</span> <span class="free">f</span> <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> finprod_insert<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> comm_group<span class="main">)</span> finprod_minus_symm<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">→</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finprod <span class="free">G</span> <span class="free">f</span> <span class="free">A</span> <span class="main">=</span> finprod <span class="free">G</span> <span class="free">f</span> <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span> <span class="main">⊗</span> <span class="free">f</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">=</span> insert <span class="free">a</span> <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finprod <span class="free">G</span> <span class="free">f</span> <span class="free">A</span> <span class="main">=</span> finprod <span class="free">G</span> <span class="free">f</span> <span class="main">(</span>insert <span class="free">a</span> <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">f</span> <span class="free">a</span> <span class="main">⊗</span> finprod <span class="free">G</span> <span class="free">f</span> <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> finprod_insert<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> finprod <span class="free">G</span> <span class="free">f</span> <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span> <span class="main">⊗</span> <span class="free">f</span> <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> m_comm<span class="main"><span class="keyword3">,</span></span> <span class="operator">use</span> assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> finprod_closed<span class="main"><span class="keyword3">,</span></span> <span class="operator">use</span> assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">blast</span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This makes it very easy to show the following trivial fact.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> comm_group<span class="main">)</span> finprod_singleton<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"finprod <span class="free">G</span> <span class="free">f</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="main">=</span> <span class="free">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x</span> <span class="main">=</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finprod <span class="free">G</span> <span class="free">f</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="main">=</span> <span class="free">f</span> <span class="free">x</span> <span class="main">⊗</span> finprod <span class="free">G</span> <span class="free">f</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> finprod_minus<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">x</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The finite product is consistent and closed concerning subgroups.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> comm_group<span class="main">)</span> finprod_subgroup<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">→</span> <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="free">H</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finprod <span class="free">G</span> <span class="free">f</span> <span class="free">S</span> <span class="main">=</span> finprod <span class="main">(</span><span class="free">G</span><span class="main">⦇</span>carrier <span class="main">:=</span> <span class="free">H</span><span class="main">⦈</span><span class="main">)</span> <span class="free">f</span> <span class="free">S</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"finite <span class="free">S</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">interpret</span></span> H<span class="main">:</span> comm_group <span class="quoted"><span class="quoted">"<span class="free">G</span><span class="main">⦇</span>carrier <span class="main">:=</span> <span class="free">H</span><span class="main">⦈</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> subgroup_is_comm_group<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> True assms
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">S</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> finite_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> empty
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> finprod_empty H.finprod_empty <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> i<span class="main">:</span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">F</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finprod <span class="free">G</span> <span class="free">f</span> <span class="skolem">F</span> <span class="main">=</span> finprod <span class="main">(</span><span class="free">G</span><span class="main">⦇</span>carrier <span class="main">:=</span> <span class="free">H</span><span class="main">⦈</span><span class="main">)</span> <span class="free">f</span> <span class="skolem">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finprod <span class="free">G</span> <span class="free">f</span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">F</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">x</span> <span class="main">⊗</span> finprod <span class="free">G</span> <span class="free">f</span> <span class="skolem">F</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> finprod_insert<span class="main"><span class="main">[</span></span><span class="operator">OF</span> i<span class="main"><span class="main"><span class="main">(</span></span></span>1<span class="main"><span class="main"><span class="main">,</span></span></span> 2<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">f</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="skolem">F</span> <span class="main">→</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i<span class="main">(</span>4<span class="main">)</span> subgroup.subset<span class="main">[</span><span class="operator">OF</span> i<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finprod <span class="free">G</span> <span class="free">f</span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">F</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">x</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="free">G</span><span class="main">⦇</span>carrier <span class="main">:=</span> <span class="free">H</span><span class="main">⦈</span></sub><span class="hidden">⇙</span> finprod <span class="main">(</span><span class="free">G</span><span class="main">⦇</span>carrier <span class="main">:=</span> <span class="free">H</span><span class="main">⦈</span><span class="main">)</span> <span class="free">f</span> <span class="skolem">F</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finprod <span class="main">(</span><span class="free">G</span><span class="main">⦇</span>carrier <span class="main">:=</span> <span class="free">H</span><span class="main">⦈</span><span class="main">)</span> <span class="free">f</span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">F</span><span class="main">)</span> <span class="main">=</span> <span class="main">…</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> H.finprod_insert<span class="main"><span class="main">[</span></span><span class="operator">OF</span> i<span class="main"><span class="main"><span class="main">(</span></span></span>1<span class="main"><span class="main"><span class="main">,</span></span></span> 2<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="skolem">F</span> <span class="main">→</span> carrier <span class="main">(</span><span class="free">G</span><span class="main">⦇</span>carrier <span class="main">:=</span> <span class="free">H</span><span class="main">⦈</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main">∈</span> carrier <span class="main">(</span><span class="free">G</span><span class="main">⦇</span>carrier <span class="main">:=</span> <span class="free">H</span><span class="main">⦈</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> finprod_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> comm_group<span class="main">)</span> finprod_closed_subgroup<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="free">H</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">→</span> <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finprod <span class="free">G</span> <span class="free">f</span> <span class="free">A</span> <span class="main">∈</span> <span class="free">H</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">A</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span>
<span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>infinite <span class="skolem">A</span><span class="main">)</span>
<span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> subgroup.one_closed<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> empty
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> subgroup.one_closed<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> i<span class="main">:</span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">F</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> finprod_insert<span class="main">[</span><span class="operator">OF</span> i<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span> 2<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span> i <span class="keyword1"><span class="command">have</span></span> fi<span class="main">:</span> <span class="quoted"><span class="quoted">"finprod <span class="free">G</span> <span class="free">f</span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">F</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">x</span> <span class="main">⊗</span> finprod <span class="free">G</span> <span class="free">f</span> <span class="skolem">F</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> subgroup.subset<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> i <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finprod <span class="free">G</span> <span class="free">f</span> <span class="skolem">F</span> <span class="main">∈</span> <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="free">H</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">with</span></span> fi <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> subgroup.m_closed<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹It also does not matter if we exponentiate all elements taking part in the product or the
result of the product.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> comm_group<span class="main">)</span> finprod_exp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">→</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>finprod <span class="free">G</span> <span class="free">f</span> <span class="free">A</span><span class="main">)</span> <span class="main">[^]</span> <span class="main">(</span><span class="free">k</span><span class="main">::</span>int<span class="main">)</span> <span class="main">=</span> finprod <span class="free">G</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">[^]</span> <span class="free">k</span><span class="main">)</span> <span class="main">∘</span> <span class="free">f</span><span class="main">)</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">A</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> i<span class="main">:</span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">F</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> ih<span class="main">:</span> <span class="quoted"><span class="quoted">"finprod <span class="free">G</span> <span class="free">f</span> <span class="skolem">F</span> <span class="main">[^]</span> <span class="free">k</span> <span class="main">=</span> finprod <span class="free">G</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">[^]</span> <span class="free">k</span><span class="main">)</span> <span class="main">∘</span> <span class="free">f</span><span class="main">)</span> <span class="skolem">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> fpc<span class="main">:</span> <span class="quoted"><span class="quoted">"finprod <span class="free">G</span> <span class="free">f</span> <span class="skolem">F</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> finprod_closed<span class="main"><span class="keyword3">,</span></span> <span class="operator">use</span> i <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> fxc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finprod <span class="free">G</span> <span class="free">f</span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">F</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">x</span> <span class="main">⊗</span> finprod <span class="free">G</span> <span class="free">f</span> <span class="skolem">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> finprod_insert<span class="main"><span class="keyword3">,</span></span> <span class="operator">use</span> i <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"finprod <span class="free">G</span> <span class="free">f</span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">F</span><span class="main">)</span> <span class="main">[^]</span> <span class="free">k</span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">x</span> <span class="main">⊗</span> finprod <span class="free">G</span> <span class="free">f</span> <span class="skolem">F</span><span class="main">)</span> <span class="main">[^]</span> <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">x</span> <span class="main">[^]</span> <span class="free">k</span> <span class="main">⊗</span> finprod <span class="free">G</span> <span class="free">f</span> <span class="skolem">F</span> <span class="main">[^]</span> <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fpc fxc int_pow_distrib <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">[^]</span> <span class="free">k</span><span class="main">)</span> <span class="main">∘</span> <span class="free">f</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">⊗</span> finprod <span class="free">G</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">[^]</span> <span class="free">k</span><span class="main">)</span> <span class="main">∘</span> <span class="free">f</span><span class="main">)</span> <span class="skolem">F</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ih <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> finprod <span class="free">G</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">[^]</span> <span class="free">k</span><span class="main">)</span> <span class="main">∘</span> <span class="free">f</span><span class="main">)</span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">F</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> finprod_insert<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">use</span> i <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Some lemmas concerning different combinations of functions in the usage of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>finprod›</span></span></span></span>.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> comm_group<span class="main">)</span> finprod_cong_split<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">a</span> <span class="main">⊗</span> <span class="free">g</span> <span class="bound">a</span> <span class="main">=</span> <span class="free">h</span> <span class="bound">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">→</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">→</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">→</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finprod <span class="free">G</span> <span class="free">h</span> <span class="free">A</span> <span class="main">=</span> finprod <span class="free">G</span> <span class="free">f</span> <span class="free">A</span> <span class="main">⊗</span> finprod <span class="free">G</span> <span class="free">g</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">A</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>infinite <span class="skolem">A</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> empty
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> i<span class="main">:</span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">F</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> iH<span class="main">:</span> <span class="quoted"><span class="quoted">"finprod <span class="free">G</span> <span class="free">h</span> <span class="skolem">F</span> <span class="main">=</span> finprod <span class="free">G</span> <span class="free">f</span> <span class="skolem">F</span> <span class="main">⊗</span> finprod <span class="free">G</span> <span class="free">g</span> <span class="skolem">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">have</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"finprod <span class="free">G</span> <span class="free">f</span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">F</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">x</span> <span class="main">⊗</span> finprod <span class="free">G</span> <span class="free">f</span> <span class="skolem">F</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> finprod_insert<span class="main"><span class="main">[</span></span><span class="operator">OF</span> i<span class="main"><span class="main"><span class="main">(</span></span></span>1<span class="main"><span class="main"><span class="main">,</span></span></span> 2<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">f</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">use</span> i<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"finprod <span class="free">G</span> <span class="free">g</span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">F</span><span class="main">)</span> <span class="main">=</span> <span class="free">g</span> <span class="skolem">x</span> <span class="main">⊗</span> finprod <span class="free">G</span> <span class="free">g</span> <span class="skolem">F</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> finprod_insert<span class="main"><span class="main">[</span></span><span class="operator">OF</span> i<span class="main"><span class="main"><span class="main">(</span></span></span>1<span class="main"><span class="main"><span class="main">,</span></span></span> 2<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">g</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">use</span> i<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"finprod <span class="free">G</span> <span class="free">h</span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">F</span><span class="main">)</span> <span class="main">=</span> <span class="free">h</span> <span class="skolem">x</span> <span class="main">⊗</span> finprod <span class="free">G</span> <span class="free">h</span> <span class="skolem">F</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> finprod_insert<span class="main"><span class="main">[</span></span><span class="operator">OF</span> i<span class="main"><span class="main"><span class="main">(</span></span></span>1<span class="main"><span class="main"><span class="main">,</span></span></span> 2<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">h</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">use</span> i<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">simp</span><span class="main">)</span>  
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">h</span> <span class="skolem">x</span> <span class="main">⊗</span> <span class="main">(</span>finprod <span class="free">G</span> <span class="free">f</span> <span class="skolem">F</span> <span class="main">⊗</span> finprod <span class="free">G</span> <span class="free">g</span> <span class="skolem">F</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> iH <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">x</span> <span class="main">⊗</span> <span class="free">g</span> <span class="skolem">x</span> <span class="main">⊗</span> <span class="main">(</span>finprod <span class="free">G</span> <span class="free">f</span> <span class="skolem">F</span> <span class="main">⊗</span> finprod <span class="free">G</span> <span class="free">g</span> <span class="skolem">F</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">x</span> <span class="main">⊗</span> finprod <span class="free">G</span> <span class="free">f</span> <span class="skolem">F</span> <span class="main">⊗</span> <span class="main">(</span><span class="free">g</span> <span class="skolem">x</span> <span class="main">⊗</span> finprod <span class="free">G</span> <span class="free">g</span> <span class="skolem">F</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> m_comm m_assoc i<span class="main">(</span>5-7<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> finprod <span class="free">G</span> <span class="free">f</span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">F</span><span class="main">)</span> <span class="main">⊗</span> finprod <span class="free">G</span> <span class="free">g</span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">F</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f g <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> comm_group<span class="main">)</span> finprod_comp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="free">g</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="free">g</span><span class="main">)</span> <span class="main">`</span> <span class="free">A</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finprod <span class="free">G</span> <span class="free">f</span> <span class="main">(</span><span class="free">g</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> finprod <span class="free">G</span> <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="free">g</span><span class="main">)</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> finprod_reindex<span class="main">[</span><span class="operator">OF</span> _ assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> comp_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The subgroup generated by a set of generators (in an abelian group) is exactly the set of
elements that can be written as a finite product using only powers of these elements.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> comm_group<span class="main">)</span> generate_eq_finprod_PiE_image<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">gs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">gs</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"generate <span class="free">G</span> <span class="free">gs</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> finprod <span class="free">G</span> <span class="bound">x</span> <span class="free">gs</span><span class="main">)</span> <span class="main">`</span> Pi<span class="hidden">⇩</span><sub>E</sub> <span class="free">gs</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">a</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?g</span> <span class="main">=</span> <span class="var">?fp</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?g</span> <span class="main">⊆</span> <span class="var">?fp</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="var">?g</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="var">?fp</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> generate.induct<span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> one
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"restrict <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">𝟭</span><span class="main">)</span> <span class="free">gs</span>"</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="main">∈</span> <span class="main">(</span><span class="keyword1">Π<span class="hidden">⇩</span><sub>E</sub></span> <span class="bound">a</span><span class="main">∈</span><span class="free">gs</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">a</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> generate.one <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">𝟭</span> <span class="main">=</span> finprod <span class="free">G</span> <span class="var">?r</span> <span class="free">gs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">intro</span> finprod_one_eqI<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> g<span class="main">:</span> <span class="main">(</span>incl <span class="skolem">g</span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"restrict <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">𝟭</span><span class="main">)</span><span class="main">(</span><span class="skolem">g</span> <span class="main">:=</span> <span class="skolem">g</span><span class="main">)</span><span class="main">)</span> <span class="free">gs</span>"</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="main">∈</span> <span class="main">(</span><span class="keyword1">Π<span class="hidden">⇩</span><sub>E</sub></span> <span class="bound">a</span><span class="main">∈</span><span class="free">gs</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">a</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> generate.one generate.incl<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">g</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">g</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="free">G</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> finprod <span class="free">G</span> <span class="var">?r</span> <span class="free">gs</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finprod <span class="free">G</span> <span class="var">?r</span> <span class="free">gs</span> <span class="main">=</span> <span class="var">?r</span> <span class="skolem">g</span> <span class="main">⊗</span> finprod <span class="free">G</span> <span class="var">?r</span> <span class="main">(</span><span class="free">gs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">g</span><span class="main">}</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> finprod_minus<span class="main"><span class="keyword3">,</span></span> <span class="operator">use</span> assms g <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="skolem">g</span> <span class="main">=</span> <span class="skolem">g</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> g <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finprod <span class="free">G</span> <span class="var">?r</span> <span class="main">(</span><span class="free">gs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">g</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">𝟭</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> finprod_one_eqI<span class="main"><span class="keyword3">;</span></span> <span class="operator">use</span> g <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">simp</span><span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms g <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> g<span class="main">:</span> <span class="main">(</span>inv <span class="skolem">g</span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"restrict <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">𝟭</span><span class="main">)</span><span class="main">(</span><span class="skolem">g</span> <span class="main">:=</span> <span class="keyword1">inv</span> <span class="skolem">g</span><span class="main">)</span><span class="main">)</span> <span class="free">gs</span>"</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="main">∈</span> <span class="main">(</span><span class="keyword1">Π<span class="hidden">⇩</span><sub>E</sub></span> <span class="bound">a</span><span class="main">∈</span><span class="free">gs</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">a</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> generate.one generate.inv<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">g</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">g</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="free">G</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">inv</span> <span class="skolem">g</span> <span class="main">=</span> finprod <span class="free">G</span> <span class="var">?r</span> <span class="free">gs</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finprod <span class="free">G</span> <span class="var">?r</span> <span class="free">gs</span> <span class="main">=</span> <span class="var">?r</span> <span class="skolem">g</span> <span class="main">⊗</span> finprod <span class="free">G</span> <span class="var">?r</span> <span class="main">(</span><span class="free">gs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">g</span><span class="main">}</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> finprod_minus<span class="main"><span class="keyword3">,</span></span> <span class="operator">use</span> assms g <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="skolem">g</span> <span class="main">=</span> <span class="keyword1">inv</span> <span class="skolem">g</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> g <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finprod <span class="free">G</span> <span class="var">?r</span> <span class="main">(</span><span class="free">gs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">g</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">𝟭</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> finprod_one_eqI<span class="main"><span class="keyword3">;</span></span> <span class="operator">use</span> g <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">simp</span><span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms g <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> gh<span class="main">:</span> <span class="main">(</span>eng <span class="skolem">g</span> <span class="skolem">h</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> gh <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="main">(</span><span class="keyword1">Π<span class="hidden">⇩</span><sub>E</sub></span> <span class="bound">a</span><span class="main">∈</span><span class="free">gs</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">a</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> finprod <span class="free">G</span> <span class="skolem">i</span> <span class="free">gs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> gh <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">∈</span> <span class="main">(</span><span class="keyword1">Π<span class="hidden">⇩</span><sub>E</sub></span> <span class="bound">a</span><span class="main">∈</span><span class="free">gs</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">a</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">=</span> finprod <span class="free">G</span> <span class="skolem">j</span> <span class="free">gs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> i j <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">⊗</span> <span class="skolem">h</span> <span class="main">=</span> finprod <span class="free">G</span> <span class="skolem">i</span> <span class="free">gs</span> <span class="main">⊗</span> finprod <span class="free">G</span> <span class="skolem">j</span> <span class="free">gs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> finprod <span class="free">G</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="skolem">i</span> <span class="bound">a</span> <span class="main">⊗</span> <span class="skolem">j</span> <span class="bound">a</span><span class="main">)</span> <span class="free">gs</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> finprod_multf<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">rule</span><span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
        <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">gs</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="skolem">x</span> <span class="main">∈</span> generate <span class="free">G</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="skolem">x</span> <span class="main">∈</span> generate <span class="free">G</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span>"</span></span><span class="keyword1"><span class="command">using</span></span> i<span class="main">(</span>1<span class="main">)</span> j<span class="main">(</span>1<span class="main">)</span> x <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="skolem">x</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="skolem">x</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> generate_incl<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">x</span><span class="main">}</span>"</span></span><span class="main">]</span> x assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> finprod <span class="free">G</span> <span class="main">(</span>restrict <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="skolem">i</span> <span class="bound">a</span> <span class="main">⊗</span> <span class="skolem">j</span> <span class="bound">a</span><span class="main">)</span> <span class="free">gs</span><span class="main">)</span> <span class="free">gs</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> finprod_cong<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> ip<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="skolem">g</span> <span class="main">∈</span> generate <span class="free">G</span> <span class="main">{</span><span class="skolem">g</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="free">gs</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">g</span> <span class="keyword1"><span class="command">using</span></span> i that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> jp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="skolem">g</span> <span class="main">∈</span> generate <span class="free">G</span> <span class="main">{</span><span class="skolem">g</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="free">gs</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">g</span> <span class="keyword1"><span class="command">using</span></span> j that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="skolem">g</span> <span class="main">⊗</span> <span class="skolem">j</span> <span class="skolem">g</span> <span class="main">∈</span> generate <span class="free">G</span> <span class="main">{</span><span class="skolem">g</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="free">gs</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">g</span>
          <span class="keyword1"><span class="command">using</span></span> generate.eng<span class="main">[</span><span class="operator">OF</span> ip<span class="main"><span class="main">[</span></span><span class="operator">OF</span> that<span class="main"><span class="main">]</span></span> jp<span class="main"><span class="main">[</span></span><span class="operator">OF</span> that<span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="skolem">i</span> <span class="bound">a</span> <span class="main">⊗</span> <span class="skolem">j</span> <span class="bound">a</span><span class="main">)</span> <span class="main">∈</span> <span class="free">gs</span> <span class="main">→</span> carrier <span class="free">G</span><span class="main">)</span> <span class="main">=</span> True"</span></span> <span class="keyword1"><span class="command">using</span></span> generate_incl assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">⊗</span> <span class="skolem">h</span> <span class="main">=</span> finprod <span class="free">G</span> <span class="main">(</span>restrict <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="skolem">i</span> <span class="bound">a</span> <span class="main">⊗</span> <span class="skolem">j</span> <span class="bound">a</span><span class="main">)</span> <span class="free">gs</span><span class="main">)</span> <span class="free">gs</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>restrict <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="skolem">i</span> <span class="bound">a</span> <span class="main">⊗</span> <span class="skolem">j</span> <span class="bound">a</span><span class="main">)</span> <span class="free">gs</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="keyword1">Π<span class="hidden">⇩</span><sub>E</sub></span> <span class="bound">a</span><span class="main">∈</span><span class="free">gs</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">a</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> ip<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="skolem">g</span> <span class="main">∈</span> generate <span class="free">G</span> <span class="main">{</span><span class="skolem">g</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="free">gs</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">g</span> <span class="keyword1"><span class="command">using</span></span> i that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> jp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="skolem">g</span> <span class="main">∈</span> generate <span class="free">G</span> <span class="main">{</span><span class="skolem">g</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="free">gs</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">g</span> <span class="keyword1"><span class="command">using</span></span> j that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="skolem">g</span> <span class="main">⊗</span> <span class="skolem">j</span> <span class="skolem">g</span> <span class="main">∈</span> generate <span class="free">G</span> <span class="main">{</span><span class="skolem">g</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="free">gs</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">g</span>
          <span class="keyword1"><span class="command">using</span></span> generate.eng<span class="main">[</span><span class="operator">OF</span> ip<span class="main"><span class="main">[</span></span><span class="operator">OF</span> that<span class="main"><span class="main">]</span></span> jp<span class="main"><span class="main">[</span></span><span class="operator">OF</span> that<span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> i j <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?fp</span> <span class="main">⊆</span> <span class="var">?g</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="var">?fp</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="main">(</span>Pi<span class="hidden">⇩</span><sub>E</sub> <span class="free">gs</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">a</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> finprod <span class="free">G</span> <span class="skolem">f</span> <span class="free">gs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> sg<span class="main">:</span> <span class="quoted"><span class="quoted">"subgroup <span class="var">?g</span> <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">intro</span> generate_is_subgroup<span class="main"><span class="keyword3">,</span></span> <span class="operator">fact</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finprod <span class="free">G</span> <span class="skolem">f</span> <span class="free">gs</span> <span class="main">∈</span> <span class="var">?g</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> finprod_closed_subgroup<span class="main"><span class="main">[</span></span><span class="operator">OF</span> sg<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">g</span> <span class="main">∈</span> generate <span class="free">G</span> <span class="free">gs</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="free">gs</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">g</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">g</span> <span class="main">∈</span> generate <span class="free">G</span> <span class="main">{</span><span class="skolem">g</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f<span class="main">(</span>1<span class="main">)</span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"generate <span class="free">G</span> <span class="main">{</span><span class="skolem">g</span><span class="main">}</span> <span class="main">⊆</span> generate <span class="free">G</span> <span class="free">gs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">intro</span> mono_generate<span class="main"><span class="keyword3">,</span></span> <span class="operator">use</span> that <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">simp</span><span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="free">gs</span> <span class="main">→</span> generate <span class="free">G</span> <span class="free">gs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="var">?g</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> comm_group<span class="main">)</span> generate_eq_finprod_Pi_image<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">gs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">gs</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"generate <span class="free">G</span> <span class="free">gs</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> finprod <span class="free">G</span> <span class="bound">x</span> <span class="free">gs</span><span class="main">)</span> <span class="main">`</span> Pi <span class="free">gs</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">a</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?g</span> <span class="main">=</span> <span class="var">?fp</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> finprod <span class="free">G</span> <span class="bound">x</span> <span class="free">gs</span><span class="main">)</span> <span class="main">`</span> Pi<span class="hidden">⇩</span><sub>E</sub> <span class="free">gs</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">a</span><span class="main">}</span><span class="main">)</span>
      <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> finprod <span class="free">G</span> <span class="bound">x</span> <span class="free">gs</span><span class="main">)</span> <span class="main">`</span> Pi <span class="free">gs</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">a</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Pi<span class="hidden">⇩</span><sub>E</sub> <span class="free">gs</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">a</span><span class="main">}</span><span class="main">)</span> <span class="main">⊆</span> Pi <span class="free">gs</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">a</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> finprod <span class="free">G</span> <span class="bound">x</span> <span class="free">gs</span><span class="main">)</span> <span class="main">`</span> Pi<span class="hidden">⇩</span><sub>E</sub> <span class="free">gs</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">a</span><span class="main">}</span><span class="main">)</span>
        <span class="main">⊆</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> finprod <span class="free">G</span> <span class="bound">x</span> <span class="free">gs</span><span class="main">)</span> <span class="main">`</span> Pi <span class="free">gs</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">a</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> finprod <span class="free">G</span> <span class="bound">x</span> <span class="free">gs</span><span class="main">)</span> <span class="main">`</span> Pi <span class="free">gs</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">a</span><span class="main">}</span><span class="main">)</span>
        <span class="main">⊆</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> finprod <span class="free">G</span> <span class="bound">x</span> <span class="free">gs</span><span class="main">)</span> <span class="main">`</span> Pi<span class="hidden">⇩</span><sub>E</sub> <span class="free">gs</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">a</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
      <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> finprod <span class="free">G</span> <span class="bound">x</span> <span class="free">gs</span><span class="main">)</span> <span class="main">`</span> Pi <span class="free">gs</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">a</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> finprod <span class="free">G</span> <span class="skolem">f</span> <span class="free">gs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> Pi <span class="free">gs</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">a</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finprod <span class="free">G</span> <span class="skolem">f</span> <span class="free">gs</span> <span class="main">=</span> finprod <span class="free">G</span> <span class="main">(</span>restrict <span class="skolem">f</span> <span class="free">gs</span><span class="main">)</span> <span class="free">gs</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> finprod_cong<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">g</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="free">gs</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">g</span>
          <span class="keyword1"><span class="command">using</span></span> that f<span class="main">(</span>2<span class="main">)</span> mono_generate<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">g</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="free">gs</span></span><span class="main">]</span> generate_incl<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span> <span class="main">∈</span> <span class="free">gs</span> <span class="main">→</span> carrier <span class="free">G</span><span class="main">)</span> <span class="main">=</span> True"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>        
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"restrict <span class="skolem">f</span> <span class="free">gs</span> <span class="main">∈</span> Pi<span class="hidden">⇩</span><sub>E</sub> <span class="free">gs</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">a</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> finprod <span class="free">G</span> <span class="bound">x</span> <span class="free">gs</span><span class="main">)</span> <span class="main">`</span> Pi<span class="hidden">⇩</span><sub>E</sub> <span class="free">gs</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">a</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> generate_eq_finprod_PiE_image<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> comm_group<span class="main">)</span> generate_eq_finprod_Pi_int_image<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">gs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">gs</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"generate <span class="free">G</span> <span class="free">gs</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> finprod <span class="free">G</span> <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> <span class="bound">g</span> <span class="main">[^]</span> <span class="bound">x</span> <span class="bound">g</span><span class="main">)</span> <span class="free">gs</span><span class="main">)</span> <span class="main">`</span> Pi <span class="free">gs</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">(</span>UNIV<span class="main">::</span>int set<span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> generate_eq_finprod_Pi_image<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"generate <span class="free">G</span> <span class="free">gs</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> finprod <span class="free">G</span> <span class="bound">x</span> <span class="free">gs</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span><span class="keyword1">Π</span> <span class="bound">a</span><span class="main">∈</span><span class="free">gs</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">a</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> finprod <span class="free">G</span> <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> <span class="bound">g</span> <span class="main">[^]</span> <span class="bound">x</span> <span class="bound">g</span><span class="main">)</span> <span class="free">gs</span><span class="main">)</span> <span class="main">`</span> Pi <span class="free">gs</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">(</span>UNIV<span class="main">::</span>int set<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">rule</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> finprod <span class="free">G</span> <span class="bound">x</span> <span class="free">gs</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span><span class="keyword1">Π</span> <span class="bound">a</span><span class="main">∈</span><span class="free">gs</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">a</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="main">(</span><span class="keyword1">Π</span> <span class="bound">a</span><span class="main">∈</span><span class="free">gs</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">a</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> finprod <span class="free">G</span> <span class="skolem">f</span> <span class="free">gs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">k</span><span class="main">::</span>int<span class="main">.</span> <span class="skolem">f</span> <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">[^]</span> <span class="bound">k</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">gs</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span> <span class="keyword1"><span class="command">using</span></span> generate_pow<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">a</span></span><span class="main">]</span> that assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="main">(</span><span class="bound">h</span><span class="main">::</span><span class="tfree">'a</span> <span class="main">⇒</span> int<span class="main">)</span><span class="main">.</span> <span class="main">∀</span><span class="bound">a</span><span class="main">∈</span><span class="free">gs</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">a</span> <span class="main">=</span> <span class="bound">a</span> <span class="main">[^]</span> <span class="bound">h</span> <span class="bound">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="keyword2"><span class="keyword">where</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">∈</span><span class="free">gs</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">a</span> <span class="main">=</span> <span class="bound">a</span> <span class="main">[^]</span> <span class="skolem">h</span> <span class="bound">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> <span class="free">gs</span> <span class="main">→</span> <span class="main">(</span>UNIV <span class="main">::</span> int set<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finprod <span class="free">G</span> <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> <span class="bound">g</span> <span class="main">[^]</span> <span class="skolem">h</span> <span class="bound">g</span><span class="main">)</span> <span class="free">gs</span> <span class="main">=</span> finprod <span class="free">G</span> <span class="skolem">f</span> <span class="free">gs</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> finprod_cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">use</span> int_pow_closed h assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> f <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> finprod <span class="free">G</span> <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> <span class="bound">g</span> <span class="main">[^]</span> <span class="skolem">h</span> <span class="bound">g</span><span class="main">)</span> <span class="free">gs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
    <span class="keyword1"><span class="command">with</span></span> h<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> finprod <span class="free">G</span> <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> <span class="bound">g</span> <span class="main">[^]</span> <span class="bound">x</span> <span class="bound">g</span><span class="main">)</span> <span class="free">gs</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span><span class="free">gs</span> <span class="main">→</span> <span class="main">(</span>UNIV<span class="main">::</span>int set<span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> finprod <span class="free">G</span> <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> <span class="bound">g</span> <span class="main">[^]</span> <span class="bound">x</span> <span class="bound">g</span><span class="main">)</span> <span class="free">gs</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span><span class="free">gs</span> <span class="main">→</span> <span class="main">(</span>UNIV<span class="main">::</span>int set<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="keyword2"><span class="keyword">where</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> finprod <span class="free">G</span> <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> <span class="bound">g</span> <span class="main">[^]</span> <span class="skolem">h</span> <span class="bound">g</span><span class="main">)</span> <span class="free">gs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> <span class="free">gs</span> <span class="main">→</span> <span class="main">(</span>UNIV <span class="main">::</span> int set<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">k</span><span class="main">∈</span>generate <span class="free">G</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span><span class="main">.</span> <span class="skolem">a</span> <span class="main">[^]</span> <span class="skolem">h</span> <span class="skolem">a</span> <span class="main">=</span> <span class="bound">k</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">gs</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span>
      <span class="keyword1"><span class="command">using</span></span> generate_pow<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">a</span></span><span class="main">]</span> that assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">∈</span><span class="free">gs</span><span class="main">.</span> <span class="bound">a</span> <span class="main">[^]</span> <span class="skolem">h</span> <span class="bound">a</span> <span class="main">=</span> <span class="skolem">f</span> <span class="bound">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="main">(</span><span class="keyword1">Π</span> <span class="bound">a</span><span class="main">∈</span><span class="free">gs</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">a</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finprod <span class="free">G</span> <span class="skolem">f</span> <span class="free">gs</span> <span class="main">=</span> finprod <span class="free">G</span> <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> <span class="bound">g</span> <span class="main">[^]</span> <span class="skolem">h</span> <span class="bound">g</span><span class="main">)</span> <span class="free">gs</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> finprod_cong<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">a</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">gs</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span>
        <span class="keyword1"><span class="command">using</span></span> generate_incl<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">a</span><span class="main">}</span>"</span></span><span class="main">]</span> assms<span class="main">(</span>2<span class="main">)</span> that f<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span> <span class="main">∈</span> <span class="free">gs</span> <span class="main">→</span> carrier <span class="free">G</span><span class="main">)</span> <span class="main">=</span> True"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> f <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> h <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> finprod <span class="free">G</span> <span class="skolem">f</span> <span class="free">gs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
    <span class="keyword1"><span class="command">with</span></span> f<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> finprod <span class="free">G</span> <span class="bound">x</span> <span class="free">gs</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span><span class="keyword1">Π</span> <span class="bound">a</span><span class="main">∈</span><span class="free">gs</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">a</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> comm_group<span class="main">)</span> IDirProds_eq_finprod_PiE<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">⟹</span> subgroup <span class="main">(</span><span class="free">S</span> <span class="bound">i</span><span class="main">)</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"IDirProds <span class="free">G</span> <span class="free">S</span> <span class="free">I</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> finprod <span class="free">G</span> <span class="bound">x</span> <span class="free">I</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span>Pi<span class="hidden">⇩</span><sub>E</sub> <span class="free">I</span> <span class="free">S</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?DP</span> <span class="main">=</span> <span class="var">?fp</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?fp</span> <span class="main">⊆</span> <span class="var">?DP</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="var">?fp</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="main">(</span>Pi<span class="hidden">⇩</span><sub>E</sub> <span class="free">I</span> <span class="free">S</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> finprod <span class="free">G</span> <span class="skolem">f</span> <span class="free">I</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> sDP<span class="main">:</span> <span class="quoted"><span class="quoted">"subgroup <span class="var">?DP</span> <span class="free">G</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> IDirProds_is_subgroup<span class="main"><span class="keyword3">;</span></span> <span class="operator">use</span> subgroup.subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">blast</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finprod <span class="free">G</span> <span class="skolem">f</span> <span class="free">I</span> <span class="main">∈</span> <span class="var">?DP</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> finprod_closed_subgroup<span class="main"><span class="main">[</span></span><span class="operator">OF</span> sDP<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">i</span> <span class="main">∈</span> IDirProds <span class="free">G</span> <span class="free">S</span> <span class="free">I</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">i</span> <span class="main">∈</span> <span class="main">(</span><span class="free">S</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f<span class="main">(</span>1<span class="main">)</span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">S</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">⊆</span> IDirProds <span class="free">G</span> <span class="free">S</span> <span class="free">I</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> IDirProds_incl<span class="main"><span class="main">[</span></span><span class="operator">OF</span> that<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">→</span> IDirProds <span class="free">G</span> <span class="free">S</span> <span class="free">I</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="var">?DP</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?DP</span> <span class="main">⊆</span> <span class="var">?fp</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">unfold</span> IDirProds_def<span class="main"><span class="keyword3">;</span></span> <span class="operator">rule</span> subsetI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> generate <span class="free">G</span> <span class="main">(</span><span class="main">⋃</span><span class="main">(</span><span class="free">S</span> <span class="main">`</span> <span class="free">I</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="var">?fp</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> generate.induct<span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> one
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">I</span> <span class="keyword1">then</span> <span class="main">𝟭</span> <span class="keyword1">else</span> undefined<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> Pi<span class="hidden">⇩</span><sub>E</sub> <span class="free">I</span> <span class="free">S</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> subgroup.one_closed<span class="main">[</span><span class="operator">OF</span> one<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finprod <span class="free">G</span> <span class="skolem">g</span> <span class="free">I</span> <span class="main">=</span> <span class="main">𝟭</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> finprod_one_eqI<span class="main"><span class="keyword3">;</span></span> <span class="operator">use</span> g <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> image_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">metis</span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> i<span class="main">:</span> <span class="main">(</span>incl <span class="skolem">h</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> i <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> <span class="main">(</span><span class="free">S</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">hf</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">hf</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">I</span> <span class="keyword1">then</span> <span class="main">𝟭</span> <span class="keyword1">else</span> undefined<span class="main">)</span><span class="main">)</span><span class="main">(</span><span class="skolem">j</span> <span class="main">:=</span> <span class="skolem">h</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> j <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">hf</span> <span class="main">∈</span> Pi<span class="hidden">⇩</span><sub>E</sub> <span class="free">I</span> <span class="free">S</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> subgroup.one_closed<span class="main">[</span><span class="operator">OF</span> i<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finprod <span class="free">G</span> <span class="skolem">hf</span> <span class="free">I</span> <span class="main">=</span> <span class="skolem">h</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finprod <span class="free">G</span> <span class="skolem">hf</span> <span class="free">I</span> <span class="main">=</span> <span class="skolem">hf</span> <span class="skolem">j</span> <span class="main">⊗</span> finprod <span class="free">G</span> <span class="skolem">hf</span> <span class="main">(</span><span class="free">I</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">j</span><span class="main">}</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> finprod_minus<span class="main"><span class="keyword3">,</span></span> <span class="operator">use</span> assms hf_def subgroup.subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> i<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> j<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span> j <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">hf</span> <span class="skolem">j</span> <span class="main">=</span> <span class="skolem">h</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hf_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finprod <span class="free">G</span> <span class="skolem">hf</span> <span class="main">(</span><span class="free">I</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">j</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">𝟭</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finprod_one_eqI<span class="main"><span class="keyword3">;</span></span> <span class="operator">use</span> hf_def <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">simp</span><span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> subgroup.subset<span class="main">[</span><span class="operator">OF</span> i<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> j<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span> j<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> image_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">metis</span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> i<span class="main">:</span> <span class="main">(</span>inv <span class="skolem">h</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> i <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> <span class="main">(</span><span class="free">S</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> ih<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">inv</span> <span class="skolem">h</span> <span class="main">∈</span> <span class="main">(</span><span class="free">S</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> subgroup.m_inv_closed<span class="main">[</span><span class="operator">OF</span> i<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> j<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span> j<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">hf</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">hf</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">I</span> <span class="keyword1">then</span> <span class="main">𝟭</span> <span class="keyword1">else</span> undefined<span class="main">)</span><span class="main">)</span><span class="main">(</span><span class="skolem">j</span> <span class="main">:=</span> <span class="keyword1">inv</span> <span class="skolem">h</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> j ih <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">hf</span> <span class="main">∈</span> Pi<span class="hidden">⇩</span><sub>E</sub> <span class="free">I</span> <span class="free">S</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> subgroup.one_closed<span class="main">[</span><span class="operator">OF</span> i<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finprod <span class="free">G</span> <span class="skolem">hf</span> <span class="free">I</span> <span class="main">=</span> <span class="keyword1">inv</span> <span class="skolem">h</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finprod <span class="free">G</span> <span class="skolem">hf</span> <span class="free">I</span> <span class="main">=</span> <span class="skolem">hf</span> <span class="skolem">j</span> <span class="main">⊗</span> finprod <span class="free">G</span> <span class="skolem">hf</span> <span class="main">(</span><span class="free">I</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">j</span><span class="main">}</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> finprod_minus<span class="main"><span class="keyword3">,</span></span> <span class="operator">use</span> assms hf_def subgroup.subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> i<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> j<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span> j <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">hf</span> <span class="skolem">j</span> <span class="main">=</span> <span class="keyword1">inv</span> <span class="skolem">h</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hf_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finprod <span class="free">G</span> <span class="skolem">hf</span> <span class="main">(</span><span class="free">I</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">j</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">𝟭</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finprod_one_eqI<span class="main"><span class="keyword3">;</span></span> <span class="operator">use</span> hf_def <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">simp</span><span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> subgroup.subset<span class="main">[</span><span class="operator">OF</span> i<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> j<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span> j<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> image_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">metis</span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> e<span class="main">:</span> <span class="main">(</span>eng <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> e <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> Pi<span class="hidden">⇩</span><sub>E</sub> <span class="free">I</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> finprod <span class="free">G</span> <span class="skolem">f</span> <span class="free">I</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> e <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> Pi<span class="hidden">⇩</span><sub>E</sub> <span class="free">I</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> finprod <span class="free">G</span> <span class="skolem">g</span> <span class="free">I</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> f g <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">⊗</span> <span class="skolem">b</span> <span class="main">=</span> finprod <span class="free">G</span> <span class="skolem">f</span> <span class="free">I</span> <span class="main">⊗</span> finprod <span class="free">G</span> <span class="skolem">g</span> <span class="free">I</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> finprod <span class="free">G</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">a</span> <span class="main">⊗</span> <span class="skolem">g</span> <span class="bound">a</span><span class="main">)</span> <span class="free">I</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> finprod_multf<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span><span class="main">(</span><span class="free">S</span> <span class="main">`</span> <span class="free">I</span><span class="main">)</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> subgroup.subset<span class="main">[</span><span class="operator">OF</span> e<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">→</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">→</span> carrier <span class="free">G</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> f<span class="main">(</span>1<span class="main">)</span> g<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> PiE_def Pi_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> finprod <span class="free">G</span> <span class="main">(</span>restrict <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">a</span> <span class="main">⊗</span> <span class="skolem">g</span> <span class="bound">a</span><span class="main">)</span> <span class="free">I</span><span class="main">)</span> <span class="free">I</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> finprod_cong<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">=</span> <span class="free">I</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">I</span> <span class="keyword1">=simp=&gt;</span> <span class="skolem">f</span> <span class="bound">i</span> <span class="main">⊗</span> <span class="skolem">g</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">a</span> <span class="main">⊗</span> <span class="skolem">g</span> <span class="bound">a</span><span class="main">)</span> <span class="bound">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> fp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">i</span> <span class="main">∈</span> <span class="main">(</span><span class="free">S</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="keyword1"><span class="command">using</span></span> f that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> gp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="skolem">i</span> <span class="main">∈</span> <span class="main">(</span><span class="free">S</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="keyword1"><span class="command">using</span></span> g that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">i</span> <span class="main">⊗</span> <span class="skolem">g</span> <span class="skolem">i</span> <span class="main">∈</span> <span class="main">(</span><span class="free">S</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
          <span class="keyword1"><span class="command">using</span></span> subgroup.m_closed<span class="main">[</span><span class="operator">OF</span> e<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> that<span class="main"><span class="main">]</span></span> fp<span class="main"><span class="main">[</span></span><span class="operator">OF</span> that<span class="main"><span class="main">]</span></span> gp<span class="main"><span class="main">[</span></span><span class="operator">OF</span> that<span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">a</span> <span class="main">⊗</span> <span class="skolem">g</span> <span class="bound">a</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">→</span> carrier <span class="free">G</span><span class="main">)</span> <span class="main">=</span> True"</span></span> <span class="keyword1"><span class="command">using</span></span> subgroup.subset<span class="main">[</span><span class="operator">OF</span> e<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">⊗</span> <span class="skolem">b</span> <span class="main">=</span> finprod <span class="free">G</span> <span class="main">(</span>restrict <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">a</span> <span class="main">⊗</span> <span class="skolem">g</span> <span class="bound">a</span><span class="main">)</span> <span class="free">I</span><span class="main">)</span> <span class="free">I</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>restrict <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">a</span> <span class="main">⊗</span> <span class="skolem">g</span> <span class="bound">a</span><span class="main">)</span> <span class="free">I</span><span class="main">)</span> <span class="main">∈</span> Pi<span class="hidden">⇩</span><sub>E</sub> <span class="free">I</span> <span class="free">S</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> fp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">i</span> <span class="main">∈</span> <span class="main">(</span><span class="free">S</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="keyword1"><span class="command">using</span></span> f that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> gp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="skolem">i</span> <span class="main">∈</span> <span class="main">(</span><span class="free">S</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="keyword1"><span class="command">using</span></span> g that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">i</span> <span class="main">⊗</span> <span class="skolem">g</span> <span class="skolem">i</span> <span class="main">∈</span> <span class="main">(</span><span class="free">S</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
          <span class="keyword1"><span class="command">using</span></span> subgroup.m_closed<span class="main">[</span><span class="operator">OF</span> e<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> that<span class="main"><span class="main">]</span></span> fp<span class="main"><span class="main">[</span></span><span class="operator">OF</span> that<span class="main"><span class="main">]</span></span> gp<span class="main"><span class="main">[</span></span><span class="operator">OF</span> that<span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> f g <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> comm_group<span class="main">)</span> IDirProds_eq_finprod_Pi<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">⟹</span> subgroup <span class="main">(</span><span class="free">S</span> <span class="bound">i</span><span class="main">)</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"IDirProds <span class="free">G</span> <span class="free">S</span> <span class="free">I</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> finprod <span class="free">G</span> <span class="bound">x</span> <span class="free">I</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span>Pi <span class="free">I</span> <span class="free">S</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?DP</span> <span class="main">=</span> <span class="var">?fp</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> finprod <span class="free">G</span> <span class="bound">x</span> <span class="free">I</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span>Pi <span class="free">I</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> finprod <span class="free">G</span> <span class="bound">x</span> <span class="free">I</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span>Pi<span class="hidden">⇩</span><sub>E</sub> <span class="free">I</span> <span class="free">S</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Pi<span class="hidden">⇩</span><sub>E</sub> <span class="free">I</span> <span class="free">S</span> <span class="main">⊆</span> Pi <span class="free">I</span> <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> finprod <span class="free">G</span> <span class="bound">x</span> <span class="free">I</span><span class="main">)</span> <span class="main">`</span> Pi<span class="hidden">⇩</span><sub>E</sub> <span class="free">I</span> <span class="free">S</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> finprod <span class="free">G</span> <span class="bound">x</span> <span class="free">I</span><span class="main">)</span> <span class="main">`</span> Pi <span class="free">I</span> <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> finprod <span class="free">G</span> <span class="bound">x</span> <span class="free">I</span><span class="main">)</span> <span class="main">`</span> Pi <span class="free">I</span> <span class="free">S</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> finprod <span class="free">G</span> <span class="bound">x</span> <span class="free">I</span><span class="main">)</span> <span class="main">`</span> Pi<span class="hidden">⇩</span><sub>E</sub> <span class="free">I</span> <span class="free">S</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
      <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> finprod <span class="free">G</span> <span class="bound">x</span> <span class="free">I</span><span class="main">)</span> <span class="main">`</span> Pi <span class="free">I</span> <span class="free">S</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> finprod <span class="free">G</span> <span class="skolem">f</span> <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> Pi <span class="free">I</span> <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finprod <span class="free">G</span> <span class="skolem">f</span> <span class="free">I</span> <span class="main">=</span> finprod <span class="free">G</span> <span class="main">(</span>restrict <span class="skolem">f</span> <span class="free">I</span><span class="main">)</span> <span class="free">I</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> finprod_cong<span class="main"><span class="keyword3">;</span></span> <span class="operator">use</span> f<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> subgroup.subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">fastforce</span><span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"restrict <span class="skolem">f</span> <span class="free">I</span> <span class="main">∈</span> Pi<span class="hidden">⇩</span><sub>E</sub> <span class="free">I</span> <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> finprod <span class="free">G</span> <span class="bound">x</span> <span class="free">I</span><span class="main">)</span> <span class="main">`</span> Pi<span class="hidden">⇩</span><sub>E</sub> <span class="free">I</span> <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> IDirProds_eq_finprod_PiE<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹If we switch one element from a set of generators, the generated set stays the same if both
elements can be generated from the others together with the switched element respectively.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> comm_group<span class="main">)</span> generate_one_switched_exp_eqI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">=</span> <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">→</span> <span class="main">(</span>UNIV<span class="main">::</span>int set<span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> <span class="free">B</span> <span class="main">→</span> <span class="main">(</span>UNIV<span class="main">::</span>int set<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> finprod <span class="free">G</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">[^]</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> finprod <span class="free">G</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">[^]</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"generate <span class="free">G</span> <span class="free">A</span> <span class="main">=</span> generate <span class="free">G</span> <span class="free">B</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> generate_one_switched_eqI<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main"><span class="main">(</span></span></span>1<span class="main"><span class="main"><span class="main">,</span></span></span> 2<span class="main"><span class="main"><span class="main">,</span></span></span> 3<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">hence</span></span> fB<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> cB<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> assms<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> finprod_closed<span class="main"><span class="keyword3">,</span></span> <span class="operator">use</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span> 4<span class="main"><span class="main">)</span></span> int_pow_closed <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">fast</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span> 3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> generate <span class="free">G</span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">subst</span> generate_eq_finprod_Pi_image<span class="main"><span class="main">[</span></span><span class="operator">OF</span> fB cB<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> finprod <span class="free">G</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">[^]</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">[^]</span> <span class="free">g</span> <span class="skolem">x</span> <span class="main">∈</span> generate <span class="free">G</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="keyword1"><span class="command">using</span></span> generate_pow<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> cB that <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">[^]</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="keyword1">Π</span> <span class="bound">a</span><span class="main">∈</span><span class="free">B</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">a</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Pi_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> generate <span class="free">G</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">subst</span> generate_eq_finprod_Pi_image<span class="main"><span class="main">[</span></span><span class="operator">OF</span> True assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> finprod <span class="free">G</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">[^]</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">[^]</span> <span class="free">f</span> <span class="skolem">x</span> <span class="main">∈</span> generate <span class="free">G</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
      <span class="keyword1"><span class="command">using</span></span> generate_pow<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> assms<span class="main">(</span>1<span class="main">)</span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">[^]</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="keyword1">Π</span> <span class="bound">a</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">a</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Pi_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">hence</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> <span class="main">𝟭</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>7<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> finprod_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> False assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"infinite <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="main">𝟭</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>6<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> finprod_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> generate <span class="free">G</span> <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> generate.one a <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> generate <span class="free">G</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> generate.one b <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We can characterize a complementary family of subgroups when the only way to form the neutral
element as a product of picked elements from each subgroup is to pick the neutral element from each
subgroup.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> comm_group<span class="main">)</span> compl_fam_imp_triv_finprod<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"compl_fam <span class="free">S</span> <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">⟹</span> subgroup <span class="main">(</span><span class="free">S</span> <span class="bound">i</span><span class="main">)</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finprod <span class="free">G</span> <span class="free">f</span> <span class="free">I</span> <span class="main">=</span> <span class="main">𝟭</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> Pi <span class="free">I</span> <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">𝟭</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main"><span class="keyword3">;</span></span> <span class="operator">clarify</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">i</span> <span class="main">∈</span> <span class="main">(</span><span class="free">S</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
  <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> si<span class="main">:</span> <span class="quoted"><span class="quoted">"subgroup <span class="main">(</span><span class="free">S</span> <span class="skolem">i</span><span class="main">)</span> <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> i<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">consider</span></span> <span class="main">(</span>triv<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">S</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">𝟭</span><span class="main">}</span>"</span></span> <span class="main">|</span> <span class="main">(</span>not_triv<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">S</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{</span><span class="main">𝟭</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">𝟭</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> triv
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> f<span class="main">[</span><span class="operator">OF</span> i<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> not_triv
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> fc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">i</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f<span class="main">[</span><span class="operator">OF</span> i<span class="main">]</span> subgroup.subset<span class="main">[</span><span class="operator">OF</span> si<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">assume</span></span> no<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">i</span> <span class="main">≠</span> <span class="main">𝟭</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> fH<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">i</span> <span class="main">∈</span> <span class="main">(</span><span class="free">S</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f<span class="main">[</span><span class="operator">OF</span> i<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">from</span></span> subgroup.m_inv_closed<span class="main">[</span><span class="operator">OF</span> si this<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> ifi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">inv</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free">S</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">inv</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">≠</span> <span class="main">𝟭</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> no fc <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">inv</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> finprod <span class="free">G</span> <span class="free">f</span> <span class="main">(</span><span class="free">I</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">i</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">𝟭</span> <span class="main">=</span> finprod <span class="free">G</span> <span class="free">f</span> <span class="free">I</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> finprod <span class="free">G</span> <span class="free">f</span> <span class="main">(</span>insert <span class="skolem">i</span> <span class="main">(</span><span class="free">I</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">i</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">=</span> insert <span class="skolem">i</span> <span class="main">(</span><span class="free">I</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">i</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">i</span> <span class="main">⊗</span> finprod <span class="free">G</span> <span class="free">f</span> <span class="main">(</span><span class="free">I</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">i</span><span class="main">}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> finprod_insert<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="free">I</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">i</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∉</span> <span class="free">I</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">i</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">i</span><span class="main">}</span> <span class="main">→</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> f subgroup.subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">i</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> o<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">𝟭</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">i</span> <span class="main">⊗</span> finprod <span class="free">G</span> <span class="free">f</span> <span class="main">(</span><span class="free">I</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">i</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> inv_equality<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">i</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finprod <span class="free">G</span> <span class="free">f</span> <span class="main">(</span><span class="free">I</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">i</span><span class="main">}</span><span class="main">)</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> finprod_closed<span class="main"><span class="keyword3">;</span></span> <span class="operator">use</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> f subgroup.subset <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">blast</span><span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> m_comm<span class="main">[</span><span class="operator">OF</span> this fc<span class="main">]</span> o <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finprod <span class="free">G</span> <span class="free">f</span> <span class="main">(</span><span class="free">I</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">i</span><span class="main">}</span><span class="main">)</span> <span class="main">⊗</span> <span class="free">f</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">𝟭</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finprod <span class="free">G</span> <span class="free">f</span> <span class="main">(</span><span class="free">I</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">i</span><span class="main">}</span><span class="main">)</span> <span class="main">∈</span> IDirProds <span class="free">G</span> <span class="free">S</span> <span class="main">(</span><span class="free">I</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">i</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> finprod_closed_subgroup IDirProds_is_subgroup<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span> <span class="main">(</span><span class="free">S</span> <span class="main">`</span> <span class="main">(</span><span class="free">I</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">i</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> subgroup.subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">j</span> <span class="main">∈</span> <span class="main">(</span>IDirProds <span class="free">G</span> <span class="free">S</span> <span class="main">(</span><span class="free">I</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">i</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">∈</span> <span class="main">(</span><span class="free">I</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">i</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">j</span>
          <span class="keyword1"><span class="command">using</span></span> IDirProds_incl<span class="main">[</span><span class="operator">OF</span> that<span class="main">]</span> f that <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">i</span><span class="main">}</span> <span class="main">→</span> IDirProds <span class="free">G</span> <span class="free">S</span> <span class="main">(</span><span class="free">I</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">i</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>complementary <span class="main">(</span><span class="free">S</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span>IDirProds <span class="free">G</span> <span class="free">S</span> <span class="main">(</span><span class="free">I</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">i</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> complementary_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> i <span class="keyword1"><span class="command">unfolding</span></span> compl_fam_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> comm_group<span class="main">)</span> triv_finprod_imp_compl_fam<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">⟹</span> subgroup <span class="main">(</span><span class="free">S</span> <span class="bound">i</span><span class="main">)</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">f</span> <span class="main">∈</span> Pi <span class="free">I</span> <span class="free">S</span><span class="main">.</span> finprod <span class="free">G</span> <span class="bound">f</span> <span class="free">I</span> <span class="main">=</span> <span class="main">𝟭</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">𝟭</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"compl_fam <span class="free">S</span> <span class="free">I</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> compl_fam_def<span class="main"><span class="keyword3">;</span></span> <span class="operator">rule</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span>
  <span class="keyword3"><span class="command">assume</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?DP</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"IDirProds <span class="free">G</span> <span class="free">S</span> <span class="main">(</span><span class="free">I</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">k</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"complementary <span class="main">(</span><span class="free">S</span> <span class="skolem">k</span><span class="main">)</span> <span class="var">?DP</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main"><span class="keyword3">;</span></span> <span class="operator">unfold</span> complementary_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> sk<span class="main">:</span> <span class="quoted"><span class="quoted">"subgroup <span class="main">(</span><span class="free">S</span> <span class="skolem">k</span><span class="main">)</span> <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> k<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">have</span></span> sDP<span class="main">:</span> <span class="quoted"><span class="quoted">"subgroup <span class="var">?DP</span> <span class="free">G</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> IDirProds_is_subgroup<span class="main"><span class="keyword3">;</span></span> <span class="operator">use</span> subgroup.subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">blast</span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">S</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">∩</span> IDirProds <span class="free">G</span> <span class="free">S</span> <span class="main">(</span><span class="free">I</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">k</span><span class="main">}</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{</span><span class="main">𝟭</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span><span class="free">S</span> <span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> IDirProds <span class="free">G</span> <span class="free">S</span> <span class="main">(</span><span class="free">I</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">k</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="main">𝟭</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> subgroup.one_closed sk sDP <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> finprod <span class="free">G</span> <span class="bound">x</span> <span class="main">(</span><span class="free">I</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">k</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span>Pi <span class="main">(</span><span class="free">I</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">k</span><span class="main">}</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> IDirProds_eq_finprod_Pi<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">I</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">k</span><span class="main">}</span><span class="main">)</span>"</span></span><span class="main">]</span> assms<span class="main">(</span>1<span class="main">,</span> 2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ht</span></span> <span class="keyword2"><span class="keyword">where</span></span> ht<span class="main">:</span> <span class="quoted"><span class="quoted">"finprod <span class="free">G</span> <span class="skolem">ht</span> <span class="main">(</span><span class="free">I</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">k</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ht</span> <span class="main">∈</span> Pi <span class="main">(</span><span class="free">I</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">k</span><span class="main">}</span><span class="main">)</span> <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="keyword2"><span class="keyword">where</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">ht</span><span class="main">(</span><span class="skolem">k</span> <span class="main">:=</span> <span class="keyword1">inv</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> hPi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> Pi <span class="free">I</span> <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ht subgroup.m_inv_closed<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> k<span class="main"><span class="main">]</span></span> x<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finprod <span class="free">G</span> <span class="skolem">h</span> <span class="main">(</span><span class="free">I</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">k</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> ht<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> finprod_cong<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">k</span><span class="main">}</span> <span class="main">=</span> <span class="free">I</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">k</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">h</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">k</span><span class="main">}</span> <span class="main">→</span> carrier <span class="free">G</span><span class="main">)</span> <span class="main">=</span> True"</span></span> <span class="keyword1"><span class="command">using</span></span> h ht<span class="main">(</span>2<span class="main">)</span> subgroup.subset<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">unfolding</span></span> Pi_def id_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">k</span><span class="main">}</span> <span class="keyword1">=simp=&gt;</span> <span class="skolem">h</span> <span class="bound">i</span> <span class="main">=</span> <span class="skolem">ht</span> <span class="bound">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ht<span class="main">(</span>2<span class="main">)</span> h <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finprod <span class="free">G</span> <span class="skolem">h</span> <span class="free">I</span> <span class="main">=</span> <span class="skolem">h</span> <span class="skolem">k</span> <span class="main">⊗</span> finprod <span class="free">G</span> <span class="skolem">h</span> <span class="main">(</span><span class="free">I</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">k</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> finprod_minus<span class="main"><span class="keyword3">;</span></span> <span class="operator">use</span> k assms hPi subgroup.subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span> Pi_def <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">blast</span><span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finprod <span class="free">G</span> <span class="skolem">h</span> <span class="free">I</span> <span class="main">=</span> <span class="keyword1">inv</span> <span class="skolem">x</span> <span class="main">⊗</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> h <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finprod <span class="free">G</span> <span class="skolem">h</span> <span class="free">I</span> <span class="main">=</span> <span class="main">𝟭</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> subgroup.subset<span class="main">[</span><span class="operator">OF</span> sk<span class="main">]</span> x<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="skolem">k</span> <span class="main">≠</span> <span class="main">𝟭</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> h x<span class="main">(</span>3<span class="main">)</span> subgroup.subset<span class="main">[</span><span class="operator">OF</span> sk<span class="main">]</span> x<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> k hPi <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> comm_group<span class="main">)</span> triv_finprod_iff_compl_fam_Pi<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">⟹</span> subgroup <span class="main">(</span><span class="free">S</span> <span class="bound">i</span><span class="main">)</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"compl_fam <span class="free">S</span> <span class="free">I</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">f</span> <span class="main">∈</span> Pi <span class="free">I</span> <span class="free">S</span><span class="main">.</span> finprod <span class="free">G</span> <span class="bound">f</span> <span class="free">I</span> <span class="main">=</span> <span class="main">𝟭</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">𝟭</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> compl_fam_imp_triv_finprod triv_finprod_imp_compl_fam assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> comm_group<span class="main">)</span> triv_finprod_iff_compl_fam_PiE<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">⟹</span> subgroup <span class="main">(</span><span class="free">S</span> <span class="bound">i</span><span class="main">)</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"compl_fam <span class="free">S</span> <span class="free">I</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">f</span> <span class="main">∈</span> Pi<span class="hidden">⇩</span><sub>E</sub> <span class="free">I</span> <span class="free">S</span><span class="main">.</span> finprod <span class="free">G</span> <span class="bound">f</span> <span class="free">I</span> <span class="main">=</span> <span class="main">𝟭</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">𝟭</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"compl_fam <span class="free">S</span> <span class="free">I</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound">f</span><span class="main">∈</span>Pi<span class="hidden">⇩</span><sub>E</sub> <span class="free">I</span> <span class="free">S</span><span class="main">.</span> finprod <span class="free">G</span> <span class="bound">f</span> <span class="free">I</span> <span class="main">=</span> <span class="main">𝟭</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">𝟭</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> triv_finprod_iff_compl_fam_Pi<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">f</span><span class="main">∈</span>Pi<span class="hidden">⇩</span><sub>E</sub> <span class="free">I</span> <span class="free">S</span><span class="main">.</span> finprod <span class="free">G</span> <span class="bound">f</span> <span class="free">I</span> <span class="main">=</span> <span class="main">𝟭</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">𝟭</span><span class="main">)</span>
    <span class="main">⟹</span> <span class="main">∀</span><span class="bound">f</span><span class="main">∈</span>Pi <span class="free">I</span> <span class="free">S</span><span class="main">.</span> finprod <span class="free">G</span> <span class="bound">f</span> <span class="free">I</span> <span class="main">=</span> <span class="main">𝟭</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">𝟭</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="skolem">i</span>
    <span class="keyword3"><span class="command">assume</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> Pi <span class="free">I</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"finprod <span class="free">G</span> <span class="skolem">f</span> <span class="free">I</span> <span class="main">=</span> <span class="main">𝟭</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> allf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">f</span><span class="main">∈</span>Pi<span class="hidden">⇩</span><sub>E</sub> <span class="free">I</span> <span class="free">S</span><span class="main">.</span> finprod <span class="free">G</span> <span class="bound">f</span> <span class="free">I</span> <span class="main">=</span> <span class="main">𝟭</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">𝟭</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">i</span> <span class="main">=</span> restrict <span class="skolem">f</span> <span class="free">I</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finprod <span class="free">G</span> <span class="main">(</span>restrict <span class="skolem">f</span> <span class="free">I</span><span class="main">)</span> <span class="free">I</span> <span class="main">=</span> finprod <span class="free">G</span> <span class="skolem">f</span> <span class="free">I</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f subgroup.subset<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> Pi_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> finprod_cong<span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"restrict <span class="skolem">f</span> <span class="free">I</span> <span class="main">∈</span> Pi<span class="hidden">⇩</span><sub>E</sub> <span class="free">I</span> <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">𝟭</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> allf f i <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">f</span><span class="main">∈</span>Pi<span class="hidden">⇩</span><sub>E</sub> <span class="free">I</span> <span class="free">S</span><span class="main">.</span> finprod <span class="free">G</span> <span class="bound">f</span> <span class="free">I</span> <span class="main">=</span> <span class="main">𝟭</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">𝟭</span><span class="main">)</span> <span class="main">⟹</span> compl_fam <span class="free">S</span> <span class="free">I</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> triv_finprod_iff_compl_fam_Pi<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The finite product also distributes when nested.›</span></span>

<span class="comment1">(* Manuel Eberl, TODO: move to library *)</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> comm_monoid<span class="main">)</span> finprod_Sigma<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> finite <span class="main">(</span><span class="free">B</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">B</span> <span class="bound">x</span> <span class="main">⟹</span> <span class="free">g</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨂</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="main">⨂</span><span class="bound">y</span><span class="main">∈</span><span class="free">B</span> <span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨂</span><span class="bound">z</span><span class="main">∈</span>Sigma <span class="free">A</span> <span class="free">B</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">z</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">⇒</span> <span class="free">g</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">A</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> finite_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">A</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨂</span><span class="bound">z</span><span class="main">∈</span>Sigma <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">A</span><span class="main">)</span> <span class="free">B</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">z</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">⇒</span> <span class="free">g</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span>
          <span class="main">(</span><span class="main">⨂</span><span class="bound">z</span><span class="main">∈</span>Pair <span class="skolem">x</span> <span class="main">`</span> <span class="free">B</span> <span class="skolem">x</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">z</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">⇒</span> <span class="free">g</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="main">⊗</span> <span class="main">(</span><span class="main">⨂</span><span class="bound">z</span><span class="main">∈</span>Sigma <span class="skolem">A</span> <span class="free">B</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">z</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">⇒</span> <span class="free">g</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Sigma_insert <span class="keyword1"><span class="command">using</span></span> insert.prems insert.hyps
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> finprod_Un_disjoint<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨂</span><span class="bound">z</span><span class="main">∈</span>Sigma <span class="skolem">A</span> <span class="free">B</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">z</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">⇒</span> <span class="free">g</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨂</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">A</span><span class="main">.</span> <span class="main">⨂</span><span class="bound">y</span><span class="main">∈</span><span class="free">B</span> <span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> insert.prems insert.hyps <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> insert.IH <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨂</span><span class="bound">z</span><span class="main">∈</span>Pair <span class="skolem">x</span> <span class="main">`</span> <span class="free">B</span> <span class="skolem">x</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">z</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">⇒</span> <span class="free">g</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨂</span><span class="bound">y</span><span class="main">∈</span><span class="free">B</span> <span class="skolem">x</span><span class="main">.</span> <span class="free">g</span> <span class="skolem">x</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> insert.prems insert.hyps <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> finprod_reindex<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> inj_onI<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> insert.hyps insert.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹With the now proven facts, we are able to provide criterias to inductively construct a
group that is the internal direct product of a set of generators.›</span></span>

<span class="comment1">(* belongs to IDirProd, but uses finprod stuff *)</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> comm_group<span class="main">)</span> idirprod_generate_ind<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">gs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">gs</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span>
          <span class="quoted"><span class="quoted">"is_idirprod <span class="main">(</span>generate <span class="free">G</span> <span class="free">gs</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">g</span><span class="main">}</span><span class="main">)</span> <span class="free">gs</span>"</span></span>
          <span class="quoted"><span class="quoted">"complementary <span class="main">(</span>generate <span class="free">G</span> <span class="main">{</span><span class="free">g</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span>generate <span class="free">G</span> <span class="free">gs</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_idirprod <span class="main">(</span>generate <span class="free">G</span> <span class="main">(</span><span class="free">gs</span> <span class="main">∪</span> <span class="main">{</span><span class="free">g</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">g</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="free">gs</span> <span class="main">∪</span> <span class="main">{</span><span class="free">g</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> <span class="free">gs</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">gs</span> <span class="main">=</span> <span class="main">(</span><span class="free">gs</span> <span class="main">∪</span> <span class="main">{</span><span class="free">g</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> gngs<span class="main">:</span> False
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> is_idirprod_subgroup_suffices<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> gsgc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">gs</span> <span class="main">∪</span> <span class="main">{</span><span class="free">g</span><span class="main">}</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">,</span> 3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"generate <span class="free">G</span> <span class="main">(</span><span class="free">gs</span> <span class="main">∪</span> <span class="main">{</span><span class="free">g</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> IDirProds <span class="free">G</span> <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">g</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="free">gs</span> <span class="main">∪</span> <span class="main">{</span><span class="free">g</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> IDirProds_def <span class="keyword1"><span class="command">using</span></span> generate_idem_Un <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">∈</span><span class="free">gs</span> <span class="main">∪</span> <span class="main">{</span><span class="free">g</span><span class="main">}</span><span class="main">.</span> subgroup <span class="main">(</span>generate <span class="free">G</span> <span class="main">{</span><span class="bound">i</span><span class="main">}</span><span class="main">)</span> <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> generate_is_subgroup gsgc <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> sg<span class="main">:</span> <span class="quoted"><span class="quoted">"subgroup <span class="main">(</span>generate <span class="free">G</span> <span class="main">{</span><span class="free">g</span><span class="main">}</span><span class="main">)</span> <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> generate_is_subgroup<span class="main"><span class="keyword3">,</span></span> <span class="operator">use</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">blast</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>4<span class="main">)</span> is_idirprod_def <span class="keyword1"><span class="command">have</span></span> ih<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">gs</span> <span class="main">⟶</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span> <span class="main">⊲</span> <span class="free">G</span>"</span></span>
                                           <span class="quoted"><span class="quoted">"compl_fam <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">g</span><span class="main">}</span><span class="main">)</span> <span class="free">gs</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">hence</span></span> ca<span class="main">:</span> <span class="quoted"><span class="quoted">"complementary <span class="main">(</span>generate <span class="free">G</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span>generate <span class="free">G</span> <span class="main">(</span><span class="free">gs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">gs</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span>
      <span class="keyword1"><span class="command">unfolding</span></span> compl_fam_def IDirProds_def
      <span class="keyword1"><span class="command">using</span></span> gsgc generate_idem_Un<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">gs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span>"</span></span><span class="main">]</span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">have</span></span> aux<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">gs</span> <span class="main">∪</span> <span class="main">{</span><span class="free">g</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">i</span><span class="main">}</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="keyword1"><span class="command">using</span></span> gsgc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"compl_fam <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">g</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="free">gs</span> <span class="main">∪</span> <span class="main">{</span><span class="free">g</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">unfold</span> compl_fam_def IDirProds_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> generate_idem_Un<span class="main"><span class="main">[</span></span><span class="operator">OF</span> aux<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span>
          <span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">h</span>
      <span class="keyword3"><span class="command">assume</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> <span class="free">gs</span> <span class="main">∪</span> <span class="main">{</span><span class="free">g</span><span class="main">}</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> complementary <span class="main">(</span>generate <span class="free">G</span> <span class="main">{</span><span class="skolem">h</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span>generate <span class="free">G</span> <span class="main">(</span><span class="free">gs</span> <span class="main">∪</span> <span class="main">{</span><span class="free">g</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">h</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">=</span> <span class="free">g</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">with</span></span> c <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> complementary <span class="main">(</span>generate <span class="free">G</span> <span class="main">{</span><span class="free">g</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span>generate <span class="free">G</span> <span class="main">(</span><span class="free">gs</span> <span class="main">-</span> <span class="main">{</span><span class="free">g</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"complementary <span class="main">(</span>generate <span class="free">G</span> <span class="main">{</span><span class="free">g</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span>generate <span class="free">G</span> <span class="main">(</span><span class="free">gs</span> <span class="main">-</span> <span class="main">{</span><span class="free">g</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subgroup_subset_complementary<span class="main"><span class="main">[</span></span><span class="operator">OF</span> generate_is_subgroup generate_is_subgroup<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">gs</span></span></span></span></span></span><span class="main"><span class="main">]</span></span>
                   generate_is_subgroup mono_generate<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">use</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">,</span></span> 3<span class="main"><span class="main">,</span></span> 5<span class="main"><span class="main">)</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> hng<span class="main">:</span> False
        <span class="keyword1"><span class="command">hence</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> <span class="free">gs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">≠</span> <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> h <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">gs</span> <span class="main">∪</span> <span class="main">{</span><span class="free">g</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">h</span><span class="main">}</span> <span class="main">=</span> <span class="free">gs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">h</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="free">g</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">with</span></span> c <span class="keyword1"><span class="command">have</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> complementary <span class="main">(</span>generate <span class="free">G</span> <span class="main">{</span><span class="skolem">h</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span>generate <span class="free">G</span> <span class="main">(</span><span class="free">gs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">h</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="free">g</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">∈</span> generate <span class="free">G</span> <span class="main">{</span><span class="skolem">h</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">∈</span> generate <span class="free">G</span> <span class="main">(</span><span class="free">gs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">h</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="free">g</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≠</span> <span class="main">𝟭</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> complementary_def <span class="keyword1"><span class="command">using</span></span> generate.one <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
        <span class="keyword1"><span class="command">with</span></span> ca <span class="keyword1"><span class="command">have</span></span> kngh<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">∉</span> generate <span class="free">G</span> <span class="main">(</span><span class="free">gs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">h</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> h <span class="keyword1"><span class="command">unfolding</span></span> complementary_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">from</span></span> k<span class="main">(</span>2<span class="main">)</span> generate_eq_finprod_PiE_image<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">gs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">h</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="free">g</span><span class="main">}</span>"</span></span><span class="main">]</span> assms<span class="main">(</span>1<span class="main">)</span> gsgc
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> f<span class="main">:</span>
          <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> finprod <span class="free">G</span> <span class="skolem">f</span> <span class="main">(</span><span class="free">gs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">h</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="free">g</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="main">(</span><span class="keyword1">Π<span class="hidden">⇩</span><sub>E</sub></span> <span class="bound">a</span><span class="main">∈</span><span class="free">gs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">h</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="free">g</span><span class="main">}</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">a</span><span class="main">}</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">have</span></span> fg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">a</span> <span class="main">∈</span> generate <span class="free">G</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="main">(</span><span class="free">gs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">h</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="free">g</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span> <span class="keyword1"><span class="command">using</span></span> that f<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">have</span></span> fc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">a</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="main">(</span><span class="free">gs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">h</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="free">g</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"generate <span class="free">G</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="main">(</span><span class="free">gs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">h</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="free">g</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span>
            <span class="keyword1"><span class="command">using</span></span> that generate_incl<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">a</span><span class="main">}</span>"</span></span><span class="main">]</span> gsgc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">a</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that fg <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">have</span></span> kp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> <span class="skolem">f</span> <span class="free">g</span> <span class="main">⊗</span> finprod <span class="free">G</span> <span class="skolem">f</span> <span class="main">(</span><span class="free">gs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">h</span><span class="main">}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">gs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">h</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="free">g</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> insert <span class="free">g</span> <span class="main">(</span><span class="free">gs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">h</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finprod <span class="free">G</span> <span class="skolem">f</span> <span class="main">(</span>insert <span class="free">g</span> <span class="main">(</span><span class="free">gs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">h</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">f</span> <span class="free">g</span> <span class="main">⊗</span> finprod <span class="free">G</span> <span class="skolem">f</span> <span class="main">(</span><span class="free">gs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">h</span><span class="main">}</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> finprod_insert<span class="main"><span class="keyword3">,</span></span> <span class="operator">use</span> fc assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> gngs <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> f<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">have</span></span> fgsh<span class="main">:</span> <span class="quoted"><span class="quoted">"finprod <span class="free">G</span> <span class="skolem">f</span> <span class="main">(</span><span class="free">gs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">h</span><span class="main">}</span><span class="main">)</span> <span class="main">∈</span> generate <span class="free">G</span> <span class="main">(</span><span class="free">gs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">h</span><span class="main">}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> finprod_closed_subgroup<span class="main"><span class="main">[</span></span><span class="operator">OF</span> generate_is_subgroup<span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">gs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">h</span><span class="main">}</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> gsgc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">a</span> <span class="main">∈</span> generate <span class="free">G</span> <span class="main">(</span><span class="free">gs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">h</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="main">(</span><span class="free">gs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">h</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span>
            <span class="keyword1"><span class="command">using</span></span> mono_generate<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">a</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">gs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">h</span><span class="main">}</span>"</span></span><span class="main">]</span> fg that <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="free">gs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">h</span><span class="main">}</span> <span class="main">→</span> generate <span class="free">G</span> <span class="main">(</span><span class="free">gs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">h</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="free">g</span> <span class="main">⊗</span> finprod <span class="free">G</span> <span class="skolem">f</span> <span class="main">(</span><span class="free">gs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">h</span><span class="main">}</span><span class="main">)</span> <span class="main">∉</span> generate <span class="free">G</span> <span class="free">gs</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span>
          <span class="keyword3"><span class="command">assume</span></span> fpgs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="free">g</span> <span class="main">⊗</span> finprod <span class="free">G</span> <span class="skolem">f</span> <span class="main">(</span><span class="free">gs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">h</span><span class="main">}</span><span class="main">)</span> <span class="main">∈</span> generate <span class="free">G</span> <span class="free">gs</span>"</span></span>
          <span class="keyword1"><span class="command">from</span></span> fgsh <span class="keyword1"><span class="command">have</span></span> fgsgs<span class="main">:</span> <span class="quoted"><span class="quoted">"finprod <span class="free">G</span> <span class="skolem">f</span> <span class="main">(</span><span class="free">gs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">h</span><span class="main">}</span><span class="main">)</span> <span class="main">∈</span> generate <span class="free">G</span> <span class="free">gs</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> mono_generate<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">gs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">h</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="free">gs</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">have</span></span> fPi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="main">(</span><span class="keyword1">Π</span> <span class="bound">a</span><span class="main">∈</span><span class="main">(</span><span class="free">gs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">h</span><span class="main">}</span><span class="main">)</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">a</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">have</span></span> gI<span class="main">:</span> <span class="quoted"><span class="quoted">"generate <span class="free">G</span> <span class="main">(</span><span class="free">gs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">h</span><span class="main">}</span><span class="main">)</span>
                  <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> finprod <span class="free">G</span> <span class="bound">x</span> <span class="main">(</span><span class="free">gs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">h</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span><span class="keyword1">Π</span> <span class="bound">a</span><span class="main">∈</span><span class="free">gs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">h</span><span class="main">}</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">a</span><span class="main">}</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> generate_eq_finprod_Pi_image<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">gs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">h</span><span class="main">}</span>"</span></span><span class="main">]</span> assms<span class="main">(</span>1<span class="main">,</span> 2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">have</span></span> fgno<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="free">g</span> <span class="main">≠</span> <span class="main">𝟭</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
            <span class="keyword3"><span class="command">assume</span></span> o<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">f</span> <span class="free">g</span> <span class="main">≠</span> <span class="main">𝟭</span>"</span></span>
            <span class="keyword1"><span class="command">hence</span></span> kf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> finprod <span class="free">G</span> <span class="skolem">f</span> <span class="main">(</span><span class="free">gs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">h</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> kp finprod_closed fc <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">∈</span> generate <span class="free">G</span> <span class="main">(</span><span class="free">gs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">h</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fPi gI <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> k ca h <span class="keyword1"><span class="command">unfolding</span></span> complementary_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">from</span></span> fpgs <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="free">g</span> <span class="main">∈</span> generate <span class="free">G</span> <span class="free">gs</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> subgroup.mult_in_cancel_right<span class="main">[</span><span class="operator">OF</span> generate_is_subgroup<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span> fc<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">g</span></span><span class="main"><span class="main">]</span></span> fgsgs<span class="main">]</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">with</span></span> fgno assms<span class="main">(</span>5<span class="main">)</span> fg<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">g</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> complementary_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">∈</span> generate <span class="free">G</span> <span class="free">gs</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> k<span class="main">(</span>1<span class="main">)</span> mono_generate<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">h</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="free">gs</span></span><span class="main">]</span> h<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> kp <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Group_Hom">
<div class="head">
<h1>Theory Group_Hom</h1>
</div>
<pre class="source"><span class="comment1">(*
    File:     Group_Hom.thy
    Author:   Joseph Thommes, TU München
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Group Homomorphisms›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Group_Hom
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="#Set_Multiplication">Set_Multiplication</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This section extends the already existing library about group homomorphisms in HOL-Algebra by
some useful lemmas. These were mainly inspired by the needs that arised throughout the other proofs.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> group_hom<span class="main">)</span> generate_hom<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">`</span> <span class="main">(</span>generate <span class="free">G</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> generate <span class="free">H</span> <span class="main">(</span><span class="free">h</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms group_hom.generate_img group_hom_axioms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹For two elements with the same image we can find an element in the kernel that maps one of the
two elements on the other by multiplication.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> group_hom<span class="main">)</span> kernel_assoc_elem<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="free">x</span> <span class="main">=</span> <span class="free">h</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">z</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="free">y</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="free">G</span></sub><span class="hidden">⇙</span> <span class="free">z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∈</span> kernel <span class="free">G</span> <span class="free">H</span> <span class="free">h</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">inv</span> <span class="free">y</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="free">G</span></sub><span class="hidden">⇙</span> <span class="free">x</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="free">y</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="free">G</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="keyword1">inv</span> <span class="free">y</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="free">G</span></sub><span class="hidden">⇙</span> <span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms G.m_assoc
    <span class="keyword1"><span class="command">using</span></span> G.inv_solve_left <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="free">x</span> <span class="main">=</span> <span class="free">h</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="free">G</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="keyword1">inv</span> <span class="free">y</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="free">G</span></sub><span class="hidden">⇙</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="free">x</span> <span class="main">=</span> <span class="free">h</span> <span class="free">y</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="free">H</span></sub><span class="hidden">⇙</span> <span class="free">h</span> <span class="main">(</span><span class="keyword1">inv</span> <span class="free">y</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="free">G</span></sub><span class="hidden">⇙</span> <span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">𝟭</span><span class="hidden">⇘</span><sub><span class="free">H</span></sub><span class="hidden">⇙</span> <span class="main">=</span> <span class="free">h</span> <span class="main">(</span><span class="keyword1">inv</span> <span class="free">y</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="free">G</span></sub><span class="hidden">⇙</span> <span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">inv</span> <span class="free">y</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="free">G</span></sub><span class="hidden">⇙</span> <span class="free">x</span><span class="main">)</span> <span class="main">∈</span> kernel <span class="free">G</span> <span class="free">H</span> <span class="free">h</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> kernel_def <span class="keyword1"><span class="command">using</span></span> c <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> e that <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This can then be used to characterize the pre-image of a set $A$ under homomorphism as a
product of $A$ itself with the kernel of the homomorphism.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> group_hom<span class="main">)</span> vimage_eq_set_mult_kern_right<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> carrier <span class="free">G</span><span class="main">.</span> <span class="free">h</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">h</span> <span class="main">`</span> <span class="free">A</span><span class="main">}</span> <span class="main">=</span> <span class="free">A</span> <span class="main">&lt;#&gt;</span> kernel <span class="free">G</span> <span class="free">H</span> <span class="free">h</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> equalityI subsetI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">&lt;#&gt;</span> kernel <span class="free">G</span> <span class="free">H</span> <span class="free">h</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> xc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> kernel_def set_mult_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> assm <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> kernel <span class="free">G</span> <span class="free">H</span> <span class="free">h</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="free">G</span></sub><span class="hidden">⇙</span> <span class="skolem">b</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> set_mult_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> abc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> kernel_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> ab <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="skolem">x</span> <span class="main">=</span> <span class="free">h</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="free">G</span></sub><span class="hidden">⇙</span> <span class="skolem">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">h</span> <span class="skolem">a</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="free">H</span></sub><span class="hidden">⇙</span> <span class="free">h</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> abc <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">h</span> <span class="skolem">a</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="free">H</span></sub><span class="hidden">⇙</span> <span class="main">𝟭</span><span class="hidden">⇘</span><sub><span class="free">H</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ab<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> kernel_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">h</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> abc <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">∈</span> <span class="free">h</span> <span class="main">`</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ab <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="free">h</span> <span class="main">`</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> carrier <span class="free">G</span><span class="main">.</span> <span class="free">h</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">h</span> <span class="main">`</span> <span class="free">A</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> xc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> carrier <span class="free">G</span><span class="main">.</span> <span class="free">h</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">h</span> <span class="main">`</span> <span class="free">A</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="free">h</span> <span class="main">`</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="skolem">x</span> <span class="main">=</span> <span class="free">h</span> <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> kernel_assoc_elem <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="free">G</span></sub><span class="hidden">⇙</span> <span class="skolem">z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> kernel <span class="free">G</span> <span class="free">H</span> <span class="free">h</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">&lt;#&gt;</span> kernel <span class="free">G</span> <span class="free">H</span> <span class="free">h</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> set_mult_def <span class="keyword1"><span class="command">using</span></span> y <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> group_hom<span class="main">)</span> vimage_subset_generate_kern<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> carrier <span class="free">G</span><span class="main">.</span> <span class="free">h</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">h</span> <span class="main">`</span> <span class="free">A</span><span class="main">}</span> <span class="main">⊆</span> generate <span class="free">G</span> <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> kernel <span class="free">G</span> <span class="free">H</span> <span class="free">h</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> vimage_eq_set_mult_kern_right<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> G.set_mult_subset_generate<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"kernel <span class="free">G</span> <span class="free">H</span> <span class="free">h</span>"</span></span><span class="main">]</span> assms
  <span class="keyword1"><span class="command">unfolding</span></span> kernel_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The preimage of a subgroup under a homomorphism is also a subgroup.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> group_hom<span class="main">)</span> subgroup_vimage_is_subgroup<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="free">I</span> <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> carrier <span class="free">G</span><span class="main">.</span> <span class="free">h</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">I</span><span class="main">}</span> <span class="free">G</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="var">?J</span> <span class="free">G</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?J</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">𝟭</span> <span class="main">∈</span> <span class="var">?J</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> subgroup.one_closed<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">I</span></span> <span class="quoted"><span class="free">H</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="var">?J</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> hx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">inv</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="var">?J</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> hx <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">inv</span><span class="hidden">⇘</span><sub><span class="free">H</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="free">h</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> subgroup.m_inv_closed assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">inv</span> <span class="skolem">x</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">inv</span><span class="hidden">⇘</span><sub><span class="free">H</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="free">h</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">h</span> <span class="main">(</span><span class="keyword1">inv</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">inv</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="var">?J</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span>
  <span class="keyword3"><span class="command">assume</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="var">?J</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> hy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="skolem">y</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊗</span> <span class="skolem">y</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> carrier <span class="free">G</span><span class="main">.</span> <span class="free">h</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">I</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">⊗</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">h</span> <span class="skolem">x</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="free">H</span></sub><span class="hidden">⇙</span> <span class="free">h</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x y <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hx hy assms subgroup.m_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">⊗</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊗</span> <span class="skolem">y</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x y <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> group_hom<span class="main">)</span> iso_kernel<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">∈</span> iso <span class="free">G</span> <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"kernel <span class="free">G</span> <span class="free">H</span> <span class="free">h</span> <span class="main">=</span> <span class="main">{</span><span class="main">𝟭</span><span class="hidden">⇘</span><sub><span class="free">G</span></sub><span class="hidden">⇙</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> kernel_def <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">using</span></span> hom_one iso_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="comment1">✐<span class="quoted">‹contributor ‹Paulo Emílio de Vilhena››</span></span> <span class="comment1">(* adapted by Joseph Thommes *)</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> group_hom<span class="main">)</span> induced_group_hom_same_group<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="free">I</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"group_hom <span class="main">(</span><span class="free">G</span> <span class="main">⦇</span> carrier <span class="main">:=</span> <span class="free">I</span> <span class="main">⦈</span><span class="main">)</span> <span class="free">H</span> <span class="free">h</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">∈</span> hom <span class="main">(</span><span class="free">G</span> <span class="main">⦇</span> carrier <span class="main">:=</span> <span class="free">I</span> <span class="main">⦈</span><span class="main">)</span> <span class="free">H</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> homh subgroup.mem_carrier<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> hom_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> group_hom_def group_hom_axioms_def
    <span class="keyword1"><span class="command">using</span></span> subgroup.subgroup_is_group<span class="main">[</span><span class="operator">OF</span> assms G.is_group<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The order of an element under a homomorphism divides the order of the element.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> group_hom<span class="main">)</span> hom_ord_dvd_ord<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"H.ord <span class="main">(</span><span class="free">h</span> <span class="free">a</span><span class="main">)</span> <span class="keyword1">dvd</span> G.ord <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="free">a</span> <span class="main">[^]</span><span class="hidden">⇘</span><sub><span class="free">H</span></sub><span class="hidden">⇙</span> <span class="main">(</span>G.ord <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="free">h</span> <span class="main">(</span><span class="free">a</span> <span class="main">[^]</span><span class="hidden">⇘</span><sub><span class="free">G</span></sub><span class="hidden">⇙</span> G.ord <span class="free">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms local.hom_nat_pow <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">h</span> <span class="main">(</span><span class="main">𝟭</span><span class="hidden">⇘</span><sub><span class="free">G</span></sub><span class="hidden">⇙</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> G.pow_ord_eq_1 assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">𝟭</span><span class="hidden">⇘</span><sub><span class="free">H</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="free">a</span> <span class="main">[^]</span><span class="hidden">⇘</span><sub><span class="free">H</span></sub><span class="hidden">⇙</span> G.ord <span class="free">a</span> <span class="main">=</span> <span class="main">𝟭</span><span class="hidden">⇘</span><sub><span class="free">H</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> pow_eq_id assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹In particular, this implies that the image of an element with a finite order also will have a
finite order.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> group_hom<span class="main">)</span> finite_ord_stays_finite<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"G.ord <span class="free">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"H.ord <span class="main">(</span><span class="free">h</span> <span class="free">a</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> hom_ord_dvd_ord assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹For injective homomorphisms, the order stays the same.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> group_hom<span class="main">)</span> inj_imp_ord_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="free">h</span> <span class="main">(</span>carrier <span class="free">G</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"G.ord <span class="free">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"H.ord <span class="main">(</span><span class="free">h</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> G.ord <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"H.ord <span class="main">(</span><span class="free">h</span> <span class="free">a</span><span class="main">)</span> <span class="main">≤</span> G.ord <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hom_ord_dvd_ord assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"G.ord <span class="free">a</span> <span class="main">≤</span> H.ord <span class="main">(</span><span class="free">h</span> <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">𝟭</span><span class="hidden">⇘</span><sub><span class="free">H</span></sub><span class="hidden">⇙</span> <span class="main">=</span> <span class="free">h</span> <span class="main">(</span><span class="free">a</span> <span class="main">[^]</span><span class="hidden">⇘</span><sub><span class="free">G</span></sub><span class="hidden">⇙</span> H.ord<span class="main">(</span><span class="free">h</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> H.pow_ord_eq_1 assms
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.hom_nat_pow<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">[^]</span><span class="hidden">⇘</span><sub><span class="free">G</span></sub><span class="hidden">⇙</span> H.ord <span class="main">(</span><span class="free">h</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">𝟭</span><span class="hidden">⇘</span><sub><span class="free">G</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms inj_on_one_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"G.ord <span class="free">a</span> <span class="keyword1">dvd</span> H.ord <span class="main">(</span><span class="free">h</span> <span class="free">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> G.pow_eq_id assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms finite_ord_stays_finite <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> group_hom<span class="main">)</span> one_in_kernel<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">𝟭</span> <span class="main">∈</span> kernel <span class="free">G</span> <span class="free">H</span> <span class="free">h</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> subgroup.one_closed subgroup_kernel <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Group_Hom-hom_in_carr"><span class="command">lemma</span></span> hom_in_carr<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> hom <span class="free">G</span> <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> carrier <span class="free">G</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">∈</span> carrier <span class="free">H</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> hom_def bij_betw_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Group_Hom-iso_in_carr"><span class="command">lemma</span></span> iso_in_carr<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> iso <span class="free">G</span> <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> carrier <span class="free">G</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">∈</span> carrier <span class="free">H</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> iso_def bij_betw_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Group_Hom-triv_iso"><span class="command">lemma</span></span> triv_iso<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"group <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"group <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"carrier <span class="free">G</span> <span class="main">=</span> <span class="main">{</span><span class="main">𝟭</span><span class="hidden">⇘</span><sub><span class="free">G</span></sub><span class="hidden">⇙</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"carrier <span class="free">H</span> <span class="main">=</span> <span class="main">{</span><span class="main">𝟭</span><span class="hidden">⇘</span><sub><span class="free">H</span></sub><span class="hidden">⇙</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">≅</span> <span class="free">H</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">unfold</span> is_iso_def iso_def<span class="main">)</span>
  <span class="keyword1"><span class="command">interpret</span></span> G<span class="main">:</span> group <span class="quoted"><span class="free">G</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">interpret</span></span> H<span class="main">:</span> group <span class="quoted"><span class="free">H</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">𝟭</span><span class="hidden">⇘</span><sub><span class="free">H</span></sub><span class="hidden">⇙</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">∈</span> hom <span class="free">G</span> <span class="free">H</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> homI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="var">?f</span> <span class="main">(</span>carrier <span class="free">G</span><span class="main">)</span> <span class="main">(</span>carrier <span class="free">H</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> bij_betw_def
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">,</span> 4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">h</span></span> <span class="main">∈</span> hom <span class="free">G</span> <span class="free">H</span><span class="main">.</span> bij_betw <span class="bound">h</span> <span class="main">(</span>carrier <span class="free">G</span><span class="main">)</span> <span class="main">(</span>carrier <span class="free">H</span><span class="main">)</span><span class="main">}</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The cardinality of the image of a group homomorphism times the cardinality of its kernel is
equal to the group order. This is basically another form of Lagrange's theorem.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> group_hom<span class="main">)</span> image_kernel_product<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="free">h</span> <span class="main">`</span> <span class="main">(</span>carrier <span class="free">G</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> card <span class="main">(</span>kernel <span class="free">G</span> <span class="free">H</span> <span class="free">h</span><span class="main">)</span> <span class="main">=</span> order <span class="free">G</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> G<span class="main">:</span> group <span class="quoted"><span class="free">G</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">interpret</span></span> H<span class="main">:</span> group <span class="quoted"><span class="free">H</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">interpret</span></span> ih<span class="main">:</span> subgroup <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">`</span> <span class="main">(</span>carrier <span class="free">G</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">H</span></span> <span class="keyword1"><span class="command">using</span></span> img_is_subgroup <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">interpret</span></span> ih<span class="main">:</span> group <span class="quoted"><span class="quoted">"<span class="free">H</span><span class="main">⦇</span>carrier <span class="main">:=</span> <span class="free">h</span> <span class="main">`</span> <span class="main">(</span>carrier <span class="free">G</span><span class="main">)</span><span class="main">⦈</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> subgroup.subgroup_is_group <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">interpret</span></span> h<span class="main">:</span> group_hom <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="quoted">"<span class="free">H</span><span class="main">⦇</span>carrier <span class="main">:=</span> <span class="free">h</span> <span class="main">`</span> <span class="main">(</span>carrier <span class="free">G</span><span class="main">)</span><span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> hom_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">interpret</span></span> k<span class="main">:</span> subgroup <span class="quoted"><span class="quoted">"kernel <span class="free">G</span> <span class="main">(</span><span class="free">H</span><span class="main">⦇</span>carrier <span class="main">:=</span> <span class="free">h</span> <span class="main">`</span> carrier <span class="free">G</span><span class="main">⦈</span><span class="main">)</span> <span class="free">h</span>"</span></span> <span class="quoted"><span class="free">G</span></span> <span class="keyword1"><span class="command">using</span></span> h.subgroup_kernel <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> h.FactGroup_iso
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="keyword1">Mod</span> kernel <span class="free">G</span> <span class="main">(</span><span class="free">H</span><span class="main">⦇</span>carrier <span class="main">:=</span> <span class="free">h</span> <span class="main">`</span> carrier <span class="free">G</span><span class="main">⦈</span><span class="main">)</span> <span class="free">h</span> <span class="main">≅</span> <span class="free">H</span><span class="main">⦇</span>carrier <span class="main">:=</span> <span class="free">h</span> <span class="main">`</span> carrier <span class="free">G</span><span class="main">⦈</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="free">h</span> <span class="main">`</span> <span class="main">(</span>carrier <span class="free">G</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> order <span class="main">(</span><span class="free">G</span> <span class="keyword1">Mod</span> kernel <span class="free">G</span> <span class="main">(</span><span class="free">H</span><span class="main">⦇</span>carrier <span class="main">:=</span> <span class="free">h</span> <span class="main">`</span> carrier <span class="free">G</span><span class="main">⦈</span><span class="main">)</span> <span class="free">h</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> iso_same_card <span class="keyword1"><span class="command">unfolding</span></span> order_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"order <span class="main">(</span><span class="free">G</span> <span class="keyword1">Mod</span> kernel <span class="free">G</span> <span class="main">(</span><span class="free">H</span><span class="main">⦇</span>carrier <span class="main">:=</span> <span class="free">h</span> <span class="main">`</span> carrier <span class="free">G</span><span class="main">⦈</span><span class="main">)</span> <span class="free">h</span><span class="main">)</span>
                 <span class="main">*</span> card <span class="main">(</span>kernel <span class="free">G</span> <span class="main">(</span><span class="free">H</span><span class="main">⦇</span>carrier <span class="main">:=</span> <span class="free">h</span> <span class="main">`</span> carrier <span class="free">G</span><span class="main">⦈</span><span class="main">)</span> <span class="free">h</span><span class="main">)</span> <span class="main">=</span> order <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> G.lagrange<span class="main">[</span><span class="operator">OF</span> k.subgroup_axioms<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> order_def FactGroup_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"kernel <span class="free">G</span> <span class="main">(</span><span class="free">H</span><span class="main">⦇</span>carrier <span class="main">:=</span> <span class="free">h</span> <span class="main">`</span> carrier <span class="free">G</span><span class="main">⦈</span><span class="main">)</span> <span class="free">h</span> <span class="main">=</span> kernel <span class="free">G</span> <span class="free">H</span> <span class="free">h</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> kernel_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Finite_And_Cyclic_Groups">
<div class="head">
<h1>Theory Finite_And_Cyclic_Groups</h1>
</div>
<pre class="source"><span class="comment1">(*
    File:     Finite_And_Cyclic_Groups.thy
    Author:   Joseph Thommes, TU München; Manuel Eberl, TU München
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Finite and cyclic groups›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Finite_And_Cyclic_Groups
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="#Group_Hom">Group_Hom</a> <a href="#Generated_Groups_Extend">Generated_Groups_Extend</a> <a href="#General_Auxiliary">General_Auxiliary</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Finite groups›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We define the notion of finite groups and prove some trivial facts about them.›</span></span>

<span class="keyword1"><span class="command">locale</span></span> finite_group <span class="main">=</span> group <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> fin<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>carrier <span class="free">G</span><span class="main">)</span>"</span></span>

<span class="comment1">(* Manuel Eberl *)</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> finite_group<span class="main">)</span> ord_pos<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"ord <span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> ord_ge_1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> finite_group<span class="main">)</span> order_gt_0 <span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"order <span class="free">G</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> order_gt_0_iff_finite<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> finite_group<span class="main">)</span> finite_ord_conv_Least<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ord <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">n</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">[^]</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">𝟭</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> pow_order_eq_1 order_gt_0_iff_finite ord_conv_Least assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> finite_group<span class="main">)</span> non_trivial_group_ord_gr_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"carrier <span class="free">G</span> <span class="main">≠</span> <span class="main">{</span><span class="main">𝟭</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">e</span> <span class="main">∈</span> carrier <span class="free">G</span><span class="main">.</span> ord <span class="bound">e</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> one_closed <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">≠</span> <span class="main">𝟭</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms carrier_not_empty <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> ord_eq_1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">e</span></span><span class="main">]</span> le_neq_implies_less ord_ge_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* Manuel Eberl *)</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> finite_group<span class="main">)</span> max_order_elem<span class="main">:</span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">a</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> carrier <span class="free">G</span><span class="main">.</span> ord <span class="bound">x</span> <span class="main">≤</span> ord <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> carrier <span class="free">G</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> carrier <span class="free">G</span> <span class="main">⟶</span> ord <span class="bound">y</span> <span class="main">≤</span> ord <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ex_has_greatest_nat<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">𝟭</span></span></span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"order <span class="free"><span class="free">G</span></span> <span class="main"><span class="main">+</span></span> <span class="main"><span class="main">1</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">𝟭</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ord <span class="skolem">x</span> <span class="main">≤</span> order <span class="free">G</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> ord_le_group_order fin<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&lt;</span> order <span class="free">G</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ord <span class="skolem">x</span> <span class="main">&lt;</span> order <span class="free">G</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> finite_group<span class="main">)</span> iso_imp_finite<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">≅</span> <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"group <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite_group <span class="free">H</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> H<span class="main">:</span> group <span class="quoted"><span class="free">H</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>carrier <span class="free">H</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> iso_same_card<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> card_gt_0_iff order_def order_gt_0<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> finite_group<span class="main">)</span> finite_FactGroup<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">⊲</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite_group <span class="main">(</span><span class="free">G</span> <span class="keyword1">Mod</span> <span class="free">H</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> H<span class="main">:</span> normal <span class="quoted"><span class="free">H</span></span> <span class="quoted"><span class="free">G</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">interpret</span></span> Mod<span class="main">:</span> group <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="keyword1">Mod</span> <span class="free">H</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> H.factorgroup_is_group <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> FactGroup_def RCOSETS_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> finite_group<span class="main">)</span> bigger_subgroup_is_group<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="free">H</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"card <span class="free">H</span> <span class="main">≥</span> order <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">=</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> subgroup.subset fin assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> card_seteq order_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹All generated subgroups of a finite group are obviously also finite.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> finite_group<span class="main">)</span> finite_generate<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>generate <span class="free">G</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> generate_incl<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> rev_finite_subset<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"generate <span class="free">G</span> <span class="free">A</span>"</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We also provide an induction rule for finite groups inspired by Manuel Eberl's AFP entry
"Dirichlet L-Functions and Dirichlet's Theorem" and the contained theory "Group\_Adjoin". A property
that is true for a subgroup generated by some set and stays true when adjoining an element, is also
true for the whole group.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> finite_group<span class="main">)</span> generate_induct<span class="main">[</span><span class="operator">consumes</span> 1<span class="main">,</span> <span class="operator">case_names</span> base adjoin<span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">A0</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">A0</span> <span class="main">⊆</span> carrier <span class="free">G</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span><span class="free">G</span><span class="main">⦇</span>carrier <span class="main">:=</span> generate <span class="free">G</span> <span class="free">A0</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">A</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">A</span> <span class="main">⊆</span> carrier <span class="free">G</span><span class="main">;</span> <span class="bound">a</span> <span class="main">∈</span> carrier <span class="free">G</span> <span class="main">-</span> generate <span class="free">G</span> <span class="bound">A</span><span class="main">;</span> <span class="free">A0</span> <span class="main">⊆</span> <span class="bound">A</span><span class="main">;</span>
           <span class="free">P</span> <span class="main">(</span><span class="free">G</span><span class="main">⦇</span>carrier <span class="main">:=</span> generate <span class="free">G</span> <span class="bound">A</span><span class="main">⦈</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span><span class="free">G</span><span class="main">⦇</span>carrier <span class="main">:=</span> generate <span class="free">G</span> <span class="main">(</span><span class="bound">A</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">a</span><span class="main">}</span><span class="main">)</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">G</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">A</span></span> <span class="keyword2"><span class="keyword">where</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">=</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> gA<span class="main">:</span> <span class="quoted"><span class="quoted">"generate <span class="free">G</span> <span class="skolem">A</span> <span class="main">=</span> carrier <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> generate_incl<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"carrier <span class="free">G</span>"</span></span><span class="main">]</span> generate_sincl<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"carrier <span class="free">G</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fin A <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A0</span> <span class="main">⊆</span> <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> A <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"generate <span class="free">G</span> <span class="free">A0</span> <span class="main">⊆</span> generate <span class="free">G</span> <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> gA generate_incl<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span><span class="free">G</span><span class="main">⦇</span>carrier <span class="main">:=</span> generate <span class="free">G</span> <span class="skolem">A</span><span class="main">⦈</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">,</span> 3<span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span>"</span></span> <span class="quasi_keyword">taking</span><span class="main"><span class="main">:</span></span> <span class="quoted">card</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> measure_induct_rule<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>less <span class="skolem">A</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"generate <span class="free">G</span> <span class="free">A0</span> <span class="main">=</span> generate <span class="free">G</span> <span class="skolem">A</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> less <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> gA0<span class="main">:</span> False
      <span class="keyword1"><span class="command">with</span></span> less<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A0</span> <span class="main">⊂</span> <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="skolem">A</span> <span class="main">-</span> <span class="free">A0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> P1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span><span class="free">G</span><span class="main">⦇</span>carrier <span class="main">:=</span> generate <span class="free">G</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span><span class="main">)</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> less<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="skolem">A</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span><span class="main">)</span> <span class="main">&lt;</span> card <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a less<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> DiffD1 card_Diff1_less<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">A0</span> <span class="main">⊆</span> <span class="skolem">A</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a s <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"generate <span class="free">G</span> <span class="free">A0</span> <span class="main">⊆</span> generate <span class="free">G</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mono_generate <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> less a s <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"generate <span class="free">G</span> <span class="skolem">A</span> <span class="main">=</span> generate <span class="free">G</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span><span class="main">)</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> P1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> carrier <span class="free">G</span> <span class="main">-</span> generate <span class="free">G</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∉</span> generate <span class="free">G</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span>
            <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> generate <span class="free">G</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"generate <span class="free">G</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> generate <span class="free">G</span> <span class="skolem">A</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> equalityI<span class="main">)</span>
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"generate <span class="free">G</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span><span class="main">)</span> <span class="main">⊆</span> generate <span class="free">G</span> <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mono_generate <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"generate <span class="free">G</span> <span class="skolem">A</span> <span class="main">⊆</span> generate <span class="free">G</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> generate_idem<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
                <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"generate <span class="free">G</span> <span class="skolem">A</span> <span class="main">⊆</span> generate <span class="free">G</span> <span class="main">(</span>generate <span class="free">G</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mono_generate<span class="main"><span class="keyword3">,</span></span> <span class="operator">use</span> generate_sincl<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem">A</span></span></span> <span class="main"><span class="main"><span class="main">-</span></span></span> <span class="main"><span class="main"><span class="main">{</span></span></span><span class="skolem"><span class="skolem"><span class="skolem">a</span></span></span><span class="main"><span class="main"><span class="main">}</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span> a2 <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">blast</span><span class="main">)</span>
              <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> less <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">with</span></span> False <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">with</span></span> a less <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">from</span></span> less<span class="main">(</span>7<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> _ this _ P1<span class="main">]</span> less<span class="main">(</span>4<span class="main">)</span> s a <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span><span class="free">G</span><span class="main">⦇</span>carrier <span class="main">:=</span> generate <span class="free">G</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span><span class="main">)</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span> <span class="main">=</span> <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> gA <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Finite abelian groups›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Another trivial locale: the finite abelian group with some trivial facts.›</span></span>

<span class="keyword1"><span class="command">locale</span></span> finite_comm_group <span class="main">=</span> finite_group <span class="main">+</span> comm_group

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> finite_comm_group<span class="main">)</span> iso_imp_finite_comm<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">≅</span> <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"group <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite_comm_group <span class="free">H</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> H<span class="main">:</span> group <span class="quoted"><span class="free">H</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">interpret</span></span> H<span class="main">:</span> comm_group <span class="quoted"><span class="free">H</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> iso_imp_comm_group<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold_locales</span><span class="main">)</span>
  <span class="keyword1"><span class="command">interpret</span></span> H<span class="main">:</span> finite_group <span class="quoted"><span class="free">H</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> iso_imp_finite<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold_locales</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> finite_comm_group<span class="main">)</span> finite_comm_FactGroup<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="free">H</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite_comm_group <span class="main">(</span><span class="free">G</span> <span class="keyword1">Mod</span> <span class="free">H</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> finite_comm_group_def
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">safe</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite_group <span class="main">(</span><span class="free">G</span> <span class="keyword1">Mod</span> <span class="free">H</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> finite_FactGroup<span class="main">[</span><span class="operator">OF</span> subgroup_imp_normal<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"comm_group <span class="main">(</span><span class="free">G</span> <span class="keyword1">Mod</span> <span class="free">H</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abelian_FactGroup assms<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* Manuel Eberl *)</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> finite_comm_group<span class="main">)</span> subgroup_imp_finite_comm_group<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="free">H</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"finite_comm_group <span class="main">(</span><span class="free">G</span><span class="main">⦇</span>carrier <span class="main">:=</span> <span class="free">H</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> G'<span class="main">:</span> group <span class="quoted"><span class="quoted">"<span class="free">G</span><span class="main">⦇</span>carrier <span class="main">:=</span> <span class="free">H</span><span class="main">⦈</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> subgroup_imp_group<span class="main">)</span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">interpret</span></span> H<span class="main">:</span> subgroup <span class="quoted"><span class="free">H</span></span> <span class="quoted"><span class="free">G</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">use</span> finite_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> H.subset<span class="main"><span class="main">]</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main">:</span> m_comm›</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Cyclic groups›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Now, the central notion of a cyclic group is introduced: a group generated
by a single element.›</span></span>

<span class="keyword1"><span class="command">locale</span></span> cyclic_group <span class="main">=</span> group <span class="main">+</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">gen</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> gen_closed<span class="main">[</span><span class="operator">intro</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">gen</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> generator<span class="main">:</span> <span class="quoted"><span class="quoted">"carrier <span class="free">G</span> <span class="main">=</span> generate <span class="free">G</span> <span class="main">{</span><span class="free">gen</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> cyclic_group<span class="main">)</span> elem_is_gen_pow<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span> <span class="main">::</span> int<span class="main">.</span> <span class="free">x</span> <span class="main">=</span> <span class="free">gen</span> <span class="main">[^]</span> <span class="bound">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> generator <span class="keyword1"><span class="command">have</span></span> x_g<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> generate <span class="free">G</span> <span class="main">{</span><span class="free">gen</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">with</span></span> generate_pow<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">gen</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> gen_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Every cyclic group is commutative/abelian.›</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> cyclic_group <span class="main">⊆</span> comm_group
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> ab<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="free">gen</span> <span class="main">[^]</span> <span class="main">(</span><span class="skolem">a</span><span class="main">::</span>int<span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="free">gen</span> <span class="main">[^]</span> <span class="main">(</span><span class="skolem">b</span><span class="main">::</span>int<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> elem_is_gen_pow <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊗</span> <span class="skolem">y</span> <span class="main">=</span> <span class="free">gen</span> <span class="main">[^]</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="skolem">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> int_pow_mult<span class="main">)</span>                 
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">⊗</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ab int_pow_mult
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.commute gen_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊗</span> <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">⊗</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Some trivial intro rules for showing that a group is cyclic.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> group<span class="main">)</span> cyclic_groupI0<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"carrier <span class="free">G</span> <span class="main">=</span> generate <span class="free">G</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cyclic_group <span class="free">G</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span> 

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> group<span class="main">)</span> cyclic_groupI1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"carrier <span class="free">G</span> <span class="main">⊆</span> generate <span class="free">G</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cyclic_group <span class="free">G</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">use</span> generate_incl<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">{</span></span></span><span class="free"><span class="free"><span class="free">a</span></span></span><span class="main"><span class="main"><span class="main">}</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> group<span class="main">)</span> cyclic_groupI2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cyclic_group <span class="main">(</span><span class="free">G</span><span class="main">⦇</span>carrier <span class="main">:=</span> generate <span class="free">G</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">⦈</span><span class="main">)</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> group.cyclic_groupI0<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"group <span class="main">(</span><span class="free">G</span><span class="main">⦇</span>carrier <span class="main">:=</span> generate <span class="free">G</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> subgroup.subgroup_is_group group.generate_is_subgroup<span class="main"><span class="keyword3">,</span></span> <span class="operator">use</span> assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> carrier <span class="main">(</span><span class="free">G</span><span class="main">⦇</span>carrier <span class="main">:=</span> generate <span class="free">G</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">⦈</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> generate.incl<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">a</span><span class="main">}</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"carrier <span class="main">(</span><span class="free">G</span><span class="main">⦇</span>carrier <span class="main">:=</span> generate <span class="free">G</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">⦈</span><span class="main">)</span> <span class="main">=</span> generate <span class="main">(</span><span class="free">G</span><span class="main">⦇</span>carrier <span class="main">:=</span> generate <span class="free">G</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">⦈</span><span class="main">)</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> generate_consistent generate.incl group.generate_is_subgroup<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The order of the generating element is always the same as the group order.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> cyclic_group<span class="main">)</span> ord_gen_is_group_order<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ord <span class="free">gen</span> <span class="main">=</span> order <span class="free">G</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>carrier <span class="free">G</span><span class="main">)</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">with</span></span> generator <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ord <span class="free">gen</span> <span class="main">=</span> order <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> generate_pow_card<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">gen</span></span><span class="main">]</span> order_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">G</span></span><span class="main">]</span> gen_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> generate_pow_card generator order_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">G</span></span><span class="main">]</span> card_eq_0_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"carrier <span class="free">G</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹In the case of a finite group, it is sufficient to have one element of group order to know
that the group is cyclic.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> finite_group<span class="main">)</span> element_ord_generates_cyclic<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"ord <span class="free">a</span> <span class="main">=</span> order <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cyclic_group <span class="free">G</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"carrier <span class="free">G</span> <span class="main">=</span> generate <span class="free">G</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms bigger_subgroup_is_group<span class="main">[</span><span class="operator">OF</span> generate_is_subgroup<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> empty_subsetI fin generate_pow_card insert_subset ord_le_group_order<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Another useful fact is that a group of prime order is also cyclic.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> group<span class="main">)</span> prime_order_group_is_cyc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Factorial_Ring.prime <span class="main">(</span>order <span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">g</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"cyclic_group <span class="free">G</span> <span class="free">g</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> order_p<span class="main">:</span> <span class="quoted"><span class="quoted">"order <span class="free">G</span> <span class="main">=</span> <span class="skolem">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> p_prime<span class="main">:</span> <span class="quoted"><span class="quoted">"Factorial_Ring.prime <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>carrier <span class="free">G</span><span class="main">)</span> <span class="main">≥</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> order_def prime_ge_2_nat<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> a_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a_not_one<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≠</span> <span class="main">𝟭</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> one_unique
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> card_2_iff' obtain_subset_with_card_n subset_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">interpret</span></span> fin<span class="main">:</span> finite_group <span class="quoted"><span class="free">G</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms order_gt_0_iff_finite <span class="keyword1"><span class="command">unfolding</span></span> order_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ord <span class="skolem">a</span> <span class="keyword1">dvd</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a_in order_p ord_dvd_group_order <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ord <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> prime_nat_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span><span class="main">]</span> p_prime ord_eq_1 a_in a_not_one <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> cyclic_group <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="skolem">a</span></span>
    <span class="keyword1"><span class="command">using</span></span> fin.element_ord_generates_cyclic order_p a_in <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that cyclic_group_axioms <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹What follows is an induction principle for cyclic groups: a predicate is true for all elements
of the group if it is true for all elements that can be formed by the generating element by just
multiplication and if it also holds under the forming of the inverse (as we by this cover
all elements of the group),›</span></span>

<span class="comment1">(* Manuel Eberl *)</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> cyclic_group<span class="main">)</span> generator_induct <span class="main">[</span><span class="operator">consumes</span> 1<span class="main">,</span> <span class="operator">case_names</span> generate inv<span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> IH1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="free">gen</span> <span class="main">[^]</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> IH2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> carrier <span class="free">G</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span><span class="keyword1">inv</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> x <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="main">::</span> <span class="quoted">int</span> <span class="keyword2"><span class="keyword">where</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="free">gen</span> <span class="main">[^]</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> elem_is_gen_pow<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≥</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span><span class="free">gen</span> <span class="main">[^]</span> nat <span class="skolem">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> IH1<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> True n <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span><span class="keyword1">inv</span> <span class="main">(</span><span class="free">gen</span> <span class="main">[^]</span> nat <span class="main">(</span><span class="main">-</span><span class="skolem">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> IH1 IH2<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">gen</span> <span class="main">[^]</span> nat <span class="main">(</span><span class="main">-</span><span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">gen</span> <span class="main">[^]</span> <span class="main">(</span><span class="main">-</span><span class="skolem">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">inv</span> <span class="main">…</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> n <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> int_pow_neg<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Finite cyclic groups›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Additionally, the notion of the finite cyclic group is introduced.›</span></span>

<span class="keyword1"><span class="command">locale</span></span> finite_cyclic_group <span class="main">=</span> finite_group <span class="main">+</span> cyclic_group

<span class="keyword1"><span class="command">sublocale</span></span> finite_cyclic_group <span class="main">⊆</span> finite_comm_group
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> finite_cyclic_group<span class="main">)</span> ord_gen_gt_zero<span class="main">:</span>
  <span class="quoted"><span class="quoted">"ord <span class="free">gen</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> ord_ge_1<span class="main">[</span><span class="operator">OF</span> fin gen_closed<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹In order to prove something about an element in a finite abelian group, it is possible to show
this property for the neutral element or the generating element and inductively for the elements
that are formed by multiplying with the generator.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> finite_cyclic_group<span class="main">)</span> generator_induct0 <span class="main">[</span><span class="operator">consumes</span> 1<span class="main">,</span> <span class="operator">case_names</span> one step<span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> IH1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">𝟭</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> IH2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">x</span> <span class="main">∈</span> carrier <span class="free">G</span><span class="main">;</span> <span class="free">P</span> <span class="bound">x</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span><span class="bound">x</span> <span class="main">⊗</span> <span class="free">gen</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> ord_gen_gt_zero generate_nat_pow<span class="main">[</span><span class="operator">OF</span> _ gen_closed<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span><span class="main">::</span><span class="quoted">nat</span> <span class="keyword2"><span class="keyword">where</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="free">gen</span> <span class="main">[^]</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> generator x <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">use</span> assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> finite_cyclic_group<span class="main">)</span> generator_induct1 <span class="main">[</span><span class="operator">consumes</span> 1<span class="main">,</span> <span class="operator">case_names</span> gen step<span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> IH1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">gen</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> IH2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">x</span> <span class="main">∈</span> carrier <span class="free">G</span><span class="main">;</span> <span class="free">P</span> <span class="bound">x</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span><span class="bound">x</span> <span class="main">⊗</span> <span class="free">gen</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> generator_induct0<span class="main"><span class="main">[</span></span><span class="operator">OF</span> x<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">x</span> <span class="main">∈</span> carrier <span class="free">G</span><span class="main">;</span> <span class="free">P</span> <span class="bound">x</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span><span class="bound">x</span> <span class="main">⊗</span> <span class="free">gen</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> IH2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="free">gen</span> <span class="main">[^]</span> <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span><span class="main">::</span><span class="quoted">nat</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">x</span> <span class="keyword1"><span class="command">using</span></span> that
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">use</span> assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">fastforce</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">OF</span> ord_pos<span class="main"><span class="main">[</span></span><span class="operator">OF</span> gen_closed<span class="main"><span class="main">]</span></span> pow_ord_eq_1<span class="main"><span class="main">[</span></span><span class="operator">OF</span> gen_closed<span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">𝟭</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>get_exp›</span></span></span></span> - discrete logarithm›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹What now follows is the discrete logarithm for groups. It is used at several times througout
this entry and is initially used to show that two cyclic groups of the same order are isomorphic.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> group<span class="main">)</span> <span class="entity">get_exp</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">get_exp</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="keyword1">SOME</span> <span class="bound">k</span><span class="main">::</span>int<span class="main">.</span> <span class="bound">a</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">[^]</span> <span class="bound">k</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹For each element with itself as the basis the discrete logarithm indeed does what expected.
This is not the strongest possible statement, but sufficient for our needs.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> group<span class="main">)</span> get_exp_self_fulfills<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="free">a</span> <span class="main">[^]</span> get_exp <span class="free">a</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="free">a</span> <span class="main">[^]</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>int<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">[^]</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>int<span class="main">)</span> <span class="main">=</span> <span class="free">a</span> <span class="main">[^]</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">::</span>int<span class="main">.</span> <span class="free">a</span> <span class="main">[^]</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>int<span class="main">)</span> <span class="main">=</span> <span class="free">a</span> <span class="main">[^]</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> someI_ex<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="bound"><span class="bound"><span class="bound">x</span></span></span><span class="main"><span class="main"><span class="main">::</span></span></span>int<span class="main"><span class="main"><span class="main">.</span></span></span> <span class="free"><span class="free"><span class="free">a</span></span></span> <span class="main"><span class="main"><span class="main">[^]</span></span></span> <span class="main"><span class="main"><span class="main">(</span></span></span><span class="main"><span class="main"><span class="main">1</span></span></span><span class="main"><span class="main"><span class="main">::</span></span></span>int<span class="main"><span class="main"><span class="main">)</span></span></span> <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="free"><span class="free"><span class="free">a</span></span></span> <span class="main"><span class="main"><span class="main">[^]</span></span></span> <span class="bound"><span class="bound"><span class="bound">x</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">blast</span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> get_exp_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> group<span class="main">)</span> get_exp_self<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"get_exp <span class="free">a</span> <span class="free">a</span> <span class="keyword1">mod</span> ord <span class="free">a</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>int<span class="main">)</span> <span class="keyword1">mod</span> ord <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> pow_eq_int_mod<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">use</span> get_exp_self_fulfills<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">]</span></span> assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹For cyclic groups, the discrete logarithm "works" for every element.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> cyclic_group<span class="main">)</span> get_exp_fulfills<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="free">gen</span> <span class="main">[^]</span> get_exp <span class="free">gen</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> elem_is_gen_pow<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span><span class="main">::</span><span class="quoted">int</span> <span class="keyword2"><span class="keyword">where</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="free">gen</span> <span class="main">[^]</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">gen</span> <span class="main">[^]</span> <span class="skolem">k</span> <span class="main">=</span> <span class="free">gen</span> <span class="main">[^]</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">::</span>int<span class="main">.</span> <span class="free">gen</span> <span class="main">[^]</span> <span class="skolem">k</span> <span class="main">=</span> <span class="free">gen</span> <span class="main">[^]</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">intro</span> someI_ex<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="bound"><span class="bound"><span class="bound">x</span></span></span><span class="main"><span class="main"><span class="main">::</span></span></span>int<span class="main"><span class="main"><span class="main">.</span></span></span> <span class="free"><span class="free"><span class="free">gen</span></span></span> <span class="main"><span class="main"><span class="main">[^]</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">k</span></span></span> <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="free"><span class="free"><span class="free">gen</span></span></span> <span class="main"><span class="main"><span class="main">[^]</span></span></span> <span class="bound"><span class="bound"><span class="bound">x</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">blast</span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> get_exp_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> cyclic_group<span class="main">)</span> get_exp_non_zero<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span><span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≠</span> <span class="main">𝟭</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"get_exp <span class="free">gen</span> <span class="free">b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms get_exp_fulfills<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹One well-known logarithmic identity.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> cyclic_group<span class="main">)</span> get_exp_mult_mod<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"get_exp <span class="free">gen</span> <span class="main">(</span><span class="free">a</span> <span class="main">⊗</span> <span class="free">b</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="main">(</span>ord <span class="free">gen</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>get_exp <span class="free">gen</span> <span class="free">a</span> <span class="main">+</span> get_exp <span class="free">gen</span> <span class="free">b</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="main">(</span>ord <span class="free">gen</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> pow_eq_int_mod<span class="main"><span class="main">[</span></span><span class="operator">OF</span> gen_closed<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> get_exp_fulfills<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">⊗</span> <span class="free">b</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">gen</span> <span class="main">[^]</span> get_exp <span class="free">gen</span> <span class="main">(</span><span class="free">a</span> <span class="main">⊗</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span> <span class="main">⊗</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">gen</span> <span class="main">[^]</span> <span class="main">(</span>get_exp <span class="free">gen</span> <span class="free">a</span> <span class="main">+</span> get_exp <span class="free">gen</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span> <span class="main">⊗</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">gen</span> <span class="main">[^]</span> <span class="main">(</span>get_exp <span class="free">gen</span> <span class="free">a</span> <span class="main">+</span> get_exp <span class="free">gen</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="free">gen</span> <span class="main">[^]</span> <span class="main">(</span>get_exp <span class="free">gen</span> <span class="free">a</span><span class="main">)</span> <span class="main">⊗</span> <span class="free">gen</span> <span class="main">[^]</span> <span class="main">(</span>get_exp <span class="free">gen</span> <span class="free">b</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> int_pow_mult <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> get_exp_fulfills assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">gen</span> <span class="main">[^]</span> get_exp <span class="free">gen</span> <span class="main">(</span><span class="free">a</span> <span class="main">⊗</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="free">gen</span> <span class="main">[^]</span> <span class="main">(</span>get_exp <span class="free">gen</span> <span class="free">a</span> <span class="main">+</span> get_exp <span class="free">gen</span> <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We now show that all functions from a group generated by 'a' to a group generated by 'b'
that map elements from $a^k$ to $b^k$ in the other group are in fact isomorphisms between these two
groups.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> group<span class="main">)</span> iso_cyclic_groups_generate<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> carrier <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"group.ord <span class="free">G</span> <span class="free">a</span> <span class="main">=</span> group.ord <span class="free">H</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"group <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">f</span><span class="main">.</span> <span class="main">∀</span><span class="bound">k</span> <span class="main">∈</span> <span class="main">(</span>UNIV<span class="main">::</span>int set<span class="main">)</span><span class="main">.</span> <span class="bound">f</span> <span class="main">(</span><span class="free">a</span> <span class="main">[^]</span> <span class="bound">k</span><span class="main">)</span> <span class="main">=</span> <span class="free">b</span> <span class="main">[^]</span><span class="hidden">⇘</span><sub><span class="free">H</span></sub><span class="hidden">⇙</span> <span class="bound">k</span><span class="main">}</span>
         <span class="main">⊆</span> iso <span class="main">(</span><span class="free">G</span><span class="main">⦇</span>carrier <span class="main">:=</span> generate <span class="free">G</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">⦈</span><span class="main">)</span> <span class="main">(</span><span class="free">H</span><span class="main">⦇</span>carrier <span class="main">:=</span> generate <span class="free">H</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">interpret</span></span> H<span class="main">:</span> group <span class="quoted"><span class="free">H</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?A</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">G</span><span class="main">⦇</span>carrier <span class="main">:=</span> generate <span class="free">G</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">⦈</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?B</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">H</span><span class="main">⦇</span>carrier <span class="main">:=</span> generate <span class="free">H</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">⦈</span>"</span></span>
  <span class="keyword1"><span class="command">interpret</span></span> A<span class="main">:</span> cyclic_group <span class="var"><span class="quoted"><span class="var">?A</span></span></span> <span class="quoted"><span class="free">a</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> group.cyclic_groupI2<span class="main"><span class="keyword3">;</span></span> <span class="operator">use</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">interpret</span></span> B<span class="main">:</span> cyclic_group <span class="var"><span class="quoted"><span class="var">?B</span></span></span> <span class="quoted"><span class="free">b</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> group.cyclic_groupI2<span class="main"><span class="keyword3">;</span></span> <span class="operator">use</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> sA<span class="main">:</span> <span class="quoted"><span class="quoted">"subgroup <span class="main">(</span>generate <span class="free">G</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span> <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> generate_is_subgroup<span class="main"><span class="keyword3">,</span></span> <span class="operator">use</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> sB<span class="main">:</span> <span class="quoted"><span class="quoted">"subgroup <span class="main">(</span>generate <span class="free">H</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="free">H</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> H.generate_is_subgroup<span class="main"><span class="keyword3">,</span></span> <span class="operator">use</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">f</span><span class="main">.</span> <span class="main">∀</span><span class="bound">k</span><span class="main">∈</span><span class="main">(</span>UNIV<span class="main">::</span>int set<span class="main">)</span><span class="main">.</span> <span class="bound">f</span> <span class="main">(</span><span class="free">a</span> <span class="main">[^]</span> <span class="bound">k</span><span class="main">)</span> <span class="main">=</span> <span class="free">b</span> <span class="main">[^]</span><span class="hidden">⇘</span><sub><span class="free">H</span></sub><span class="hidden">⇙</span> <span class="bound">k</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> hom<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> hom <span class="var">?A</span> <span class="var">?B</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> homI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span>
    <span class="keyword3"><span class="command">assume</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> carrier <span class="var">?A</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> A.elem_is_gen_pow<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span><span class="main">::</span><span class="quoted">int</span> <span class="keyword2"><span class="keyword">where</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> <span class="free">a</span> <span class="main">[^]</span> <span class="skolem">k</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> int_pow_consistent<span class="main">[</span><span class="operator">OF</span> sA generate.incl<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> x <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="skolem">c</span> <span class="main">=</span> <span class="free">b</span> <span class="main">[^]</span><span class="hidden">⇘</span><sub><span class="free">H</span></sub><span class="hidden">⇙</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="skolem">c</span> <span class="main">∈</span> carrier <span class="var">?B</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> B.int_pow_closed H.int_pow_consistent<span class="main">[</span><span class="operator">OF</span> sB<span class="main">]</span> generate.incl<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">b</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="free">H</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">d</span>
    <span class="keyword3"><span class="command">assume</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">∈</span> carrier <span class="var">?A</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> A.elem_is_gen_pow<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l</span></span><span class="main">::</span><span class="quoted">int</span> <span class="keyword2"><span class="keyword">where</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> <span class="free">a</span> <span class="main">[^]</span> <span class="skolem">l</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> int_pow_consistent<span class="main">[</span><span class="operator">OF</span> sA generate.incl<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> k <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">⊗</span> <span class="skolem">d</span> <span class="main">=</span> <span class="free">a</span> <span class="main">[^]</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">+</span> <span class="skolem">l</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> int_pow_mult assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> x <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">(</span><span class="skolem">c</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="var">?A</span></sub><span class="hidden">⇙</span> <span class="skolem">d</span><span class="main">)</span> <span class="main">=</span> <span class="free">b</span> <span class="main">[^]</span><span class="hidden">⇘</span><sub><span class="free">H</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">+</span> <span class="skolem">l</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">b</span> <span class="main">[^]</span><span class="hidden">⇘</span><sub><span class="free">H</span></sub><span class="hidden">⇙</span> <span class="skolem">k</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="free">H</span></sub><span class="hidden">⇙</span> <span class="free">b</span> <span class="main">[^]</span><span class="hidden">⇘</span><sub><span class="free">H</span></sub><span class="hidden">⇙</span> <span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> H.int_pow_mult assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">(</span><span class="skolem">c</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="var">?A</span></sub><span class="hidden">⇙</span> <span class="skolem">d</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span> <span class="skolem">c</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="var">?B</span></sub><span class="hidden">⇙</span> <span class="skolem">x</span> <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x k l <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> xgh<span class="main">:</span> group_hom <span class="var"><span class="quoted"><span class="var">?A</span></span></span> <span class="var"><span class="quoted"><span class="var">?B</span></span></span> <span class="quoted"><span class="skolem">x</span></span> <span class="keyword1"><span class="command">unfolding</span></span> group_hom_def group_hom_axioms_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"kernel <span class="var">?A</span> <span class="var">?B</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">{</span><span class="main">𝟭</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> equalityI<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">𝟭</span><span class="main">}</span> <span class="main">⊆</span> kernel <span class="var">?A</span> <span class="var">?B</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> xgh.one_in_kernel <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> <span class="main">𝟭</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> kernel <span class="var">?A</span> <span class="var">?B</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">c</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">from</span></span> that <span class="keyword1"><span class="command">have</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> carrier <span class="var">?A</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> kernel_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> A.elem_is_gen_pow<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span><span class="main">::</span><span class="quoted">int</span> <span class="keyword2"><span class="keyword">where</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> <span class="free">a</span> <span class="main">[^]</span> <span class="skolem">k</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> int_pow_consistent<span class="main">[</span><span class="operator">OF</span> sA generate.incl<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="skolem">c</span> <span class="main">=</span> <span class="main">𝟭</span><span class="hidden">⇘</span><sub><span class="free">H</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that x <span class="keyword1"><span class="command">unfolding</span></span> kernel_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">𝟭</span><span class="hidden">⇘</span><sub><span class="free">H</span></sub><span class="hidden">⇙</span> <span class="main">=</span> <span class="free">b</span> <span class="main">[^]</span><span class="hidden">⇘</span><sub><span class="free">H</span></sub><span class="hidden">⇙</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">[^]</span> <span class="skolem">k</span> <span class="main">=</span> <span class="main">𝟭</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> int_pow_eq_id<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">k</span></span><span class="main">]</span> H.int_pow_eq_id<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">k</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> <span class="main">𝟭</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> k <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"kernel <span class="var">?A</span> <span class="var">?B</span> <span class="skolem">x</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">𝟭</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>             
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"carrier <span class="var">?B</span> <span class="main">⊆</span> <span class="skolem">x</span> <span class="main">`</span> carrier <span class="var">?A</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span>
    <span class="keyword3"><span class="command">assume</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> carrier <span class="var">?B</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> B.elem_is_gen_pow<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span><span class="main">::</span><span class="quoted">int</span> <span class="keyword2"><span class="keyword">where</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> <span class="free">b</span> <span class="main">[^]</span><span class="hidden">⇘</span><sub><span class="free">H</span></sub><span class="hidden">⇙</span> <span class="skolem">k</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> H.int_pow_consistent<span class="main">[</span><span class="operator">OF</span> sB generate.incl<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">b</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">(</span><span class="free">a</span> <span class="main">[^]</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">[^]</span> <span class="skolem">k</span> <span class="main">∈</span> carrier <span class="var">?A</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> int_pow_consistent<span class="main">[</span><span class="operator">OF</span> sA generate.incl<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span> A.int_pow_closed generate.incl<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> <span class="skolem">x</span> <span class="main">`</span> carrier <span class="var">?A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> iso <span class="var">?A</span> <span class="var">?B</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hom xgh.iso_iff <span class="keyword1"><span class="command">unfolding</span></span> kernel_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This is then used to derive the isomorphism of two cyclic groups of the same order as a
direct consequence.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> cyclic_group<span class="main">)</span> iso_cyclic_groups_same_order<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"cyclic_group <span class="free">H</span> <span class="free">h</span>"</span></span> <span class="quoted"><span class="quoted">"order <span class="free">G</span> <span class="main">=</span> order <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">≅</span> <span class="free">H</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> is_isoI<span class="main">)</span>
  <span class="keyword1"><span class="command">interpret</span></span> H<span class="main">:</span> cyclic_group <span class="quoted"><span class="free">H</span></span> <span class="quoted"><span class="free">h</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="free">h</span> <span class="main">[^]</span><span class="hidden">⇘</span><sub><span class="free">H</span></sub><span class="hidden">⇙</span> get_exp <span class="free">gen</span> <span class="bound">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> o<span class="main">:</span> <span class="quoted"><span class="quoted">"ord <span class="free">gen</span> <span class="main">=</span> H.ord <span class="free">h</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ord_gen_is_group_order H.ord_gen_is_group_order
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">k</span> <span class="main">∈</span> <span class="main">(</span>UNIV<span class="main">::</span>int set<span class="main">)</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">(</span><span class="free">gen</span> <span class="main">[^]</span> <span class="bound">k</span><span class="main">)</span> <span class="main">=</span> <span class="free">h</span> <span class="main">[^]</span><span class="hidden">⇘</span><sub><span class="free">H</span></sub><span class="hidden">⇙</span> <span class="bound">k</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span>
    <span class="keyword3"><span class="command">assume</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">∈</span> <span class="main">(</span>UNIV<span class="main">::</span>int set<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">gen</span> <span class="main">[^]</span> <span class="skolem">k</span> <span class="main">=</span> <span class="free">gen</span> <span class="main">[^]</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">::</span>int<span class="main">.</span> <span class="free">gen</span> <span class="main">[^]</span> <span class="skolem">k</span> <span class="main">=</span> <span class="free">gen</span> <span class="main">[^]</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">intro</span> someI_ex<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="bound"><span class="bound"><span class="bound">x</span></span></span><span class="main"><span class="main"><span class="main">::</span></span></span>int<span class="main"><span class="main"><span class="main">.</span></span></span> <span class="free"><span class="free"><span class="free">gen</span></span></span> <span class="main"><span class="main"><span class="main">[^]</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">k</span></span></span> <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="free"><span class="free"><span class="free">gen</span></span></span> <span class="main"><span class="main"><span class="main">[^]</span></span></span> <span class="bound"><span class="bound"><span class="bound">x</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">blast</span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">::</span>int<span class="main">.</span> <span class="free">gen</span> <span class="main">[^]</span> <span class="skolem">k</span> <span class="main">=</span> <span class="free">gen</span> <span class="main">[^]</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">::</span>int<span class="main">.</span> <span class="free">h</span> <span class="main">[^]</span><span class="hidden">⇘</span><sub><span class="free">H</span></sub><span class="hidden">⇙</span> <span class="skolem">k</span> <span class="main">=</span> <span class="free">h</span> <span class="main">[^]</span><span class="hidden">⇘</span><sub><span class="free">H</span></sub><span class="hidden">⇙</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">gen</span> <span class="main">[^]</span> <span class="skolem">k</span> <span class="main">=</span> <span class="free">gen</span> <span class="main">[^]</span> <span class="skolem">x</span> <span class="main">⟷</span> <span class="free">h</span> <span class="main">[^]</span><span class="hidden">⇘</span><sub><span class="free">H</span></sub><span class="hidden">⇙</span> <span class="skolem">k</span> <span class="main">=</span> <span class="free">h</span> <span class="main">[^]</span><span class="hidden">⇘</span><sub><span class="free">H</span></sub><span class="hidden">⇙</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span><span class="main">::</span><span class="quoted">int</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> o group.int_pow_eq<span class="main">)</span>  
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">[^]</span><span class="hidden">⇘</span><sub><span class="free">H</span></sub><span class="hidden">⇙</span> <span class="skolem">k</span> <span class="main">=</span> <span class="free">h</span> <span class="main">[^]</span><span class="hidden">⇘</span><sub><span class="free">H</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">::</span>int<span class="main">.</span> <span class="free">h</span> <span class="main">[^]</span><span class="hidden">⇘</span><sub><span class="free">H</span></sub><span class="hidden">⇙</span> <span class="skolem">k</span> <span class="main">=</span> <span class="free">h</span> <span class="main">[^]</span><span class="hidden">⇘</span><sub><span class="free">H</span></sub><span class="hidden">⇙</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">intro</span> someI_ex<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="bound"><span class="bound"><span class="bound">x</span></span></span><span class="main"><span class="main"><span class="main">::</span></span></span>int<span class="main"><span class="main"><span class="main">.</span></span></span> <span class="free"><span class="free"><span class="free">h</span></span></span> <span class="main"><span class="main"><span class="main">[^]</span></span></span><span class="hidden">⇘</span><sub><span class="free"><span class="free"><span class="free">H</span></span></span></sub><span class="hidden">⇙</span> <span class="skolem"><span class="skolem"><span class="skolem">k</span></span></span> <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="free"><span class="free"><span class="free">h</span></span></span> <span class="main"><span class="main"><span class="main">[^]</span></span></span><span class="hidden">⇘</span><sub><span class="free"><span class="free"><span class="free">H</span></span></span></sub><span class="hidden">⇙</span> <span class="bound"><span class="bound"><span class="bound">x</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">blast</span><span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">(</span><span class="free">gen</span> <span class="main">[^]</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> <span class="free">h</span> <span class="main">[^]</span><span class="hidden">⇘</span><sub><span class="free">H</span></sub><span class="hidden">⇙</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> f_def get_exp_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> iso <span class="free">G</span> <span class="free">H</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> iso_cyclic_groups_generate<span class="main">[</span><span class="operator">OF</span> gen_closed H.gen_closed o H.is_group<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> generator H.generator<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Integer modular groups›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We show that <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>integer_mod_group›</span></span></span></span> (written as <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Z n›</span></span></span></span>) is in fact a cyclic group.
For $n \neq 1$ it is generated by $1$ and in the other case by $0$.›</span></span>

<span class="keyword1"><span class="command">notation</span></span> integer_mod_group <span class="main">(</span><span class="quoted">"<span class="keyword1">Z</span>"</span><span class="main">)</span>

<span class="keyword1" id="Finite_And_Cyclic_Groups-Zn_neq1_cyclic_group"><span class="command">lemma</span></span> Zn_neq1_cyclic_group<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≠</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cyclic_group <span class="main">(</span><span class="keyword1">Z</span> <span class="free">n</span><span class="main">)</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">unfold</span> cyclic_group_def cyclic_group_axioms_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"group <span class="main">(</span><span class="keyword1">Z</span> <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> group_integer_mod_group <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> group <span class="quoted"><span class="quoted">"<span class="keyword1">Z</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">show</span></span> oc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">∈</span> carrier <span class="main">(</span><span class="keyword1">Z</span> <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> integer_mod_group_def integer_group_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> generate <span class="main">(</span><span class="keyword1">Z</span> <span class="free">n</span><span class="main">)</span> <span class="main">{</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> carrier <span class="main">(</span><span class="keyword1">Z</span> <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">using</span></span> generate_pow<span class="main">[</span><span class="operator">OF</span> oc<span class="main">]</span> that int_pow_integer_mod_group solve_equation subgroup_self
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> carrier <span class="main">(</span><span class="keyword1">Z</span> <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> generate <span class="main">(</span><span class="keyword1">Z</span> <span class="free">n</span><span class="main">)</span> <span class="main">{</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="keyword1"><span class="command">using</span></span> generate_incl<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">1</span><span class="main">}</span>"</span></span><span class="main">]</span> that oc
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Finite_And_Cyclic_Groups-Z1_cyclic_group"><span class="command">lemma</span></span> Z1_cyclic_group<span class="main">:</span> <span class="quoted"><span class="quoted">"cyclic_group <span class="main">(</span><span class="keyword1">Z</span> <span class="main">1</span><span class="main">)</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">unfold</span> cyclic_group_def cyclic_group_axioms_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"group <span class="main">(</span><span class="keyword1">Z</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> group_integer_mod_group <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> group <span class="quoted"><span class="quoted">"<span class="keyword1">Z</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∈</span> carrier <span class="main">(</span><span class="keyword1">Z</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> integer_mod_group_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> carrier <span class="main">(</span><span class="keyword1">Z</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> generate <span class="main">(</span><span class="keyword1">Z</span> <span class="main">1</span><span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="keyword1"><span class="command">using</span></span> generate_incl<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span><span class="main">]</span> that
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> generate <span class="main">(</span><span class="keyword1">Z</span> <span class="main">1</span><span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> carrier <span class="main">(</span><span class="keyword1">Z</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> that <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> integer_mod_group_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> generate.one<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1">Z</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> generate <span class="main">(</span><span class="keyword1">Z</span> <span class="main">1</span><span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> integer_mod_group_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Finite_And_Cyclic_Groups-Zn_cyclic_group"><span class="command">lemma</span></span> Zn_cyclic_group<span class="main">:</span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">x</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"cyclic_group <span class="main">(</span><span class="keyword1">Z</span> <span class="free">n</span><span class="main">)</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Z1_cyclic_group Zn_neq1_cyclic_group <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Moreover, its order is just $n$.›</span></span>

<span class="keyword1" id="Finite_And_Cyclic_Groups-Zn_order"><span class="command">lemma</span></span> Zn_order<span class="main">:</span> <span class="quoted"><span class="quoted">"order <span class="main">(</span><span class="keyword1">Z</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> integer_mod_group_def integer_group_def order_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Consequently, <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Z n›</span></span></span></span> is isomorphic to any cyclic group of order $n$.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> cyclic_group<span class="main">)</span> Zn_iso<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"order <span class="free">G</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">≅</span> <span class="keyword1">Z</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Zn_order Zn_cyclic_group iso_cyclic_groups_same_order assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword1"><span class="command">no_notation</span></span> integer_mod_group <span class="main">(</span><span class="quoted">"<span class="keyword1">Z</span>"</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="DirProds">
<div class="head">
<h1>Theory DirProds</h1>
</div>
<pre class="source"><span class="comment1">(*
    File:     DirProds.thy
    Author:   Joseph Thommes, TU München
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Direct group product›</span></span>

<span class="keyword1"><span class="command">theory</span></span> DirProds
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="#Finite_Product_Extend">Finite_Product_Extend</a> <a href="#Group_Hom">Group_Hom</a> <a href="#Finite_And_Cyclic_Groups">Finite_And_Cyclic_Groups</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">notation</span></span> integer_mod_group <span class="main">(</span><span class="quoted">"<span class="keyword1">Z</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The direct group product is defined component-wise and provided in an indexed way.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">DirProds</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'c</span><span class="main">)</span> monoid_scheme<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">)</span> monoid"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">DirProds</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">=</span> <span class="main">⦇</span> carrier <span class="main">=</span> Pi<span class="hidden">⇩</span><sub>E</sub> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">(</span>carrier <span class="main">∘</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span><span class="main">,</span>
                   monoid.mult <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> restrict <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="bound">x</span> <span class="bound">i</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="bound">i</span></sub><span class="hidden">⇙</span> <span class="bound">y</span> <span class="bound">i</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span><span class="main">)</span><span class="main">,</span>
                   one <span class="main">=</span> restrict <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">𝟭</span><span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="bound">i</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">⦈</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Basic lemmas about <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>DirProds›</span></span></span></span>.›</span></span>

<span class="keyword1" id="DirProds-DirProds_empty"><span class="command">lemma</span></span> DirProds_empty<span class="main">:</span>
  <span class="quoted"><span class="quoted">"carrier <span class="main">(</span>DirProds <span class="free">f</span> <span class="main">{}</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">𝟭</span><span class="hidden">⇘</span><sub>DirProds <span class="free">f</span> <span class="main">{}</span></sub><span class="hidden">⇙</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> DirProds_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="DirProds-DirProds_order"><span class="command">lemma</span></span> DirProds_order<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"order <span class="main">(</span>DirProds <span class="free">G</span> <span class="free">I</span><span class="main">)</span> <span class="main">=</span> prod <span class="main">(</span>order <span class="main">∘</span> <span class="free">G</span><span class="main">)</span> <span class="free">I</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> order_def DirProds_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_PiE<span class="main">)</span>

<span class="keyword1" id="DirProds-DirProds_in_carrI"><span class="command">lemma</span></span> DirProds_in_carrI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">⟹</span> <span class="free">x</span> <span class="bound">i</span> <span class="main">∈</span> carrier <span class="main">(</span><span class="free">G</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∉</span> <span class="free">I</span> <span class="main">⟹</span> <span class="free">x</span> <span class="bound">i</span> <span class="main">=</span> undefined"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> carrier <span class="main">(</span>DirProds <span class="free">G</span> <span class="free">I</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> DirProds_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="DirProds-comp_in_carr"><span class="command">lemma</span></span> comp_in_carr<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> carrier <span class="main">(</span>DirProds <span class="free">G</span> <span class="free">I</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="free">i</span> <span class="main">∈</span> carrier <span class="main">(</span><span class="free">G</span> <span class="free">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> DirProds_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="DirProds-comp_mult"><span class="command">lemma</span></span> comp_mult<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub>DirProds <span class="free">G</span> <span class="free">I</span></sub><span class="hidden">⇙</span> <span class="free">y</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="free">i</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="free">G</span> <span class="free">i</span></sub><span class="hidden">⇙</span> <span class="free">y</span> <span class="free">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> DirProds_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="DirProds-comp_exp_nat"><span class="command">lemma</span></span> comp_exp_nat<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">k</span><span class="main">::</span><span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">[^]</span><span class="hidden">⇘</span><sub>DirProds <span class="free">G</span> <span class="free">I</span></sub><span class="hidden">⇙</span> <span class="free">k</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> <span class="free">x</span> <span class="free">i</span> <span class="main">[^]</span><span class="hidden">⇘</span><sub><span class="free">G</span> <span class="free">i</span></sub><span class="hidden">⇙</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">k</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> DirProds_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> i<span class="main">:</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">[^]</span><span class="hidden">⇘</span><sub>DirProds <span class="free">G</span> <span class="free">I</span></sub><span class="hidden">⇙</span> <span class="skolem">k</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub>DirProds <span class="free">G</span> <span class="free">I</span></sub><span class="hidden">⇙</span> <span class="free">x</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">[^]</span><span class="hidden">⇘</span><sub>DirProds <span class="free">G</span> <span class="free">I</span></sub><span class="hidden">⇙</span> <span class="skolem">k</span><span class="main">)</span> <span class="free">i</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="free">G</span> <span class="free">i</span></sub><span class="hidden">⇙</span> <span class="free">x</span> <span class="free">i</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> comp_mult<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> i <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">x</span> <span class="free">i</span> <span class="main">[^]</span><span class="hidden">⇘</span><sub><span class="free">G</span> <span class="free">i</span></sub><span class="hidden">⇙</span> <span class="skolem">k</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="free">G</span> <span class="free">i</span></sub><span class="hidden">⇙</span> <span class="free">x</span> <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">x</span> <span class="free">i</span> <span class="main">[^]</span><span class="hidden">⇘</span><sub><span class="free">G</span> <span class="free">i</span></sub><span class="hidden">⇙</span> Suc <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="DirProds-DirProds_m_closed"><span class="command">lemma</span></span> DirProds_m_closed<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> carrier <span class="main">(</span>DirProds <span class="free">G</span> <span class="free">I</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> carrier <span class="main">(</span>DirProds <span class="free">G</span> <span class="free">I</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">⟹</span> group <span class="main">(</span><span class="free">G</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub>DirProds <span class="free">G</span> <span class="free">I</span></sub><span class="hidden">⇙</span> <span class="free">y</span> <span class="main">∈</span> carrier <span class="main">(</span>DirProds <span class="free">G</span> <span class="free">I</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms monoid.m_closed<span class="main">[</span><span class="operator">OF</span> group.is_monoid<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> DirProds_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="DirProds-partial_restr"><span class="command">lemma</span></span> partial_restr<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> carrier <span class="main">(</span>DirProds <span class="free">G</span> <span class="free">I</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">J</span> <span class="main">⊆</span> <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"restrict <span class="free">a</span> <span class="free">J</span> <span class="main">∈</span> carrier <span class="main">(</span>DirProds <span class="free">G</span> <span class="free">J</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> DirProds_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 

<span class="keyword1" id="DirProds-eq_parts_imp_eq"><span class="command">lemma</span></span> eq_parts_imp_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> carrier <span class="main">(</span>DirProds <span class="free">G</span> <span class="free">I</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> carrier <span class="main">(</span>DirProds <span class="free">G</span> <span class="free">I</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">⟹</span> <span class="free">a</span> <span class="bound">i</span> <span class="main">=</span> <span class="free">b</span> <span class="bound">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> DirProds_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="DirProds-mult_restr"><span class="command">lemma</span></span> mult_restr<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> carrier <span class="main">(</span>DirProds <span class="free">G</span> <span class="free">I</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> carrier <span class="main">(</span>DirProds <span class="free">G</span> <span class="free">I</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">J</span> <span class="main">⊆</span> <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub>DirProds <span class="free">G</span> <span class="free">J</span></sub><span class="hidden">⇙</span> <span class="free">b</span> <span class="main">=</span> restrict <span class="main">(</span><span class="free">a</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub>DirProds <span class="free">G</span> <span class="free">I</span></sub><span class="hidden">⇙</span> <span class="free">b</span><span class="main">)</span> <span class="free">J</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> DirProds_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1" id="DirProds-DirProds_one"><span class="command">lemma</span></span> DirProds_one<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> carrier <span class="main">(</span>DirProds <span class="free">G</span> <span class="free">I</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">i</span> <span class="main">∈</span> <span class="free">I</span><span class="main">.</span> <span class="free">x</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">𝟭</span><span class="hidden">⇘</span><sub><span class="free">G</span> <span class="bound">i</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">=</span> <span class="main">𝟭</span><span class="hidden">⇘</span><sub>DirProds <span class="free">G</span> <span class="free">I</span></sub><span class="hidden">⇙</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> DirProds_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="DirProds-DirProds_one'"><span class="command">lemma</span></span> DirProds_one'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">∈</span><span class="free">I</span> <span class="main">⟹</span> <span class="main">𝟭</span><span class="hidden">⇘</span><sub>DirProds <span class="free">G</span> <span class="free">I</span></sub><span class="hidden">⇙</span> <span class="free">i</span> <span class="main">=</span> <span class="main">𝟭</span><span class="hidden">⇘</span><sub><span class="free">G</span> <span class="free">i</span></sub><span class="hidden">⇙</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> DirProds_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="DirProds-DirProds_one''"><span class="command">lemma</span></span> DirProds_one''<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">𝟭</span><span class="hidden">⇘</span><sub>DirProds <span class="free">G</span> <span class="free">I</span></sub><span class="hidden">⇙</span> <span class="main">=</span> restrict <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">𝟭</span><span class="hidden">⇘</span><sub><span class="free">G</span> <span class="bound">i</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="free">I</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> DirProds_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="DirProds-DirProds_mult"><span class="command">lemma</span></span> DirProds_mult<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(⊗</span><span class="hidden">⇘</span><sub>DirProds <span class="free">G</span> <span class="free">I</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> restrict <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="bound">x</span> <span class="bound">i</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="free">G</span> <span class="bound">i</span></sub><span class="hidden">⇙</span> <span class="bound">y</span> <span class="bound">i</span><span class="main">)</span> <span class="free">I</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> DirProds_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="DirProds-DirProds_one_iso"><span class="command">lemma</span></span> DirProds_one_iso<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="free">G</span><span class="main">)</span> <span class="main">∈</span> iso <span class="main">(</span>DirProds <span class="free">f</span> <span class="main">{</span><span class="free">G</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="free">G</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> isoI homI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="free">G</span><span class="main">)</span> <span class="main">(</span>carrier <span class="main">(</span>DirProds <span class="free">f</span> <span class="main">{</span><span class="free">G</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>carrier <span class="main">(</span><span class="free">f</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> bij_betw_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="free">G</span><span class="main">)</span> <span class="main">(</span>carrier <span class="main">(</span>DirProds <span class="free">f</span> <span class="main">{</span><span class="free">G</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> inj_onI<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> DirProds_def PiE_def Pi_def extensional_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">fastforce</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="free">G</span><span class="main">)</span> <span class="main">`</span> carrier <span class="main">(</span>DirProds <span class="free">f</span> <span class="main">{</span><span class="free">G</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> carrier <span class="main">(</span><span class="free">f</span> <span class="free">G</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> equalityI subsetI<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> carrier <span class="main">(</span><span class="free">f</span> <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="free">G</span><span class="main">)</span> <span class="main">`</span> carrier <span class="main">(</span>DirProds <span class="free">f</span> <span class="main">{</span><span class="free">G</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
        <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> DirProds_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="free">G</span><span class="main">)</span> <span class="main">`</span> carrier <span class="main">(</span>DirProds <span class="free">f</span> <span class="main">{</span><span class="free">G</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> xc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> carrier <span class="main">(</span><span class="free">f</span> <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="free">G</span><span class="main">}</span><span class="main">.</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> carrier <span class="main">(</span>DirProds <span class="free">f</span> <span class="main">{</span><span class="free">G</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> DirProds_def <span class="keyword1"><span class="command">using</span></span> xc <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="free">G</span><span class="main">}</span><span class="main">.</span> <span class="skolem">x</span><span class="main">)</span> <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">unfold</span> DirProds_def PiE_def Pi_def extensional_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="DirProds-DirProds_one_cong"><span class="command">lemma</span></span> DirProds_one_cong<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>DirProds <span class="free">f</span> <span class="main">{</span><span class="free">G</span><span class="main">}</span><span class="main">)</span> <span class="main">≅</span> <span class="main">(</span><span class="free">f</span> <span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> DirProds_one_iso is_isoI <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1" id="DirProds-DirProds_one_iso_sym"><span class="command">lemma</span></span> DirProds_one_iso_sym<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">∈</span><span class="main">{</span><span class="free">G</span><span class="main">}</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> iso <span class="main">(</span><span class="free">f</span> <span class="free">G</span><span class="main">)</span> <span class="main">(</span>DirProds <span class="free">f</span> <span class="main">{</span><span class="free">G</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> isoI homI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">∈</span><span class="main">{</span><span class="free">G</span><span class="main">}</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span>carrier <span class="main">(</span><span class="free">f</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>carrier <span class="main">(</span>DirProds <span class="free">f</span> <span class="main">{</span><span class="free">G</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> bij_betw_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">∈</span><span class="main">{</span><span class="free">G</span><span class="main">}</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>carrier <span class="main">(</span><span class="free">f</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> inj_onI<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> imageI image_constant image_restrict_eq member_remove remove_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">∈</span><span class="main">{</span><span class="free">G</span><span class="main">}</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> carrier <span class="main">(</span><span class="free">f</span> <span class="free">G</span><span class="main">)</span> <span class="main">=</span> carrier <span class="main">(</span>DirProds <span class="free">f</span> <span class="main">{</span><span class="free">G</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> DirProds_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">unfold</span> DirProds_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="DirProds-DirProds_one_cong_sym"><span class="command">lemma</span></span> DirProds_one_cong_sym<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="free">G</span><span class="main">)</span> <span class="main">≅</span> <span class="main">(</span>DirProds <span class="free">f</span> <span class="main">{</span><span class="free">G</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> DirProds_one_iso_sym is_isoI <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The direct product is a group iff all factors are groups.›</span></span>

<span class="keyword1" id="DirProds-DirProds_is_group"><span class="command">lemma</span></span> DirProds_is_group<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">⟹</span> group <span class="main">(</span><span class="free">G</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"group <span class="main">(</span>DirProds <span class="free">G</span> <span class="free">I</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> groupI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> one_closed<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">𝟭</span><span class="hidden">⇘</span><sub>DirProds <span class="free">G</span> <span class="free">I</span></sub><span class="hidden">⇙</span> <span class="main">∈</span> carrier <span class="main">(</span>DirProds <span class="free">G</span> <span class="free">I</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> DirProds_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms group.is_monoid<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> carrier <span class="main">(</span>DirProds <span class="free">G</span> <span class="free">I</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> one_<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">⟹</span> <span class="main">𝟭</span><span class="hidden">⇘</span><sub><span class="free">G</span> <span class="bound">i</span></sub><span class="hidden">⇙</span> <span class="main">=</span> <span class="main">𝟭</span><span class="hidden">⇘</span><sub>DirProds <span class="free">G</span> <span class="free">I</span></sub><span class="hidden">⇙</span> <span class="bound">i</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> DirProds_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">⟹</span> <span class="main">𝟭</span><span class="hidden">⇘</span><sub>DirProds <span class="free">G</span> <span class="free">I</span></sub><span class="hidden">⇙</span> <span class="bound">i</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="free">G</span> <span class="bound">i</span></sub><span class="hidden">⇙</span> <span class="skolem">x</span> <span class="bound">i</span> <span class="main">=</span> <span class="skolem">x</span> <span class="bound">i</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
    <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
    <span class="keyword1"><span class="command">interpret</span></span> group <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">[</span><span class="operator">OF</span> i<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="skolem">i</span> <span class="main">∈</span> carrier <span class="main">(</span><span class="free">G</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x i comp_in_carr <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">𝟭</span><span class="hidden">⇘</span><sub>DirProds <span class="free">G</span> <span class="free">I</span></sub><span class="hidden">⇙</span> <span class="skolem">i</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="free">G</span> <span class="skolem">i</span></sub><span class="hidden">⇙</span> <span class="skolem">x</span> <span class="skolem">i</span> <span class="main">=</span> <span class="skolem">x</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">subst</span> one_<span class="main"><span class="main">[</span></span><span class="operator">OF</span> i<span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> one_ x <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">𝟭</span><span class="hidden">⇘</span><sub>DirProds <span class="free">G</span> <span class="free">I</span></sub><span class="hidden">⇙</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub>DirProds <span class="free">G</span> <span class="free">I</span></sub><span class="hidden">⇙</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> DirProds_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"restrict <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">inv</span><span class="hidden">⇘</span><sub><span class="free">G</span> <span class="bound">i</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="skolem">x</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="free">I</span> <span class="main">∈</span> carrier <span class="main">(</span>DirProds <span class="free">G</span> <span class="free">I</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x group.inv_closed<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> DirProds_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"restrict <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">inv</span><span class="hidden">⇘</span><sub><span class="free">G</span> <span class="bound">i</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="skolem">x</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="free">I</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub>DirProds <span class="free">G</span> <span class="free">I</span></sub><span class="hidden">⇙</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">𝟭</span><span class="hidden">⇘</span><sub>DirProds <span class="free">G</span> <span class="free">I</span></sub><span class="hidden">⇙</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> x group.l_inv<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> DirProds_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">y</span><span class="main">∈</span>carrier <span class="main">(</span>DirProds <span class="free">G</span> <span class="free">I</span><span class="main">)</span><span class="main">.</span> <span class="bound">y</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub>DirProds <span class="free">G</span> <span class="free">I</span></sub><span class="hidden">⇙</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">𝟭</span><span class="hidden">⇘</span><sub>DirProds <span class="free">G</span> <span class="free">I</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span>
  <span class="keyword3"><span class="command">assume</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> carrier <span class="main">(</span>DirProds <span class="free">G</span> <span class="free">I</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> DirProds_m_closed<span class="main">[</span><span class="operator">OF</span> x y assms<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> m_closed<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub>DirProds <span class="free">G</span> <span class="free">I</span></sub><span class="hidden">⇙</span> <span class="skolem">y</span> <span class="main">∈</span> carrier <span class="main">(</span>DirProds <span class="free">G</span> <span class="free">I</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span>
  <span class="keyword3"><span class="command">assume</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> carrier <span class="main">(</span>DirProds <span class="free">G</span> <span class="free">I</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">⟹</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub>DirProds <span class="free">G</span> <span class="free">I</span></sub><span class="hidden">⇙</span> <span class="skolem">y</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub>DirProds <span class="free">G</span> <span class="free">I</span></sub><span class="hidden">⇙</span> <span class="skolem">z</span><span class="main">)</span> <span class="bound">i</span>
                    <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub>DirProds <span class="free">G</span> <span class="free">I</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub>DirProds <span class="free">G</span> <span class="free">I</span></sub><span class="hidden">⇙</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span> <span class="bound">i</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
    <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub>DirProds <span class="free">G</span> <span class="free">I</span></sub><span class="hidden">⇙</span> <span class="skolem">y</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub>DirProds <span class="free">G</span> <span class="free">I</span></sub><span class="hidden">⇙</span> <span class="skolem">z</span><span class="main">)</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub>DirProds <span class="free">G</span> <span class="free">I</span></sub><span class="hidden">⇙</span> <span class="skolem">y</span><span class="main">)</span> <span class="skolem">i</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="free">G</span> <span class="skolem">i</span></sub><span class="hidden">⇙</span> <span class="skolem">z</span> <span class="skolem">i</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_mult i m_closed z<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">x</span> <span class="skolem">i</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="free">G</span> <span class="skolem">i</span></sub><span class="hidden">⇙</span> <span class="skolem">y</span> <span class="skolem">i</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="free">G</span> <span class="skolem">i</span></sub><span class="hidden">⇙</span> <span class="skolem">z</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms comp_mult i x y<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">x</span> <span class="skolem">i</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="free">G</span> <span class="skolem">i</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="skolem">y</span> <span class="skolem">i</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="free">G</span> <span class="skolem">i</span></sub><span class="hidden">⇙</span> <span class="skolem">z</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i assms x y z
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Group.group_def comp_in_carr monoid.m_assoc<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub>DirProds <span class="free">G</span> <span class="free">I</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub>DirProds <span class="free">G</span> <span class="free">I</span></sub><span class="hidden">⇙</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> DirProds_def i<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub>DirProds <span class="free">G</span> <span class="free">I</span></sub><span class="hidden">⇙</span> <span class="skolem">y</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub>DirProds <span class="free">G</span> <span class="free">I</span></sub><span class="hidden">⇙</span> <span class="skolem">z</span><span class="main">)</span> <span class="skolem">i</span>
                <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub>DirProds <span class="free">G</span> <span class="free">I</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub>DirProds <span class="free">G</span> <span class="free">I</span></sub><span class="hidden">⇙</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub>DirProds <span class="free">G</span> <span class="free">I</span></sub><span class="hidden">⇙</span> <span class="skolem">y</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub>DirProds <span class="free">G</span> <span class="free">I</span></sub><span class="hidden">⇙</span> <span class="skolem">z</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub>DirProds <span class="free">G</span> <span class="free">I</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub>DirProds <span class="free">G</span> <span class="free">I</span></sub><span class="hidden">⇙</span> <span class="skolem">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> DirProds_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="DirProds-DirProds_obtain_elem_carr"><span class="command">lemma</span></span> DirProds_obtain_elem_carr<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"group <span class="main">(</span>DirProds <span class="free">G</span> <span class="free">I</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> carrier <span class="main">(</span><span class="free">G</span> <span class="free">i</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">k</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">∈</span> carrier <span class="main">(</span>DirProds <span class="free">G</span> <span class="free">I</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="free">i</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> DP<span class="main">:</span> group <span class="quoted"><span class="quoted">"DirProds <span class="free">G</span> <span class="free">I</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">from</span></span> comp_in_carr<span class="main">[</span><span class="operator">OF</span> DP.one_closed<span class="main">]</span> DirProds_one' <span class="keyword1"><span class="command">have</span></span> ao<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">j</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> <span class="main">𝟭</span><span class="hidden">⇘</span><sub><span class="free">G</span> <span class="bound">j</span></sub><span class="hidden">⇙</span> <span class="main">∈</span> carrier <span class="main">(</span><span class="free">G</span> <span class="bound">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"restrict <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> <span class="main">𝟭</span><span class="hidden">⇘</span><sub><span class="free">G</span> <span class="bound">j</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">(</span><span class="free">i</span> <span class="main">:=</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="free">I</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="main">∈</span> carrier <span class="main">(</span>DirProds <span class="free">G</span> <span class="free">I</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> DirProds_def PiE_def Pi_def <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">,</span> 3<span class="main">)</span> ao <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="free">i</span> <span class="main">=</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">k</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">k</span> <span class="main">∈</span> carrier <span class="main">(</span>DirProds <span class="free">G</span> <span class="free">I</span><span class="main">)</span><span class="main">;</span> <span class="bound">k</span> <span class="free">i</span> <span class="main">=</span> <span class="free">x</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">thesis</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">thesis</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="DirProds-DirProds_group_imp_groups"><span class="command">lemma</span></span> DirProds_group_imp_groups<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"group <span class="main">(</span>DirProds <span class="free">G</span> <span class="free">I</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"group <span class="main">(</span><span class="free">G</span> <span class="free">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> groupI<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?DP</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"DirProds <span class="free">G</span> <span class="free">I</span>"</span></span>
  <span class="keyword1"><span class="command">interpret</span></span> DP<span class="main">:</span> group <span class="var"><span class="quoted"><span class="var">?DP</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">𝟭</span><span class="hidden">⇘</span><sub><span class="free">G</span> <span class="free">i</span></sub><span class="hidden">⇙</span> <span class="main">∈</span> carrier <span class="main">(</span><span class="free">G</span> <span class="free">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> DirProds_one' comp_in_carr<span class="main">[</span><span class="operator">OF</span> DP.one_closed i<span class="main">]</span> i <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="free">G</span> <span class="free">i</span></sub><span class="hidden">⇙</span> <span class="skolem">y</span> <span class="main">∈</span> carrier <span class="main">(</span><span class="free">G</span> <span class="free">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> carrier <span class="main">(</span><span class="free">G</span> <span class="free">i</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> carrier <span class="main">(</span><span class="free">G</span> <span class="free">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> DirProds_obtain_elem_carr<span class="main">[</span><span class="operator">OF</span> assms that<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">∈</span> carrier <span class="var">?DP</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="free">i</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">from</span></span> DirProds_obtain_elem_carr<span class="main">[</span><span class="operator">OF</span> assms that<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">∈</span> carrier <span class="var">?DP</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="free">i</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="var">?DP</span></sub><span class="hidden">⇙</span> <span class="skolem">l</span> <span class="main">∈</span> carrier <span class="var">?DP</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> k l <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">from</span></span> comp_in_carr<span class="main">[</span><span class="operator">OF</span> this i<span class="main">]</span> comp_mult<span class="main">[</span><span class="operator">OF</span> i<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> k l <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="free">G</span> <span class="free">i</span></sub><span class="hidden">⇙</span> <span class="skolem">y</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="free">G</span> <span class="free">i</span></sub><span class="hidden">⇙</span> <span class="skolem">z</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="free">G</span> <span class="free">i</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="free">G</span> <span class="free">i</span></sub><span class="hidden">⇙</span> <span class="skolem">z</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> carrier <span class="main">(</span><span class="free">G</span> <span class="free">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> carrier <span class="main">(</span><span class="free">G</span> <span class="free">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> carrier <span class="main">(</span><span class="free">G</span> <span class="free">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> DirProds_obtain_elem_carr<span class="main">[</span><span class="operator">OF</span> assms x<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">∈</span> carrier <span class="var">?DP</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="free">i</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">from</span></span> DirProds_obtain_elem_carr<span class="main">[</span><span class="operator">OF</span> assms y<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">∈</span> carrier <span class="var">?DP</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="free">i</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">from</span></span> DirProds_obtain_elem_carr<span class="main">[</span><span class="operator">OF</span> assms z<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∈</span> carrier <span class="var">?DP</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="free">i</span> <span class="main">=</span> <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="free">G</span> <span class="free">i</span></sub><span class="hidden">⇙</span> <span class="skolem">y</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="free">G</span> <span class="free">i</span></sub><span class="hidden">⇙</span> <span class="skolem">z</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">k</span> <span class="free">i</span><span class="main">)</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="free">G</span> <span class="free">i</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="skolem">l</span> <span class="free">i</span><span class="main">)</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="free">G</span> <span class="free">i</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="skolem">m</span> <span class="free">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> k l m <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="var">?DP</span></sub><span class="hidden">⇙</span> <span class="skolem">l</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="var">?DP</span></sub><span class="hidden">⇙</span> <span class="skolem">m</span><span class="main">)</span> <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> comp_mult<span class="main">[</span><span class="operator">OF</span> i<span class="main">]</span> k l m <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="var">?DP</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="skolem">l</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="var">?DP</span></sub><span class="hidden">⇙</span> <span class="skolem">m</span><span class="main">)</span><span class="main">)</span> <span class="free">i</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="var">?DP</span></sub><span class="hidden">⇙</span> <span class="skolem">l</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="var">?DP</span></sub><span class="hidden">⇙</span> <span class="skolem">m</span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="var">?DP</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="skolem">l</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="var">?DP</span></sub><span class="hidden">⇙</span> <span class="skolem">m</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> DP.m_assoc<span class="main">[</span><span class="operator">OF</span> k<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> l<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> m<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">k</span> <span class="free">i</span><span class="main">)</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="free">G</span> <span class="free">i</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="main">(</span><span class="skolem">l</span> <span class="free">i</span><span class="main">)</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="free">G</span> <span class="free">i</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="skolem">m</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> comp_mult<span class="main">[</span><span class="operator">OF</span> i<span class="main">]</span> k l m <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> k l m <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">𝟭</span><span class="hidden">⇘</span><sub><span class="free">G</span> <span class="free">i</span></sub><span class="hidden">⇙</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="free">G</span> <span class="free">i</span></sub><span class="hidden">⇙</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> carrier <span class="main">(</span><span class="free">G</span> <span class="free">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> DirProds_obtain_elem_carr<span class="main">[</span><span class="operator">OF</span> assms that<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">∈</span> carrier <span class="var">?DP</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="free">i</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">𝟭</span><span class="hidden">⇘</span><sub><span class="var">?DP</span></sub><span class="hidden">⇙</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="var">?DP</span></sub><span class="hidden">⇙</span> <span class="skolem">k</span> <span class="main">=</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> comp_mult k DirProds_one<span class="main">[</span><span class="operator">OF</span> DP.one_closed<span class="main">]</span> that i <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">y</span><span class="main">∈</span>carrier <span class="main">(</span><span class="free">G</span> <span class="free">i</span><span class="main">)</span><span class="main">.</span> <span class="bound">y</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="free">G</span> <span class="free">i</span></sub><span class="hidden">⇙</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">𝟭</span><span class="hidden">⇘</span><sub><span class="free">G</span> <span class="free">i</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> carrier <span class="main">(</span><span class="free">G</span> <span class="free">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> DirProds_obtain_elem_carr<span class="main">[</span><span class="operator">OF</span> assms that<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">∈</span> carrier <span class="var">?DP</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="free">i</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">hence</span></span> ic<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">inv</span><span class="hidden">⇘</span><sub><span class="var">?DP</span></sub><span class="hidden">⇙</span> <span class="skolem">k</span> <span class="main">∈</span> carrier <span class="var">?DP</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">inv</span><span class="hidden">⇘</span><sub><span class="var">?DP</span></sub><span class="hidden">⇙</span> <span class="skolem">k</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="var">?DP</span></sub><span class="hidden">⇙</span> <span class="skolem">k</span> <span class="main">=</span> <span class="main">𝟭</span><span class="hidden">⇘</span><sub><span class="var">?DP</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> k <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">inv</span><span class="hidden">⇘</span><sub><span class="var">?DP</span></sub><span class="hidden">⇙</span> <span class="skolem">k</span><span class="main">)</span> <span class="free">i</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="free">G</span> <span class="free">i</span></sub><span class="hidden">⇙</span> <span class="skolem">k</span> <span class="free">i</span><span class="main">=</span> <span class="main">𝟭</span><span class="hidden">⇘</span><sub><span class="free">G</span> <span class="free">i</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> comp_mult<span class="main">[</span><span class="operator">OF</span> i<span class="main">]</span> DirProds_one'<span class="main">[</span><span class="operator">OF</span> i<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">with</span></span> k<span class="main">(</span>2<span class="main">)</span> comp_in_carr<span class="main">[</span><span class="operator">OF</span> ic i<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="DirProds-DirProds_group_iff"><span class="command">lemma</span></span> DirProds_group_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"group <span class="main">(</span>DirProds <span class="free">G</span> <span class="free">I</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> group <span class="main">(</span><span class="free">G</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> DirProds_is_group DirProds_group_imp_groups <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword1" id="DirProds-comp_inv"><span class="command">lemma</span></span> comp_inv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"group <span class="main">(</span>DirProds <span class="free">G</span> <span class="free">I</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> carrier <span class="main">(</span>DirProds <span class="free">G</span> <span class="free">I</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">inv</span><span class="hidden">⇘</span><sub><span class="main">(</span>DirProds <span class="free">G</span> <span class="free">I</span><span class="main">)</span></sub><span class="hidden">⇙</span> <span class="free">x</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> <span class="keyword1">inv</span><span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">G</span> <span class="free">i</span><span class="main">)</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="free">x</span> <span class="free">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> DP<span class="main">:</span> group <span class="quoted"><span class="quoted">"DirProds <span class="free">G</span> <span class="free">I</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">interpret</span></span> Gi<span class="main">:</span> group <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> DirProds_group_imp_groups<span class="main">[</span><span class="operator">OF</span> DP.is_group i<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> ixc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">inv</span><span class="hidden">⇘</span><sub><span class="main">(</span>DirProds <span class="free">G</span> <span class="free">I</span><span class="main">)</span></sub><span class="hidden">⇙</span> <span class="free">x</span> <span class="main">∈</span> carrier <span class="main">(</span>DirProds <span class="free">G</span> <span class="free">I</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">inv</span><span class="hidden">⇘</span><sub><span class="main">(</span>DirProds <span class="free">G</span> <span class="free">I</span><span class="main">)</span></sub><span class="hidden">⇙</span> <span class="free">x</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub>DirProds <span class="free">G</span> <span class="free">I</span></sub><span class="hidden">⇙</span> <span class="free">x</span> <span class="main">=</span> <span class="main">𝟭</span><span class="hidden">⇘</span><sub>DirProds <span class="free">G</span> <span class="free">I</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">inv</span><span class="hidden">⇘</span><sub><span class="main">(</span>DirProds <span class="free">G</span> <span class="free">I</span><span class="main">)</span></sub><span class="hidden">⇙</span> <span class="free">x</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub>DirProds <span class="free">G</span> <span class="free">I</span></sub><span class="hidden">⇙</span> <span class="free">x</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> <span class="main">𝟭</span><span class="hidden">⇘</span><sub><span class="free">G</span> <span class="free">i</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> DirProds_one' i<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> comp_mult<span class="main">[</span><span class="operator">OF</span> i<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">inv</span><span class="hidden">⇘</span><sub><span class="main">(</span>DirProds <span class="free">G</span> <span class="free">I</span><span class="main">)</span></sub><span class="hidden">⇙</span> <span class="free">x</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub>DirProds <span class="free">G</span> <span class="free">I</span></sub><span class="hidden">⇙</span> <span class="free">x</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">inv</span><span class="hidden">⇘</span><sub><span class="main">(</span>DirProds <span class="free">G</span> <span class="free">I</span><span class="main">)</span></sub><span class="hidden">⇙</span> <span class="free">x</span><span class="main">)</span> <span class="free">i</span><span class="main">)</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="free">G</span> <span class="free">i</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="free">x</span> <span class="free">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> x ixc <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_in_carr<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ i<span class="main"><span class="main">]</span></span> group.inv_equality<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The same is true for abelian groups.›</span></span>

<span class="keyword1" id="DirProds-DirProds_is_comm_group"><span class="command">lemma</span></span> DirProds_is_comm_group<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">⟹</span> comm_group <span class="main">(</span><span class="free">G</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"comm_group <span class="main">(</span>DirProds <span class="free">G</span> <span class="free">I</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"comm_group <span class="var">?DP</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">interpret</span></span> group <span class="var"><span class="quoted"><span class="var">?DP</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms DirProds_is_group <span class="keyword1"><span class="command">unfolding</span></span> comm_group_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"carrier <span class="var">?DP</span> <span class="main">⊆</span> Units <span class="var">?DP</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">𝟭</span><span class="hidden">⇘</span><sub><span class="var">?DP</span></sub><span class="hidden">⇙</span> <span class="main">∈</span> carrier <span class="var">?DP</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">assume</span></span> x<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> carrier <span class="var">?DP</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">𝟭</span><span class="hidden">⇘</span><sub><span class="var">?DP</span></sub><span class="hidden">⇙</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="var">?DP</span></sub><span class="hidden">⇙</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="var">?DP</span></sub><span class="hidden">⇙</span> <span class="main">𝟭</span><span class="hidden">⇘</span><sub><span class="var">?DP</span></sub><span class="hidden">⇙</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span>
  <span class="keyword3"><span class="command">assume</span></span> y<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> carrier <span class="var">?DP</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="var">?DP</span></sub><span class="hidden">⇙</span> <span class="skolem">y</span> <span class="main">∈</span> carrier <span class="var">?DP</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub>DirProds <span class="free">G</span> <span class="free">I</span></sub><span class="hidden">⇙</span> <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub>DirProds <span class="free">G</span> <span class="free">I</span></sub><span class="hidden">⇙</span> <span class="skolem">x</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> eq_parts_imp_eq<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">G</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">I</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="var">?DP</span></sub><span class="hidden">⇙</span> <span class="skolem">y</span> <span class="main">∈</span> carrier <span class="var">?DP</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="var">?DP</span></sub><span class="hidden">⇙</span> <span class="skolem">x</span> <span class="main">∈</span> carrier <span class="var">?DP</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">∈</span><span class="free">I</span> <span class="main">⟹</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub>DirProds <span class="free">G</span> <span class="free">I</span></sub><span class="hidden">⇙</span> <span class="skolem">y</span><span class="main">)</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub>DirProds <span class="free">G</span> <span class="free">I</span></sub><span class="hidden">⇙</span> <span class="skolem">x</span><span class="main">)</span> <span class="bound">i</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
      <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
      <span class="keyword1"><span class="command">interpret</span></span> gi<span class="main">:</span> comm_group <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> i<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="var">?DP</span></sub><span class="hidden">⇙</span> <span class="skolem">y</span><span class="main">)</span> <span class="skolem">i</span> <span class="main">=</span> <span class="skolem">x</span> <span class="skolem">i</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="free">G</span> <span class="skolem">i</span></sub><span class="hidden">⇙</span> <span class="skolem">y</span> <span class="skolem">i</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> comp_mult<span class="main"><span class="main">[</span></span><span class="operator">OF</span> i<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">y</span> <span class="skolem">i</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="free">G</span> <span class="skolem">i</span></sub><span class="hidden">⇙</span> <span class="skolem">x</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> comp_in_carr<span class="main">[</span><span class="operator">OF</span> _ i<span class="main">]</span> x y gi.m_comm <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="var">?DP</span></sub><span class="hidden">⇙</span> <span class="skolem">x</span><span class="main">)</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> comp_mult<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> i<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub>DirProds <span class="free">G</span> <span class="free">I</span></sub><span class="hidden">⇙</span> <span class="skolem">y</span><span class="main">)</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub>DirProds <span class="free">G</span> <span class="free">I</span></sub><span class="hidden">⇙</span> <span class="skolem">x</span><span class="main">)</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span>
  <span class="keyword3"><span class="command">assume</span></span> z<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> carrier <span class="var">?DP</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="var">?DP</span></sub><span class="hidden">⇙</span> <span class="skolem">y</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="var">?DP</span></sub><span class="hidden">⇙</span> <span class="skolem">z</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="var">?DP</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="var">?DP</span></sub><span class="hidden">⇙</span> <span class="skolem">z</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> m_assoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="DirProds-DirProds_comm_group_imp_comm_groups"><span class="command">lemma</span></span> DirProds_comm_group_imp_comm_groups<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"comm_group <span class="main">(</span>DirProds <span class="free">G</span> <span class="free">I</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"comm_group <span class="main">(</span><span class="free">G</span> <span class="free">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> DP<span class="main">:</span> comm_group <span class="quoted"><span class="quoted">"DirProds <span class="free">G</span> <span class="free">I</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">interpret</span></span> Gi<span class="main">:</span> group <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> DirProds_group_imp_groups<span class="main">[</span><span class="operator">OF</span> DP.is_group i<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"comm_group <span class="main">(</span><span class="free">G</span> <span class="free">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="free">G</span> <span class="free">i</span></sub><span class="hidden">⇙</span> <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="free">G</span> <span class="free">i</span></sub><span class="hidden">⇙</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> carrier <span class="main">(</span><span class="free">G</span> <span class="free">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> carrier <span class="main">(</span><span class="free">G</span> <span class="free">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> a<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> carrier <span class="main">(</span>DirProds <span class="free">G</span> <span class="free">I</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="free">i</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> DirProds_obtain_elem_carr<span class="main">[</span><span class="operator">OF</span> DP.is_group i x<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> b<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> carrier <span class="main">(</span>DirProds <span class="free">G</span> <span class="free">I</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="free">i</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> DirProds_obtain_elem_carr<span class="main">[</span><span class="operator">OF</span> DP.is_group i y<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub>DirProds <span class="free">G</span> <span class="free">I</span></sub><span class="hidden">⇙</span> <span class="skolem">b</span> <span class="main">=</span> <span class="skolem">b</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub>DirProds <span class="free">G</span> <span class="free">I</span></sub><span class="hidden">⇙</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> DP.m_comm <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub>DirProds <span class="free">G</span> <span class="free">I</span></sub><span class="hidden">⇙</span> <span class="skolem">b</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub>DirProds <span class="free">G</span> <span class="free">I</span></sub><span class="hidden">⇙</span> <span class="skolem">a</span><span class="main">)</span> <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
      <span class="keyword1"><span class="command">with</span></span> comp_mult<span class="main">[</span><span class="operator">OF</span> i<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="free">i</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="free">G</span> <span class="free">i</span></sub><span class="hidden">⇙</span> <span class="skolem">b</span> <span class="free">i</span> <span class="main">=</span> <span class="skolem">b</span> <span class="free">i</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="free">G</span> <span class="free">i</span></sub><span class="hidden">⇙</span> <span class="skolem">a</span> <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword1"><span class="command">with</span></span> a b <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="free">G</span> <span class="free">i</span></sub><span class="hidden">⇙</span> <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="free">G</span> <span class="free">i</span></sub><span class="hidden">⇙</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="DirProds-DirProds_comm_group_iff"><span class="command">lemma</span></span> DirProds_comm_group_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"comm_group <span class="main">(</span>DirProds <span class="free">G</span> <span class="free">I</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> comm_group <span class="main">(</span><span class="free">G</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> DirProds_is_comm_group DirProds_comm_group_imp_comm_groups <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹And also for finite groups.›</span></span>

<span class="keyword1" id="DirProds-DirProds_is_finite_group"><span class="command">lemma</span></span> DirProds_is_finite_group<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">∈</span><span class="free">I</span> <span class="main">⟹</span> finite_group <span class="main">(</span><span class="free">G</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite_group <span class="main">(</span>DirProds <span class="free">G</span> <span class="free">I</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"group <span class="main">(</span><span class="free">G</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">∈</span><span class="free">I</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> that<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> finite_group_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> DirProds_is_group<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword1"><span class="command">interpret</span></span> DP<span class="main">:</span> group <span class="quoted"><span class="quoted">"DirProds <span class="free">G</span> <span class="free">I</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"order <span class="main">(</span>DirProds <span class="free">G</span> <span class="free">I</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">unfold</span> DirProds_order<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>order <span class="main">∘</span> <span class="free">G</span><span class="main">)</span> <span class="skolem">i</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">∈</span><span class="free">I</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
        <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> that<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> finite_group.order_gt_0<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"prod <span class="main">(</span>order <span class="main">∘</span> <span class="free">G</span><span class="main">)</span> <span class="free">I</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>carrier <span class="main">(</span>DirProds <span class="free">G</span> <span class="free">I</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> order_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> card.infinite<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="DirProds-DirProds_finite_imp_finite_groups"><span class="command">lemma</span></span> DirProds_finite_imp_finite_groups<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite_group <span class="main">(</span>DirProds <span class="free">G</span> <span class="free">I</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">∈</span><span class="free">I</span> <span class="main">⟹</span> finite_group <span class="main">(</span><span class="free">G</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
  <span class="keyword1"><span class="command">interpret</span></span> DP<span class="main">:</span> finite_group <span class="quoted"><span class="quoted">"DirProds <span class="free">G</span> <span class="free">I</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">interpret</span></span> group <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> DirProds_group_imp_groups<span class="main"><span class="main">[</span></span><span class="operator">OF</span> DP.is_group i<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite_group <span class="main">(</span><span class="free">G</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> oDP<span class="main">:</span> <span class="quoted"><span class="quoted">"order <span class="main">(</span>DirProds <span class="free">G</span> <span class="free">I</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> DirProds_order<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">G</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"order <span class="main">(</span><span class="free">G</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>carrier <span class="main">(</span><span class="free">G</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> order_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> card_eq_0_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="DirProds-DirProds_finite_group_iff"><span class="command">lemma</span></span> DirProds_finite_group_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite_group <span class="main">(</span>DirProds <span class="free">G</span> <span class="free">I</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> finite_group <span class="main">(</span><span class="free">G</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> DirProds_is_finite_group DirProds_finite_imp_finite_groups assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword1" id="DirProds-DirProds_finite_comm_group_iff"><span class="command">lemma</span></span> DirProds_finite_comm_group_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite_comm_group <span class="main">(</span>DirProds <span class="free">G</span> <span class="free">I</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> finite_comm_group <span class="main">(</span><span class="free">G</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> DirProds_finite_group_iff<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> DirProds_comm_group_iff <span class="keyword1"><span class="command">unfolding</span></span> finite_comm_group_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹If a group is an internal direct product of a family of subgroups, it is isomorphic to the
direct product of these subgroups.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> comm_group<span class="main">)</span> subgroup_iso_DirProds_IDirProds<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="free">J</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"is_idirprod <span class="free">J</span> <span class="free">S</span> <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">⨂</span><span class="hidden">⇘</span><sub><span class="free">G</span></sub><span class="hidden">⇙</span><span class="bound">i</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> <span class="bound">x</span> <span class="bound">i</span><span class="main">)</span> <span class="main">∈</span> iso <span class="main">(</span>DirProds <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">G</span><span class="main">⦇</span>carrier <span class="main">:=</span> <span class="main">(</span><span class="free">S</span> <span class="bound">i</span><span class="main">)</span><span class="main">⦈</span><span class="main">)</span> <span class="free">I</span><span class="main">)</span> <span class="main">(</span><span class="free">G</span><span class="main">⦇</span>carrier <span class="main">:=</span> <span class="free">J</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
<span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?fp</span> <span class="main">∈</span> iso <span class="var">?DP</span> <span class="var">?J</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> assm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">J</span> <span class="main">=</span> IDirProds <span class="free">G</span> <span class="free">S</span> <span class="free">I</span>"</span></span>
                           <span class="quoted"><span class="quoted">"compl_fam <span class="free">S</span> <span class="free">I</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> is_idirprod_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">,</span> 2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> assm'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">⟹</span> subgroup <span class="main">(</span><span class="free">S</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">G</span><span class="main">⦇</span>carrier <span class="main">:=</span> <span class="free">J</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> normal_imp_subgroup subgroup_incl <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> IDirProds_incl assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> is_idirprod_def<span class="main">)</span>
  <span class="keyword1"><span class="command">interpret</span></span> J<span class="main">:</span> comm_group <span class="var"><span class="quoted"><span class="var">?J</span></span></span> <span class="keyword1"><span class="command">using</span></span> subgroup_is_comm_group<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">interpret</span></span> DP<span class="main">:</span> comm_group <span class="var"><span class="quoted"><span class="var">?DP</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> DirProds_is_comm_group<span class="main"><span class="keyword3">;</span></span> <span class="operator">use</span> J.subgroup_is_comm_group<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assm'<span class="main"><span class="main">]</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> inJ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="skolem">i</span> <span class="main">⊆</span> <span class="free">J</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="keyword1"><span class="command">using</span></span> subgroup.subset<span class="main">[</span><span class="operator">OF</span> assm'<span class="main"><span class="main">[</span></span><span class="operator">OF</span> that<span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> hom<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?fp</span> <span class="main">∈</span> hom <span class="var">?DP</span> <span class="var">?J</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> homI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> x<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> carrier <span class="var">?DP</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finprod <span class="free">G</span> <span class="skolem">x</span> <span class="free">I</span> <span class="main">∈</span> carrier <span class="var">?J</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> finprod_subgroup<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">→</span> <span class="free">J</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> inJ comp_in_carr<span class="main">[</span><span class="operator">OF</span> x<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"finprod <span class="var">?J</span> <span class="skolem">x</span> <span class="free">I</span> <span class="main">∈</span> carrier <span class="var">?J</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> J.finprod_closed<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span>
    <span class="keyword3"><span class="command">assume</span></span> y<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> carrier <span class="var">?DP</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finprod <span class="free">G</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="var">?DP</span></sub><span class="hidden">⇙</span> <span class="skolem">y</span><span class="main">)</span> <span class="free">I</span> <span class="main">=</span> finprod <span class="free">G</span> <span class="skolem">x</span> <span class="free">I</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="var">?J</span></sub><span class="hidden">⇙</span> finprod <span class="free">G</span> <span class="skolem">y</span> <span class="free">I</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>1 2 3<span class="main"><span class="main">)</span></span> finprod_subgroup<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">J</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> xyJ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">→</span> <span class="free">J</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">→</span> <span class="free">J</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x y inJ comp_in_carr<span class="main">[</span><span class="operator">OF</span> x<span class="main">]</span> comp_in_carr<span class="main">[</span><span class="operator">OF</span> y<span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> xyJ1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="var">?DP</span></sub><span class="hidden">⇙</span> <span class="skolem">y</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">→</span> <span class="free">J</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> inJ x y comp_in_carr<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="var">?DP</span></sub><span class="hidden">⇙</span> <span class="skolem">y</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="free">J</span> <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finprod <span class="var">?J</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="var">?DP</span></sub><span class="hidden">⇙</span> <span class="skolem">y</span><span class="main">)</span> <span class="free">I</span> <span class="main">=</span> finprod <span class="var">?J</span> <span class="skolem">x</span> <span class="free">I</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="var">?J</span></sub><span class="hidden">⇙</span> finprod <span class="var">?J</span> <span class="skolem">y</span> <span class="free">I</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> J.finprod_cong_split<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">→</span> carrier <span class="var">?J</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">→</span> carrier <span class="var">?J</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> xyJ <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="var">?DP</span></sub><span class="hidden">⇙</span> <span class="skolem">y</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">→</span> carrier <span class="var">?J</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> xyJ1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
        <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="skolem">i</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="free">G</span><span class="main">⦇</span>carrier <span class="main">:=</span> <span class="main">(</span><span class="free">S</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">⦈</span></sub><span class="hidden">⇙</span> <span class="skolem">y</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="var">?DP</span></sub><span class="hidden">⇙</span> <span class="skolem">y</span><span class="main">)</span> <span class="skolem">i</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> comp_mult<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="skolem">i</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="var">?J</span></sub><span class="hidden">⇙</span> <span class="skolem">y</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="var">?DP</span></sub><span class="hidden">⇙</span> <span class="skolem">y</span><span class="main">)</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> fp<span class="main">:</span> group_hom <span class="var"><span class="quoted"><span class="var">?DP</span></span></span> <span class="var"><span class="quoted"><span class="var">?J</span></span></span> <span class="var"><span class="quoted"><span class="var">?fp</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> group_hom_def group_hom_axioms_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"subgroup <span class="main">(</span><span class="free">S</span> <span class="skolem">i</span><span class="main">)</span> <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="keyword1"><span class="command">using</span></span> incl_subgroup<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assm'<span class="main"><span class="main">[</span></span><span class="operator">OF</span> that<span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"kernel <span class="var">?DP</span> <span class="var">?J</span> <span class="var">?fp</span> <span class="main">=</span> <span class="main">{</span><span class="main">𝟭</span><span class="hidden">⇘</span><sub><span class="var">?DP</span></sub><span class="hidden">⇙</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="main">𝟭</span><span class="hidden">⇘</span><sub><span class="var">?DP</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> kernel <span class="var">?DP</span> <span class="var">?J</span> <span class="var">?fp</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">from</span></span> that <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"finprod <span class="free">G</span> <span class="skolem">a</span> <span class="free">I</span> <span class="main">=</span> <span class="main">𝟭</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> carrier <span class="var">?DP</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> kernel_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">from</span></span> compl_fam_imp_triv_finprod<span class="main">[</span><span class="operator">OF</span> assm<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> s a<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> comp_in_carr<span class="main">[</span><span class="operator">OF</span> a<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> <span class="skolem">a</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">𝟭</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> DirProds_one<span class="main">[</span><span class="operator">OF</span> a<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> fp.one_in_kernel <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">J</span> <span class="main">⊆</span> <span class="var">?fp</span> <span class="main">`</span> carrier <span class="var">?DP</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assm<span class="main">(</span>1<span class="main">)</span> IDirProds_eq_finprod_PiE<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> incl_subgroup<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assm'<span class="main"><span class="main">]</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> DirProds_def PiE_def Pi_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> hom fp.iso_iff <span class="keyword1"><span class="command">unfolding</span></span> kernel_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> comm_group<span class="main">)</span> iso_DirProds_IDirProds<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_idirprod <span class="main">(</span>carrier <span class="free">G</span><span class="main">)</span> <span class="free">S</span> <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">⨂</span><span class="hidden">⇘</span><sub><span class="free">G</span></sub><span class="hidden">⇙</span><span class="bound">i</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> <span class="bound">x</span> <span class="bound">i</span><span class="main">)</span> <span class="main">∈</span> iso <span class="main">(</span>DirProds <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">G</span><span class="main">⦇</span>carrier <span class="main">:=</span> <span class="main">(</span><span class="free">S</span> <span class="bound">i</span><span class="main">)</span><span class="main">⦈</span><span class="main">)</span> <span class="free">I</span><span class="main">)</span> <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> subgroup_iso_DirProds_IDirProds<span class="main">[</span><span class="operator">OF</span> subgroup_self assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span> 2<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> comm_group<span class="main">)</span> cong_DirProds_IDirProds<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_idirprod <span class="main">(</span>carrier <span class="free">G</span><span class="main">)</span> <span class="free">S</span> <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"DirProds <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">G</span><span class="main">⦇</span>carrier <span class="main">:=</span> <span class="main">(</span><span class="free">S</span> <span class="bound">i</span><span class="main">)</span><span class="main">⦈</span><span class="main">)</span> <span class="free">I</span> <span class="main">≅</span> <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> is_isoI<span class="main"><span class="keyword3">,</span></span> <span class="operator">use</span> iso_DirProds_IDirProds<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">]</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">blast</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹In order to prove the isomorphism between two direct products, the following lemmas provide
some criterias.›</span></span>

<span class="keyword1" id="DirProds-DirProds_iso"><span class="command">lemma</span></span> DirProds_iso<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="free">f</span> <span class="free">I</span> <span class="free">J</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">∈</span><span class="free">I</span> <span class="main">⟹</span> <span class="free">Gs</span> <span class="bound">i</span> <span class="main">≅</span> <span class="free">Hs</span> <span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">∈</span><span class="free">I</span> <span class="main">⟹</span> group <span class="main">(</span><span class="free">Gs</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">j</span><span class="main">.</span> <span class="bound">j</span><span class="main">∈</span><span class="free">J</span> <span class="main">⟹</span> group <span class="main">(</span><span class="free">Hs</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"DirProds <span class="free">Gs</span> <span class="free">I</span> <span class="main">≅</span> DirProds <span class="free">Hs</span> <span class="free">J</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> DG<span class="main">:</span> group <span class="quoted"><span class="quoted">"DirProds <span class="free">Gs</span> <span class="free">I</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> DirProds_is_group assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">interpret</span></span> DH<span class="main">:</span> group <span class="quoted"><span class="quoted">"DirProds <span class="free">Hs</span> <span class="free">J</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> DirProds_is_group assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> inv_into <span class="free">I</span> <span class="free">f</span>"</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="skolem">g</span> <span class="free">J</span> <span class="free">I</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> bij_betw_inv_into<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> fgi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">⟹</span> <span class="skolem">g</span> <span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="bound">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">j</span><span class="main">.</span> <span class="bound">j</span> <span class="main">∈</span> <span class="free">J</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">g</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="bound">j</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> bij_betw_inv_into_left<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> bij_betw_inv_into_right<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∃</span><span class="bound">h</span><span class="main">.</span> <span class="bound">h</span> <span class="main">∈</span> iso <span class="main">(</span><span class="free">Gs</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">Hs</span> <span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> is_iso_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="keyword2"><span class="keyword">where</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">⟹</span> <span class="skolem">h</span> <span class="bound">i</span> <span class="main">∈</span> iso <span class="main">(</span><span class="free">Gs</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">Hs</span> <span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?h</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">j</span><span class="main">∈</span><span class="free">J</span> <span class="keyword1">then</span> <span class="main">(</span><span class="skolem">h</span> <span class="main">(</span><span class="skolem">g</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="bound">x</span> <span class="main">(</span><span class="skolem">g</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> undefined<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> hc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?h</span> <span class="skolem">x</span> <span class="main">∈</span> carrier <span class="main">(</span>DirProds <span class="free">Hs</span> <span class="free">J</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> carrier <span class="main">(</span>DirProds <span class="free">Gs</span> <span class="free">I</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> xc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> carrier <span class="main">(</span>DirProds <span class="free">Gs</span> <span class="free">I</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">(</span><span class="skolem">g</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">(</span><span class="skolem">g</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> carrier <span class="main">(</span><span class="free">Hs</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">∈</span> <span class="free">J</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">j</span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> iso_in_carr<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ comp_in_carr<span class="main"><span class="main">[</span></span><span class="operator">OF</span> xc<span class="main"><span class="main">]</span></span><span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">h</span></span> <span class="main"><span class="main">(</span></span><span class="skolem"><span class="skolem">g</span></span> <span class="skolem"><span class="skolem">j</span></span><span class="main"><span class="main">)</span></span>"</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">g</span></span> <span class="skolem"><span class="skolem">j</span></span>"</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">Hs</span></span> <span class="skolem"><span class="skolem">j</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="skolem">j</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> g<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">unfolded</span> bij_betw_def<span class="main">]</span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> h<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">(</span><span class="skolem">g</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">∈</span> Group.iso <span class="main">(</span><span class="free">Gs</span> <span class="main">(</span><span class="skolem">g</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">Hs</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fgi<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> that<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> xc <span class="keyword1"><span class="command">unfolding</span></span> DirProds_def PiE_def extensional_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?h</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub>DirProds <span class="free">Gs</span> <span class="free">I</span></sub><span class="hidden">⇙</span> <span class="skolem">y</span><span class="main">)</span><span class="main">=</span> <span class="var">?h</span> <span class="skolem">x</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub>DirProds <span class="free">Hs</span> <span class="free">J</span></sub><span class="hidden">⇙</span> <span class="var">?h</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> carrier <span class="main">(</span>DirProds <span class="free">Gs</span> <span class="free">I</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> carrier <span class="main">(</span>DirProds <span class="free">Gs</span> <span class="free">I</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> eq_parts_imp_eq<span class="main"><span class="main">[</span></span><span class="operator">OF</span> hc<span class="main"><span class="main">[</span></span><span class="operator">OF</span> DG.m_closed<span class="main"><span class="main">[</span></span><span class="operator">OF</span> that<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span> DH.m_closed<span class="main"><span class="main">[</span></span><span class="operator">OF</span> hc<span class="main"><span class="main">[</span></span><span class="operator">OF</span> that<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span> hc<span class="main"><span class="main">[</span></span><span class="operator">OF</span> that<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span>
    <span class="keyword3"><span class="command">assume</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">∈</span> <span class="free">J</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> gj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="skolem">j</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> g <span class="keyword1"><span class="command">unfolding</span></span> bij_betw_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> gj<span class="main">]</span> assms<span class="main">(</span>4<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> j<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"group <span class="main">(</span><span class="free">Gs</span> <span class="main">(</span><span class="skolem">g</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"Group.group <span class="main">(</span><span class="free">Hs</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">from</span></span> iso_imp_homomorphism<span class="main">[</span><span class="operator">OF</span> h<span class="main"><span class="main">[</span></span><span class="operator">OF</span> gj<span class="main"><span class="main">]</span></span><span class="main">]</span> fgi<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> j<span class="main">]</span> g
    <span class="keyword1"><span class="command">interpret</span></span> hjh<span class="main">:</span> group_hom <span class="quoted"><span class="quoted">"<span class="free">Gs</span> <span class="main">(</span><span class="skolem">g</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Hs</span> <span class="skolem">j</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">(</span><span class="skolem">g</span> <span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> group_hom_def group_hom_axioms_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?h</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub>DirProds <span class="free">Gs</span> <span class="free">I</span></sub><span class="hidden">⇙</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="skolem">j</span> <span class="main">=</span> <span class="main">(</span><span class="var">?h</span> <span class="skolem">x</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub>DirProds <span class="free">Hs</span> <span class="free">J</span></sub><span class="hidden">⇙</span> <span class="var">?h</span> <span class="skolem">y</span><span class="main">)</span> <span class="skolem">j</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">subst</span> comp_mult<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">if</span> <span class="skolem">j</span> <span class="main">∈</span> <span class="free">J</span> <span class="keyword1">then</span> <span class="skolem">h</span> <span class="main">(</span><span class="skolem">g</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">(</span><span class="skolem">g</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="free">Gs</span> <span class="main">(</span><span class="skolem">g</span> <span class="skolem">j</span><span class="main">)</span></sub><span class="hidden">⇙</span> <span class="skolem">y</span> <span class="main">(</span><span class="skolem">g</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> undefined<span class="main">)</span>
          <span class="main">=</span> <span class="main">(</span><span class="var">?h</span> <span class="skolem">x</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub>DirProds <span class="free">Hs</span> <span class="free">J</span></sub><span class="hidden">⇙</span> <span class="var">?h</span> <span class="skolem">y</span><span class="main">)</span> <span class="skolem">j</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">subst</span> comp_mult<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">(</span><span class="skolem">g</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">(</span><span class="skolem">g</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="free">Gs</span> <span class="main">(</span><span class="skolem">g</span> <span class="skolem">j</span><span class="main">)</span></sub><span class="hidden">⇙</span> <span class="skolem">y</span> <span class="main">(</span><span class="skolem">g</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">h</span> <span class="main">(</span><span class="skolem">g</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">(</span><span class="skolem">g</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="free">Hs</span> <span class="skolem">j</span></sub><span class="hidden">⇙</span> <span class="skolem">h</span> <span class="main">(</span><span class="skolem">g</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">(</span><span class="skolem">g</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> comp_in_carr<span class="main">[</span><span class="operator">OF</span> that<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> gj<span class="main">]</span> comp_in_carr<span class="main">[</span><span class="operator">OF</span> that<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> gj<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">if</span> <span class="skolem">j</span> <span class="main">∈</span> <span class="free">J</span> <span class="keyword1">then</span> <span class="skolem">h</span> <span class="main">(</span><span class="skolem">g</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">(</span><span class="skolem">g</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="free">Gs</span> <span class="main">(</span><span class="skolem">g</span> <span class="skolem">j</span><span class="main">)</span></sub><span class="hidden">⇙</span> <span class="skolem">y</span> <span class="main">(</span><span class="skolem">g</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> undefined<span class="main">)</span> <span class="main">=</span>
              <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">j</span> <span class="main">∈</span> <span class="free">J</span> <span class="keyword1">then</span> <span class="skolem">h</span> <span class="main">(</span><span class="skolem">g</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">(</span><span class="skolem">g</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> undefined<span class="main">)</span>
      <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="free">Hs</span> <span class="skolem">j</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">j</span> <span class="main">∈</span> <span class="free">J</span> <span class="keyword1">then</span> <span class="skolem">h</span> <span class="main">(</span><span class="skolem">g</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">(</span><span class="skolem">g</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> undefined<span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> j <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> j g that hc <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> gj g that <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">interpret</span></span> hgh<span class="main">:</span> group_hom <span class="quoted"><span class="quoted">"DirProds <span class="free">Gs</span> <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"DirProds <span class="free">Hs</span> <span class="free">J</span>"</span></span> <span class="var"><span class="quoted"><span class="var">?h</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> group_hom_def group_hom_axioms_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> homI<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"carrier <span class="main">(</span>DirProds <span class="free">Hs</span> <span class="free">J</span><span class="main">)</span> <span class="main">⊆</span> <span class="var">?h</span> <span class="main">`</span> carrier <span class="main">(</span>DirProds <span class="free">Gs</span> <span class="free">I</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="var">?h</span> <span class="main">`</span> carrier <span class="main">(</span>DirProds <span class="free">Gs</span> <span class="free">I</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> xc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> carrier <span class="main">(</span>DirProds <span class="free">Hs</span> <span class="free">J</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">from</span></span> h <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">∈</span><span class="free">I</span> <span class="main">⟹</span> <span class="skolem">k</span> <span class="bound">i</span> <span class="main">=</span> inv_into <span class="main">(</span>carrier <span class="main">(</span><span class="free">Gs</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">h</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
      <span class="keyword1"><span class="command">hence</span></span> kiso<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">∈</span><span class="free">I</span> <span class="main">⟹</span> <span class="skolem">k</span> <span class="bound">i</span> <span class="main">∈</span> iso <span class="main">(</span><span class="free">Hs</span> <span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">Gs</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> h <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> group.iso_set_sym<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> hk<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">h</span> <span class="main">(</span><span class="skolem">g</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">(</span><span class="skolem">g</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">∈</span> <span class="free">J</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> carrier <span class="main">(</span><span class="free">Hs</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">j</span> <span class="skolem">y</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> gj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="skolem">j</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that g<span class="main">[</span><span class="operator">unfolded</span> bij_betw_def<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> h<span class="main">[</span><span class="operator">OF</span> gj<span class="main">,</span> <span class="operator">unfolded</span> iso_def<span class="main">]</span> k<span class="main">[</span><span class="operator">OF</span> gj<span class="main">]</span> that fgi<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> that<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> bij_betw_inv_into_right
          <span class="keyword1"><span class="command">unfolding</span></span> comp_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?k</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span><span class="main">∈</span><span class="free">I</span> <span class="keyword1">then</span> <span class="skolem">k</span> <span class="bound">i</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> undefined<span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?y</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="var">?k</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="skolem">j</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">j</span> <span class="main">∈</span> <span class="free">J</span> <span class="keyword1">then</span> <span class="skolem">h</span> <span class="main">(</span><span class="skolem">g</span> <span class="bound">j</span><span class="main">)</span> <span class="main">(</span><span class="var">?y</span> <span class="main">(</span><span class="skolem">g</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> undefined<span class="main">)</span> <span class="skolem">j</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">j</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">∈</span> <span class="free">J</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> hk<span class="main">[</span><span class="operator">OF</span> True comp_in_carr<span class="main"><span class="main">[</span></span><span class="operator">OF</span> that True<span class="main"><span class="main">]</span></span><span class="main">]</span>
                           fgi<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> True<span class="main">]</span> g<span class="main">[</span><span class="operator">unfolded</span> bij_betw_def<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that<span class="main">[</span><span class="operator">unfolded</span> DirProds_def<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?y</span> <span class="main">∈</span> carrier <span class="main">(</span>DirProds <span class="free">Gs</span> <span class="free">I</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?y</span> <span class="skolem">i</span> <span class="main">∈</span> carrier <span class="main">(</span><span class="free">Gs</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
          <span class="keyword1"><span class="command">using</span></span> k<span class="main">[</span><span class="operator">OF</span> i<span class="main">]</span> h<span class="main">[</span><span class="operator">OF</span> i<span class="main">]</span> comp_in_carr<span class="main">[</span><span class="operator">OF</span> xc<span class="main">]</span> assms<span class="main">(</span>1<span class="main">)</span> bij_betwE iso_in_carr kiso that
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?y</span> <span class="skolem">i</span> <span class="main">=</span> undefined"</span></span> <span class="keyword2"><span class="keyword">if</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∉</span> <span class="free">I</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="keyword1"><span class="command">using</span></span> i <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> DirProds_def PiE_def Pi_def extensional_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">𝟭</span><span class="hidden">⇘</span><sub>DirProds <span class="free">Gs</span> <span class="free">I</span></sub><span class="hidden">⇙</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> carrier <span class="main">(</span>DirProds <span class="free">Gs</span> <span class="free">I</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?h</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">𝟭</span><span class="hidden">⇘</span><sub>DirProds <span class="free">Hs</span> <span class="free">J</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> <span class="skolem">x</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">𝟭</span><span class="hidden">⇘</span><sub><span class="free">Gs</span> <span class="bound">i</span></sub><span class="hidden">⇙</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
      <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
      <span class="keyword1"><span class="command">interpret</span></span> gi<span class="main">:</span> group <span class="quoted"><span class="quoted">"<span class="free">Gs</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> i<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">interpret</span></span> hfi<span class="main">:</span> group <span class="quoted"><span class="quoted">"<span class="free">Hs</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span> i assms<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">unfolded</span> bij_betw_def<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> h<span class="main">[</span><span class="operator">OF</span> i<span class="main">]</span> <span class="keyword1"><span class="command">interpret</span></span> hi<span class="main">:</span> group_hom <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">Gs</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Hs</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="skolem">i</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> group_hom_def group_hom_axioms_def iso_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> that <span class="keyword1"><span class="command">have</span></span> hx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?h</span> <span class="skolem">x</span> <span class="main">∈</span> carrier <span class="main">(</span>DirProds <span class="free">Hs</span> <span class="free">J</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> DirProds_one<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> that<span class="main">(</span>2<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">if</span> <span class="skolem">j</span> <span class="main">∈</span> <span class="free">J</span> <span class="keyword1">then</span> <span class="skolem">h</span> <span class="main">(</span><span class="skolem">g</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">(</span><span class="skolem">g</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> undefined<span class="main">)</span> <span class="main">=</span> <span class="main">𝟭</span><span class="hidden">⇘</span><sub><span class="free">Hs</span> <span class="skolem">j</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">∈</span> <span class="free">J</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">j</span>
        <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">(</span><span class="skolem">g</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">(</span><span class="skolem">g</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">𝟭</span><span class="hidden">⇘</span><sub><span class="free">Hs</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i assms<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">unfolded</span> bij_betw_def<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="skolem">i</span> <span class="main">(</span><span class="skolem">x</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">𝟭</span><span class="hidden">⇘</span><sub><span class="free">Hs</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">i</span><span class="main">)</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fgi<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> i<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> hi.iso_iff h<span class="main">[</span><span class="operator">OF</span> i<span class="main">]</span> comp_in_carr<span class="main">[</span><span class="operator">OF</span> that<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> i<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">𝟭</span><span class="hidden">⇘</span><sub><span class="free">Gs</span> <span class="skolem">i</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">with</span></span> DirProds_one that <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> is_iso_def <span class="keyword1"><span class="command">using</span></span> hgh.iso_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="DirProds-DirProds_iso1"><span class="command">lemma</span></span> DirProds_iso1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">∈</span><span class="free">I</span> <span class="main">⟹</span> <span class="free">Gs</span> <span class="bound">i</span> <span class="main">≅</span> <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="free">Gs</span><span class="main">)</span> <span class="bound">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">∈</span><span class="free">I</span> <span class="main">⟹</span> group <span class="main">(</span><span class="free">Gs</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">∈</span><span class="free">I</span> <span class="main">⟹</span> group <span class="main">(</span><span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="free">Gs</span><span class="main">)</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"DirProds <span class="free">Gs</span> <span class="free">I</span> <span class="main">≅</span> DirProds <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="free">Gs</span><span class="main">)</span> <span class="free">I</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> DP<span class="main">:</span> group <span class="quoted"><span class="quoted">"DirProds <span class="free">Gs</span> <span class="free">I</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> DirProds_is_group assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">interpret</span></span> fDP<span class="main">:</span> group <span class="quoted"><span class="quoted">"DirProds <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="free">Gs</span><span class="main">)</span> <span class="free">I</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> DirProds_is_group assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">g</span><span class="main">.</span> <span class="bound">g</span> <span class="main">∈</span> iso <span class="main">(</span><span class="free">Gs</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="free">Gs</span><span class="main">)</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> is_iso_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">J</span></span> <span class="keyword2"><span class="keyword">where</span></span> J<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> <span class="skolem">J</span> <span class="bound">i</span> <span class="main">∈</span> iso <span class="main">(</span><span class="free">Gs</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="free">Gs</span><span class="main">)</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?J</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span><span class="main">∈</span><span class="free">I</span> <span class="keyword1">then</span> <span class="skolem">J</span> <span class="bound">i</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> undefined<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> J <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">K</span></span> <span class="keyword2"><span class="keyword">where</span></span> K<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> <span class="skolem">K</span> <span class="bound">i</span> <span class="main">=</span> inv_into <span class="main">(</span>carrier <span class="main">(</span><span class="free">Gs</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">J</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">hence</span></span> K_iso<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> <span class="skolem">K</span> <span class="bound">i</span> <span class="main">∈</span> iso <span class="main">(</span><span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="free">Gs</span><span class="main">)</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">Gs</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> group.iso_set_sym assms J <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?K</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span><span class="main">∈</span><span class="free">I</span> <span class="keyword1">then</span> <span class="skolem">K</span> <span class="bound">i</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> undefined<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> JKi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?J</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="var">?K</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">x</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span> <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> carrier <span class="main">(</span>DirProds <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="free">Gs</span><span class="main">)</span> <span class="free">I</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="skolem">x</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">J</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">x</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span> <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> carrier <span class="main">(</span>DirProds <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="free">Gs</span><span class="main">)</span> <span class="free">I</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">from</span></span> J that <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">J</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span>carrier <span class="main">(</span><span class="free">Gs</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> carrier <span class="main">(</span><span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="free">Gs</span><span class="main">)</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> iso_def bij_betw_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> carrier <span class="main">(</span><span class="free">Gs</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">J</span> <span class="skolem">i</span><span class="main">)</span> <span class="bound">y</span> <span class="main">=</span> <span class="skolem">x</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_in_carr imageE<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> someI_ex<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> that <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">J</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">x</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span> <span class="skolem">i</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> K J K_iso <span class="keyword1"><span class="command">unfolding</span></span> inv_into_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?J</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="skolem">K</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">x</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span> <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> carrier <span class="main">(</span>DirProds <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="free">Gs</span><span class="main">)</span> <span class="free">I</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∉</span> <span class="free">I</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="skolem">x</span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> DirProds_def PiE_def extensional_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">e</span><span class="main">.</span> restrict <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="var">?J</span> <span class="bound">i</span> <span class="main">(</span><span class="bound">e</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="free">I</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> hom<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="main">∈</span> hom <span class="main">(</span>DirProds <span class="free">Gs</span> <span class="free">I</span><span class="main">)</span> <span class="main">(</span>DirProds <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="free">Gs</span><span class="main">)</span> <span class="free">I</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> homI<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="skolem">x</span> <span class="main">∈</span> carrier <span class="main">(</span>DirProds <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="free">Gs</span><span class="main">)</span> <span class="free">I</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> carrier <span class="main">(</span>DirProds <span class="free">Gs</span> <span class="free">I</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
      <span class="keyword1"><span class="command">using</span></span> that J comp_in_carr<span class="main">[</span><span class="operator">OF</span> that<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> DirProds_def iso_def bij_betw_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub>DirProds <span class="free">Gs</span> <span class="free">I</span></sub><span class="hidden">⇙</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="var">?r</span> <span class="skolem">x</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub>DirProds <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="free">Gs</span><span class="main">)</span> <span class="free">I</span></sub><span class="hidden">⇙</span> <span class="var">?r</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> carrier <span class="main">(</span>DirProds <span class="free">Gs</span> <span class="free">I</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> carrier <span class="main">(</span>DirProds <span class="free">Gs</span> <span class="free">I</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
      <span class="keyword1"><span class="command">using</span></span> that J comp_in_carr<span class="main">[</span><span class="operator">OF</span> that<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> comp_in_carr<span class="main">[</span><span class="operator">OF</span> that<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">unfolding</span></span> DirProds_def iso_def hom_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> r<span class="main">:</span> group_hom <span class="quoted"><span class="quoted">"<span class="main">(</span>DirProds <span class="free">Gs</span> <span class="free">I</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>DirProds <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="free">Gs</span><span class="main">)</span> <span class="free">I</span><span class="main">)</span>"</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> group_hom_def group_hom_axioms_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"carrier <span class="main">(</span>DirProds <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="free">Gs</span><span class="main">)</span> <span class="free">I</span><span class="main">)</span> <span class="main">⊆</span> <span class="var">?r</span> <span class="main">`</span> carrier <span class="main">(</span>DirProds <span class="free">Gs</span> <span class="free">I</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="var">?r</span> <span class="main">`</span> carrier <span class="main">(</span>DirProds <span class="free">Gs</span> <span class="free">I</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> carrier <span class="main">(</span>DirProds <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="free">Gs</span><span class="main">)</span> <span class="free">I</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> <span class="var">?J</span> <span class="bound">i</span> <span class="main">(</span><span class="main">(</span><span class="var">?K</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">x</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> JKi<span class="main">[</span><span class="operator">OF</span> that<span class="main">]</span> that <span class="keyword1"><span class="command">unfolding</span></span> DirProds_def PiE_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> extensional_restrict<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="var">?K</span> <span class="bound">i</span> <span class="main">(</span><span class="skolem">x</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> carrier <span class="main">(</span>DirProds <span class="free">Gs</span> <span class="free">I</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> K_iso iso_in_carr that
        <span class="keyword1"><span class="command">unfolding</span></span> DirProds_def PiE_def Pi_def extensional_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">𝟭</span><span class="hidden">⇘</span><sub>DirProds <span class="free">Gs</span> <span class="free">I</span></sub><span class="hidden">⇙</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> carrier <span class="main">(</span>DirProds <span class="free">Gs</span> <span class="free">I</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">𝟭</span><span class="hidden">⇘</span><sub>DirProds <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="free">Gs</span><span class="main">)</span> <span class="free">I</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> <span class="skolem">x</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">𝟭</span><span class="hidden">⇘</span><sub><span class="free">Gs</span> <span class="bound">i</span></sub><span class="hidden">⇙</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
      <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> J assms <span class="keyword1"><span class="command">interpret</span></span> Ji<span class="main">:</span> group_hom <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">Gs</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="free">Gs</span><span class="main">)</span> <span class="skolem">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">J</span> <span class="skolem">i</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> group_hom_def group_hom_axioms_def iso_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> that <span class="keyword1"><span class="command">have</span></span> rx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="skolem">x</span> <span class="main">∈</span> carrier <span class="main">(</span>DirProds <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="free">Gs</span><span class="main">)</span> <span class="free">I</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> i DirProds_one<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> that
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">I</span> <span class="keyword1">then</span> <span class="skolem">J</span> <span class="bound">i</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> undefined<span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">x</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">𝟭</span><span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="free">Gs</span><span class="main">)</span> <span class="skolem">i</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">J</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">x</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">𝟭</span><span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="free">Gs</span><span class="main">)</span> <span class="skolem">i</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> Ji.iso_iff mp<span class="main">[</span><span class="operator">OF</span> spec<span class="main"><span class="main">[</span></span><span class="operator">OF</span> J<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> Ball_def<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span> i<span class="main">]</span> comp_in_carr<span class="main">[</span><span class="operator">OF</span> that<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> i<span class="main">]</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">𝟭</span><span class="hidden">⇘</span><sub><span class="free">Gs</span> <span class="skolem">i</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">with</span></span> DirProds_one<span class="main">[</span><span class="operator">OF</span> that<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> is_iso_def <span class="keyword1"><span class="command">using</span></span> r.iso_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="DirProds-DirProds_iso2"><span class="command">lemma</span></span> DirProds_iso2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="free">f</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"group <span class="main">(</span>DirProds <span class="free">g</span> <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"DirProds <span class="main">(</span><span class="free">g</span> <span class="main">∘</span> <span class="free">f</span><span class="main">)</span> <span class="free">A</span> <span class="main">≅</span> DirProds <span class="free">g</span> <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> DirProds_iso<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">f</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="free">f</span> <span class="free">A</span> <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> bij_betw_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">g</span> <span class="main">∘</span> <span class="free">f</span><span class="main">)</span> <span class="bound">i</span> <span class="main">≅</span> <span class="free">g</span> <span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> comp_def <span class="keyword1"><span class="command">using</span></span> iso_refl <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">⟹</span> group <span class="main">(</span><span class="free">g</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> DirProds_group_imp_groups <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> group <span class="main">(</span><span class="main">(</span><span class="free">g</span> <span class="main">∘</span> <span class="free">f</span><span class="main">)</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The direct group product distributes when nested.›</span></span>

<span class="keyword1" id="DirProds-DirProds_Sigma"><span class="command">lemma</span></span> DirProds_Sigma<span class="main">:</span>
  <span class="quoted"><span class="quoted">"DirProds <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> DirProds <span class="main">(</span><span class="free">G</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">J</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="free">I</span> <span class="main">≅</span> DirProds <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="free">G</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">)</span> <span class="main">(</span>Sigma <span class="free">I</span> <span class="free">J</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">≅</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> is_isoI isoI<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> restrict <span class="main">(</span>case_prod <span class="bound">x</span><span class="main">)</span> <span class="main">(</span>Sigma <span class="free">I</span> <span class="free">J</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> hom<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">∈</span> hom <span class="var">?L</span> <span class="var">?R</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> homI<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="skolem">a</span> <span class="main">∈</span> carrier <span class="var">?R</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> carrier <span class="var">?L</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> DirProds_def PiE_def Pi_def extensional_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="var">?L</span></sub><span class="hidden">⇙</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">=</span> <span class="var">?f</span> <span class="skolem">a</span> <span class="main">⊗</span><span class="hidden">⇘</span><sub><span class="var">?R</span></sub><span class="hidden">⇙</span> <span class="var">?f</span> <span class="skolem">b</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> carrier <span class="var">?L</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> carrier <span class="var">?L</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span> <span class="skolem">b</span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> DirProds_def PiE_def Pi_def extensional_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="var">?f</span> <span class="main">(</span>carrier <span class="var">?L</span><span class="main">)</span> <span class="main">(</span>carrier <span class="var">?R</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> bij_betwI<span class="main">)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?g</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span><span class="main">∈</span><span class="free">I</span> <span class="keyword1">then</span> <span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">j</span><span class="main">∈</span><span class="main">(</span><span class="free">J</span> <span class="bound">i</span><span class="main">)</span> <span class="keyword1">then</span> <span class="bound">x</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span> <span class="keyword1">else</span> undefined<span class="main">)</span> <span class="keyword1">else</span> undefined<span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">∈</span> carrier <span class="var">?L</span> <span class="main">→</span> carrier <span class="var">?R</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> DirProds_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?g</span> <span class="main">∈</span> carrier <span class="var">?R</span> <span class="main">→</span> carrier <span class="var">?L</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> DirProds_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">(</span><span class="var">?g</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> carrier <span class="var">?R</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> DirProds_def PiE_def Pi_def extensional_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?g</span> <span class="main">(</span><span class="var">?f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> carrier <span class="var">?L</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> DirProds_def PiE_def Pi_def extensional_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">no_notation</span></span> integer_mod_group <span class="main">(</span><span class="quoted">"<span class="keyword1">Z</span>"</span><span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Group_Relations">
<div class="head">
<h1>Theory Group_Relations</h1>
</div>
<pre class="source"><span class="comment1">(*
    File:     Group_Relations.thy
    Author:   Joseph Thommes, TU München
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Group relations›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Group_Relations
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="#Finite_Product_Extend">Finite_Product_Extend</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We introduce the notion of a relation of a set of elements: a way to express the neutral
element by using only powers of said elements. The following predicate describes the set of all the
relations that one can construct from a set of elements.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> comm_group<span class="main">)</span> <span class="entity">relations</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> int<span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">relations</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">f</span><span class="main">.</span> finprod <span class="free">G</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">[^]</span> <span class="bound">f</span> <span class="bound">a</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> <span class="main">𝟭</span><span class="main">}</span> <span class="main">∩</span> extensional <span class="free"><span class="bound"><span class="entity">A</span></span></span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Now some basic lemmas about relations.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> comm_group<span class="main">)</span> in_relationsI<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finprod <span class="free">G</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">[^]</span> <span class="free">f</span> <span class="bound">a</span><span class="main">)</span> <span class="free">A</span> <span class="main">=</span> <span class="main">𝟭</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> extensional <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> relations <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> relations_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> comm_group<span class="main">)</span> triv_rel<span class="main">:</span>
  <span class="quoted"><span class="quoted">"restrict <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">0</span><span class="main">::</span>int<span class="main">)</span> <span class="free">A</span> <span class="main">∈</span> relations <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨂</span><span class="bound">a</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="bound">a</span> <span class="main">[^]</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="main">0</span><span class="main">::</span>int<span class="main">)</span> <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">𝟭</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> finprod_one_eqI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> comm_group<span class="main">)</span> not_triv_relI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">a</span> <span class="main">≠</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>int<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">≠</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="main">0</span><span class="main">::</span>int<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> comm_group<span class="main">)</span> rel_in_carr<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> relations <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">[^]</span> <span class="free">r</span> <span class="bound">a</span><span class="main">)</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">→</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Pi_I assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> int_pow_closed subsetD<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The following lemmas are of importance when proving the fundamental theorem of finitely
generated abelian groups in the case that there is just the trivial relation between a set of
generators. They all build up to the last lemma that then is actually used in the proof.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> comm_group<span class="main">)</span> relations_zero_imp_pow_not_one<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">f</span><span class="main">∈</span><span class="main">(</span>relations <span class="free">A</span><span class="main">)</span><span class="main">.</span> <span class="bound">f</span> <span class="free">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">z</span></span><span class="main">::</span>int <span class="main">≠</span> <span class="main">0</span><span class="main">.</span> <span class="free">a</span> <span class="main">[^]</span> <span class="bound">z</span> <span class="main">≠</span> <span class="main">𝟭</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main"><span class="keyword3">;</span></span> <span class="operator">safe</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span><span class="main">::</span><span class="quoted">int</span>
  <span class="keyword3"><span class="command">assume</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">[^]</span> <span class="skolem">z</span> <span class="main">=</span> <span class="main">𝟭</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"restrict <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span><span class="main">(</span><span class="free">a</span> <span class="main">:=</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span> <span class="free">A</span> <span class="main">∈</span> relations <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> in_relationsI finprod_one_eqI<span class="main"><span class="keyword3">,</span></span> <span class="operator">use</span> z <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> z assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> comm_group<span class="main">)</span> relations_zero_imp_ord_zero<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">f</span><span class="main">∈</span><span class="main">(</span>relations <span class="free">A</span><span class="main">)</span><span class="main">.</span> <span class="bound">f</span> <span class="free">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ord <span class="free">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms relations_zero_imp_pow_not_one<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span> 2<span class="main"><span class="main">)</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> finite_cyclic_subgroup_int infinite_cyclic_subgroup_order<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> comm_group<span class="main">)</span> finprod_relations_triv_harder_better_stronger<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"relations <span class="free">A</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="main">0</span><span class="main">::</span>int<span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">f</span> <span class="main">∈</span> Pi<span class="hidden">⇩</span><sub>E</sub> <span class="free">A</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">a</span><span class="main">}</span><span class="main">)</span><span class="main">.</span> finprod <span class="free">G</span> <span class="bound">f</span> <span class="free">A</span> <span class="main">=</span> <span class="main">𝟭</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">a</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">a</span> <span class="main">=</span> <span class="main">𝟭</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span>
  <span class="keyword3"><span class="command">assume</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="main">(</span><span class="keyword1">Π<span class="hidden">⇩</span><sub>E</sub></span> <span class="bound">a</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">a</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"finprod <span class="free">G</span> <span class="skolem">f</span> <span class="free">A</span> <span class="main">=</span> <span class="main">𝟭</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> generate_pow assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="main">∃</span><span class="bound">k</span><span class="main">::</span>int<span class="main">.</span> <span class="skolem">f</span> <span class="bound">a</span> <span class="main">=</span> <span class="bound">a</span> <span class="main">[^]</span> <span class="bound">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> int"</span></span> <span class="keyword2"><span class="keyword">where</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">a</span> <span class="main">=</span> <span class="bound">a</span> <span class="main">[^]</span> <span class="skolem">r</span> <span class="bound">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"restrict <span class="skolem">r</span> <span class="free">A</span> <span class="main">∈</span> relations <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> in_relationsI<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨂</span><span class="bound">a</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="bound">a</span> <span class="main">[^]</span> restrict <span class="skolem">r</span> <span class="free">A</span> <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> finprod <span class="free">G</span> <span class="skolem">f</span> <span class="free">A</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> finprod_cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">use</span> assms r <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨂</span><span class="bound">a</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="bound">a</span> <span class="main">[^]</span> restrict <span class="skolem">r</span> <span class="free">A</span> <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">𝟭</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"restrict <span class="skolem">r</span> <span class="free">A</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>restrict <span class="skolem">r</span> <span class="free">A</span><span class="main">)</span> <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">r</span> <span class="skolem">a</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> r z <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">a</span> <span class="main">=</span> <span class="main">𝟭</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> comm_group<span class="main">)</span> stronger_PiE_finprod_imp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">f</span> <span class="main">∈</span> Pi<span class="hidden">⇩</span><sub>E</sub> <span class="free">A</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">a</span><span class="main">}</span><span class="main">)</span><span class="main">.</span> finprod <span class="free">G</span> <span class="bound">f</span> <span class="free">A</span> <span class="main">=</span> <span class="main">𝟭</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">a</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">a</span> <span class="main">=</span> <span class="main">𝟭</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">f</span> <span class="main">∈</span> Pi<span class="hidden">⇩</span><sub>E</sub> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">a</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span> id<span class="main">.</span>
         finprod <span class="free">G</span> <span class="bound">f</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">a</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">𝟭</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">H</span><span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">a</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">A</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">H</span> <span class="main">=</span> <span class="main">𝟭</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span>
  <span class="keyword3"><span class="command">assume</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> Pi<span class="hidden">⇩</span><sub>E</sub> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">a</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span> id"</span></span> <span class="quoted"><span class="quoted">"finprod <span class="free">G</span> <span class="skolem">f</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">a</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">𝟭</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">=</span> inv_into <span class="free">A</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">a</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">a</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> Bs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">B</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="keyword2"><span class="keyword">where</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">∈</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">a</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> inv_into <span class="free">A</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">a</span><span class="main">}</span><span class="main">)</span> <span class="skolem">C</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> B_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">=</span> generate <span class="free">G</span> <span class="main">{</span><span class="skolem">c</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> C someI_ex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">∧</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">y</span><span class="main">}</span> <span class="main">=</span> <span class="skolem">C</span>"</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> inv_into_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> sI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">B</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">B</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Bs <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">A</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">B</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">C</span>
      <span class="keyword3"><span class="command">assume</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">A</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> inv_into <span class="free">A</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">a</span><span class="main">}</span><span class="main">)</span> <span class="skolem">C</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> B_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">=</span> generate <span class="free">G</span> <span class="main">{</span><span class="skolem">c</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">with</span></span> C x someI_ex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">∧</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">y</span><span class="main">}</span> <span class="main">=</span> <span class="skolem">C</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"generate <span class="free">G</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span> <span class="main">=</span> <span class="skolem">C</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> inv_into_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">with</span></span> x C <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">B</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> B_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> fBc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">(</span>generate <span class="free">G</span> <span class="main">{</span><span class="skolem">b</span><span class="main">}</span><span class="main">)</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="skolem">B</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">b</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">(</span>generate <span class="free">G</span> <span class="main">{</span><span class="skolem">b</span><span class="main">}</span><span class="main">)</span> <span class="main">∈</span> generate <span class="free">G</span> <span class="main">{</span><span class="skolem">b</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f<span class="main">(</span>1<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> sI<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">use</span> that <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">fastforce</span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"generate <span class="free">G</span> <span class="main">{</span><span class="skolem">b</span><span class="main">}</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> that Bs generate_incl <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"restrict <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">a</span><span class="main">∈</span><span class="skolem">B</span> <span class="keyword1">then</span> <span class="skolem">f</span> <span class="main">(</span>generate <span class="free">G</span> <span class="main">{</span><span class="bound">a</span><span class="main">}</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">𝟭</span><span class="main">)</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="main">∈</span> Pi<span class="hidden">⇩</span><sub>E</sub> <span class="free">A</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">a</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="skolem">x</span> <span class="main">=</span> undefined"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="skolem">x</span> <span class="main">∈</span> generate <span class="free">G</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="keyword1"><span class="command">using</span></span> that generate.one B_def f<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finprod <span class="free">G</span> <span class="var">?r</span> <span class="free">A</span> <span class="main">=</span> <span class="main">𝟭</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">=</span> <span class="skolem">B</span> <span class="main">∪</span> <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="skolem">B</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Bs <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finprod <span class="free">G</span> <span class="var">?r</span> <span class="free">A</span> <span class="main">=</span> finprod <span class="free">G</span> <span class="var">?r</span> <span class="main">(</span><span class="skolem">B</span><span class="main">∪</span><span class="main">(</span><span class="free">A</span><span class="main">-</span><span class="skolem">B</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> finprod <span class="free">G</span> <span class="var">?r</span> <span class="skolem">B</span> <span class="main">⊗</span> finprod <span class="free">G</span> <span class="var">?r</span> <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="skolem">B</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> finprod_Un_disjoint<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> True Bs finite_subset <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">B</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="skolem">B</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">∩</span> <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="skolem">B</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">a</span> <span class="main">∈</span> <span class="skolem">B</span> <span class="keyword1">then</span> <span class="skolem">f</span> <span class="main">(</span>generate <span class="free">G</span> <span class="main">{</span><span class="bound">a</span><span class="main">}</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">𝟭</span><span class="main">)</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">-</span> <span class="skolem">B</span> <span class="main">→</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Bs <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> fBc <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">a</span> <span class="main">∈</span> <span class="skolem">B</span> <span class="keyword1">then</span> <span class="skolem">f</span> <span class="main">(</span>generate <span class="free">G</span> <span class="main">{</span><span class="bound">a</span><span class="main">}</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">𝟭</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">B</span> <span class="main">→</span> carrier <span class="free">G</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Bs <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finprod <span class="free">G</span> <span class="var">?r</span> <span class="skolem">B</span> <span class="main">=</span> <span class="main">𝟭</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finprod <span class="free">G</span> <span class="var">?r</span> <span class="skolem">B</span> <span class="main">=</span> finprod <span class="free">G</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">a</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="skolem">B</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> finprod_cong'<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="skolem">b</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">a</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="skolem">b</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="skolem">B</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">b</span> <span class="keyword1"><span class="command">using</span></span> that Bs <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">a</span><span class="main">}</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">B</span> <span class="main">→</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fBc <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> finprod <span class="free">G</span> <span class="skolem">f</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">a</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">B</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> finprod_comp<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span> <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">a</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">B</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fBc <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">a</span><span class="main">}</span><span class="main">)</span> <span class="skolem">B</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> inj_onI<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> B_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> f_inv_into_f inv_into_into<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> finprod <span class="free">G</span> <span class="skolem">f</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">a</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sI <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> f<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finprod <span class="free">G</span> <span class="var">?r</span> <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="skolem">B</span><span class="main">)</span> <span class="main">=</span> <span class="main">𝟭</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">intro</span> finprod_one_eqI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> finprod_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="var">?r</span> <span class="bound">a</span> <span class="main">=</span> <span class="main">𝟭</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> BA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">∈</span><span class="skolem">B</span><span class="main">∩</span><span class="free">A</span><span class="main">.</span> <span class="var">?r</span> <span class="bound">a</span> <span class="main">=</span> <span class="main">𝟭</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> Bs sI <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="main">(</span>generate <span class="free">G</span> <span class="main">{</span><span class="bound">a</span><span class="main">}</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">B</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="main">∃</span><span class="bound">b</span><span class="main">∈</span><span class="skolem">B</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">(</span>generate <span class="free">G</span> <span class="main">{</span><span class="bound">a</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">f</span> <span class="main">(</span>generate <span class="free">G</span> <span class="main">{</span><span class="bound">b</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">H</span><span class="main">∈</span><span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">a</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">A</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">H</span> <span class="main">=</span> <span class="main">𝟭</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a BA Bs <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> comm_group<span class="main">)</span> finprod_relations_triv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"relations <span class="free">A</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="main">0</span><span class="main">::</span>int<span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">f</span> <span class="main">∈</span> Pi<span class="hidden">⇩</span><sub>E</sub> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">a</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span> id<span class="main">.</span>
         finprod <span class="free">G</span> <span class="bound">f</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">a</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">𝟭</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">H</span><span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">a</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="free">A</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">H</span> <span class="main">=</span> <span class="main">𝟭</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms finprod_relations_triv_harder_better_stronger stronger_PiE_finprod_imp <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> comm_group<span class="main">)</span> ord_zero_strong_imp_rel_triv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> ord <span class="bound">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">f</span> <span class="main">∈</span> Pi<span class="hidden">⇩</span><sub>E</sub> <span class="free">A</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">a</span><span class="main">}</span><span class="main">)</span><span class="main">.</span> finprod <span class="free">G</span> <span class="bound">f</span> <span class="free">A</span> <span class="main">=</span> <span class="main">𝟭</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">a</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">a</span> <span class="main">=</span> <span class="main">𝟭</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"relations <span class="free">A</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="main">0</span><span class="main">::</span>int<span class="main">)</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="main">∈</span> relations <span class="free">A</span> <span class="main">⟹</span> <span class="bound">r</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="main">0</span><span class="main">::</span>int<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">r</span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> relations <span class="free">A</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="main">0</span><span class="main">::</span>int<span class="main">)</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"restrict <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">[^]</span> <span class="skolem">r</span> <span class="bound">a</span><span class="main">)</span> <span class="free">A</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> rp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="main">∈</span> Pi<span class="hidden">⇩</span><sub>E</sub> <span class="free">A</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">a</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="main">∈</span> extensional <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="main">∈</span> Pi <span class="free">A</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">a</span><span class="main">}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span>
          <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> sga<span class="main">:</span> <span class="quoted"><span class="quoted">"subgroup <span class="main">(</span>generate <span class="free">G</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span><span class="main">)</span> <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> generate_is_subgroup assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">[^]</span> <span class="skolem">r</span> <span class="skolem">a</span> <span class="main">∈</span> generate <span class="free">G</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> generate.incl<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">a</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="free">G</span></span><span class="main">]</span> subgroup_int_pow_closed<span class="main">[</span><span class="operator">OF</span> sga<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> PiE_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finprod <span class="free">G</span> <span class="var">?r</span> <span class="free">A</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨂</span><span class="bound">a</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="bound">a</span> <span class="main">[^]</span> <span class="skolem">r</span> <span class="bound">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">intro</span> finprod_cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">use</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> r <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finprod <span class="free">G</span> <span class="var">?r</span> <span class="free">A</span> <span class="main">=</span> <span class="main">𝟭</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> relations_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>3<span class="main">)</span> rp <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="var">?r</span> <span class="bound">a</span> <span class="main">=</span> <span class="main">𝟭</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="bound">a</span> <span class="main">[^]</span> <span class="skolem">r</span> <span class="bound">a</span> <span class="main">=</span> <span class="main">𝟭</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">,</span> 2<span class="main">)</span> True <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> finite_cyclic_subgroup_int infinite_cyclic_subgroup_order <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> r <span class="keyword1"><span class="command">unfolding</span></span> relations_def extensional_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> triv_rel <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> comm_group<span class="main">)</span> compl_fam_iff_relations_triv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">gs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">gs</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">g</span><span class="main">∈</span><span class="free">gs</span><span class="main">.</span> ord <span class="bound">g</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"relations <span class="free">gs</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">∈</span><span class="free">gs</span><span class="main">.</span> <span class="main">0</span><span class="main">::</span>int<span class="main">)</span><span class="main">}</span> <span class="main">⟷</span> compl_fam <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">g</span><span class="main">}</span><span class="main">)</span> <span class="free">gs</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> triv_finprod_iff_compl_fam_PiE<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">g</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">g</span><span class="main">}</span>"</span></span><span class="main">,</span> <span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> generate_is_subgroup<span class="main">]</span>
        ord_zero_strong_imp_rel_triv<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">,</span></span> 3<span class="main"><span class="main">)</span></span><span class="main">]</span>
        finprod_relations_triv_harder_better_stronger<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Finitely_Generated_Abelian_Groups">
<div class="head">
<h1>Theory Finitely_Generated_Abelian_Groups</h1>
</div>
<pre class="source"><span class="comment1">(*
    File:     Finitely_Generated_Abelian_Groups.thy
    Author:   Joseph Thommes, TU München
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Fundamental Theorem of Finitely Generated Abelian Groups›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Finitely_Generated_Abelian_Groups
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="#DirProds">DirProds</a> <a href="#Group_Relations">Group_Relations</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">notation</span></span> integer_mod_group <span class="main">(</span><span class="quoted">"<span class="keyword1">Z</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">locale</span></span> fin_gen_comm_group <span class="main">=</span> comm_group <span class="main">+</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">gen</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> gens_closed<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">gen</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     fin_gen<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">gen</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     generators<span class="main">:</span> <span class="quoted"><span class="quoted">"carrier <span class="free">G</span> <span class="main">=</span> generate <span class="free">G</span> <span class="free">gen</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Every finite abelian group is also finitely generated.›</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> finite_comm_group <span class="main">⊆</span> fin_gen_comm_group <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="quoted">"carrier <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> generate_incl generate_sincl <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This lemma contains the proof of Kemper from his lecture notes on algebra~\cite{kemper}.
However, the proof is not done in the context of a finitely generated group but for a finitely
generated subgroup in a commutative group.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> comm_group<span class="main">)</span> ex_idirgen<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">gs</span><span class="main">.</span> set <span class="bound">gs</span> <span class="main">⊆</span> generate <span class="free">G</span> <span class="free">A</span> <span class="main">∧</span> distinct <span class="bound">gs</span> <span class="main">∧</span> is_idirprod <span class="main">(</span>generate <span class="free">G</span> <span class="free">A</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">g</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span>set <span class="bound">gs</span><span class="main">)</span>
            <span class="main">∧</span> successively <span class="keyword1">(dvd)</span> <span class="main">(</span>map ord <span class="bound">gs</span><span class="main">)</span> <span class="main">∧</span> card <span class="main">(</span>set <span class="bound">gs</span><span class="main">)</span> <span class="main">≤</span> card <span class="free">A</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?t</span> <span class="free">A</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"card <span class="free">A</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">A</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> nat_less_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> i<span class="main">:</span> 1
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"relations <span class="skolem">A</span> <span class="main">=</span> <span class="main">{</span>restrict <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">0</span><span class="main">::</span>int<span class="main">)</span> <span class="skolem">A</span><span class="main">}</span>"</span></span><span class="main">)</span> <span class="comment1">(* only trivial relation *)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">have</span></span> fi<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">gs</span></span> <span class="keyword2"><span class="keyword">where</span></span> gs<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">gs</span> <span class="main">=</span> <span class="skolem">A</span>"</span></span> <span class="quoted"><span class="quoted">"distinct <span class="skolem">gs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> finite_distinct_list<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> o<span class="main">:</span> <span class="quoted"><span class="quoted">"ord <span class="skolem">g</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> set <span class="skolem">gs</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">g</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> relations_zero_imp_ord_zero<span class="main"><span class="main">[</span></span><span class="operator">OF</span> that<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">use</span> i<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> that True gs <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"map ord <span class="skolem">gs</span> <span class="main">=</span> replicate <span class="main">(</span>length <span class="skolem">gs</span><span class="main">)</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> o
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">gs</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> exI conjI subsetI<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="skolem">gs</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">∈</span> generate <span class="free">G</span> <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> gs generate.incl<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="skolem">A</span></span> <span class="quoted"><span class="free">G</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"distinct <span class="skolem">gs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_idirprod <span class="main">(</span>generate <span class="free">G</span> <span class="skolem">A</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">g</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span>set <span class="skolem">gs</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">unfold</span> is_idirprod_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span><span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"generate <span class="free">G</span> <span class="main">{</span><span class="skolem">g</span><span class="main">}</span> <span class="main">⊲</span> <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> set <span class="skolem">gs</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">g</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> subgroup_imp_normal<span class="main"><span class="keyword3">,</span></span> <span class="operator">use</span> that generate_is_subgroup i<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> gs <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"generate <span class="free">G</span> <span class="skolem">A</span> <span class="main">=</span> IDirProds <span class="free">G</span> <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">g</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span>set <span class="skolem">gs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> IDirProds_def
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> gs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">use</span> generate_idem_Un i<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">blast</span><span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"compl_fam <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">g</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span>set <span class="skolem">gs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> compl_fam_iff_relations_triv<span class="main">[</span><span class="operator">OF</span> i<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">,</span></span> 3<span class="main"><span class="main">)</span></span><span class="main">]</span> o gs<span class="main">(</span>1<span class="main">)</span> True
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"successively <span class="keyword1">(dvd)</span> <span class="main">(</span>map ord <span class="skolem">gs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> m
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">gs</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> c<span class="main">:</span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">gs</span><span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">gs</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>set <span class="skolem">gs</span><span class="main">)</span> <span class="main">≤</span> card <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> gs <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> ntrel<span class="main">:</span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> Ane<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> i<span class="main">(</span>2<span class="main">)</span> triv_rel<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">A</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> relations_def extensional_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">from</span></span> ntrel <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="skolem">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">r</span> <span class="main">∈</span>relations <span class="skolem">A</span><span class="main">.</span> <span class="bound">r</span> <span class="skolem">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i<span class="main">(</span>2<span class="main">)</span> triv_rel<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">A</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">unfolding</span></span> relations_def extensional_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">hence</span></span> ac<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> iH<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">B</span><span class="main">.</span><span class="main">⟦</span>card <span class="bound">B</span> <span class="main">&lt;</span> card <span class="skolem">A</span><span class="main">;</span> finite <span class="bound">B</span><span class="main">;</span> <span class="bound">B</span> <span class="main">⊆</span> carrier <span class="free">G</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="var">?t</span> <span class="bound">B</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> i<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> iH2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">B</span><span class="main">.</span> <span class="main">⟦</span><span class="var">?t</span> <span class="bound">B</span><span class="main">;</span> generate <span class="free">G</span> <span class="skolem">A</span> <span class="main">=</span> generate <span class="free">G</span> <span class="bound">B</span><span class="main">;</span> card <span class="bound">B</span> <span class="main">&lt;</span> card <span class="skolem">A</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="var">?t</span> <span class="skolem">A</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="keyword1">inv</span> <span class="skolem">a</span> <span class="main">∈</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span><span class="main">)</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"generate <span class="free">G</span> <span class="skolem">A</span> <span class="main">=</span> generate <span class="free">G</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> generate_subset_eqI<span class="main"><span class="main">[</span></span><span class="operator">OF</span> i<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span><span class="main">)</span> <span class="main">⊆</span> generate <span class="free">G</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> generate <span class="free">G</span> <span class="main">{</span><span class="keyword1">inv</span> <span class="skolem">a</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> generate.inv<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1">inv</span> <span class="skolem">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="keyword1">inv</span> <span class="skolem">a</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="free">G</span></span><span class="main">]</span> ac <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> generate <span class="free">G</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mono_generate<span class="main"><span class="keyword3">,</span></span> <span class="operator">use</span> True <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">simp</span><span class="main">)</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?t</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> iH<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem">A</span></span></span> <span class="main"><span class="main"><span class="main">-</span></span></span> <span class="main"><span class="main"><span class="main">{</span></span></span><span class="skolem"><span class="skolem"><span class="skolem">a</span></span></span><span class="main"><span class="main"><span class="main">}</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">use</span> i<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">,</span></span> 3<span class="main"><span class="main">)</span></span> a<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">meson</span> Ane card_gt_0_iff diff_Suc_less<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> card.remove<span class="main">[</span><span class="operator">OF</span> i<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> a<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> inv<span class="main">:</span> False
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> card <span class="skolem">A</span>"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">all_gens</span></span> <span class="keyword2"><span class="keyword">where</span></span>
        <span class="quoted"><span class="quoted">"<span class="skolem">all_gens</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">gs</span></span><span class="main">∈</span>Pow <span class="main">(</span>generate <span class="free">G</span> <span class="skolem">A</span><span class="main">)</span><span class="main">.</span> finite <span class="bound">gs</span> <span class="main">∧</span> card <span class="bound">gs</span> <span class="main">≤</span> <span class="skolem">n</span> <span class="main">∧</span> generate <span class="free">G</span> <span class="bound">gs</span> <span class="main">=</span> generate <span class="free">G</span> <span class="skolem">A</span><span class="main">}</span>"</span></span>

      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">exps</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">exps</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">gs'</span><span class="main">∈</span><span class="skolem">all_gens</span><span class="main">.</span> <span class="main">⋃</span><span class="bound">rel</span><span class="main">∈</span>relations <span class="bound">gs'</span><span class="main">.</span> nat <span class="main">`</span> <span class="main">{</span><span class="bound"><span class="bound">e</span></span><span class="main">∈</span><span class="bound">rel</span><span class="main">`</span><span class="bound">gs'</span><span class="main">.</span> <span class="bound">e</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">min_exp</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">min_exp</span> <span class="main">=</span> Inf <span class="skolem">exps</span>"</span></span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">exps</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?B</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="keyword1">inv</span> <span class="skolem">a</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">∈</span> <span class="skolem">all_gens</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> all_gens_def <span class="keyword1"><span class="command">using</span></span> generate.incl n i<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?B</span> <span class="main">∈</span> <span class="skolem">all_gens</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="skolem">A</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a n <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> card_Diff_singleton_if i<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"card <span class="var">?B</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> inv i<span class="main">(</span>2<span class="main">,</span> 3<span class="main">)</span> n a<span class="main">(</span>1<span class="main">)</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Un_empty_right Un_insert_right card.remove card_insert_disjoint finite_Diff<span class="main">)</span> 
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"generate <span class="free">G</span> <span class="skolem">A</span> <span class="main">=</span> generate <span class="free">G</span> <span class="var">?B</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> generate_one_switched_eqI<span class="main"><span class="main">[</span></span><span class="operator">OF</span> i<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> a<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="keyword1"><span class="keyword1">inv</span></span> <span class="skolem"><span class="skolem">a</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">inv</span> <span class="skolem">a</span> <span class="main">∈</span> generate <span class="free">G</span> <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> generate.inv<span class="main">[</span><span class="operator">OF</span> a<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">G</span></span><span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> generate <span class="free">G</span> <span class="var">?B</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> generate <span class="free">G</span> <span class="main">{</span><span class="keyword1">inv</span> <span class="skolem">a</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> generate.inv<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1">inv</span> <span class="skolem">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="keyword1">inv</span> <span class="skolem">a</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="free">G</span></span><span class="main">]</span> ac <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> generate <span class="free">G</span> <span class="var">?B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mono_generate<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
              <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span> <span class="quoted"><span class="quoted">"<span class="var">?B</span> <span class="main">⊆</span> generate <span class="free">G</span> <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> generate_sincl <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> all_gens_def <span class="keyword1"><span class="command">using</span></span> i<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">r</span> <span class="main">∈</span> relations <span class="skolem">A</span><span class="main">.</span> <span class="bound">r</span> <span class="skolem">a</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">r</span> <span class="main">∈</span> relations <span class="var">?B</span><span class="main">.</span> <span class="bound">r</span> <span class="main">(</span><span class="keyword1">inv</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">r</span> <span class="main">∈</span> relations <span class="skolem">A</span><span class="main">.</span> <span class="bound">r</span> <span class="skolem">a</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">with</span></span> a <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> relations <span class="skolem">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="skolem">a</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
          <span class="keyword1"><span class="command">have</span></span> rc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">[^]</span> <span class="skolem">r</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">A</span> <span class="main">→</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i<span class="main">(</span>3<span class="main">)</span> int_pow_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"restrict <span class="main">(</span><span class="skolem">r</span><span class="main">(</span><span class="keyword1">inv</span> <span class="skolem">a</span> <span class="main">:=</span> <span class="main">-</span> <span class="skolem">r</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> <span class="var">?B</span>"</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="main">∈</span> relations <span class="var">?B</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finprod <span class="free">G</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">[^]</span> <span class="var">?r</span> <span class="bound">x</span><span class="main">)</span> <span class="var">?B</span> <span class="main">=</span> finprod <span class="free">G</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">[^]</span> <span class="skolem">r</span> <span class="bound">x</span><span class="main">)</span> <span class="skolem">A</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finprod <span class="free">G</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">[^]</span> <span class="var">?r</span> <span class="bound">x</span><span class="main">)</span> <span class="var">?B</span>
                  <span class="main">=</span> finprod <span class="free">G</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">[^]</span> <span class="var">?r</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span>insert <span class="main">(</span><span class="keyword1">inv</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">inv</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">[^]</span> <span class="var">?r</span> <span class="main">(</span><span class="keyword1">inv</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">⊗</span> finprod <span class="free">G</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">[^]</span> <span class="var">?r</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> finprod_insert<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ inv<span class="main"><span class="main">]</span></span><span class="main">)</span>
                <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="skolem">A</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
                <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">inv</span> <span class="skolem">a</span> <span class="main">[^]</span> <span class="var">?r</span> <span class="main">(</span><span class="keyword1">inv</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> int_pow_closed<span class="main">[</span><span class="operator">OF</span> inv_closed<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ac<span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
                <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">[^]</span> <span class="var">?r</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">A</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span> <span class="main">→</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> int_pow_closed i<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
              <span class="keyword1"><span class="command">qed</span></span>
              <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">[^]</span> <span class="skolem">r</span> <span class="skolem">a</span> <span class="main">⊗</span> finprod <span class="free">G</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">[^]</span> <span class="skolem">r</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">inv</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">[^]</span> <span class="var">?r</span> <span class="main">(</span><span class="keyword1">inv</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">[^]</span> <span class="skolem">r</span> <span class="skolem">a</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> int_pow_inv int_pow_neg ac<span class="main">)</span>
                <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finprod <span class="free">G</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">[^]</span> <span class="skolem">r</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span><span class="main">)</span>
                             <span class="main">=</span> finprod <span class="free">G</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">[^]</span> <span class="var">?r</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> finprod_cong<span class="main">)</span>
                  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">[^]</span> <span class="skolem">r</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">A</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span> <span class="main">→</span> carrier <span class="free">G</span><span class="main">)</span> <span class="main">=</span> True"</span></span> <span class="keyword1"><span class="command">using</span></span> rc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">[^]</span> <span class="skolem">r</span> <span class="skolem">i</span> <span class="main">=</span> <span class="skolem">i</span> <span class="main">[^]</span> <span class="var">?r</span> <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="skolem">A</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="keyword1"><span class="command">using</span></span> that inv <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="skolem">A</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span> <span class="keyword1">=simp=&gt;</span> <span class="bound">i</span> <span class="main">[^]</span> <span class="skolem">r</span> <span class="bound">i</span> <span class="main">=</span> <span class="bound">i</span> <span class="main">[^]</span> restrict <span class="main">(</span><span class="skolem">r</span><span class="main">(</span><span class="keyword1">inv</span> <span class="skolem">a</span> <span class="main">:=</span> <span class="main">-</span> <span class="skolem">r</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="keyword1">inv</span> <span class="skolem">a</span><span class="main">}</span><span class="main">)</span> <span class="bound">i</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">algebra</span>
                <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
              <span class="keyword1"><span class="command">qed</span></span>
              <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> finprod <span class="free">G</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">[^]</span> <span class="skolem">r</span> <span class="bound">x</span><span class="main">)</span> <span class="skolem">A</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> finprod_minus<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> a<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rc i<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
              <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">𝟭</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> r <span class="keyword1"><span class="command">unfolding</span></span> relations_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
            <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finprod <span class="free">G</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">[^]</span> <span class="var">?r</span> <span class="bound">x</span><span class="main">)</span> <span class="var">?B</span> <span class="main">=</span> <span class="main">𝟭</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
          <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> r <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> exps_def <span class="keyword1"><span class="command">using</span></span> a <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">hence</span></span> me<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">min_exp</span> <span class="main">∈</span> <span class="skolem">exps</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> min_exp_def <span class="keyword1"><span class="command">using</span></span> Inf_nat_def1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">from</span></span> cInf_lower min_exp_def <span class="keyword1"><span class="command">have</span></span> le<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">exps</span> <span class="main">⟹</span> <span class="skolem">min_exp</span> <span class="main">≤</span> <span class="bound">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> me <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">gs</span></span> <span class="skolem"><span class="skolem">rel</span></span> <span class="skolem"><span class="skolem">g</span></span>
        <span class="keyword2"><span class="keyword">where</span></span> gr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">gs</span> <span class="main">∈</span> <span class="skolem">all_gens</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">rel</span> <span class="main">∈</span> relations <span class="skolem">gs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="skolem">gs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">rel</span> <span class="skolem">g</span> <span class="main">=</span> <span class="skolem">min_exp</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">min_exp</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> exps_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> gr<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> cgs<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="skolem">gs</span> <span class="main">≤</span> card <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> all_gens_def n <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">with</span></span> gr<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> cgsg<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="skolem">gs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">g</span><span class="main">}</span><span class="main">)</span> <span class="main">&lt;</span> card <span class="skolem">A</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ane card.infinite card_Diff1_less card_gt_0_iff finite.emptyI
                  finite.insertI finite_Diff2 i.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> le_neq_implies_less less_trans<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> gr<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> fgs<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">gs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> gsg<span class="main">:</span> <span class="quoted"><span class="quoted">"generate <span class="free">G</span> <span class="skolem">gs</span> <span class="main">=</span> generate <span class="free">G</span> <span class="skolem">A</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> all_gens_def n <span class="keyword1"><span class="command">using</span></span> i<span class="main">(</span>2<span class="main">)</span> card.infinite Ane <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">from</span></span> gsg <span class="keyword1"><span class="command">have</span></span> gsc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">gs</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> all_gens_def
        <span class="keyword1"><span class="command">using</span></span> generate_incl<span class="main">[</span><span class="operator">OF</span> i<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span> generate_sincl<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">gs</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> gc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> gr<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> ihgsg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?t</span> <span class="main">(</span><span class="skolem">gs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">g</span><span class="main">}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> iH<span class="main"><span class="keyword3">,</span></span> <span class="operator">use</span> cgs fgs gsc gr<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> cgsg <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">hs</span></span> <span class="keyword2"><span class="keyword">where</span></span>
        hs<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">hs</span> <span class="main">⊆</span> generate <span class="free">G</span> <span class="main">(</span><span class="skolem">gs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">g</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"distinct <span class="skolem">hs</span>"</span></span>
            <span class="quoted"><span class="quoted">"is_idirprod <span class="main">(</span>generate <span class="free">G</span> <span class="main">(</span><span class="skolem">gs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">g</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">g</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span>set <span class="skolem">hs</span><span class="main">)</span>"</span></span>
            <span class="quoted"><span class="quoted">"successively <span class="keyword1">(dvd)</span> <span class="main">(</span>map ord <span class="skolem">hs</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>set <span class="skolem">hs</span><span class="main">)</span> <span class="main">≤</span> card <span class="main">(</span><span class="skolem">gs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">g</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> hsc<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">hs</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> generate_sincl<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"set <span class="skolem">hs</span>"</span></span><span class="main">]</span> generate_incl<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">gs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">g</span><span class="main">}</span>"</span></span><span class="main">]</span> gsc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> hs<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> ghs<span class="main">:</span> <span class="quoted"><span class="quoted">"generate <span class="free">G</span> <span class="main">(</span><span class="skolem">gs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">g</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> generate <span class="free">G</span> <span class="main">(</span>set <span class="skolem">hs</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> is_idirprod_def IDirProds_def <span class="keyword1"><span class="command">using</span></span> generate_idem_Un<span class="main">[</span><span class="operator">OF</span> hsc<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
      <span class="keyword1"><span class="command">have</span></span> dvot<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?t</span> <span class="skolem">A</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∀</span><span class="bound">e</span><span class="main">∈</span><span class="skolem">rel</span><span class="main">`</span><span class="skolem">gs</span><span class="main">.</span> <span class="skolem">rel</span> <span class="skolem">g</span> <span class="keyword1">dvd</span> <span class="bound">e</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> disjCI<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> na<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∀</span><span class="bound">e</span><span class="main">∈</span><span class="skolem">rel</span> <span class="main">`</span> <span class="skolem">gs</span><span class="main">.</span> <span class="skolem">rel</span> <span class="skolem">g</span> <span class="keyword1">dvd</span> <span class="bound">e</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">x</span> <span class="main">∈</span> <span class="skolem">gs</span><span class="main">;</span> <span class="main">¬</span><span class="skolem">rel</span> <span class="skolem">g</span> <span class="keyword1">dvd</span> <span class="skolem">rel</span> <span class="bound">x</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="var">?t</span> <span class="skolem">A</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
          <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">gs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">rel</span> <span class="skolem">g</span> <span class="keyword1">dvd</span> <span class="skolem">rel</span> <span class="skolem">x</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> xng<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">from</span></span> x <span class="keyword1"><span class="command">have</span></span> xc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> gsc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">have</span></span> rg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">rel</span> <span class="skolem">g</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> gr <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">r</span></span><span class="main">::</span><span class="quoted">int</span> <span class="keyword2"><span class="keyword">where</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">=</span> <span class="skolem">rel</span> <span class="skolem">x</span> <span class="keyword1">mod</span> <span class="skolem">rel</span> <span class="skolem">g</span>"</span></span>
          <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">q</span></span><span class="main">::</span><span class="quoted">int</span> <span class="keyword2"><span class="keyword">where</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> <span class="skolem">rel</span> <span class="skolem">x</span> <span class="keyword1">div</span> <span class="skolem">rel</span> <span class="skolem">g</span>"</span></span>
          <span class="keyword1"><span class="command">from</span></span> r rg x <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> mod_int_pos_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">rel</span> <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">rel</span> <span class="skolem">g</span>"</span></span><span class="main">]</span> mod_eq_0_iff_dvd <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">&lt;</span> <span class="skolem">rel</span> <span class="skolem">g</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> r rg Euclidean_Division.pos_mod_bound <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">rel</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">q</span> <span class="main">*</span> <span class="skolem">rel</span> <span class="skolem">g</span> <span class="main">+</span> <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> r q <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> rq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">rel</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">q</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">rel</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">r</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">r</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">&lt;</span> <span class="skolem">rel</span> <span class="skolem">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> <span class="skolem">g</span> <span class="main">⊗</span> <span class="skolem">x</span> <span class="main">[^]</span> <span class="skolem">q</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> tc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> gsc gr<span class="main">(</span>3<span class="main">)</span> x <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
          <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> <span class="skolem">gs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">g</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> fs<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fgs <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">have</span></span> sc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> s tc gsc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">have</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"generate <span class="free">G</span> <span class="skolem">gs</span> <span class="main">=</span> generate <span class="free">G</span> <span class="skolem">s</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">unfold</span> s<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> generate_one_switched_eqI<span class="main"><span class="main">[</span></span><span class="operator">OF</span> gsc gr<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">t</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> generate <span class="free">G</span> <span class="skolem">gs</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">unfold</span> t<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> generate.eng<span class="main">)</span>
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> generate <span class="free">G</span> <span class="skolem">gs</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> gr<span class="main">(</span>3<span class="main">)</span> generate.incl <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">[^]</span> <span class="skolem">q</span> <span class="main">∈</span> generate <span class="free">G</span> <span class="skolem">gs</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> x generate_pow<span class="main">[</span><span class="operator">OF</span> xc<span class="main">]</span> generate_sincl<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">x</span><span class="main">}</span>"</span></span><span class="main">]</span> mono_generate<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">x</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="skolem">gs</span></span><span class="main">]</span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> generate <span class="free">G</span> <span class="main">(</span><span class="skolem">gs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">g</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
              <span class="keyword1"><span class="command">have</span></span> gti<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> <span class="skolem">t</span> <span class="main">⊗</span> <span class="keyword1">inv</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">[^]</span> <span class="skolem">q</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> inv_solve_right<span class="main">[</span><span class="operator">OF</span> gc tc int_pow_closed<span class="main"><span class="main">[</span></span><span class="operator">OF</span> xc<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="skolem">q</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span> t <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
              <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> generate <span class="free">G</span> <span class="main">(</span><span class="skolem">gs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">g</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> generate.incl<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">t</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
              <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">inv</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">[^]</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">∈</span> generate <span class="free">G</span> <span class="main">(</span><span class="skolem">gs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">g</span><span class="main">}</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">[^]</span> <span class="skolem">q</span> <span class="main">∈</span> generate <span class="free">G</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> generate_pow<span class="main">[</span><span class="operator">OF</span> xc<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                <span class="keyword1"><span class="command">from</span></span> generate_m_inv_closed<span class="main">[</span><span class="operator">OF</span> _ this<span class="main">]</span> xc
                <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">inv</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">[^]</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">∈</span> generate <span class="free">G</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"generate <span class="free">G</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span> <span class="main">⊆</span> generate <span class="free">G</span> <span class="main">(</span><span class="skolem">gs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">g</span><span class="main">}</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mono_generate<span class="main"><span class="keyword3">,</span></span> <span class="operator">use</span> x a <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">force</span><span class="main">)</span>
                <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
              <span class="keyword1"><span class="command">qed</span></span>
              <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                <span class="keyword1"><span class="command">using</span></span> generate.eng mono_generate<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">gs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">g</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">gs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">g</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">gs</span><span class="main">;</span> <span class="main">¬</span> <span class="skolem">rel</span> <span class="skolem">g</span> <span class="keyword1">dvd</span> <span class="skolem">rel</span> <span class="skolem">x</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="var">?t</span> <span class="skolem">A</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="skolem">gs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">g</span><span class="main">}</span>"</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> xt<span class="main">:</span> True
            <span class="keyword1"><span class="command">from</span></span> xt <span class="keyword1"><span class="command">have</span></span> gts<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> <span class="skolem">gs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">g</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x s <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="skolem">gs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">g</span><span class="main">}</span><span class="main">)</span> <span class="main">&lt;</span> card <span class="skolem">gs</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fgs gr<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> card_Diff1_less<span class="main">)</span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>set <span class="skolem">hs</span><span class="main">)</span> <span class="main">&lt;</span> card <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hs<span class="main">(</span>5<span class="main">)</span> cgs <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">hs</span> <span class="main">⊆</span> generate <span class="free">G</span> <span class="main">(</span>set <span class="skolem">hs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> generate_sincl <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"distinct <span class="skolem">hs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_idirprod <span class="main">(</span>generate <span class="free">G</span> <span class="main">(</span>set <span class="skolem">hs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">g</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span>set <span class="skolem">hs</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> hs ghs <span class="keyword1"><span class="command">unfolding</span></span> is_idirprod_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"generate <span class="free">G</span> <span class="skolem">A</span> <span class="main">=</span> generate <span class="free">G</span> <span class="main">(</span>set <span class="skolem">hs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> g gts ghs gsg <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"successively <span class="keyword1">(dvd)</span> <span class="main">(</span>map ord <span class="skolem">hs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?t</span> <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> iH2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> tngsg<span class="main">:</span> False
            <span class="keyword1"><span class="command">hence</span></span> xnt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x xng <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">rel</span> <span class="skolem">g</span> <span class="keyword1">dvd</span> <span class="skolem">rel</span> <span class="skolem">x</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nat <span class="skolem">r</span> <span class="main">∈</span> <span class="skolem">exps</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> exps_def
              <span class="keyword1"><span class="command">proof</span></span>
                <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="skolem">all_gens</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> all_gens_def
                  <span class="keyword1"><span class="command">using</span></span> gsg g fgs generate_sincl<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">s</span></span><span class="main">]</span> switch_elem_card_le<span class="main">[</span><span class="operator">OF</span> gr<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">t</span></span><span class="main">]</span> cgs n s
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">have</span></span> xs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> s xng x<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                <span class="keyword1"><span class="command">have</span></span> ts<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> s <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
                <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"nat <span class="skolem">r</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">rel</span><span class="main">∈</span>relations <span class="skolem">s</span><span class="main">.</span> nat <span class="main">`</span> <span class="main">{</span><span class="bound"><span class="bound">e</span></span> <span class="main">∈</span> <span class="bound">rel</span> <span class="main">`</span> <span class="skolem">s</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">e</span><span class="main">}</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">proof</span></span>
                  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"restrict <span class="main">(</span><span class="skolem">rel</span><span class="main">(</span><span class="skolem">x</span> <span class="main">:=</span> <span class="skolem">r</span><span class="main">,</span> <span class="skolem">t</span> <span class="main">:=</span> <span class="skolem">rel</span> <span class="skolem">g</span><span class="main">)</span><span class="main">)</span> <span class="skolem">s</span>"</span></span>
                  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="main">∈</span> relations <span class="skolem">s</span>"</span></span>
                  <span class="keyword1"><span class="command">proof</span></span>
                    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finprod <span class="free">G</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">[^]</span> <span class="var">?r</span> <span class="bound">x</span><span class="main">)</span> <span class="skolem">s</span> <span class="main">=</span> finprod <span class="free">G</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">[^]</span> <span class="skolem">rel</span> <span class="bound">x</span><span class="main">)</span> <span class="skolem">gs</span>"</span></span>
                    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finprod <span class="free">G</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">[^]</span> <span class="var">?r</span> <span class="bound">x</span><span class="main">)</span> <span class="skolem">s</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">[^]</span> <span class="skolem">r</span> <span class="main">⊗</span> <span class="main">(</span><span class="skolem">t</span> <span class="main">[^]</span> <span class="skolem">rel</span> <span class="skolem">g</span> <span class="main">⊗</span> finprod <span class="free">G</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">[^]</span> <span class="skolem">rel</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="skolem">gs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">g</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finprod <span class="free">G</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">[^]</span> <span class="var">?r</span> <span class="bound">x</span><span class="main">)</span> <span class="skolem">s</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">[^]</span> <span class="var">?r</span> <span class="skolem">x</span> <span class="main">⊗</span> finprod <span class="free">G</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">[^]</span> <span class="var">?r</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span>"</span></span>
                          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> finprod_minus<span class="main"><span class="main">[</span></span><span class="operator">OF</span> xs _ fs<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">use</span> sc <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span> 
                        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finprod <span class="free">G</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">[^]</span> <span class="var">?r</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">t</span> <span class="main">[^]</span> <span class="var">?r</span> <span class="skolem">t</span> <span class="main">⊗</span> finprod <span class="free">G</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">[^]</span> <span class="var">?r</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span><span class="main">)</span>"</span></span>
                          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> finprod_minus<span class="main"><span class="keyword3">,</span></span> <span class="operator">use</span> ts xnt fs sc <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
                        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finprod <span class="free">G</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">[^]</span> <span class="var">?r</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> finprod <span class="free">G</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">[^]</span> <span class="skolem">rel</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span><span class="main">)</span>"</span></span>
                          <span class="keyword1"><span class="command">unfolding</span></span> s <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> finprod_cong'<span class="main"><span class="keyword3">,</span></span>  <span class="operator">use</span> gsc <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
                        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span> <span class="main">=</span> <span class="skolem">gs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">g</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> s <span class="keyword1"><span class="command">using</span></span> tngsg <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span> <span class="quoted"><span class="quoted">"finprod <span class="free">G</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">[^]</span> <span class="skolem">rel</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> finprod <span class="free">G</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">[^]</span> <span class="skolem">rel</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="skolem">gs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">g</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">[^]</span> <span class="var">?r</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">[^]</span> <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> xs xnt <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">[^]</span> <span class="var">?r</span> <span class="skolem">t</span> <span class="main">=</span> <span class="skolem">t</span> <span class="main">[^]</span> <span class="skolem">rel</span> <span class="skolem">g</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ts <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
                      <span class="keyword1"><span class="command">qed</span></span>
                      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">[^]</span> <span class="skolem">r</span> <span class="main">⊗</span> <span class="skolem">t</span> <span class="main">[^]</span> <span class="skolem">rel</span> <span class="skolem">g</span> <span class="main">⊗</span> finprod <span class="free">G</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">[^]</span> <span class="skolem">rel</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="skolem">gs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">g</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span>"</span></span>
                        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> m_assoc<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">use</span> xc tc <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> finprod_closed<span class="main"><span class="keyword3">,</span></span> <span class="operator">use</span> gsc <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">fast</span><span class="main">)</span>
                      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">g</span> <span class="main">[^]</span> <span class="skolem">rel</span> <span class="skolem">g</span> <span class="main">⊗</span> <span class="skolem">x</span> <span class="main">[^]</span> <span class="skolem">rel</span> <span class="skolem">x</span> <span class="main">⊗</span> finprod <span class="free">G</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">[^]</span> <span class="skolem">rel</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="skolem">gs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">g</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">[^]</span> <span class="skolem">r</span> <span class="main">⊗</span> <span class="skolem">t</span> <span class="main">[^]</span> <span class="skolem">rel</span> <span class="skolem">g</span> <span class="main">=</span> <span class="skolem">g</span> <span class="main">[^]</span> <span class="skolem">rel</span> <span class="skolem">g</span> <span class="main">⊗</span> <span class="skolem">x</span> <span class="main">[^]</span> <span class="skolem">rel</span> <span class="skolem">x</span>"</span></span>
                        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">[^]</span> <span class="skolem">r</span> <span class="main">⊗</span> <span class="skolem">t</span> <span class="main">[^]</span> <span class="skolem">rel</span> <span class="skolem">g</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">[^]</span> <span class="skolem">r</span> <span class="main">⊗</span> <span class="main">(</span><span class="skolem">g</span> <span class="main">⊗</span> <span class="skolem">x</span> <span class="main">[^]</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">[^]</span> <span class="skolem">rel</span> <span class="skolem">g</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> t <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">[^]</span> <span class="skolem">r</span> <span class="main">⊗</span> <span class="skolem">x</span> <span class="main">[^]</span> <span class="main">(</span><span class="skolem">q</span> <span class="main">*</span> <span class="skolem">rel</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">⊗</span> <span class="skolem">g</span> <span class="main">[^]</span> <span class="skolem">rel</span> <span class="skolem">g</span>"</span></span>
                          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">g</span> <span class="main">⊗</span> <span class="skolem">x</span> <span class="main">[^]</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">[^]</span> <span class="skolem">rel</span> <span class="skolem">g</span> <span class="main">=</span> <span class="skolem">g</span> <span class="main">[^]</span> <span class="skolem">rel</span> <span class="skolem">g</span> <span class="main">⊗</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">[^]</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">[^]</span> <span class="skolem">rel</span> <span class="skolem">g</span>"</span></span>
                              <span class="keyword1"><span class="command">using</span></span> gc xc int_pow_distrib <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">[^]</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">[^]</span> <span class="skolem">rel</span> <span class="skolem">g</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">[^]</span> <span class="main">(</span><span class="skolem">q</span> <span class="main">*</span> <span class="skolem">rel</span> <span class="skolem">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> xc int_pow_pow <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">[^]</span> <span class="skolem">rel</span> <span class="skolem">g</span> <span class="main">⊗</span> <span class="skolem">x</span> <span class="main">[^]</span> <span class="main">(</span><span class="skolem">q</span> <span class="main">*</span> <span class="skolem">rel</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">[^]</span> <span class="main">(</span><span class="skolem">q</span> <span class="main">*</span> <span class="skolem">rel</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">⊗</span> <span class="skolem">g</span> <span class="main">[^]</span> <span class="skolem">rel</span> <span class="skolem">g</span>"</span></span>
                              <span class="keyword1"><span class="command">using</span></span> m_comm<span class="main">[</span><span class="operator">OF</span> int_pow_closed<span class="main"><span class="main">[</span></span><span class="operator">OF</span> xc<span class="main"><span class="main">]</span></span> int_pow_closed<span class="main"><span class="main">[</span></span><span class="operator">OF</span> gc<span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">g</span> <span class="main">⊗</span> <span class="skolem">x</span> <span class="main">[^]</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">[^]</span> <span class="skolem">rel</span> <span class="skolem">g</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">[^]</span> <span class="main">(</span><span class="skolem">q</span> <span class="main">*</span> <span class="skolem">rel</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">⊗</span> <span class="skolem">g</span> <span class="main">[^]</span> <span class="skolem">rel</span> <span class="skolem">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
                            <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gc m_assoc xc<span class="main">)</span>
                          <span class="keyword1"><span class="command">qed</span></span>
                          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">[^]</span> <span class="skolem">rel</span> <span class="skolem">x</span> <span class="main">⊗</span> <span class="skolem">g</span> <span class="main">[^]</span> <span class="skolem">rel</span> <span class="skolem">g</span>"</span></span>
                          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">[^]</span> <span class="skolem">r</span> <span class="main">⊗</span> <span class="skolem">x</span> <span class="main">[^]</span> <span class="main">(</span><span class="skolem">q</span> <span class="main">*</span> <span class="skolem">rel</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">[^]</span> <span class="main">(</span><span class="skolem">q</span> <span class="main">*</span> <span class="skolem">rel</span> <span class="skolem">g</span> <span class="main">+</span> <span class="skolem">r</span><span class="main">)</span>"</span></span>
                              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.commute int_pow_mult xc<span class="main">)</span>
                            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">[^]</span> <span class="skolem">rel</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> rq <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
                            <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
                          <span class="keyword1"><span class="command">qed</span></span>
                          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gc m_comm xc<span class="main">)</span>
                        <span class="keyword1"><span class="command">qed</span></span>
                        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                      <span class="keyword1"><span class="command">qed</span></span>
                      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">g</span> <span class="main">[^]</span> <span class="skolem">rel</span> <span class="skolem">g</span> <span class="main">⊗</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">[^]</span> <span class="skolem">rel</span> <span class="skolem">x</span> <span class="main">⊗</span> finprod <span class="free">G</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">[^]</span> <span class="skolem">rel</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="skolem">gs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">g</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
                        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> m_assoc<span class="main"><span class="keyword3">,</span></span> <span class="operator">use</span> xc gc <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> finprod_closed<span class="main"><span class="keyword3">,</span></span> <span class="operator">use</span> gsc <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">fast</span><span class="main">)</span>
                      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">g</span> <span class="main">[^]</span> <span class="skolem">rel</span> <span class="skolem">g</span> <span class="main">⊗</span> finprod <span class="free">G</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">[^]</span> <span class="skolem">rel</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="skolem">gs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">g</span><span class="main">}</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finprod <span class="free">G</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">[^]</span> <span class="skolem">rel</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="skolem">gs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">g</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">[^]</span> <span class="skolem">rel</span> <span class="skolem">x</span> <span class="main">⊗</span> finprod <span class="free">G</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">[^]</span> <span class="skolem">rel</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="skolem">gs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">g</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span>"</span></span>
                          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> finprod_minus<span class="main"><span class="keyword3">,</span></span> <span class="operator">use</span> xng x<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> fgs gsc <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
                        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
                      <span class="keyword1"><span class="command">qed</span></span>
                      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> finprod <span class="free">G</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">[^]</span> <span class="skolem">rel</span> <span class="bound">x</span><span class="main">)</span> <span class="skolem">gs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> finprod_minus<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> gr<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> _ fgs<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">use</span> gsc <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
                      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
                    <span class="keyword1"><span class="command">qed</span></span>                        
                    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"finprod <span class="free">G</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">[^]</span> <span class="var">?r</span> <span class="bound">x</span><span class="main">)</span> <span class="skolem">s</span> <span class="main">=</span> <span class="main">𝟭</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> gr<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> relations_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
                  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"nat <span class="skolem">r</span> <span class="main">∈</span> nat <span class="main">`</span> <span class="main">{</span><span class="bound"><span class="bound">e</span></span> <span class="main">∈</span> <span class="var">?r</span> <span class="main">`</span> <span class="skolem">s</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">e</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> xs xnt rq<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
                <span class="keyword1"><span class="command">qed</span></span>
              <span class="keyword1"><span class="command">qed</span></span>
              <span class="keyword1"><span class="command">from</span></span> le<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> rq<span class="main">(</span>3<span class="main">)</span> gr<span class="main">(</span>4<span class="main">,</span> 5<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">gs</span><span class="main">;</span> <span class="main">¬</span> <span class="skolem">rel</span> <span class="skolem">g</span> <span class="keyword1">dvd</span> <span class="skolem">rel</span> <span class="skolem">x</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="var">?t</span> <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="var">?t</span> <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> na <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?t</span> <span class="skolem">A</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">e</span><span class="main">∈</span><span class="skolem">rel</span><span class="main">`</span><span class="skolem">gs</span><span class="main">.</span> <span class="skolem">rel</span> <span class="skolem">g</span> <span class="keyword1">dvd</span> <span class="bound">e</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> dv<span class="main">:</span> True
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">tau</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">tau</span> <span class="main">=</span> finprod <span class="free">G</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">[^]</span> <span class="main">(</span><span class="main">(</span><span class="skolem">rel</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">div</span> <span class="skolem">rel</span> <span class="skolem">g</span><span class="main">)</span><span class="main">)</span> <span class="skolem">gs</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> tc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">tau</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> tau_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> finprod_closed<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">(</span></span></span><span class="main"><span class="main"><span class="main">λ</span></span></span><span class="bound"><span class="bound"><span class="bound">x</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="bound"><span class="bound"><span class="bound">x</span></span></span> <span class="main"><span class="main"><span class="main">[^]</span></span></span> <span class="main"><span class="main"><span class="main">(</span></span></span><span class="main"><span class="main"><span class="main">(</span></span></span><span class="skolem"><span class="skolem"><span class="skolem">rel</span></span></span> <span class="bound"><span class="bound"><span class="bound">x</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span> <span class="keyword1"><span class="keyword1"><span class="keyword1">div</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">rel</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">g</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span>"</span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">gs</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">use</span> gsc <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">fast</span><span class="main">)</span> 
        <span class="keyword1"><span class="command">have</span></span> gts<span class="main">:</span> <span class="quoted"><span class="quoted">"generate <span class="free">G</span> <span class="skolem">gs</span> <span class="main">=</span> generate <span class="free">G</span> <span class="main">(</span><span class="skolem">gs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">g</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">tau</span><span class="main">}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> generate_one_switched_eqI<span class="main"><span class="main">[</span></span><span class="operator">OF</span> gsc gr<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">tau</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">tau</span> <span class="main">∈</span> generate <span class="free">G</span> <span class="skolem">gs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> generate_eq_finprod_Pi_int_image<span class="main"><span class="main">[</span></span><span class="operator">OF</span> fgs gsc<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> tau_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">fast</span><span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> generate <span class="free">G</span> <span class="main">(</span><span class="skolem">gs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">g</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">tau</span><span class="main">}</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">tau</span> <span class="main">=</span> <span class="skolem">g</span> <span class="main">⊗</span> finprod <span class="free">G</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">[^]</span> <span class="main">(</span><span class="main">(</span><span class="skolem">rel</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">div</span> <span class="skolem">rel</span> <span class="skolem">g</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">gs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">g</span><span class="main">}</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finprod <span class="free">G</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">[^]</span> <span class="main">(</span><span class="main">(</span><span class="skolem">rel</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">div</span> <span class="skolem">rel</span> <span class="skolem">g</span><span class="main">)</span><span class="main">)</span> <span class="skolem">gs</span> <span class="main">=</span> <span class="skolem">g</span> <span class="main">[^]</span> <span class="main">(</span><span class="skolem">rel</span> <span class="skolem">g</span> <span class="keyword1">div</span> <span class="skolem">rel</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">⊗</span> finprod <span class="free">G</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">[^]</span> <span class="main">(</span><span class="main">(</span><span class="skolem">rel</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">div</span> <span class="skolem">rel</span> <span class="skolem">g</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">gs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">g</span><span class="main">}</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> finprod_minus<span class="main"><span class="main">[</span></span><span class="operator">OF</span> gr<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> _ fgs<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">use</span> gsc <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">fast</span><span class="main">)</span>
              <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">[^]</span> <span class="main">(</span><span class="skolem">rel</span> <span class="skolem">g</span> <span class="keyword1">div</span> <span class="skolem">rel</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">g</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> gr gsc <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> tau_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">hence</span></span> gti<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> <span class="skolem">tau</span> <span class="main">⊗</span> <span class="keyword1">inv</span> finprod <span class="free">G</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">[^]</span> <span class="main">(</span><span class="main">(</span><span class="skolem">rel</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">div</span> <span class="skolem">rel</span> <span class="skolem">g</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">gs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">g</span><span class="main">}</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> inv_solve_right<span class="main">[</span><span class="operator">OF</span> gc tc finprod_closed<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">[^]</span> <span class="main">(</span><span class="main">(</span><span class="skolem">rel</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">div</span> <span class="skolem">rel</span> <span class="skolem">g</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">gs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">g</span><span class="main">}</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span> gsc
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">tau</span> <span class="main">∈</span> generate <span class="free">G</span> <span class="main">(</span><span class="skolem">gs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">g</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">tau</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> generate.incl<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">tau</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">inv</span> finprod <span class="free">G</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">[^]</span> <span class="main">(</span><span class="main">(</span><span class="skolem">rel</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">div</span> <span class="skolem">rel</span> <span class="skolem">g</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">gs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">g</span><span class="main">}</span><span class="main">)</span> <span class="main">∈</span> generate <span class="free">G</span> <span class="main">(</span><span class="skolem">gs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">g</span><span class="main">}</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finprod <span class="free">G</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">[^]</span> <span class="main">(</span><span class="main">(</span><span class="skolem">rel</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">div</span> <span class="skolem">rel</span> <span class="skolem">g</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">gs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">g</span><span class="main">}</span><span class="main">)</span> <span class="main">∈</span> generate <span class="free">G</span> <span class="main">(</span><span class="skolem">gs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">g</span><span class="main">}</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> generate_eq_finprod_Pi_int_image<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">gs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">g</span><span class="main">}</span>"</span></span><span class="main">]</span> fgs gsc <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
              <span class="keyword1"><span class="command">from</span></span>  generate_m_inv_closed<span class="main">[</span><span class="operator">OF</span> _ this<span class="main">]</span> gsc <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> gti<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> generate.eng<span class="main"><span class="keyword3">,</span></span> <span class="operator">use</span> mono_generate<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem">gs</span></span></span> <span class="main"><span class="main"><span class="main">-</span></span></span> <span class="main"><span class="main"><span class="main">{</span></span></span><span class="skolem"><span class="skolem"><span class="skolem">g</span></span></span><span class="main"><span class="main"><span class="main">}</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> gr<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> gt<span class="main">:</span> <span class="quoted"><span class="quoted">"generate <span class="free">G</span> <span class="main">(</span><span class="skolem">gs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">g</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">tau</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> generate <span class="free">G</span> <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> all_gens_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">have</span></span> trgo<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">tau</span> <span class="main">[^]</span> <span class="skolem">rel</span> <span class="skolem">g</span> <span class="main">=</span> <span class="main">𝟭</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">tau</span> <span class="main">[^]</span> <span class="skolem">rel</span> <span class="skolem">g</span> <span class="main">=</span> finprod <span class="free">G</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">[^]</span> <span class="main">(</span><span class="main">(</span><span class="skolem">rel</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">div</span> <span class="skolem">rel</span> <span class="skolem">g</span><span class="main">)</span><span class="main">)</span> <span class="skolem">gs</span> <span class="main">[^]</span> <span class="skolem">rel</span> <span class="skolem">g</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> tau_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> finprod <span class="free">G</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">[^]</span> <span class="skolem">rel</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">[^]</span> <span class="main">(</span><span class="main">(</span><span class="skolem">rel</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">div</span> <span class="skolem">rel</span> <span class="skolem">g</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">gs</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> finprod_exp<span class="main"><span class="keyword3">,</span></span> <span class="operator">use</span> gsc <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> finprod <span class="free">G</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">[^]</span> <span class="skolem">rel</span> <span class="bound">a</span><span class="main">)</span> <span class="skolem">gs</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> finprod_cong'<span class="main">)</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">[^]</span> <span class="skolem">rel</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">[^]</span> <span class="main">(</span><span class="main">(</span><span class="skolem">rel</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">div</span> <span class="skolem">rel</span> <span class="skolem">g</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">[^]</span> <span class="skolem">rel</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">gs</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">[^]</span> <span class="skolem">rel</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">[^]</span> <span class="main">(</span><span class="main">(</span><span class="skolem">rel</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">div</span> <span class="skolem">rel</span> <span class="skolem">g</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">[^]</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="skolem">rel</span> <span class="skolem">x</span><span class="main">)</span> <span class="keyword1">div</span> <span class="skolem">rel</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">rel</span> <span class="skolem">g</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> that gsc int_pow_pow <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">[^]</span> <span class="skolem">rel</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> dv that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> gsc <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">𝟭</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> gr<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> relations_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">hence</span></span> otdrg<span class="main">:</span> <span class="quoted"><span class="quoted">"ord <span class="skolem">tau</span> <span class="keyword1">dvd</span> <span class="skolem">rel</span> <span class="skolem">g</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> tc int_pow_eq_id <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword1"><span class="command">have</span></span> ot<span class="main">:</span> <span class="quoted"><span class="quoted">"ord <span class="skolem">tau</span> <span class="main">=</span> <span class="skolem">rel</span> <span class="skolem">g</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">from</span></span> gr<span class="main">(</span>4<span class="main">,</span> 5<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">rel</span> <span class="skolem">g</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">with</span></span> otdrg <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ord <span class="skolem">tau</span> <span class="main">≤</span> <span class="skolem">rel</span> <span class="skolem">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> zdvd_imp_le<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>ord <span class="skolem">tau</span> <span class="main">&lt;</span> <span class="skolem">rel</span> <span class="skolem">g</span>"</span></span> 
          <span class="keyword1"><span class="command">proof</span></span>
            <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"int <span class="main">(</span>ord <span class="skolem">tau</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">rel</span> <span class="skolem">g</span>"</span></span>
            <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">T</span></span> <span class="keyword2"><span class="keyword">where</span></span> T<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">T</span> <span class="main">=</span> <span class="skolem">gs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">g</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">tau</span><span class="main">}</span>"</span></span>
            <span class="keyword1"><span class="command">hence</span></span> tT<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">tau</span> <span class="main">∈</span> <span class="skolem">T</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"restrict <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span><span class="main">(</span><span class="main">0</span><span class="main">::</span>int<span class="main">)</span><span class="main">)</span><span class="main">(</span><span class="skolem">tau</span> <span class="main">:=</span> int<span class="main">(</span>ord <span class="skolem">tau</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">T</span>"</span></span>
            <span class="keyword1"><span class="command">from</span></span> T <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">T</span> <span class="main">∈</span> <span class="skolem">all_gens</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> gt generate_sincl<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">gs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">g</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">tau</span><span class="main">}</span>"</span></span><span class="main">]</span> switch_elem_card_le<span class="main">[</span><span class="operator">OF</span> gr<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">tau</span></span><span class="main">]</span> fgs cgs n
              <span class="keyword1"><span class="command">unfolding</span></span> all_gens_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="main">∈</span> relations <span class="skolem">T</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> in_relationsI finprod_one_eqI<span class="main">)</span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">tau</span> <span class="main">[^]</span> int <span class="main">(</span>ord <span class="skolem">tau</span><span class="main">)</span> <span class="main">=</span> <span class="main">𝟭</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> tc pow_ord_eq_1<span class="main">[</span><span class="operator">OF</span> tc<span class="main">]</span> int_pow_int <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
              <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">[^]</span> <span class="var">?r</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">𝟭</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">T</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="keyword1"><span class="command">using</span></span> tT that <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="skolem">x</span> <span class="main">=</span> <span class="skolem">tau</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
            <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="skolem">tau</span> <span class="main">=</span> ord <span class="skolem">tau</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> tT <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ord <span class="skolem">tau</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> dvd_nat_bounds gr<span class="main">(</span>4<span class="main">)</span> gr<span class="main">(</span>5<span class="main">)</span> int_dvd_int_iff otdrg <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ord <span class="skolem">tau</span> <span class="main">∈</span> <span class="skolem">exps</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> exps_def <span class="keyword1"><span class="command">using</span></span> tT <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span>
            <span class="keyword1"><span class="command">with</span></span> le a gr<span class="main">(</span>4<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">hence</span></span> otnz<span class="main">:</span> <span class="quoted"><span class="quoted">"ord <span class="skolem">tau</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> gr me exps_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">=</span> <span class="skolem">tau</span><span class="main">#</span><span class="skolem">hs</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> ls<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">l</span> <span class="main">=</span> set <span class="skolem">hs</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">tau</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> hsc tc <span class="keyword1"><span class="command">have</span></span> slc<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">l</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> gAhst<span class="main">:</span> <span class="quoted"><span class="quoted">"generate <span class="free">G</span> <span class="skolem">A</span> <span class="main">=</span> generate <span class="free">G</span> <span class="main">(</span>set <span class="skolem">hs</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">tau</span><span class="main">}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"generate <span class="free">G</span> <span class="skolem">A</span> <span class="main">=</span> generate <span class="free">G</span> <span class="main">(</span><span class="skolem">gs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">g</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">tau</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> gt <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> generate <span class="free">G</span> <span class="main">(</span>set <span class="skolem">hs</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">tau</span><span class="main">}</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> generate_subset_change_eqI<span class="main"><span class="keyword3">,</span></span> <span class="operator">use</span> hsc gsc tc ghs <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">have</span></span> glgA<span class="main">:</span> <span class="quoted"><span class="quoted">"generate <span class="free">G</span> <span class="main">(</span>set <span class="skolem">l</span><span class="main">)</span> <span class="main">=</span> generate <span class="free">G</span> <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> gAhst ls <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> lgA<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">l</span> <span class="main">⊆</span> generate <span class="free">G</span> <span class="skolem">A</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> ls gt gts hs<span class="main">(</span>1<span class="main">)</span>
                mono_generate<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">gs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">g</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="skolem">gs</span></span><span class="main">]</span> generate.incl<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">tau</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">gs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">g</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">tau</span><span class="main">}</span>"</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"ord <span class="skolem">tau</span> <span class="main">=</span> <span class="main">1</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">tau</span> <span class="main">=</span> <span class="main">𝟭</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ord_eq_1 tc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"generate <span class="free">G</span> <span class="skolem">A</span> <span class="main">=</span> generate <span class="free">G</span> <span class="main">(</span><span class="skolem">gs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">g</span><span class="main">}</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> gAhst generate_one_irrel hs<span class="main">(</span>3<span class="main">)</span> ghs <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">from</span></span> iH2<span class="main">[</span><span class="operator">OF</span> ihgsg this cgsg<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> otau<span class="main">:</span> False
          <span class="keyword1"><span class="command">consider</span></span> <span class="main">(</span>nd<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>distinct <span class="skolem">l</span>"</span></span> <span class="main">|</span> <span class="main">(</span>ltn<span class="main">)</span> <span class="quoted"><span class="quoted">"length <span class="skolem">l</span> <span class="main">&lt;</span> <span class="skolem">n</span> <span class="main">∧</span> distinct <span class="skolem">l</span>"</span></span> <span class="main">|</span> <span class="main">(</span>dn<span class="main">)</span> <span class="quoted"><span class="quoted">"length <span class="skolem">l</span> <span class="main">=</span> <span class="skolem">n</span> <span class="main">∧</span> distinct <span class="skolem">l</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">l</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">l</span> <span class="main">=</span> length <span class="skolem">hs</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> l <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">hs</span> <span class="main">≤</span> card <span class="main">(</span><span class="skolem">gs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">g</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hs<span class="main">(</span>2<span class="main">,</span> 5<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> distinct_card<span class="main">)</span>
              <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="skolem">gs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">g</span><span class="main">}</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> n cgsg gr<span class="main">(</span>3<span class="main">)</span> fgs Ane i<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_gt_0_iff<span class="main">)</span>
              <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">¬</span> distinct <span class="skolem">l</span> <span class="main">⟹</span> <span class="skolem">thesis</span><span class="main">;</span> length <span class="skolem">l</span> <span class="main">&lt;</span> <span class="skolem">n</span> <span class="main">∧</span> distinct <span class="skolem">l</span> <span class="main">⟹</span> <span class="skolem">thesis</span><span class="main">;</span> length <span class="skolem">l</span> <span class="main">=</span> <span class="skolem">n</span> <span class="main">∧</span> distinct <span class="skolem">l</span> <span class="main">⟹</span> <span class="skolem">thesis</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="skolem">thesis</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span> 
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> nd
            <span class="keyword1"><span class="command">with</span></span> hs<span class="main">(</span>2<span class="main">)</span> l <span class="keyword1"><span class="command">have</span></span> ths<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">hs</span> <span class="main">=</span> set <span class="skolem">hs</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">tau</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">l</span> <span class="main">=</span> set <span class="skolem">hs</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> l <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"generate <span class="free">G</span> <span class="main">(</span><span class="skolem">gs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">g</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> generate <span class="free">G</span> <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> gAhst ths ghs <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>set <span class="skolem">hs</span><span class="main">)</span> <span class="main">≤</span> card <span class="skolem">A</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Diff_iff card_mono cgs dual_order.trans fgs hs<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> subsetI<span class="main">)</span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> hs <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> ltn
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> cl<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>set <span class="skolem">l</span><span class="main">)</span> <span class="main">&lt;</span> card <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> n <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> distinct_card<span class="main">)</span>
            <span class="keyword1"><span class="command">from</span></span> iH<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> hsc tc ls <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?t</span> <span class="main">(</span>set <span class="skolem">l</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>1 2<span class="main"><span class="main">)</span></span> gAhst<span class="main"><span class="keyword3">,</span></span> <span class="operator">use</span> cl ls <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">fastforce</span><span class="main">)</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> dn
            <span class="keyword1"><span class="command">hence</span></span> ln<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">l</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> dl<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">have</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"complementary <span class="main">(</span>generate <span class="free">G</span> <span class="main">{</span><span class="skolem">tau</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span>generate <span class="free">G</span> <span class="main">(</span><span class="skolem">gs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">g</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">𝟭</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> generate <span class="free">G</span> <span class="main">{</span><span class="skolem">tau</span><span class="main">}</span> <span class="main">∩</span> generate <span class="free">G</span> <span class="main">(</span>set <span class="skolem">hs</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
              <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                <span class="keyword1"><span class="command">from</span></span> that generate_incl<span class="main">[</span><span class="operator">OF</span> hsc<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> xc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                <span class="keyword1"><span class="command">from</span></span> that <span class="keyword1"><span class="command">have</span></span> xgt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> generate <span class="free">G</span> <span class="main">{</span><span class="skolem">tau</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> xgs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> generate <span class="free">G</span> <span class="main">(</span>set <span class="skolem">hs</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">from</span></span> generate_nat_pow<span class="main">[</span><span class="operator">OF</span> otnz tc<span class="main">]</span> xgt <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">≥</span> <span class="main">0</span> <span class="main">∧</span> <span class="bound">a</span> <span class="main">&lt;</span> ord <span class="skolem">tau</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">tau</span> <span class="main">[^]</span> <span class="bound">a</span>"</span></span>
                  <span class="keyword1"><span class="command">unfolding</span></span> atLeastAtMost_def atLeast_def atMost_def
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> Suc_pred less_Suc_eq_le neq0_conv otnz<span class="main">)</span>
                <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="skolem">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">&lt;</span> ord <span class="skolem">tau</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">tau</span> <span class="main">[^]</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ix<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">inv</span> <span class="skolem">x</span> <span class="main">∈</span> generate <span class="free">G</span> <span class="main">(</span>set <span class="skolem">hs</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> xgs generate_m_inv_closed ghs hsc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                <span class="keyword1"><span class="command">with</span></span> generate_eq_finprod_Pi_int_image<span class="main">[</span><span class="operator">OF</span> _ hsc<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span>
                  f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> Pi <span class="main">(</span>set <span class="skolem">hs</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">(</span>UNIV<span class="main">::</span>int set<span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">inv</span> <span class="skolem">x</span> <span class="main">=</span> finprod <span class="free">G</span> <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> <span class="bound">g</span> <span class="main">[^]</span> <span class="skolem">f</span> <span class="bound">g</span><span class="main">)</span> <span class="main">(</span>set <span class="skolem">hs</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"restrict <span class="main">(</span><span class="skolem">f</span><span class="main">(</span><span class="skolem">tau</span> <span class="main">:=</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>set <span class="skolem">l</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">have</span></span> fr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">∈</span> relations <span class="main">(</span>set <span class="skolem">l</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> in_relationsI<span class="main">)</span>
                  <span class="keyword1"><span class="command">from</span></span> ls dl l <span class="keyword1"><span class="command">have</span></span> sh<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">hs</span> <span class="main">=</span> set <span class="skolem">l</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">tau</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finprod <span class="free">G</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">[^]</span> <span class="var">?f</span> <span class="bound">a</span><span class="main">)</span> <span class="main">(</span>set <span class="skolem">l</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">tau</span> <span class="main">[^]</span> <span class="var">?f</span> <span class="skolem">tau</span> <span class="main">⊗</span> finprod <span class="free">G</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">[^]</span> <span class="var">?f</span> <span class="bound">a</span><span class="main">)</span> <span class="main">(</span>set <span class="skolem">hs</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sh<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> finprod_minus<span class="main"><span class="keyword3">,</span></span> <span class="operator">use</span> l slc <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
                  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">tau</span> <span class="main">[^]</span> <span class="var">?f</span> <span class="skolem">tau</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a l int_pow_int <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
                  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finprod <span class="free">G</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">[^]</span> <span class="var">?f</span> <span class="bound">a</span><span class="main">)</span> <span class="main">(</span>set <span class="skolem">hs</span><span class="main">)</span> <span class="main">=</span> finprod <span class="free">G</span> <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> <span class="bound">g</span> <span class="main">[^]</span> <span class="skolem">f</span> <span class="bound">g</span><span class="main">)</span> <span class="main">(</span>set <span class="skolem">hs</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> finprod_cong'<span class="main"><span class="keyword3">,</span></span> <span class="operator">use</span> slc dl l <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
                  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finprod <span class="free">G</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">[^]</span> <span class="var">?f</span> <span class="bound">a</span><span class="main">)</span> <span class="main">(</span>set <span class="skolem">l</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">⊗</span> <span class="keyword1">inv</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
                  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"finprod <span class="free">G</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">[^]</span> <span class="var">?f</span> <span class="bound">a</span><span class="main">)</span> <span class="main">(</span>set <span class="skolem">l</span><span class="main">)</span> <span class="main">=</span> <span class="main">𝟭</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> xc <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">qed</span></span> <span class="operator">blast</span>
                <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="skolem">a</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
                <span class="keyword1"><span class="command">proof</span></span>
                  <span class="keyword3"><span class="command">assume</span></span> ag<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">a</span>"</span></span>
                  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">l</span> <span class="main">∈</span> <span class="skolem">all_gens</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> all_gens_def <span class="keyword1"><span class="command">using</span></span> glgA lgA dn distinct_card
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
                  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"int <span class="skolem">a</span> <span class="main">=</span> <span class="var">?f</span> <span class="skolem">tau</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> l <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">tau</span> <span class="main">∈</span> set <span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> l <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="skolem">exps</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fr ag <span class="keyword1"><span class="command">unfolding</span></span> exps_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span>
                  <span class="keyword1"><span class="command">from</span></span> le<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> a<span class="main">(</span>2<span class="main">)</span> ot gr<span class="main">(</span>4<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command">qed</span></span>
                <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">𝟭</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> tc a <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
              <span class="keyword1"><span class="command">qed</span></span>
              <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> complementary_def <span class="keyword1"><span class="command">using</span></span> generate.one ghs <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> idl<span class="main">:</span> <span class="quoted"><span class="quoted">"is_idirprod <span class="main">(</span>generate <span class="free">G</span> <span class="skolem">A</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">g</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span>set <span class="skolem">l</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_idirprod <span class="main">(</span>generate <span class="free">G</span> <span class="main">(</span>set <span class="skolem">hs</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">tau</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">g</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span>set <span class="skolem">hs</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">tau</span><span class="main">}</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> idirprod_generate_ind<span class="main"><span class="keyword3">,</span></span> <span class="operator">use</span> tc hsc hs<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> ghs c <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
              <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> ls gAhst <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="var">?t</span> <span class="skolem">A</span> <span class="main">⟹</span> successively <span class="keyword1">(dvd)</span> <span class="main">(</span>map ord <span class="skolem">l</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">hs</span></span><span class="main">)</span>
              <span class="keyword3"><span class="command">case</span></span> Nil
              <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> l <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">list</span><span class="main">)</span>
              <span class="keyword1"><span class="command">hence</span></span> ac<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hsc <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword3"><span class="command">assume</span></span> nA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="var">?t</span> <span class="skolem">A</span>"</span></span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ord <span class="skolem">tau</span> <span class="keyword1">dvd</span> ord <span class="skolem">a</span>"</span></span>
              <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
                <span class="keyword3"><span class="command">assume</span></span> nd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> ord <span class="skolem">tau</span> <span class="keyword1">dvd</span> ord <span class="skolem">a</span>"</span></span>
                <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"int <span class="main">(</span>ord <span class="skolem">tau</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> otnz <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command">with</span></span> nd <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="skolem"><span class="skolem">q</span></span><span class="main">::</span><span class="quoted">int</span> <span class="keyword2"><span class="keyword">where</span></span> rq<span class="main">:</span> <span class="quoted"><span class="quoted">"ord <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">q</span> <span class="main">*</span> <span class="main">(</span>ord <span class="skolem">tau</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">r</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">r</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">&lt;</span> ord <span class="skolem">tau</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> Euclidean_Division.pos_mod_bound div_mult_mod_eq mod_int_pos_iff mod_0_imp_dvd
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> linorder_not_le of_nat_le_0_iff of_nat_mod<span class="main">)</span>
                <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> <span class="skolem">tau</span> <span class="main">⊗</span> <span class="skolem">a</span> <span class="main">[^]</span> <span class="skolem">q</span>"</span></span>
                <span class="keyword1"><span class="command">hence</span></span> bc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hsc tc Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">have</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"generate <span class="free">G</span> <span class="main">(</span>set <span class="main">(</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">hs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> generate <span class="free">G</span> <span class="main">(</span>set <span class="skolem">l</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                  <span class="keyword1"><span class="command">have</span></span> se<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">hs</span><span class="main">)</span> <span class="main">=</span> set <span class="skolem">l</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">tau</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">b</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> l Cons dl <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">subst</span> se<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> generate_one_switched_eqI<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">tau</span></span></span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">b</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
                    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> generate <span class="free">G</span> <span class="main">(</span>set <span class="skolem">l</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">tau</span> <span class="main">∈</span> generate <span class="free">G</span> <span class="main">(</span>set <span class="skolem">l</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> l generate.incl<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">tau</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">l</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">[^]</span> <span class="skolem">q</span> <span class="main">∈</span> generate <span class="free">G</span> <span class="main">(</span>set <span class="skolem">l</span><span class="main">)</span>"</span></span> 
                        <span class="keyword1"><span class="command">using</span></span> mono_generate<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">a</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">l</span>"</span></span><span class="main">]</span> generate_pow<span class="main">[</span><span class="operator">OF</span> ac<span class="main">]</span> Cons l <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> b generate.eng <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
                    <span class="keyword1"><span class="command">qed</span></span>
                    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">tau</span> <span class="main">∈</span> generate <span class="free">G</span> <span class="main">(</span>set <span class="skolem">l</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">tau</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">b</span><span class="main">}</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">tau</span> <span class="main">=</span> <span class="skolem">b</span> <span class="main">⊗</span> <span class="keyword1">inv</span><span class="main">(</span><span class="skolem">a</span> <span class="main">[^]</span> <span class="skolem">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ac b m_assoc tc<span class="main">)</span>
                      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> generate <span class="free">G</span> <span class="main">(</span>set <span class="skolem">l</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">tau</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">b</span><span class="main">}</span><span class="main">)</span>"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> generate.incl<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">b</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">l</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">tau</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">b</span><span class="main">}</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">inv</span><span class="main">(</span><span class="skolem">a</span> <span class="main">[^]</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">∈</span> generate <span class="free">G</span> <span class="main">(</span>set <span class="skolem">l</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">tau</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">b</span><span class="main">}</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"generate <span class="free">G</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span> <span class="main">⊆</span> generate <span class="free">G</span> <span class="main">(</span>set <span class="skolem">l</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">tau</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">b</span><span class="main">}</span><span class="main">)</span>"</span></span>
                          <span class="keyword1"><span class="command">using</span></span> mono_generate<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">a</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">l</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">tau</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">b</span><span class="main">}</span>"</span></span><span class="main">]</span> dl Cons l <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">inv</span><span class="main">(</span><span class="skolem">a</span> <span class="main">[^]</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">∈</span> generate <span class="free">G</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span>"</span></span>
                          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> generate_pow<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ac<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> int_pow_neg<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ac<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">q</span></span></span></span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
                        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
                      <span class="keyword1"><span class="command">qed</span></span>
                      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> generate.eng <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
                    <span class="keyword1"><span class="command">qed</span></span>
                  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> bc tc hsc dl Cons l <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
                <span class="keyword1"><span class="command">qed</span></span>
                <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
                <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>set <span class="main">(</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">hs</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="skolem">n</span>"</span></span><span class="main">)</span>
                  <span class="keyword3"><span class="command">case</span></span> True
                  <span class="keyword1"><span class="command">hence</span></span> cln<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>set <span class="main">(</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">hs</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">n</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> l Cons ln <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> card_length list.size<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> nat_less_le<span class="main">)</span>
                  <span class="keyword1"><span class="command">hence</span></span> seq<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">hs</span><span class="main">)</span> <span class="main">=</span> set <span class="skolem">hs</span>"</span></span>
                  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                    <span class="keyword1"><span class="command">from</span></span> dn l Cons True <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> set <span class="skolem">hs</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> distinct.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> distinct_card list.size<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
                    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">qed</span></span>
                  <span class="keyword1"><span class="command">with</span></span> cln <span class="keyword1"><span class="command">have</span></span> clA<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>set <span class="skolem">hs</span><span class="main">)</span> <span class="main">&lt;</span> card <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> n <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">hs</span> <span class="main">⊆</span> generate <span class="free">G</span> <span class="main">(</span>set <span class="skolem">hs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> generate_sincl <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"distinct <span class="skolem">hs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
                  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_idirprod <span class="main">(</span>generate <span class="free">G</span> <span class="main">(</span>set <span class="skolem">hs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">g</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span>set <span class="skolem">hs</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> is_idirprod_generate<span class="main"><span class="keyword3">,</span></span> <span class="operator">use</span> hs<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> is_idirprod_def<span class="main"><span class="main">]</span></span> hsc <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
                  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"generate <span class="free">G</span> <span class="skolem">A</span> <span class="main">=</span> generate <span class="free">G</span> <span class="main">(</span>set <span class="skolem">hs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> glgA g seq <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
                  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"successively <span class="keyword1">(dvd)</span> <span class="main">(</span>map ord <span class="skolem">hs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
                  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> iH2 nA <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                <span class="keyword1"><span class="command">next</span></span>
                  <span class="keyword3"><span class="command">case</span></span> False
                  <span class="keyword1"><span class="command">hence</span></span> anb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≠</span> <span class="skolem">b</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> card_distinct distinct_length_2_or_more l list.size<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> ln local.Cons<span class="main">)</span>
                  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nat <span class="skolem">r</span> <span class="main">∈</span> <span class="skolem">exps</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> exps_def
                  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
                    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">hs</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">all_gens</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> all_gens_def
                      <span class="keyword1"><span class="command">using</span></span> gAhst g ls generate_sincl<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">hs</span><span class="main">)</span>"</span></span><span class="main">]</span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"restrict <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">0</span><span class="main">::</span>int<span class="main">)</span><span class="main">(</span><span class="skolem">b</span> <span class="main">:=</span> ord <span class="skolem">tau</span><span class="main">,</span> <span class="skolem">a</span> <span class="main">:=</span> <span class="skolem">r</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>set <span class="main">(</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">hs</span><span class="main">)</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="main">∈</span> relations <span class="main">(</span>set <span class="main">(</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">hs</span><span class="main">)</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> in_relationsI<span class="main">)</span>
                      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finprod <span class="free">G</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">[^]</span> <span class="var">?r</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span>set <span class="main">(</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">hs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">𝟭</span>"</span></span>
                      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finprod <span class="free">G</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">[^]</span> <span class="var">?r</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span>set <span class="main">(</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">hs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">b</span> <span class="main">[^]</span> <span class="var">?r</span> <span class="skolem">b</span> <span class="main">⊗</span> finprod <span class="free">G</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">[^]</span> <span class="var">?r</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span>set <span class="main">(</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">hs</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">b</span><span class="main">}</span><span class="main">)</span>"</span></span>
                          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> finprod_minus<span class="main"><span class="keyword3">,</span></span> <span class="operator">use</span> hsc Cons bc <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
                        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finprod <span class="free">G</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">[^]</span> <span class="var">?r</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span>set <span class="main">(</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">hs</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">b</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">[^]</span> <span class="var">?r</span> <span class="skolem">a</span> <span class="main">⊗</span> finprod <span class="free">G</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">[^]</span> <span class="var">?r</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span>set <span class="main">(</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">hs</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">b</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span><span class="main">)</span>"</span></span>
                          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> finprod_minus<span class="main"><span class="keyword3">,</span></span> <span class="operator">use</span> hsc Cons False n anb <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
                        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finprod <span class="free">G</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">[^]</span> <span class="var">?r</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span>set <span class="main">(</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">hs</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">b</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">𝟭</span>"</span></span>
                          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> finprod_one_eqI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
                        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finprod <span class="free">G</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">[^]</span> <span class="var">?r</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span>set <span class="main">(</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">hs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">b</span> <span class="main">[^]</span> <span class="var">?r</span> <span class="skolem">b</span> <span class="main">⊗</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">[^]</span> <span class="var">?r</span> <span class="skolem">a</span> <span class="main">⊗</span> <span class="main">𝟭</span><span class="main">)</span>"</span></span>
                          <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
                        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">b</span> <span class="main">[^]</span> <span class="var">?r</span> <span class="skolem">b</span> <span class="main">⊗</span> <span class="skolem">a</span> <span class="main">[^]</span> <span class="var">?r</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons hsc <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">b</span> <span class="main">[^]</span> int<span class="main">(</span>ord <span class="skolem">tau</span><span class="main">)</span> <span class="main">⊗</span> <span class="skolem">a</span> <span class="main">[^]</span> <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> anb Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">𝟭</span>"</span></span>
                        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">[^]</span> int <span class="main">(</span>ord <span class="skolem">tau</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">tau</span> <span class="main">[^]</span> int <span class="main">(</span>ord <span class="skolem">tau</span><span class="main">)</span> <span class="main">⊗</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">[^]</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">[^]</span> int <span class="main">(</span>ord <span class="skolem">tau</span><span class="main">)</span>"</span></span>
                            <span class="keyword1"><span class="command">using</span></span> b bc hsc int_pow_distrib local.Cons tc <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
                          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">[^]</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">[^]</span> int <span class="main">(</span>ord <span class="skolem">tau</span><span class="main">)</span>"</span></span>
                            <span class="keyword1"><span class="command">using</span></span> trgo hsc local.Cons ot <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
                          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">[^]</span> int <span class="main">(</span>ord <span class="skolem">tau</span><span class="main">)</span> <span class="main">⊗</span> <span class="skolem">a</span> <span class="main">[^]</span> <span class="skolem">r</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">[^]</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">[^]</span> int <span class="main">(</span>ord <span class="skolem">tau</span><span class="main">)</span> <span class="main">⊗</span> <span class="skolem">a</span> <span class="main">[^]</span> <span class="skolem">r</span>"</span></span>
                            <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
                          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">[^]</span> <span class="main">(</span><span class="skolem">q</span> <span class="main">*</span> int <span class="main">(</span>ord <span class="skolem">tau</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons hsc
                            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comm_group_axioms comm_group_def group.int_pow_pow
                                      int_pow_mult list.set_intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> subsetD<span class="main">)</span>
                          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">[^]</span> int <span class="main">(</span>ord <span class="skolem">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> rq <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
                          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Cons hsc int_pow_eq_id <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                        <span class="keyword1"><span class="command">qed</span></span>
                        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
                      <span class="keyword1"><span class="command">qed</span></span>
                    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
                    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">e</span></span> <span class="main">∈</span> <span class="var">?r</span> <span class="main">`</span> set <span class="main">(</span><span class="skolem">b</span> <span class="main">#</span> <span class="skolem">hs</span><span class="main">)</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">e</span><span class="main">}</span>"</span></span>
                    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span><span class="main">)</span>
                      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
                      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">hs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">=</span> <span class="var">?r</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">qed</span></span>
                    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"nat <span class="skolem">r</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">rel</span><span class="main">∈</span>relations <span class="main">(</span>set <span class="main">(</span><span class="skolem">b</span> <span class="main">#</span> <span class="skolem">hs</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> nat <span class="main">`</span> <span class="main">{</span><span class="bound"><span class="bound">e</span></span> <span class="main">∈</span> <span class="bound">rel</span> <span class="main">`</span> set <span class="main">(</span><span class="skolem">b</span> <span class="main">#</span> <span class="skolem">hs</span><span class="main">)</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">e</span><span class="main">}</span><span class="main">)</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
                  <span class="keyword1"><span class="command">qed</span></span>
                  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nat <span class="skolem">r</span> <span class="main">&lt;</span> <span class="skolem">min_exp</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ot rq<span class="main">(</span>2<span class="main">,</span> 3<span class="main">)</span> gr<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
                  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> le <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
                <span class="keyword1"><span class="command">qed</span></span>
              <span class="keyword1"><span class="command">qed</span></span>
              <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> hs<span class="main">(</span>4<span class="main">)</span> Cons l <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> lgA n dn <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> card_length<span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> dvot <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">blast</span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> comm_group<span class="main">)</span> fundamental_subgr<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">gs</span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"set <span class="free">gs</span> <span class="main">⊆</span> generate <span class="free">G</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"distinct <span class="free">gs</span>"</span></span> <span class="quoted"><span class="quoted">"is_idirprod <span class="main">(</span>generate <span class="free">G</span> <span class="free">A</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">g</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span>set <span class="free">gs</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"successively <span class="keyword1">(dvd)</span> <span class="main">(</span>map ord <span class="free">gs</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>set <span class="free">gs</span><span class="main">)</span> <span class="main">≤</span> card <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms ex_idirgen <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹As every group is a subgroup of itself, the theorem follows directly. However, for reasons of
convenience and uniqueness (although not completely proved), we strengthen the result by proving
that the decomposition can be done without having the trivial factor in the product.
We formulate the theorem in various ways: firstly, the invariant factor decomposition.›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> fin_gen_comm_group<span class="main">)</span> invariant_factor_decomposition_idirprod<span class="main">:</span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">gs</span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"set <span class="free">gs</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"distinct <span class="free">gs</span>"</span></span> <span class="quoted"><span class="quoted">"is_idirprod <span class="main">(</span>carrier <span class="free">G</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">g</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span>set <span class="free">gs</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"successively <span class="keyword1">(dvd)</span> <span class="main">(</span>map ord <span class="free">gs</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>set <span class="free">gs</span><span class="main">)</span> <span class="main">≤</span> card <span class="free">gen</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">𝟭</span> <span class="main">∉</span> set <span class="free">gs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> fundamental_subgr<span class="main">[</span><span class="operator">OF</span> fin_gen gens_closed<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">gs</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  gs<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">gs</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"distinct <span class="skolem">gs</span>"</span></span> <span class="quoted"><span class="quoted">"is_idirprod <span class="main">(</span>carrier <span class="free">G</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">g</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span>set <span class="skolem">gs</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"successively <span class="keyword1">(dvd)</span> <span class="main">(</span>map ord <span class="skolem">gs</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>set <span class="skolem">gs</span><span class="main">)</span> <span class="main">≤</span> card <span class="free">gen</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> generators <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> cf<span class="main">:</span> <span class="quoted"><span class="quoted">"compl_fam <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">g</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span>set <span class="skolem">gs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"remove1 <span class="main">𝟭</span> <span class="skolem">gs</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="var">?r</span> <span class="main">=</span> set <span class="skolem">gs</span> <span class="main">-</span> <span class="main">{</span><span class="main">𝟭</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> gs <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="var">?r</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> gs <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"distinct <span class="var">?r</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> gs <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_idirprod <span class="main">(</span>carrier <span class="free">G</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">g</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span>set <span class="var">?r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> is_idirprod_generate<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"set <span class="var">?r</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> gs <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"compl_fam <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">g</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span>set <span class="main">(</span>remove1 <span class="main">𝟭</span> <span class="skolem">gs</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> compl_fam_generate_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> cf gs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">use</span> set_remove1_subset <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">fastforce</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"carrier <span class="free">G</span> <span class="main">=</span> generate <span class="free">G</span> <span class="main">(</span>set <span class="var">?r</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"generate <span class="free">G</span> <span class="main">(</span>set <span class="var">?r</span><span class="main">)</span> <span class="main">=</span> generate <span class="free">G</span> <span class="main">(</span>set <span class="skolem">gs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> generate_one_irrel' r <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> gs<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"successively <span class="keyword1">(dvd)</span> <span class="main">(</span>map ord <span class="var">?r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">gs</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">list</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>map ord <span class="main">(</span>remove1 <span class="main">𝟭</span> <span class="skolem">gs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> remove1 <span class="main">1</span> <span class="main">(</span>map ord <span class="skolem">gs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> gs<span class="main">(</span>1<span class="main">)</span> 
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">gs</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">gs</span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> carrier <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> Cons ord_eq_1<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> r<span class="main"><span class="keyword3">,</span></span>
                     <span class="operator">rule</span> transp_successively_remove1<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ gs<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main"><span class="main">,</span></span> <span class="operator">unfolded</span> transp_def<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span>
                     <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>set <span class="var">?r</span><span class="main">)</span> <span class="main">≤</span> card <span class="free">gen</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> gs<span class="main">(</span>5<span class="main">)</span> r
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> List.finite_set card_Diff1_le dual_order.trans<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">𝟭</span> <span class="main">∉</span> set <span class="var">?r</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> gs<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> fin_gen_comm_group<span class="main">)</span> invariant_factor_decomposition_dirprod<span class="main">:</span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">gs</span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"set <span class="free">gs</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"distinct <span class="free">gs</span>"</span></span>
    <span class="quoted"><span class="quoted">"DirProds <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> <span class="free">G</span><span class="main">⦇</span>carrier <span class="main">:=</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">g</span><span class="main">}</span><span class="main">⦈</span><span class="main">)</span> <span class="main">(</span>set <span class="free">gs</span><span class="main">)</span> <span class="main">≅</span> <span class="free">G</span>"</span></span>
    <span class="quoted"><span class="quoted">"successively <span class="keyword1">(dvd)</span> <span class="main">(</span>map ord <span class="free">gs</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>set <span class="free">gs</span><span class="main">)</span> <span class="main">≤</span> card <span class="free">gen</span>"</span></span>
    <span class="quoted"><span class="quoted">"compl_fam <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">g</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span>set <span class="free">gs</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">𝟭</span> <span class="main">∉</span> set <span class="free">gs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> invariant_factor_decomposition_idirprod <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">gs</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    gs<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">gs</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"distinct <span class="skolem">gs</span>"</span></span> <span class="quoted"><span class="quoted">"is_idirprod <span class="main">(</span>carrier <span class="free">G</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">g</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span>set <span class="skolem">gs</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"successively <span class="keyword1">(dvd)</span> <span class="main">(</span>map ord <span class="skolem">gs</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>set <span class="skolem">gs</span><span class="main">)</span> <span class="main">≤</span> card <span class="free">gen</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">𝟭</span> <span class="main">∉</span> set <span class="skolem">gs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> cong_DirProds_IDirProds<span class="main">[</span><span class="operator">OF</span> gs<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span> gs 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"DirProds <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> <span class="free">G</span><span class="main">⦇</span>carrier <span class="main">:=</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">g</span><span class="main">}</span><span class="main">⦈</span><span class="main">)</span> <span class="main">(</span>set <span class="skolem">gs</span><span class="main">)</span> <span class="main">≅</span> <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> gs that <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> fin_gen_comm_group<span class="main">)</span> invariant_factor_decomposition_dirprod_fam<span class="main">:</span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">Hs</span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">H</span><span class="main">.</span> <span class="bound">H</span> <span class="main">∈</span> set <span class="free">Hs</span> <span class="main">⟹</span> subgroup <span class="bound">H</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"distinct <span class="free">Hs</span>"</span></span>
    <span class="quoted"><span class="quoted">"DirProds <span class="main">(</span><span class="main">λ</span><span class="bound">H</span><span class="main">.</span> <span class="free">G</span><span class="main">⦇</span>carrier <span class="main">:=</span> <span class="bound">H</span><span class="main">⦈</span><span class="main">)</span> <span class="main">(</span>set <span class="free">Hs</span><span class="main">)</span> <span class="main">≅</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"successively <span class="keyword1">(dvd)</span> <span class="main">(</span>map card <span class="free">Hs</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"card <span class="main">(</span>set <span class="free">Hs</span><span class="main">)</span> <span class="main">≤</span> card <span class="free">gen</span>"</span></span> <span class="quoted"><span class="quoted">"compl_fam id <span class="main">(</span>set <span class="free">Hs</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">𝟭</span><span class="main">}</span> <span class="main">∉</span> set <span class="free">Hs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> invariant_factor_decomposition_dirprod <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">gs</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  gs<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">gs</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"distinct <span class="skolem">gs</span>"</span></span>
      <span class="quoted"><span class="quoted">"DirProds <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> <span class="free">G</span><span class="main">⦇</span>carrier <span class="main">:=</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">g</span><span class="main">}</span><span class="main">⦈</span><span class="main">)</span> <span class="main">(</span>set <span class="skolem">gs</span><span class="main">)</span> <span class="main">≅</span> <span class="free">G</span>"</span></span>
      <span class="quoted"><span class="quoted">"successively <span class="keyword1">(dvd)</span> <span class="main">(</span>map ord <span class="skolem">gs</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>set <span class="skolem">gs</span><span class="main">)</span> <span class="main">≤</span> card <span class="free">gen</span>"</span></span>
      <span class="quoted"><span class="quoted">"compl_fam <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">g</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span>set <span class="skolem">gs</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">𝟭</span> <span class="main">∉</span> set <span class="skolem">gs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?gen</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">g</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Hs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"map <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> <span class="var">?gen</span> <span class="bound">g</span><span class="main">)</span> <span class="skolem">gs</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="skolem">H</span> <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">∈</span> set <span class="var">?Hs</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">H</span> <span class="keyword1"><span class="command">using</span></span> that gs <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> generate_is_subgroup<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"distinct <span class="var">?Hs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> compl_fam_imp_generate_inj<span class="main">[</span><span class="operator">OF</span> gs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> gs distinct_map <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"DirProds <span class="main">(</span><span class="main">λ</span><span class="bound">H</span><span class="main">.</span> <span class="free">G</span><span class="main">⦇</span>carrier <span class="main">:=</span> <span class="bound">H</span><span class="main">⦈</span><span class="main">)</span> <span class="main">(</span>set <span class="var">?Hs</span><span class="main">)</span> <span class="main">≅</span> <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> gg<span class="main">:</span> <span class="quoted"><span class="quoted">"group <span class="main">(</span><span class="free">G</span><span class="main">⦇</span>carrier <span class="main">:=</span> <span class="var">?gen</span> <span class="skolem">g</span><span class="main">⦈</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> set <span class="skolem">gs</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">g</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">use</span> gs that <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main">:</span> subgroup.subgroup_is_group generate_is_subgroup›</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> og<span class="main">:</span> group <span class="quoted"><span class="quoted">"DirProds <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> <span class="free">G</span><span class="main">⦇</span>carrier <span class="main">:=</span> <span class="var">?gen</span> <span class="bound">g</span><span class="main">⦈</span><span class="main">)</span> <span class="main">(</span>set <span class="skolem">gs</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> DirProds_group_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"DirProds <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> <span class="free">G</span><span class="main">⦇</span>carrier <span class="main">:=</span> <span class="var">?gen</span> <span class="bound">g</span><span class="main">⦈</span><span class="main">)</span> <span class="main">(</span>set <span class="skolem">gs</span><span class="main">)</span> <span class="main">≅</span> DirProds <span class="main">(</span><span class="main">λ</span><span class="bound">H</span><span class="main">.</span> <span class="free">G</span><span class="main">⦇</span>carrier <span class="main">:=</span> <span class="bound">H</span><span class="main">⦈</span><span class="main">)</span> <span class="main">(</span>set <span class="var">?Hs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> DirProds_iso<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var">?gen</span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="var">?gen</span> <span class="main">(</span>set <span class="skolem">gs</span><span class="main">)</span> <span class="main">(</span>set <span class="var">?Hs</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹distinct <span class="var">?Hs</span>›</span></span> gs<span class="main">(</span>2<span class="main">)</span> compl_fam_imp_generate_inj<span class="main">[</span><span class="operator">OF</span> gs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span> 6<span class="main"><span class="main">)</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bij_betw_def<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">G</span><span class="main">⦇</span>carrier <span class="main">:=</span> <span class="var">?gen</span> <span class="skolem">g</span><span class="main">⦈</span> <span class="main">≅</span> <span class="free">G</span><span class="main">⦇</span>carrier <span class="main">:=</span> <span class="var">?gen</span> <span class="skolem">g</span><span class="main">⦈</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> set <span class="skolem">gs</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">g</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"group <span class="main">(</span><span class="free">G</span><span class="main">⦇</span>carrier <span class="main">:=</span> <span class="var">?gen</span> <span class="skolem">g</span><span class="main">⦈</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> set <span class="skolem">gs</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">g</span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Group.group <span class="main">(</span><span class="free">G</span><span class="main">⦇</span>carrier <span class="main">:=</span> <span class="skolem">H</span><span class="main">⦈</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">∈</span> set <span class="var">?Hs</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">H</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">use</span> gs that <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main">:</span> subgroup.subgroup_is_group generate_is_subgroup›</span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">from</span></span> group.iso_sym<span class="main">[</span><span class="operator">OF</span> og.is_group this<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> gs iso_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"successively <span class="keyword1">(dvd)</span> <span class="main">(</span>map card <span class="var">?Hs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>generate <span class="free">G</span> <span class="main">{</span><span class="skolem">g</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> ord <span class="skolem">g</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> set <span class="skolem">gs</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">g</span>
      <span class="keyword1"><span class="command">using</span></span> generate_pow_card that gs<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"map card <span class="var">?Hs</span> <span class="main">=</span> map ord <span class="skolem">gs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> gs<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>set <span class="var">?Hs</span><span class="main">)</span> <span class="main">≤</span> card <span class="free">gen</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> gs
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹distinct <span class="var">?Hs</span>›</span></span> distinct_card length_map<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"compl_fam id <span class="main">(</span>set <span class="var">?Hs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> compl_fam_cong<span class="main">[</span><span class="operator">OF</span> _ compl_fam_imp_generate_inj<span class="main"><span class="main">[</span></span><span class="operator">OF</span> gs<span class="main"><span class="main"><span class="main">(</span></span></span>1<span class="main"><span class="main"><span class="main">,</span></span></span> 6<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted">id</span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> gs <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">𝟭</span><span class="main">}</span> <span class="main">∉</span> set <span class="var">?Hs</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> generate_singleton_one gs <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Here, the invariant factor decomposition in its classical form.›</span></span>

<span class="keyword1"><span class="command">corollary</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> fin_gen_comm_group<span class="main">)</span> invariant_factor_decomposition_Zn<span class="main">:</span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">ns</span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"DirProds <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">Z</span> <span class="main">(</span><span class="free">ns</span><span class="main">!</span><span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">{..&lt;</span>length <span class="free">ns</span><span class="main">}</span> <span class="main">≅</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"successively <span class="keyword1">(dvd)</span> <span class="free">ns</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">ns</span> <span class="main">≤</span> card <span class="free">gen</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> invariant_factor_decomposition_dirprod <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">gs</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      gs<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">gs</span> <span class="main">⊆</span> carrier <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"distinct <span class="skolem">gs</span>"</span></span>
          <span class="quoted"><span class="quoted">"DirProds <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> <span class="free">G</span><span class="main">⦇</span>carrier <span class="main">:=</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">g</span><span class="main">}</span><span class="main">⦈</span><span class="main">)</span> <span class="main">(</span>set <span class="skolem">gs</span><span class="main">)</span> <span class="main">≅</span> <span class="free">G</span>"</span></span>
          <span class="quoted"><span class="quoted">"successively <span class="keyword1">(dvd)</span> <span class="main">(</span>map ord <span class="skolem">gs</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>set <span class="skolem">gs</span><span class="main">)</span> <span class="main">≤</span> card <span class="free">gen</span>"</span></span>
          <span class="quoted"><span class="quoted">"compl_fam <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">g</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span>set <span class="skolem">gs</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">𝟭</span> <span class="main">∉</span> set <span class="skolem">gs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?DP</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"DirProds <span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> <span class="free">G</span><span class="main">⦇</span>carrier <span class="main">:=</span> generate <span class="free">G</span> <span class="main">{</span><span class="bound">g</span><span class="main">}</span><span class="main">⦈</span><span class="main">)</span> <span class="main">(</span>set <span class="skolem">gs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ns</span><span class="main">.</span> DirProds <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">Z</span> <span class="main">(</span><span class="bound">ns</span><span class="main">!</span><span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">{..&lt;</span>length <span class="bound">ns</span><span class="main">}</span> <span class="main">≅</span> <span class="free">G</span>
           <span class="main">∧</span> successively <span class="keyword1">(dvd)</span> <span class="bound">ns</span> <span class="main">∧</span> length <span class="bound">ns</span> <span class="main">≤</span> card <span class="free">gen</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">gs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Nil
    <span class="keyword1"><span class="command">from</span></span> gs<span class="main">(</span>3<span class="main">)</span> Nil <span class="keyword1"><span class="command">have</span></span> co<span class="main">:</span> <span class="quoted"><span class="quoted">"carrier <span class="var">?DP</span> <span class="main">=</span> <span class="main">{</span><span class="main">𝟭</span><span class="hidden">⇘</span><sub><span class="var">?DP</span></sub><span class="hidden">⇙</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> DirProds_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ns</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"DirProds <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">Z</span> <span class="main">(</span><span class="main">[]</span> <span class="main">!</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">{}</span> <span class="main">≅</span> <span class="var">?DP</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> triv_iso DirProds_is_group<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"carrier <span class="main">(</span>DirProds <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">Z</span> <span class="main">(</span><span class="main">[]</span> <span class="main">!</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">{}</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">𝟭</span><span class="hidden">⇘</span><sub>DirProds <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">Z</span> <span class="main">(</span><span class="main">[]</span> <span class="main">!</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">{}</span></sub><span class="hidden">⇙</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> DirProds_empty <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> co group_integer_mod_group Nil <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> that<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?ns</span></span></span><span class="main">]</span> gs co iso_trans<span class="main">[</span><span class="operator">OF</span> this gs<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"DirProds <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">Z</span> <span class="main">(</span><span class="var">?ns</span> <span class="main">!</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">{..&lt;</span>length <span class="var">?ns</span><span class="main">}</span> <span class="main">≅</span> <span class="free">G</span>
        <span class="main">∧</span> successively <span class="keyword1">(dvd)</span> <span class="var">?ns</span> <span class="main">∧</span> length <span class="var">?ns</span> <span class="main">≤</span> card <span class="free">gen</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> lessThan_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> c<span class="main">:</span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">list</span><span class="main">)</span>    
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"map ord <span class="skolem">gs</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> c <span class="keyword1"><span class="command">have</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="var">?l</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"DirProds <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">Z</span> <span class="main">(</span><span class="var">?l</span> <span class="main">!</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">{..&lt;</span>length <span class="var">?l</span><span class="main">}</span> <span class="main">≅</span> <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"DirProds <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">Z</span> <span class="main">(</span><span class="var">?l</span> <span class="main">!</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">{..&lt;</span>length <span class="var">?l</span><span class="main">}</span> <span class="main">≅</span> <span class="var">?DP</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> DirProds_iso<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="var">?f</span> <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">n</span></span><span class="main"><span class="main">.</span></span> <span class="skolem"><span class="skolem">gs</span></span><span class="main"><span class="main">!</span></span><span class="bound"><span class="bound">n</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span><span class="main">(!)</span> <span class="skolem">gs</span><span class="main">)</span> <span class="main">{..&lt;</span>length <span class="var">?l</span><span class="main">}</span> <span class="main">(</span>set <span class="skolem">gs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> gs
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bij_betw_nth<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">Z</span> <span class="main">(</span>map ord <span class="skolem">gs</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">≅</span> <span class="free">G</span><span class="main">⦇</span>carrier <span class="main">:=</span> generate <span class="free">G</span> <span class="main">{</span><span class="skolem">gs</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">}</span><span class="main">⦈</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="main">{..&lt;</span>length <span class="var">?l</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
        <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> group.iso_sym<span class="main"><span class="main">[</span></span><span class="operator">OF</span> subgroup.subgroup_is_group<span class="main"><span class="main">[</span></span><span class="operator">OF</span> generate_is_subgroup<span class="main"><span class="main">]</span></span>
                   cyclic_group.Zn_iso<span class="main"><span class="main">[</span></span><span class="operator">OF</span> cyclic_groupI2<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"order <span class="main">(</span><span class="free">G</span><span class="main">⦇</span>carrier <span class="main">:=</span> generate <span class="free">G</span> <span class="main">{</span><span class="skolem">gs</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">}</span><span class="main">⦈</span><span class="main">)</span> <span class="main">=</span> map ord <span class="skolem">gs</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> order_def <span class="keyword1"><span class="command">using</span></span> that generate_pow_card<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">gs</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span><span class="main">]</span> gs<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> gs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> that <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Group.group <span class="main">(</span><span class="keyword1">Z</span> <span class="main">(</span>map ord <span class="skolem">gs</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="main">{..&lt;</span>length <span class="main">(</span>map ord <span class="skolem">gs</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
          <span class="keyword1"><span class="command">using</span></span> group_integer_mod_group <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Group.group <span class="main">(</span><span class="free">G</span><span class="main">⦇</span>carrier <span class="main">:=</span> generate <span class="free">G</span> <span class="main">{</span><span class="skolem">g</span><span class="main">}</span><span class="main">⦈</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> set <span class="skolem">gs</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">g</span>
          <span class="keyword1"><span class="command">using</span></span> that gs<span class="main">(</span>1<span class="main">)</span> subgroup.subgroup_is_group<span class="main">[</span><span class="operator">OF</span> generate_is_subgroup<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">from</span></span> iso_trans<span class="main">[</span><span class="operator">OF</span> this gs<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="var">?l</span> <span class="main">≤</span> card <span class="free">gen</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> gs <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> distinct_card length_map<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> gs c <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹As every <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>integer_mod_group›</span></span></span></span> can be decomposed into a product of prime power groups,
we obtain (by using the fact that the direct product does not care about nestedness)
the primary decomposition.›</span></span>

<span class="keyword1" id="Finitely_Generated_Abelian_Groups-Zn_iso_DirProds_prime_powers"><span class="command">lemma</span></span> Zn_iso_DirProds_prime_powers<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">Z</span> <span class="free">n</span> <span class="main">≅</span> DirProds <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="keyword1">Z</span> <span class="main">(</span><span class="bound">p</span> <span class="main">^</span> multiplicity <span class="bound">p</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>prime_factors <span class="free">n</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">Z</span> <span class="free">n</span> <span class="main">≅</span> <span class="var">?DP</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="main">1</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> triv_iso<span class="main"><span class="main">[</span></span><span class="operator">OF</span> group_integer_mod_group DirProds_is_group<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span>
                   <span class="operator">use</span> DirProds_empty carrier_integer_mod_group True <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> nno<span class="main">:</span> False
  <span class="keyword1"><span class="command">interpret</span></span> DP<span class="main">:</span> group <span class="var"><span class="quoted"><span class="var">?DP</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> DirProds_is_group<span class="main"><span class="keyword3">,</span></span> <span class="operator">use</span> group_integer_mod_group <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">blast</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"order <span class="var">?DP</span> <span class="main">=</span> prod <span class="main">(</span>order <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="keyword1">Z</span> <span class="main">(</span><span class="bound">p</span> <span class="main">^</span> multiplicity <span class="bound">p</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>prime_factors <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> DirProds_order<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> prod <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">^</span> multiplicity <span class="bound">p</span> <span class="free">n</span><span class="main">)</span> <span class="main">(</span>prime_factors <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Zn_order <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> prod_prime_factors<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> oDP<span class="main">:</span> <span class="quoted"><span class="quoted">"order <span class="var">?DP</span> <span class="main">=</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> DP<span class="main">:</span> finite_group <span class="var"><span class="quoted"><span class="var">?DP</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> order_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> assms card.infinite<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">p</span><span class="main">∈</span><span class="main">(</span>prime_factors <span class="free">n</span><span class="main">)</span><span class="main">.</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> fc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">∈</span> carrier <span class="var">?DP</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> multiplicity <span class="skolem">p</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> prime_factors <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">p</span>
      <span class="keyword1"><span class="command">using</span></span> prime_factors_multiplicity that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> pk<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">&lt;</span> <span class="skolem">p</span> <span class="main">^</span> <span class="skolem">k</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"Factorial_Ring.prime <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">k</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">p</span> <span class="skolem">k</span><span class="main">::</span><span class="quoted">nat</span>
      <span class="keyword1"><span class="command">using</span></span> that one_less_power prime_gt_1_nat <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> DirProds_def PiE_def
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">use</span> carrier_integer_mod_group assms nno pk p <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span>
         <span class="operator">metis</span> in_prime_factors_iff nat_int of_nat_power one_less_nat_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> of<span class="main">:</span> <span class="quoted"><span class="quoted">"DP.ord <span class="var">?f</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="keyword1">dvd</span> <span class="skolem">j</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">[^]</span><span class="hidden">⇘</span><sub><span class="var">?DP</span></sub><span class="hidden">⇙</span> <span class="skolem">j</span> <span class="main">=</span> <span class="main">𝟭</span><span class="hidden">⇘</span><sub><span class="var">?DP</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">j</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> pairwise_coprime_dvd'<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ _ n<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>prime_factors <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">∈#</span>prime_factorization <span class="free">n</span><span class="main">.</span> <span class="bound">a</span> <span class="main">^</span> multiplicity <span class="bound">a</span> <span class="free">n</span> <span class="keyword1">dvd</span> <span class="skolem">j</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> 
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">^</span> multiplicity <span class="skolem">p</span> <span class="free">n</span> <span class="keyword1">dvd</span> <span class="skolem">j</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> prime_factors <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">p</span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">from</span></span> j <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?f</span> <span class="main">[^]</span><span class="hidden">⇘</span><sub><span class="var">?DP</span></sub><span class="hidden">⇙</span> <span class="skolem">j</span><span class="main">)</span> <span class="skolem">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> DirProds_def one_integer_mod_group <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="skolem">p</span> <span class="main">[^]</span><span class="hidden">⇘</span><sub><span class="keyword1">Z</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">^</span> multiplicity <span class="skolem">p</span> <span class="free">n</span><span class="main">)</span></sub><span class="hidden">⇙</span> <span class="skolem">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> comp_exp_nat<span class="main">[</span><span class="operator">OF</span> that<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"group.ord <span class="main">(</span><span class="keyword1">Z</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">^</span> multiplicity <span class="skolem">p</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="var">?f</span> <span class="skolem">p</span><span class="main">)</span> <span class="keyword1">dvd</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> comp_in_carr<span class="main">[</span><span class="operator">OF</span> fc that<span class="main">]</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> group.pow_eq_id group_integer_mod_group one_integer_mod_group<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"group.ord <span class="main">(</span><span class="keyword1">Z</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">^</span> multiplicity <span class="skolem">p</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="var">?f</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">p</span> <span class="main">^</span> multiplicity <span class="skolem">p</span> <span class="free">n</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Zn_neq1_cyclic_group Zn_order comp_in_carr
                                          cyclic_group.ord_gen_is_group_order fc integer_mod_group_1
                                          restrict_apply' that<span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"coprime <span class="main">(</span><span class="skolem">i</span> <span class="main">^</span> multiplicity <span class="skolem">i</span> <span class="free">n</span><span class="main">)</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">^</span> multiplicity <span class="skolem">j</span> <span class="free">n</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈#</span> prime_factorization <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">∈#</span> prime_factorization <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≠</span> <span class="skolem">j</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
        <span class="keyword1"><span class="command">using</span></span> that diff_prime_power_imp_coprime <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> fc DP.ord_dvd_group_order gcd_nat.asym oDP <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">interpret</span></span> DP<span class="main">:</span> cyclic_group <span class="var"><span class="quoted"><span class="var">?DP</span></span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> DP.element_ord_generates_cyclic<span class="main"><span class="keyword3">,</span></span> <span class="operator">use</span> of oDP fc <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> DP.iso_sym<span class="main">[</span><span class="operator">OF</span> DP.Zn_iso<span class="main"><span class="main">[</span></span><span class="operator">OF</span> oDP<span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Finitely_Generated_Abelian_Groups-Zn_iso_DirProds_prime_powers'"><span class="command">lemma</span></span> Zn_iso_DirProds_prime_powers'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">Z</span> <span class="free">n</span> <span class="main">≅</span> DirProds <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="keyword1">Z</span> <span class="bound">p</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">^</span> multiplicity <span class="bound">p</span> <span class="free">n</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span>prime_factors <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">Z</span> <span class="free">n</span> <span class="main">≅</span> <span class="var">?DP</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> cp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="keyword1">Z</span> <span class="main">(</span><span class="bound">p</span> <span class="main">^</span> multiplicity <span class="bound">p</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="keyword1">Z</span> <span class="bound">p</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">^</span> multiplicity <span class="bound">p</span> <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"DirProds <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="keyword1">Z</span> <span class="main">(</span><span class="bound">p</span> <span class="main">^</span> multiplicity <span class="bound">p</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>prime_factors <span class="free">n</span><span class="main">)</span> <span class="main">≅</span> <span class="var">?DP</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">subst</span> cp<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> DirProds_iso2<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">^</span> multiplicity <span class="bound">p</span> <span class="free">n</span><span class="main">)</span> <span class="main">(</span>prime_factors <span class="free">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> inj_onI<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prime_factors_multiplicity prime_power_inj''<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"group <span class="main">(</span>DirProds <span class="keyword1">Z</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">^</span> multiplicity <span class="bound">p</span> <span class="free">n</span><span class="main">)</span> <span class="main">`</span> prime_factors <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> DirProds_is_group<span class="main"><span class="keyword3">,</span></span> <span class="operator">use</span> group_integer_mod_group <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> Zn_iso_DirProds_prime_powers<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Group.iso_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> fin_gen_comm_group<span class="main">)</span> primary_decomposition_Zn<span class="main">:</span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">ns</span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"DirProds <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">Z</span> <span class="main">(</span><span class="free">ns</span><span class="main">!</span><span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">{..&lt;</span>length <span class="free">ns</span><span class="main">}</span> <span class="main">≅</span> <span class="free">G</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">∈</span>set <span class="free">ns</span><span class="main">.</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">p</span> <span class="bound">k</span><span class="main">.</span> Factorial_Ring.prime <span class="bound">p</span> <span class="main">∧</span> <span class="bound">k</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> <span class="bound">n</span> <span class="main">=</span> <span class="bound">p</span> <span class="main">^</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> invariant_factor_decomposition_Zn <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ms</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    ms<span class="main">:</span> <span class="quoted"><span class="quoted">"DirProds <span class="main">(</span><span class="main">λ</span><span class="bound">m</span><span class="main">.</span> <span class="keyword1">Z</span> <span class="main">(</span><span class="skolem">ms</span><span class="main">!</span><span class="bound">m</span><span class="main">)</span><span class="main">)</span> <span class="main">{..&lt;</span>length <span class="skolem">ms</span><span class="main">}</span> <span class="main">≅</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"successively <span class="keyword1">(dvd)</span> <span class="skolem">ms</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">ms</span> <span class="main">≤</span> card <span class="free">gen</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?I</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{..&lt;</span>length <span class="skolem">ms</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?J</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">if</span> <span class="skolem">ms</span><span class="main">!</span><span class="bound">i</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">^</span> multiplicity <span class="bound">p</span> <span class="main">(</span><span class="skolem">ms</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span>prime_factors <span class="main">(</span><span class="skolem">ms</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?G</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">Z</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> DirProds <span class="main">(</span><span class="var">?G</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="var">?J</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"DirProds <span class="main">(</span><span class="main">λ</span><span class="bound">m</span><span class="main">.</span> <span class="keyword1">Z</span> <span class="main">(</span><span class="skolem">ms</span><span class="main">!</span><span class="bound">m</span><span class="main">)</span><span class="main">)</span> <span class="main">{..&lt;</span>length <span class="skolem">ms</span><span class="main">}</span> <span class="main">≅</span> DirProds <span class="var">?f</span> <span class="main">{..&lt;</span>length <span class="skolem">ms</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> DirProds_iso<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">id</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bij_betw id <span class="main">{..&lt;</span>length <span class="skolem">ms</span><span class="main">}</span> <span class="main">{..&lt;</span>length <span class="skolem">ms</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">Z</span> <span class="main">(</span><span class="skolem">ms</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">≅</span> <span class="var">?f</span> <span class="main">(</span>id <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="main">{..&lt;</span>length <span class="skolem">ms</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">ms</span><span class="main">!</span><span class="skolem">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span>
          <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> DirProds_one_cong_sym<span class="main"><span class="keyword3">,</span></span>
          <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> Zn_iso_DirProds_prime_powers'<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="main">{..&lt;</span>length <span class="skolem">ms</span><span class="main">}</span> <span class="main">⟹</span> group <span class="main">(</span><span class="keyword1">Z</span> <span class="main">(</span><span class="skolem">ms</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"group <span class="main">(</span><span class="var">?f</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">∈</span> <span class="main">{..&lt;</span>length <span class="skolem">ms</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">j</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> DirProds_is_group<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≅</span> DirProds <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="var">?G</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">)</span> <span class="main">(</span>Sigma <span class="var">?I</span> <span class="var">?J</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> DirProds_Sigma<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> G1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">≅</span> DirProds <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="var">?G</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">)</span> <span class="main">(</span>Sigma <span class="var">?I</span> <span class="var">?J</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ms<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> DirProds_is_group Group.iso_trans group.iso_sym group_integer_mod_group<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ps</span><span class="main">.</span> set <span class="bound">ps</span> <span class="main">=</span> Sigma <span class="var">?I</span> <span class="var">?J</span> <span class="main">∧</span> distinct <span class="bound">ps</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">intro</span> finite_distinct_list<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ps</span></span> <span class="keyword2"><span class="keyword">where</span></span> ps<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">ps</span> <span class="main">=</span> Sigma <span class="var">?I</span> <span class="var">?J</span>"</span></span> <span class="quoted"><span class="quoted">"distinct <span class="skolem">ps</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ns</span></span> <span class="keyword2"><span class="keyword">where</span></span> ns<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ns</span> <span class="main">=</span> map snd <span class="skolem">ps</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"DirProds <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">Z</span> <span class="main">(</span><span class="skolem">ns</span><span class="main">!</span><span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">{..&lt;</span>length <span class="skolem">ns</span><span class="main">}</span> <span class="main">≅</span> DirProds <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="var">?G</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">)</span> <span class="main">(</span>Sigma <span class="var">?I</span> <span class="var">?J</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span><span class="main">::</span><span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="main">(</span>nat <span class="main">×</span> nat<span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">where</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>length <span class="skolem">ns</span><span class="main">.</span> <span class="skolem">ns</span><span class="main">!</span><span class="bound">i</span> <span class="main">=</span> snd <span class="main">(</span><span class="skolem">b</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="skolem">b</span> <span class="main">{..&lt;</span>length <span class="skolem">ns</span><span class="main">}</span> <span class="main">(</span>Sigma <span class="var">?I</span> <span class="var">?J</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ns ps bij_betw_nth <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">Z</span> <span class="main">(</span><span class="skolem">ns</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">≅</span> <span class="main">(</span><span class="keyword1">case</span> <span class="skolem">b</span> <span class="skolem">i</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⇒</span> <span class="keyword1">Z</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="main">{..&lt;</span>length <span class="skolem">ns</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ns</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">=</span> snd <span class="main">(</span><span class="skolem">b</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b that <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> case_prod_beta<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> DirProds_iso<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> G1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"DirProds <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">Z</span> <span class="main">(</span><span class="skolem">ns</span><span class="main">!</span><span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">{..&lt;</span>length <span class="skolem">ns</span><span class="main">}</span> <span class="main">≅</span> <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Group.iso_trans iso_sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">p</span> <span class="bound">k</span><span class="main">.</span> Factorial_Ring.prime <span class="bound">p</span> <span class="main">∧</span> <span class="bound">k</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> <span class="skolem">n</span> <span class="main">=</span> <span class="bound">p</span> <span class="main">^</span> <span class="bound">k</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">∈</span>set <span class="skolem">ns</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">p</span><span class="main">∈</span>prime_factors <span class="main">(</span><span class="skolem">ms</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span><span class="main">.</span> <span class="skolem">k</span> <span class="main">=</span> <span class="bound">p</span> <span class="main">^</span> multiplicity <span class="bound">p</span> <span class="main">(</span><span class="skolem">ms</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">∈</span> <span class="var">?J</span> <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span> <span class="skolem">i</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">ms</span><span class="main">!</span><span class="skolem">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">use</span> that <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> that ns ps <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> mem_Collect_eq neq0_conv prime_factors_multiplicity<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">ns</span><span class="main">.</span> <span class="main">⟦</span>DirProds <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">Z</span> <span class="main">(</span><span class="bound">ns</span> <span class="main">!</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">{..&lt;</span>length <span class="bound">ns</span><span class="main">}</span> <span class="main">≅</span> <span class="free">G</span><span class="main">;</span>
          <span class="main">∀</span><span class="bound">n</span><span class="main">∈</span>set <span class="bound">ns</span><span class="main">.</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">p</span> <span class="bound">k</span><span class="main">.</span> Factorial_Ring.prime <span class="bound">p</span> <span class="main">∧</span> <span class="bound">k</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> <span class="bound">n</span> <span class="main">=</span> <span class="bound">p</span> <span class="main">^</span> <span class="bound">k</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">thesis</span><span class="main">)</span>
    <span class="main">⟹</span> <span class="free">thesis</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹As every finite group is also finitely generated, it follows that a finite group can be
decomposed in a product of finite cyclic groups.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> finite_comm_group<span class="main">)</span> cyclic_product<span class="main">:</span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">ns</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"DirProds <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">Z</span> <span class="main">(</span><span class="free">ns</span><span class="main">!</span><span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">{..&lt;</span>length <span class="free">ns</span><span class="main">}</span> <span class="main">≅</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">∈</span>set <span class="free">ns</span><span class="main">.</span> <span class="bound">n</span><span class="main">≠</span><span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> primary_decomposition_Zn <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ns</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    ns<span class="main">:</span> <span class="quoted"><span class="quoted">"DirProds <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">Z</span> <span class="main">(</span><span class="skolem">ns</span> <span class="main">!</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">{..&lt;</span>length <span class="skolem">ns</span><span class="main">}</span> <span class="main">≅</span> <span class="free">G</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">∈</span>set <span class="skolem">ns</span><span class="main">.</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">p</span> <span class="bound">k</span><span class="main">.</span> normalization_semidom_class.prime <span class="bound">p</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">k</span> <span class="main">∧</span> <span class="bound">n</span> <span class="main">=</span> <span class="bound">p</span> <span class="main">^</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> <span class="main">{..&lt;</span>length <span class="skolem">ns</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ns</span><span class="main">!</span><span class="skolem">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> that <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"order <span class="main">(</span>DirProds <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">Z</span> <span class="main">(</span><span class="skolem">ns</span> <span class="main">!</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">{..&lt;</span>length <span class="skolem">ns</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> DirProds_order<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{..&lt;</span>length <span class="skolem">ns</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">Z</span> <span class="main">(</span><span class="skolem">ns</span><span class="main">!</span><span class="bound">n</span><span class="main">)</span>"</span></span><span class="main">]</span> Zn_order <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> fin iso_same_card<span class="main">[</span><span class="operator">OF</span> ns<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">unfolding</span></span> order_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">∈</span>set <span class="skolem">ns</span><span class="main">.</span> <span class="bound">n</span><span class="main">≠</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> in_set_conv_nth lessThan_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> ns <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">no_notation</span></span> integer_mod_group <span class="main">(</span><span class="quoted">"<span class="keyword1">Z</span>"</span><span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>