<div id="Util">
<div class="head">
<h1>Theory Util</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:      Schutz_Spacetime/Util.thy
    Authors:    Richard Schmoetten, Jake Palmer and Jacques D. Fleuriot
                University of Edinburgh, 2021          
*)</span>
<span class="keyword1"><span class="command">theory</span></span> Util
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL/Main.html">Main</a>

<span class="comment1">(* Some "utility" proofs -- little proofs that come in handy every now and then. *)</span>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We need this in order to obtain a natural number which can be passed to the ordering function,
  distinct from two others, in the case of a finite set of events with cardinality a least 3.
›</span></span>

<span class="keyword1" id="Util-is_free_nat"><span class="command">lemma</span></span> is_free_nat<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">m</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&lt;</span> <span class="free">c</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">≥</span> <span class="numeral">3</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">k</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">k</span> <span class="main">&lt;</span> <span class="free">m</span> <span class="main">∨</span> <span class="main">(</span><span class="free">m</span> <span class="main">&lt;</span> <span class="bound">k</span> <span class="main">∧</span> <span class="bound">k</span> <span class="main">&lt;</span> <span class="free">n</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">n</span> <span class="main">&lt;</span> <span class="bound">k</span> <span class="main">∧</span> <span class="bound">k</span> <span class="main">&lt;</span> <span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Helpful proofs on sets.›</span></span>

<span class="keyword1" id="Util-set_le_two"><span class="command">lemma</span></span> set_le_two <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">}</span> <span class="main">≤</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_insert_if<span class="main">)</span>

<span class="keyword1" id="Util-set_le_three"><span class="command">lemma</span></span> set_le_three <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">,</span> <span class="free">c</span><span class="main">}</span> <span class="main">≤</span> <span class="numeral">3</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_insert_if<span class="main">)</span>

<span class="keyword1" id="Util-card_subset"><span class="command">lemma</span></span> card_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>card <span class="free">Y</span> <span class="main">=</span> <span class="free">n</span><span class="main">;</span> <span class="free">Y</span> <span class="main">⊆</span> <span class="free">X</span><span class="main">⟧</span> <span class="main">⟹</span> card <span class="free">X</span> <span class="main">≥</span> <span class="free">n</span> <span class="main">∨</span> infinite <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> card_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Util-card_subset_finite"><span class="command">lemma</span></span> card_subset_finite<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>finite <span class="free">X</span><span class="main">;</span> card <span class="free">Y</span> <span class="main">=</span> <span class="free">n</span><span class="main">;</span> <span class="free">Y</span> <span class="main">⊆</span> <span class="free">X</span><span class="main">⟧</span> <span class="main">⟹</span> card <span class="free">X</span> <span class="main">≥</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> card_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Util-three_subset"><span class="command">lemma</span></span> three_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">x</span> <span class="main">≠</span> <span class="free">y</span><span class="main">;</span> <span class="free">x</span> <span class="main">≠</span> <span class="free">z</span><span class="main">;</span> <span class="free">y</span> <span class="main">≠</span> <span class="free">z</span><span class="main">;</span> <span class="main">{</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">,</span><span class="free">z</span><span class="main">}</span> <span class="main">⊆</span> <span class="free">X</span><span class="main">⟧</span> <span class="main">⟹</span> card <span class="free">X</span> <span class="main">≥</span> <span class="numeral">3</span> <span class="main">∨</span> infinite <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="main"><span class="main">:</span></span> card_mono<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> Y <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">,</span><span class="free">z</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> card_subset_finite<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Util-card_Collect_nat"><span class="command">lemma</span></span> card_Collect_nat<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">j</span><span class="main">::</span>nat<span class="main">)</span><span class="main">&gt;</span><span class="free">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="free">i</span><span class="main">..</span><span class="free">j</span><span class="main">}</span> <span class="main">=</span> <span class="free">j</span><span class="main">-</span><span class="free">i</span><span class="main">+</span><span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> card_atLeastAtMost
  <span class="keyword1"><span class="command">using</span></span> Suc_diff_le assms le_eq_less_or_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹These lemmas make life easier with some of the ordering proofs.›</span></span>

<span class="keyword1" id="Util-less_3_cases"><span class="command">lemma</span></span> less_3_cases<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&lt;</span> <span class="numeral">3</span> <span class="main">⟹</span> <span class="free">n</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">n</span> <span class="main">=</span> Suc <span class="main">0</span> <span class="main">∨</span> <span class="free">n</span> <span class="main">=</span> Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="TernaryOrdering">
<div class="head">
<h1>Theory TernaryOrdering</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:      Schutz_Spacetime/TernaryOrdering.thy
    Authors:    Richard Schmoetten, Jake Palmer and Jacques D. Fleuriot
                University of Edinburgh, 2021          
*)</span>
<span class="keyword1"><span class="command">theory</span></span> TernaryOrdering
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="#Util">Util</a>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Definition of chains using an ordering on sets of events
  based on natural numbers, plus some proofs.
›</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Totally ordered chains›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Based on page 110 of Phil Scott's thesis and the following HOL Light definition:
  \begin{verbatim}
  let ORDERING = new_definition
    `ORDERING f X &lt;=&gt; (!n. (FINITE X ==&gt; n &lt; CARD X) ==&gt; f n IN X)
                    /\ (!x. x IN X ==&gt; ?n. (FINITE X ==&gt; n &lt; CARD X)
                        /\ f n = x)                   
                    /\ !n n' n''. (FINITE X ==&gt; n'' &lt; CARD X)
                          /\ n &lt; n' /\ n' &lt; n'' 
                          ==&gt; between (f n) (f n') (f n'')`;;
  \end{verbatim}
  I've made it strict for simplicity, and because that's how Schutz's ordering is. It could be
  made more generic by taking in the function corresponding to $&lt;$ as a paramater.
  Main difference to Schutz: he has local order, not total (cf Theorem 2 and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ordering2›</span></span></span></span>).
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ordering</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">ordering</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">ord</span></span></span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span>finite <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">⟶</span> <span class="bound">n</span> <span class="main">&lt;</span> card <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">)</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">n</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">)</span>
                     <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span>finite <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">⟶</span> <span class="bound">n</span> <span class="main">&lt;</span> card <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">n</span> <span class="main">=</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>
                     <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">n</span> <span class="bound">n'</span> <span class="bound">n''</span><span class="main">.</span> <span class="main">(</span>finite <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">⟶</span> <span class="bound">n''</span> <span class="main">&lt;</span> card <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="bound">n</span> <span class="main">&lt;</span> <span class="bound">n'</span> <span class="main">∧</span> <span class="bound">n'</span> <span class="main">&lt;</span> <span class="bound">n''</span>
                                   <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">ord</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">n'</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">n''</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="TernaryOrdering-ordering_ord_ijk"><span class="command">lemma</span></span> ordering_ord_ijk<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ordering <span class="free">f</span> <span class="free">ord</span> <span class="free">X</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">j</span> <span class="main">∧</span> <span class="free">j</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">∧</span> <span class="main">(</span>finite <span class="free">X</span> <span class="main">⟶</span> <span class="free">k</span> <span class="main">&lt;</span> card <span class="free">X</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">ord</span> <span class="main">(</span><span class="free">f</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="free">j</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ordering_def assms<span class="main">)</span>

<span class="keyword1" id="TernaryOrdering-empty_ordering"><span class="command">lemma</span></span> empty_ordering <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">f</span><span class="main">.</span> ordering <span class="bound">f</span> <span class="free">ord</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ordering_def<span class="main">)</span>

<span class="keyword1" id="TernaryOrdering-singleton_ordering"><span class="command">lemma</span></span> singleton_ordering <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">f</span><span class="main">.</span> ordering <span class="bound">f</span> <span class="free">ord</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ordering_def<span class="main">)</span>

<span class="keyword1" id="TernaryOrdering-two_ordering"><span class="command">lemma</span></span> two_ordering <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">f</span><span class="main">.</span> ordering <span class="bound">f</span> <span class="free">ord</span> <span class="main">{</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="free">b</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> singleton_ordering <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> a_neq_b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="free">a</span> <span class="keyword1">else</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> ordering1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span>finite <span class="main">{</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">}</span> <span class="main">⟶</span> <span class="bound">n</span> <span class="main">&lt;</span> card <span class="main">{</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="main">⟶</span> <span class="var">?f</span> <span class="bound">n</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> ordering2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">}</span><span class="main">.</span> <span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span>finite <span class="main">{</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">}</span> <span class="main">⟶</span> <span class="bound">n</span> <span class="main">&lt;</span> card <span class="main">{</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="main">∧</span> <span class="var">?f</span> <span class="bound">n</span> <span class="main">=</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a_neq_b all_not_in_conv card_Suc_eq card_0_eq card_gt_0_iff insert_iff lessI <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> ordering3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">n</span> <span class="bound">n'</span> <span class="bound">n''</span><span class="main">.</span> <span class="main">(</span>finite <span class="main">{</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">}</span> <span class="main">⟶</span> <span class="bound">n''</span> <span class="main">&lt;</span> card <span class="main">{</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">n</span> <span class="main">&lt;</span> <span class="bound">n'</span> <span class="main">∧</span> <span class="bound">n'</span> <span class="main">&lt;</span> <span class="bound">n''</span>
                                <span class="main">⟶</span> <span class="free">ord</span> <span class="main">(</span><span class="var">?f</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span><span class="var">?f</span> <span class="bound">n'</span><span class="main">)</span> <span class="main">(</span><span class="var">?f</span> <span class="bound">n''</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a_neq_b <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ordering <span class="var">?f</span> <span class="free">ord</span> <span class="main">{</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ordering_def ordering1 ordering2 ordering3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="TernaryOrdering-card_le2_ordering"><span class="command">lemma</span></span> card_le2_ordering<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> finiteX<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> card_le2<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="free">X</span> <span class="main">≤</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">f</span><span class="main">.</span> ordering <span class="bound">f</span> <span class="free">ord</span> <span class="free">X</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> card012<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="free">X</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> card <span class="free">X</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∨</span> card <span class="free">X</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> card_le2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> card0<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="free">X</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟶</span> <span class="var">?thesis</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> finiteX <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> card1<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="free">X</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⟶</span> <span class="var">?thesis</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> card_eq_SucD <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> card2<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="free">X</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">⟶</span> <span class="var">?thesis</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> two_ordering card_eq_SucD numeral_2_eq_2<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> card012 card0 card1 card2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="TernaryOrdering-ord_ordered"><span class="command">lemma</span></span> ord_ordered<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> abc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ord</span> <span class="free">a</span> <span class="free">b</span> <span class="free">c</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> abc_neq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">≠</span> <span class="free">c</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">≠</span> <span class="free">c</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">f</span><span class="main">.</span> ordering <span class="bound">f</span> <span class="free">ord</span> <span class="main">{</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">,</span><span class="free">c</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="free">a</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="free">b</span> <span class="keyword1">else</span> <span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> ordering_def<span class="main">)</span>
<span class="keyword1"><span class="command">using</span></span> abc abc_neq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="TernaryOrdering-overlap_ordering"><span class="command">lemma</span></span> overlap_ordering<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> abc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ord</span> <span class="free">a</span> <span class="free">b</span> <span class="free">c</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> bcd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ord</span> <span class="free">b</span> <span class="free">c</span> <span class="free">d</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> abd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ord</span> <span class="free">a</span> <span class="free">b</span> <span class="free">d</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> acd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ord</span> <span class="free">a</span> <span class="free">c</span> <span class="free">d</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> abc_neq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">≠</span> <span class="free">c</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">≠</span> <span class="free">d</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">≠</span> <span class="free">c</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">≠</span> <span class="free">d</span> <span class="main">∧</span> <span class="free">c</span> <span class="main">≠</span> <span class="free">d</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">f</span><span class="main">.</span> ordering <span class="bound">f</span> <span class="free">ord</span> <span class="main">{</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">,</span><span class="free">c</span><span class="main">,</span><span class="free">d</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?X</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">,</span><span class="free">c</span><span class="main">,</span><span class="free">d</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="free">a</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="free">b</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">n</span> <span class="main">=</span> <span class="numeral">2</span> <span class="keyword1">then</span> <span class="free">c</span> <span class="keyword1">else</span> <span class="free">d</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> card4<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="var">?X</span> <span class="main">=</span> <span class="numeral">4</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> abc bcd abd abc_neq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> ordering1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span>finite <span class="var">?X</span> <span class="main">⟶</span> <span class="bound">n</span> <span class="main">&lt;</span> card <span class="var">?X</span><span class="main">)</span> <span class="main">⟶</span> <span class="var">?f</span> <span class="bound">n</span> <span class="main">∈</span> <span class="var">?X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> ordering2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="var">?X</span><span class="main">.</span> <span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span>finite <span class="var">?X</span> <span class="main">⟶</span> <span class="bound">n</span> <span class="main">&lt;</span> card <span class="var">?X</span><span class="main">)</span> <span class="main">∧</span> <span class="var">?f</span> <span class="bound">n</span> <span class="main">=</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> card4 One_nat_def Suc_1 Suc_lessI empty_iff insertE numeral_3_eq_3 numeral_eq_iff
              numeral_eq_one_iff rel_simps<span class="main"><span class="main">(</span></span>51<span class="main"><span class="main">)</span></span> semiring_norm<span class="main"><span class="main">(</span></span>85<span class="main"><span class="main">)</span></span> semiring_norm<span class="main"><span class="main">(</span></span>86<span class="main"><span class="main">)</span></span> semiring_norm<span class="main"><span class="main">(</span></span>87<span class="main"><span class="main">)</span></span>
              semiring_norm<span class="main"><span class="main">(</span></span>89<span class="main"><span class="main">)</span></span> zero_neq_numeral<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> ordering3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">n</span> <span class="bound">n'</span> <span class="bound">n''</span><span class="main">.</span> <span class="main">(</span>finite <span class="var">?X</span> <span class="main">⟶</span> <span class="bound">n''</span> <span class="main">&lt;</span> card <span class="var">?X</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">n</span> <span class="main">&lt;</span> <span class="bound">n'</span> <span class="main">∧</span> <span class="bound">n'</span> <span class="main">&lt;</span> <span class="bound">n''</span>
                                 <span class="main">⟶</span> <span class="free">ord</span> <span class="main">(</span><span class="var">?f</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span><span class="var">?f</span> <span class="bound">n'</span><span class="main">)</span> <span class="main">(</span><span class="var">?f</span> <span class="bound">n''</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> card4 abc bcd abd acd card_0_eq card_insert_if finite.emptyI finite_insert less_antisym
          less_one less_trans_Suc not_less_eq not_one_less_zero numeral_2_eq_2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ordering <span class="var">?f</span> <span class="free">ord</span> <span class="var">?X</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ordering1 ordering2 ordering3 ordering_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="TernaryOrdering-overlap_ordering_alt1"><span class="command">lemma</span></span> overlap_ordering_alt1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> abc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ord</span> <span class="free">a</span> <span class="free">b</span> <span class="free">c</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> bcd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ord</span> <span class="free">b</span> <span class="free">c</span> <span class="free">d</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> abc_bcd_abd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">.</span> <span class="free">ord</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="main">∧</span> <span class="free">ord</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">d</span> <span class="main">⟶</span> <span class="free">ord</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">d</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> abc_bcd_acd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">.</span> <span class="free">ord</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="main">∧</span> <span class="free">ord</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">d</span> <span class="main">⟶</span> <span class="free">ord</span> <span class="bound">a</span> <span class="bound">c</span> <span class="bound">d</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> ord_distinct<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span><span class="main">.</span> <span class="main">(</span><span class="free">ord</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="main">⟶</span> <span class="bound">a</span> <span class="main">≠</span> <span class="bound">b</span> <span class="main">∧</span> <span class="bound">a</span> <span class="main">≠</span> <span class="bound">c</span> <span class="main">∧</span> <span class="bound">b</span> <span class="main">≠</span> <span class="bound">c</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">f</span><span class="main">.</span> ordering <span class="bound">f</span> <span class="free">ord</span> <span class="main">{</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">,</span><span class="free">c</span><span class="main">,</span><span class="free">d</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> assms overlap_ordering<span class="main">)</span>

<span class="keyword1" id="TernaryOrdering-overlap_ordering_alt2"><span class="command">lemma</span></span> overlap_ordering_alt2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> abc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ord</span> <span class="free">a</span> <span class="free">b</span> <span class="free">c</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> bcd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ord</span> <span class="free">b</span> <span class="free">c</span> <span class="free">d</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> abd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ord</span> <span class="free">a</span> <span class="free">b</span> <span class="free">d</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> acd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ord</span> <span class="free">a</span> <span class="free">c</span> <span class="free">d</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> ord_distinct<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span><span class="main">.</span> <span class="main">(</span><span class="free">ord</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="main">⟶</span> <span class="bound">a</span> <span class="main">≠</span> <span class="bound">b</span> <span class="main">∧</span> <span class="bound">a</span> <span class="main">≠</span> <span class="bound">c</span> <span class="main">∧</span> <span class="bound">b</span> <span class="main">≠</span> <span class="bound">c</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">f</span><span class="main">.</span> ordering <span class="bound">f</span> <span class="free">ord</span> <span class="main">{</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">,</span><span class="free">c</span><span class="main">,</span><span class="free">d</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms overlap_ordering<span class="main">)</span>

<span class="keyword1" id="TernaryOrdering-overlap_ordering_alt"><span class="command">lemma</span></span> overlap_ordering_alt<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> abc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ord</span> <span class="free">a</span> <span class="free">b</span> <span class="free">c</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> bcd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ord</span> <span class="free">b</span> <span class="free">c</span> <span class="free">d</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> abc_bcd_abd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">.</span> <span class="free">ord</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="main">∧</span> <span class="free">ord</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">d</span> <span class="main">⟶</span> <span class="free">ord</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">d</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> abc_bcd_acd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">.</span> <span class="free">ord</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="main">∧</span> <span class="free">ord</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">d</span> <span class="main">⟶</span> <span class="free">ord</span> <span class="bound">a</span> <span class="bound">c</span> <span class="bound">d</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> abc_neq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">≠</span> <span class="free">c</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">≠</span> <span class="free">d</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">≠</span> <span class="free">c</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">≠</span> <span class="free">d</span> <span class="main">∧</span> <span class="free">c</span> <span class="main">≠</span> <span class="free">d</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">f</span><span class="main">.</span> ordering <span class="bound">f</span> <span class="free">ord</span> <span class="main">{</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">,</span><span class="free">c</span><span class="main">,</span><span class="free">d</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms overlap_ordering<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The lemmas below are easy to prove for <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>X = {}›</span></span></span></span>, and if I included that case then I would have
  to write a conditional definition in place of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>{0..|X| - 1}›</span></span></span></span>.
›</span></span>

<span class="keyword1" id="TernaryOrdering-finite_ordering_img"><span class="command">lemma</span></span> finite_ordering_img<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">X</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">;</span> finite <span class="free">X</span><span class="main">;</span> ordering <span class="free">f</span> <span class="free">ord</span> <span class="free">X</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span>card <span class="free">X</span> <span class="main">-</span> <span class="main">1</span><span class="main">}</span> <span class="main">=</span> <span class="free">X</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ordering_def image_def<span class="main">)</span>

<span class="keyword1" id="TernaryOrdering-inf_ordering_img"><span class="command">lemma</span></span> inf_ordering_img<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>infinite <span class="free">X</span><span class="main">;</span> ordering <span class="free">f</span> <span class="free">ord</span> <span class="free">X</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">..}</span> <span class="main">=</span> <span class="free">X</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ordering_def image_def<span class="main">)</span>

<span class="keyword1" id="TernaryOrdering-finite_ordering_inv_img"><span class="command">lemma</span></span> finite_ordering_inv_img<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">X</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">;</span> finite <span class="free">X</span><span class="main">;</span> ordering <span class="free">f</span> <span class="free">ord</span> <span class="free">X</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">-`</span> <span class="free">X</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span>card <span class="free">X</span> <span class="main">-</span> <span class="main">1</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ordering_def<span class="main">)</span>
<span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1" id="TernaryOrdering-inf_ordering_inv_img"><span class="command">lemma</span></span> inf_ordering_inv_img<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>infinite <span class="free">X</span><span class="main">;</span> ordering <span class="free">f</span> <span class="free">ord</span> <span class="free">X</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">-`</span> <span class="free">X</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">..}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ordering_def image_def<span class="main">)</span>

<span class="keyword1" id="TernaryOrdering-inf_ordering_img_inv_img"><span class="command">lemma</span></span> inf_ordering_img_inv_img<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>infinite <span class="free">X</span><span class="main">;</span> ordering <span class="free">f</span> <span class="free">ord</span> <span class="free">X</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">`</span> <span class="free">f</span> <span class="main">-`</span> <span class="free">X</span> <span class="main">=</span> <span class="free">X</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> inf_ordering_img <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="TernaryOrdering-finite_ordering_inj_on"><span class="command">lemma</span></span> finite_ordering_inj_on<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>finite <span class="free">X</span><span class="main">;</span> ordering <span class="free">f</span> <span class="free">ord</span> <span class="free">X</span><span class="main">⟧</span> <span class="main">⟹</span> inj_on <span class="free">f</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span>card <span class="free">X</span> <span class="main">-</span> <span class="main">1</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> finite_ordering_img Suc_diff_1 atLeastAtMost_iff card_atLeastAtMost card_eq_0_iff
          diff_0_eq_0 diff_zero eq_card_imp_inj_on gr0I inj_onI le_0_eq<span class="main">)</span>

<span class="keyword1" id="TernaryOrdering-finite_ordering_bij"><span class="command">lemma</span></span> finite_ordering_bij<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> orderingX<span class="main">:</span> <span class="quoted"><span class="quoted">"ordering <span class="free">f</span> <span class="free">ord</span> <span class="free">X</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> finiteX<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> non_empty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="free">f</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span>card <span class="free">X</span> <span class="main">-</span> <span class="main">1</span><span class="main">}</span> <span class="free">X</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> f_image<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span>card <span class="free">X</span> <span class="main">-</span> <span class="main">1</span><span class="main">}</span> <span class="main">=</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> orderingX finiteX finite_ordering_img non_empty<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inj_on_imp_bij_betw orderingX finiteX finite_ordering_inj_on<span class="main">)</span>  
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* I think there might be a way of proving this without ord_distinct (?) *)</span>
<span class="keyword1" id="TernaryOrdering-inf_ordering_inj'"><span class="command">lemma</span></span> inf_ordering_inj'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> infX<span class="main">:</span> <span class="quoted"><span class="quoted">"infinite <span class="free">X</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> f_ord<span class="main">:</span> <span class="quoted"><span class="quoted">"ordering <span class="free">f</span> <span class="free">ord</span> <span class="free">X</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> ord_distinct<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span><span class="main">.</span> <span class="main">(</span><span class="free">ord</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="main">⟶</span> <span class="bound">a</span> <span class="main">≠</span> <span class="bound">b</span> <span class="main">∧</span> <span class="bound">a</span> <span class="main">≠</span> <span class="bound">c</span> <span class="main">∧</span> <span class="bound">b</span> <span class="main">≠</span> <span class="bound">c</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> f_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">m</span> <span class="main">=</span> <span class="free">f</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
<span class="comment1">(* If m ≠ n and f m = f n then it wouldn't be an ordering, and this part:
   ∀n n' n''. n &lt; n' ∧ n' &lt; n'' ⟶ [[f n f n' f n'']]
   would fail because two of f n f n' f n'' would be equal, and that violates ord_distinct. *)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> m_not_n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">≠</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> betw_3n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span> <span class="bound">n'</span> <span class="bound">n''</span><span class="main">.</span> <span class="bound">n</span> <span class="main">&lt;</span> <span class="bound">n'</span> <span class="main">∧</span> <span class="bound">n'</span> <span class="main">&lt;</span> <span class="bound">n''</span> <span class="main">⟶</span> <span class="free">ord</span> <span class="main">(</span><span class="free">f</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="bound">n'</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="bound">n''</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> f_ord <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ordering_def infX<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
    <span class="keyword3"><span class="command">assume</span></span> m_less_n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&lt;</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">ord</span> <span class="main">(</span><span class="free">f</span> <span class="free">m</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="free">n</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> m_less_n betw_3n <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">m</span> <span class="main">≠</span> <span class="free">f</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ord_distinct <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> f_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">m</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> n_less_m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&lt;</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> m_not_n <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">&lt;</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">ord</span> <span class="main">(</span><span class="free">f</span> <span class="free">n</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="free">m</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> n_less_m betw_3n <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">n</span> <span class="main">≠</span> <span class="free">f</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ord_distinct <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> f_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* f is actually injective when X is infinite. *)</span>
<span class="keyword1" id="TernaryOrdering-inf_ordering_inj"><span class="command">lemma</span></span> inf_ordering_inj<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"infinite <span class="free">X</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"ordering <span class="free">f</span> <span class="free">ord</span> <span class="free">X</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span><span class="main">.</span> <span class="main">(</span><span class="free">ord</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="main">⟶</span> <span class="bound">a</span> <span class="main">≠</span> <span class="bound">b</span> <span class="main">∧</span> <span class="bound">a</span> <span class="main">≠</span> <span class="bound">c</span> <span class="main">∧</span> <span class="bound">b</span> <span class="main">≠</span> <span class="bound">c</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"inj <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> inf_ordering_inj' assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> injI<span class="main">)</span> 

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The finite case is a little more difficult as I can't just choose some other natural number
  to form the third part of the betweenness relation and the initial simplification isn't as nice.
  Note that I cannot prove <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>inj f›</span></span></span></span> (over the whole type that <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>f›</span></span></span></span> is defined on, i.e. natural numbers),
  because I need to capture the <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>m›</span></span></span></span> and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>n›</span></span></span></span> that obey specific requirements for the finite case.
  In order to prove <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>inj f›</span></span></span></span>, I would have to extend the definition for ordering to include <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>m›</span></span></span></span> and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>n›</span></span></span></span>
  beyond <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>card X›</span></span></span></span>, such that it is still injective. That would probably not be very useful.
›</span></span>

<span class="keyword1" id="TernaryOrdering-finite_ordering_inj"><span class="command">lemma</span></span> finite_ordering_inj<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> finiteX<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> f_ord<span class="main">:</span> <span class="quoted"><span class="quoted">"ordering <span class="free">f</span> <span class="free">ord</span> <span class="free">X</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> ord_distinct<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span><span class="main">.</span> <span class="main">(</span><span class="free">ord</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="main">⟶</span> <span class="bound">a</span> <span class="main">≠</span> <span class="bound">b</span> <span class="main">∧</span> <span class="bound">a</span> <span class="main">≠</span> <span class="bound">c</span> <span class="main">∧</span> <span class="bound">b</span> <span class="main">≠</span> <span class="bound">c</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> m_less_card<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">&lt;</span> card <span class="free">X</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> n_less_card<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&lt;</span> card <span class="free">X</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> f_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">m</span> <span class="main">=</span> <span class="free">f</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> m_not_n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">≠</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> surj_f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> <span class="main">∃</span><span class="bound"><span class="bound">n</span></span><span class="main">&lt;</span>card <span class="free">X</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="main">=</span> <span class="bound">x</span>"</span></span>
               <span class="keyword1"><span class="command">using</span></span> f_ord <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ordering_def finiteX<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> betw_3n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span> <span class="bound">n'</span> <span class="bound">n''</span><span class="main">.</span> <span class="bound">n''</span> <span class="main">&lt;</span> card <span class="free">X</span> <span class="main">∧</span> <span class="bound">n</span> <span class="main">&lt;</span> <span class="bound">n'</span> <span class="main">∧</span> <span class="bound">n'</span> <span class="main">&lt;</span> <span class="bound">n''</span> <span class="main">⟶</span> <span class="free">ord</span> <span class="main">(</span><span class="free">f</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="bound">n'</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="bound">n''</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> f_ord <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ordering_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
    <span class="keyword3"><span class="command">assume</span></span> card_le2<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="free">X</span> <span class="main">≤</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> card0<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="free">X</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟶</span> False"</span></span> <span class="keyword1"><span class="command">using</span></span> m_less_card <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> card1<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="free">X</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⟶</span> False"</span></span> <span class="keyword1"><span class="command">using</span></span> m_less_card n_less_card m_not_n <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> card2<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="free">X</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">⟶</span> False"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> impI<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> card_is_2<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="free">X</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> mn01<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">n</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∨</span> <span class="free">n</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">m</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> m_less_card n_less_card m_not_n <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">m</span> <span class="main">≠</span> <span class="free">f</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> card_is_2 surj_f One_nat_def card_eq_SucD insertCI
                                  less_2_cases numeral_2_eq_2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> f_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> card0 card1 card2 card_le2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> card <span class="free">X</span> <span class="main">≤</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> card_ge3<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="free">X</span> <span class="main">≥</span> <span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
      <span class="keyword3"><span class="command">assume</span></span> m_less_n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> k_pos<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&lt;</span> <span class="free">m</span> <span class="main">∨</span> <span class="main">(</span><span class="free">m</span> <span class="main">&lt;</span> <span class="skolem">k</span> <span class="main">∧</span> <span class="skolem">k</span> <span class="main">&lt;</span> <span class="free">n</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">n</span> <span class="main">&lt;</span> <span class="skolem">k</span> <span class="main">∧</span> <span class="skolem">k</span> <span class="main">&lt;</span> card <span class="free">X</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> is_free_nat m_less_n n_less_card card_ge3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> k1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&lt;</span> <span class="free">m</span> <span class="main">⟶</span><span class="free">ord</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="free">m</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> m_less_n n_less_card betw_3n <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> k2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">&lt;</span> <span class="skolem">k</span> <span class="main">∧</span> <span class="skolem">k</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">⟶</span> <span class="free">ord</span> <span class="main">(</span><span class="free">f</span> <span class="free">m</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> m_less_n n_less_card betw_3n <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> k3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&lt;</span> <span class="skolem">k</span> <span class="main">∧</span> <span class="skolem">k</span> <span class="main">&lt;</span> card <span class="free">X</span> <span class="main">⟶</span> <span class="free">ord</span> <span class="main">(</span><span class="free">f</span> <span class="free">m</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="free">n</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> m_less_n betw_3n <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">m</span> <span class="main">≠</span> <span class="free">f</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> k1 k2 k3 k_pos ord_distinct <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> f_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span> <span class="comment1">(* Should work on making these two cases into one; this is quite boilerplatery. *)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">m</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> n_less_m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&lt;</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> m_not_n <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> k_pos<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">∨</span> <span class="main">(</span><span class="free">n</span> <span class="main">&lt;</span> <span class="skolem">k</span> <span class="main">∧</span> <span class="skolem">k</span> <span class="main">&lt;</span> <span class="free">m</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">m</span> <span class="main">&lt;</span> <span class="skolem">k</span> <span class="main">∧</span> <span class="skolem">k</span> <span class="main">&lt;</span> card <span class="free">X</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> is_free_nat n_less_m m_less_card card_ge3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> k1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">⟶</span><span class="free">ord</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="free">n</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="free">m</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> n_less_m m_less_card betw_3n <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> k2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&lt;</span> <span class="skolem">k</span> <span class="main">∧</span> <span class="skolem">k</span> <span class="main">&lt;</span> <span class="free">m</span> <span class="main">⟶</span> <span class="free">ord</span> <span class="main">(</span><span class="free">f</span> <span class="free">n</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="free">m</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> n_less_m m_less_card betw_3n <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> k3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">&lt;</span> <span class="skolem">k</span> <span class="main">∧</span> <span class="skolem">k</span> <span class="main">&lt;</span> card <span class="free">X</span> <span class="main">⟶</span> <span class="free">ord</span> <span class="main">(</span><span class="free">f</span> <span class="free">n</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="free">m</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> n_less_m betw_3n <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">n</span> <span class="main">≠</span> <span class="free">f</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> k1 k2 k3 k_pos ord_distinct <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> f_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="TernaryOrdering-ordering_inj"><span class="command">lemma</span></span> ordering_inj<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ordering <span class="free">f</span> <span class="free">ord</span> <span class="free">X</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span><span class="main">.</span> <span class="main">(</span><span class="free">ord</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="main">⟶</span> <span class="bound">a</span> <span class="main">≠</span> <span class="bound">b</span> <span class="main">∧</span> <span class="bound">a</span> <span class="main">≠</span> <span class="bound">c</span> <span class="main">∧</span> <span class="bound">b</span> <span class="main">≠</span> <span class="bound">c</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span> <span class="main">⟶</span> <span class="free">m</span> <span class="main">&lt;</span> card <span class="free">X</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span> <span class="main">⟶</span> <span class="free">n</span> <span class="main">&lt;</span> card <span class="free">X</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">m</span> <span class="main">=</span> <span class="free">f</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> inf_ordering_inj' finite_ordering_inj assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="TernaryOrdering-ordering_sym"><span class="command">lemma</span></span> ordering_sym<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ord_sym<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span><span class="main">.</span> <span class="free">ord</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="main">⟹</span> <span class="free">ord</span> <span class="bound">c</span> <span class="bound">b</span> <span class="bound">a</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"ordering <span class="free">f</span> <span class="free">ord</span> <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ordering <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span>card <span class="free">X</span> <span class="main">-</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="free">ord</span> <span class="free">X</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> ordering_def <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> ordering_def assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> card_0_eq card_gt_0_iff diff_Suc_less gr_implies_not0<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">X</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span> <span class="main">⟶</span> <span class="skolem">n</span> <span class="main">&lt;</span> card <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">n</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ordering_def <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">X</span>›</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span>card <span class="free">X</span> <span class="main">-</span> <span class="main">(</span><span class="main">(</span>card <span class="free">X</span> <span class="main">-</span> <span class="main">1</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Suc_leI <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="skolem">n</span> <span class="main">=</span> <span class="skolem">x</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">X</span> <span class="main">⟶</span> <span class="skolem">n</span> <span class="main">&lt;</span> card <span class="free">X</span>›</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">n</span></span><span class="main">&lt;</span>card <span class="free">X</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span>card <span class="free">X</span> <span class="main">-</span> Suc <span class="bound">n</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">X</span>›</span></span> add.commute assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> card_Diff_singleton card_Suc_Diff1 diff_less_Suc plus_1_eq_Suc<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="skolem">n'</span> <span class="skolem">n''</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n''</span> <span class="main">&lt;</span> card <span class="free">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> <span class="skolem">n'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span> <span class="main">&lt;</span> <span class="skolem">n''</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">ord</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span>card <span class="free">X</span> <span class="main">-</span> Suc <span class="skolem">n''</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span>card <span class="free">X</span> <span class="main">-</span> Suc <span class="skolem">n'</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span>card <span class="free">X</span> <span class="main">-</span> Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> ordering_def
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">&lt;</span> <span class="skolem">n'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n'</span> <span class="main">&lt;</span> <span class="skolem">n''</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n''</span> <span class="main">&lt;</span> card <span class="free">X</span>›</span></span> diff_less_mono2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">" <span class="free">ord</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span>card <span class="free">X</span> <span class="main">-</span> Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span>card <span class="free">X</span> <span class="main">-</span> Suc <span class="skolem">n'</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span>card <span class="free">X</span> <span class="main">-</span> Suc <span class="skolem">n''</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ord_sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="TernaryOrdering-zero_into_ordering"><span class="command">lemma</span></span>  zero_into_ordering<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ordering <span class="free">f</span> <span class="free">betw</span> <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">0</span><span class="main">)</span> <span class="main">∈</span> <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ordering_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms card_eq_0_iff gr_implies_not0 linorder_neqE_nat<span class="main">)</span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Locally ordered chains"</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Definitions for Schutz-like chains, with local order only.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ordering2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">ordering2</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">ord</span></span></span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span>finite <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">⟶</span> <span class="bound">n</span> <span class="main">&lt;</span> card <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">)</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">n</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">)</span>
                     <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span>finite <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">⟶</span> <span class="bound">n</span> <span class="main">&lt;</span> card <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">n</span> <span class="main">=</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>
                     <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">n</span> <span class="bound">n'</span> <span class="bound">n''</span><span class="main">.</span> <span class="main">(</span>finite <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">⟶</span> <span class="bound">n''</span> <span class="main">&lt;</span> card <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">)</span> <span class="main">∧</span> Suc <span class="bound">n</span> <span class="main">=</span> <span class="bound">n'</span> <span class="main">∧</span> Suc <span class="bound">n'</span> <span class="main">=</span> <span class="bound">n''</span>
                                   <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">ord</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">n'</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">n''</span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Analogue to <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ordering_ord_ijk›</span></span></span></span>, which is quicker to use in sledgehammer than the definition.›</span></span>

<span class="keyword1" id="TernaryOrdering-ordering2_ord_ijk"><span class="command">lemma</span></span> ordering2_ord_ijk<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ordering2 <span class="free">f</span> <span class="free">ord</span> <span class="free">X</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Suc <span class="free">i</span> <span class="main">=</span> <span class="free">j</span> <span class="main">∧</span> Suc <span class="free">j</span> <span class="main">=</span> <span class="free">k</span> <span class="main">∧</span> <span class="main">(</span>finite <span class="free">X</span> <span class="main">⟶</span> <span class="free">k</span> <span class="main">&lt;</span> card <span class="free">X</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">ord</span> <span class="main">(</span><span class="free">f</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="free">j</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="free">k</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ordering2_def assms<span class="main">)</span>


<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Minkowski">
<div class="head">
<h1>Theory Minkowski</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:      Schutz_Spacetime/Minkowski.thy
    Authors:    Richard Schmoetten, Jake Palmer and Jacques D. Fleuriot
                University of Edinburgh, 2021          
*)</span>
<span class="keyword1"><span class="command">theory</span></span> Minkowski
<span class="keyword2"><span class="keyword">imports</span></span> <a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL/Main.html">Main</a> <a href="#TernaryOrdering">TernaryOrdering</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">(* It is best to avoid `distinct` because it makes proof more difficult. *)</span>
<span class="comment1">(* If it has to be used, the lemma: distinct_length_2_or_more is essential. *)</span>
<span class="comment1">(* For proofs involving the cardinality of concrete, finite sets see `card_insert_if`. *)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Primitives and axioms as given in \cite[pp.~9-17]{schutz1997}.
›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  I've tried to do little to no proofs in this file, and keep that in other files.
  So, this is mostly locale and other definitions, except where it is nice to prove something
  about definitional equivalence and the like (plus the intermediate lemmas that are necessary for
  doing so).
›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Minkowski spacetime = $(\mathcal{E}, \mathcal{P}, [\dots])$
  except in the notation here I've used $[[\dots]]$ for $[\dots]$ as Isabelle uses $[\dots]$ for lists.

  Except where stated otherwise all axioms are exactly as they appear in Schutz97.
  It is the independent axiomatic system provided in the main body of the book.
  The axioms O1-O6 are the axioms of order, and largely concern properties of the betweenness
  relation.
  I1-I7 are the axioms of incidence.
  I1-I3 are similar to axioms found in systems for Euclidean geometry. As compared to Hilbert's
  Foundations (HIn), our incidence axioms (In) are loosely identifiable as
   I1 <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>→›</span></span></span></span> HI3, HI8;
   I2 <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>→›</span></span></span></span> HI1;
   I3 <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>→›</span></span></span></span> HI2.
  I4 fixes the dimension of the space.
  I5-I7 are what makes our system non-Galilean, and lead (I think)
  to Lorentz transforms (together with S?) and the ultimate speed limit.
  Axioms S and C and the axioms of symmetry and continuity, where the latter is what makes the
  system second order. Symmetry replaces all of Hilbert's axioms of congruence, when considered
  in the context of I5-I7.
›</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"MinkowskiPrimitive: I1-I3"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Events <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ℰ›</span></span></span></span>, paths <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>𝒫›</span></span></span></span>, and sprays. Sprays only need to refer to <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ℰ›</span></span></span></span> and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>𝒫›</span></span></span></span>.
  Axiom <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>in_path_event›</span></span></span></span> is covered in English by saying "a path is a set of events",
  but is necessary to have explicitly as an axiom as the types do not force it to be the case.
›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  I think part of why Schutz has I1, together with the trickery
  <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>⟦ ℰ≠{} ⟧ ⟹›</span></span></span></span> $\dots$ in I4, is that then I4 talks \emph{only} about dimension, and results such
  as <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>no_empty_paths›</span></span></span></span> can be proved using only existence of elements and unreachable sets.
  In our case, it's also a question of ordering the sequence of axiom introductions:
  dimension should really go at the end, since it is not needed for quite a while;
  but many earlier proofs rely on the set of events being non-empty.
  It may be nice to have the existence of paths as a separate axiom too, which currently
  still relies on the axiom of dimension (Schutz has no such axiom either).
›</span></span>

<span class="keyword1"><span class="command">locale</span></span> MinkowskiPrimitive <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">ℰ</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">𝒫</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> set<span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> in_path_event <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">Q</span> <span class="main">∈</span> <span class="free">𝒫</span><span class="main">;</span> <span class="free">a</span> <span class="main">∈</span> <span class="free">Q</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">∈</span> <span class="free">ℰ</span>"</span></span>
      <span class="comment1">(* I1 *)</span>
      <span class="keyword2"><span class="keyword">and</span></span> nonempty_events <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ℰ</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
      <span class="comment1">(* I2 *)</span>
      <span class="comment1">(* It's still possible to have 1 event and 0 paths. *)</span>
      <span class="keyword2"><span class="keyword">and</span></span> events_paths<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">a</span> <span class="main">∈</span> <span class="free">ℰ</span><span class="main">;</span> <span class="free">b</span> <span class="main">∈</span> <span class="free">ℰ</span><span class="main">;</span> <span class="free">a</span> <span class="main">≠</span> <span class="free">b</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">R</span><span class="main">∈</span><span class="free">𝒫</span><span class="main">.</span> <span class="main">∃</span><span class="bound">S</span><span class="main">∈</span><span class="free">𝒫</span><span class="main">.</span> <span class="free">a</span> <span class="main">∈</span> <span class="bound">R</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">∈</span> <span class="bound">S</span> <span class="main">∧</span> <span class="bound">R</span> <span class="main">∩</span> <span class="bound">S</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
      <span class="comment1">(* I3 *)</span>
      <span class="keyword2"><span class="keyword">and</span></span> eq_paths <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">P</span> <span class="main">∈</span> <span class="free">𝒫</span><span class="main">;</span> <span class="free">Q</span> <span class="main">∈</span> <span class="free">𝒫</span><span class="main">;</span> <span class="free">a</span> <span class="main">∈</span> <span class="free">P</span><span class="main">;</span> <span class="free">b</span> <span class="main">∈</span> <span class="free">P</span><span class="main">;</span> <span class="free">a</span> <span class="main">∈</span> <span class="free">Q</span><span class="main">;</span> <span class="free">b</span> <span class="main">∈</span> <span class="free">Q</span><span class="main">;</span> <span class="free">a</span> <span class="main">≠</span> <span class="free">b</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">=</span> <span class="free">Q</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This should be ensured by the additional axiom.›</span></span>

<span class="keyword1" id="Minkowski-path_sub_events"><span class="command">lemma</span></span> path_sub_events<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">∈</span> <span class="free">𝒫</span> <span class="main">⟹</span> <span class="free">Q</span> <span class="main">⊆</span> <span class="free">ℰ</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subsetI<span class="main">)</span>

<span class="keyword1" id="Minkowski-paths_sub_power"><span class="command">lemma</span></span> paths_sub_power<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">𝒫</span> <span class="main">⊆</span> Pow <span class="free">ℰ</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> path_sub_events subsetI<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  For more terse statements.
  $a \neq b$ because $a$ and $b$ are being used to identify the path, and $a = b$ would not do that.
›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">path</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">path</span> <span class="free"><span class="bound"><span class="entity">ab</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">ab</span></span></span> <span class="main">∈</span> <span class="free">𝒫</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">ab</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">ab</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">path_ex</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">path_ex</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">≡</span> <span class="main">∃</span><span class="bound">Q</span><span class="main">.</span> path <span class="bound">Q</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span>"</span></span>

<span class="keyword1" id="Minkowski-path_permute"><span class="command">lemma</span></span> path_permute<span class="main">:</span>
  <span class="quoted"><span class="quoted">"path <span class="free">ab</span> <span class="free">a</span> <span class="free">b</span> <span class="main">=</span> path <span class="free">ab</span> <span class="free">b</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">path_of</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">path_of</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">≡</span> <span class="keyword1">THE</span> <span class="bound">ab</span><span class="main">.</span> path <span class="bound">ab</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span>"</span></span>

<span class="keyword1" id="Minkowski-path_of_ex"><span class="command">lemma</span></span> path_of_ex<span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="main">(</span>path_of <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="free">a</span> <span class="free">b</span> <span class="main">⟷</span> path_ex <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> theI' <span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> path <span class="bound">x</span> <span class="free">a</span> <span class="free">b</span>"</span></span><span class="main">]</span> eq_paths <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Minkowski-path_unique"><span class="command">lemma</span></span> path_unique<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"path <span class="free">ab</span> <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"path <span class="free">ab'</span> <span class="free">a</span> <span class="free">b</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">ab</span> <span class="main">=</span> <span class="free">ab'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> eq_paths assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Primitives: Unreachable Subset (from an Event)"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Q ∈ 𝒫 ∧ b ∈ ℰ›</span></span></span></span> constraints are necessary as the types as not expressive enough to do it on
  their own. Schutz's notation is: $Q(b,\emptyset)$.
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">unreachable_subset</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> set"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">∅</span> _ _"</span> <span class="main">[</span>100<span class="main">,</span> 100<span class="main">]</span> 100<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">unreachable_subset</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">≡</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">∈</span> <span class="free">𝒫</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">∈</span> <span class="free">ℰ</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">∉</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">∧</span> <span class="main">¬</span><span class="main">(</span>path_ex <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="bound">x</span><span class="main">)</span><span class="main">}</span>"</span></span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Primitives: Kinematic Triangle"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">kinematic_triangle</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">△</span> _ _ _"</span> <span class="main">[</span>100<span class="main">,</span> 100<span class="main">,</span> 100<span class="main">]</span> 100<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">kinematic_triangle</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">≡</span>
       <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∈</span> <span class="free">ℰ</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">∈</span> <span class="free">ℰ</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">∈</span> <span class="free">ℰ</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span>
       <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">Q</span><span class="main">∈</span><span class="free">𝒫</span><span class="main">.</span> <span class="main">∃</span><span class="bound">R</span><span class="main">∈</span><span class="free">𝒫</span><span class="main">.</span> <span class="bound">Q</span> <span class="main">≠</span> <span class="bound">R</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">S</span><span class="main">∈</span><span class="free">𝒫</span><span class="main">.</span> <span class="bound">Q</span> <span class="main">≠</span> <span class="bound">S</span> <span class="main">∧</span> <span class="bound">R</span> <span class="main">≠</span> <span class="bound">S</span>
                                       <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∈</span> <span class="bound">Q</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">∈</span> <span class="bound">Q</span>
                                       <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∈</span> <span class="bound">R</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">∈</span> <span class="bound">R</span>
                                       <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">∈</span> <span class="bound">S</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">∈</span> <span class="bound">S</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹A fuller, more explicit equivalent of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>△›</span></span></span></span>, to show that the above definition is sufficient.›</span></span>
<span class="keyword1" id="Minkowski-tri_full"><span class="command">lemma</span></span> tri_full<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">△</span> <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span> <span class="main">∈</span> <span class="free">ℰ</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">∈</span> <span class="free">ℰ</span> <span class="main">∧</span> <span class="free">c</span> <span class="main">∈</span> <span class="free">ℰ</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">≠</span> <span class="free">b</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">≠</span> <span class="free">c</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">≠</span> <span class="free">c</span>
              <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">Q</span><span class="main">∈</span><span class="free">𝒫</span><span class="main">.</span> <span class="main">∃</span><span class="bound">R</span><span class="main">∈</span><span class="free">𝒫</span><span class="main">.</span> <span class="bound">Q</span> <span class="main">≠</span> <span class="bound">R</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">S</span><span class="main">∈</span><span class="free">𝒫</span><span class="main">.</span> <span class="bound">Q</span> <span class="main">≠</span> <span class="bound">S</span> <span class="main">∧</span> <span class="bound">R</span> <span class="main">≠</span> <span class="bound">S</span>
                                              <span class="main">∧</span> <span class="free">a</span> <span class="main">∈</span> <span class="bound">Q</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">∈</span> <span class="bound">Q</span> <span class="main">∧</span> <span class="free">c</span> <span class="main">∉</span> <span class="bound">Q</span>
                                              <span class="main">∧</span> <span class="free">a</span> <span class="main">∈</span> <span class="bound">R</span> <span class="main">∧</span> <span class="free">c</span> <span class="main">∈</span> <span class="bound">R</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">∉</span> <span class="bound">R</span>
                                              <span class="main">∧</span> <span class="free">b</span> <span class="main">∈</span> <span class="bound">S</span> <span class="main">∧</span> <span class="free">c</span> <span class="main">∈</span> <span class="bound">S</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">∉</span> <span class="bound">S</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> kinematic_triangle_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> path_unique<span class="main">)</span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Primitives: SPRAY"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  It's okay to not require $x \in \E$ because if $x \notin \E$ the <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>SPRAY›</span></span></span></span> will be empty anyway,
  and if it's nonempty then $x \in \E$ is derivable.›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">SPRAY</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> set<span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">SPRAY</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="main">{</span><span class="bound"><span class="bound">R</span></span><span class="main">∈</span><span class="free">𝒫</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∈</span> <span class="bound">R</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">spray</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">spray</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="main">∃</span><span class="bound">R</span><span class="main">∈</span>SPRAY <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> <span class="bound">R</span><span class="main">}</span>"</span></span>

<span class="comment1">(* Just for convenience. *)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_SPRAY</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> set<span class="main">)</span> set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">is_SPRAY</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">≡</span> <span class="main">∃</span><span class="bound">x</span><span class="main">∈</span><span class="free">ℰ</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">=</span> SPRAY <span class="bound">x</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_spray</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">is_spray</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">≡</span> <span class="main">∃</span><span class="bound">x</span><span class="main">∈</span><span class="free">ℰ</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">=</span> spray <span class="bound">x</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Some very simple SPRAY and spray lemmas below.›</span></span>

<span class="keyword1" id="Minkowski-SPRAY_event"><span class="command">lemma</span></span> SPRAY_event<span class="main">:</span>
  <span class="quoted"><span class="quoted">"SPRAY <span class="free">x</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">ℰ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> SPRAY_def<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> nonempty_SPRAY<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">R</span></span> <span class="main">∈</span> <span class="free">𝒫</span><span class="main">.</span> <span class="free">x</span> <span class="main">∈</span> <span class="bound">R</span><span class="main">}</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> x_in_path_R<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">R</span> <span class="main">∈</span> <span class="free">𝒫</span><span class="main">.</span> <span class="free">x</span> <span class="main">∈</span> <span class="bound">R</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">ℰ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> in_path_event <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Minkowski-SPRAY_nonevent"><span class="command">lemma</span></span> SPRAY_nonevent<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> <span class="free">ℰ</span> <span class="main">⟹</span> SPRAY <span class="free">x</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> SPRAY_event <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Minkowski-SPRAY_path"><span class="command">lemma</span></span> SPRAY_path<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">∈</span> SPRAY <span class="free">x</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">∈</span> <span class="free">𝒫</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SPRAY_def<span class="main">)</span>

<span class="keyword1" id="Minkowski-in_SPRAY_path"><span class="command">lemma</span></span> in_SPRAY_path<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">∈</span> SPRAY <span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SPRAY_def<span class="main">)</span>

<span class="keyword1" id="Minkowski-source_in_SPRAY"><span class="command">lemma</span></span> source_in_SPRAY<span class="main">:</span>
  <span class="quoted"><span class="quoted">"SPRAY <span class="free">x</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">P</span> <span class="main">∈</span> SPRAY <span class="free">x</span><span class="main">.</span> <span class="free">x</span> <span class="main">∈</span> <span class="bound">P</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> in_SPRAY_path <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Minkowski-spray_event"><span class="command">lemma</span></span> spray_event<span class="main">:</span>
  <span class="quoted"><span class="quoted">"spray <span class="free">x</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">ℰ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> spray_def<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="main">∃</span><span class="bound">R</span> <span class="main">∈</span> SPRAY <span class="free">x</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> <span class="bound">R</span><span class="main">}</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">y</span><span class="main">.</span> <span class="main">∃</span><span class="bound">R</span> <span class="main">∈</span> SPRAY <span class="free">x</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> <span class="bound">R</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"SPRAY <span class="free">x</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">ℰ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> SPRAY_event <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Minkowski-spray_nonevent"><span class="command">lemma</span></span> spray_nonevent<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> <span class="free">ℰ</span> <span class="main">⟹</span> spray <span class="free">x</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> spray_event <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Minkowski-in_spray_event"><span class="command">lemma</span></span> in_spray_event<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> spray <span class="free">x</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">ℰ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> spray_def<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="main">∃</span><span class="bound">R</span><span class="main">∈</span>SPRAY <span class="free">x</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> <span class="bound">R</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">R</span><span class="main">∈</span>SPRAY <span class="free">x</span><span class="main">.</span> <span class="free">y</span> <span class="main">∈</span> <span class="bound">R</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> CollectD<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">R</span></span> <span class="keyword2"><span class="keyword">where</span></span> path_R<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="main">∈</span> <span class="free">𝒫</span>"</span></span>
                  <span class="keyword2"><span class="keyword">and</span></span> y_inR<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="skolem">R</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> SPRAY_path <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">ℰ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> in_path_event <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Minkowski-source_in_spray"><span class="command">lemma</span></span> source_in_spray<span class="main">:</span>
  <span class="quoted"><span class="quoted">"spray <span class="free">x</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> spray <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> nonempty_spray<span class="main">:</span> <span class="quoted"><span class="quoted">"spray <span class="free">x</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> spray_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"spray <span class="free">x</span> <span class="main">=</span> <span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="main">∃</span><span class="bound">R</span><span class="main">∈</span>SPRAY <span class="free">x</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> <span class="bound">R</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> spray_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ex_in_SPRAY_path<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">y</span><span class="main">.</span> <span class="main">∃</span><span class="bound">R</span><span class="main">∈</span>SPRAY <span class="free">x</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> <span class="bound">R</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> nonempty_spray <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> spray <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ex_in_SPRAY_path spray_eq source_in_SPRAY <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Primitives: Path (In)dependence"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  "A subset of three paths of a SPRAY is dependent if there is a path which does not belong
  to the SPRAY and which contains one event from each of the three paths: we also say any
  one of the three paths is dependent on the other two.
  Otherwise the subset is independent." [Schutz97]
›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The definition of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>SPRAY›</span></span></span></span> constrains $x, Q, R, S$ to be in $\E$ and $\P$.›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">dep3_event</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">dep3_event</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">∈</span> SPRAY <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="main">∈</span> SPRAY <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">∈</span> SPRAY <span class="free"><span class="bound"><span class="entity">x</span></span></span>
                         <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">T</span><span class="main">∈</span><span class="free">𝒫</span><span class="main">.</span> <span class="bound">T</span> <span class="main">∉</span> SPRAY <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">y</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> <span class="bound">T</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">y</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">R</span></span></span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> <span class="bound">T</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">y</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> <span class="bound">T</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">dep3_spray</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> set<span class="main">)</span> set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">dep3_spray</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">SPR</span></span></span> <span class="main">≡</span> <span class="main">∃</span><span class="bound">x</span><span class="main">.</span> SPRAY <span class="bound">x</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">SPR</span></span></span> <span class="main">∧</span> dep3_event <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="bound">x</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">dep3</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">dep3</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">≡</span> <span class="main">∃</span><span class="bound">x</span><span class="main">.</span> dep3_event <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="bound">x</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Some very simple lemmas related to <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>dep3_event›</span></span></span></span>.›</span></span>

<span class="comment1">(* Nice to have this on its own. *)</span>
<span class="keyword1" id="Minkowski-dep3_nonspray"><span class="command">lemma</span></span> dep3_nonspray<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dep3_event <span class="free">Q</span> <span class="free">R</span> <span class="free">S</span> <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">P</span><span class="main">∈</span><span class="free">𝒫</span><span class="main">.</span> <span class="bound">P</span> <span class="main">∉</span> SPRAY <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms dep3_event_def<span class="main">)</span>

<span class="keyword1" id="Minkowski-dep3_path"><span class="command">lemma</span></span> dep3_path<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> dep3_QRSx<span class="main">:</span> <span class="quoted"><span class="quoted">"dep3_event <span class="free">Q</span> <span class="free">R</span> <span class="free">S</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">∈</span> <span class="free">𝒫</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">∈</span> <span class="free">𝒫</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∈</span> <span class="free">𝒫</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">Q</span><span class="main">,</span><span class="free">R</span><span class="main">,</span><span class="free">S</span><span class="main">}</span> <span class="main">⊆</span> SPRAY <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> dep3_event_def <span class="keyword1"><span class="command">using</span></span> dep3_QRSx <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">∈</span> <span class="free">𝒫</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">∈</span> <span class="free">𝒫</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∈</span> <span class="free">𝒫</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> SPRAY_path <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Minkowski-dep3_is_event"><span class="command">lemma</span></span> dep3_is_event<span class="main">:</span>
  <span class="quoted"><span class="quoted">"dep3_event <span class="free">Q</span> <span class="free">R</span> <span class="free">S</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">ℰ</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> SPRAY_event dep3_event_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Minkowski-dep3_event_permute"><span class="command">lemma</span></span> dep3_event_permute <span class="main">[</span><span class="operator">no_atp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dep3_event <span class="free">Q</span> <span class="free">R</span> <span class="free">S</span> <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"dep3_event <span class="free">Q</span> <span class="free">S</span> <span class="free">R</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"dep3_event <span class="free">R</span> <span class="free">Q</span> <span class="free">S</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"dep3_event <span class="free">R</span> <span class="free">S</span> <span class="free">Q</span> <span class="free">x</span>"</span></span>
     <span class="quoted"><span class="quoted">"dep3_event <span class="free">S</span> <span class="free">Q</span> <span class="free">R</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"dep3_event <span class="free">S</span> <span class="free">R</span> <span class="free">Q</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> dep3_event_def assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  "We next give recursive definitions of dependence and independence which will be used to
  characterize the concept of dimension. A path $T$ is dependent on the set of $n$ paths (where $n\geq3$)

  $$S = \left\lbrace Q_i \colon i = 1, 2, ..., n; Q_i \in \spray x\right\rbrace$$

  if it is dependent on two paths $S_1$ and $S_2$, where each of these two paths is dependent
  on some subset of $n - 1$ paths from the set $S$." [Schutz97]›</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">dep_path</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> set<span class="main">)</span> set <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  dep_two<span class="main">:</span> <span class="quoted"><span class="quoted">"dep3_event <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⟹</span> <span class="free">dep_path</span> <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">}</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="main">|</span> dep_n<span class="main">:</span>   <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">⊆</span> SPRAY <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">;</span> card <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">≥</span> <span class="numeral">3</span><span class="main">;</span> <span class="free">dep_path</span> <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">S1</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">S2</span></span></span><span class="main">}</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">;</span>
             <span class="free"><span class="bound"><span class="entity">S'</span></span></span> <span class="main">⊆</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">S''</span></span></span> <span class="main">⊆</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">;</span> card <span class="free"><span class="bound"><span class="entity">S'</span></span></span> <span class="main">=</span> card <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">-</span> <span class="main">1</span><span class="main">;</span> card <span class="free"><span class="bound"><span class="entity">S''</span></span></span> <span class="main">=</span> card <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">-</span> <span class="main">1</span><span class="main">;</span>
             <span class="free">dep_path</span> <span class="free"><span class="bound"><span class="entity">S1</span></span></span> <span class="free"><span class="bound"><span class="entity">S'</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">;</span> <span class="free">dep_path</span> <span class="free"><span class="bound"><span class="entity">S2</span></span></span> <span class="free"><span class="bound"><span class="entity">S''</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">dep_path</span> <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  "We also say that the set of $n + 1$ paths $S\cup\{T\}$ is a dependent set." [Schutz97]
  Starting from this constructive definition, the below gives an analytical one.
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">dep_set</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> set<span class="main">)</span> set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">dep_set</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">≡</span> <span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="main">∃</span><span class="bound"><span class="bound">S'</span></span><span class="main">⊆</span><span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">.</span> <span class="main">∃</span><span class="bound">P</span><span class="main">∈</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">-</span><span class="bound">S'</span><span class="main">)</span><span class="main">.</span> dep_path <span class="bound">P</span> <span class="bound">S'</span> <span class="bound">x</span>"</span></span>

<span class="keyword1" id="Minkowski-dependent_superset"><span class="command">lemma</span></span> dependent_superset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dep_set <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">⊆</span><span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"dep_set <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> dep_set_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Diff_mono dual_order.trans in_mono order_refl<span class="main">)</span>

<span class="keyword1" id="Minkowski-path_in_dep_set"><span class="command">lemma</span></span> path_in_dep_set<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dep3_event <span class="free">P</span> <span class="free">Q</span> <span class="free">R</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"dep_set <span class="main">{</span><span class="free">P</span><span class="main">,</span><span class="free">Q</span><span class="main">,</span><span class="free">R</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> dep_two assms dep3_event_def dep_set_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> DiffI insertE insertI1 singletonD subset_insertI<span class="main">)</span>

<span class="keyword1" id="Minkowski-path_in_dep_set2"><span class="command">lemma</span></span> path_in_dep_set2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dep3_event <span class="free">P</span> <span class="free">Q</span> <span class="free">R</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"dep_path <span class="free">P</span> <span class="main">{</span><span class="free">P</span><span class="main">,</span><span class="free">Q</span><span class="main">,</span><span class="free">R</span><span class="main">}</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">R</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">P</span><span class="main">,</span><span class="free">R</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S''</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">P</span><span class="main">,</span><span class="free">Q</span><span class="main">}</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">P</span><span class="main">,</span> <span class="free">Q</span><span class="main">,</span> <span class="free">R</span><span class="main">}</span> <span class="main">⊆</span> SPRAY <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms dep3_event_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span> <span class="main">≤</span> card <span class="main">{</span><span class="free">P</span><span class="main">,</span> <span class="free">Q</span><span class="main">,</span> <span class="free">R</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms dep3_event_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dep_path <span class="free">P</span> <span class="main">{</span><span class="var">?S1</span><span class="main">,</span> <span class="var">?S2</span><span class="main">}</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms dep3_event_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dep_two<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?S'</span> <span class="main">⊆</span> <span class="main">{</span><span class="free">P</span><span class="main">,</span> <span class="free">Q</span><span class="main">,</span> <span class="free">R</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?S''</span> <span class="main">⊆</span> <span class="main">{</span><span class="free">P</span><span class="main">,</span> <span class="free">Q</span><span class="main">,</span> <span class="free">R</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"card <span class="var">?S'</span> <span class="main">=</span> card <span class="main">{</span><span class="free">P</span><span class="main">,</span> <span class="free">Q</span><span class="main">,</span> <span class="free">R</span><span class="main">}</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms dep3_event_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"card <span class="var">?S''</span> <span class="main">=</span> card <span class="main">{</span><span class="free">P</span><span class="main">,</span> <span class="free">Q</span><span class="main">,</span> <span class="free">R</span><span class="main">}</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms dep3_event_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dep_path <span class="var">?S1</span> <span class="var">?S'</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms dep3_event_permute<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> dep_two<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dep_path <span class="var">?S2</span> <span class="var">?S''</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms dep3_event_permute<span class="main">(</span>2<span class="main">,</span>4<span class="main">)</span> dep_two <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">indep_set</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> set<span class="main">)</span> set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">indep_set</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">≡</span> <span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">T</span></span> <span class="main">⊆</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">.</span> dep_set <span class="bound">T</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Primitives: 3-SPRAY"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  "We now make the following definition which enables us to specify the dimensions of Minkowski
  space-time. A SPRAY is a 3-SPRAY if:
    i) it contains four independent paths, and
   ii) all paths of the SPRAY are dependent on these four paths." [Schutz97]
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">three_SPRAY</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">three_SPRAY</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="main">∃</span><span class="bound">S1</span><span class="main">∈</span><span class="free">𝒫</span><span class="main">.</span> <span class="main">∃</span><span class="bound">S2</span><span class="main">∈</span><span class="free">𝒫</span><span class="main">.</span> <span class="main">∃</span><span class="bound">S3</span><span class="main">∈</span><span class="free">𝒫</span><span class="main">.</span> <span class="main">∃</span><span class="bound">S4</span><span class="main">∈</span><span class="free">𝒫</span><span class="main">.</span>
    <span class="bound">S1</span> <span class="main">≠</span> <span class="bound">S2</span> <span class="main">∧</span> <span class="bound">S1</span> <span class="main">≠</span> <span class="bound">S3</span> <span class="main">∧</span> <span class="bound">S1</span> <span class="main">≠</span> <span class="bound">S4</span> <span class="main">∧</span> <span class="bound">S2</span> <span class="main">≠</span> <span class="bound">S3</span> <span class="main">∧</span> <span class="bound">S2</span> <span class="main">≠</span> <span class="bound">S4</span> <span class="main">∧</span> <span class="bound">S3</span> <span class="main">≠</span> <span class="bound">S4</span>
    <span class="main">∧</span> <span class="bound">S1</span> <span class="main">∈</span> SPRAY <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span> <span class="bound">S2</span> <span class="main">∈</span> SPRAY <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span> <span class="bound">S3</span> <span class="main">∈</span> SPRAY <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span> <span class="bound">S4</span> <span class="main">∈</span> SPRAY <span class="free"><span class="bound"><span class="entity">x</span></span></span>
    <span class="main">∧</span> <span class="main">(</span>indep_set <span class="main">{</span><span class="bound">S1</span><span class="main">,</span> <span class="bound">S2</span><span class="main">,</span> <span class="bound">S3</span><span class="main">,</span> <span class="bound">S4</span><span class="main">}</span><span class="main">)</span>
    <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">S</span><span class="main">∈</span>SPRAY <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">.</span> dep_path <span class="bound">S</span> <span class="main">{</span><span class="bound">S1</span><span class="main">,</span><span class="bound">S2</span><span class="main">,</span><span class="bound">S3</span><span class="main">,</span><span class="bound">S4</span><span class="main">}</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Lemma <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>is_three_SPRAY›</span></span></span></span> says "this set of sets of elements is a set of paths which is a 3-$\spray$".
  Lemma <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>three_SPRAY_ge4›</span></span></span></span> just extracts a bit of the definition.
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_three_SPRAY</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> set<span class="main">)</span> set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">is_three_SPRAY</span> <span class="free"><span class="bound"><span class="entity">SPR</span></span></span> <span class="main">≡</span> <span class="main">∃</span> <span class="bound">x</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">SPR</span></span></span> <span class="main">=</span> SPRAY <span class="bound">x</span> <span class="main">∧</span> three_SPRAY <span class="bound">x</span>"</span></span>

<span class="keyword1" id="Minkowski-three_SPRAY_ge4"><span class="command">lemma</span></span> three_SPRAY_ge4<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"three_SPRAY <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">Q1</span><span class="main">∈</span><span class="free">𝒫</span><span class="main">.</span> <span class="main">∃</span><span class="bound">Q2</span><span class="main">∈</span><span class="free">𝒫</span><span class="main">.</span> <span class="main">∃</span><span class="bound">Q3</span><span class="main">∈</span><span class="free">𝒫</span><span class="main">.</span> <span class="main">∃</span><span class="bound">Q4</span><span class="main">∈</span><span class="free">𝒫</span><span class="main">.</span> <span class="bound">Q1</span> <span class="main">≠</span> <span class="bound">Q2</span> <span class="main">∧</span> <span class="bound">Q1</span> <span class="main">≠</span> <span class="bound">Q3</span> <span class="main">∧</span> <span class="bound">Q1</span> <span class="main">≠</span> <span class="bound">Q4</span> <span class="main">∧</span> <span class="bound">Q2</span> <span class="main">≠</span> <span class="bound">Q3</span> <span class="main">∧</span> <span class="bound">Q2</span> <span class="main">≠</span> <span class="bound">Q4</span> <span class="main">∧</span> <span class="bound">Q3</span> <span class="main">≠</span> <span class="bound">Q4</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms three_SPRAY_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* MinkowskiPrimitive *)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"MinkowskiBetweenness: O1-O5"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  In O4, I have removed the requirement that $a \neq d$ in order to prove negative
  betweenness statements as Schutz does. For example, if we have $[abc]$
  and $[bca]$ we want to conclude $[aba]$ and claim "contradiction!", but
  we can't as long as we mandate that $a \neq d$.
›</span></span>

<span class="keyword1"><span class="command">locale</span></span> MinkowskiBetweenness <span class="main">=</span> MinkowskiPrimitive <span class="main">+</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">betw</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1">[[</span></span>_ _ _<span class="keyword1"><span class="keyword1">]]</span></span>"</span><span class="main">)</span>
      <span class="comment1">(* O1 *)</span> <span class="comment1">(*notice this is not only for events, but all things with same data type*)</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> abc_ex_path<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">Q</span><span class="main">∈</span><span class="free">𝒫</span><span class="main">.</span> <span class="free">a</span> <span class="main">∈</span> <span class="bound">Q</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">∈</span> <span class="bound">Q</span> <span class="main">∧</span> <span class="free">c</span> <span class="main">∈</span> <span class="bound">Q</span>"</span></span>
      <span class="comment1">(* O2 *)</span>
      <span class="keyword2"><span class="keyword">and</span></span> abc_sym<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span> <span class="main">⟹</span> <span class="main"><span class="free">[[</span></span><span class="free">c</span> <span class="free">b</span> <span class="free">a</span><span class="main"><span class="free">]]</span></span>"</span></span>
      <span class="comment1">(* O3, relaxed, as O3 can be proven from this. *)</span>
      <span class="keyword2"><span class="keyword">and</span></span> abc_ac_neq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">≠</span> <span class="free">c</span>"</span></span>
      <span class="comment1">(* O4 *)</span>
      <span class="keyword2"><span class="keyword">and</span></span> abc_bcd_abd <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span><span class="main">;</span> <span class="main"><span class="free">[[</span></span><span class="free">b</span> <span class="free">c</span> <span class="free">d</span><span class="main"><span class="free">]]</span></span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="free">d</span><span class="main"><span class="free">]]</span></span>"</span></span>
      <span class="comment1">(* O5, relaxed; exhausting all six options is not necessary thanks to abc_sym. *)</span>
      <span class="keyword2"><span class="keyword">and</span></span> some_betw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">Q</span> <span class="main">∈</span> <span class="free">𝒫</span><span class="main">;</span> <span class="free">a</span> <span class="main">∈</span> <span class="free">Q</span><span class="main">;</span> <span class="free">b</span> <span class="main">∈</span> <span class="free">Q</span><span class="main">;</span> <span class="free">c</span> <span class="main">∈</span> <span class="free">Q</span><span class="main">;</span> <span class="free">a</span> <span class="main">≠</span> <span class="free">b</span><span class="main">;</span> <span class="free">a</span> <span class="main">≠</span> <span class="free">c</span><span class="main">;</span> <span class="free">b</span> <span class="main">≠</span> <span class="free">c</span><span class="main">⟧</span>
               <span class="main">⟹</span> <span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">b</span> <span class="free">c</span> <span class="free">a</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">c</span> <span class="free">a</span> <span class="free">b</span><span class="main"><span class="free">]]</span></span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The next few lemmas either provide the full axiom from the text derived from a new simpler
  statement, or provide some very simple fundamental additions which make sense to prove
  immediately before starting, usually related to set-level things that should be true which
  fix the type-level ambiguity of 'a.
›</span></span>

<span class="keyword1" id="Minkowski-betw_events"><span class="command">lemma</span></span> betw_events<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> abc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">ℰ</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">∈</span> <span class="free">ℰ</span> <span class="main">∧</span> <span class="free">c</span> <span class="main">∈</span> <span class="free">ℰ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">Q</span><span class="main">∈</span><span class="free">𝒫</span><span class="main">.</span> <span class="free">a</span> <span class="main">∈</span> <span class="bound">Q</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">∈</span> <span class="bound">Q</span> <span class="main">∧</span> <span class="free">c</span> <span class="main">∈</span> <span class="bound">Q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> abc_ex_path abc <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> in_path_event <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This shows the shorter version of O5 is equivalent.›</span></span>

<span class="keyword1" id="Minkowski-O5_still_O5"><span class="command">lemma</span></span> O5_still_O5 <span class="main">[</span><span class="operator">no_atp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">Q</span> <span class="main">∈</span> <span class="free">𝒫</span> <span class="main">∧</span> <span class="main">{</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">,</span><span class="free">c</span><span class="main">}</span> <span class="main">⊆</span> <span class="free">Q</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">∈</span> <span class="free">ℰ</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">∈</span> <span class="free">ℰ</span> <span class="main">∧</span> <span class="free">c</span> <span class="main">∈</span> <span class="free">ℰ</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">≠</span> <span class="free">b</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">≠</span> <span class="free">c</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">≠</span> <span class="free">c</span><span class="main">)</span>
     <span class="main">⟶</span> <span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">b</span> <span class="free">c</span> <span class="free">a</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">c</span> <span class="free">a</span> <span class="free">b</span><span class="main"><span class="free">]]</span></span><span class="main">)</span>
   <span class="main">=</span>
   <span class="main">(</span><span class="main">(</span><span class="free">Q</span> <span class="main">∈</span> <span class="free">𝒫</span> <span class="main">∧</span> <span class="main">{</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">,</span><span class="free">c</span><span class="main">}</span> <span class="main">⊆</span> <span class="free">Q</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">∈</span> <span class="free">ℰ</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">∈</span> <span class="free">ℰ</span> <span class="main">∧</span> <span class="free">c</span> <span class="main">∈</span> <span class="free">ℰ</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">≠</span> <span class="free">b</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">≠</span> <span class="free">c</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">≠</span> <span class="free">c</span><span class="main">)</span>
     <span class="main">⟶</span> <span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">b</span> <span class="free">c</span> <span class="free">a</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">c</span> <span class="free">a</span> <span class="free">b</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">c</span> <span class="free">b</span> <span class="free">a</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">c</span> <span class="free">b</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">b</span> <span class="free">a</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abc_sym<span class="main">)</span>

<span class="keyword1" id="Minkowski-some_betw_xor"><span class="command">lemma</span></span> some_betw_xor<span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">Q</span> <span class="main">∈</span> <span class="free">𝒫</span><span class="main">;</span> <span class="free">a</span> <span class="main">∈</span> <span class="free">Q</span><span class="main">;</span> <span class="free">b</span> <span class="main">∈</span> <span class="free">Q</span><span class="main">;</span> <span class="free">c</span> <span class="main">∈</span> <span class="free">Q</span><span class="main">;</span> <span class="free">a</span> <span class="main">≠</span> <span class="free">b</span><span class="main">;</span> <span class="free">a</span> <span class="main">≠</span> <span class="free">c</span><span class="main">;</span> <span class="free">b</span> <span class="main">≠</span> <span class="free">c</span><span class="main">⟧</span>
               <span class="main">⟹</span> <span class="main">(</span><span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="main">¬</span> <span class="main"><span class="free">[[</span></span><span class="free">b</span> <span class="free">c</span> <span class="free">a</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="main">¬</span> <span class="main"><span class="free">[[</span></span><span class="free">c</span> <span class="free">a</span> <span class="free">b</span><span class="main"><span class="free">]]</span></span><span class="main">)</span>
                 <span class="main">∨</span> <span class="main">(</span><span class="main"><span class="free">[[</span></span><span class="free">b</span> <span class="free">c</span> <span class="free">a</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="main">¬</span> <span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="main">¬</span> <span class="main"><span class="free">[[</span></span><span class="free">c</span> <span class="free">a</span> <span class="free">b</span><span class="main"><span class="free">]]</span></span><span class="main">)</span>
                 <span class="main">∨</span> <span class="main">(</span><span class="main"><span class="free">[[</span></span><span class="free">c</span> <span class="free">a</span> <span class="free">b</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="main">¬</span> <span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="main">¬</span> <span class="main"><span class="free">[[</span></span><span class="free">b</span> <span class="free">c</span> <span class="free">a</span><span class="main"><span class="free">]]</span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> abc_ac_neq abc_bcd_abd some_betw<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The lemma <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>abc_abc_neq›</span></span></span></span> is the full O3 as stated by Schutz.›</span></span>
<span class="keyword1" id="Minkowski-abc_abc_neq"><span class="command">lemma</span></span> abc_abc_neq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> abc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">≠</span> <span class="free">c</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">≠</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> abc_sym abc_ac_neq assms abc_bcd_abd <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


<span class="keyword1" id="Minkowski-abc_bcd_acd"><span class="command">lemma</span></span> abc_bcd_acd<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> abc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> bcd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">b</span> <span class="free">c</span> <span class="free">d</span><span class="main"><span class="free">]]</span></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">c</span> <span class="free">d</span><span class="main"><span class="free">]]</span></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> cba<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">c</span> <span class="free">b</span> <span class="free">a</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> abc_sym abc <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> dcb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">d</span> <span class="free">c</span> <span class="free">b</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> abc_sym bcd <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">d</span> <span class="free">c</span> <span class="free">a</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> abc_bcd_abd dcb cba <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> abc_sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Minkowski-abc_only_cba"><span class="command">lemma</span></span> abc_only_cba<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main"><span class="free">[[</span></span><span class="free">b</span> <span class="free">a</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">c</span> <span class="free">b</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main"><span class="free">[[</span></span><span class="free">b</span> <span class="free">c</span> <span class="free">a</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main"><span class="free">[[</span></span><span class="free">c</span> <span class="free">a</span> <span class="free">b</span><span class="main"><span class="free">]]</span></span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> abc_sym abc_abc_neq abc_bcd_abd assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Betweenness: Unreachable Subset Via a Path"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">unreachable_subset_via</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> set"</span></span>
                                     <span class="main">(</span><span class="quoted">"<span class="keyword1">∅</span> _ <span class="keyword1">from</span> _ <span class="keyword1">via</span> _ <span class="keyword1">at</span> _"</span> <span class="main">[</span>100<span class="main">,</span> 100<span class="main">,</span> 100<span class="main">,</span> 100<span class="main">]</span> 100<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">unreachable_subset_via</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="free"><span class="bound"><span class="entity">Qa</span></span></span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="main">{</span><span class="bound">Qy</span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="bound">Qy</span> <span class="free"><span class="bound"><span class="entity">Qa</span></span></span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">Rw</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">R</span></span></span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">Qa</span></span></span> <span class="main">∈</span> <span class="main">∅</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="bound">Rw</span> <span class="main">∧</span> <span class="bound">Qy</span> <span class="main">∈</span> <span class="main">∅</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="bound">Rw</span><span class="main">)</span><span class="main">}</span>"</span></span>



<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Betweenness: Chains"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Totally ordered chains with indexing"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">short_ch</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">short_ch</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">≡</span>
    <span class="comment1">―‹EITHER two distinct events connected by a path›</span>
    <span class="main">∃</span><span class="bound">x</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">.</span> <span class="main">∃</span><span class="bound">y</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">.</span> path_ex <span class="bound">x</span> <span class="bound">y</span> <span class="main">∧</span> <span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">z</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">.</span> <span class="bound">z</span><span class="main">≠</span><span class="bound">x</span> <span class="main">∧</span> <span class="bound">z</span><span class="main">≠</span><span class="bound">y</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Infinite sets have card 0, because card gives a natural number always.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">long_ch_by_ord</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">long_ch_by_ord</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">≡</span>
    <span class="comment1">―‹OR at least three events such that any three events are ordered›</span>
    <span class="main">∃</span><span class="bound">x</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">.</span> <span class="main">∃</span><span class="bound">y</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">.</span> <span class="main">∃</span><span class="bound">z</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">.</span> <span class="bound">x</span><span class="main">≠</span><span class="bound">y</span> <span class="main">∧</span> <span class="bound">y</span><span class="main">≠</span><span class="bound">z</span> <span class="main">∧</span> <span class="bound">x</span><span class="main">≠</span><span class="bound">z</span> <span class="main">∧</span> ordering <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free">betw</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Does this restrict chains to lie on paths? Proven in Ch3's Interlude!›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ch_by_ord</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">ch_by_ord</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">≡</span> short_ch <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">∨</span> long_ch_by_ord <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">X</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ch</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">ch</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">≡</span> <span class="main">∃</span><span class="bound">f</span><span class="main">.</span> ch_by_ord <span class="bound">f</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Since $f(0)$ is always in the chain, and plays a special role particularly for infinite chains
  (as the 'endpoint', the non-finite edge) let us fix it straight in the definition.
  Notice we require both <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>infinite X›</span></span></span></span> and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>long_ch_by_ord›</span></span></span></span>, thus circumventing infinite
  Isabelle sets having cardinality $0$.
›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">semifin_chain</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">[</span>_<span class="keyword1">[</span>_ <span class="keyword1">..]</span>_<span class="keyword1">]</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">semifin_chain</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">≡</span>
    infinite <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">∧</span> long_ch_by_ord <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span>
    <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">0</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">fin_long_chain</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> bool"</span></span>
  <span class="main">(</span><span class="quoted">"<span class="keyword1">[</span>_<span class="keyword1">[</span>_ <span class="keyword1">..</span> _ <span class="keyword1">..</span>  _<span class="keyword1">]</span>_<span class="keyword1">]</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">fin_long_chain</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">≡</span>
    <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">≠</span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">≠</span><span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">≠</span><span class="free"><span class="bound"><span class="entity">z</span></span></span>
    <span class="main">∧</span> finite <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">∧</span> long_ch_by_ord <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span>
    <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">0</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span>card <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span>"</span></span>

<span class="keyword1" id="Minkowski-index_middle_element"><span class="command">lemma</span></span> index_middle_element<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">f</span><span class="main">[</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">..</span><span class="free">c</span><span class="main">]</span><span class="free">X</span><span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="main">0</span><span class="main">&lt;</span><span class="bound">n</span> <span class="main">∧</span> <span class="bound">n</span><span class="main">&lt;</span><span class="main">(</span>card <span class="free">X</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">∧</span> <span class="free">f</span> <span class="bound">n</span> <span class="main">=</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> n_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> card <span class="free">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">n</span> <span class="main">=</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> TernaryOrdering.ordering_def assms fin_long_chain_def long_ch_by_ord_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">&lt;</span><span class="skolem">n</span> <span class="main">∧</span> <span class="skolem">n</span><span class="main">&lt;</span><span class="main">(</span>card <span class="free">X</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">∧</span> <span class="free">f</span> <span class="skolem">n</span> <span class="main">=</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms fin_long_chain_def n_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_pred' gr_implies_not0 less_SucE not_gr_zero<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Minkowski-fin_ch_betw"><span class="command">lemma</span></span> fin_ch_betw<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">f</span><span class="main">[</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">..</span><span class="free">c</span><span class="main">]</span><span class="free">X</span><span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">nb</span></span> <span class="keyword2"><span class="keyword">where</span></span> n_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">nb</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">nb</span><span class="main">&lt;</span>card <span class="free">X</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">nb</span> <span class="main">=</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms index_middle_element <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">nb</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span>card <span class="free">X</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> fin_long_chain_def long_ch_by_ord_def assms n_def ordering_ord_ijk zero_less_iff_neq_zero
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms fin_long_chain_def n_def<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Minkowski-chain_sym_obtain"><span class="command">lemma</span></span> chain_sym_obtain<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">f</span><span class="main">[</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">..</span><span class="free">c</span><span class="main">]</span><span class="free">X</span><span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">g</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">g</span><span class="main">[</span><span class="free">c</span><span class="main">..</span><span class="free">b</span><span class="main">..</span><span class="free">a</span><span class="main">]</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span>card <span class="free">X</span> <span class="main">-</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> ordering_sym assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> fin_long_chain_def long_ch_by_ord_def
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> abc_sym diff_self_eq_0 diff_zero<span class="main">)</span>

<span class="keyword1" id="Minkowski-chain_sym"><span class="command">lemma</span></span> chain_sym<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">f</span><span class="main">[</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">..</span><span class="free">c</span><span class="main">]</span><span class="free">X</span><span class="main">]</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span>card <span class="free">X</span> <span class="main">-</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">n</span><span class="main">)</span><span class="main">[</span><span class="free">c</span><span class="main">..</span><span class="free">b</span><span class="main">..</span><span class="free">a</span><span class="main">]</span><span class="free">X</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> chain_sym_obtain <span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">f</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">a</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">b</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> c<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">c</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> X<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">X</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">fin_long_chain_2</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">fin_long_chain_2</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">≡</span> <span class="main">∃</span><span class="bound">f</span><span class="main">.</span> <span class="main">[</span><span class="bound">f</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">..</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">..</span><span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">]</span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">fin_chain</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">[</span>_<span class="keyword1">[</span>_ <span class="keyword1">..</span> _<span class="keyword1">]</span>_<span class="keyword1">]</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">fin_chain</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">≡</span>
    <span class="main">(</span>short_ch <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">≠</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>
    <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">z</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">.</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">..</span><span class="bound">z</span><span class="main">..</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">]</span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">]</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Minkowski-points_in_chain"><span class="command">lemma</span></span> points_in_chain<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">f</span><span class="main">[</span><span class="free">x</span><span class="main">..</span><span class="free">y</span><span class="main">..</span><span class="free">z</span><span class="main">]</span><span class="free">Q</span><span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">∈</span><span class="free">Q</span> <span class="main">∧</span> <span class="free">y</span><span class="main">∈</span><span class="free">Q</span> <span class="main">∧</span> <span class="free">z</span><span class="main">∈</span><span class="free">Q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">∈</span><span class="free">Q</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ordering_def assms card_gt_0_iff emptyE fin_long_chain_def long_ch_by_ord_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main">∈</span><span class="free">Q</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms fin_long_chain_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span><span class="main">∈</span><span class="free">Q</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ordering_def assms card_gt_0_iff emptyE fin_long_chain_def long_ch_by_ord_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> Suc_diff_1 lessI<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Minkowski-ch_long_if_card_ge3"><span class="command">lemma</span></span> ch_long_if_card_ge3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ch <span class="free">X</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"card <span class="free">X</span> <span class="main">≥</span> <span class="numeral">3</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">f</span><span class="main">.</span> long_ch_by_ord <span class="bound">f</span> <span class="free">X</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∄</span><span class="bound">f</span><span class="main">.</span> long_ch_by_ord <span class="bound">f</span> <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"short_ch <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> ch_by_ord_def ch_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="free">X</span> <span class="main">∧</span> <span class="skolem">y</span><span class="main">∈</span><span class="free">X</span> <span class="main">∧</span> <span class="skolem">z</span><span class="main">∈</span><span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">≠</span><span class="skolem">y</span> <span class="main">∧</span> <span class="skolem">y</span><span class="main">≠</span><span class="skolem">z</span> <span class="main">∧</span> <span class="skolem">x</span><span class="main">≠</span><span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_le_Suc_iff numeral_3_eq_3<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹short_ch <span class="free">X</span>›</span></span> short_ch_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Locally ordered chains with indexing"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Definition for Schutz-like chains, with local order only.›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">long_ch_by_ord2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">long_ch_by_ord2</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">≡</span>
    <span class="main">∃</span><span class="bound">x</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">.</span> <span class="main">∃</span><span class="bound">y</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">.</span> <span class="main">∃</span><span class="bound">z</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">.</span> <span class="bound">x</span><span class="main">≠</span><span class="bound">y</span> <span class="main">∧</span> <span class="bound">y</span><span class="main">≠</span><span class="bound">z</span> <span class="main">∧</span> <span class="bound">x</span><span class="main">≠</span><span class="bound">z</span> <span class="main">∧</span> ordering2 <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free">betw</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Chains using betweenness"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Old definitions of chains. Shown equivalent to <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>fin_long_chain_2›</span></span></span></span> in TemporalOrderOnPath.thy.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">chain_with</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">[[..</span> _ <span class="keyword1">..</span> _ <span class="keyword1">..</span> _ <span class="keyword1">..]</span>_<span class="keyword1">]</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">chain_with</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">≡</span> <span class="main"><span class="free">[[</span></span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">f</span><span class="main">.</span> ordering <span class="bound">f</span> <span class="free">betw</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">finite_chain_with3</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">[[</span>_ <span class="keyword1">..</span> _ <span class="keyword1">..</span> _<span class="keyword1">]</span>_<span class="keyword1">]</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">finite_chain_with3</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">≡</span> <span class="main">[[..</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">..</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">..</span><span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">..]</span><span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">]</span> <span class="main">∧</span> <span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">w</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="bound">w</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="bound">w</span><span class="main"><span class="free">]]</span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Minkowski-long_chain_betw"><span class="command">lemma</span></span> long_chain_betw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[[..</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">..</span><span class="free">c</span><span class="main">..]</span><span class="free">X</span><span class="main">]</span> <span class="main">⟹</span> <span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> chain_with_def<span class="main">)</span>

<span class="keyword1" id="Minkowski-finite_chain3_betw"><span class="command">lemma</span></span> finite_chain3_betw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[[</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">..</span><span class="free">c</span><span class="main">]</span><span class="free">X</span><span class="main">]</span> <span class="main">⟹</span> <span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> chain_with_def finite_chain_with3_def<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">finite_chain_with2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">[[</span>_ <span class="keyword1">..</span> _<span class="keyword1">]</span>_<span class="keyword1">]</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">finite_chain_with2</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">≡</span> <span class="main">∃</span><span class="bound">y</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">.</span> <span class="main">[[</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">..</span><span class="bound">y</span><span class="main">..</span><span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">]</span><span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">]</span>"</span></span>

<span class="keyword1" id="Minkowski-finite_chain2_betw"><span class="command">lemma</span></span> finite_chain2_betw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[[</span><span class="free">a</span><span class="main">..</span><span class="free">c</span><span class="main">]</span><span class="free">X</span><span class="main">]</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">b</span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="bound">b</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> finite_chain_with2_def finite_chain3_betw <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Betweenness: Rays and Intervals"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  ``Given any two distinct events $a,b$ of a path we define the segment
  $(ab) = \left\lbrace x : \ord{a}{x}{b},\; x \in ab \right\rbrace$" [Schutz97]
  Our version is a little different, because it is defined for any $a,b$ of type <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>'a›</span></span></span></span>.
  Thus we can have empty set segments, while Schutz can prove (once he proves path density)
  that segments are never empty.
›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">segment</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">segment</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">≡</span> <span class="main">{</span><span class="bound">x</span><span class="main">::</span><span class="tfree">'a</span><span class="main">.</span> <span class="main">∃</span><span class="bound">ab</span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="bound">x</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="bound">x</span><span class="main">∈</span><span class="bound">ab</span> <span class="main">∧</span> path <span class="bound">ab</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">is_segment</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_segment</span> <span class="free"><span class="bound"><span class="entity">ab</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">∃</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">ab</span></span></span> <span class="main">=</span> segment <span class="bound">a</span> <span class="bound">b</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">interval</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">interval</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">≡</span> insert <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">(</span>insert <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span>segment <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">is_interval</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_interval</span> <span class="free"><span class="bound"><span class="entity">ab</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">∃</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">ab</span></span></span> <span class="main">=</span> interval <span class="bound">a</span> <span class="bound">b</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">prolongation</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">prolongation</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">≡</span> <span class="main">{</span><span class="bound">x</span><span class="main">::</span><span class="tfree">'a</span><span class="main">.</span> <span class="main">∃</span><span class="bound">ab</span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="bound">x</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="bound">x</span><span class="main">∈</span><span class="bound">ab</span> <span class="main">∧</span> path <span class="bound">ab</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">is_prolongation</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_prolongation</span> <span class="free"><span class="bound"><span class="entity">ab</span></span></span> <span class="main">≡</span> <span class="main">∃</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">ab</span></span></span> <span class="main">=</span> prolongation <span class="bound">a</span> <span class="bound">b</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  I think this is what Schutz actually meant, maybe there is a typo in the text?
  Notice that <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>b ∈ ray a b›</span></span></span></span> for any $a$, always. Cf the comment on <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>segment_def›</span></span></span></span>.
  Thus <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>∃ray a b ≠ {}›</span></span></span></span> is no guarantee that a path $ab$ exists.
›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ray</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">ray</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">≡</span> insert <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">(</span>segment <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">∪</span> prolongation <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">is_ray</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_ray</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="main">≡</span> <span class="main">∃</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="main">=</span> ray <span class="bound">a</span> <span class="bound">b</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_ray_on</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_ray_on</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">∈</span><span class="free">𝒫</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span><span class="main">⊆</span><span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">∧</span> is_ray <span class="free"><span class="bound"><span class="entity">R</span></span></span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This is as in Schutz. Notice $b$ is not in the ray through $b$?›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ray_Schutz</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">ray_Schutz</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">≡</span> insert <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span>segment <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">∪</span> prolongation <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Minkowski-ends_notin_segment"><span class="command">lemma</span></span> ends_notin_segment<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∉</span> segment <span class="free">a</span> <span class="free">b</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">∉</span> segment <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> abc_abc_neq segment_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Minkowski-ends_in_int"><span class="command">lemma</span></span> ends_in_int<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> interval <span class="free">a</span> <span class="free">b</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">∈</span> interval <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> interval_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Minkowski-seg_betw"><span class="command">lemma</span></span> seg_betw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> segment <span class="free">a</span> <span class="free">b</span> <span class="main">⟷</span> <span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">x</span> <span class="free">b</span><span class="main"><span class="free">]]</span></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> segment_def abc_abc_neq abc_ex_path <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Minkowski-pro_betw"><span class="command">lemma</span></span> pro_betw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> prolongation <span class="free">a</span> <span class="free">b</span> <span class="main">⟷</span> <span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="free">x</span><span class="main"><span class="free">]]</span></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> prolongation_def abc_abc_neq abc_ex_path <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Minkowski-seg_sym"><span class="command">lemma</span></span> seg_sym<span class="main">:</span> <span class="quoted"><span class="quoted">"segment <span class="free">a</span> <span class="free">b</span> <span class="main">=</span> segment <span class="free">b</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> abc_sym segment_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Minkowski-empty_segment"><span class="command">lemma</span></span> empty_segment<span class="main">:</span> <span class="quoted"><span class="quoted">"segment <span class="free">a</span> <span class="free">a</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> segment_def<span class="main">)</span>

<span class="keyword1" id="Minkowski-int_sym"><span class="command">lemma</span></span> int_sym<span class="main">:</span> <span class="quoted"><span class="quoted">"interval <span class="free">a</span> <span class="free">b</span> <span class="main">=</span> interval <span class="free">b</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> insert_commute interval_def seg_sym<span class="main">)</span>

<span class="keyword1" id="Minkowski-seg_path"><span class="command">lemma</span></span> seg_path<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> segment <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="comment1">(* thus segment ≠ {} *)</span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">ab</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"path <span class="free">ab</span> <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"segment <span class="free">a</span> <span class="free">b</span> <span class="main">⊆</span> <span class="free">ab</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ab</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"path <span class="skolem">ab</span> <span class="free">a</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> abc_abc_neq abc_ex_path assms seg_betw
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"segment <span class="free">a</span> <span class="free">b</span> <span class="main">⊆</span> <span class="skolem">ab</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹path <span class="skolem">ab</span> <span class="free">a</span> <span class="free">b</span>›</span></span> abc_ex_path path_unique seg_betw
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹path <span class="skolem">ab</span> <span class="free">a</span> <span class="free">b</span>›</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Minkowski-seg_path2"><span class="command">lemma</span></span> seg_path2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"segment <span class="free">a</span> <span class="free">b</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">ab</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"path <span class="free">ab</span> <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"segment <span class="free">a</span> <span class="free">b</span> <span class="main">⊆</span> <span class="free">ab</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms seg_path <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Path density (theorem 17) will extend this by weakening the assumptions to <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>segment a b ≠ {}›</span></span></span></span>.›</span></span>
<span class="keyword1" id="Minkowski-seg_endpoints_on_path"><span class="command">lemma</span></span> seg_endpoints_on_path<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>segment <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">≥</span> <span class="numeral">2</span>"</span></span> <span class="quoted"><span class="quoted">"segment <span class="free">a</span> <span class="free">b</span> <span class="main">⊆</span> <span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span><span class="main">∈</span><span class="free">𝒫</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"path <span class="free">P</span> <span class="free">a</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> non_empty<span class="main">:</span> <span class="quoted"><span class="quoted">"segment <span class="free">a</span> <span class="free">b</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> numeral_2_eq_2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ab</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"path <span class="skolem">ab</span> <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"segment <span class="free">a</span> <span class="free">b</span> <span class="main">⊆</span> <span class="skolem">ab</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> seg_path2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">≠</span><span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹path <span class="skolem">ab</span> <span class="free">a</span> <span class="free">b</span>›</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span>segment <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">∈</span>segment <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">≠</span><span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> numeral_2_eq_2
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> card.infinite card_le_Suc0_iff_eq not_less_eq_eq not_numeral_le_zero<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="skolem">x</span> <span class="free">b</span><span class="main"><span class="free">]]</span></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> segment <span class="free">a</span> <span class="free">b</span>›</span></span> seg_betw <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="skolem">y</span> <span class="free">b</span><span class="main"><span class="free">]]</span></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> segment <span class="free">a</span> <span class="free">b</span>›</span></span> seg_betw <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="free">P</span> <span class="main">∧</span> <span class="skolem">y</span><span class="main">∈</span><span class="free">P</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> segment <span class="free">a</span> <span class="free">b</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> segment <span class="free">a</span> <span class="free">b</span>›</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="skolem">ab</span> <span class="main">∧</span> <span class="skolem">y</span><span class="main">∈</span><span class="skolem">ab</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹segment <span class="free">a</span> <span class="free">b</span> <span class="main">⊆</span> <span class="skolem">ab</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> segment <span class="free">a</span> <span class="free">b</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> segment <span class="free">a</span> <span class="free">b</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ab</span><span class="main">=</span><span class="free">P</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹path <span class="skolem">ab</span> <span class="free">a</span> <span class="free">b</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">P</span> <span class="main">∧</span> <span class="skolem">y</span> <span class="main">∈</span> <span class="free">P</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">ab</span> <span class="main">∧</span> <span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">ab</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">y</span>›</span></span> assms<span class="main">(</span>3<span class="main">)</span> path_unique <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹path <span class="skolem">ab</span> <span class="free">a</span> <span class="free">b</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Minkowski-pro_path"><span class="command">lemma</span></span> pro_path<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> prolongation <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="comment1">(* thus prolongation ≠ {} *)</span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">ab</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"path <span class="free">ab</span> <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"prolongation <span class="free">a</span> <span class="free">b</span> <span class="main">⊆</span> <span class="free">ab</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ab</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"path <span class="skolem">ab</span> <span class="free">a</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> abc_abc_neq abc_ex_path assms pro_betw
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prolongation <span class="free">a</span> <span class="free">b</span> <span class="main">⊆</span> <span class="skolem">ab</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹path <span class="skolem">ab</span> <span class="free">a</span> <span class="free">b</span>›</span></span> abc_ex_path path_unique pro_betw
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹path <span class="skolem">ab</span> <span class="free">a</span> <span class="free">b</span>›</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Minkowski-ray_cases"><span class="command">lemma</span></span> ray_cases<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> ray <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">x</span> <span class="free">b</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="free">x</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="free">x</span> <span class="main">=</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">∈</span>segment <span class="free">a</span> <span class="free">b</span> <span class="main">∨</span> <span class="free">x</span><span class="main">∈</span> prolongation <span class="free">a</span> <span class="free">b</span> <span class="main">∨</span> <span class="free">x</span><span class="main">=</span><span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms ray_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">x</span> <span class="free">b</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="free">x</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="free">x</span> <span class="main">=</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> pro_betw seg_betw <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Minkowski-ray_path"><span class="command">lemma</span></span> ray_path<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> ray <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">≠</span><span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">ab</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"path <span class="free">ab</span> <span class="free">a</span> <span class="free">b</span> <span class="main">∧</span> ray <span class="free">a</span> <span class="free">b</span> <span class="main">⊆</span> <span class="free">ab</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"ray <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="main">≠</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ab</span><span class="main">.</span> path <span class="bound">ab</span> <span class="free">a</span> <span class="free">b</span> <span class="main">∧</span> ray <span class="free">a</span> <span class="free">b</span> <span class="main">⊆</span> <span class="bound">ab</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> betw_cases<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">x</span> <span class="free">b</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="free">x</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ray_cases assms
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ab</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"path <span class="skolem">ab</span> <span class="free">a</span> <span class="free">b</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> abc_abc_neq abc_ex_path <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="main">⊆</span> <span class="skolem">ab</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> betw_cases
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> disjE<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">x</span> <span class="free">b</span><span class="main"><span class="free">]]</span></span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="main">⊆</span> <span class="skolem">ab</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="var">?r</span>"</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="skolem">ab</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹path <span class="skolem">ab</span> <span class="free">a</span> <span class="free">b</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> ray <span class="free">a</span> <span class="free">b</span>›</span></span> abc_ex_path eq_paths ray_cases<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="free">x</span><span class="main"><span class="free">]]</span></span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="main">⊆</span> <span class="skolem">ab</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="var">?r</span>"</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="skolem">ab</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹path <span class="skolem">ab</span> <span class="free">a</span> <span class="free">b</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> ray <span class="free">a</span> <span class="free">b</span>›</span></span> abc_ex_path eq_paths ray_cases<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹path <span class="skolem">ab</span> <span class="free">a</span> <span class="free">b</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* MinkowskiBetweenness *)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"MinkowskiChain: O6"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹O6 supposedly serves the same purpose as Pasch's axiom.›</span></span>

<span class="keyword1"><span class="command">locale</span></span> MinkowskiChain <span class="main">=</span> MinkowskiBetweenness <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> O6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">Q</span> <span class="main">∈</span> <span class="free">𝒫</span><span class="main">;</span> <span class="free">R</span> <span class="main">∈</span> <span class="free">𝒫</span><span class="main">;</span> <span class="free">S</span> <span class="main">∈</span> <span class="free">𝒫</span><span class="main">;</span> <span class="free">T</span> <span class="main">∈</span> <span class="free">𝒫</span><span class="main">;</span> <span class="free">Q</span> <span class="main">≠</span> <span class="free">R</span><span class="main">;</span> <span class="free">Q</span> <span class="main">≠</span> <span class="free">S</span><span class="main">;</span> <span class="free">R</span> <span class="main">≠</span> <span class="free">S</span><span class="main">;</span> <span class="free">a</span> <span class="main">∈</span> <span class="free">Q</span><span class="main">∩</span><span class="free">R</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">∈</span> <span class="free">Q</span><span class="main">∩</span><span class="free">S</span> <span class="main">∧</span> <span class="free">c</span> <span class="main">∈</span> <span class="free">R</span><span class="main">∩</span><span class="free">S</span><span class="main">;</span>
                <span class="main">∃</span><span class="bound">d</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="free">b</span> <span class="free">c</span> <span class="bound">d</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">e</span><span class="main">∈</span><span class="free">R</span><span class="main">.</span> <span class="bound">d</span> <span class="main">∈</span> <span class="free">T</span> <span class="main">∧</span> <span class="bound">e</span> <span class="main">∈</span> <span class="free">T</span> <span class="main">∧</span> <span class="main"><span class="free">[[</span></span><span class="free">c</span> <span class="bound">e</span> <span class="free">a</span><span class="main"><span class="free">]]</span></span><span class="main">)</span><span class="main">⟧</span>
               <span class="main">⟹</span> <span class="main">∃</span><span class="bound">f</span><span class="main">∈</span><span class="free">T</span><span class="main">∩</span><span class="free">Q</span><span class="main">.</span> <span class="main">∃</span><span class="bound">X</span><span class="main">.</span> <span class="main">[[</span><span class="free">a</span><span class="main">..</span><span class="bound">f</span><span class="main">..</span><span class="free">b</span><span class="main">]</span><span class="bound">X</span><span class="main">]</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Chains: (Closest) Bounds"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_bound_f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> <span class="main">(</span>nat<span class="main">⇒</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">is_bound_f</span> <span class="free"><span class="bound"><span class="entity">Q<span class="hidden">⇩</span><sub>b</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">≡</span>
    <span class="main">∀</span><span class="bound">i</span> <span class="bound">j</span> <span class="main">::</span>nat<span class="main">.</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">[</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">0</span><span class="main">)</span><span class="main">..]</span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">]</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">i</span><span class="main">&lt;</span><span class="bound">j</span> <span class="main">⟶</span> <span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">j</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">Q<span class="hidden">⇩</span><sub>b</sub></span></span></span><span class="main"><span class="free">]]</span></span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_bound</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">is_bound</span> <span class="free"><span class="bound"><span class="entity">Q<span class="hidden">⇩</span><sub>b</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">≡</span>
    <span class="main">∃</span><span class="bound">f</span><span class="main">::</span><span class="main">(</span>nat<span class="main">⇒</span><span class="tfree">'a</span><span class="main">)</span><span class="main">.</span> is_bound_f <span class="free"><span class="bound"><span class="entity">Q<span class="hidden">⇩</span><sub>b</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="bound">f</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  $Q_b$ has to be on the same path as the chain $Q$.
  This is left implicit in the betweenness condition (as is $Q_b\in\E$).
  So this is equivalent to Schutz only if we also assume his axioms,
  i.e. the statement of the continuity axiom is no longer independent of other axioms.
›</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">all_bounds</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">all_bounds</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">Q<span class="hidden">⇩</span><sub>b</sub></span><span class="main">.</span> is_bound <span class="bound">Q<span class="hidden">⇩</span><sub>b</sub></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">bounded</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">bounded</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">≡</span> <span class="main">∃</span> <span class="bound">Q<span class="hidden">⇩</span><sub>b</sub></span><span class="main">.</span> is_bound <span class="bound">Q<span class="hidden">⇩</span><sub>b</sub></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Just to make sure Continuity is not too strong.›</span></span>
<span class="keyword1" id="Minkowski-bounded_imp_inf"><span class="command">lemma</span></span> bounded_imp_inf<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"bounded <span class="free">Q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"infinite <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms bounded_def is_bound_def is_bound_f_def semifin_chain_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">closest_bound_f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> <span class="main">(</span>nat<span class="main">⇒</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">closest_bound_f</span> <span class="free"><span class="bound"><span class="entity">Q<span class="hidden">⇩</span><sub>b</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">≡</span>
<span class="comment1">⌦‹Q is an infinite chain indexed by f bound by Q<span class="hidden">⇩</span><sub>b</sub>›</span>
    is_bound_f <span class="free"><span class="bound"><span class="entity">Q<span class="hidden">⇩</span><sub>b</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">∧</span>
<span class="comment1">⌦‹Any other bound must be further from the start of the chain than the closest bound›</span>
    <span class="main">(</span><span class="main">∀</span> <span class="bound">Q<span class="hidden">⇩</span><sub>b</sub>'</span><span class="main">.</span> <span class="main">(</span>is_bound <span class="bound">Q<span class="hidden">⇩</span><sub>b</sub>'</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">∧</span> <span class="bound">Q<span class="hidden">⇩</span><sub>b</sub>'</span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">Q<span class="hidden">⇩</span><sub>b</sub></span></span></span><span class="main">)</span> <span class="main">⟶</span> <span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">0</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">Q<span class="hidden">⇩</span><sub>b</sub></span></span></span> <span class="bound">Q<span class="hidden">⇩</span><sub>b</sub>'</span><span class="main"><span class="free">]]</span></span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">closest_bound</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">closest_bound</span> <span class="free"><span class="bound"><span class="entity">Q<span class="hidden">⇩</span><sub>b</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">≡</span>
<span class="comment1">⌦‹Q is an infinite chain indexed by f bound by Q<span class="hidden">⇩</span><sub>b</sub>›</span>
    <span class="main">∃</span><span class="bound">f</span><span class="main">.</span> is_bound_f <span class="free"><span class="bound"><span class="entity">Q<span class="hidden">⇩</span><sub>b</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="bound">f</span> <span class="main">∧</span>
<span class="comment1">⌦‹Any other bound must be further from the start of the chain than the closest bound›</span>
    <span class="main">(</span><span class="main">∀</span> <span class="bound">Q<span class="hidden">⇩</span><sub>b</sub>'</span><span class="main">.</span> <span class="main">(</span>is_bound <span class="bound">Q<span class="hidden">⇩</span><sub>b</sub>'</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">∧</span> <span class="bound">Q<span class="hidden">⇩</span><sub>b</sub>'</span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">Q<span class="hidden">⇩</span><sub>b</sub></span></span></span><span class="main">)</span> <span class="main">⟶</span> <span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="bound">f</span> <span class="main">0</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">Q<span class="hidden">⇩</span><sub>b</sub></span></span></span> <span class="bound">Q<span class="hidden">⇩</span><sub>b</sub>'</span><span class="main"><span class="free">]]</span></span><span class="main">)</span>"</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(*MinkowskiChain*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"MinkowskiUnreachable: I5-I7"</span></span>

<span class="keyword1"><span class="command">locale</span></span> MinkowskiUnreachable <span class="main">=</span> MinkowskiChain <span class="main">+</span>
  <span class="comment1">(* I5 *)</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> two_in_unreach<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">Q</span> <span class="main">∈</span> <span class="free">𝒫</span><span class="main">;</span> <span class="free">b</span> <span class="main">∈</span> <span class="free">ℰ</span><span class="main">;</span> <span class="free">b</span> <span class="main">∉</span> <span class="free">Q</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">x</span><span class="main">∈</span><span class="main">∅</span> <span class="free">Q</span> <span class="free">b</span><span class="main">.</span> <span class="main">∃</span><span class="bound">y</span><span class="main">∈</span><span class="main">∅</span> <span class="free">Q</span> <span class="free">b</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> <span class="bound">y</span>"</span></span>

      <span class="keyword2"><span class="keyword">and</span></span> I6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">Q</span> <span class="main">∈</span> <span class="free">𝒫</span><span class="main">;</span> <span class="free">b</span> <span class="main">∉</span> <span class="free">Q</span><span class="main">;</span> <span class="free">b</span> <span class="main">∈</span> <span class="free">ℰ</span><span class="main">;</span> <span class="free">Qx</span> <span class="main">∈</span> <span class="main">(</span><span class="main">∅</span> <span class="free">Q</span> <span class="free">b</span><span class="main">)</span><span class="main">;</span> <span class="free">Qz</span> <span class="main">∈</span> <span class="main">(</span><span class="main">∅</span> <span class="free">Q</span> <span class="free">b</span><span class="main">)</span><span class="main">;</span> <span class="free">Qx</span><span class="main">≠</span><span class="free">Qz</span><span class="main">⟧</span>
               <span class="main">⟹</span> <span class="main">∃</span><span class="bound">X</span><span class="main">.</span> <span class="main">∃</span><span class="bound">f</span><span class="main">.</span> ch_by_ord <span class="bound">f</span> <span class="bound">X</span> <span class="main">∧</span> <span class="bound">f</span> <span class="main">0</span> <span class="main">=</span> <span class="free">Qx</span> <span class="main">∧</span> <span class="bound">f</span> <span class="main">(</span>card <span class="bound">X</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="free">Qz</span>
                         <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span> <span class="main">..</span> card <span class="bound">X</span> <span class="main">-</span> <span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="bound">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">∈</span> <span class="main">∅</span> <span class="free">Q</span> <span class="free">b</span>
                              <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">Qy</span><span class="main">∈</span><span class="free">ℰ</span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="bound">f</span><span class="main">(</span><span class="bound">i</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="bound">Qy</span> <span class="main">(</span><span class="bound">f</span> <span class="bound">i</span><span class="main">)</span><span class="main"><span class="free">]]</span></span> <span class="main">⟶</span> <span class="bound">Qy</span> <span class="main">∈</span> <span class="main">∅</span> <span class="free">Q</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span>
                         <span class="main">∧</span> <span class="main">(</span>short_ch <span class="bound">X</span> <span class="main">⟶</span> <span class="free">Qx</span><span class="main">∈</span><span class="bound">X</span> <span class="main">∧</span> <span class="free">Qz</span><span class="main">∈</span><span class="bound">X</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">Qy</span><span class="main">∈</span><span class="free">ℰ</span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="free">Qx</span> <span class="bound">Qy</span> <span class="free">Qz</span><span class="main"><span class="free">]]</span></span> <span class="main">⟶</span> <span class="bound">Qy</span> <span class="main">∈</span> <span class="main">∅</span> <span class="free">Q</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> I7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">Q</span> <span class="main">∈</span> <span class="free">𝒫</span><span class="main">;</span> <span class="free">b</span> <span class="main">∉</span> <span class="free">Q</span><span class="main">;</span> <span class="free">b</span> <span class="main">∈</span> <span class="free">ℰ</span><span class="main">;</span> <span class="free">Qx</span> <span class="main">∈</span> <span class="free">Q</span> <span class="main">-</span> <span class="main">∅</span> <span class="free">Q</span> <span class="free">b</span><span class="main">;</span> <span class="free">Qy</span> <span class="main">∈</span> <span class="main">∅</span> <span class="free">Q</span> <span class="free">b</span><span class="main">⟧</span>
               <span class="main">⟹</span> <span class="main">∃</span><span class="bound">g</span> <span class="bound">X</span> <span class="bound">Qn</span><span class="main">.</span> <span class="main">[</span><span class="bound">g</span><span class="main">[</span><span class="free">Qx</span><span class="main">..</span><span class="free">Qy</span><span class="main">..</span><span class="bound">Qn</span><span class="main">]</span><span class="bound">X</span><span class="main">]</span> <span class="main">∧</span> <span class="bound">Qn</span> <span class="main">∈</span> <span class="free">Q</span> <span class="main">-</span> <span class="main">∅</span> <span class="free">Q</span> <span class="free">b</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Minkowski-card_unreach_geq_2"><span class="command">lemma</span></span> card_unreach_geq_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span><span class="main">∈</span><span class="free">𝒫</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">∈</span><span class="free">ℰ</span><span class="main">-</span><span class="free">Q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">≤</span> card <span class="main">(</span><span class="main">∅</span> <span class="free">Q</span> <span class="free">b</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span>infinite <span class="main">(</span><span class="main">∅</span> <span class="free">Q</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> DiffD1 assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> card_le_Suc0_iff_eq two_in_unreach <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"MinkowskiSymmetry: Symmetry"</span></span>

<span class="keyword1"><span class="command">locale</span></span> MinkowskiSymmetry <span class="main">=</span> MinkowskiUnreachable <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> Symmetry<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">Q</span> <span class="main">∈</span> <span class="free">𝒫</span><span class="main">;</span> <span class="free">R</span> <span class="main">∈</span> <span class="free">𝒫</span><span class="main">;</span> <span class="free">S</span> <span class="main">∈</span> <span class="free">𝒫</span><span class="main">;</span> <span class="free">Q</span> <span class="main">≠</span> <span class="free">R</span><span class="main">;</span> <span class="free">Q</span> <span class="main">≠</span> <span class="free">S</span><span class="main">;</span> <span class="free">R</span> <span class="main">≠</span> <span class="free">S</span><span class="main">;</span>
               <span class="free">x</span> <span class="main">∈</span> <span class="free">Q</span><span class="main">∩</span><span class="free">R</span><span class="main">∩</span><span class="free">S</span><span class="main">;</span> <span class="free">Q<span class="hidden">⇩</span><sub>a</sub></span> <span class="main">∈</span> <span class="free">Q</span><span class="main">;</span> <span class="free">Q<span class="hidden">⇩</span><sub>a</sub></span> <span class="main">≠</span> <span class="free">x</span><span class="main">;</span>
               <span class="main">∅</span> <span class="free">Q</span> <span class="keyword1">from</span> <span class="free">Q<span class="hidden">⇩</span><sub>a</sub></span> <span class="keyword1">via</span> <span class="free">R</span> <span class="keyword1">at</span> <span class="free">x</span> <span class="main">=</span> <span class="main">∅</span> <span class="free">Q</span> <span class="keyword1">from</span> <span class="free">Q<span class="hidden">⇩</span><sub>a</sub></span> <span class="keyword1">via</span> <span class="free">S</span> <span class="keyword1">at</span> <span class="free">x</span><span class="main">⟧</span>
               <span class="main">⟹</span> <span class="main">∃</span><span class="bound">θ</span><span class="main">::</span><span class="tfree">'a</span><span class="main">⇒</span><span class="tfree">'a</span><span class="main">.</span>                               <span class="comment1">⌦‹i) there is a map θ:ℰ⇒ℰ›</span>
                     bij_betw <span class="main">(</span><span class="main">λ</span><span class="bound">P</span><span class="main">.</span> <span class="main">{</span><span class="bound">θ</span> <span class="bound">y</span> <span class="main">|</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y</span><span class="main">∈</span><span class="bound">P</span><span class="main">}</span><span class="main">)</span> <span class="free">𝒫</span> <span class="free">𝒫</span>      <span class="comment1">⌦‹ii) which induces a bijection Θ›</span>
                     <span class="main">∧</span> <span class="main">(</span><span class="free">y</span><span class="main">∈</span><span class="free">Q</span> <span class="main">⟶</span> <span class="bound">θ</span> <span class="free">y</span> <span class="main">=</span> <span class="free">y</span><span class="main">)</span>                    <span class="comment1">⌦‹iii) θ leaves Q invariant›</span>
                     <span class="main">∧</span> <span class="main">(</span><span class="main">λ</span><span class="bound">P</span><span class="main">.</span> <span class="main">{</span><span class="bound">θ</span> <span class="bound">y</span> <span class="main">|</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y</span><span class="main">∈</span><span class="bound">P</span><span class="main">}</span><span class="main">)</span> <span class="free">R</span> <span class="main">=</span> <span class="free">S</span>     <span class="comment1">⌦‹iv) Θ maps R to S›</span>"</span></span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"MinkowskiContinuity: Continuity"</span></span>

<span class="keyword1"><span class="command">locale</span></span> MinkowskiContinuity <span class="main">=</span> MinkowskiSymmetry <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> Continuity<span class="main">:</span> <span class="quoted"><span class="quoted">"bounded <span class="free">Q</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∃</span><span class="bound">Q<span class="hidden">⇩</span><sub>b</sub></span><span class="main">.</span> closest_bound <span class="bound">Q<span class="hidden">⇩</span><sub>b</sub></span> <span class="free">Q</span><span class="main">)</span>"</span></span>



<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"MinkowskiSpacetime: Dimension (I4)"</span></span>

<span class="keyword1"><span class="command">locale</span></span> MinkowskiSpacetime <span class="main">=</span> MinkowskiContinuity <span class="main">+</span>
  <span class="comment1">(* I4 *)</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ex_3SPRAY <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">ℰ</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">x</span><span class="main">∈</span><span class="free">ℰ</span><span class="main">.</span> three_SPRAY <span class="bound">x</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">(* substitute for I1, if I1 is omitted *)</span>
<span class="comment1">(* lemma nonempty_events:
  "ℰ ≠ {}"
using ex_3SPRAY by blast *)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  There exists an event by <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>nonempty_events›</span></span></span></span>, and by <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ex_3SPRAY›</span></span></span></span> there is a three-$\spray$, which by
  <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>three_SPRAY_ge4›</span></span></span></span> means that there are at least four paths.
›</span></span>
<span class="keyword1" id="Minkowski-four_paths"><span class="command">lemma</span></span> four_paths<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">Q1</span><span class="main">∈</span><span class="free">𝒫</span><span class="main">.</span> <span class="main">∃</span><span class="bound">Q2</span><span class="main">∈</span><span class="free">𝒫</span><span class="main">.</span> <span class="main">∃</span><span class="bound">Q3</span><span class="main">∈</span><span class="free">𝒫</span><span class="main">.</span> <span class="main">∃</span><span class="bound">Q4</span><span class="main">∈</span><span class="free">𝒫</span><span class="main">.</span> <span class="bound">Q1</span> <span class="main">≠</span> <span class="bound">Q2</span> <span class="main">∧</span> <span class="bound">Q1</span> <span class="main">≠</span> <span class="bound">Q3</span> <span class="main">∧</span> <span class="bound">Q1</span> <span class="main">≠</span> <span class="bound">Q4</span> <span class="main">∧</span> <span class="bound">Q2</span> <span class="main">≠</span> <span class="bound">Q3</span> <span class="main">∧</span> <span class="bound">Q2</span> <span class="main">≠</span> <span class="bound">Q4</span> <span class="main">∧</span> <span class="bound">Q3</span> <span class="main">≠</span> <span class="bound">Q4</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> nonempty_events ex_3SPRAY three_SPRAY_ge4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="TemporalOrderOnPath">
<div class="head">
<h1>Theory TemporalOrderOnPath</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:      Schutz_Spacetime/TemporalOrderOnPath.thy
    Authors:    Richard Schmoetten, Jake Palmer and Jacques D. Fleuriot
                University of Edinburgh, 2021          
*)</span>
<span class="keyword1"><span class="command">theory</span></span> TemporalOrderOnPath
<span class="keyword2"><span class="keyword">imports</span></span> <a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL/Main.html">Main</a> <a href="#Minkowski">Minkowski</a> <a href="#TernaryOrdering">TernaryOrdering</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  In Schutz \cite[pp.~18-30]{schutz1997}, this is ``Chapter 3: Temporal order on a path''.
  All theorems are from Schutz, all lemmas are either parts of the Schutz proofs extracted, or
  additional lemmas which needed to be added, with the exception of the three transitivity lemmas
  leading to Theorem 9, which are given by Schutz as well.
  Much of what we'd like to prove about chains with respect to injectivity, surjectivity,
  bijectivity, is proved in <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>TernaryOrdering.thy›</span></span></span></span>.
  Some more things are proved in interlude sections.
›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Disable list syntax.›</span></span>
<span class="keyword1"><span class="command">no_translations</span></span>
  <span class="quoted">"<span class="main">[</span><span class="free">x</span><span class="main">,</span> <span class="free">xs</span><span class="main">]</span>"</span> <span class="main">==</span> <span class="quoted">"<span class="free">x</span><span class="main">#</span><span class="main">[</span><span class="free">xs</span><span class="main">]</span>"</span>
  <span class="quoted">"<span class="main">[</span><span class="free">x</span><span class="main">]</span>"</span> <span class="main">==</span> <span class="quoted">"<span class="free">x</span><span class="main">#</span><span class="main">[]</span>"</span>
<span class="keyword1"><span class="command">no_syntax</span></span>
  <span class="comment1">― ‹list Enumeration›</span>
  <span class="quoted">"_list"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"args <span class="main">=&gt;</span> <span class="tfree">'a</span> list"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">[</span><span class="keyword3">(</span>_<span class="keyword3">)</span><span class="keyword1">]</span>"</span><span class="main">)</span>
<span class="keyword1"><span class="command">no_notation</span></span> Cons <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">#</span>"</span> 65<span class="main">)</span>
<span class="keyword1"><span class="command">no_notation</span></span> Nil <span class="main">(</span><span class="quoted">"<span class="keyword1">[]</span>"</span><span class="main">)</span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Preliminary Results for Primitives"</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  First some proofs that belong in this section but aren't proved in the book or are covered but
  in a different form or off-handed remark.
›</span></span>

<span class="keyword1"><span class="command">context</span></span> MinkowskiPrimitive <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="TemporalOrderOnPath-three_in_set3"><span class="command">lemma</span></span> three_in_set3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"card <span class="free">X</span> <span class="main">≥</span> <span class="numeral">3</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">x</span> <span class="free">y</span> <span class="free">z</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">∈</span><span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main">∈</span><span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span><span class="main">∈</span><span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">≠</span><span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">≠</span><span class="free">z</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main">≠</span><span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_le_Suc_iff numeral_3_eq_3<span class="main">)</span>

<span class="keyword1" id="TemporalOrderOnPath-paths_cross_once"><span class="command">lemma</span></span> paths_cross_once<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> path_Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">∈</span> <span class="free">𝒫</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> path_R<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">∈</span> <span class="free">𝒫</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> Q_neq_R<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">≠</span> <span class="free">R</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> QR_nonempty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span><span class="main">∩</span><span class="free">R</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃!</span><span class="bound"><span class="bound">a</span></span><span class="main">∈</span><span class="free">ℰ</span><span class="main">.</span> <span class="free">Q</span><span class="main">∩</span><span class="free">R</span> <span class="main">=</span> <span class="main">{</span><span class="bound">a</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> ab_inQR<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span><span class="main">∈</span><span class="free">ℰ</span><span class="main">.</span> <span class="bound">a</span><span class="main">∈</span><span class="free">Q</span><span class="main">∩</span><span class="free">R</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> QR_nonempty in_path_event path_Q <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> a_event<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">ℰ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a_inQR<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">Q</span><span class="main">∩</span><span class="free">R</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span><span class="main">∩</span><span class="free">R</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span><span class="main">∩</span><span class="free">R</span> <span class="main">≠</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">b</span><span class="main">∈</span><span class="free">Q</span><span class="main">∩</span><span class="free">R</span><span class="main">.</span> <span class="bound">b</span> <span class="main">≠</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a_inQR <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">=</span> <span class="free">R</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> eq_paths a_inQR path_Q path_R <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> Q_neq_R <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> a_event <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="TemporalOrderOnPath-cross_once_notin"><span class="command">lemma</span></span> cross_once_notin<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">∈</span> <span class="free">𝒫</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">∈</span> <span class="free">𝒫</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">Q</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> <span class="free">Q</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> <span class="free">R</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">≠</span> <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∉</span> <span class="free">R</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms paths_cross_once eq_paths <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>

<span class="keyword1" id="TemporalOrderOnPath-paths_cross_at"><span class="command">lemma</span></span> paths_cross_at<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> path_Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">∈</span> <span class="free">𝒫</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> path_R<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">∈</span> <span class="free">𝒫</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> Q_neq_R<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">≠</span> <span class="free">R</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> QR_nonempty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">∩</span> <span class="free">R</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> x_inQ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x_inR<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">∩</span> <span class="free">R</span> <span class="main">=</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> equalityI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">∩</span> <span class="free">R</span> <span class="main">⊆</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> subsetI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span>
    <span class="keyword3"><span class="command">assume</span></span> y_in_QR<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">Q</span> <span class="main">∩</span> <span class="free">R</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> y_not_in_just_x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∉</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> y_neq_x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≠</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">z</span><span class="main">.</span> <span class="free">Q</span> <span class="main">∩</span> <span class="free">R</span> <span class="main">=</span> <span class="main">{</span><span class="bound">z</span><span class="main">}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Q_neq_R path_Q path_R x_inQ x_inR y_in_QR cross_once_notin IntD1 IntD2<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> paths_cross_once <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> QR_nonempty Q_neq_R path_Q path_R<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="main">⊆</span> <span class="free">Q</span> <span class="main">∩</span> <span class="free">R</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x_inQ x_inR <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="TemporalOrderOnPath-events_distinct_paths"><span class="command">lemma</span></span> events_distinct_paths<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> a_event<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">ℰ</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> b_event<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> <span class="free">ℰ</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> a_neq_b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">R</span><span class="main">∈</span><span class="free">𝒫</span><span class="main">.</span> <span class="main">∃</span><span class="bound">S</span><span class="main">∈</span><span class="free">𝒫</span><span class="main">.</span> <span class="free">a</span> <span class="main">∈</span> <span class="bound">R</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">∈</span> <span class="bound">S</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">R</span> <span class="main">≠</span> <span class="bound">S</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃!</span><span class="bound"><span class="bound">c</span></span><span class="main">∈</span><span class="free">ℰ</span><span class="main">.</span> <span class="bound">R</span> <span class="main">∩</span> <span class="bound">S</span> <span class="main">=</span> <span class="main">{</span><span class="bound">c</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> events_paths assms paths_cross_once<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context MinkowskiPrimitive *)</span>
<span class="keyword1"><span class="command">context</span></span> MinkowskiBetweenness <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">f</span><span class="main">.</span> long_ch_by_ord <span class="bound">f</span> <span class="main">{</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">,</span><span class="free">c</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> abc_abc_neq ord_ordered long_ch_by_ord_def assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> insertI1 insert_commute<span class="main">)</span>

<span class="keyword1" id="TemporalOrderOnPath-between_chain"><span class="command">lemma</span></span> between_chain<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span> <span class="main">⟹</span> ch <span class="main">{</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">,</span><span class="free">c</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">f</span><span class="main">.</span> ordering <span class="bound">f</span> <span class="free">betw</span> <span class="main">{</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">,</span><span class="free">c</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abc_abc_neq ord_ordered<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">f</span><span class="main">.</span> long_ch_by_ord <span class="bound">f</span> <span class="main">{</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">,</span><span class="free">c</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span>›</span></span> abc_abc_neq long_ch_by_ord_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ch_by_ord_def ch_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="TemporalOrderOnPath-overlap_chain"><span class="command">lemma</span></span> overlap_chain<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span><span class="main">;</span> <span class="main"><span class="free">[[</span></span><span class="free">b</span> <span class="free">c</span> <span class="free">d</span><span class="main"><span class="free">]]</span></span><span class="main">⟧</span> <span class="main">⟹</span> ch <span class="main">{</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">,</span><span class="free">c</span><span class="main">,</span><span class="free">d</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">b</span> <span class="free">c</span> <span class="free">d</span><span class="main"><span class="free">]]</span></span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">f</span><span class="main">.</span> ordering <span class="bound">f</span> <span class="free">betw</span> <span class="main">{</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">,</span><span class="free">c</span><span class="main">,</span><span class="free">d</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="free">d</span><span class="main"><span class="free">]]</span></span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="free">b</span> <span class="free">c</span> <span class="free">d</span><span class="main"><span class="free">]]</span></span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">c</span> <span class="free">d</span><span class="main"><span class="free">]]</span></span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="free">b</span> <span class="free">c</span> <span class="free">d</span><span class="main"><span class="free">]]</span></span>›</span></span> abc_bcd_acd <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> f1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="free">b</span> <span class="free">c</span> <span class="free">d</span><span class="main"><span class="free">]]</span></span>›</span></span> abc_abc_neq overlap_ordering<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">f</span><span class="main">.</span> long_ch_by_ord <span class="bound">f</span> <span class="main">{</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">,</span><span class="free">c</span><span class="main">,</span><span class="free">d</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span>›</span></span> abc_abc_neq long_ch_by_ord_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ch_by_ord_def ch_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context MinkowskiBetweenness *)</span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"3.1 Order on a finite chain"</span></span>
<span class="keyword1"><span class="command">context</span></span> MinkowskiBetweenness <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Theorem 1›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  See <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Minkowski.abc_only_cba›</span></span></span></span>.
  Proving it again here to show it can be done following the prose in Schutz.
›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> theorem1 <span class="main">[</span><span class="operator">no_atp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> abc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">c</span> <span class="free">b</span> <span class="free">a</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="main">¬</span> <span class="main"><span class="free">[[</span></span><span class="free">b</span> <span class="free">c</span> <span class="free">a</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="main">¬</span> <span class="main"><span class="free">[[</span></span><span class="free">c</span> <span class="free">a</span> <span class="free">b</span><span class="main"><span class="free">]]</span></span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="comment1">(* (i) *)</span>
  <span class="keyword1"><span class="command">have</span></span> part_i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">c</span> <span class="free">b</span> <span class="free">a</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> abc abc_sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="comment1">(* (ii) *)</span>
  <span class="keyword1"><span class="command">have</span></span> part_ii<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main"><span class="free">[[</span></span><span class="free">b</span> <span class="free">c</span> <span class="free">a</span><span class="main"><span class="free">]]</span></span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> notI<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">b</span> <span class="free">c</span> <span class="free">a</span><span class="main"><span class="free">]]</span></span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="free">a</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> abc abc_bcd_abd <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> abc_ac_neq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="comment1">(* (iii) *)</span>
  <span class="keyword1"><span class="command">have</span></span> part_iii<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main"><span class="free">[[</span></span><span class="free">c</span> <span class="free">a</span> <span class="free">b</span><span class="main"><span class="free">]]</span></span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> notI<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">c</span> <span class="free">a</span> <span class="free">b</span><span class="main"><span class="free">]]</span></span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">c</span> <span class="free">a</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> abc abc_bcd_abd <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> abc_ac_neq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> part_i part_ii part_iii <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Theorem 2›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The lemma <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>abc_bcd_acd›</span></span></span></span>, equal to the start of Schutz's proof, is given in <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Minkowski›</span></span></span></span> in order
  to prove some equivalences.
  Splitting it up into the proof of:
    ``there is a betweenness relation for each ordered triple", and
    ``all events of a chain are distinct"
  The first part is obvious with total chains (using <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ordering›</span></span></span></span>), and will be proved using the
  local definition as well (<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ordering2›</span></span></span></span>), following Schutz' proof.
  The second part is proved as injectivity of the indexing function (see <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>index_injective›</span></span></span></span>).
›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  For the case of two-element chains: the elements are distinct by definition,
  and the statement on ordering is void (respectively, <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>False ⟹ P›</span></span></span></span> for any <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>P›</span></span></span></span>).
›</span></span>

<span class="comment1">(* Theorem 2 for total chains *)</span>
<span class="keyword1"><span class="command">theorem</span></span> order_finite_chain<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> chX<span class="main">:</span> <span class="quoted"><span class="quoted">"long_ch_by_ord <span class="free">f</span> <span class="free">X</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> finiteX<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> ordered_nats<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="main">(</span><span class="free">i</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">&lt;</span> <span class="free">j</span> <span class="main">∧</span> <span class="free">j</span> <span class="main">&lt;</span> <span class="free">l</span> <span class="main">∧</span> <span class="free">l</span> <span class="main">&lt;</span> card <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="free">j</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="free">l</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> chX long_ch_by_ord_def ordered_nats ordering_ord_ijk<span class="main">)</span>

<span class="comment1">(* Theorem 2 (with helper lemmas for induction) for local chains *)</span>
<span class="keyword1" id="TemporalOrderOnPath-thm2_ind1"><span class="command">lemma</span></span> thm2_ind1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> chX<span class="main">:</span> <span class="quoted"><span class="quoted">"long_ch_by_ord2 <span class="free">f</span> <span class="free">X</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> finiteX<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">j</span> <span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="bound">i</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">&lt;</span> <span class="bound">j</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">&lt;</span> card <span class="free">X</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">⟶</span> <span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="bound">j</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="bound">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="bound">j</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="bound">j</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">i</span><span class="main">&lt;</span><span class="skolem">j</span> <span class="main">∧</span> <span class="skolem">j</span><span class="main">&lt;</span>card <span class="free">X</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">⟶</span> <span class="var">?P</span> <span class="skolem">i</span> <span class="skolem">j</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">j</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0 <span class="comment1">(* this assumption is False, so easy *)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">&lt;</span>Suc <span class="skolem">j</span>"</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">j</span><span class="main">&lt;</span>card <span class="free">X</span> <span class="main">-</span><span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> pj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">j</span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="comment1">(* needs Suc Suc j &lt; card X *)</span>
        <span class="keyword1"><span class="command">using</span></span> asm<span class="main">(</span>2<span class="main">)</span> chX less_diff_conv long_ch_by_ord2_def ordering2_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_eq_plus1<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">&lt;</span><span class="skolem">j</span> <span class="main">∨</span> <span class="skolem">i</span><span class="main">=</span><span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> asm<span class="main">(</span>1<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">i</span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">=</span><span class="skolem">j</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">i</span> <span class="main">=</span> Suc <span class="skolem">j</span> <span class="main">∧</span> Suc <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">i</span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> pj <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">&lt;</span><span class="skolem">j</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> card <span class="free">X</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> asm<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">i</span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span><span class="main">&lt;</span><span class="skolem">j</span>›</span></span> Suc.hyps asm<span class="main">(</span>1<span class="main">)</span> asm<span class="main">(</span>2<span class="main">)</span> chX finiteX Suc_eq_plus1 abc_bcd_acd pj
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span> 
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="TemporalOrderOnPath-thm2_ind2"><span class="command">lemma</span></span> thm2_ind2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> chX<span class="main">:</span> <span class="quoted"><span class="quoted">"long_ch_by_ord2 <span class="free">f</span> <span class="free">X</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> finiteX<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">m</span> <span class="bound">l</span><span class="main">.</span> <span class="main">(</span><span class="main">0</span><span class="main">&lt;</span><span class="main">(</span><span class="bound">l</span><span class="main">-</span><span class="bound">m</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">l</span><span class="main">-</span><span class="bound">m</span><span class="main">)</span> <span class="main">&lt;</span> <span class="bound">l</span> <span class="main">∧</span> <span class="bound">l</span> <span class="main">&lt;</span> card <span class="free">X</span><span class="main">)</span> <span class="main">⟶</span> <span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="main">(</span><span class="bound">l</span><span class="main">-</span><span class="bound">m</span><span class="main">)</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="bound">l</span><span class="main">-</span><span class="bound">m</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="bound">l</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">l</span> <span class="skolem">m</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">k</span> <span class="bound">l</span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="bound">k</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="bound">k</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="bound">l</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?n</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"card <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?k</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">l</span><span class="main">::</span>nat<span class="main">)</span><span class="main">-</span><span class="skolem">m</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="var">?k</span> <span class="main">∧</span> <span class="var">?k</span> <span class="main">&lt;</span> <span class="skolem">l</span> <span class="main">∧</span> <span class="skolem">l</span> <span class="main">&lt;</span> <span class="var">?n</span> <span class="main">⟶</span> <span class="var">?P</span> <span class="var">?k</span> <span class="skolem">l</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">m</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0 <span class="comment1">(* yet again, this assumption is False, so easy *)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">l</span> <span class="main">-</span> Suc <span class="skolem">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">-</span> Suc <span class="skolem">m</span> <span class="main">&lt;</span> <span class="skolem">l</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">&lt;</span> <span class="var">?n</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">m</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∨</span> Suc <span class="skolem">m</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="skolem">l</span> <span class="main">-</span> Suc <span class="skolem">m</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="skolem">l</span> <span class="main">-</span> Suc <span class="skolem">m</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">l</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?goal</span></span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">m</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?goal</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">-</span> Suc <span class="skolem">m</span> <span class="main">&lt;</span> card <span class="free">X</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> asm<span class="main">(</span>2<span class="main">)</span> asm<span class="main">(</span>3<span class="main">)</span> less_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Suc <span class="skolem">m</span> <span class="main">=</span> <span class="main">1</span>›</span></span> asm finiteX thm2_ind1 chX
            <span class="keyword1"><span class="command">using</span></span> Suc_eq_plus1 add_diff_inverse_nat diff_Suc_less
                  gr_implies_not_zero less_one plus_1_eq_Suc
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> long_ch_by_ord2_def ordering2_ord_ijk<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">m</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?goal</span></span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">l</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> c<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">(</span><span class="skolem">l</span> <span class="main">-</span> Suc <span class="skolem">m</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> abc_sym<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">l</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> c<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">(</span><span class="skolem">l</span><span class="main">-</span>Suc <span class="skolem">m</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> d<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">(</span><span class="skolem">l</span><span class="main">-</span>Suc <span class="skolem">m</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">(</span><span class="skolem">l</span><span class="main">-</span><span class="skolem">m</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> abc_bcd_acd<span class="main">)</span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="skolem">l</span><span class="main">-</span><span class="skolem">m</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="skolem">l</span><span class="main">-</span><span class="skolem">m</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">l</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> Suc.hyps <span class="quoted"><span class="quoted">‹<span class="main">1</span> <span class="main">&lt;</span> Suc <span class="skolem">m</span>›</span></span> asm<span class="main">(</span>1<span class="main">,</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="skolem">l</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="skolem">l</span> <span class="main">-</span> <span class="skolem">m</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="skolem">l</span> <span class="main">-</span> Suc <span class="skolem">m</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> abc_sym One_nat_def diff_zero minus_nat.simps<span class="main">(</span>2<span class="main">)</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc<span class="main">(</span><span class="skolem">l</span> <span class="main">-</span> Suc <span class="skolem">m</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">l</span> <span class="main">-</span> Suc <span class="skolem">m</span>"</span></span> <span class="quoted"><span class="quoted">"Suc<span class="main">(</span><span class="skolem">l</span> <span class="main">-</span> Suc <span class="skolem">m</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">l</span><span class="main">-</span><span class="skolem">m</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> Suc_pred asm<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span><span class="main"><span class="keyword3">+</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="skolem">l</span> <span class="main">-</span> Suc <span class="skolem">m</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="skolem">l</span> <span class="main">-</span> Suc <span class="skolem">m</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="skolem">l</span> <span class="main">-</span> <span class="skolem">m</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> chX <span class="keyword1"><span class="command">unfolding</span></span> long_ch_by_ord2_def ordering2_def
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> asm<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> less_imp_diff_less<span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="skolem">l</span> <span class="main">-</span> <span class="skolem">m</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="skolem">l</span> <span class="main">-</span> Suc <span class="skolem">m</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="skolem">l</span> <span class="main">-</span> Suc <span class="skolem">m</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> abc_sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="TemporalOrderOnPath-thm2_ind2b"><span class="command">lemma</span></span> thm2_ind2b<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> chX<span class="main">:</span> <span class="quoted"><span class="quoted">"long_ch_by_ord2 <span class="free">f</span> <span class="free">X</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> finiteX<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> ordered_nats<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">&lt;</span><span class="free">k</span> <span class="main">∧</span> <span class="free">k</span><span class="main">&lt;</span><span class="free">l</span> <span class="main">∧</span> <span class="free">l</span> <span class="main">&lt;</span> card <span class="free">X</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="free">k</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="free">l</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> thm2_ind2 finiteX chX ordered_nats
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> diff_diff_cancel less_imp_le<span class="main">)</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  This is Theorem 2 properly speaking, except for the "chain elements are distinct" part
  (which is proved as injectivity of the index later). Follows Schutz fairly well!
  The statement Schutz proves under (i) is given in <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>MinkowskiBetweenness.abc_bcd_acd›</span></span></span></span> instead.
›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> <span class="comment1">(*2*)</span> order_finite_chain2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> chX<span class="main">:</span> <span class="quoted"><span class="quoted">"long_ch_by_ord2 <span class="free">f</span> <span class="free">X</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> finiteX<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> ordered_nats<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="main">(</span><span class="free">i</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">&lt;</span> <span class="free">j</span> <span class="main">∧</span> <span class="free">j</span> <span class="main">&lt;</span> <span class="free">l</span> <span class="main">∧</span> <span class="free">l</span> <span class="main">&lt;</span> card <span class="free">X</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="free">j</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="free">l</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?n</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"card <span class="free">X</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> ord1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">≤</span><span class="free">i</span> <span class="main">∧</span> <span class="free">i</span><span class="main">&lt;</span><span class="free">j</span> <span class="main">∧</span> <span class="free">j</span><span class="main">&lt;</span><span class="var">?n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ordered_nats <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">have</span></span> e2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="free">j</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="free">j</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> thm2_ind1
    <span class="keyword1"><span class="command">using</span></span> Suc_eq_plus1 chX finiteX ord1
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">have</span></span> e3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">k</span><span class="main">.</span> <span class="main">0</span><span class="main">&lt;</span><span class="bound">k</span> <span class="main">∧</span> <span class="bound">k</span><span class="main">&lt;</span><span class="free">l</span> <span class="main">⟶</span> <span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="bound">k</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="bound">k</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="free">l</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> thm2_ind2b chX finiteX ordered_nats
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span><span class="main">&lt;</span><span class="free">l</span><span class="main">-</span><span class="main">1</span> <span class="main">∨</span> <span class="free">j</span><span class="main">=</span><span class="free">l</span><span class="main">-</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ordered_nats <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span><span class="main">&lt;</span><span class="free">l</span><span class="main">-</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="free">j</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="free">j</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="free">l</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> e3 abc_abc_neq ordered_nats
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">j</span> <span class="main">&lt;</span> <span class="free">l</span> <span class="main">-</span> <span class="main">1</span>›</span></span> less_diff_conv <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> e2 abc_bcd_abd
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span><span class="main">=</span><span class="free">l</span><span class="main">-</span><span class="main">1</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> e2
      <span class="keyword1"><span class="command">using</span></span> ordered_nats <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="TemporalOrderOnPath-three_in_long_chain2"><span class="command">lemma</span></span> three_in_long_chain2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"long_ch_by_ord2 <span class="free">f</span> <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">x</span> <span class="free">y</span> <span class="free">z</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">∈</span><span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main">∈</span><span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span><span class="main">∈</span><span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">≠</span><span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">≠</span><span class="free">z</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main">≠</span><span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> long_ch_by_ord2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1" id="TemporalOrderOnPath-short_ch_card_2"><span class="command">lemma</span></span> short_ch_card_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ch_by_ord <span class="free">f</span> <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"short_ch <span class="free">X</span> <span class="main">⟷</span> card <span class="free">X</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms card_2_iff' ch_by_ord_def long_ch_by_ord_def short_ch_def<span class="main">)</span>


<span class="keyword1" id="TemporalOrderOnPath-long_chain2_card_geq"><span class="command">lemma</span></span> long_chain2_card_geq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"long_ch_by_ord2 <span class="free">f</span> <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="free">X</span> <span class="main">≥</span> <span class="numeral">3</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> xyz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="free">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">∈</span><span class="free">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span><span class="main">∈</span><span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> neq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">≠</span><span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">≠</span><span class="skolem">z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">≠</span><span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> three_in_long_chain2 assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">,</span><span class="skolem">z</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?S</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> xyz<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="var">?S</span> <span class="main">≥</span> <span class="numeral">3</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> antisym <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">y</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">z</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">≠</span> <span class="skolem">z</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> neq fin three_subset<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="TemporalOrderOnPath-fin_chain_card_geq_2"><span class="command">lemma</span></span> fin_chain_card_geq_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">f</span><span class="main">[</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">]</span><span class="free">X</span><span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="free">X</span> <span class="main">≥</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> fin_chain_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"short_ch <span class="free">X</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> short_ch_card_2
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> card_2_iff' dual_order.eq_iff short_ch_def<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> assms fin_long_chain_def not_less <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>


<span class="comment1">(*TODO: make index_neq_ results use this, much simpler!?*)</span>
<span class="keyword1"><span class="command">theorem</span></span> <span class="comment1">(*2ii*)</span> index_injective<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">i</span><span class="main">::</span><span class="quoted">nat</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">j</span><span class="main">::</span><span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> chX<span class="main">:</span> <span class="quoted"><span class="quoted">"long_ch_by_ord2 <span class="free">f</span> <span class="free">X</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> finiteX<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> indices<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">&lt;</span><span class="free">j</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span><span class="main">&lt;</span>card <span class="free">X</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">i</span> <span class="main">≠</span> <span class="free">f</span> <span class="free">j</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Suc <span class="free">i</span> <span class="main">&lt;</span> <span class="free">j</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span>Suc<span class="main">(</span><span class="free">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="free">j</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> order_finite_chain2 chX finiteX indices<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> abc_abc_neq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>Suc <span class="free">i</span> <span class="main">&lt;</span> <span class="free">j</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Suc <span class="free">i</span> <span class="main">=</span> <span class="free">j</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Suc_lessI indices<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Suc <span class="free">j</span> <span class="main">=</span> card <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">&lt;</span><span class="free">i</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc<span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span> <span class="main">=</span> card <span class="free">X</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹Suc <span class="free">i</span> <span class="main">=</span> <span class="free">j</span>›</span></span> <span class="quoted"><span class="quoted">‹Suc <span class="free">j</span> <span class="main">=</span> card <span class="free">X</span>›</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="free">X</span> <span class="main">≥</span> <span class="numeral">3</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> finiteX long_chain2_card_geq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Suc <span class="free">i</span> <span class="main">=</span> <span class="free">j</span>›</span></span> <span class="quoted"><span class="quoted">‹Suc <span class="free">j</span> <span class="main">=</span> card <span class="free">X</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="free">j</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms order_finite_chain2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> abc_abc_neq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>Suc <span class="free">j</span> <span class="main">=</span> card <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="free">j</span> <span class="main">&lt;</span> card <span class="free">X</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Suc_lessI indices<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="free">j</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span><span class="main">(</span>Suc <span class="free">j</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> chX finiteX indices<span class="main">(</span>1<span class="main">)</span> order_finite_chain2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> abc_abc_neq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context MinkowskiBetweenness *)</span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Finite chain equivalence: local <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>↔›</span></span></span></span> global›</span></span>
<span class="keyword1"><span class="command">context</span></span> MinkowskiBetweenness <span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1" id="TemporalOrderOnPath-ch_equiv1"><span class="command">lemma</span></span> ch_equiv1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"long_ch_by_ord <span class="free">f</span> <span class="free">X</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"long_ch_by_ord2 <span class="free">f</span> <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">unfolding</span></span> long_ch_by_ord_def long_ch_by_ord2_def ordering_def ordering2_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lessI<span class="main">)</span>


<span class="keyword1" id="TemporalOrderOnPath-ch_equiv2"><span class="command">lemma</span></span> ch_equiv2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"long_ch_by_ord2 <span class="free">f</span> <span class="free">X</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"long_ch_by_ord <span class="free">f</span> <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> order_finite_chain2 assms
  <span class="keyword1"><span class="command">unfolding</span></span> long_ch_by_ord_def long_ch_by_ord2_def ordering_def ordering2_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


<span class="keyword1" id="TemporalOrderOnPath-ch_equiv"><span class="command">lemma</span></span> ch_equiv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"long_ch_by_ord <span class="free">f</span> <span class="free">X</span> <span class="main">⟷</span> long_ch_by_ord2 <span class="free">f</span> <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> ch_equiv1 ch_equiv2 assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(*context MinkowskiBetweenness*)</span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Preliminary Results for Kinematic Triangles and Paths/Betweenness"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Theorem 3 (collinearity)
  First we prove some lemmas that will be very helpful.
›</span></span>


<span class="keyword1"><span class="command">context</span></span> MinkowskiPrimitive <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="TemporalOrderOnPath-triangle_permutes"><span class="command">lemma</span></span> triangle_permutes <span class="main">[</span><span class="operator">no_atp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">△</span> <span class="free">a</span> <span class="free">b</span> <span class="free">c</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">△</span> <span class="free">a</span> <span class="free">c</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">△</span> <span class="free">b</span> <span class="free">a</span> <span class="free">c</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">△</span> <span class="free">b</span> <span class="free">c</span> <span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">△</span> <span class="free">c</span> <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">△</span> <span class="free">c</span> <span class="free">b</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> kinematic_triangle_def<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1" id="TemporalOrderOnPath-triangle_paths"><span class="command">lemma</span></span> triangle_paths <span class="main">[</span><span class="operator">no_atp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> tri_abc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">△</span> <span class="free">a</span> <span class="free">b</span> <span class="free">c</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"path_ex <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"path_ex <span class="free">a</span> <span class="free">c</span>"</span></span> <span class="quoted"><span class="quoted">"path_ex <span class="free">b</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> tri_abc <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> kinematic_triangle_def<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>


<span class="keyword1" id="TemporalOrderOnPath-triangle_paths_unique"><span class="command">lemma</span></span> triangle_paths_unique<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> tri_abc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">△</span> <span class="free">a</span> <span class="free">b</span> <span class="free">c</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃!</span><span class="bound">ab</span><span class="main">.</span> path <span class="bound">ab</span> <span class="free">a</span> <span class="free">b</span>"</span></span>      
  <span class="keyword1"><span class="command">using</span></span> path_unique tri_abc triangle_paths<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The definition of the kinematic triangle says that there exist paths that $a$ and $b$ pass through,
  and $a$ and $c$ pass through etc that are not equal. But we can show there is a \emph{unique} $ab$ that $a$
  and $b$ pass through, and assuming there is a path $abc$  that $a, b, c$ pass through, it must be
  unique. Therefore <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ab = abc›</span></span></span></span> and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ac = abc›</span></span></span></span>, but <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ab ≠ ac›</span></span></span></span>, therefore <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>False›</span></span></span></span>.
  Lemma <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>tri_three_paths›</span></span></span></span> is not in the books but might simplify some path obtaining.
›</span></span>

<span class="keyword1" id="TemporalOrderOnPath-triangle_diff_paths"><span class="command">lemma</span></span> triangle_diff_paths<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> tri_abc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">△</span> <span class="free">a</span> <span class="free">b</span> <span class="free">c</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">Q</span><span class="main">∈</span><span class="free">𝒫</span><span class="main">.</span> <span class="free">a</span> <span class="main">∈</span> <span class="bound">Q</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">∈</span> <span class="bound">Q</span> <span class="main">∧</span> <span class="free">c</span> <span class="main">∈</span> <span class="bound">Q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> notI<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> not_thesis<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">Q</span><span class="main">∈</span><span class="free">𝒫</span><span class="main">.</span> <span class="free">a</span> <span class="main">∈</span> <span class="bound">Q</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">∈</span> <span class="bound">Q</span> <span class="main">∧</span> <span class="free">c</span> <span class="main">∈</span> <span class="bound">Q</span>"</span></span>
  <span class="comment1">(* First show [abc] or similar so I can show the path through abc is unique. *)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">abc</span></span> <span class="keyword2"><span class="keyword">where</span></span> path_abc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">abc</span> <span class="main">∈</span> <span class="free">𝒫</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">∈</span> <span class="skolem">abc</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">∈</span> <span class="skolem">abc</span> <span class="main">∧</span> <span class="free">c</span> <span class="main">∈</span> <span class="skolem">abc</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> abc_neq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">≠</span> <span class="free">c</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">≠</span> <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> tri_abc kinematic_triangle_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="comment1">(* Now extract some information from △ a b c. *)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ab</span><span class="main">∈</span><span class="free">𝒫</span><span class="main">.</span> <span class="main">∃</span><span class="bound">ac</span><span class="main">∈</span><span class="free">𝒫</span><span class="main">.</span> <span class="bound">ab</span> <span class="main">≠</span> <span class="bound">ac</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">∈</span> <span class="bound">ab</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">∈</span> <span class="bound">ab</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">∈</span> <span class="bound">ac</span> <span class="main">∧</span> <span class="free">c</span> <span class="main">∈</span> <span class="bound">ac</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> tri_abc kinematic_triangle_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ab</span></span> <span class="skolem"><span class="skolem">ac</span></span> <span class="keyword2"><span class="keyword">where</span></span> ab_ac_relate<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ab</span> <span class="main">∈</span> <span class="free">𝒫</span> <span class="main">∧</span> <span class="skolem">ac</span> <span class="main">∈</span> <span class="free">𝒫</span> <span class="main">∧</span> <span class="skolem">ab</span> <span class="main">≠</span> <span class="skolem">ac</span> <span class="main">∧</span> <span class="main">{</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">}</span> <span class="main">⊆</span> <span class="skolem">ab</span> <span class="main">∧</span> <span class="main">{</span><span class="free">a</span><span class="main">,</span><span class="free">c</span><span class="main">}</span> <span class="main">⊆</span> <span class="skolem">ac</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃!</span><span class="bound"><span class="bound">ab</span></span><span class="main">∈</span><span class="free">𝒫</span><span class="main">.</span> <span class="free">a</span> <span class="main">∈</span> <span class="bound">ab</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">∈</span> <span class="bound">ab</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> tri_abc triangle_paths_unique <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ab_eq_abc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ab</span> <span class="main">=</span> <span class="skolem">abc</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> path_abc ab_ac_relate <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃!</span><span class="bound"><span class="bound">ac</span></span><span class="main">∈</span><span class="free">𝒫</span><span class="main">.</span> <span class="free">a</span> <span class="main">∈</span> <span class="bound">ac</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">∈</span> <span class="bound">ac</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> tri_abc triangle_paths_unique <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ac_eq_abc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ac</span> <span class="main">=</span> <span class="skolem">abc</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> path_abc ab_ac_relate eq_paths abc_neq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ab</span> <span class="main">=</span> <span class="skolem">ac</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ab_eq_abc ac_eq_abc <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> ab_ac_relate <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="TemporalOrderOnPath-tri_three_paths"><span class="command">lemma</span></span> tri_three_paths <span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> tri_abc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">△</span> <span class="free">a</span> <span class="free">b</span> <span class="free">c</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ab</span> <span class="bound">bc</span> <span class="bound">ca</span><span class="main">.</span> path <span class="bound">ab</span> <span class="free">a</span> <span class="free">b</span> <span class="main">∧</span> path <span class="bound">bc</span> <span class="free">b</span> <span class="free">c</span> <span class="main">∧</span> path <span class="bound">ca</span> <span class="free">c</span> <span class="free">a</span> <span class="main">∧</span> <span class="bound">ab</span> <span class="main">≠</span> <span class="bound">bc</span> <span class="main">∧</span> <span class="bound">ab</span> <span class="main">≠</span> <span class="bound">ca</span> <span class="main">∧</span> <span class="bound">bc</span> <span class="main">≠</span> <span class="bound">ca</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> tri_abc triangle_diff_paths triangle_paths<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> triangle_paths_unique
<span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="TemporalOrderOnPath-triangle_paths_neq"><span class="command">lemma</span></span> triangle_paths_neq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> tri_abc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">△</span> <span class="free">a</span> <span class="free">b</span> <span class="free">c</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> path_ab<span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="free">ab</span> <span class="free">a</span> <span class="free">b</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> path_ac<span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="free">ac</span> <span class="free">a</span> <span class="free">c</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">ab</span> <span class="main">≠</span> <span class="free">ac</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms triangle_diff_paths <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(*context MinkowskiPrimitive*)</span>
<span class="keyword1"><span class="command">context</span></span> MinkowskiBetweenness <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="TemporalOrderOnPath-abc_ex_path_unique"><span class="command">lemma</span></span> abc_ex_path_unique<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> abc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃!</span><span class="bound"><span class="bound">Q</span></span><span class="main">∈</span><span class="free">𝒫</span><span class="main">.</span> <span class="free">a</span> <span class="main">∈</span> <span class="bound">Q</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">∈</span> <span class="bound">Q</span> <span class="main">∧</span> <span class="free">c</span> <span class="main">∈</span> <span class="bound">Q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> a_neq_c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> abc_ac_neq abc <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">Q</span><span class="main">∈</span><span class="free">𝒫</span><span class="main">.</span> <span class="free">a</span> <span class="main">∈</span> <span class="bound">Q</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">∈</span> <span class="bound">Q</span> <span class="main">∧</span> <span class="free">c</span> <span class="main">∈</span> <span class="bound">Q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> abc_ex_path abc <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">P</span></span> <span class="skolem"><span class="skolem">Q</span></span> <span class="keyword2"><span class="keyword">where</span></span> path_P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">∈</span> <span class="free">𝒫</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> abc_inP<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="skolem">P</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">∈</span> <span class="skolem">P</span> <span class="main">∧</span> <span class="free">c</span> <span class="main">∈</span> <span class="skolem">P</span>"</span></span>
                    <span class="keyword2"><span class="keyword">and</span></span> path_Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="main">∈</span> <span class="free">𝒫</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> abc_in_Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="skolem">Q</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">∈</span> <span class="skolem">Q</span> <span class="main">∧</span> <span class="free">c</span> <span class="main">∈</span> <span class="skolem">Q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">=</span> <span class="skolem">Q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a_neq_c eq_paths <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> eq_paths a_neq_c <span class="keyword1"><span class="command">using</span></span> abc_inP path_P <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="TemporalOrderOnPath-betw_c_in_path"><span class="command">lemma</span></span> betw_c_in_path<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> abc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> path_ab<span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="free">ab</span> <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">∈</span> <span class="free">ab</span>"</span></span>
<span class="comment1">(* By abc_ex_path, there is a path through a b c. By eq_paths there can be only one, which must be ab. *)</span>
<span class="keyword1"><span class="command">using</span></span> eq_paths abc_ex_path assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="TemporalOrderOnPath-betw_b_in_path"><span class="command">lemma</span></span> betw_b_in_path<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> abc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> path_ab<span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="free">ac</span> <span class="free">a</span> <span class="free">c</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> <span class="free">ac</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms abc_ex_path_unique path_unique <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="TemporalOrderOnPath-betw_a_in_path"><span class="command">lemma</span></span> betw_a_in_path<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> abc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> path_ab<span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="free">bc</span> <span class="free">b</span> <span class="free">c</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">bc</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms abc_ex_path_unique path_unique <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="TemporalOrderOnPath-triangle_not_betw_abc"><span class="command">lemma</span></span> triangle_not_betw_abc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> tri_abc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">△</span> <span class="free">a</span> <span class="free">b</span> <span class="free">c</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> tri_abc abc_ex_path triangle_diff_paths <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="TemporalOrderOnPath-triangle_not_betw_acb"><span class="command">lemma</span></span> triangle_not_betw_acb<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> tri_abc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">△</span> <span class="free">a</span> <span class="free">b</span> <span class="free">c</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">c</span> <span class="free">b</span><span class="main"><span class="free">]]</span></span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tri_abc triangle_not_betw_abc triangle_permutes<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1" id="TemporalOrderOnPath-triangle_not_betw_bac"><span class="command">lemma</span></span> triangle_not_betw_bac<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> tri_abc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">△</span> <span class="free">a</span> <span class="free">b</span> <span class="free">c</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main"><span class="free">[[</span></span><span class="free">b</span> <span class="free">a</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tri_abc triangle_not_betw_abc triangle_permutes<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1" id="TemporalOrderOnPath-triangle_not_betw_any"><span class="command">lemma</span></span> triangle_not_betw_any<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> tri_abc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">△</span> <span class="free">a</span> <span class="free">b</span> <span class="free">c</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">d</span><span class="main">∈</span><span class="main">{</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">,</span><span class="free">c</span><span class="main">}</span><span class="main">.</span> <span class="main">∃</span><span class="bound">e</span><span class="main">∈</span><span class="main">{</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">,</span><span class="free">c</span><span class="main">}</span><span class="main">.</span> <span class="main">∃</span><span class="bound">f</span><span class="main">∈</span><span class="main">{</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">,</span><span class="free">c</span><span class="main">}</span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="bound">d</span> <span class="bound">e</span> <span class="bound">f</span><span class="main"><span class="free">]]</span></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> abc_ex_path abc_abc_neq empty_iff insertE tri_abc triangle_diff_paths<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(*context MinkowskiBetweenness*)</span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"3.2 First collinearity theorem"</span></span>

<span class="keyword1"><span class="command">theorem</span></span> <span class="comment1">(*3*)</span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> MinkowskiChain<span class="main">)</span> collinearity_alt2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> tri_abc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">△</span> <span class="free">a</span> <span class="free">b</span> <span class="free">c</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> path_de<span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="free">de</span> <span class="free">d</span> <span class="free">e</span>"</span></span>
      <span class="comment1">(* This follows immediately from tri_abc without it as an assumption, but we need ab in scope
         to refer to it in the conclusion. *)</span>
      <span class="keyword2"><span class="keyword">and</span></span> path_ab<span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="free">ab</span> <span class="free">a</span> <span class="free">b</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> bcd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">b</span> <span class="free">c</span> <span class="free">d</span><span class="main"><span class="free">]]</span></span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> cea<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">c</span> <span class="free">e</span> <span class="free">a</span><span class="main"><span class="free">]]</span></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">f</span><span class="main">∈</span><span class="free">de</span><span class="main">∩</span><span class="free">ab</span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="bound">f</span> <span class="free">b</span><span class="main"><span class="free">]]</span></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">f</span><span class="main">∈</span><span class="free">ab</span> <span class="main">∩</span> <span class="free">de</span><span class="main">.</span> <span class="main">∃</span><span class="bound">X</span><span class="main">.</span> <span class="main">[[</span><span class="free">a</span><span class="main">..</span><span class="bound">f</span><span class="main">..</span><span class="free">b</span><span class="main">]</span><span class="bound">X</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path_ex <span class="free">a</span> <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> tri_abc triangle_paths<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ac</span></span> <span class="keyword2"><span class="keyword">where</span></span> path_ac<span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="skolem">ac</span> <span class="free">a</span> <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path_ex <span class="free">b</span> <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> tri_abc triangle_paths<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">bc</span></span> <span class="keyword2"><span class="keyword">where</span></span> path_bc<span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="skolem">bc</span> <span class="free">b</span> <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> ab_neq_ac<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ab</span> <span class="main">≠</span> <span class="skolem">ac</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> triangle_paths_neq path_ab path_ac tri_abc <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">have</span></span> ab_neq_bc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ab</span> <span class="main">≠</span> <span class="skolem">bc</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> eq_paths ab_neq_ac path_ab path_ac path_bc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> ac_neq_bc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ac</span> <span class="main">≠</span> <span class="skolem">bc</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> eq_paths ab_neq_bc path_ab path_ac path_bc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> d_in_bc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">∈</span> <span class="skolem">bc</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bcd betw_c_in_path path_bc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> e_in_ac<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">∈</span> <span class="skolem">ac</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> betw_b_in_path cea path_ac <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> O6 <span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> Q <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">ab</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> R <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">ac</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> S <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">bc</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> T <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">de</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> a <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">a</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> b <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">b</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> c <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">c</span></span><span class="main">]</span> 
            ab_neq_ac ab_neq_bc ac_neq_bc path_ab path_bc path_ac path_de bcd cea d_in_bc e_in_ac
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> finite_chain3_betw <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">theorem</span></span> <span class="comment1">(*3*)</span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> MinkowskiChain<span class="main">)</span> collinearity_alt<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> tri_abc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">△</span> <span class="free">a</span> <span class="free">b</span> <span class="free">c</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> path_de<span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="free">de</span> <span class="free">d</span> <span class="free">e</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> bcd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">b</span> <span class="free">c</span> <span class="free">d</span><span class="main"><span class="free">]]</span></span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> cea<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">c</span> <span class="free">e</span> <span class="free">a</span><span class="main"><span class="free">]]</span></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ab</span><span class="main">.</span> path <span class="bound">ab</span> <span class="free">a</span> <span class="free">b</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">f</span><span class="main">∈</span><span class="free">de</span><span class="main">∩</span><span class="bound">ab</span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="bound">f</span> <span class="free">b</span><span class="main"><span class="free">]]</span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> ex_path_ab<span class="main">:</span> <span class="quoted"><span class="quoted">"path_ex <span class="free">a</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> tri_abc triangle_paths_unique <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ab</span></span> <span class="keyword2"><span class="keyword">where</span></span> path_ab<span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="skolem">ab</span> <span class="free">a</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">f</span><span class="main">∈</span><span class="skolem">ab</span> <span class="main">∩</span> <span class="free">de</span><span class="main">.</span> <span class="main">∃</span><span class="bound">X</span><span class="main">.</span> <span class="main">[[</span><span class="free">a</span><span class="main">..</span><span class="bound">f</span><span class="main">..</span><span class="free">b</span><span class="main">]</span><span class="bound">X</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path_ex <span class="free">a</span> <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> tri_abc triangle_paths<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ac</span></span> <span class="keyword2"><span class="keyword">where</span></span> path_ac<span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="skolem">ac</span> <span class="free">a</span> <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path_ex <span class="free">b</span> <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> tri_abc triangle_paths<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">bc</span></span> <span class="keyword2"><span class="keyword">where</span></span> path_bc<span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="skolem">bc</span> <span class="free">b</span> <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> ab_neq_ac<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ab</span> <span class="main">≠</span> <span class="skolem">ac</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> triangle_paths_neq path_ab path_ac tri_abc <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">have</span></span> ab_neq_bc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ab</span> <span class="main">≠</span> <span class="skolem">bc</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> eq_paths ab_neq_ac path_ab path_ac path_bc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> ac_neq_bc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ac</span> <span class="main">≠</span> <span class="skolem">bc</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> eq_paths ab_neq_bc path_ab path_ac path_bc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> d_in_bc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">∈</span> <span class="skolem">bc</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bcd betw_c_in_path path_bc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> e_in_ac<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">∈</span> <span class="skolem">ac</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> betw_b_in_path cea path_ac <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> O6 <span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> Q <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">ab</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> R <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">ac</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> S <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">bc</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> T <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">de</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> a <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">a</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> b <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">b</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> c <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">c</span></span><span class="main">]</span> 
            ab_neq_ac ab_neq_bc ac_neq_bc path_ab path_bc path_ac path_de bcd cea d_in_bc e_in_ac
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> finite_chain3_betw path_ab <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">theorem</span></span> <span class="comment1">(*3*)</span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> MinkowskiChain<span class="main">)</span> collinearity<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> tri_abc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">△</span> <span class="free">a</span> <span class="free">b</span> <span class="free">c</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> path_de<span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="free">de</span> <span class="free">d</span> <span class="free">e</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> bcd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">b</span> <span class="free">c</span> <span class="free">d</span><span class="main"><span class="free">]]</span></span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> cea<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">c</span> <span class="free">e</span> <span class="free">a</span><span class="main"><span class="free">]]</span></span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">f</span><span class="main">∈</span><span class="free">de</span><span class="main">∩</span><span class="main">(</span>path_of <span class="free">a</span> <span class="free">b</span><span class="main">)</span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="bound">f</span> <span class="free">b</span><span class="main"><span class="free">]]</span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ab</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"path_of <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> path_ab<span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="var">?ab</span> <span class="free">a</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> tri_abc theI' <span class="main">[</span><span class="operator">OF</span> triangle_paths_unique<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">f</span><span class="main">∈</span><span class="var">?ab</span> <span class="main">∩</span> <span class="free">de</span><span class="main">.</span> <span class="main">∃</span><span class="bound">X</span><span class="main">.</span> <span class="main">[[</span><span class="free">a</span><span class="main">..</span><span class="bound">f</span><span class="main">..</span><span class="free">b</span><span class="main">]</span><span class="bound">X</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path_ex <span class="free">a</span> <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> tri_abc triangle_paths<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ac</span></span> <span class="keyword2"><span class="keyword">where</span></span> path_ac<span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="skolem">ac</span> <span class="free">a</span> <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path_ex <span class="free">b</span> <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> tri_abc triangle_paths<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">bc</span></span> <span class="keyword2"><span class="keyword">where</span></span> path_bc<span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="skolem">bc</span> <span class="free">b</span> <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> ab_neq_ac<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?ab</span> <span class="main">≠</span> <span class="skolem">ac</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> triangle_paths_neq path_ab path_ac tri_abc <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">have</span></span> ab_neq_bc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?ab</span> <span class="main">≠</span> <span class="skolem">bc</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> eq_paths ab_neq_ac path_ab path_ac path_bc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> ac_neq_bc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ac</span> <span class="main">≠</span> <span class="skolem">bc</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> eq_paths ab_neq_bc path_ab path_ac path_bc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> d_in_bc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">∈</span> <span class="skolem">bc</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bcd betw_c_in_path path_bc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> e_in_ac<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">∈</span> <span class="skolem">ac</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> betw_b_in_path cea path_ac <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> O6 <span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> Q <span class="main"><span class="main">=</span></span> <span class="var"><span class="quoted"><span class="var">?ab</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> R <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">ac</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> S <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">bc</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> T <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">de</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> a <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">a</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> b <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">b</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> c <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">c</span></span><span class="main">]</span> 
            ab_neq_ac ab_neq_bc ac_neq_bc path_ab path_bc path_ac path_de bcd cea d_in_bc e_in_ac
            IntI Int_commute
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> finite_chain3_betw <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Additional results for Paths and Unreachables"</span></span>

<span class="keyword1"><span class="command">context</span></span> MinkowskiPrimitive <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The degenerate case.›</span></span>
<span class="keyword1" id="TemporalOrderOnPath-big_bang"><span class="command">lemma</span></span> big_bang<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> no_paths<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">𝒫</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span><span class="main">.</span> <span class="free">ℰ</span> <span class="main">=</span> <span class="main">{</span><span class="bound">a</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">ℰ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> nonempty_events <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> a_event<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">ℰ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">b</span><span class="main">∈</span><span class="free">ℰ</span><span class="main">.</span> <span class="bound">b</span> <span class="main">≠</span> <span class="skolem">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> notI<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">b</span><span class="main">∈</span><span class="free">ℰ</span><span class="main">.</span> <span class="bound">b</span> <span class="main">≠</span> <span class="skolem">a</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">Q</span><span class="main">.</span> <span class="bound">Q</span> <span class="main">∈</span> <span class="free">𝒫</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> events_paths a_event <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> no_paths <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">b</span><span class="main">∈</span><span class="free">ℰ</span><span class="main">.</span> <span class="bound">b</span> <span class="main">=</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> a_event <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="TemporalOrderOnPath-two_events_then_path"><span class="command">lemma</span></span> two_events_then_path<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> two_events<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span><span class="main">∈</span><span class="free">ℰ</span><span class="main">.</span> <span class="main">∃</span><span class="bound">b</span><span class="main">∈</span><span class="free">ℰ</span><span class="main">.</span> <span class="bound">a</span> <span class="main">≠</span> <span class="bound">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">Q</span><span class="main">.</span> <span class="bound">Q</span> <span class="main">∈</span> <span class="free">𝒫</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">a</span><span class="main">.</span> <span class="free">ℰ</span> <span class="main">≠</span> <span class="main">{</span><span class="bound">a</span><span class="main">}</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">𝒫</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> big_bang <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒫</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> two_events <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="TemporalOrderOnPath-paths_are_events"><span class="command">lemma</span></span> paths_are_events<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">Q</span><span class="main">∈</span><span class="free">𝒫</span><span class="main">.</span> <span class="main">∀</span><span class="bound">a</span><span class="main">∈</span><span class="bound">Q</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">ℰ</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="TemporalOrderOnPath-same_empty_unreach"><span class="command">lemma</span></span> same_empty_unreach<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">Q</span> <span class="main">∈</span> <span class="free">𝒫</span><span class="main">;</span> <span class="free">a</span> <span class="main">∈</span> <span class="free">Q</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">∅</span> <span class="free">Q</span> <span class="free">a</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> unreachable_subset_def<span class="main">)</span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="TemporalOrderOnPath-same_path_reachable"><span class="command">lemma</span></span> same_path_reachable<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">Q</span> <span class="main">∈</span> <span class="free">𝒫</span><span class="main">;</span> <span class="free">a</span> <span class="main">∈</span> <span class="free">Q</span><span class="main">;</span> <span class="free">b</span> <span class="main">∈</span> <span class="free">Q</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">∈</span> <span class="free">Q</span> <span class="main">-</span> <span class="main">∅</span> <span class="free">Q</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> same_empty_unreach<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  If we have two paths crossing and $a$ is on the crossing point, and $b$ is on one of the paths,
  then $a$ is in the reachable part of the path $b$ is on.
›</span></span>

<span class="keyword1" id="TemporalOrderOnPath-same_path_reachable2"><span class="command">lemma</span></span> same_path_reachable2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">Q</span> <span class="main">∈</span> <span class="free">𝒫</span><span class="main">;</span> <span class="free">R</span> <span class="main">∈</span> <span class="free">𝒫</span><span class="main">;</span> <span class="free">a</span> <span class="main">∈</span> <span class="free">Q</span><span class="main">;</span> <span class="free">a</span> <span class="main">∈</span> <span class="free">R</span><span class="main">;</span> <span class="free">b</span> <span class="main">∈</span> <span class="free">Q</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">-</span> <span class="main">∅</span> <span class="free">R</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> unreachable_subset_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="comment1">(* This will never be used without R ∈ 𝒫 but we might as well leave it off as the proof doesn't
   need it. *)</span>
<span class="keyword1" id="TemporalOrderOnPath-cross_in_reachable"><span class="command">lemma</span></span> cross_in_reachable<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> path_Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">∈</span> <span class="free">𝒫</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> a_inQ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">Q</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> b_inQ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> <span class="free">Q</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> b_inR<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">-</span> <span class="main">∅</span> <span class="free">R</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> unreachable_subset_def <span class="keyword1"><span class="command">using</span></span> a_inQ b_inQ b_inR path_Q <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="TemporalOrderOnPath-reachable_path"><span class="command">lemma</span></span> reachable_path<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> path_Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">∈</span> <span class="free">𝒫</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> b_event<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> <span class="free">ℰ</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> a_reachable<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">Q</span> <span class="main">-</span> <span class="main">∅</span> <span class="free">Q</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">R</span><span class="main">∈</span><span class="free">𝒫</span><span class="main">.</span> <span class="free">a</span> <span class="main">∈</span> <span class="bound">R</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">∈</span> <span class="bound">R</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> a_inQ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">Q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a_reachable <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">∉</span> <span class="free">𝒫</span> <span class="main">∨</span> <span class="free">b</span> <span class="main">∉</span> <span class="free">ℰ</span> <span class="main">∨</span> <span class="free">b</span> <span class="main">∈</span> <span class="free">Q</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">R</span><span class="main">∈</span><span class="free">𝒫</span><span class="main">.</span> <span class="free">b</span> <span class="main">∈</span> <span class="bound">R</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">∈</span> <span class="bound">R</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> a_reachable unreachable_subset_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> <span class="free">Q</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">R</span><span class="main">∈</span><span class="free">𝒫</span><span class="main">.</span> <span class="free">b</span> <span class="main">∈</span> <span class="bound">R</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">∈</span> <span class="bound">R</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> path_Q b_event <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> disjE<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> <span class="free">Q</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> a_inQ path_Q <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">R</span><span class="main">∈</span><span class="free">𝒫</span><span class="main">.</span> <span class="free">b</span> <span class="main">∈</span> <span class="bound">R</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">∈</span> <span class="bound">R</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> conj_commute <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context MinkowskiPrimitive *)</span>
<span class="keyword1"><span class="command">context</span></span> MinkowskiUnreachable <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  First some basic facts about the primitive notions, which seem to belong here.
  I don't think any/all of these are explicitly proved in Schutz.
›</span></span>

<span class="keyword1" id="TemporalOrderOnPath-no_empty_paths"><span class="command">lemma</span></span> no_empty_paths <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span><span class="main">∈</span><span class="free">𝒫</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span><span class="main">≠</span><span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">∈</span><span class="free">ℰ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> nonempty_events <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">∈</span><span class="free">Q</span> <span class="main">∨</span> <span class="skolem">a</span><span class="main">∉</span><span class="free">Q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">∈</span><span class="free">Q</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">∉</span><span class="free">Q</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">∈</span><span class="main">∅</span> <span class="free">Q</span> <span class="skolem">a</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> two_in_unreach <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∈</span> <span class="free">ℰ</span>›</span></span> assms
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> unreachable_subset_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="TemporalOrderOnPath-events_ex_path"><span class="command">lemma</span></span> events_ex_path<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ge1_path<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">𝒫</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">ℰ</span><span class="main">.</span> <span class="main">∃</span><span class="bound">Q</span><span class="main">∈</span><span class="free">𝒫</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="bound">Q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">assume</span></span> x_event<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">ℰ</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">Q</span><span class="main">.</span> <span class="bound">Q</span> <span class="main">∈</span> <span class="free">𝒫</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ge1_path <span class="keyword1"><span class="command">using</span></span> ex_in_conv <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Q</span></span> <span class="keyword2"><span class="keyword">where</span></span> path_Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="main">∈</span> <span class="free">𝒫</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> <span class="skolem">Q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> no_empty_paths <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> y_inQ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">Q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> y_event<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">ℰ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> in_path_event path_Q <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">P</span><span class="main">∈</span><span class="free">𝒫</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="bound">P</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> y_inQ path_Q <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> events_paths x_event y_event <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">Q</span><span class="main">∈</span><span class="free">𝒫</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="bound">Q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="TemporalOrderOnPath-unreach_ge2_then_ge2"><span class="command">lemma</span></span> unreach_ge2_then_ge2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">∈</span><span class="main">∅</span> <span class="free">Q</span> <span class="free">b</span><span class="main">.</span> <span class="main">∃</span><span class="bound">y</span><span class="main">∈</span><span class="main">∅</span> <span class="free">Q</span> <span class="free">b</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> <span class="bound">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">∈</span><span class="free">Q</span><span class="main">.</span> <span class="main">∃</span><span class="bound">y</span><span class="main">∈</span><span class="free">Q</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> <span class="bound">y</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms unreachable_subset_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  This lemma just proves that the chain obtained to bound the unreachable set of a path
  is indeed on that path. Extends I6; requires Theorem 2; used in Theorem 13.
  Seems to be assumed in Schutz' chain notation in I6.
›</span></span>

<span class="keyword1" id="TemporalOrderOnPath-chain_on_path_I6"><span class="command">lemma</span></span> chain_on_path_I6<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> path_Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span><span class="main">∈</span><span class="free">𝒫</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> event_b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">∉</span><span class="free">Q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">∈</span><span class="free">ℰ</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> unreach<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Q<span class="hidden">⇩</span><sub>x</sub></span> <span class="main">∈</span> <span class="main">∅</span> <span class="free">Q</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q<span class="hidden">⇩</span><sub>z</sub></span> <span class="main">∈</span> <span class="main">∅</span> <span class="free">Q</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q<span class="hidden">⇩</span><sub>x</sub></span> <span class="main">≠</span> <span class="free">Q<span class="hidden">⇩</span><sub>z</sub></span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> X_def<span class="main">:</span> <span class="quoted"><span class="quoted">"ch_by_ord <span class="free">f</span> <span class="free">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">0</span> <span class="main">=</span> <span class="free">Q<span class="hidden">⇩</span><sub>x</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span>card <span class="free">X</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="free">Q<span class="hidden">⇩</span><sub>z</sub></span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span> <span class="main">..</span> card <span class="free">X</span> <span class="main">-</span> <span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">∈</span> <span class="main">∅</span> <span class="free">Q</span> <span class="free">b</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">Q<span class="hidden">⇩</span><sub>y</sub></span><span class="main">∈</span><span class="free">ℰ</span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="bound">i</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="bound">Q<span class="hidden">⇩</span><sub>y</sub></span> <span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span><span class="main"><span class="free">]]</span></span> <span class="main">⟶</span> <span class="bound">Q<span class="hidden">⇩</span><sub>y</sub></span> <span class="main">∈</span> <span class="main">∅</span> <span class="free">Q</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">(</span>short_ch <span class="free">X</span> <span class="main">⟶</span> <span class="free">Q<span class="hidden">⇩</span><sub>x</sub></span><span class="main">∈</span><span class="free">X</span> <span class="main">∧</span> <span class="free">Q<span class="hidden">⇩</span><sub>z</sub></span><span class="main">∈</span><span class="free">X</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">Q<span class="hidden">⇩</span><sub>y</sub></span><span class="main">∈</span><span class="free">ℰ</span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="free">Q<span class="hidden">⇩</span><sub>x</sub></span> <span class="bound">Q<span class="hidden">⇩</span><sub>y</sub></span> <span class="free">Q<span class="hidden">⇩</span><sub>z</sub></span><span class="main"><span class="free">]]</span></span> <span class="main">⟶</span> <span class="bound">Q<span class="hidden">⇩</span><sub>y</sub></span> <span class="main">∈</span> <span class="main">∅</span> <span class="free">Q</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span><span class="main">⊆</span><span class="free">Q</span>"</span></span>
  <span class="comment1">(* by (smt X_def(1) chain_on_path eq_paths in_Q in_X path_Q subset_eq unreach(3)) *)</span>
  <span class="comment1">(* smt has a really easy time of this, but no other method does (legacy code from thm13) *)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> in_Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Q<span class="hidden">⇩</span><sub>x</sub></span><span class="main">∈</span><span class="free">Q</span> <span class="main">∧</span> <span class="free">Q<span class="hidden">⇩</span><sub>z</sub></span><span class="main">∈</span><span class="free">Q</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> unreachable_subset_def unreach<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> fin_X<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> unreach<span class="main">(</span>3<span class="main">)</span> not_less X_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"short_ch <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> X_def<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> in_Q short_ch_def subsetI unreach<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"long_ch_by_ord <span class="free">f</span> <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="free">X</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">i</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> card <span class="free">X</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> asm <span class="keyword1"><span class="command">unfolding</span></span> ch_by_ord_def long_ch_by_ord_def ordering_def
          <span class="keyword1"><span class="command">using</span></span> fin_X <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="free">Q</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="free">Q<span class="hidden">⇩</span><sub>x</sub></span> <span class="main">∨</span> <span class="skolem">x</span><span class="main">=</span><span class="free">Q<span class="hidden">⇩</span><sub>z</sub></span>"</span></span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">using</span></span> in_Q <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="skolem">x</span><span class="main">=</span><span class="free">Q<span class="hidden">⇩</span><sub>x</sub></span> <span class="main">∨</span> <span class="skolem">x</span><span class="main">=</span><span class="free">Q<span class="hidden">⇩</span><sub>z</sub></span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">≠</span><span class="free">Q<span class="hidden">⇩</span><sub>x</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">≠</span><span class="free">Q<span class="hidden">⇩</span><sub>z</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span><span class="main"><span class="keyword3">+</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> X_def<span class="main">(</span>2<span class="main">)</span> <span class="quoted"><span class="quoted">`<span class="skolem">x</span><span class="main">≠</span><span class="free">Q<span class="hidden">⇩</span><sub>x</sub></span>`</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="skolem">i</span> <span class="main">=</span> <span class="skolem">x</span>›</span></span> gr_zeroI <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">&lt;</span>card <span class="free">X</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> X_def<span class="main">(</span>3<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="skolem">i</span> <span class="main">=</span> <span class="skolem">x</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">&lt;</span> card <span class="free">X</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≠</span> <span class="free">Q<span class="hidden">⇩</span><sub>z</sub></span>›</span></span> less_imp_diff_less less_SucE
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_pred' cancel_comm_monoid_add_class.diff_cancel<span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">Q<span class="hidden">⇩</span><sub>x</sub></span> <span class="main">(</span><span class="free">f</span> <span class="skolem">i</span><span class="main">)</span> <span class="free">Q<span class="hidden">⇩</span><sub>z</sub></span><span class="main"><span class="free">]]</span></span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> X_def<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">i</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">&lt;</span> card <span class="free">X</span> <span class="main">-</span> <span class="main">1</span>›</span></span> asm fin_X order_finite_chain
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="skolem">i</span> <span class="main">=</span> <span class="skolem">x</span>›</span></span> betw_b_in_path in_Q path_Q unreach<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> X_def<span class="main">(</span>1<span class="main">)</span> ch_by_ord_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context MinkowskiUnreachable *)</span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Results about Paths as Sets"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Note several of the following don't need MinkowskiPrimitive, they are just Set lemmas;
  nevertheless I'm naming them and writing them this way for clarity.
›</span></span>

<span class="keyword1"><span class="command">context</span></span> MinkowskiPrimitive <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="TemporalOrderOnPath-distinct_paths"><span class="command">lemma</span></span> distinct_paths<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">∈</span> <span class="free">𝒫</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">∈</span> <span class="free">𝒫</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">∉</span> <span class="free">Q</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">∈</span> <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">≠</span> <span class="free">Q</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="TemporalOrderOnPath-distinct_paths2"><span class="command">lemma</span></span> distinct_paths2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">∈</span> <span class="free">𝒫</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">∈</span> <span class="free">𝒫</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">d</span><span class="main">.</span> <span class="bound">d</span> <span class="main">∉</span> <span class="free">Q</span> <span class="main">∧</span> <span class="bound">d</span> <span class="main">∈</span> <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">≠</span> <span class="free">Q</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="TemporalOrderOnPath-external_events_neq"><span class="command">lemma</span></span> external_events_neq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">Q</span> <span class="main">∈</span> <span class="free">𝒫</span><span class="main">;</span> <span class="free">a</span> <span class="main">∈</span> <span class="free">Q</span><span class="main">;</span> <span class="free">b</span> <span class="main">∈</span> <span class="free">ℰ</span><span class="main">;</span> <span class="free">b</span> <span class="main">∉</span> <span class="free">Q</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="TemporalOrderOnPath-notin_cross_events_neq"><span class="command">lemma</span></span> notin_cross_events_neq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">Q</span> <span class="main">∈</span> <span class="free">𝒫</span><span class="main">;</span> <span class="free">R</span> <span class="main">∈</span> <span class="free">𝒫</span><span class="main">;</span> <span class="free">Q</span> <span class="main">≠</span> <span class="free">R</span><span class="main">;</span> <span class="free">a</span> <span class="main">∈</span> <span class="free">Q</span><span class="main">;</span> <span class="free">b</span> <span class="main">∈</span> <span class="free">R</span><span class="main">;</span> <span class="free">a</span> <span class="main">∉</span> <span class="free">R</span><span class="main">∩</span><span class="free">Q</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="TemporalOrderOnPath-nocross_events_neq"><span class="command">lemma</span></span> nocross_events_neq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">Q</span> <span class="main">∈</span> <span class="free">𝒫</span><span class="main">;</span> <span class="free">R</span> <span class="main">∈</span> <span class="free">𝒫</span><span class="main">;</span> <span class="free">a</span> <span class="main">∈</span> <span class="free">Q</span><span class="main">;</span> <span class="free">b</span> <span class="main">∈</span> <span class="free">R</span><span class="main">;</span> <span class="free">R</span><span class="main">∩</span><span class="free">Q</span> <span class="main">=</span> <span class="main">{}</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Given a nonempty path $Q$, and an external point $d$, we can find another path
  $R$ passing through $d$ (by I2 aka <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>events_paths›</span></span></span></span>). This path is distinct
  from $Q$, as it passes through a point external to it.
›</span></span>
<span class="keyword1" id="TemporalOrderOnPath-external_path"><span class="command">lemma</span></span> external_path<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> path_Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">∈</span> <span class="free">𝒫</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> a_inQ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">Q</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> d_notinQ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">∉</span> <span class="free">Q</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> d_event<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">∈</span> <span class="free">ℰ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">R</span><span class="main">∈</span><span class="free">𝒫</span><span class="main">.</span> <span class="free">d</span> <span class="main">∈</span> <span class="bound">R</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> a_neq_d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a_inQ d_notinQ <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">R</span><span class="main">∈</span><span class="free">𝒫</span><span class="main">.</span> <span class="free">d</span> <span class="main">∈</span> <span class="bound">R</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> events_paths <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> a_inQ d_event in_path_event path_Q<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="TemporalOrderOnPath-distinct_path"><span class="command">lemma</span></span> distinct_path<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">∈</span> <span class="free">𝒫</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">Q</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">∉</span> <span class="free">Q</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">∈</span> <span class="free">ℰ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">R</span><span class="main">∈</span><span class="free">𝒫</span><span class="main">.</span> <span class="bound">R</span> <span class="main">≠</span> <span class="free">Q</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms external_path <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword1" id="TemporalOrderOnPath-external_distinct_path"><span class="command">lemma</span></span> external_distinct_path<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">∈</span> <span class="free">𝒫</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">Q</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">∉</span> <span class="free">Q</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">∈</span> <span class="free">ℰ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">R</span><span class="main">∈</span><span class="free">𝒫</span><span class="main">.</span> <span class="bound">R</span> <span class="main">≠</span> <span class="free">Q</span> <span class="main">∧</span> <span class="free">d</span> <span class="main">∈</span> <span class="bound">R</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms external_path <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context MinkowskiPrimitive *)</span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"3.3 Boundedness of the unreachable set"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Theorem 4 (boundedness of the unreachable set)›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The same assumptions as I7, different conclusion.
  This doesn't just give us boundedness, it gives us another event outside of the unreachable
  set, as long as we have one already.
  I7 conclusion:  <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>∃X Q0 Qm Qn. [[Q0 .. Qm .. Qn]X] ∧ Q0 = ?Qx ∧ Qm = ?Qy ∧ Qn ∈ ?Q - ∅ ?Q ?b›</span></span></span></span>
›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> <span class="comment1">(*4*)</span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> MinkowskiUnreachable<span class="main">)</span> unreachable_set_bounded<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> path_Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">∈</span> <span class="free">𝒫</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> b_nin_Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∉</span> <span class="free">Q</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> b_event<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> <span class="free">ℰ</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> Qx_reachable<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Qx</span> <span class="main">∈</span> <span class="free">Q</span> <span class="main">-</span> <span class="main">∅</span> <span class="free">Q</span> <span class="free">b</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> Qy_unreachable<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Qy</span> <span class="main">∈</span> <span class="main">∅</span> <span class="free">Q</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">Qz</span><span class="main">∈</span><span class="free">Q</span> <span class="main">-</span> <span class="main">∅</span> <span class="free">Q</span> <span class="free">b</span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="free">Qx</span> <span class="free">Qy</span> <span class="bound">Qz</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="free">Qx</span> <span class="main">≠</span> <span class="bound">Qz</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms I7 order_finite_chain fin_long_chain_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fin_ch_betw<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Theorem 5 (first existence theorem)›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The lemma below is used in the contradiction in <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>external_event›</span></span></span></span>,
  which is the essential part to Theorem 5(i).
›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> MinkowskiUnreachable<span class="main">)</span> only_one_path<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> path_Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">∈</span> <span class="free">𝒫</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> all_inQ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">∈</span><span class="free">ℰ</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">Q</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> path_R<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">∈</span> <span class="free">𝒫</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">=</span> <span class="free">Q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">R</span> <span class="main">=</span> <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> R_neq_Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">≠</span> <span class="free">Q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">ℰ</span> <span class="main">=</span> <span class="free">Q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> all_inQ antisym path_Q path_sub_events subsetI<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span><span class="main">⊂</span><span class="free">Q</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> R_neq_Q path_R path_sub_events <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">∉</span><span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">∈</span><span class="free">Q</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">R</span> <span class="main">⊂</span> <span class="free">Q</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"path <span class="free">R</span> <span class="skolem">a</span> <span class="skolem">b</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">ℰ</span> <span class="main">=</span> <span class="free">Q</span>›</span></span> path_R two_in_unreach unreach_ge2_then_ge2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">∈</span><span class="free">Q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">∈</span><span class="free">Q</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">ℰ</span> <span class="main">=</span> <span class="free">Q</span>›</span></span> <span class="quoted"><span class="quoted">‹path <span class="free">R</span> <span class="skolem">a</span> <span class="skolem">b</span>›</span></span> in_path_event <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> eq_paths
    <span class="keyword1"><span class="command">using</span></span> R_neq_Q <span class="quoted"><span class="quoted">‹path <span class="free">R</span> <span class="skolem">a</span> <span class="skolem">b</span>›</span></span> path_Q <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">context</span></span> MinkowskiSpacetime <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Unfortunately, we cannot assume that a path exists without the axiom of dimension.›</span></span>
<span class="keyword1" id="TemporalOrderOnPath-external_event"><span class="command">lemma</span></span> external_event<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> path_Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">∈</span> <span class="free">𝒫</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">d</span><span class="main">∈</span><span class="free">ℰ</span><span class="main">.</span> <span class="bound">d</span> <span class="main">∉</span> <span class="free">Q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">d</span><span class="main">∈</span><span class="free">ℰ</span><span class="main">.</span> <span class="bound">d</span> <span class="main">∉</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> all_inQ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">d</span><span class="main">∈</span><span class="free">ℰ</span><span class="main">.</span> <span class="bound">d</span> <span class="main">∈</span> <span class="free">Q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> only_one_path<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">P</span><span class="main">∈</span><span class="free">𝒫</span><span class="main">.</span> <span class="bound">P</span> <span class="main">=</span> <span class="free">Q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> only_one_path path_Q<span class="main">)</span> 
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> ex_3SPRAY three_SPRAY_ge4 four_paths <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Now we can prove the first part of the theorem's conjunction.
  This follows pretty much exactly the same pattern as the book, except it relies on more
  intermediate lemmas.
›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> <span class="comment1">(*5i*)</span> ge2_events<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> path_Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">∈</span> <span class="free">𝒫</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> a_inQ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">Q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">b</span><span class="main">∈</span><span class="free">Q</span><span class="main">.</span> <span class="bound">b</span> <span class="main">≠</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> d_notinQ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">d</span><span class="main">∈</span><span class="free">ℰ</span><span class="main">.</span> <span class="bound">d</span> <span class="main">∉</span> <span class="free">Q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> path_Q external_event <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">∈</span> <span class="free">ℰ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">∉</span> <span class="free">Q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> two_in_unreach <span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> Q <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">Q</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> b <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">d</span></span><span class="main">]</span> path_Q unreach_ge2_then_ge2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Simple corollary which is easier to use when we don't have one event on a path yet.
  Anything which uses this implicitly used <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>no_empty_paths›</span></span></span></span> on top of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ge2_events›</span></span></span></span>.
›</span></span>
<span class="keyword1" id="TemporalOrderOnPath-ge2_events_lax"><span class="command">lemma</span></span> ge2_events_lax<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> path_Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">∈</span> <span class="free">𝒫</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span><span class="main">∈</span><span class="free">Q</span><span class="main">.</span> <span class="main">∃</span><span class="bound">b</span><span class="main">∈</span><span class="free">Q</span><span class="main">.</span> <span class="bound">a</span> <span class="main">≠</span> <span class="bound">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span><span class="main">∈</span><span class="free">ℰ</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">Q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> path_Q no_empty_paths <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> ex_in_conv in_path_event<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> path_Q ge2_events <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="TemporalOrderOnPath-ex_crossing_path"><span class="command">lemma</span></span> ex_crossing_path<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> path_Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">∈</span> <span class="free">𝒫</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">R</span><span class="main">∈</span><span class="free">𝒫</span><span class="main">.</span> <span class="bound">R</span> <span class="main">≠</span> <span class="free">Q</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">c</span><span class="main">.</span> <span class="bound">c</span> <span class="main">∈</span> <span class="bound">R</span> <span class="main">∧</span> <span class="bound">c</span> <span class="main">∈</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> a_inQ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">Q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ge2_events_lax path_Q <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> d_event<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">∈</span> <span class="free">ℰ</span>"</span></span>
             <span class="keyword2"><span class="keyword">and</span></span> d_notinQ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">∉</span> <span class="free">Q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> external_event path_Q <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≠</span> <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a_inQ <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ex_through_d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">R</span><span class="main">∈</span><span class="free">𝒫</span><span class="main">.</span> <span class="main">∃</span><span class="bound">S</span><span class="main">∈</span><span class="free">𝒫</span><span class="main">.</span> <span class="skolem">a</span> <span class="main">∈</span> <span class="bound">R</span> <span class="main">∧</span> <span class="skolem">d</span> <span class="main">∈</span> <span class="bound">S</span> <span class="main">∧</span> <span class="bound">R</span> <span class="main">∩</span> <span class="bound">S</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> events_paths <span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> a <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> b <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">d</span></span><span class="main">]</span>
            path_Q a_inQ in_path_event d_event <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">R</span></span> <span class="skolem"><span class="skolem">S</span></span> <span class="keyword2"><span class="keyword">where</span></span> path_R<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="main">∈</span> <span class="free">𝒫</span>"</span></span>
                    <span class="keyword2"><span class="keyword">and</span></span> path_S<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">∈</span> <span class="free">𝒫</span>"</span></span>
                    <span class="keyword2"><span class="keyword">and</span></span> a_inR<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="skolem">R</span>"</span></span>
                    <span class="keyword2"><span class="keyword">and</span></span> d_inS<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">∈</span> <span class="skolem">S</span>"</span></span>
                    <span class="keyword2"><span class="keyword">and</span></span> R_crosses_S<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="main">∩</span> <span class="skolem">S</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> S_neq_Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">≠</span> <span class="free">Q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> d_notinQ d_inS <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="main">=</span> <span class="free">Q</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">∩</span> <span class="skolem">S</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> R_crosses_S <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> S_neq_Q path_S <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="main">≠</span> <span class="free">Q</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> a_inQ a_inR path_R <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  If we have two paths $Q$ and $R$ with $a$ on $Q$ and $b$ at the intersection of $Q$ and $R$, then by
  <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>two_in_unreach›</span></span></span></span> (I5) and Theorem 4 (boundedness of the unreachable set), there is an unreachable
  set from $a$ on one side of $b$ on $R$, and on the other side of that there is an event which is
  reachable from $a$ by some path, which is the path we want.
›</span></span>

<span class="keyword1" id="TemporalOrderOnPath-path_past_unreach"><span class="command">lemma</span></span> path_past_unreach<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> path_Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">∈</span> <span class="free">𝒫</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> path_R<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">∈</span> <span class="free">𝒫</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> a_inQ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">Q</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> b_inQ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> <span class="free">Q</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> b_inR<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> <span class="free">R</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> Q_neq_R<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">≠</span> <span class="free">R</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> a_neq_b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">S</span><span class="main">∈</span><span class="free">𝒫</span><span class="main">.</span> <span class="bound">S</span> <span class="main">≠</span> <span class="free">Q</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">∈</span> <span class="bound">S</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">c</span><span class="main">.</span> <span class="bound">c</span> <span class="main">∈</span> <span class="bound">S</span> <span class="main">∧</span> <span class="bound">c</span> <span class="main">∈</span> <span class="free">R</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> d_event<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">∈</span> <span class="free">ℰ</span>"</span></span>
             <span class="keyword2"><span class="keyword">and</span></span> d_notinR<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">∉</span> <span class="free">R</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> external_event path_R <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> b_reachable<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">-</span> <span class="main">∅</span> <span class="free">R</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> cross_in_reachable path_R a_inQ b_inQ b_inR path_Q <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> a_notinR<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∉</span> <span class="free">R</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> cross_once_notin
                               Q_neq_R a_inQ a_neq_b b_inQ b_inR path_Q path_R <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> <span class="main">∅</span> <span class="free">R</span> <span class="free">a</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> two_in_unreach a_inQ in_path_event path_Q path_R <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> c_reachable<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">-</span> <span class="main">∅</span> <span class="free">R</span> <span class="free">a</span>"</span></span>
                  <span class="keyword2"><span class="keyword">and</span></span> c_neq_b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≠</span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> unreachable_set_bounded
                                        <span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> Q <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">R</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> Qx <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">b</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> b <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">a</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> Qy <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">u</span></span><span class="main">]</span>
                                        path_R d_event d_notinR
      <span class="keyword1"><span class="command">using</span></span> a_inQ a_notinR b_reachable in_path_event path_Q <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">S</span></span> <span class="keyword2"><span class="keyword">where</span></span> S_facts<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">∈</span> <span class="free">𝒫</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">∈</span> <span class="skolem">S</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">c</span> <span class="main">∈</span> <span class="skolem">S</span> <span class="main">∧</span> <span class="skolem">c</span> <span class="main">∈</span> <span class="free">R</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> reachable_path
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Diff_iff a_inQ in_path_event path_Q path_R<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">≠</span> <span class="free">Q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Q_neq_R b_inQ b_inR c_neq_b eq_paths path_R <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> S_facts <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> <span class="comment1">(*5ii*)</span> ex_crossing_at<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> path_Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">∈</span> <span class="free">𝒫</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> a_inQ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">Q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ac</span><span class="main">∈</span><span class="free">𝒫</span><span class="main">.</span> <span class="bound">ac</span> <span class="main">≠</span> <span class="free">Q</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">c</span><span class="main">.</span> <span class="bound">c</span> <span class="main">∉</span> <span class="free">Q</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">∈</span> <span class="bound">ac</span> <span class="main">∧</span> <span class="bound">c</span> <span class="main">∈</span> <span class="bound">ac</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> b_inQ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="free">Q</span>"</span></span>
             <span class="keyword2"><span class="keyword">and</span></span> a_neq_b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a_inQ ge2_events path_Q <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">R</span><span class="main">∈</span><span class="free">𝒫</span><span class="main">.</span> <span class="bound">R</span> <span class="main">≠</span> <span class="free">Q</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">e</span><span class="main">.</span> <span class="bound">e</span> <span class="main">∈</span> <span class="bound">R</span> <span class="main">∧</span> <span class="bound">e</span> <span class="main">∈</span> <span class="free">Q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ex_crossing_path path_Q<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">R</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> path_R<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="main">∈</span> <span class="free">𝒫</span>"</span></span>
                    <span class="keyword2"><span class="keyword">and</span></span> R_neq_Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="main">≠</span> <span class="free">Q</span>"</span></span>
                    <span class="keyword2"><span class="keyword">and</span></span> e_inR<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">∈</span> <span class="skolem">R</span>"</span></span>
                    <span class="keyword2"><span class="keyword">and</span></span> e_inQ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">∈</span> <span class="free">Q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
    <span class="keyword3"><span class="command">assume</span></span> e_eq_a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">=</span> <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">c</span><span class="main">.</span> <span class="bound">c</span> <span class="main">∈</span> <span class="main">∅</span> <span class="skolem">R</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> R_neq_Q a_inQ a_neq_b b_inQ e_inR path_Q path_R
                                    two_in_unreach path_unique in_path_event <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> R_neq_Q e_eq_a e_inR path_Q path_R
                       eq_paths ge2_events_lax <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> e_neq_a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">≠</span> <span class="free">a</span>"</span></span>
    <span class="comment1">(* We know the whole of R isn't unreachable from a because e is on R and both a and e are on Q.
       We also know there is some point after e, and after the unreachable set, which is reachable
       from a (because there are at least two events in the unreachable set, and it is bounded). *)</span>
    <span class="comment1">(* This does follow Schutz, if you unfold the proof for path_past_unreach here, though it's a
       little trickier than Schutz made it seem. *)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">S</span><span class="main">∈</span><span class="free">𝒫</span><span class="main">.</span> <span class="bound">S</span> <span class="main">≠</span> <span class="free">Q</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">∈</span> <span class="bound">S</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">c</span><span class="main">.</span> <span class="bound">c</span> <span class="main">∈</span> <span class="bound">S</span> <span class="main">∧</span> <span class="bound">c</span> <span class="main">∈</span> <span class="skolem">R</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> path_past_unreach
              R_neq_Q a_inQ e_inQ e_inR path_Q path_R <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> R_neq_Q e_inR e_neq_a eq_paths path_Q path_R<span class="main">)</span> 
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* Alternative formulation using the path function *)</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="comment1">(*5ii_alt*)</span> ex_crossing_at_alt<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> path_Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">∈</span> <span class="free">𝒫</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> a_inQ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">Q</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ac</span><span class="main">.</span> <span class="main">∃</span><span class="bound">c</span><span class="main">.</span> path <span class="bound">ac</span> <span class="free">a</span> <span class="bound">c</span> <span class="main">∧</span> <span class="bound">ac</span> <span class="main">≠</span> <span class="free">Q</span> <span class="main">∧</span> <span class="bound">c</span> <span class="main">∉</span> <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> ex_crossing_at assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context MinkowskiSpacetime *)</span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"3.4 Prolongation"</span></span>
<span class="keyword1"><span class="command">context</span></span> MinkowskiSpacetime <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> MinkowskiPrimitive<span class="main">)</span> unreach_on_path<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="main">∅</span> <span class="free">Q</span> <span class="free">b</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">∈</span> <span class="free">Q</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> unreachable_subset_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> MinkowskiUnreachable<span class="main">)</span> unreach_equiv<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">Q</span> <span class="main">∈</span> <span class="free">𝒫</span><span class="main">;</span> <span class="free">R</span> <span class="main">∈</span> <span class="free">𝒫</span><span class="main">;</span> <span class="free">a</span> <span class="main">∈</span> <span class="free">Q</span><span class="main">;</span> <span class="free">b</span> <span class="main">∈</span> <span class="free">R</span><span class="main">;</span> <span class="free">a</span> <span class="main">∈</span> <span class="main">∅</span> <span class="free">Q</span> <span class="free">b</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">b</span> <span class="main">∈</span> <span class="main">∅</span> <span class="free">R</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> unreachable_subset_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">theorem</span></span> <span class="comment1">(*6i*)</span> prolong_betw<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> path_Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">∈</span> <span class="free">𝒫</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> a_inQ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">Q</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> b_inQ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> <span class="free">Q</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> ab_neq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">c</span><span class="main">∈</span><span class="free">ℰ</span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="bound">c</span><span class="main"><span class="free">]]</span></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="skolem"><span class="skolem">ae</span></span> <span class="keyword2"><span class="keyword">where</span></span> e_event<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">∈</span> <span class="free">ℰ</span>"</span></span>
                <span class="keyword2"><span class="keyword">and</span></span> e_notinQ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">∉</span> <span class="free">Q</span>"</span></span>
                <span class="keyword2"><span class="keyword">and</span></span> path_ae<span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="skolem">ae</span> <span class="free">a</span> <span class="skolem">e</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ex_crossing_at a_inQ path_Q in_path_event <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∉</span> <span class="skolem">ae</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a_inQ ab_neq b_inQ e_notinQ eq_paths path_Q path_ae <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> f_unreachable<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="main">∅</span> <span class="skolem">ae</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> two_in_unreach b_inQ in_path_event path_Q path_ae <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> b_unreachable<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> <span class="main">∅</span> <span class="free">Q</span> <span class="skolem">f</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> unreach_equiv
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> CollectD b_inQ path_Q unreachable_subset_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> a_reachable<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">Q</span> <span class="main">-</span> <span class="main">∅</span> <span class="free">Q</span> <span class="skolem">f</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> same_path_reachable2 <span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> Q <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">ae</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> R <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">Q</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> a <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">a</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> b <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">f</span></span><span class="main">]</span>
            path_ae a_inQ path_Q f_unreachable unreach_on_path <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> unreachable_set_bounded <span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> Qy <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">b</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> Q <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">Q</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> b <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> Qx <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">a</span></span><span class="main">]</span>
            b_unreachable unreachable_subset_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> MinkowskiSpacetime<span class="main">)</span> prolong_betw2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> path_Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">∈</span> <span class="free">𝒫</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> a_inQ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">Q</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> b_inQ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> <span class="free">Q</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> ab_neq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">c</span><span class="main">∈</span><span class="free">Q</span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="bound">c</span><span class="main"><span class="free">]]</span></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms betw_c_in_path prolong_betw<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> MinkowskiSpacetime<span class="main">)</span> prolong_betw3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> path_Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">∈</span> <span class="free">𝒫</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> a_inQ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">Q</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> b_inQ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> <span class="free">Q</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> ab_neq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">c</span><span class="main">∈</span><span class="free">Q</span><span class="main">.</span> <span class="main">∃</span><span class="bound">d</span><span class="main">∈</span><span class="free">Q</span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="bound">c</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="bound">d</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="bound">c</span><span class="main">≠</span><span class="bound">d</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> abc_abc_neq abc_bcd_abd a_inQ ab_neq b_inQ path_Q prolong_betw2<span class="main">)</span>

<span class="keyword1" id="TemporalOrderOnPath-finite_path_has_ends"><span class="command">lemma</span></span> finite_path_has_ends<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">∈</span> <span class="free">𝒫</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> <span class="free">Q</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"card <span class="free">X</span> <span class="main">≥</span> <span class="numeral">3</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> <span class="main">∃</span><span class="bound">b</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> <span class="bound">a</span> <span class="main">≠</span> <span class="bound">b</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">c</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> <span class="bound">a</span> <span class="main">≠</span> <span class="bound">c</span> <span class="main">∧</span> <span class="bound">b</span> <span class="main">≠</span> <span class="bound">c</span> <span class="main">⟶</span> <span class="main"><span class="free">[[</span></span><span class="bound">a</span> <span class="bound">c</span> <span class="bound">b</span><span class="main"><span class="free">]]</span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"card <span class="free">X</span> <span class="main">-</span> <span class="numeral">3</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">X</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">X</span> <span class="main">=</span> <span class="numeral">3</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> X_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">,</span> <span class="skolem">c</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> card_Suc_eq numeral_3_eq_3<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> abc_neq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≠</span> <span class="skolem">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≠</span> <span class="skolem">c</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">≠</span> <span class="skolem">c</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹card <span class="skolem">X</span> <span class="main">=</span> <span class="numeral">3</span>›</span></span> empty_iff insert_iff order_refl three_in_set3<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">a</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="skolem">c</span> <span class="skolem">a</span> <span class="skolem">b</span><span class="main"><span class="free">]]</span></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> some_betw <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">Q</span></span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="skolem">b</span></span> <span class="quoted"><span class="skolem">c</span></span><span class="main">]</span> <span class="quoted">"0.prems"</span><span class="main">(</span>1<span class="main">)</span> <span class="quoted">"0.prems"</span><span class="main">(</span>2<span class="main">)</span> X_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span><span class="main"><span class="free">]]</span></span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="comment1">― ‹All d not equal to a or c is just d = b, so it immediately follows.›</span>
      <span class="keyword1"><span class="command">using</span></span> X_eq abc_neq<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">a</span><span class="main"><span class="free">]]</span></span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> X_eq abc_neq<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="skolem">c</span> <span class="skolem">a</span> <span class="skolem">b</span><span class="main"><span class="free">]]</span></span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="comment1">(* jep: sledgehammer had trouble with this case without explicitly telling it what
      assumptions to use, for some reason, and even then only one prover figured out "by auto". *)</span>
      <span class="keyword1"><span class="command">using</span></span> X_eq abc_neq<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> IH<span class="main">:</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Y</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> X_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">=</span> insert <span class="skolem">x</span> <span class="skolem">Y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> <span class="skolem">Y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> IH.prems<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> Set.set_insert three_in_set3<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">Y</span> <span class="main">-</span> <span class="numeral">3</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">Y</span> <span class="main">≥</span> <span class="numeral">3</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> IH.hyps<span class="main">(</span>2<span class="main">)</span> IH.prems<span class="main">(</span>3<span class="main">)</span> X_eq <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∉</span> <span class="skolem">Y</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> ab_Y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="skolem">Y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="skolem">Y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≠</span> <span class="skolem">b</span>"</span></span>
                    <span class="keyword2"><span class="keyword">and</span></span> Y_ends<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">c</span><span class="main">∈</span><span class="skolem">Y</span><span class="main">.</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">≠</span> <span class="bound">c</span> <span class="main">∧</span> <span class="skolem">b</span> <span class="main">≠</span> <span class="bound">c</span><span class="main">)</span> <span class="main">⟶</span> <span class="main"><span class="free">[[</span></span><span class="skolem">a</span> <span class="bound">c</span> <span class="skolem">b</span><span class="main"><span class="free">]]</span></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> IH<span class="main">(</span>1<span class="main">)</span> <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">Y</span></span><span class="main">]</span> IH.prems<span class="main">(</span>1-3<span class="main">)</span> X_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="skolem">a</span> <span class="skolem">x</span> <span class="skolem">b</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="skolem">x</span> <span class="skolem">b</span> <span class="skolem">a</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="skolem">b</span> <span class="skolem">a</span> <span class="skolem">x</span><span class="main"><span class="free">]]</span></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> some_betw <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">Q</span></span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="skolem">b</span></span><span class="main">]</span> ab_Y IH.prems<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> X_eq <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∉</span> <span class="skolem">Y</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="skolem">a</span> <span class="skolem">x</span> <span class="skolem">b</span><span class="main"><span class="free">]]</span></span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> Y_ends X_eq ab_Y <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="skolem">x</span> <span class="skolem">b</span> <span class="skolem">a</span><span class="main"><span class="free">]]</span></span>"</span></span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> <span class="skolem">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">c</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≠</span> <span class="skolem">c</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="skolem">x</span> <span class="skolem">c</span> <span class="skolem">a</span><span class="main"><span class="free">]]</span></span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> IH.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> X_eq Y_ends <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="skolem">x</span> <span class="skolem">b</span> <span class="skolem">a</span><span class="main"><span class="free">]]</span></span>›</span></span> ab_Y<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> abc_abc_neq abc_bcd_abd abc_only_cba<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> abc_sym <span class="quoted"><span class="quoted">‹<span class="free">Q</span> <span class="main">∈</span> <span class="free">𝒫</span>›</span></span> betw_b_in_path insert_iff some_betw subsetD<span class="main">)</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> X_eq <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="skolem">x</span> <span class="skolem">b</span> <span class="skolem">a</span><span class="main"><span class="free">]]</span></span>›</span></span> ab_Y<span class="main">(</span>1<span class="main">)</span> abc_abc_neq insert_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="skolem">b</span> <span class="skolem">a</span> <span class="skolem">x</span><span class="main"><span class="free">]]</span></span>"</span></span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> <span class="skolem">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">≠</span> <span class="skolem">c</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">c</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">x</span><span class="main"><span class="free">]]</span></span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> IH.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> X_eq Y_ends <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="skolem">b</span> <span class="skolem">a</span> <span class="skolem">x</span><span class="main"><span class="free">]]</span></span>›</span></span> ab_Y<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> abc_abc_neq abc_bcd_acd abc_only_cba<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span>
            abc_sym <span class="quoted"><span class="quoted">‹<span class="free">Q</span> <span class="main">∈</span> <span class="free">𝒫</span>›</span></span> betw_a_in_path insert_iff some_betw subsetD<span class="main">)</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> X_eq <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∉</span> <span class="skolem">Y</span>›</span></span> ab_Y<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="TemporalOrderOnPath-obtain_fin_path_ends"><span class="command">lemma</span></span> obtain_fin_path_ends<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> path_X<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">X</span><span class="main">∈</span><span class="free">𝒫</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> fin_Q<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">Q</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> card_Q<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="free">Q</span> <span class="main">≥</span> <span class="numeral">3</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> events_Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span><span class="main">⊆</span><span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">a</span> <span class="free">b</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">≠</span><span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">∈</span><span class="free">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">∈</span><span class="free">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">c</span><span class="main">∈</span><span class="free">Q</span><span class="main">.</span> <span class="main">(</span><span class="free">a</span><span class="main">≠</span><span class="bound">c</span> <span class="main">∧</span> <span class="free">b</span><span class="main">≠</span><span class="bound">c</span><span class="main">)</span> <span class="main">⟶</span> <span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="bound">c</span> <span class="free">b</span><span class="main"><span class="free">]]</span></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">≥</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"card <span class="free">Q</span> <span class="main">=</span> <span class="skolem">n</span><span class="main">+</span><span class="numeral">3</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> card_Q nat_le_iff_add
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">≠</span><span class="skolem">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">∈</span><span class="free">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">∈</span><span class="free">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">c</span><span class="main">∈</span><span class="free">Q</span><span class="main">.</span> <span class="main">(</span><span class="skolem">a</span><span class="main">≠</span><span class="bound">c</span> <span class="main">∧</span> <span class="skolem">b</span><span class="main">≠</span><span class="bound">c</span><span class="main">)</span> <span class="main">⟶</span> <span class="main"><span class="free">[[</span></span><span class="skolem">a</span> <span class="bound">c</span> <span class="skolem">b</span><span class="main"><span class="free">]]</span></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> finite_path_has_ends assms <span class="quoted"><span class="quoted">‹<span class="skolem">n</span><span class="main">≥</span><span class="main">0</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="TemporalOrderOnPath-path_card_nil"><span class="command">lemma</span></span> path_card_nil<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span><span class="main">∈</span><span class="free">𝒫</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="free">Q</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"card <span class="free">Q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> card <span class="free">Q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">≥</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹card <span class="free">Q</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">consider</span></span> <span class="main">(</span>n1<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">=</span><span class="main">1</span>"</span></span> <span class="main">|</span> <span class="main">(</span>n2<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">=</span><span class="numeral">2</span>"</span></span> <span class="main">|</span> <span class="main">(</span>n3<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">≥</span><span class="numeral">3</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> n1
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> One_nat_def card_Suc_eq ge2_events_lax singletonD assms<span class="main">(</span>1<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">=</span> card <span class="free">Q</span>›</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> n2
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">≠</span><span class="skolem">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">∈</span><span class="free">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">∈</span><span class="free">Q</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ge2_events_lax assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">∈</span><span class="free">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">≠</span><span class="skolem">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">≠</span><span class="skolem">b</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> prolong_betw2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> abc_abc_neq assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"card <span class="free">Q</span> <span class="main">≠</span> <span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∈</span> <span class="free">Q</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">≠</span> <span class="skolem">b</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">∈</span> <span class="free">Q</span>›</span></span> card_2_iff'<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">=</span> card <span class="free">Q</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">=</span> <span class="numeral">2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> n3
    <span class="keyword1"><span class="command">have</span></span> fin_Q<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">Q</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">≠</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">‹card <span class="free">Q</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> card.infinite<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> card_Q<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="free">Q</span> <span class="main">≥</span> <span class="numeral">3</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">=</span> card <span class="free">Q</span>›</span></span> n3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span><span class="main">⊆</span><span class="free">Q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">∈</span><span class="free">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">∈</span><span class="free">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">≠</span><span class="skolem">b</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> acb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">c</span><span class="main">∈</span><span class="free">Q</span><span class="main">.</span> <span class="main">(</span><span class="bound">c</span><span class="main">≠</span><span class="skolem">a</span> <span class="main">∧</span> <span class="bound">c</span><span class="main">≠</span><span class="skolem">b</span><span class="main">)</span> <span class="main">⟶</span> <span class="main"><span class="free">[[</span></span><span class="skolem">a</span> <span class="bound">c</span> <span class="skolem">b</span><span class="main"><span class="free">]]</span></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> obtain_fin_path_ends card_Q fin_Q assms<span class="main">(</span>1<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">x</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="free">Q</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> prolong_betw2 assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> acb abc_abc_neq abc_only_cba<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">theorem</span></span> <span class="comment1">(*6ii*)</span> infinite_paths<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span><span class="main">∈</span><span class="free">𝒫</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"infinite <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> fin_P<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span><span class="main">≠</span><span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"card <span class="free">P</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fin_P<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>card <span class="free">P</span> <span class="main">≥</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> path_card_nil
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* contex MinkowskiSpacetime *)</span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"3.5 Second collinearity theorem"</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We start with a useful betweenness lemma.›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> MinkowskiBetweenness<span class="main">)</span> some_betw2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> path_Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">∈</span> <span class="free">𝒫</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> a_inQ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">Q</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> b_inQ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> <span class="free">Q</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> c_inQ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">∈</span> <span class="free">Q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="free">b</span> <span class="main">∨</span> <span class="free">a</span> <span class="main">=</span> <span class="free">c</span> <span class="main">∨</span> <span class="free">b</span> <span class="main">=</span> <span class="free">c</span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">b</span> <span class="free">c</span> <span class="free">a</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">c</span> <span class="free">a</span> <span class="free">b</span><span class="main"><span class="free">]]</span></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> a_inQ b_inQ c_inQ path_Q some_betw <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> MinkowskiPrimitive<span class="main">)</span> paths_tri<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> path_ab<span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="free">ab</span> <span class="free">a</span> <span class="free">b</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> path_bc<span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="free">bc</span> <span class="free">b</span> <span class="free">c</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> path_ca<span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="free">ca</span> <span class="free">c</span> <span class="free">a</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> a_notin_bc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∉</span> <span class="free">bc</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">△</span> <span class="free">a</span> <span class="free">b</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> abc_events<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">ℰ</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">∈</span> <span class="free">ℰ</span> <span class="main">∧</span> <span class="free">c</span> <span class="main">∈</span> <span class="free">ℰ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> path_ab path_bc path_ca in_path_event <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> abc_neq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">≠</span> <span class="free">c</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">≠</span> <span class="free">c</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> path_ab path_bc path_ca <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> paths_neq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ab</span> <span class="main">≠</span> <span class="free">bc</span> <span class="main">∧</span> <span class="free">ab</span> <span class="main">≠</span> <span class="free">ca</span> <span class="main">∧</span> <span class="free">bc</span> <span class="main">≠</span> <span class="free">ca</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a_notin_bc cross_once_notin path_ab path_bc path_ca <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> kinematic_triangle_def
    <span class="keyword1"><span class="command">using</span></span> abc_events abc_neq paths_neq path_ab path_bc path_ca
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> MinkowskiPrimitive<span class="main">)</span> paths_tri2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> path_ab<span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="free">ab</span> <span class="free">a</span> <span class="free">b</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> path_bc<span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="free">bc</span> <span class="free">b</span> <span class="free">c</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> path_ca<span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="free">ca</span> <span class="free">c</span> <span class="free">a</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> ab_neq_bc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ab</span> <span class="main">≠</span> <span class="free">bc</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">△</span> <span class="free">a</span> <span class="free">b</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> ab_neq_bc cross_once_notin path_ab path_bc path_ca paths_tri<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Schutz states it more like
   <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>⟦tri_abc; bcd; cea⟧ ⟹ (path de d e ⟶ ∃f∈de. [[a f b]]∧[[d e f]])›</span></span></span></span>.
  Equivalent up to usage of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>impI›</span></span></span></span>.
›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> <span class="comment1">(*7*)</span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> MinkowskiChain<span class="main">)</span> collinearity2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> tri_abc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">△</span> <span class="free">a</span> <span class="free">b</span> <span class="free">c</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> bcd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">b</span> <span class="free">c</span> <span class="free">d</span><span class="main"><span class="free">]]</span></span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> cea<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">c</span> <span class="free">e</span> <span class="free">a</span><span class="main"><span class="free">]]</span></span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> path_de<span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="free">de</span> <span class="free">d</span> <span class="free">e</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">f</span><span class="main">∈</span><span class="free">de</span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="bound">f</span> <span class="free">b</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="main"><span class="free">[[</span></span><span class="free">d</span> <span class="free">e</span> <span class="bound">f</span><span class="main"><span class="free">]]</span></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ab</span></span> <span class="keyword2"><span class="keyword">where</span></span> path_ab<span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="skolem">ab</span> <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> tri_abc triangle_paths_unique <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> afb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="skolem">f</span> <span class="free">b</span><span class="main"><span class="free">]]</span></span>"</span></span>
                  <span class="keyword2"><span class="keyword">and</span></span> f_in_de<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="free">de</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> collinearity tri_abc path_de path_ab bcd cea <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="comment1">(* af will be used a few times, so obtain it here. *)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">af</span></span> <span class="keyword2"><span class="keyword">where</span></span> path_af<span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="skolem">af</span> <span class="free">a</span> <span class="skolem">f</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> abc_abc_neq afb betw_b_in_path path_ab <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">d</span> <span class="free">e</span> <span class="skolem">f</span><span class="main"><span class="free">]]</span></span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> def_in_de<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">∈</span> <span class="free">de</span> <span class="main">∧</span> <span class="free">e</span> <span class="main">∈</span> <span class="free">de</span> <span class="main">∧</span> <span class="skolem">f</span> <span class="main">∈</span> <span class="free">de</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> path_de f_in_de <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> five_poss<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> <span class="free">d</span> <span class="main">∨</span> <span class="skolem">f</span> <span class="main">=</span> <span class="free">e</span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">e</span> <span class="skolem">f</span> <span class="free">d</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="skolem">f</span> <span class="free">d</span> <span class="free">e</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">d</span> <span class="free">e</span> <span class="skolem">f</span><span class="main"><span class="free">]]</span></span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> path_de some_betw2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> <span class="free">d</span> <span class="main">∨</span> <span class="skolem">f</span> <span class="main">=</span> <span class="free">e</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">Q</span><span class="main">∈</span><span class="free">𝒫</span><span class="main">.</span> <span class="free">a</span> <span class="main">∈</span> <span class="bound">Q</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">∈</span> <span class="bound">Q</span> <span class="main">∧</span> <span class="free">c</span> <span class="main">∈</span> <span class="bound">Q</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> abc_abc_neq afb bcd betw_a_in_path betw_b_in_path cea path_ab<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f_neq_d_e<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">≠</span> <span class="free">d</span> <span class="main">∧</span> <span class="skolem">f</span> <span class="main">≠</span> <span class="free">e</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> tri_abc
        <span class="keyword1"><span class="command">using</span></span> triangle_diff_paths <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">e</span> <span class="skolem">f</span> <span class="free">d</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="skolem">f</span> <span class="free">d</span> <span class="free">e</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">d</span> <span class="free">e</span> <span class="skolem">f</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> five_poss <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> efd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">e</span> <span class="skolem">f</span> <span class="free">d</span><span class="main"><span class="free">]]</span></span>"</span></span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">dc</span></span> <span class="keyword2"><span class="keyword">where</span></span> path_dc<span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="skolem">dc</span> <span class="free">d</span> <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> abc_abc_neq abc_ex_path bcd <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ce</span></span> <span class="keyword2"><span class="keyword">where</span></span> path_ce<span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="skolem">ce</span> <span class="free">c</span> <span class="free">e</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> abc_abc_neq abc_ex_path cea <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">dc</span><span class="main">≠</span><span class="skolem">ce</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> bcd betw_a_in_path betw_c_in_path cea path_ce path_dc tri_abc triangle_diff_paths
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">△</span> <span class="free">d</span> <span class="free">c</span> <span class="free">e</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> paths_tri2 path_ce path_dc path_de <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> x_in_af<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">af</span>"</span></span>
                      <span class="keyword2"><span class="keyword">and</span></span> dxc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">d</span> <span class="skolem">x</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> collinearity
                <span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> a <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">d</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> b <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">c</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> c <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">e</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> d <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">a</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> e <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> de <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">af</span></span><span class="main">]</span>
                cea efd path_dc path_af <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> x_in_dc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">dc</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> betw_b_in_path path_dc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> eq_paths <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> path_af path_dc afb bcd tri_abc x_in_af
                                            betw_a_in_path betw_c_in_path triangle_diff_paths<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">d</span> <span class="free">b</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> dxc <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">using</span></span> bcd abc_only_cba <span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> a <span class="main"><span class="main"><span class="main"><span class="main"><span class="main">=</span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">b</span></span></span></span></span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span></span></span> b <span class="main"><span class="main"><span class="main"><span class="main"><span class="main">=</span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">c</span></span></span></span></span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span></span></span> c <span class="main"><span class="main"><span class="main"><span class="main"><span class="main">=</span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">d</span></span></span></span></span></span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> fde<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="skolem">f</span> <span class="free">d</span> <span class="free">e</span><span class="main"><span class="free">]]</span></span>"</span></span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">bd</span></span> <span class="keyword2"><span class="keyword">where</span></span> path_bd<span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="skolem">bd</span> <span class="free">b</span> <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> abc_abc_neq abc_ex_path bcd <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ea</span></span> <span class="keyword2"><span class="keyword">where</span></span> path_ea<span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="skolem">ea</span> <span class="free">e</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> abc_abc_neq abc_ex_path_unique cea <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">fe</span></span> <span class="keyword2"><span class="keyword">where</span></span> path_fe<span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="skolem">fe</span> <span class="skolem">f</span> <span class="free">e</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f_in_de f_neq_d_e path_de <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">fe</span><span class="main">≠</span><span class="skolem">ea</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> tri_abc afb cea path_ea path_fe
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> abc_abc_neq betw_a_in_path betw_c_in_path triangle_paths_neq<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">△</span> <span class="free">e</span> <span class="free">a</span> <span class="skolem">f</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> path_unique path_af path_ea path_fe paths_tri2<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> y_in_bd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">bd</span>"</span></span>
                      <span class="keyword2"><span class="keyword">and</span></span> eya<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">e</span> <span class="skolem">y</span> <span class="free">a</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="keyword1"><span class="command">thm</span></span> collinearity
          <span class="keyword1"><span class="command">using</span></span> collinearity
                <span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> a <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">e</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> b <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">a</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> c <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> d <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">b</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> e <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">d</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> de <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">bd</span></span><span class="main">]</span>
                afb fde path_bd path_ea <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span>
                                  afb bcd cea path_bd tri_abc
                                  abc_ac_neq betw_b_in_path path_unique triangle_paths<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span>
                                    triangle_paths_neq<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">e</span> <span class="free">c</span> <span class="free">a</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> eya <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">using</span></span> cea abc_only_cba <span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> a <span class="main"><span class="main"><span class="main"><span class="main"><span class="main">=</span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">c</span></span></span></span></span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span></span></span> b <span class="main"><span class="main"><span class="main"><span class="main"><span class="main">=</span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">e</span></span></span></span></span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span></span></span> c <span class="main"><span class="main"><span class="main"><span class="main"><span class="main">=</span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">a</span></span></span></span></span></span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">d</span> <span class="free">e</span> <span class="skolem">f</span><span class="main"><span class="free">]]</span></span>"</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">assumption</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> afb f_in_de <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"3.6 Order on a path - Theorems 8 and 9"</span></span>
<span class="keyword1"><span class="command">context</span></span> MinkowskiSpacetime <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Theorem 8 (as in Veblen (1911) Theorem 6)›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Note <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>a'b'c'›</span></span></span></span> don't necessarily form a triangle, as there still needs to be paths between them.
›</span></span>


<span class="keyword1"><span class="command">theorem</span></span> <span class="comment1">(*8*)</span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> MinkowskiChain<span class="main">)</span> tri_betw_no_path<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> tri_abc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">△</span> <span class="free">a</span> <span class="free">b</span> <span class="free">c</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> ab'c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b'</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> bc'a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">b</span> <span class="free">c'</span> <span class="free">a</span><span class="main"><span class="free">]]</span></span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> ca'b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">c</span> <span class="free">a'</span> <span class="free">b</span><span class="main"><span class="free">]]</span></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">Q</span><span class="main">∈</span><span class="free">𝒫</span><span class="main">.</span> <span class="free">a'</span> <span class="main">∈</span> <span class="bound">Q</span> <span class="main">∧</span> <span class="free">b'</span> <span class="main">∈</span> <span class="bound">Q</span> <span class="main">∧</span> <span class="free">c'</span> <span class="main">∈</span> <span class="bound">Q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> abc_a'b'c'_neq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">a'</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">≠</span> <span class="free">b'</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">≠</span> <span class="free">c'</span>
                      <span class="main">∧</span> <span class="free">b</span> <span class="main">≠</span> <span class="free">a'</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">≠</span> <span class="free">b'</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">≠</span> <span class="free">c'</span>
                      <span class="main">∧</span> <span class="free">c</span> <span class="main">≠</span> <span class="free">a'</span> <span class="main">∧</span> <span class="free">c</span> <span class="main">≠</span> <span class="free">b'</span> <span class="main">∧</span> <span class="free">c</span> <span class="main">≠</span> <span class="free">c'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> abc_ac_neq
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ab'c abc_abc_neq bc'a ca'b tri_abc triangle_not_betw_abc triangle_permutes<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> notI<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> path_a'b'c'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">Q</span><span class="main">∈</span><span class="free">𝒫</span><span class="main">.</span> <span class="free">a'</span> <span class="main">∈</span> <span class="bound">Q</span> <span class="main">∧</span> <span class="free">b'</span> <span class="main">∈</span> <span class="bound">Q</span> <span class="main">∧</span> <span class="free">c'</span> <span class="main">∈</span> <span class="bound">Q</span>"</span></span>
    <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a'</span> <span class="free">b'</span> <span class="free">c'</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">b'</span> <span class="free">c'</span> <span class="free">a'</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">c'</span> <span class="free">a'</span> <span class="free">b'</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> some_betw
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> abc_a'b'c'_neq path_a'b'c' bc'a ca'b ab'c tri_abc
                abc_ex_path cross_once_notin triangle_diff_paths<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> a'b'c'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a'</span> <span class="free">b'</span> <span class="free">c'</span><span class="main"><span class="free">]]</span></span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> c'b'a'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">c'</span> <span class="free">b'</span> <span class="free">a'</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> abc_sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> nopath_a'c'b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">Q</span><span class="main">∈</span><span class="free">𝒫</span><span class="main">.</span> <span class="free">a'</span> <span class="main">∈</span> <span class="bound">Q</span> <span class="main">∧</span> <span class="free">c'</span> <span class="main">∈</span> <span class="bound">Q</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">∈</span> <span class="bound">Q</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> notI<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">Q</span><span class="main">∈</span><span class="free">𝒫</span><span class="main">.</span> <span class="free">a'</span> <span class="main">∈</span> <span class="bound">Q</span> <span class="main">∧</span> <span class="free">c'</span> <span class="main">∈</span> <span class="bound">Q</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">∈</span> <span class="bound">Q</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Q</span></span> <span class="keyword2"><span class="keyword">where</span></span> path_Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="main">∈</span> <span class="free">𝒫</span>"</span></span>
                        <span class="keyword2"><span class="keyword">and</span></span> a'_inQ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a'</span> <span class="main">∈</span> <span class="skolem">Q</span>"</span></span>
                        <span class="keyword2"><span class="keyword">and</span></span> c'_inQ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c'</span> <span class="main">∈</span> <span class="skolem">Q</span>"</span></span>
                        <span class="keyword2"><span class="keyword">and</span></span> b_inQ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> <span class="skolem">Q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ac_inQ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="skolem">Q</span> <span class="main">∧</span> <span class="free">c</span> <span class="main">∈</span> <span class="skolem">Q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> eq_paths
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> abc_a'b'c'_neq ca'b bc'a betw_a_in_path betw_c_in_path<span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> b_inQ path_Q tri_abc triangle_diff_paths <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> tri_a'bc'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">△</span> <span class="free">a'</span> <span class="free">b</span> <span class="free">c'</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> bc'a ca'b path_a'b'c' paths_tri abc_ex_path_unique<span class="main">)</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ab'</span></span> <span class="keyword2"><span class="keyword">where</span></span> path_ab'<span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="skolem">ab'</span> <span class="free">a</span> <span class="free">b'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ab'c abc_a'b'c'_neq abc_ex_path <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a'b</span></span> <span class="keyword2"><span class="keyword">where</span></span> path_a'b<span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="skolem">a'b</span> <span class="free">a'</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> tri_a'bc' triangle_paths<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">a'b</span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="free">a'</span> <span class="bound">x</span> <span class="free">b</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b'</span> <span class="bound">x</span><span class="main"><span class="free">]]</span></span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> collinearity2 <span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> a <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">a'</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> b <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">b</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> c <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">c'</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> e <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">b'</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> d <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">a</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> de <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">ab'</span></span><span class="main">]</span>
                bc'a betw_b_in_path c'b'a' path_ab' tri_a'bc' <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> x_in_a'b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">a'b</span>"</span></span>
                      <span class="keyword2"><span class="keyword">and</span></span> a'xb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a'</span> <span class="skolem">x</span> <span class="free">b</span><span class="main"><span class="free">]]</span></span>"</span></span>
                      <span class="keyword2"><span class="keyword">and</span></span> ab'x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b'</span> <span class="skolem">x</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="comment1">(* ab' ∩ a'b = {c} doesn't follow as immediately as in Schutz. *)</span>
      <span class="keyword1"><span class="command">have</span></span> c_in_ab'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">∈</span> <span class="skolem">ab'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ab'c betw_c_in_path path_ab' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> c_in_a'b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">∈</span> <span class="skolem">a'b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ca'b betw_a_in_path path_a'b <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">have</span></span> ab'_a'b_distinct<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ab'</span> <span class="main">≠</span> <span class="skolem">a'b</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> c_in_a'b path_a'b path_ab' tri_abc triangle_diff_paths <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ab'</span> <span class="main">∩</span> <span class="skolem">a'b</span> <span class="main">=</span> <span class="main">{</span><span class="free">c</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> paths_cross_at ab'_a'b_distinct c_in_a'b c_in_ab' path_a'b path_ab' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ab'x path_ab' x_in_a'b betw_c_in_path <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a'</span> <span class="free">c</span> <span class="free">b</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a'xb <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> ca'b abc_only_cba <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> b'c'a'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">b'</span> <span class="free">c'</span> <span class="free">a'</span><span class="main"><span class="free">]]</span></span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> a'c'b'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a'</span> <span class="free">c'</span> <span class="free">b'</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> abc_sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> nopath_a'cb'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">Q</span><span class="main">∈</span><span class="free">𝒫</span><span class="main">.</span> <span class="free">a'</span> <span class="main">∈</span> <span class="bound">Q</span> <span class="main">∧</span> <span class="free">c</span> <span class="main">∈</span> <span class="bound">Q</span> <span class="main">∧</span> <span class="free">b'</span> <span class="main">∈</span> <span class="bound">Q</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> notI<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">Q</span><span class="main">∈</span><span class="free">𝒫</span><span class="main">.</span> <span class="free">a'</span> <span class="main">∈</span> <span class="bound">Q</span> <span class="main">∧</span> <span class="free">c</span> <span class="main">∈</span> <span class="bound">Q</span> <span class="main">∧</span> <span class="free">b'</span> <span class="main">∈</span> <span class="bound">Q</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Q</span></span> <span class="keyword2"><span class="keyword">where</span></span> path_Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="main">∈</span> <span class="free">𝒫</span>"</span></span>
                        <span class="keyword2"><span class="keyword">and</span></span> a'_inQ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a'</span> <span class="main">∈</span> <span class="skolem">Q</span>"</span></span>
                        <span class="keyword2"><span class="keyword">and</span></span> c_inQ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">∈</span> <span class="skolem">Q</span>"</span></span>
                        <span class="keyword2"><span class="keyword">and</span></span> b'_inQ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b'</span> <span class="main">∈</span> <span class="skolem">Q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ab_inQ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="skolem">Q</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">∈</span> <span class="skolem">Q</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> eq_paths
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ab'c abc_a'b'c'_neq betw_a_in_path betw_c_in_path ca'b<span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> c_inQ path_Q tri_abc triangle_diff_paths <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> tri_a'cb'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">△</span> <span class="free">a'</span> <span class="free">c</span> <span class="free">b'</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> ab'c abc_ex_path_unique b'c'a' ca'b paths_tri<span class="main">)</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">bc'</span></span> <span class="keyword2"><span class="keyword">where</span></span> path_bc'<span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="skolem">bc'</span> <span class="free">b</span> <span class="free">c'</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> abc_a'b'c'_neq abc_ex_path_unique bc'a
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b'c</span></span> <span class="keyword2"><span class="keyword">where</span></span> path_b'c<span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="skolem">b'c</span> <span class="free">b'</span> <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> tri_a'cb' triangle_paths<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">b'c</span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="free">b'</span> <span class="bound">x</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="main"><span class="free">[[</span></span><span class="free">b</span> <span class="free">c'</span> <span class="bound">x</span><span class="main"><span class="free">]]</span></span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> collinearity2 <span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> a <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">b'</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> b <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">c</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> c <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">a'</span></span>
                                 <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> e <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">c'</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> d <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">b</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> de <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">bc'</span></span><span class="main">]</span>
                bc'a betw_b_in_path a'c'b' path_bc' tri_a'cb'
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> ca'b triangle_permutes<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> x_in_b'c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">b'c</span>"</span></span>
                      <span class="keyword2"><span class="keyword">and</span></span> b'xc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">b'</span> <span class="skolem">x</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span>"</span></span>
                      <span class="keyword2"><span class="keyword">and</span></span> bc'x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">b</span> <span class="free">c'</span> <span class="skolem">x</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> a_in_bc'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="skolem">bc'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bc'a betw_c_in_path path_bc' <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> a_in_b'c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="skolem">b'c</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ab'c betw_a_in_path path_b'c <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> bc'_b'c_distinct<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">bc'</span> <span class="main">≠</span> <span class="skolem">b'c</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> a_in_bc' path_b'c path_bc' tri_abc triangle_diff_paths <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">bc'</span> <span class="main">∩</span> <span class="skolem">b'c</span> <span class="main">=</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> paths_cross_at bc'_b'c_distinct a_in_b'c a_in_bc' path_b'c path_bc' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bc'x betw_c_in_path path_bc' x_in_b'c <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">b'</span> <span class="free">a</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b'xc <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> ab'c abc_only_cba <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> c'a'b'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">c'</span> <span class="free">a'</span> <span class="free">b'</span><span class="main"><span class="free">]]</span></span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> b'a'c'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">b'</span> <span class="free">a'</span> <span class="free">c'</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> abc_sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> nopath_c'ab'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">Q</span><span class="main">∈</span><span class="free">𝒫</span><span class="main">.</span> <span class="free">c'</span> <span class="main">∈</span> <span class="bound">Q</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">∈</span> <span class="bound">Q</span> <span class="main">∧</span> <span class="free">b'</span> <span class="main">∈</span> <span class="bound">Q</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> notI<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">Q</span><span class="main">∈</span><span class="free">𝒫</span><span class="main">.</span> <span class="free">c'</span> <span class="main">∈</span> <span class="bound">Q</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">∈</span> <span class="bound">Q</span> <span class="main">∧</span> <span class="free">b'</span> <span class="main">∈</span> <span class="bound">Q</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Q</span></span> <span class="keyword2"><span class="keyword">where</span></span> path_Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="main">∈</span> <span class="free">𝒫</span>"</span></span>
                        <span class="keyword2"><span class="keyword">and</span></span> c'_inQ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c'</span> <span class="main">∈</span> <span class="skolem">Q</span>"</span></span>
                        <span class="keyword2"><span class="keyword">and</span></span> a_inQ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="skolem">Q</span>"</span></span>
                        <span class="keyword2"><span class="keyword">and</span></span> b'_inQ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b'</span> <span class="main">∈</span> <span class="skolem">Q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> bc_inQ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> <span class="skolem">Q</span> <span class="main">∧</span> <span class="free">c</span> <span class="main">∈</span> <span class="skolem">Q</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> eq_paths ab'c abc_a'b'c'_neq bc'a betw_a_in_path betw_c_in_path <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> a_inQ path_Q tri_abc triangle_diff_paths <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> tri_a'cb'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">△</span> <span class="free">b'</span> <span class="free">a</span> <span class="free">c'</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> bc'a abc_ex_path_unique c'a'b' ab'c paths_tri<span class="main">)</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ca'</span></span> <span class="keyword2"><span class="keyword">where</span></span> path_ca'<span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="skolem">ca'</span> <span class="free">c</span> <span class="free">a'</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> abc_a'b'c'_neq abc_ex_path_unique ca'b
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c'a</span></span> <span class="keyword2"><span class="keyword">where</span></span> path_c'a<span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="skolem">c'a</span> <span class="free">c'</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> tri_a'cb' triangle_paths<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">c'a</span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="free">c'</span> <span class="bound">x</span> <span class="free">a</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="main"><span class="free">[[</span></span><span class="free">c</span> <span class="free">a'</span> <span class="bound">x</span><span class="main"><span class="free">]]</span></span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> collinearity2 <span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> a <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">c'</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> b <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">a</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> c <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">b'</span></span>
                                 <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> e <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">a'</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> d <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">c</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> de <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">ca'</span></span><span class="main">]</span>
                ab'c b'a'c' betw_b_in_path path_ca' tri_a'cb' triangle_permutes<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> x_in_c'a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">c'a</span>"</span></span>
                      <span class="keyword2"><span class="keyword">and</span></span> c'xa<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">c'</span> <span class="skolem">x</span> <span class="free">a</span><span class="main"><span class="free">]]</span></span>"</span></span>
                      <span class="keyword2"><span class="keyword">and</span></span> ca'x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">c</span> <span class="free">a'</span> <span class="skolem">x</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> b_in_ca'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> <span class="skolem">ca'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> betw_c_in_path ca'b path_ca' <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> b_in_c'a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> <span class="skolem">c'a</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bc'a betw_a_in_path path_c'a <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> ca'_c'a_distinct<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ca'</span> <span class="main">≠</span> <span class="skolem">c'a</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> b_in_c'a path_c'a path_ca' tri_abc triangle_diff_paths <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ca'</span> <span class="main">∩</span> <span class="skolem">c'a</span> <span class="main">=</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> b_in_c'a b_in_ca' ca'_c'a_distinct path_c'a path_ca' paths_cross_at <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> betw_c_in_path ca'x path_ca' x_in_c'a <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">c'</span> <span class="free">b</span> <span class="free">a</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c'xa <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> abc_only_cba bc'a <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Theorem 9›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We now begin working on the transitivity lemmas needed to prove Theorem 9.
  Multiple lemmas below obtain primed variables (e.g. <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>d'›</span></span></span></span>). These are starred in Schutz (e.g. <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>d*›</span></span></span></span>),
  but that notation is already reserved in Isabelle.
›</span></span>

<span class="keyword1" id="TemporalOrderOnPath-unreachable_bounded_path_only"><span class="command">lemma</span></span> unreachable_bounded_path_only<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> d'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">d'</span><span class="main">∉</span> <span class="main">∅</span> <span class="free">ab</span> <span class="free">e</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">d'</span><span class="main">∈</span><span class="free">ab</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">d'</span><span class="main">≠</span><span class="free">e</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> e_event<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">∈</span> <span class="free">ℰ</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> path_ab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ab</span> <span class="main">∈</span> <span class="free">𝒫</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> e_notin_S<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">∉</span> <span class="free">ab</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">d'e</span><span class="main">.</span> path <span class="bound">d'e</span> <span class="free">d'</span> <span class="free">e</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">d'e</span><span class="main">.</span> path <span class="bound">d'e</span> <span class="free">d'</span> <span class="free">e</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">R</span><span class="main">∈</span><span class="free">𝒫</span><span class="main">.</span> <span class="free">d'</span><span class="main">∈</span><span class="bound">R</span> <span class="main">∧</span> <span class="free">e</span><span class="main">∈</span><span class="bound">R</span> <span class="main">∧</span> <span class="free">d'</span><span class="main">≠</span><span class="free">e</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">R</span><span class="main">∈</span><span class="free">𝒫</span><span class="main">.</span>  <span class="free">e</span><span class="main">∈</span><span class="bound">R</span> <span class="main">∧</span> <span class="free">d'</span><span class="main">∈</span><span class="bound">R</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> d'_def<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">ab</span><span class="main">∈</span><span class="free">𝒫</span> <span class="main">∧</span> <span class="free">e</span><span class="main">∈</span><span class="free">ℰ</span> <span class="main">∧</span> <span class="free">e</span><span class="main">∉</span><span class="free">ab</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> e_event e_notin_S path_ab<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">d'</span><span class="main">∈</span> <span class="main">∅</span> <span class="free">ab</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> unreachable_subset_def <span class="keyword1"><span class="command">using</span></span> d'_def<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">using</span></span> d'_def<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="TemporalOrderOnPath-unreachable_bounded_path"><span class="command">lemma</span></span> unreachable_bounded_path<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> S_neq_ab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">≠</span> <span class="free">ab</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> a_inS<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">S</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> e_inS<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">∈</span> <span class="free">S</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> e_neq_a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">≠</span> <span class="free">a</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> path_S<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∈</span> <span class="free">𝒫</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> path_ab<span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="free">ab</span> <span class="free">a</span> <span class="free">b</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> path_be<span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="free">be</span> <span class="free">b</span> <span class="free">e</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> no_de<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">de</span><span class="main">.</span> path <span class="bound">de</span> <span class="free">d</span> <span class="free">e</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> abd<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="free">d</span><span class="main"><span class="free">]]</span></span>"</span></span>
    <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">d'</span> <span class="free">d'e</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">d'</span><span class="main">∈</span><span class="free">ab</span> <span class="main">∧</span> path <span class="free">d'e</span> <span class="free">d'</span> <span class="free">e</span> <span class="main">∧</span> <span class="main"><span class="free">[[</span></span><span class="free">b</span> <span class="free">d</span> <span class="free">d'</span><span class="main"><span class="free">]]</span></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> e_event<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span><span class="main">∈</span><span class="free">ℰ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> e_inS path_S <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span><span class="main">∉</span><span class="free">ab</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> S_neq_ab a_inS e_inS e_neq_a eq_paths path_S path_ab <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">ab</span><span class="main">∈</span><span class="free">𝒫</span> <span class="main">∧</span> <span class="free">e</span><span class="main">∉</span><span class="free">ab</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> S_neq_ab a_inS e_inS e_neq_a eq_paths path_S path_ab
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> <span class="free">ab</span> <span class="main">-</span> <span class="main">∅</span> <span class="free">ab</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> cross_in_reachable path_ab path_be
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">∈</span> <span class="main">∅</span> <span class="free">ab</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> no_de abd path_ab e_event <span class="quoted"><span class="quoted">‹<span class="free">e</span><span class="main">∉</span><span class="free">ab</span>›</span></span>
      betw_c_in_path unreachable_bounded_path_only
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">d'</span> <span class="bound">d'e</span><span class="main">.</span> <span class="bound">d'</span><span class="main">∈</span><span class="free">ab</span> <span class="main">∧</span> path <span class="bound">d'e</span> <span class="bound">d'</span> <span class="free">e</span> <span class="main">∧</span> <span class="main"><span class="free">[[</span></span><span class="free">b</span> <span class="free">d</span> <span class="bound">d'</span><span class="main"><span class="free">]]</span></span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">b</span> <span class="free">d</span> <span class="skolem">d'</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d'</span><span class="main">∈</span><span class="free">ab</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d'</span><span class="main">∉</span> <span class="main">∅</span> <span class="free">ab</span> <span class="free">e</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">≠</span><span class="skolem">d'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span><span class="main">≠</span><span class="skolem">d'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> unreachable_set_bounded <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">∈</span> <span class="free">ab</span> <span class="main">-</span> <span class="main">∅</span> <span class="free">ab</span> <span class="free">e</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">d</span> <span class="main">∈</span> <span class="main">∅</span> <span class="free">ab</span> <span class="free">e</span>›</span></span> e_event <span class="quoted"><span class="quoted">‹<span class="free">e</span><span class="main">∉</span><span class="free">ab</span>›</span></span> path_ab
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> DiffE<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d'e</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"path <span class="skolem">d'e</span> <span class="skolem">d'</span> <span class="free">e</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> unreachable_bounded_path_only e_event <span class="quoted"><span class="quoted">‹<span class="free">e</span><span class="main">∉</span><span class="free">ab</span>›</span></span> path_ab
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="free">b</span> <span class="free">d</span> <span class="skolem">d'</span><span class="main"><span class="free">]]</span></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">d'</span> <span class="main">∈</span> <span class="free">ab</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  This lemma collects the first three paragraphs of Schutz' proof of Theorem 9 - Lemma 1.
  Several case splits need to be considered, but have no further importance outside of this lemma:
  thus we parcel them away from the main proof.›</span></span>
<span class="keyword1" id="TemporalOrderOnPath-exist_c'd'_alt"><span class="command">lemma</span></span> exist_c'd'_alt<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> abc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> abd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="free">d</span><span class="main"><span class="free">]]</span></span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> dbc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">d</span> <span class="free">b</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="comment1">(* the assumption that makes this False for ccontr! *)</span>
      <span class="keyword2"><span class="keyword">and</span></span> c_neq_d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">≠</span> <span class="free">d</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> path_ab<span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="free">ab</span> <span class="free">a</span> <span class="free">b</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> path_S<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∈</span> <span class="free">𝒫</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> a_inS<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">S</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> e_inS<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">∈</span> <span class="free">S</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> e_neq_a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">≠</span> <span class="free">a</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> S_neq_ab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">≠</span> <span class="free">ab</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> path_be<span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="free">be</span> <span class="free">b</span> <span class="free">e</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">c'</span> <span class="bound">d'</span><span class="main">.</span> <span class="main">∃</span><span class="bound">d'e</span> <span class="bound">c'e</span><span class="main">.</span> <span class="bound">c'</span><span class="main">∈</span><span class="free">ab</span> <span class="main">∧</span> <span class="bound">d'</span><span class="main">∈</span><span class="free">ab</span>
                        <span class="main">∧</span> <span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="bound">d'</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="main"><span class="free">[[</span></span><span class="bound">c'</span> <span class="free">b</span> <span class="free">a</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="main"><span class="free">[[</span></span><span class="bound">c'</span> <span class="free">b</span> <span class="bound">d'</span><span class="main"><span class="free">]]</span></span>
                        <span class="main">∧</span> path <span class="bound">d'e</span> <span class="bound">d'</span> <span class="free">e</span> <span class="main">∧</span> path <span class="bound">c'e</span> <span class="bound">c'</span> <span class="free">e</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">de</span><span class="main">.</span> path <span class="bound">de</span> <span class="free">d</span> <span class="free">e</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">de</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"path <span class="skolem">de</span> <span class="free">d</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="free">d</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="free">d</span><span class="main">∈</span><span class="free">ab</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> abd betw_c_in_path path_ab <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ce</span><span class="main">.</span> path <span class="bound">ce</span> <span class="free">c</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ce</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"path <span class="skolem">ce</span> <span class="free">c</span> <span class="free">e</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">∈</span> <span class="free">ab</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> abc betw_c_in_path path_ab <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="free">d</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="free">d</span> <span class="main">∈</span> <span class="free">ab</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">ce</span><span class="main">.</span> path <span class="bound">ce</span> <span class="free">c</span> <span class="free">e</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span> <span class="main">∈</span> <span class="free">ab</span>›</span></span> <span class="quoted"><span class="quoted">‹path <span class="skolem">de</span> <span class="free">d</span> <span class="free">e</span>›</span></span> abc abc_sym dbc
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">ce</span><span class="main">.</span> path <span class="bound">ce</span> <span class="free">c</span> <span class="free">e</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c'</span></span> <span class="skolem"><span class="skolem">c'e</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span><span class="main">∈</span><span class="free">ab</span> <span class="main">∧</span> path <span class="skolem">c'e</span> <span class="skolem">c'</span> <span class="free">e</span> <span class="main">∧</span> <span class="main"><span class="free">[[</span></span><span class="free">b</span> <span class="free">c</span> <span class="skolem">c'</span><span class="main"><span class="free">]]</span></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> unreachable_bounded_path <span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> ab<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">ab</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> e<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">e</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">b</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> d<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">c</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">a</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> S<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">S</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> be<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">be</span></span><span class="main">]</span>
        S_neq_ab <span class="quoted"><span class="quoted">‹<span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">ce</span><span class="main">.</span> path <span class="bound">ce</span> <span class="free">c</span> <span class="free">e</span><span class="main">)</span>›</span></span> a_inS abc e_inS e_neq_a path_S path_ab path_be
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="skolem">c'</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="main"><span class="free">[[</span></span><span class="free">d</span> <span class="free">b</span> <span class="skolem">c'</span><span class="main"><span class="free">]]</span></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> abc dbc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="skolem">c'</span> <span class="free">b</span> <span class="free">a</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="main"><span class="free">[[</span></span><span class="skolem">c'</span> <span class="free">b</span> <span class="free">d</span><span class="main"><span class="free">]]</span></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> theorem1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="free">d</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="free">d</span> <span class="main">∈</span> <span class="free">ab</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c'</span> <span class="main">∈</span> <span class="free">ab</span> <span class="main">∧</span> path <span class="skolem">c'e</span> <span class="skolem">c'</span> <span class="free">e</span> <span class="main">∧</span> <span class="main"><span class="free">[[</span></span><span class="free">b</span> <span class="free">c</span> <span class="skolem">c'</span><span class="main"><span class="free">]]</span></span>›</span></span> <span class="quoted"><span class="quoted">‹path <span class="skolem">de</span> <span class="free">d</span> <span class="free">e</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">de</span><span class="main">.</span> path <span class="bound">de</span> <span class="free">d</span> <span class="free">e</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d'</span></span> <span class="skolem"><span class="skolem">d'e</span></span> <span class="keyword2"><span class="keyword">where</span></span> d'_in_ab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d'</span> <span class="main">∈</span> <span class="free">ab</span>"</span></span>
                   <span class="keyword2"><span class="keyword">and</span></span> bdd'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">b</span> <span class="free">d</span> <span class="skolem">d'</span><span class="main"><span class="free">]]</span></span>"</span></span>
                   <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"path <span class="skolem">d'e</span> <span class="skolem">d'</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> unreachable_bounded_path <span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> ab<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">ab</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> e<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">e</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">b</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> d<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">d</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">a</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> S<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">S</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> be<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">be</span></span><span class="main">]</span>
      S_neq_ab <span class="quoted"><span class="quoted">‹<span class="main">∄</span><span class="bound">de</span><span class="main">.</span> path <span class="bound">de</span> <span class="free">d</span> <span class="free">e</span>›</span></span> a_inS abd e_inS e_neq_a path_S path_ab path_be
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="skolem">d'</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> abd <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ce</span><span class="main">.</span> path <span class="bound">ce</span> <span class="free">c</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ce</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"path <span class="skolem">ce</span> <span class="free">c</span> <span class="free">e</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">∈</span> <span class="free">ab</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> abc betw_c_in_path path_ab <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="skolem">d'</span><span class="main"><span class="free">]]</span></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">d'</span> <span class="main">∈</span> <span class="free">ab</span>›</span></span> <span class="quoted"><span class="quoted">‹path <span class="skolem">ce</span> <span class="free">c</span> <span class="free">e</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span> <span class="main">∈</span> <span class="free">ab</span>›</span></span> <span class="quoted"><span class="quoted">‹path <span class="skolem">d'e</span> <span class="skolem">d'</span> <span class="free">e</span>›</span></span> abc abc_sym dbc
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> abc_bcd_acd bdd'<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">ce</span><span class="main">.</span> path <span class="bound">ce</span> <span class="free">c</span> <span class="free">e</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c'</span></span> <span class="skolem"><span class="skolem">c'e</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span><span class="main">∈</span><span class="free">ab</span> <span class="main">∧</span> path <span class="skolem">c'e</span> <span class="skolem">c'</span> <span class="free">e</span> <span class="main">∧</span> <span class="main"><span class="free">[[</span></span><span class="free">b</span> <span class="free">c</span> <span class="skolem">c'</span><span class="main"><span class="free">]]</span></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> unreachable_bounded_path <span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> ab<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">ab</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> e<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">e</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">b</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> d<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">c</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">a</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> S<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">S</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> be<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">be</span></span><span class="main">]</span>
        S_neq_ab <span class="quoted"><span class="quoted">‹<span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">ce</span><span class="main">.</span> path <span class="bound">ce</span> <span class="free">c</span> <span class="free">e</span><span class="main">)</span>›</span></span> a_inS abc e_inS e_neq_a path_S path_ab path_be
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="skolem">c'</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="main"><span class="free">[[</span></span><span class="free">d</span> <span class="free">b</span> <span class="skolem">c'</span><span class="main"><span class="free">]]</span></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> abc dbc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="skolem">c'</span> <span class="free">b</span> <span class="free">a</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="main"><span class="free">[[</span></span><span class="skolem">c'</span> <span class="free">b</span> <span class="free">d</span><span class="main"><span class="free">]]</span></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> theorem1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="skolem">d'</span><span class="main"><span class="free">]]</span></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c'</span> <span class="main">∈</span> <span class="free">ab</span> <span class="main">∧</span> path <span class="skolem">c'e</span> <span class="skolem">c'</span> <span class="free">e</span> <span class="main">∧</span> <span class="main"><span class="free">[[</span></span><span class="free">b</span> <span class="free">c</span> <span class="skolem">c'</span><span class="main"><span class="free">]]</span></span>›</span></span> <span class="quoted"><span class="quoted">‹path <span class="skolem">d'e</span> <span class="skolem">d'</span> <span class="free">e</span>›</span></span> bdd' d'_in_ab
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="TemporalOrderOnPath-exist_c'd'"><span class="command">lemma</span></span> exist_c'd'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> abc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> abd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="free">d</span><span class="main"><span class="free">]]</span></span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> dbc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">d</span> <span class="free">b</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="comment1">(* the assumption that makes this False for ccontr! *)</span>
      <span class="keyword2"><span class="keyword">and</span></span> path_S<span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="free">S</span> <span class="free">a</span> <span class="free">e</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> path_be<span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="free">be</span> <span class="free">b</span> <span class="free">e</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> S_neq_ab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">≠</span> path_of <span class="free">a</span> <span class="free">b</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">c'</span> <span class="bound">d'</span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="bound">d'</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="main"><span class="free">[[</span></span><span class="bound">c'</span> <span class="free">b</span> <span class="free">a</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="main"><span class="free">[[</span></span><span class="bound">c'</span> <span class="free">b</span> <span class="bound">d'</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span>
                   path_ex <span class="bound">d'</span> <span class="free">e</span> <span class="main">∧</span> path_ex <span class="bound">c'</span> <span class="free">e</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"path_ex <span class="free">d</span> <span class="free">e</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ab</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"path_of <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path_ex <span class="free">a</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> abc abc_abc_neq abc_ex_path <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> path_ab<span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="var">?ab</span> <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> path_of_ex <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">≠</span><span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> abc_ac_neq dbc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">de</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"path <span class="skolem">de</span> <span class="free">d</span> <span class="free">e</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="free">d</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="free">d</span><span class="main">∈</span><span class="var">?ab</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> abd betw_c_in_path path_ab <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"path_ex <span class="free">c</span> <span class="free">e</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ce</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"path <span class="skolem">ce</span> <span class="free">c</span> <span class="free">e</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">∈</span> <span class="var">?ab</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> abc betw_c_in_path path_ab <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="free">d</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="free">d</span> <span class="main">∈</span> <span class="var">?ab</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">ce</span><span class="main">.</span> path <span class="bound">ce</span> <span class="free">c</span> <span class="free">e</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span> <span class="main">∈</span> <span class="var">?ab</span>›</span></span> <span class="quoted"><span class="quoted">‹path <span class="skolem">de</span> <span class="free">d</span> <span class="free">e</span>›</span></span> abc abc_sym dbc
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c'</span></span> <span class="skolem"><span class="skolem">c'e</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span><span class="main">∈</span><span class="var">?ab</span> <span class="main">∧</span> path <span class="skolem">c'e</span> <span class="skolem">c'</span> <span class="free">e</span> <span class="main">∧</span> <span class="main"><span class="free">[[</span></span><span class="free">b</span> <span class="free">c</span> <span class="skolem">c'</span><span class="main"><span class="free">]]</span></span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> unreachable_bounded_path <span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> ab<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="var">?ab</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> e<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">e</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">b</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> d<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">c</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">a</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> S<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">S</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> be<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">be</span></span><span class="main">]</span>
          S_neq_ab <span class="quoted"><span class="quoted">‹<span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">ce</span><span class="main">.</span> path <span class="bound">ce</span> <span class="free">c</span> <span class="free">e</span><span class="main">)</span>›</span></span> abc path_S path_ab path_be
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="skolem">c'</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="main"><span class="free">[[</span></span><span class="free">d</span> <span class="free">b</span> <span class="skolem">c'</span><span class="main"><span class="free">]]</span></span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> abc dbc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="skolem">c'</span> <span class="free">b</span> <span class="free">a</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="main"><span class="free">[[</span></span><span class="skolem">c'</span> <span class="free">b</span> <span class="free">d</span><span class="main"><span class="free">]]</span></span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> theorem1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="free">d</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="free">d</span> <span class="main">∈</span> <span class="var">?ab</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c'</span> <span class="main">∈</span> <span class="var">?ab</span> <span class="main">∧</span> path <span class="skolem">c'e</span> <span class="skolem">c'</span> <span class="free">e</span> <span class="main">∧</span> <span class="main"><span class="free">[[</span></span><span class="free">b</span> <span class="free">c</span> <span class="skolem">c'</span><span class="main"><span class="free">]]</span></span>›</span></span> <span class="quoted"><span class="quoted">‹path <span class="skolem">de</span> <span class="free">d</span> <span class="free">e</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d'</span></span> <span class="skolem"><span class="skolem">d'e</span></span> <span class="keyword2"><span class="keyword">where</span></span> d'_in_ab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d'</span> <span class="main">∈</span> <span class="var">?ab</span>"</span></span>
                     <span class="keyword2"><span class="keyword">and</span></span> bdd'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">b</span> <span class="free">d</span> <span class="skolem">d'</span><span class="main"><span class="free">]]</span></span>"</span></span>
                     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"path <span class="skolem">d'e</span> <span class="skolem">d'</span> <span class="free">e</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> unreachable_bounded_path <span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> ab<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="var">?ab</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> e<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">e</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">b</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> d<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">d</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">a</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> S<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">S</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> be<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">be</span></span><span class="main">]</span>
        S_neq_ab <span class="quoted"><span class="quoted">‹<span class="main">¬</span>path_ex <span class="free">d</span> <span class="free">e</span>›</span></span> abd path_S path_ab path_be
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="skolem">d'</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> abd <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"path_ex <span class="free">c</span> <span class="free">e</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ce</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"path <span class="skolem">ce</span> <span class="free">c</span> <span class="free">e</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">∈</span> <span class="var">?ab</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> abc betw_c_in_path path_ab <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="skolem">d'</span><span class="main"><span class="free">]]</span></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">d'</span> <span class="main">∈</span> <span class="var">?ab</span>›</span></span> <span class="quoted"><span class="quoted">‹path <span class="skolem">ce</span> <span class="free">c</span> <span class="free">e</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span> <span class="main">∈</span> <span class="var">?ab</span>›</span></span> <span class="quoted"><span class="quoted">‹path <span class="skolem">d'e</span> <span class="skolem">d'</span> <span class="free">e</span>›</span></span> abc abc_sym dbc
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> abc_bcd_acd bdd'<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c'</span></span> <span class="skolem"><span class="skolem">c'e</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span><span class="main">∈</span><span class="var">?ab</span> <span class="main">∧</span> path <span class="skolem">c'e</span> <span class="skolem">c'</span> <span class="free">e</span> <span class="main">∧</span> <span class="main"><span class="free">[[</span></span><span class="free">b</span> <span class="free">c</span> <span class="skolem">c'</span><span class="main"><span class="free">]]</span></span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> unreachable_bounded_path <span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> ab<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="var">?ab</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> e<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">e</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">b</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> d<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">c</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">a</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> S<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">S</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> be<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">be</span></span><span class="main">]</span>
          S_neq_ab <span class="quoted"><span class="quoted">‹<span class="main">¬</span><span class="main">(</span>path_ex <span class="free">c</span> <span class="free">e</span><span class="main">)</span>›</span></span> abc path_S path_ab path_be
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="skolem">c'</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="main"><span class="free">[[</span></span><span class="free">d</span> <span class="free">b</span> <span class="skolem">c'</span><span class="main"><span class="free">]]</span></span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> abc dbc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="skolem">c'</span> <span class="free">b</span> <span class="free">a</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="main"><span class="free">[[</span></span><span class="skolem">c'</span> <span class="free">b</span> <span class="free">d</span><span class="main"><span class="free">]]</span></span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> theorem1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="skolem">d'</span><span class="main"><span class="free">]]</span></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c'</span> <span class="main">∈</span> <span class="var">?ab</span> <span class="main">∧</span> path <span class="skolem">c'e</span> <span class="skolem">c'</span> <span class="free">e</span> <span class="main">∧</span> <span class="main"><span class="free">[[</span></span><span class="free">b</span> <span class="free">c</span> <span class="skolem">c'</span><span class="main"><span class="free">]]</span></span>›</span></span> <span class="quoted"><span class="quoted">‹path <span class="skolem">d'e</span> <span class="skolem">d'</span> <span class="free">e</span>›</span></span> bdd' d'_in_ab
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">}</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="TemporalOrderOnPath-exist_f'_alt"><span class="command">lemma</span></span> exist_f'_alt<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> path_ab<span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="free">ab</span> <span class="free">a</span> <span class="free">b</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> path_S<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∈</span> <span class="free">𝒫</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> a_inS<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">S</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> e_inS<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">∈</span> <span class="free">S</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> e_neq_a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">≠</span> <span class="free">a</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> f_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">e</span> <span class="free">c'</span> <span class="free">f</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">∈</span><span class="free">c'e</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> S_neq_ab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">≠</span> <span class="free">ab</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> c'd'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c'</span><span class="main">∈</span><span class="free">ab</span> <span class="main">∧</span> <span class="free">d'</span><span class="main">∈</span><span class="free">ab</span>
            <span class="main">∧</span> <span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="free">d'</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="main"><span class="free">[[</span></span><span class="free">c'</span> <span class="free">b</span> <span class="free">a</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="main"><span class="free">[[</span></span><span class="free">c'</span> <span class="free">b</span> <span class="free">d'</span><span class="main"><span class="free">]]</span></span>
            <span class="main">∧</span> path <span class="free">d'e</span> <span class="free">d'</span> <span class="free">e</span> <span class="main">∧</span> path <span class="free">c'e</span> <span class="free">c'</span> <span class="free">e</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">f'</span><span class="main">.</span> <span class="main">∃</span><span class="bound">f'b</span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="free">e</span> <span class="free">c'</span> <span class="bound">f'</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> path <span class="bound">f'b</span> <span class="bound">f'</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">bf</span><span class="main">.</span> path <span class="bound">bf</span> <span class="free">b</span> <span class="free">f</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="free">e</span> <span class="free">c'</span> <span class="free">f</span><span class="main"><span class="free">]]</span></span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">bf</span><span class="main">.</span> path <span class="bound">bf</span> <span class="free">b</span> <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="main">∅</span> <span class="free">c'e</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1-5<span class="main">,</span>7-9<span class="main">)</span> abc_abc_neq betw_events eq_paths unreachable_bounded_path_only
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c'</span> <span class="main">∈</span> <span class="free">c'e</span> <span class="main">-</span> <span class="main">∅</span> <span class="free">c'e</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> c'd'_def cross_in_reachable path_ab <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">∈</span><span class="free">ℰ</span> <span class="main">∧</span> <span class="free">b</span><span class="main">∉</span><span class="free">c'e</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">∈</span> <span class="main">∅</span> <span class="free">c'e</span> <span class="free">b</span>›</span></span> betw_events c'd'_def same_empty_unreach <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f'</span></span> <span class="keyword2"><span class="keyword">where</span></span> f'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">c'</span> <span class="free">f</span> <span class="skolem">f'</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span><span class="main">∈</span><span class="free">c'e</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span><span class="main">∉</span> <span class="main">∅</span> <span class="free">c'e</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">c'</span><span class="main">≠</span><span class="skolem">f'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">≠</span><span class="skolem">f'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> unreachable_set_bounded c'd'_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> DiffE<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">e</span> <span class="free">c'</span> <span class="skolem">f'</span><span class="main"><span class="free">]]</span></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="free">e</span> <span class="free">c'</span> <span class="free">f</span><span class="main"><span class="free">]]</span></span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f'b</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"path <span class="skolem">f'b</span> <span class="skolem">f'</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">∈</span> <span class="free">ℰ</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">∉</span> <span class="free">c'e</span>›</span></span> c'd'_def f'_def<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> unreachable_bounded_path_only
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="TemporalOrderOnPath-exist_f'"><span class="command">lemma</span></span> exist_f'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> path_ab<span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="free">ab</span> <span class="free">a</span> <span class="free">b</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> path_S<span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="free">S</span> <span class="free">a</span> <span class="free">e</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> f_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">e</span> <span class="free">c'</span> <span class="free">f</span><span class="main"><span class="free">]]</span></span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> S_neq_ab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">≠</span> <span class="free">ab</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> c'd'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="free">d'</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">c'</span> <span class="free">b</span> <span class="free">a</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">c'</span> <span class="free">b</span> <span class="free">d'</span><span class="main"><span class="free">]]</span></span>"</span></span>
            <span class="quoted"><span class="quoted">"path <span class="free">d'e</span> <span class="free">d'</span> <span class="free">e</span>"</span></span> <span class="quoted"><span class="quoted">"path <span class="free">c'e</span> <span class="free">c'</span> <span class="free">e</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">f'</span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="free">e</span> <span class="free">c'</span> <span class="bound">f'</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> path_ex <span class="bound">f'</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"path_ex <span class="free">b</span> <span class="free">f</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> f_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> no_path<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>path_ex <span class="free">b</span> <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> path_S_2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∈</span> <span class="free">𝒫</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">≠</span> <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> path_S <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">∈</span><span class="free">c'e</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> betw_c_in_path f_def c'd'_def<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c'</span><span class="main">∈</span> <span class="free">ab</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">d'</span><span class="main">∈</span> <span class="free">ab</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> betw_a_in_path betw_c_in_path c'd'_def<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> path_ab <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="main">∅</span> <span class="free">c'e</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> no_path assms<span class="main">(</span>1<span class="main">,</span>4-9<span class="main">)</span> path_S_2 <span class="quoted"><span class="quoted">‹<span class="free">f</span><span class="main">∈</span><span class="free">c'e</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c'</span><span class="main">∈</span><span class="free">ab</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">d'</span><span class="main">∈</span><span class="free">ab</span>›</span></span>
      abc_abc_neq betw_events eq_paths unreachable_bounded_path_only
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c'</span> <span class="main">∈</span> <span class="free">c'e</span> <span class="main">-</span> <span class="main">∅</span> <span class="free">c'e</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> c'd'_def cross_in_reachable path_ab <span class="quoted"><span class="quoted">‹<span class="free">c'</span> <span class="main">∈</span> <span class="free">ab</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">∈</span><span class="free">ℰ</span> <span class="main">∧</span> <span class="free">b</span><span class="main">∉</span><span class="free">c'e</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">∈</span> <span class="main">∅</span> <span class="free">c'e</span> <span class="free">b</span>›</span></span> betw_events c'd'_def same_empty_unreach <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f'</span></span> <span class="keyword2"><span class="keyword">where</span></span> f'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">c'</span> <span class="free">f</span> <span class="skolem">f'</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span><span class="main">∈</span><span class="free">c'e</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span><span class="main">∉</span> <span class="main">∅</span> <span class="free">c'e</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">c'</span><span class="main">≠</span><span class="skolem">f'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">≠</span><span class="skolem">f'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> unreachable_set_bounded c'd'_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> DiffE<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">e</span> <span class="free">c'</span> <span class="skolem">f'</span><span class="main"><span class="free">]]</span></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="free">e</span> <span class="free">c'</span> <span class="free">f</span><span class="main"><span class="free">]]</span></span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f'b</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"path <span class="skolem">f'b</span> <span class="skolem">f'</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">∈</span> <span class="free">ℰ</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">∉</span> <span class="free">c'e</span>›</span></span> c'd'_def f'_def<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> unreachable_bounded_path_only
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="TemporalOrderOnPath-abc_abd_bcdbdc"><span class="command">lemma</span></span> abc_abd_bcdbdc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> abc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> abd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="free">d</span><span class="main"><span class="free">]]</span></span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> c_neq_d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">≠</span> <span class="free">d</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">b</span> <span class="free">c</span> <span class="free">d</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">b</span> <span class="free">d</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main"><span class="free">[[</span></span><span class="free">d</span> <span class="free">b</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> notI<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> dbc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">d</span> <span class="free">b</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span>"</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ab</span></span> <span class="keyword2"><span class="keyword">where</span></span> path_ab<span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="skolem">ab</span> <span class="free">a</span> <span class="free">b</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> abc_abc_neq abc_ex_path_unique abc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">S</span></span> <span class="keyword2"><span class="keyword">where</span></span> path_S<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">∈</span> <span class="free">𝒫</span>"</span></span> 
               <span class="keyword2"><span class="keyword">and</span></span> S_neq_ab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">≠</span> <span class="skolem">ab</span>"</span></span>
               <span class="keyword2"><span class="keyword">and</span></span> a_inS<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="skolem">S</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ex_crossing_at path_ab
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="comment1">(* This is not as immediate as Schutz presents it. *)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">e</span><span class="main">∈</span><span class="skolem">S</span><span class="main">.</span> <span class="bound">e</span> <span class="main">≠</span> <span class="free">a</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">be</span><span class="main">∈</span><span class="free">𝒫</span><span class="main">.</span> path <span class="bound">be</span> <span class="free">b</span> <span class="bound">e</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> b_notinS<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∉</span> <span class="skolem">S</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> S_neq_ab a_inS path_S path_ab path_unique <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> x_in_unreach<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">∅</span> <span class="skolem">S</span> <span class="free">b</span>"</span></span>
                        <span class="keyword2"><span class="keyword">and</span></span> y_in_unreach<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="main">∅</span> <span class="skolem">S</span> <span class="free">b</span>"</span></span>
                        <span class="keyword2"><span class="keyword">and</span></span> x_neq_y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">y</span>"</span></span>
                        <span class="keyword2"><span class="keyword">and</span></span> z_in_reach<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="skolem">S</span> <span class="main">-</span> <span class="main">∅</span> <span class="skolem">S</span> <span class="free">b</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> two_in_unreach <span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> Q <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">S</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> b <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">b</span></span><span class="main">]</span>
          in_path_event path_S path_ab a_inS cross_in_reachable
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">w</span></span> <span class="keyword2"><span class="keyword">where</span></span> w_in_reach<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> <span class="skolem">S</span> <span class="main">-</span> <span class="main">∅</span> <span class="skolem">S</span> <span class="free">b</span>"</span></span>
                      <span class="keyword2"><span class="keyword">and</span></span> w_neq_z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">≠</span> <span class="skolem">z</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> unreachable_set_bounded <span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> Q <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">S</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> b <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">b</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> Qx <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> Qy <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span>
                b_notinS in_path_event path_S path_ab <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> DiffD1 b_notinS in_path_event path_S path_ab reachable_path z_in_reach<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="skolem"><span class="skolem">be</span></span> <span class="keyword2"><span class="keyword">where</span></span> e_inS<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">∈</span> <span class="skolem">S</span>"</span></span>
                       <span class="keyword2"><span class="keyword">and</span></span> e_neq_a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">≠</span> <span class="free">a</span>"</span></span>
                       <span class="keyword2"><span class="keyword">and</span></span> path_be<span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="skolem">be</span> <span class="free">b</span> <span class="skolem">e</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> path_ae<span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="skolem">S</span> <span class="free">a</span> <span class="skolem">e</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> a_inS e_inS e_neq_a path_S <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> S_neq_ab_2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">≠</span> path_of <span class="free">a</span> <span class="free">b</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> S_neq_ab cross_once_notin path_ab path_of_ex <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="comment1">(* Obtain c' and d' as in Schutz (there called c* and d* ) *)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">c'</span> <span class="bound">d'</span><span class="main">.</span>
              <span class="bound">c'</span><span class="main">∈</span><span class="skolem">ab</span> <span class="main">∧</span> <span class="bound">d'</span><span class="main">∈</span><span class="skolem">ab</span>
            <span class="main">∧</span> <span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="bound">d'</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="main"><span class="free">[[</span></span><span class="bound">c'</span> <span class="free">b</span> <span class="free">a</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="main"><span class="free">[[</span></span><span class="bound">c'</span> <span class="free">b</span> <span class="bound">d'</span><span class="main"><span class="free">]]</span></span>
            <span class="main">∧</span> path_ex <span class="bound">d'</span> <span class="skolem">e</span> <span class="main">∧</span> path_ex <span class="bound">c'</span> <span class="skolem">e</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> exist_c'd' <span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">a</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">b</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> c<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">c</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> d<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">d</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> e<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> be<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">be</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> S<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">S</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1-2<span class="main">)</span> dbc e_neq_a path_ae path_be S_neq_ab_2
      <span class="keyword1"><span class="command">using</span></span> abc_sym betw_a_in_path path_ab <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c'</span></span> <span class="skolem"><span class="skolem">d'</span></span> <span class="skolem"><span class="skolem">d'e</span></span> <span class="skolem"><span class="skolem">c'e</span></span>
      <span class="keyword2"><span class="keyword">where</span></span> c'd'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span><span class="main">∈</span><span class="skolem">ab</span> <span class="main">∧</span> <span class="skolem">d'</span><span class="main">∈</span><span class="skolem">ab</span>
            <span class="main">∧</span> <span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="skolem">d'</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="main"><span class="free">[[</span></span><span class="skolem">c'</span> <span class="free">b</span> <span class="free">a</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="main"><span class="free">[[</span></span><span class="skolem">c'</span> <span class="free">b</span> <span class="skolem">d'</span><span class="main"><span class="free">]]</span></span>
            <span class="main">∧</span> path <span class="skolem">d'e</span> <span class="skolem">d'</span> <span class="skolem">e</span> <span class="main">∧</span> path <span class="skolem">c'e</span> <span class="skolem">c'</span> <span class="skolem">e</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="comment1">(* Now obtain f' (called f* in Schutz) *)</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> f_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span><span class="main">∈</span><span class="skolem">c'e</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="skolem">e</span> <span class="skolem">c'</span> <span class="skolem">f</span><span class="main"><span class="free">]]</span></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> c'd'_def prolong_betw2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f'</span></span> <span class="skolem"><span class="skolem">f'b</span></span> <span class="keyword2"><span class="keyword">where</span></span> f'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="skolem">e</span> <span class="skolem">c'</span> <span class="skolem">f'</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> path <span class="skolem">f'b</span> <span class="skolem">f'</span> <span class="free">b</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> exist_f'
        <span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> e<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> c'<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">c'</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">b</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> f<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> S<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">S</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> ab<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">ab</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> d'<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">d'</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">a</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> c'e<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">c'e</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">using</span></span> path_ab path_S a_inS e_inS e_neq_a f_def S_neq_ab c'd'_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="comment1">(* Now we follow Schutz, who follows Veblen. *)</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ae</span></span> <span class="keyword2"><span class="keyword">where</span></span> path_ae<span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="skolem">ae</span> <span class="free">a</span> <span class="skolem">e</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a_inS e_inS e_neq_a path_S <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> tri_aec<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">△</span> <span class="free">a</span> <span class="skolem">e</span> <span class="skolem">c'</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> cross_once_notin S_neq_ab a_inS abc abc_abc_neq abc_ex_path
                e_inS e_neq_a path_S path_ab c'd'_def paths_tri<span class="main">)</span>
    <span class="comment1">(* The second collinearity theorem doesn't explicitly capture the fact that it meets at
       ae, so Schutz misspoke, but maybe that's an issue with the statement of the theorem. *)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="keyword2"><span class="keyword">where</span></span> h_in_f'b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> <span class="skolem">f'b</span>"</span></span>
                    <span class="keyword2"><span class="keyword">and</span></span> ahe<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="skolem">h</span> <span class="skolem">e</span><span class="main"><span class="free">]]</span></span>"</span></span>
                    <span class="keyword2"><span class="keyword">and</span></span> f'bh<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="skolem">f'</span> <span class="free">b</span> <span class="skolem">h</span><span class="main"><span class="free">]]</span></span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> collinearity2 <span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> a <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">a</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> b <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> c <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">c'</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> d <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">f'</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> e <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">b</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> de <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">f'b</span></span><span class="main">]</span>
              f'_def c'd'_def f'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> tri_dec<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">△</span> <span class="skolem">d'</span> <span class="skolem">e</span> <span class="skolem">c'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> cross_once_notin S_neq_ab a_inS abc abc_abc_neq abc_ex_path
                e_inS e_neq_a path_S path_ab c'd'_def paths_tri <span class="keyword1"><span class="command">by</span></span> <span class="operator">smt</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> g_in_f'b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="skolem">f'b</span>"</span></span>
                    <span class="keyword2"><span class="keyword">and</span></span> d'ge<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="skolem">d'</span> <span class="skolem">g</span> <span class="skolem">e</span><span class="main"><span class="free">]]</span></span>"</span></span>
                    <span class="keyword2"><span class="keyword">and</span></span> f'bg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="skolem">f'</span> <span class="free">b</span> <span class="skolem">g</span><span class="main"><span class="free">]]</span></span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> collinearity2 <span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> a <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">d'</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> b <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> c <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">c'</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> d <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">f'</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> e <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">b</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> de <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">f'b</span></span><span class="main">]</span>
              f'_def c'd'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">△</span> <span class="skolem">e</span> <span class="free">a</span> <span class="skolem">d'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> betw_c_in_path paths_tri2 S_neq_ab a_inS abc_ac_neq
                           abd e_inS e_neq_a c'd'_def path_S path_ab<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">using</span></span> tri_betw_no_path <span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> a <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> b <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">a</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> c <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">d'</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> b' <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> a' <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">b</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> c' <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">h</span></span><span class="main">]</span>
        f'_def c'd'_def h_in_f'b g_in_f'b abd d'ge ahe abc_sym
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> abc abc_abc_neq abc_ex_path abc_sym abd c_neq_d cross_once_notin some_betw<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="comment1">(* Lemma 2-3.6. *)</span>
<span class="keyword1" id="TemporalOrderOnPath-abc_abd_acdadc"><span class="command">lemma</span></span> abc_abd_acdadc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> abc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> abd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="free">d</span><span class="main"><span class="free">]]</span></span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> c_neq_d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">≠</span> <span class="free">d</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">c</span> <span class="free">d</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">d</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> cba<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">c</span> <span class="free">b</span> <span class="free">a</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> abc_sym abc <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> dba<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">d</span> <span class="free">b</span> <span class="free">a</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> abc_sym abd <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="comment1">(* This goes through so easily because the overlapping betweenness axiom is an intro rule.
     Adding it here to more closely match Schutz. *)</span>
  <span class="keyword1"><span class="command">have</span></span> dcb_over_cba<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">d</span> <span class="free">c</span> <span class="free">b</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="main"><span class="free">[[</span></span><span class="free">c</span> <span class="free">b</span> <span class="free">a</span><span class="main"><span class="free">]]</span></span> <span class="main">⟹</span> <span class="main"><span class="free">[[</span></span><span class="free">d</span> <span class="free">c</span> <span class="free">a</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> cdb_over_dba<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">c</span> <span class="free">d</span> <span class="free">b</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="main"><span class="free">[[</span></span><span class="free">d</span> <span class="free">b</span> <span class="free">a</span><span class="main"><span class="free">]]</span></span> <span class="main">⟹</span> <span class="main"><span class="free">[[</span></span><span class="free">c</span> <span class="free">d</span> <span class="free">a</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> bcdbdc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">b</span> <span class="free">c</span> <span class="free">d</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">b</span> <span class="free">d</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> abc abc_abd_bcdbdc abd c_neq_d <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> dcb_or_cdb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">d</span> <span class="free">c</span> <span class="free">b</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">c</span> <span class="free">d</span> <span class="free">b</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> abc_sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">d</span> <span class="free">c</span> <span class="free">a</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">c</span> <span class="free">d</span> <span class="free">a</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> abc_only_cba dcb_over_cba cdb_over_dba cba dba <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> abc_sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* Lemma 3-3.6. *)</span>
<span class="keyword1" id="TemporalOrderOnPath-abc_acd_bcd"><span class="command">lemma</span></span> abc_acd_bcd<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> abc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> acd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">c</span> <span class="free">d</span><span class="main"><span class="free">]]</span></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">b</span> <span class="free">c</span> <span class="free">d</span><span class="main"><span class="free">]]</span></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> path_abc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">Q</span><span class="main">∈</span><span class="free">𝒫</span><span class="main">.</span> <span class="free">a</span> <span class="main">∈</span> <span class="bound">Q</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">∈</span> <span class="bound">Q</span> <span class="main">∧</span> <span class="free">c</span> <span class="main">∈</span> <span class="bound">Q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> abc <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abc_ex_path<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> path_acd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">Q</span><span class="main">∈</span><span class="free">𝒫</span><span class="main">.</span> <span class="free">a</span> <span class="main">∈</span> <span class="bound">Q</span> <span class="main">∧</span> <span class="free">c</span> <span class="main">∈</span> <span class="bound">Q</span> <span class="main">∧</span> <span class="free">d</span> <span class="main">∈</span> <span class="bound">Q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> acd <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abc_ex_path<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">Q</span><span class="main">∈</span><span class="free">𝒫</span><span class="main">.</span> <span class="free">b</span> <span class="main">∈</span> <span class="bound">Q</span> <span class="main">∧</span> <span class="free">c</span> <span class="main">∈</span> <span class="bound">Q</span> <span class="main">∧</span> <span class="free">d</span> <span class="main">∈</span> <span class="bound">Q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> path_abc abc_abc_neq acd cross_once_notin <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span> 
  <span class="comment1">(* Schutz implicitly assumes this. *)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> bcd3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">b</span> <span class="free">c</span> <span class="free">d</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">b</span> <span class="free">d</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">c</span> <span class="free">b</span> <span class="free">d</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> abc abc_only_cba<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span> acd some_betw2<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main"><span class="free">[[</span></span><span class="free">b</span> <span class="free">c</span> <span class="free">d</span><span class="main"><span class="free">]]</span></span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">b</span> <span class="free">d</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">c</span> <span class="free">b</span> <span class="free">d</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bcd3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> disjE<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">b</span> <span class="free">d</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">c</span> <span class="free">d</span> <span class="free">b</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> abc_sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">c</span> <span class="free">b</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> acd abc_bcd_abd <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> abc abc_only_cba <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> cbd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">c</span> <span class="free">b</span> <span class="free">d</span><span class="main"><span class="free">]]</span></span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> cba<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">c</span> <span class="free">b</span> <span class="free">a</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> abc abc_sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> a_neq_d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> abc_ac_neq acd <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">c</span> <span class="free">a</span> <span class="free">d</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">c</span> <span class="free">d</span> <span class="free">a</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> abc_abd_acdadc cbd cba <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> abc_only_cba acd <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  A few lemmas that don't seem to be proved by Schutz, but can be proven now, after Lemma 3.
  These sometimes avoid us having to construct a chain explicitly.
›</span></span>
<span class="keyword1" id="TemporalOrderOnPath-abd_bcd_abc"><span class="command">lemma</span></span> abd_bcd_abc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> abd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="free">d</span><span class="main"><span class="free">]]</span></span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> bcd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">b</span> <span class="free">c</span> <span class="free">d</span><span class="main"><span class="free">]]</span></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> dcb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">d</span> <span class="free">c</span> <span class="free">b</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> abc_sym bcd <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> dba<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">d</span> <span class="free">b</span> <span class="free">a</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> abc_sym abd <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">c</span> <span class="free">b</span> <span class="free">a</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> abc_acd_bcd dcb dba <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> abc_sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="TemporalOrderOnPath-abc_acd_abd"><span class="command">lemma</span></span> abc_acd_abd<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> abc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> acd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">c</span> <span class="free">d</span><span class="main"><span class="free">]]</span></span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="free">d</span><span class="main"><span class="free">]]</span></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> abc abc_acd_bcd acd <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="TemporalOrderOnPath-abd_acd_abcacb"><span class="command">lemma</span></span> abd_acd_abcacb<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> abd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="free">d</span><span class="main"><span class="free">]]</span></span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> acd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">c</span> <span class="free">d</span><span class="main"><span class="free">]]</span></span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> bc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">≠</span><span class="free">c</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">c</span> <span class="free">b</span><span class="main"><span class="free">]]</span></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">P</span></span> <span class="keyword2"><span class="keyword">where</span></span> P_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span><span class="main">∈</span><span class="free">𝒫</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">∈</span><span class="skolem">P</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">∈</span><span class="skolem">P</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span><span class="main">∈</span><span class="skolem">P</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> abd abc_ex_path <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">∈</span><span class="skolem">P</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> acd abc_abc_neq betw_b_in_path <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main"><span class="free">[[</span></span><span class="free">b</span> <span class="free">a</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> abc_only_cba abd acd <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> P_def<span class="main"><span class="main">(</span></span>1-3<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span> <span class="main">∈</span> <span class="skolem">P</span>›</span></span> abc_abc_neq abc_sym abd acd bc some_betw<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="TemporalOrderOnPath-abe_ade_bcd_ace"><span class="command">lemma</span></span> abe_ade_bcd_ace<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> abe<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="free">e</span><span class="main"><span class="free">]]</span></span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> ade<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">d</span> <span class="free">e</span><span class="main"><span class="free">]]</span></span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> bcd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">b</span> <span class="free">c</span> <span class="free">d</span><span class="main"><span class="free">]]</span></span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">c</span> <span class="free">e</span><span class="main"><span class="free">]]</span></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> abdadb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="free">d</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">d</span> <span class="free">b</span><span class="main"><span class="free">]]</span></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> abc_ac_neq abd_acd_abcacb abe ade bcd <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="free">d</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> abc_acd_abd abc_sym ade bcd<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">d</span> <span class="free">b</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> abc_acd_abd abc_sym abe bcd<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Now we start on Theorem 9. Based on Veblen (1904) Lemma 2 p357.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> MinkowskiBetweenness<span class="main">)</span> chain3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> path_Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">∈</span> <span class="free">𝒫</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> a_inQ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">Q</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> b_inQ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> <span class="free">Q</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> c_inQ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">∈</span> <span class="free">Q</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> abc_neq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">≠</span> <span class="free">c</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">≠</span> <span class="free">c</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ch <span class="main">{</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">,</span><span class="free">c</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> abc_betw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">c</span> <span class="free">b</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">b</span> <span class="free">a</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> in_path_event abc_sym some_betw insert_subset<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> ch1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span> <span class="main">⟶</span> ch <span class="main">{</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">,</span><span class="free">c</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> abc_abc_neq ch_by_ord_def ch_def ord_ordered between_chain <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> ch2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">c</span> <span class="free">b</span><span class="main"><span class="free">]]</span></span> <span class="main">⟶</span> ch <span class="main">{</span><span class="free">a</span><span class="main">,</span><span class="free">c</span><span class="main">,</span><span class="free">b</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> abc_abc_neq ch_by_ord_def ch_def ord_ordered between_chain <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> ch3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">b</span> <span class="free">a</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span> <span class="main">⟶</span> ch <span class="main">{</span><span class="free">b</span><span class="main">,</span><span class="free">a</span><span class="main">,</span><span class="free">c</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> abc_abc_neq ch_by_ord_def ch_def ord_ordered between_chain <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> abc_betw ch1 ch2 ch3 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> insert_commute<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The book introduces Theorem 9 before the above three lemmas but can only complete the proof
  once they are proven.
  This doesn't exactly say it the same way as the book, as the book gives the ordering (abcd)
  explicitly (for arbitrarly named events), but is equivalent.
›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> <span class="comment1">(*9*)</span> chain4<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> path_Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">∈</span> <span class="free">𝒫</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> inQ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">Q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> <span class="free">Q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">∈</span> <span class="free">Q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">∈</span> <span class="free">Q</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> abcd_neq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">≠</span> <span class="free">c</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">≠</span> <span class="free">d</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">≠</span> <span class="free">c</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">≠</span> <span class="free">d</span> <span class="main">∧</span> <span class="free">c</span> <span class="main">≠</span> <span class="free">d</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ch <span class="main">{</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">,</span><span class="free">c</span><span class="main">,</span><span class="free">d</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a'</span></span> <span class="skolem"><span class="skolem">b'</span></span> <span class="skolem"><span class="skolem">c'</span></span> <span class="keyword2"><span class="keyword">where</span></span> a'_pick<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">,</span><span class="free">c</span><span class="main">,</span><span class="free">d</span><span class="main">}</span>"</span></span>
                    <span class="keyword2"><span class="keyword">and</span></span> b'_pick<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b'</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">,</span><span class="free">c</span><span class="main">,</span><span class="free">d</span><span class="main">}</span>"</span></span>
                    <span class="keyword2"><span class="keyword">and</span></span> c'_pick<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">,</span><span class="free">c</span><span class="main">,</span><span class="free">d</span><span class="main">}</span>"</span></span>
                    <span class="keyword2"><span class="keyword">and</span></span> a'b'c'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="skolem">a'</span> <span class="skolem">b'</span> <span class="skolem">c'</span><span class="main"><span class="free">]]</span></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> some_betw <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inQ<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">,</span></span>4<span class="main"><span class="main">)</span></span> abcd_neq insert_iff path_Q<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d'</span></span> <span class="keyword2"><span class="keyword">where</span></span> d'_neq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d'</span> <span class="main">≠</span> <span class="skolem">a'</span> <span class="main">∧</span> <span class="skolem">d'</span> <span class="main">≠</span> <span class="skolem">b'</span> <span class="main">∧</span> <span class="skolem">d'</span> <span class="main">≠</span> <span class="skolem">c'</span>"</span></span>
                   <span class="keyword2"><span class="keyword">and</span></span> d'_pick<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d'</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">,</span><span class="free">c</span><span class="main">,</span><span class="free">d</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> insert_iff abcd_neq <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">have</span></span> all_picked_on_path<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span><span class="main">∈</span><span class="free">Q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b'</span><span class="main">∈</span><span class="free">Q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span><span class="main">∈</span><span class="free">Q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d'</span><span class="main">∈</span><span class="free">Q</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a'_pick b'_pick c'_pick d'_pick inQ <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="skolem">d'</span> <span class="skolem">a'</span> <span class="skolem">b'</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="skolem">a'</span> <span class="skolem">d'</span> <span class="skolem">b'</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="skolem">a'</span> <span class="skolem">b'</span> <span class="skolem">d'</span><span class="main"><span class="free">]]</span></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> some_betw abc_only_cba all_picked_on_path<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>4<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a'b'c' d'_neq path_Q<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> picked_chain<span class="main">:</span> <span class="quoted"><span class="quoted">"ch <span class="main">{</span><span class="skolem">a'</span><span class="main">,</span><span class="skolem">b'</span><span class="main">,</span><span class="skolem">c'</span><span class="main">,</span><span class="skolem">d'</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="skolem">d'</span> <span class="skolem">a'</span> <span class="skolem">b'</span><span class="main"><span class="free">]]</span></span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> a'b'c' overlap_chain <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> insert_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a'd'b'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="skolem">a'</span> <span class="skolem">d'</span> <span class="skolem">b'</span><span class="main"><span class="free">]]</span></span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="skolem">d'</span> <span class="skolem">b'</span> <span class="skolem">c'</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> abc_acd_bcd a'b'c' <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> a'd'b' overlap_chain <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> insert_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a'b'd'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="skolem">a'</span> <span class="skolem">b'</span> <span class="skolem">d'</span><span class="main"><span class="free">]]</span></span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> two_cases<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="skolem">b'</span> <span class="skolem">c'</span> <span class="skolem">d'</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="skolem">b'</span> <span class="skolem">d'</span> <span class="skolem">c'</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> abc_abd_bcdbdc a'b'c' d'_neq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="comment1">(* Doing it this way avoids SMT. *)</span>
    <span class="keyword1"><span class="command">have</span></span> case1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="skolem">b'</span> <span class="skolem">c'</span> <span class="skolem">d'</span><span class="main"><span class="free">]]</span></span> <span class="main">⟹</span> <span class="var">?thesis</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a'b'c' overlap_chain <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> case2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="skolem">b'</span> <span class="skolem">d'</span> <span class="skolem">c'</span><span class="main"><span class="free">]]</span></span> <span class="main">⟹</span> <span class="var">?thesis</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> abc_only_cba abc_acd_bcd a'b'd' overlap_chain
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> insert_commute<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> two_cases case1 case2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">a'</span><span class="main">,</span><span class="skolem">b'</span><span class="main">,</span><span class="skolem">c'</span><span class="main">,</span><span class="skolem">d'</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">,</span><span class="free">c</span><span class="main">,</span><span class="free">d</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Set.set_eqI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> iffI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">a'</span><span class="main">,</span><span class="skolem">b'</span><span class="main">,</span><span class="skolem">c'</span><span class="main">,</span><span class="skolem">d'</span><span class="main">}</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">,</span><span class="free">c</span><span class="main">,</span><span class="free">d</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a'_pick b'_pick c'_pick d'_pick <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> x_pick<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">,</span><span class="free">c</span><span class="main">,</span><span class="free">d</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span> <span class="main">≠</span> <span class="skolem">b'</span> <span class="main">∧</span> <span class="skolem">a'</span> <span class="main">≠</span> <span class="skolem">c'</span> <span class="main">∧</span> <span class="skolem">a'</span> <span class="main">≠</span> <span class="skolem">d'</span> <span class="main">∧</span> <span class="skolem">b'</span> <span class="main">≠</span> <span class="skolem">c'</span> <span class="main">∧</span> <span class="skolem">c'</span> <span class="main">≠</span> <span class="skolem">d'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> a'b'c' abc_abc_neq d'_neq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">a'</span><span class="main">,</span><span class="skolem">b'</span><span class="main">,</span><span class="skolem">c'</span><span class="main">,</span><span class="skolem">d'</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> a'_pick b'_pick c'_pick d'_pick x_pick d'_neq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> picked_chain <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context MinkowskiSpacetime *)</span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Interlude - Chains and Equivalences"</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  This section is meant for our alternative definitions of chains, and proofs of equivalence.
  If we want to regain full independence of our axioms, we probably need to shuffle a few
  things around. Some of this may be redundant, but is kept for compatibility with legacy proofs.

  Three definitions are given (cf `Betweenness: Chains` in Minkowski.thy):
   - one relying on explicit betweenness conditions
   - one relying on a total ordering and explicit indexing
   - one equivalent to the above except for use of the weaker, local-only ordering2
›</span></span>

<span class="keyword1"><span class="command">context</span></span> MinkowskiChain <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Proofs for totally ordered index-chains"</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"General results"</span></span>

<span class="keyword1" id="TemporalOrderOnPath-inf_chain_is_long"><span class="command">lemma</span></span> inf_chain_is_long<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"semifin_chain <span class="free">f</span> <span class="free">x</span> <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"long_ch_by_ord <span class="free">f</span> <span class="free">X</span> <span class="main">∧</span> <span class="free">f</span> <span class="main">0</span> <span class="main">=</span> <span class="free">x</span> <span class="main">∧</span> infinite <span class="free">X</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"infinite <span class="free">X</span> <span class="main">⟶</span> card <span class="free">X</span> <span class="main">≠</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> card.infinite <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"semifin_chain <span class="free">f</span> <span class="free">x</span> <span class="free">X</span> <span class="main">⟶</span> long_ch_by_ord <span class="free">f</span> <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> long_ch_by_ord_def semifin_chain_def short_ch_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms semifin_chain_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹A reassurance that the starting point $x$ is implied.›</span></span>
<span class="keyword1" id="TemporalOrderOnPath-long_inf_chain_is_semifin"><span class="command">lemma</span></span> long_inf_chain_is_semifin<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"long_ch_by_ord <span class="free">f</span> <span class="free">X</span> <span class="main">∧</span> infinite <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">x</span><span class="main">.</span> <span class="main">[</span><span class="free">f</span><span class="main">[</span><span class="bound">x</span><span class="main">..]</span><span class="free">X</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms semifin_chain_def<span class="main">)</span>

<span class="keyword1" id="TemporalOrderOnPath-endpoint_in_semifin"><span class="command">lemma</span></span> endpoint_in_semifin<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"semifin_chain <span class="free">f</span> <span class="free">x</span> <span class="free">X</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">∈</span><span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms semifin_chain_def zero_into_ordering inf_chain_is_long long_ch_by_ord_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> finite.emptyI<span class="main">)</span>

<span class="keyword1" id="TemporalOrderOnPath-three_in_long_chain"><span class="command">lemma</span></span> three_in_long_chain<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"long_ch_by_ord <span class="free">f</span> <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">x</span> <span class="free">y</span> <span class="free">z</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">∈</span><span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main">∈</span><span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span><span class="main">∈</span><span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">≠</span><span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">≠</span><span class="free">z</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main">≠</span><span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> long_ch_by_ord_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"Index-chains lie on paths"</span></span>

<span class="keyword1" id="TemporalOrderOnPath-all_aligned_on_semifin_chain"><span class="command">lemma</span></span> all_aligned_on_semifin_chain<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">f</span><span class="main">[</span><span class="free">x</span><span class="main">..]</span><span class="free">X</span><span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main">∈</span><span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">z</span><span class="main">∈</span><span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> xy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">≠</span><span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> xz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">≠</span><span class="free">z</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> yz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main">≠</span><span class="free">z</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">x</span> <span class="free">y</span> <span class="free">z</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">x</span> <span class="free">z</span> <span class="free">y</span><span class="main"><span class="free">]]</span></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n<span class="hidden">⇩</span><sub>y</sub></span></span> <span class="skolem"><span class="skolem">n<span class="hidden">⇩</span><sub>z</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">n<span class="hidden">⇩</span><sub>y</sub></span> <span class="main">=</span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">n<span class="hidden">⇩</span><sub>z</sub></span> <span class="main">=</span> <span class="free">z</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> TernaryOrdering.ordering_def a assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> b inf_chain_is_long long_ch_by_ord_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span><span class="main">&lt;</span><span class="skolem">n<span class="hidden">⇩</span><sub>y</sub></span> <span class="main">∧</span> <span class="skolem">n<span class="hidden">⇩</span><sub>y</sub></span><span class="main">&lt;</span><span class="skolem">n<span class="hidden">⇩</span><sub>z</sub></span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">0</span><span class="main">&lt;</span><span class="skolem">n<span class="hidden">⇩</span><sub>z</sub></span> <span class="main">∧</span> <span class="skolem">n<span class="hidden">⇩</span><sub>z</sub></span><span class="main">&lt;</span><span class="skolem">n<span class="hidden">⇩</span><sub>y</sub></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="skolem">n<span class="hidden">⇩</span><sub>y</sub></span> <span class="main">=</span> <span class="free">y</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="skolem">n<span class="hidden">⇩</span><sub>z</sub></span> <span class="main">=</span> <span class="free">z</span>›</span></span> assms less_linear semifin_chain_def xy xz yz  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">n<span class="hidden">⇩</span><sub>y</sub></span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">n<span class="hidden">⇩</span><sub>z</sub></span><span class="main">)</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">n<span class="hidden">⇩</span><sub>z</sub></span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">n<span class="hidden">⇩</span><sub>y</sub></span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ordering_def assms<span class="main">(</span>1<span class="main">)</span> long_ch_by_ord_def semifin_chain_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> long_ch_by_ord_def<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">x</span> <span class="free">y</span> <span class="free">z</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">x</span> <span class="free">z</span> <span class="free">y</span><span class="main"><span class="free">]]</span></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="skolem">n<span class="hidden">⇩</span><sub>y</sub></span> <span class="main">=</span> <span class="free">y</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="skolem">n<span class="hidden">⇩</span><sub>z</sub></span> <span class="main">=</span> <span class="free">z</span>›</span></span> assms semifin_chain_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="TemporalOrderOnPath-semifin_chain_on_path"><span class="command">lemma</span></span> semifin_chain_on_path<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">f</span><span class="main">[</span><span class="free">x</span><span class="main">..]</span><span class="free">X</span><span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">P</span><span class="main">∈</span><span class="free">𝒫</span><span class="main">.</span> <span class="free">X</span><span class="main">⊆</span><span class="bound">P</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">∈</span><span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">≠</span><span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms inf_chain_is_long
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Diff_iff all_not_in_conv finite_Diff2 finite_insert infinite_imp_nonempty insert_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> path_exists<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">P</span><span class="main">∈</span><span class="free">𝒫</span><span class="main">.</span> path <span class="bound">P</span> <span class="free">x</span> <span class="skolem">y</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span><span class="main">∈</span><span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span><span class="main">≠</span><span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span><span class="main">≠</span><span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">x</span> <span class="skolem">y</span> <span class="skolem">e</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">x</span> <span class="skolem">e</span> <span class="skolem">y</span><span class="main"><span class="free">]]</span></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> all_aligned_on_semifin_chain inf_chain_is_long long_ch_by_ord_def assms
            ordering_def lessI <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> <span class="free">X</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">≠</span> <span class="free">x</span>›</span></span> finite.emptyI finite_insert
            finite_subset insert_iff subsetI
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">smt</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">P</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"path <span class="skolem">P</span> <span class="free">x</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="free">x</span> <span class="skolem">y</span> <span class="skolem">e</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">x</span> <span class="skolem">e</span> <span class="skolem">y</span><span class="main"><span class="free">]]</span></span>›</span></span> abc_abc_neq abc_ex_path
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹path <span class="skolem">P</span> <span class="free">x</span> <span class="skolem">y</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">P</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"path <span class="skolem">P</span> <span class="free">x</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> path_exists
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span><span class="main">⊆</span><span class="skolem">P</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">e</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span><span class="main">∈</span><span class="free">X</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span><span class="main">∈</span><span class="skolem">P</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span><span class="main">=</span><span class="free">x</span> <span class="main">∨</span> <span class="skolem">e</span><span class="main">=</span><span class="skolem">y</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">e</span><span class="main">≠</span><span class="free">x</span> <span class="main">∧</span> <span class="skolem">e</span><span class="main">≠</span><span class="skolem">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span><span class="main">≠</span><span class="free">x</span> <span class="main">∧</span> <span class="skolem">e</span><span class="main">≠</span><span class="skolem">y</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">x</span> <span class="skolem">y</span> <span class="skolem">e</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">x</span> <span class="skolem">e</span> <span class="skolem">y</span><span class="main"><span class="free">]]</span></span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> all_aligned_on_semifin_chain assms
                <span class="quoted"><span class="quoted">‹<span class="skolem">e</span> <span class="main">∈</span> <span class="free">X</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">e</span> <span class="main">≠</span> <span class="free">x</span> <span class="main">∧</span> <span class="skolem">e</span> <span class="main">≠</span> <span class="skolem">y</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> <span class="free">X</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">≠</span> <span class="free">x</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹path <span class="skolem">P</span> <span class="free">x</span> <span class="skolem">y</span>›</span></span> abc_ex_path path_unique
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span><span class="main">=</span><span class="free">x</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">e</span> <span class="main">=</span> <span class="free">x</span>›</span></span> <span class="quoted"><span class="quoted">‹path <span class="skolem">P</span> <span class="free">x</span> <span class="skolem">y</span>›</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span><span class="main">=</span><span class="skolem">y</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span><span class="main">∈</span><span class="skolem">P</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">e</span> <span class="main">=</span> <span class="skolem">y</span>›</span></span> <span class="quoted"><span class="quoted">‹path <span class="skolem">P</span> <span class="free">x</span> <span class="skolem">y</span>›</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹path <span class="skolem">P</span> <span class="free">x</span> <span class="skolem">y</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="TemporalOrderOnPath-card2_either_elt1_or_elt2"><span class="command">lemma</span></span> card2_either_elt1_or_elt2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"card <span class="free">X</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">∈</span><span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main">∈</span><span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">≠</span><span class="free">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span><span class="main">∈</span><span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span><span class="main">≠</span><span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span><span class="main">=</span><span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms card_2_iff'<span class="main">)</span>

<span class="keyword1" id="TemporalOrderOnPath-short_chain_on_path"><span class="command">lemma</span></span> short_chain_on_path<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"short_ch <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">P</span><span class="main">∈</span><span class="free">𝒫</span><span class="main">.</span> <span class="free">X</span><span class="main">⊆</span><span class="bound">P</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">≠</span><span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">∈</span><span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms short_ch_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">P</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"path <span class="skolem">P</span> <span class="skolem">x</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">X</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">y</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> <span class="free">X</span>›</span></span> assms short_ch_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span><span class="main">⊆</span><span class="skolem">P</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span><span class="main">∈</span><span class="free">X</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span><span class="main">∈</span><span class="skolem">P</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span><span class="main">=</span><span class="skolem">x</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span><span class="main">∈</span><span class="skolem">P</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹path <span class="skolem">P</span> <span class="skolem">x</span> <span class="skolem">y</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z</span><span class="main">=</span><span class="skolem">x</span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span><span class="main">≠</span><span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span><span class="main">=</span><span class="skolem">y</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span><span class="main">∈</span><span class="free">X</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span><span class="main">∈</span><span class="free">X</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z</span><span class="main">≠</span><span class="skolem">x</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z</span><span class="main">∈</span><span class="free">X</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span><span class="main">≠</span><span class="skolem">y</span>›</span></span> assms short_ch_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span><span class="main">∈</span><span class="skolem">P</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹path <span class="skolem">P</span> <span class="skolem">x</span> <span class="skolem">y</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z</span><span class="main">=</span><span class="skolem">y</span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹path <span class="skolem">P</span> <span class="skolem">x</span> <span class="skolem">y</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="TemporalOrderOnPath-all_aligned_on_long_chain"><span class="command">lemma</span></span> all_aligned_on_long_chain<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"long_ch_by_ord <span class="free">f</span> <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">∈</span><span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main">∈</span><span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">z</span><span class="main">∈</span><span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> xy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">≠</span><span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> xz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">≠</span><span class="free">z</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> yz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main">≠</span><span class="free">z</span>"</span></span> 
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">x</span> <span class="free">y</span> <span class="free">z</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">x</span> <span class="free">z</span> <span class="free">y</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">z</span> <span class="free">x</span> <span class="free">y</span><span class="main"><span class="free">]]</span></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n<span class="hidden">⇩</span><sub>x</sub></span></span> <span class="skolem"><span class="skolem">n<span class="hidden">⇩</span><sub>y</sub></span></span> <span class="skolem"><span class="skolem">n<span class="hidden">⇩</span><sub>z</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> fx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">n<span class="hidden">⇩</span><sub>x</sub></span> <span class="main">=</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> fy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">n<span class="hidden">⇩</span><sub>y</sub></span> <span class="main">=</span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> fz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">n<span class="hidden">⇩</span><sub>z</sub></span> <span class="main">=</span> <span class="free">z</span>"</span></span>
                    <span class="keyword2"><span class="keyword">and</span></span> xx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n<span class="hidden">⇩</span><sub>x</sub></span> <span class="main">&lt;</span> card <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> yy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n<span class="hidden">⇩</span><sub>y</sub></span> <span class="main">&lt;</span> card <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> zz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n<span class="hidden">⇩</span><sub>z</sub></span> <span class="main">&lt;</span> card <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n<span class="hidden">⇩</span><sub>x</sub></span> <span class="bound">n<span class="hidden">⇩</span><sub>y</sub></span> <span class="bound">n<span class="hidden">⇩</span><sub>z</sub></span><span class="main">.</span> <span class="main">⟦</span><span class="free">f</span> <span class="bound">n<span class="hidden">⇩</span><sub>x</sub></span> <span class="main">=</span> <span class="free">x</span><span class="main">;</span> <span class="free">f</span> <span class="bound">n<span class="hidden">⇩</span><sub>y</sub></span> <span class="main">=</span> <span class="free">y</span><span class="main">;</span> <span class="free">f</span> <span class="bound">n<span class="hidden">⇩</span><sub>z</sub></span> <span class="main">=</span> <span class="free">z</span><span class="main">;</span> <span class="bound">n<span class="hidden">⇩</span><sub>x</sub></span> <span class="main">&lt;</span> card <span class="free">X</span><span class="main">;</span> <span class="bound">n<span class="hidden">⇩</span><sub>y</sub></span> <span class="main">&lt;</span> card <span class="free">X</span><span class="main">;</span> <span class="bound">n<span class="hidden">⇩</span><sub>z</sub></span> <span class="main">&lt;</span> card <span class="free">X</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="skolem">thesis</span>"</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">nn</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="main">(</span>nat <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">A</span> <span class="bound">f</span> <span class="bound">p</span> <span class="bound">pa</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span> <span class="main">∉</span> <span class="bound">A</span> <span class="main">∨</span> <span class="main">¬</span> ordering <span class="bound">f</span> <span class="bound">p</span> <span class="bound">A</span> <span class="main">∨</span> <span class="bound">f</span> <span class="main">(</span><span class="skolem">nn</span> <span class="bound">A</span> <span class="bound">f</span> <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> <span class="bound">a</span><span class="main">)</span>
                  <span class="main">∧</span> <span class="main">(</span>infinite <span class="bound">A</span> <span class="main">∨</span> <span class="bound">a</span> <span class="main">∉</span> <span class="bound">A</span> <span class="main">∨</span> <span class="main">¬</span> ordering <span class="bound">f</span> <span class="bound">pa</span> <span class="bound">A</span> <span class="main">∨</span> <span class="skolem">nn</span> <span class="bound">A</span> <span class="bound">f</span> <span class="bound">a</span> <span class="main">&lt;</span> card <span class="bound">A</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> ordering_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> a1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> b c long_ch_by_ord_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> less_or<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">n<span class="hidden">⇩</span><sub>x</sub></span><span class="main">&lt;</span><span class="skolem">n<span class="hidden">⇩</span><sub>y</sub></span> <span class="main">∧</span> <span class="skolem">n<span class="hidden">⇩</span><sub>y</sub></span><span class="main">&lt;</span><span class="skolem">n<span class="hidden">⇩</span><sub>z</sub></span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">n<span class="hidden">⇩</span><sub>x</sub></span><span class="main">&lt;</span><span class="skolem">n<span class="hidden">⇩</span><sub>z</sub></span> <span class="main">∧</span> <span class="skolem">n<span class="hidden">⇩</span><sub>z</sub></span><span class="main">&lt;</span><span class="skolem">n<span class="hidden">⇩</span><sub>y</sub></span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">n<span class="hidden">⇩</span><sub>z</sub></span><span class="main">&lt;</span><span class="skolem">n<span class="hidden">⇩</span><sub>x</sub></span> <span class="main">∧</span> <span class="skolem">n<span class="hidden">⇩</span><sub>x</sub></span><span class="main">&lt;</span><span class="skolem">n<span class="hidden">⇩</span><sub>y</sub></span><span class="main">)</span> <span class="main">∨</span>
        <span class="main">(</span><span class="skolem">n<span class="hidden">⇩</span><sub>z</sub></span><span class="main">&lt;</span><span class="skolem">n<span class="hidden">⇩</span><sub>y</sub></span> <span class="main">∧</span> <span class="skolem">n<span class="hidden">⇩</span><sub>y</sub></span><span class="main">&lt;</span><span class="skolem">n<span class="hidden">⇩</span><sub>x</sub></span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">n<span class="hidden">⇩</span><sub>y</sub></span><span class="main">&lt;</span><span class="skolem">n<span class="hidden">⇩</span><sub>z</sub></span> <span class="main">∧</span> <span class="skolem">n<span class="hidden">⇩</span><sub>z</sub></span><span class="main">&lt;</span><span class="skolem">n<span class="hidden">⇩</span><sub>x</sub></span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">n<span class="hidden">⇩</span><sub>y</sub></span><span class="main">&lt;</span><span class="skolem">n<span class="hidden">⇩</span><sub>x</sub></span> <span class="main">∧</span> <span class="skolem">n<span class="hidden">⇩</span><sub>x</sub></span><span class="main">&lt;</span><span class="skolem">n<span class="hidden">⇩</span><sub>z</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> fx fy fz assms less_linear
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">have</span></span> int_imp_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">n<span class="hidden">⇩</span><sub>x</sub></span><span class="main">&lt;</span><span class="skolem">n<span class="hidden">⇩</span><sub>y</sub></span> <span class="main">∧</span> <span class="skolem">n<span class="hidden">⇩</span><sub>y</sub></span><span class="main">&lt;</span><span class="skolem">n<span class="hidden">⇩</span><sub>z</sub></span><span class="main">)</span> <span class="main">∧</span> long_ch_by_ord <span class="free">f</span> <span class="free">X</span> <span class="main">∧</span> <span class="skolem">n<span class="hidden">⇩</span><sub>z</sub></span> <span class="main">&lt;</span> card <span class="free">X</span> <span class="main">⟶</span> <span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="skolem">n<span class="hidden">⇩</span><sub>x</sub></span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">n<span class="hidden">⇩</span><sub>y</sub></span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">n<span class="hidden">⇩</span><sub>z</sub></span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms long_ch_by_ord_def ordering_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="skolem">n<span class="hidden">⇩</span><sub>x</sub></span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">n<span class="hidden">⇩</span><sub>y</sub></span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">n<span class="hidden">⇩</span><sub>z</sub></span><span class="main">)</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="skolem">n<span class="hidden">⇩</span><sub>x</sub></span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">n<span class="hidden">⇩</span><sub>z</sub></span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">n<span class="hidden">⇩</span><sub>y</sub></span><span class="main">)</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="skolem">n<span class="hidden">⇩</span><sub>z</sub></span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">n<span class="hidden">⇩</span><sub>x</sub></span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">n<span class="hidden">⇩</span><sub>y</sub></span><span class="main">)</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span>
         <span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="skolem">n<span class="hidden">⇩</span><sub>z</sub></span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">n<span class="hidden">⇩</span><sub>y</sub></span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">n<span class="hidden">⇩</span><sub>x</sub></span><span class="main">)</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="skolem">n<span class="hidden">⇩</span><sub>y</sub></span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">n<span class="hidden">⇩</span><sub>z</sub></span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">n<span class="hidden">⇩</span><sub>x</sub></span><span class="main">)</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="skolem">n<span class="hidden">⇩</span><sub>y</sub></span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">n<span class="hidden">⇩</span><sub>x</sub></span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">n<span class="hidden">⇩</span><sub>z</sub></span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span> <span class="bound">na</span> <span class="bound">nb</span><span class="main">.</span> <span class="main">¬</span> <span class="bound">n</span> <span class="main">&lt;</span> <span class="bound">na</span> <span class="main">∨</span> <span class="main">¬</span> <span class="bound">nb</span> <span class="main">&lt;</span> <span class="bound">n</span> <span class="main">∨</span> <span class="main">¬</span> <span class="bound">na</span> <span class="main">&lt;</span> card <span class="free">X</span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="bound">nb</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="bound">na</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> ordering_def <span class="quoted"><span class="quoted">‹long_ch_by_ord <span class="free">f</span> <span class="free">X</span>›</span></span> long_ch_by_ord_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">n<span class="hidden">⇩</span><sub>z</sub></span> <span class="main">&lt;</span> <span class="skolem">n<span class="hidden">⇩</span><sub>y</sub></span> <span class="main">∨</span> <span class="main">¬</span> <span class="skolem">n<span class="hidden">⇩</span><sub>x</sub></span> <span class="main">&lt;</span> <span class="skolem">n<span class="hidden">⇩</span><sub>z</sub></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">x</span> <span class="free">z</span> <span class="free">y</span><span class="main"><span class="free">]]</span></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> fx fy fz yy
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">n<span class="hidden">⇩</span><sub>x</sub></span> <span class="main">&lt;</span> <span class="skolem">n<span class="hidden">⇩</span><sub>y</sub></span> <span class="main">∨</span> <span class="main">¬</span> <span class="skolem">n<span class="hidden">⇩</span><sub>z</sub></span> <span class="main">&lt;</span> <span class="skolem">n<span class="hidden">⇩</span><sub>x</sub></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">z</span> <span class="free">x</span> <span class="free">y</span><span class="main"><span class="free">]]</span></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f1 fx fy fz yy <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> f2 f1 fx fy fz less_or xx zz <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">x</span> <span class="free">y</span> <span class="free">z</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">x</span> <span class="free">z</span> <span class="free">y</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">z</span> <span class="free">x</span> <span class="free">y</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span>
         <span class="main"><span class="free">[[</span></span><span class="free">z</span> <span class="free">y</span> <span class="free">x</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">y</span> <span class="free">z</span> <span class="free">x</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">y</span> <span class="free">x</span> <span class="free">z</span><span class="main"><span class="free">]]</span></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> fx fy fz assms semifin_chain_def long_ch_by_ord_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> abc_sym
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="TemporalOrderOnPath-long_chain_on_path"><span class="command">lemma</span></span> long_chain_on_path<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"long_ch_by_ord <span class="free">f</span> <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">P</span><span class="main">∈</span><span class="free">𝒫</span><span class="main">.</span> <span class="free">X</span><span class="main">⊆</span><span class="bound">P</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">∈</span><span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">≠</span><span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> long_ch_by_ord_def assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span><span class="main">∈</span><span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">≠</span><span class="skolem">z</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">≠</span><span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> long_ch_by_ord_def assms
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="skolem">x</span> <span class="skolem">z</span> <span class="skolem">y</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="skolem">z</span> <span class="skolem">x</span> <span class="skolem">y</span><span class="main"><span class="free">]]</span></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> all_aligned_on_long_chain assms
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">X</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">z</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> <span class="free">X</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">≠</span> <span class="skolem">x</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">≠</span> <span class="skolem">z</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z</span> <span class="main">∈</span> <span class="free">X</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> path_exists<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">P</span><span class="main">∈</span><span class="free">𝒫</span><span class="main">.</span> path <span class="bound">P</span> <span class="skolem">x</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> all_aligned_on_long_chain abc_ex_path
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">≠</span> <span class="skolem">x</span>›</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">P</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"path <span class="skolem">P</span> <span class="skolem">x</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> path_exists
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span><span class="main">⊆</span><span class="skolem">P</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">e</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span><span class="main">∈</span><span class="free">X</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span><span class="main">∈</span><span class="skolem">P</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span><span class="main">=</span><span class="skolem">x</span> <span class="main">∨</span> <span class="skolem">e</span><span class="main">=</span><span class="skolem">y</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">e</span><span class="main">≠</span><span class="skolem">x</span> <span class="main">∧</span> <span class="skolem">e</span><span class="main">≠</span><span class="skolem">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span><span class="main">≠</span><span class="skolem">x</span> <span class="main">∧</span> <span class="skolem">e</span><span class="main">≠</span><span class="skolem">y</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">e</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="skolem">x</span> <span class="skolem">e</span> <span class="skolem">y</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="skolem">e</span> <span class="skolem">x</span> <span class="skolem">y</span><span class="main"><span class="free">]]</span></span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> all_aligned_on_long_chain all_aligned_on_long_chain assms
                <span class="quoted"><span class="quoted">‹<span class="skolem">e</span> <span class="main">∈</span> <span class="free">X</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">e</span> <span class="main">≠</span> <span class="skolem">x</span> <span class="main">∧</span> <span class="skolem">e</span> <span class="main">≠</span> <span class="skolem">y</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> <span class="free">X</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">≠</span> <span class="skolem">x</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span><span class="main">∈</span><span class="free">X</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹path <span class="skolem">P</span> <span class="skolem">x</span> <span class="skolem">y</span>›</span></span> abc_ex_path path_unique
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span><span class="main">=</span><span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">e</span> <span class="main">=</span> <span class="skolem">x</span>›</span></span> <span class="quoted"><span class="quoted">‹path <span class="skolem">P</span> <span class="skolem">x</span> <span class="skolem">y</span>›</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span><span class="main">=</span><span class="skolem">y</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span><span class="main">∈</span><span class="skolem">P</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">e</span> <span class="main">=</span> <span class="skolem">y</span>›</span></span> <span class="quoted"><span class="quoted">‹path <span class="skolem">P</span> <span class="skolem">x</span> <span class="skolem">y</span>›</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹path <span class="skolem">P</span> <span class="skolem">x</span> <span class="skolem">y</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Notice that this whole proof would be unnecessary if including path-belongingness in the
  definition, as Schutz does. This would also keep path-belongingness independent of axiom O1 and O4,
  thus enabling an independent statement of axiom O6, which perhaps we now lose. In exchange,
  our definition is slightly weaker (for <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>card X ≥ 3›</span></span></span></span> and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>infinite X›</span></span></span></span>).
›</span></span>

<span class="keyword1" id="TemporalOrderOnPath-chain_on_path"><span class="command">lemma</span></span> chain_on_path<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ch_by_ord <span class="free">f</span> <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">P</span><span class="main">∈</span><span class="free">𝒫</span><span class="main">.</span> <span class="free">X</span><span class="main">⊆</span><span class="bound">P</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms ch_by_ord_def
  <span class="keyword1"><span class="command">using</span></span> semifin_chain_on_path long_chain_on_path short_chain_on_path long_inf_chain_is_semifin
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"More general results"</span></span>

<span class="comment1">(* In fact, it is xor. *)</span>
<span class="keyword1" id="TemporalOrderOnPath-ch_some_betw"><span class="command">lemma</span></span> ch_some_betw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">x</span> <span class="main">∈</span> <span class="free">X</span><span class="main">;</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">X</span><span class="main">;</span> <span class="free">z</span> <span class="main">∈</span> <span class="free">X</span><span class="main">;</span> <span class="free">x</span> <span class="main">≠</span> <span class="free">y</span><span class="main">;</span> <span class="free">x</span> <span class="main">≠</span> <span class="free">z</span><span class="main">;</span> <span class="free">y</span> <span class="main">≠</span> <span class="free">z</span><span class="main">;</span> ch <span class="free">X</span><span class="main">⟧</span>
        <span class="main">⟹</span> <span class="main"><span class="free">[[</span></span><span class="free">x</span> <span class="free">y</span> <span class="free">z</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">y</span> <span class="free">x</span> <span class="free">z</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">y</span> <span class="free">z</span> <span class="free">x</span><span class="main"><span class="free">]]</span></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∈</span> <span class="free">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="free">z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≠</span> <span class="free">z</span>"</span></span> <span class="quoted"><span class="quoted">"ch <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="keyword3"><span class="command">assume</span></span> f_def<span class="main">:</span> <span class="quoted"><span class="quoted">"long_ch_by_ord <span class="skolem">f</span> <span class="free">X</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> evts<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∈</span> <span class="free">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="free">z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≠</span> <span class="free">z</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> ords<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main"><span class="free">[[</span></span><span class="free">x</span> <span class="free">y</span> <span class="free">z</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main"><span class="free">[[</span></span><span class="free">y</span> <span class="free">z</span> <span class="free">x</span><span class="main"><span class="free">]]</span></span>"</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">P</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span><span class="main">⊆</span><span class="skolem">P</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span><span class="main">∈</span><span class="free">𝒫</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> chain_on_path f_def ch_by_ord_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">y</span> <span class="free">x</span> <span class="free">z</span><span class="main"><span class="free">]]</span></span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">A</span> <span class="bound">Aa</span> <span class="bound">a</span><span class="main">.</span> <span class="main">¬</span> <span class="bound">A</span> <span class="main">⊆</span> <span class="bound">Aa</span> <span class="main">∨</span> <span class="main">(</span><span class="bound">a</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">∉</span> <span class="bound">A</span> <span class="main">∨</span> <span class="bound">a</span> <span class="main">∈</span> <span class="bound">Aa</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> f2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="skolem">P</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">X</span> <span class="main">⊆</span> <span class="skolem">P</span>›</span></span> evts<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> f3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="skolem">P</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> f1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="free">X</span> <span class="main">⊆</span> <span class="skolem">P</span>›</span></span> evts<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∈</span> <span class="skolem">P</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">X</span> <span class="main">⊆</span> <span class="skolem">P</span>›</span></span> evts<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> f3 f2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> some_betw_xor <span class="quoted"><span class="quoted">‹<span class="skolem">P</span> <span class="main">∈</span> <span class="free">𝒫</span>›</span></span> abc_sym evts<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">,</span></span>5<span class="main"><span class="main">,</span></span>6<span class="main"><span class="main">)</span></span> ords<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> ch_def long_ch_by_ord_def ch_by_ord_def ordering_def short_ch_def
    <span class="keyword1"><span class="command">using</span></span> asm ch_by_ord_def ch_def short_ch_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">f</span><span class="main">.</span> <span class="main">⟦</span>long_ch_by_ord <span class="bound">f</span> <span class="free">X</span><span class="main">;</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">X</span><span class="main">;</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">X</span><span class="main">;</span> <span class="free">z</span> <span class="main">∈</span> <span class="free">X</span><span class="main">;</span> <span class="free">x</span> <span class="main">≠</span> <span class="free">y</span><span class="main">;</span> <span class="free">x</span> <span class="main">≠</span> <span class="free">z</span><span class="main">;</span> <span class="free">y</span> <span class="main">≠</span> <span class="free">z</span><span class="main">;</span>
      <span class="main">¬</span> <span class="main"><span class="free">[[</span></span><span class="free">x</span> <span class="free">y</span> <span class="free">z</span><span class="main"><span class="free">]]</span></span><span class="main">;</span> <span class="main">¬</span> <span class="main"><span class="free">[[</span></span><span class="free">y</span> <span class="free">z</span> <span class="free">x</span><span class="main"><span class="free">]]</span></span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main"><span class="free">[[</span></span><span class="free">y</span> <span class="free">x</span> <span class="free">z</span><span class="main"><span class="free">]]</span></span>›</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="TemporalOrderOnPath-ch_all_betw_f"><span class="command">lemma</span></span> ch_all_betw_f<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">f</span><span class="main">[</span><span class="free">x</span><span class="main">..</span><span class="free">yy</span><span class="main">..</span><span class="free">z</span><span class="main">]</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main">∈</span><span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main">≠</span><span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main">≠</span><span class="free">z</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">x</span> <span class="free">y</span> <span class="free">z</span><span class="main"><span class="free">]]</span></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main"><span class="free">[[</span></span><span class="free">x</span> <span class="free">y</span> <span class="free">z</span><span class="main"><span class="free">]]</span></span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span><span class="main">∈</span><span class="free">𝒫</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">∈</span><span class="skolem">Q</span> <span class="main">∧</span> <span class="free">y</span><span class="main">∈</span><span class="skolem">Q</span> <span class="main">∧</span> <span class="free">z</span><span class="main">∈</span><span class="skolem">Q</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> chain_on_path assms ch_by_ord_def asm fin_ch_betw fin_long_chain_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">x</span> <span class="free">y</span> <span class="free">z</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">y</span> <span class="free">x</span> <span class="free">z</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">y</span> <span class="free">z</span> <span class="free">x</span><span class="main"><span class="free">]]</span></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> some_betw assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> abc_sym fin_long_chain_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">y</span> <span class="free">x</span> <span class="free">z</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">x</span> <span class="free">z</span> <span class="free">y</span><span class="main"><span class="free">]]</span></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> asm abc_sym
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">using</span></span> fin_long_chain_def long_ch_by_ord_def asm assms fin_ch_betw
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* potential misnomer: Schutz defines bounds only for infinite chains *)</span>
<span class="keyword1" id="TemporalOrderOnPath-get_fin_long_ch_bounds"><span class="command">lemma</span></span> get_fin_long_ch_bounds<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"long_ch_by_ord <span class="free">f</span> <span class="free">X</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> <span class="main">∃</span><span class="bound">y</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> <span class="main">∃</span><span class="bound">z</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> <span class="main">[</span><span class="free">f</span><span class="main">[</span><span class="bound">x</span><span class="main">..</span><span class="bound">y</span><span class="main">..</span><span class="bound">z</span><span class="main">]</span><span class="free">X</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="free">f</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span>card <span class="free">X</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> y_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">≠</span><span class="skolem">x</span> <span class="main">∧</span> <span class="skolem">y</span><span class="main">≠</span><span class="skolem">z</span> <span class="main">∧</span> <span class="skolem">y</span><span class="main">∈</span><span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> long_ch_by_ord_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ordering_def <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">=</span> <span class="free">f</span> <span class="main">0</span>›</span></span> assms<span class="main">(</span>1<span class="main">)</span> long_ch_by_ord_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> card_gt_0_iff equals0D<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span><span class="main">∈</span><span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ordering_def <span class="quoted"><span class="quoted">‹<span class="skolem">z</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span>card <span class="free">X</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>›</span></span> assms<span class="main">(</span>1<span class="main">)</span> long_ch_by_ord_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> card_gt_0_iff equals0D Suc_diff_1 lessI<span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">&lt;</span>card <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">n</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ordering_def y_def long_ch_by_ord_def assms
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> y_def <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="skolem">n</span> <span class="main">=</span> <span class="skolem">y</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">=</span> <span class="free">f</span> <span class="main">0</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> neq0_conv <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">&lt;</span>card <span class="free">X</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> y_def <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="skolem">n</span> <span class="main">=</span> <span class="skolem">y</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">&lt;</span> card <span class="free">X</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span>card <span class="free">X</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>›</span></span> assms<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> card.remove card_Diff_singleton less_SucE<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">f</span><span class="main">[</span><span class="skolem">x</span><span class="main">..</span><span class="skolem">y</span><span class="main">..</span><span class="skolem">z</span><span class="main">]</span><span class="free">X</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> long_ch_by_ord_def y_def <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">=</span> <span class="free">f</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span>card <span class="free">X</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>›</span></span> abc_abc_neq assms ordering_ord_ijk
    <span class="keyword1"><span class="command">unfolding</span></span> fin_long_chain_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> card_gt_0_iff diff_less equals0D zero_less_one<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> points_in_chain
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="TemporalOrderOnPath-get_fin_long_ch_bounds2"><span class="command">lemma</span></span> get_fin_long_ch_bounds2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"long_ch_by_ord <span class="free">f</span> <span class="free">X</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span>
    <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">x</span> <span class="free">y</span> <span class="free">z</span> <span class="free">n<span class="hidden">⇩</span><sub>x</sub></span> <span class="free">n<span class="hidden">⇩</span><sub>y</sub></span> <span class="free">n<span class="hidden">⇩</span><sub>z</sub></span>
    <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">∈</span><span class="free">X</span> <span class="main">∧</span> <span class="free">y</span><span class="main">∈</span><span class="free">X</span> <span class="main">∧</span> <span class="free">z</span><span class="main">∈</span><span class="free">X</span> <span class="main">∧</span> <span class="main">[</span><span class="free">f</span><span class="main">[</span><span class="free">x</span><span class="main">..</span><span class="free">y</span><span class="main">..</span><span class="free">z</span><span class="main">]</span><span class="free">X</span><span class="main">]</span> <span class="main">∧</span> <span class="free">f</span> <span class="free">n<span class="hidden">⇩</span><sub>x</sub></span> <span class="main">=</span> <span class="free">x</span> <span class="main">∧</span> <span class="free">f</span> <span class="free">n<span class="hidden">⇩</span><sub>y</sub></span> <span class="main">=</span> <span class="free">y</span> <span class="main">∧</span> <span class="free">f</span> <span class="free">n<span class="hidden">⇩</span><sub>z</sub></span> <span class="main">=</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> fin_long_chain_def get_fin_long_ch_bounds index_middle_element<span class="main">)</span>

<span class="keyword1" id="TemporalOrderOnPath-long_ch_card_ge3"><span class="command">lemma</span></span> long_ch_card_ge3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ch_by_ord <span class="free">f</span> <span class="free">X</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"long_ch_by_ord <span class="free">f</span> <span class="free">X</span> <span class="main">⟷</span> card <span class="free">X</span> <span class="main">≥</span> <span class="numeral">3</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"long_ch_by_ord <span class="free">f</span> <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">f</span><span class="main">[</span><span class="skolem">a</span><span class="main">..</span><span class="skolem">b</span><span class="main">..</span><span class="skolem">c</span><span class="main">]</span><span class="free">X</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> get_fin_long_ch_bounds assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span> <span class="main">≤</span> card <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> One_nat_def card_eq_0_iff diff_Suc_1 empty_iff
        fin_long_chain_def index_middle_element leI less_3_cases less_one<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span> <span class="main">≤</span> card <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>short_ch <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> short_ch_card_2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"long_ch_by_ord <span class="free">f</span> <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> ch_by_ord_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="TemporalOrderOnPath-chain_bounds_unique"><span class="command">lemma</span></span> chain_bounds_unique<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">f</span><span class="main">[</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">..</span><span class="free">c</span><span class="main">]</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">g</span><span class="main">[</span><span class="free">x</span><span class="main">..</span><span class="free">y</span><span class="main">..</span><span class="free">z</span><span class="main">]</span><span class="free">X</span><span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">=</span><span class="free">x</span> <span class="main">∧</span> <span class="free">c</span><span class="main">=</span><span class="free">z</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">a</span><span class="main">=</span><span class="free">z</span> <span class="main">∧</span> <span class="free">c</span><span class="main">=</span><span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">p</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> <span class="main">(</span><span class="free">a</span> <span class="main">=</span> <span class="bound">p</span> <span class="main">∨</span> <span class="bound">p</span> <span class="main">=</span> <span class="free">c</span><span class="main">)</span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="bound">p</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> ch_all_betw_f <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> abc_abc_neq abc_bcd_abd abc_sym assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span> ch_all_betw_f points_in_chain<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="TemporalOrderOnPath-chain_bounds_unique2"><span class="command">lemma</span></span> chain_bounds_unique2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">f</span><span class="main">[</span><span class="free">a</span><span class="main">..</span><span class="free">c</span><span class="main">]</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">g</span><span class="main">[</span><span class="free">x</span><span class="main">..</span><span class="free">z</span><span class="main">]</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"card <span class="free">X</span> <span class="main">≥</span> <span class="numeral">3</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">=</span><span class="free">x</span> <span class="main">∧</span> <span class="free">c</span><span class="main">=</span><span class="free">z</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">a</span><span class="main">=</span><span class="free">z</span> <span class="main">∧</span> <span class="free">c</span><span class="main">=</span><span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> chain_bounds_unique
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> abc_ac_neq assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span> ch_all_betw_f fin_chain_def points_in_chain short_ch_def<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Chain Equivalences"</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"Betweenness-chains and strong index-chains"</span></span>

<span class="keyword1" id="TemporalOrderOnPath-equiv_chain_1a"><span class="command">lemma</span></span> equiv_chain_1a<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">[[..</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">..</span><span class="free">c</span><span class="main">..]</span><span class="free">X</span><span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">f</span><span class="main">.</span> ch_by_ord <span class="bound">f</span> <span class="free">X</span> <span class="main">∧</span> <span class="free">a</span><span class="main">∈</span><span class="free">X</span> <span class="main">∧</span> <span class="free">b</span><span class="main">∈</span><span class="free">X</span> <span class="main">∧</span> <span class="free">c</span><span class="main">∈</span><span class="free">X</span> <span class="main">∧</span> <span class="free">a</span><span class="main">≠</span><span class="free">b</span> <span class="main">∧</span> <span class="free">a</span><span class="main">≠</span><span class="free">c</span> <span class="main">∧</span> <span class="free">b</span><span class="main">≠</span><span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> in_X<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">∈</span><span class="free">X</span> <span class="main">∧</span> <span class="free">b</span><span class="main">∈</span><span class="free">X</span> <span class="main">∧</span> <span class="free">c</span><span class="main">∈</span><span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms chain_with_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> all_neq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">≠</span><span class="free">c</span> <span class="main">∧</span> <span class="free">a</span><span class="main">≠</span><span class="free">b</span> <span class="main">∧</span> <span class="free">b</span><span class="main">≠</span><span class="free">c</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> abc_abc_neq assms chain_with_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"ordering <span class="skolem">f</span> <span class="free">betw</span> <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms chain_with_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"long_ch_by_ord <span class="skolem">f</span> <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> in_X all_neq long_ch_by_ord_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ch_by_ord <span class="skolem">f</span> <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ch_by_ord_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> all_neq in_X <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="TemporalOrderOnPath-equiv_chain_1b"><span class="command">lemma</span></span> equiv_chain_1b<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ch_by_ord <span class="free">f</span> <span class="free">X</span> <span class="main">∧</span> <span class="free">a</span><span class="main">∈</span><span class="free">X</span> <span class="main">∧</span> <span class="free">b</span><span class="main">∈</span><span class="free">X</span> <span class="main">∧</span> <span class="free">c</span><span class="main">∈</span><span class="free">X</span> <span class="main">∧</span> <span class="free">a</span><span class="main">≠</span><span class="free">b</span> <span class="main">∧</span> <span class="free">a</span><span class="main">≠</span><span class="free">c</span> <span class="main">∧</span> <span class="free">b</span><span class="main">≠</span><span class="free">c</span> <span class="main">∧</span> <span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">[[..</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">..</span><span class="free">c</span><span class="main">..]</span><span class="free">X</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms chain_with_def ch_by_ord_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> long_ch_by_ord_def short_ch_def<span class="main">)</span>


<span class="keyword1" id="TemporalOrderOnPath-equiv_chain_1"><span class="command">lemma</span></span> equiv_chain_1<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">[[..</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">..</span><span class="free">c</span><span class="main">..]</span><span class="free">X</span><span class="main">]</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">f</span><span class="main">.</span> ch_by_ord <span class="bound">f</span> <span class="free">X</span> <span class="main">∧</span> <span class="free">a</span><span class="main">∈</span><span class="free">X</span> <span class="main">∧</span> <span class="free">b</span><span class="main">∈</span><span class="free">X</span> <span class="main">∧</span> <span class="free">c</span><span class="main">∈</span><span class="free">X</span> <span class="main">∧</span> <span class="free">a</span><span class="main">≠</span><span class="free">b</span> <span class="main">∧</span> <span class="free">a</span><span class="main">≠</span><span class="free">c</span> <span class="main">∧</span> <span class="free">b</span><span class="main">≠</span><span class="free">c</span> <span class="main">∧</span> <span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> equiv_chain_1a equiv_chain_1b long_chain_betw
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>


<span class="keyword1" id="TemporalOrderOnPath-index_order"><span class="command">lemma</span></span> index_order<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"chain_with <span class="free">x</span> <span class="free">y</span> <span class="free">z</span> <span class="free">X</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"ch_by_ord <span class="free">f</span> <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">a</span> <span class="main">=</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">b</span> <span class="main">=</span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">c</span> <span class="main">=</span> <span class="free">z</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span> <span class="main">⟶</span> <span class="free">a</span><span class="main">&lt;</span>card <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span> <span class="main">⟶</span> <span class="free">b</span><span class="main">&lt;</span>card <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span> <span class="main">⟶</span> <span class="free">c</span><span class="main">&lt;</span>card <span class="free">X</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">&lt;</span><span class="free">b</span> <span class="main">∧</span> <span class="free">b</span><span class="main">&lt;</span><span class="free">c</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">c</span><span class="main">&lt;</span><span class="free">b</span> <span class="main">∧</span> <span class="free">b</span><span class="main">&lt;</span><span class="free">a</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">&lt;</span> <span class="free">c</span> <span class="main">∨</span> <span class="free">c</span> <span class="main">&lt;</span> <span class="free">b</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">&lt;</span> <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">≥</span><span class="free">b</span> <span class="main">∨</span> <span class="free">b</span><span class="main">≥</span><span class="free">c</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">c</span><span class="main">≥</span><span class="free">b</span> <span class="main">∨</span> <span class="free">b</span><span class="main">≥</span><span class="free">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> all_neq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">≠</span><span class="free">y</span> <span class="main">∧</span> <span class="free">x</span><span class="main">≠</span><span class="free">z</span> <span class="main">∧</span> <span class="free">y</span><span class="main">≠</span><span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> equiv_chain_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> is_long<span class="main">:</span> <span class="quoted"><span class="quoted">"long_ch_by_ord <span class="free">f</span> <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> ch_by_ord_def equiv_chain_1 short_ch_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">≠</span><span class="free">b</span> <span class="main">∧</span> <span class="free">a</span><span class="main">≠</span><span class="free">c</span> <span class="main">∧</span> <span class="free">b</span><span class="main">≠</span><span class="free">c</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> assms<span class="main">(</span>4<span class="main">)</span> assms<span class="main">(</span>5<span class="main">)</span> all_neq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">&gt;</span><span class="free">b</span> <span class="main">∨</span> <span class="free">b</span><span class="main">&gt;</span><span class="free">c</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">c</span><span class="main">&gt;</span><span class="free">b</span> <span class="main">∨</span> <span class="free">b</span><span class="main">&gt;</span><span class="free">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a1 linorder_neqE_nat <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">&gt;</span><span class="free">b</span> <span class="main">∧</span> <span class="free">c</span><span class="main">&gt;</span><span class="free">b</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">b</span><span class="main">&gt;</span><span class="free">c</span> <span class="main">∧</span> <span class="free">b</span><span class="main">&gt;</span><span class="free">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> not_less_iff_gr_or_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">&gt;</span><span class="free">c</span> <span class="main">∨</span> <span class="free">c</span><span class="main">&gt;</span><span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">≠</span> <span class="free">c</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">≠</span> <span class="free">c</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">&gt;</span><span class="free">c</span> <span class="main">∧</span> <span class="free">c</span><span class="main">&gt;</span><span class="free">b</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">a</span><span class="main">&gt;</span><span class="free">c</span> <span class="main">∧</span> <span class="free">b</span><span class="main">&gt;</span><span class="free">a</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">a</span><span class="main">&gt;</span><span class="free">b</span> <span class="main">∧</span> <span class="free">c</span><span class="main">&gt;</span><span class="free">a</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">b</span><span class="main">&gt;</span><span class="free">c</span> <span class="main">∧</span> <span class="free">c</span><span class="main">&gt;</span><span class="free">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">b</span> <span class="main">&lt;</span> <span class="free">a</span> <span class="main">∨</span> <span class="free">c</span> <span class="main">&lt;</span> <span class="free">b</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">b</span> <span class="main">&lt;</span> <span class="free">c</span> <span class="main">∨</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> o1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">b</span><span class="main">&lt;</span><span class="free">c</span> <span class="main">∧</span> <span class="free">c</span><span class="main">&lt;</span><span class="free">a</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">c</span><span class="main">&lt;</span><span class="free">a</span> <span class="main">∧</span> <span class="free">a</span><span class="main">&lt;</span><span class="free">b</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">b</span><span class="main">&lt;</span><span class="free">a</span> <span class="main">∧</span> <span class="free">a</span><span class="main">&lt;</span><span class="free">c</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">a</span><span class="main">&lt;</span><span class="free">c</span> <span class="main">∧</span> <span class="free">c</span><span class="main">&lt;</span><span class="free">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">b</span><span class="main">&lt;</span><span class="free">c</span> <span class="main">∧</span> <span class="free">c</span><span class="main">&lt;</span><span class="free">a</span><span class="main">)</span> <span class="main">⟶</span> <span class="main"><span class="free">[[</span></span><span class="free">y</span> <span class="free">z</span> <span class="free">x</span><span class="main"><span class="free">]]</span></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms ordering_ord_ijk long_ch_by_ord_def is_long
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span> 
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">&lt;</span><span class="free">a</span> <span class="main">∧</span> <span class="free">a</span><span class="main">&lt;</span><span class="free">b</span><span class="main">)</span> <span class="main">⟶</span> <span class="main"><span class="free">[[</span></span><span class="free">z</span> <span class="free">x</span> <span class="free">y</span><span class="main"><span class="free">]]</span></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span>  assms ordering_ord_ijk long_ch_by_ord_def is_long
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">b</span><span class="main">&lt;</span><span class="free">a</span> <span class="main">∧</span> <span class="free">a</span><span class="main">&lt;</span><span class="free">c</span><span class="main">)</span> <span class="main">⟶</span> <span class="main"><span class="free">[[</span></span><span class="free">y</span> <span class="free">x</span> <span class="free">z</span><span class="main"><span class="free">]]</span></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms ordering_ord_ijk long_ch_by_ord_def is_long
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">&lt;</span><span class="free">c</span> <span class="main">∧</span> <span class="free">c</span><span class="main">&lt;</span><span class="free">b</span><span class="main">)</span> <span class="main">⟶</span> <span class="main"><span class="free">[[</span></span><span class="free">x</span> <span class="free">z</span> <span class="free">y</span><span class="main"><span class="free">]]</span></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms ordering_ord_ijk long_ch_by_ord_def is_long
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">y</span> <span class="free">z</span> <span class="free">x</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">z</span> <span class="free">x</span> <span class="free">y</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">y</span> <span class="free">x</span> <span class="free">z</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">x</span> <span class="free">z</span> <span class="free">y</span><span class="main"><span class="free">]]</span></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms long_ch_by_ord_def is_long o1
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> abc_only_cba assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> chain_with_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="TemporalOrderOnPath-old_fin_chain_finite"><span class="command">lemma</span></span> old_fin_chain_finite<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite_chain_with3 <span class="free">x</span> <span class="free">y</span> <span class="free">z</span> <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"infinite <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">∈</span><span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms finite_chain_with3_def chain_with_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main">∈</span><span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms finite_chain_with3_def chain_with_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span><span class="main">∈</span><span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms finite_chain_with3_def chain_with_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"ch_by_ord <span class="skolem">f</span> <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms equiv_chain_1 finite_chain_with3_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">a</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> equiv_chain_1 ordering_def <span class="quoted"><span class="quoted">‹ch_by_ord <span class="skolem">f</span> <span class="free">X</span>›</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ch_by_ord_def finite_chain_with3_def long_ch_by_ord_def short_ch_def<span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">c</span> <span class="main">=</span> <span class="free">z</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">≠</span><span class="skolem">c</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> equiv_chain_1 ordering_def <span class="quoted"><span class="quoted">‹ch_by_ord <span class="skolem">f</span> <span class="free">X</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="skolem">a</span> <span class="main">=</span> <span class="free">x</span>›</span></span> assms
    <span class="keyword1"><span class="command">using</span></span> ch_by_ord_def finite_chain_with3_def long_ch_by_ord_def short_ch_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">b</span> <span class="main">=</span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">≠</span><span class="skolem">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">≠</span><span class="skolem">c</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> equiv_chain_1 ordering_def <span class="quoted"><span class="quoted">‹ch_by_ord <span class="skolem">f</span> <span class="free">X</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="skolem">a</span> <span class="main">=</span> <span class="free">x</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="skolem">c</span> <span class="main">=</span> <span class="free">z</span>›</span></span> assms
    <span class="keyword1"><span class="command">using</span></span> ch_by_ord_def finite_chain_with3_def long_ch_by_ord_def short_ch_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">&lt;</span><span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">&lt;</span><span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹ch_by_ord <span class="skolem">f</span> <span class="free">X</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="skolem">a</span> <span class="main">=</span> <span class="free">x</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="skolem">c</span> <span class="main">=</span> <span class="free">z</span>›</span></span> assms equiv_chain_1 <span class="quoted"><span class="quoted">‹infinite <span class="free">X</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span>  ch_by_ord_def finite_chain_with3_def long_ch_by_ord_def short_ch_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_Suc_eq_le not_le not_less_iff_gr_or_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">x</span> <span class="free">y</span> <span class="free">z</span><span class="main"><span class="free">]]</span></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms chain_with_def finite_chain_with3_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">&lt;</span><span class="skolem">b</span> <span class="main">∧</span> <span class="skolem">b</span><span class="main">&lt;</span><span class="skolem">c</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">c</span><span class="main">&lt;</span><span class="skolem">b</span> <span class="main">∧</span> <span class="skolem">b</span><span class="main">&lt;</span><span class="skolem">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="skolem">a</span> <span class="main">=</span> <span class="free">x</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="skolem">b</span> <span class="main">=</span> <span class="free">y</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="skolem">c</span> <span class="main">=</span> <span class="free">z</span>›</span></span> <span class="quoted"><span class="quoted">‹ch_by_ord <span class="skolem">f</span> <span class="free">X</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span><span class="main">∈</span><span class="free">X</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">y</span><span class="main">∈</span><span class="free">X</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">z</span><span class="main">∈</span><span class="free">X</span>›</span></span> index_order
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹infinite <span class="free">X</span>›</span></span> assms finite_chain_with3_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">&lt;</span><span class="skolem">b</span> <span class="main">∧</span> <span class="skolem">b</span><span class="main">&lt;</span><span class="skolem">c</span> <span class="main">∧</span> <span class="skolem">c</span><span class="main">&lt;</span><span class="skolem">n</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">c</span><span class="main">&lt;</span><span class="skolem">b</span> <span class="main">∧</span> <span class="skolem">b</span><span class="main">&lt;</span><span class="skolem">a</span> <span class="main">∧</span> <span class="skolem">a</span><span class="main">&lt;</span><span class="skolem">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span><span class="main">≠</span><span class="skolem">c</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span><span class="main">≠</span><span class="skolem">b</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span><span class="main">≠</span><span class="skolem">c</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span><span class="main">&lt;</span><span class="skolem">n</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c</span><span class="main">&lt;</span><span class="skolem">n</span>›</span></span> less_linear
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> acn_can<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">b</span><span class="main">&lt;</span><span class="skolem">c</span> <span class="main">∧</span> <span class="skolem">c</span><span class="main">&lt;</span><span class="skolem">n</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">b</span><span class="main">&lt;</span><span class="skolem">a</span> <span class="main">∧</span> <span class="skolem">a</span><span class="main">&lt;</span><span class="skolem">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">n</span> <span class="main">∈</span> <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ordering_def <span class="quoted"><span class="quoted">‹ch_by_ord <span class="skolem">f</span> <span class="free">X</span>›</span></span> <span class="quoted"><span class="quoted">‹infinite <span class="free">X</span>›</span></span> assms ch_by_ord_def equiv_chain_1 finite_chain_with3_def long_ch_by_ord_def short_ch_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> outside<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">y</span> <span class="free">z</span> <span class="main">(</span><span class="skolem">f</span> <span class="skolem">n</span><span class="main">)</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="skolem">f</span> <span class="skolem">n</span><span class="main">)</span> <span class="free">x</span> <span class="free">y</span><span class="main"><span class="free">]]</span></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> acn_can <span class="quoted"><span class="quoted">‹ch_by_ord <span class="skolem">f</span> <span class="free">X</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="skolem">a</span> <span class="main">=</span> <span class="free">x</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="skolem">c</span> <span class="main">=</span> <span class="free">z</span>›</span></span> <span class="quoted"><span class="quoted">‹infinite <span class="free">X</span>›</span></span> assms equiv_chain_1 abc_sym
    <span class="keyword1"><span class="command">using</span></span> ch_by_ord_def finite_chain_with3_def long_ch_by_ord_def ordering_ord_ijk short_ch_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="skolem">b</span> <span class="main">=</span> <span class="free">y</span>›</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="skolem">n</span> <span class="main">∈</span> <span class="free">X</span>›</span></span> assms finite_chain_with3_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="TemporalOrderOnPath-index_from_with3"><span class="command">lemma</span></span> index_from_with3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite_chain_with3 <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">f</span><span class="main">.</span> <span class="main">(</span><span class="bound">f</span> <span class="main">0</span> <span class="main">=</span> <span class="free">a</span> <span class="main">∨</span> <span class="bound">f</span> <span class="main">0</span> <span class="main">=</span> <span class="free">c</span><span class="main">)</span> <span class="main">∧</span> ch_by_ord <span class="bound">f</span> <span class="free">X</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"ch_by_ord <span class="skolem">f</span> <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms equiv_chain_1 finite_chain_with3_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> no_elt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">w</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="bound">w</span> <span class="free">a</span> <span class="free">b</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">b</span> <span class="free">c</span> <span class="bound">w</span><span class="main"><span class="free">]]</span></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms finite_chain_with3_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n<span class="hidden">⇩</span><sub>a</sub></span></span> <span class="skolem"><span class="skolem">n<span class="hidden">⇩</span><sub>b</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">n<span class="hidden">⇩</span><sub>a</sub></span> <span class="main">=</span> <span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n<span class="hidden">⇩</span><sub>a</sub></span> <span class="main">&lt;</span> card <span class="free">X</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">n<span class="hidden">⇩</span><sub>b</sub></span> <span class="main">=</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n<span class="hidden">⇩</span><sub>b</sub></span> <span class="main">&lt;</span> card <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms old_fin_chain_finite ch_by_ord_def ordering_def
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹ch_by_ord <span class="skolem">f</span> <span class="free">X</span>›</span></span> equiv_chain_1 finite_chain_with3_def long_ch_by_ord_def short_ch_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n<span class="hidden">⇩</span><sub>c</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">n<span class="hidden">⇩</span><sub>c</sub></span> <span class="main">=</span> <span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n<span class="hidden">⇩</span><sub>c</sub></span> <span class="main">&lt;</span> card <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms old_fin_chain_finite ch_by_ord_def ordering_def
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹ch_by_ord <span class="skolem">f</span> <span class="free">X</span>›</span></span> equiv_chain_1 finite_chain_with3_def long_ch_by_ord_def short_ch_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">≠</span><span class="free">b</span> <span class="main">∧</span> <span class="free">b</span><span class="main">≠</span><span class="free">c</span> <span class="main">∧</span> <span class="free">a</span><span class="main">≠</span><span class="free">c</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms equiv_chain_1 finite_chain_with3_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">≠</span><span class="free">b</span> <span class="main">⟶</span> <span class="skolem">n<span class="hidden">⇩</span><sub>a</sub></span><span class="main">≠</span><span class="skolem">n<span class="hidden">⇩</span><sub>b</sub></span> <span class="main">∧</span> <span class="free">b</span><span class="main">≠</span><span class="free">c</span> <span class="main">⟶</span> <span class="skolem">n<span class="hidden">⇩</span><sub>a</sub></span><span class="main">≠</span><span class="skolem">n<span class="hidden">⇩</span><sub>c</sub></span> <span class="main">∧</span> <span class="free">a</span><span class="main">≠</span><span class="free">c</span> <span class="main">⟶</span> <span class="skolem">n<span class="hidden">⇩</span><sub>b</sub></span><span class="main">≠</span><span class="skolem">n<span class="hidden">⇩</span><sub>c</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="skolem">n<span class="hidden">⇩</span><sub>a</sub></span> <span class="main">=</span> <span class="free">a</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="skolem">n<span class="hidden">⇩</span><sub>b</sub></span> <span class="main">=</span> <span class="free">b</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="skolem">n<span class="hidden">⇩</span><sub>c</sub></span> <span class="main">=</span> <span class="free">c</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n<span class="hidden">⇩</span><sub>a</sub></span><span class="main">≠</span><span class="skolem">n<span class="hidden">⇩</span><sub>b</sub></span> <span class="main">∧</span> <span class="skolem">n<span class="hidden">⇩</span><sub>a</sub></span><span class="main">≠</span><span class="skolem">n<span class="hidden">⇩</span><sub>c</sub></span> <span class="main">∧</span> <span class="skolem">n<span class="hidden">⇩</span><sub>b</sub></span><span class="main">≠</span><span class="skolem">n<span class="hidden">⇩</span><sub>c</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">≠</span> <span class="free">c</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">≠</span> <span class="free">c</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="skolem">n<span class="hidden">⇩</span><sub>a</sub></span> <span class="main">=</span> <span class="free">a</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="skolem">n<span class="hidden">⇩</span><sub>b</sub></span> <span class="main">=</span> <span class="free">b</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="skolem">n<span class="hidden">⇩</span><sub>c</sub></span> <span class="main">=</span> <span class="free">c</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n<span class="hidden">⇩</span><sub>a</sub></span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="skolem">n<span class="hidden">⇩</span><sub>c</sub></span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="skolem">n<span class="hidden">⇩</span><sub>a</sub></span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="skolem">n<span class="hidden">⇩</span><sub>c</sub></span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> not_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n<span class="hidden">⇩</span><sub>a</sub></span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="skolem">n<span class="hidden">⇩</span><sub>c</sub></span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">0</span> <span class="main">=</span> <span class="skolem">p</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">∈</span><span class="free">X</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹ch_by_ord <span class="skolem">f</span> <span class="free">X</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n<span class="hidden">⇩</span><sub>a</sub></span> <span class="main">&lt;</span> card <span class="free">X</span>›</span></span> assms card_0_eq ch_by_ord_def zero_into_ordering
        <span class="keyword1"><span class="command">using</span></span> equiv_chain_1 finite_chain_with3_def inf.strict_coboundedI2 inf.strict_order_iff less_one long_ch_by_ord_def old_fin_chain_finite short_ch_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n<span class="hidden">⇩</span><sub>a</sub></span><span class="main">&lt;</span><span class="skolem">n<span class="hidden">⇩</span><sub>c</sub></span> <span class="main">∨</span> <span class="skolem">n<span class="hidden">⇩</span><sub>c</sub></span><span class="main">&lt;</span><span class="skolem">n<span class="hidden">⇩</span><sub>a</sub></span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n<span class="hidden">⇩</span><sub>a</sub></span> <span class="main">≠</span> <span class="skolem">n<span class="hidden">⇩</span><sub>b</sub></span> <span class="main">∧</span> <span class="skolem">n<span class="hidden">⇩</span><sub>a</sub></span> <span class="main">≠</span> <span class="skolem">n<span class="hidden">⇩</span><sub>c</sub></span> <span class="main">∧</span> <span class="skolem">n<span class="hidden">⇩</span><sub>b</sub></span> <span class="main">≠</span> <span class="skolem">n<span class="hidden">⇩</span><sub>c</sub></span>›</span></span> less_linear <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n<span class="hidden">⇩</span><sub>a</sub></span> <span class="main">&lt;</span> <span class="skolem">n<span class="hidden">⇩</span><sub>c</sub></span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n<span class="hidden">⇩</span><sub>a</sub></span> <span class="main">&lt;</span> <span class="skolem">n<span class="hidden">⇩</span><sub>b</sub></span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> index_order <span class="quoted"><span class="quoted">‹ch_by_ord <span class="skolem">f</span> <span class="free">X</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="skolem">n<span class="hidden">⇩</span><sub>a</sub></span> <span class="main">=</span> <span class="free">a</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="skolem">n<span class="hidden">⇩</span><sub>b</sub></span> <span class="main">=</span> <span class="free">b</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="skolem">n<span class="hidden">⇩</span><sub>c</sub></span> <span class="main">=</span> <span class="free">c</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n<span class="hidden">⇩</span><sub>c</sub></span> <span class="main">&lt;</span> card <span class="free">X</span>›</span></span>
          <span class="keyword1"><span class="command">using</span></span> finite_chain_with3_def assms
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">&lt;</span><span class="skolem">n<span class="hidden">⇩</span><sub>a</sub></span> <span class="main">∧</span> <span class="skolem">n<span class="hidden">⇩</span><sub>a</sub></span><span class="main">&lt;</span><span class="skolem">n<span class="hidden">⇩</span><sub>b</sub></span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> index_order <span class="quoted"><span class="quoted">‹<span class="skolem">n<span class="hidden">⇩</span><sub>a</sub></span> <span class="main">&lt;</span> <span class="skolem">n<span class="hidden">⇩</span><sub>b</sub></span>›</span></span> not_0
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="skolem">p</span> <span class="free">a</span> <span class="free">b</span><span class="main"><span class="free">]]</span></span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹ch_by_ord <span class="skolem">f</span> <span class="free">X</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">0</span><span class="main">=</span><span class="skolem">p</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="skolem">n<span class="hidden">⇩</span><sub>a</sub></span><span class="main">=</span><span class="free">a</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="skolem">n<span class="hidden">⇩</span><sub>b</sub></span><span class="main">=</span><span class="free">b</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n<span class="hidden">⇩</span><sub>b</sub></span><span class="main">&lt;</span>card <span class="free">X</span>›</span></span> assms equiv_chain_1 short_ch_def
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ch_by_ord_def finite_chain_with3_def long_ch_by_ord_def ordering_ord_ijk<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted">False</span>
          <span class="keyword1"><span class="command">using</span></span> finite_chain_with3_def <span class="quoted"><span class="quoted">‹<span class="skolem">p</span><span class="main">∈</span><span class="free">X</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> no_elt<span class="main">)</span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n<span class="hidden">⇩</span><sub>c</sub></span> <span class="main">&lt;</span> <span class="skolem">n<span class="hidden">⇩</span><sub>a</sub></span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n<span class="hidden">⇩</span><sub>c</sub></span> <span class="main">&lt;</span> <span class="skolem">n<span class="hidden">⇩</span><sub>b</sub></span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> index_order <span class="quoted"><span class="quoted">‹ch_by_ord <span class="skolem">f</span> <span class="free">X</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="skolem">n<span class="hidden">⇩</span><sub>a</sub></span> <span class="main">=</span> <span class="free">a</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="skolem">n<span class="hidden">⇩</span><sub>b</sub></span> <span class="main">=</span> <span class="free">b</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="skolem">n<span class="hidden">⇩</span><sub>c</sub></span> <span class="main">=</span> <span class="free">c</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n<span class="hidden">⇩</span><sub>a</sub></span> <span class="main">&lt;</span> card <span class="free">X</span>›</span></span>
          <span class="keyword1"><span class="command">using</span></span> finite_chain_with3_def assms
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">&lt;</span><span class="skolem">n<span class="hidden">⇩</span><sub>c</sub></span> <span class="main">∧</span> <span class="skolem">n<span class="hidden">⇩</span><sub>c</sub></span><span class="main">&lt;</span><span class="skolem">n<span class="hidden">⇩</span><sub>b</sub></span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> index_order <span class="quoted"><span class="quoted">‹<span class="skolem">n<span class="hidden">⇩</span><sub>c</sub></span> <span class="main">&lt;</span> <span class="skolem">n<span class="hidden">⇩</span><sub>b</sub></span>›</span></span> not_0
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="skolem">p</span> <span class="free">c</span> <span class="free">b</span><span class="main"><span class="free">]]</span></span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹ch_by_ord <span class="skolem">f</span> <span class="free">X</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">0</span><span class="main">=</span><span class="skolem">p</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="skolem">n<span class="hidden">⇩</span><sub>c</sub></span><span class="main">=</span><span class="free">c</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="skolem">n<span class="hidden">⇩</span><sub>b</sub></span><span class="main">=</span><span class="free">b</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n<span class="hidden">⇩</span><sub>b</sub></span><span class="main">&lt;</span>card <span class="free">X</span>›</span></span> assms equiv_chain_1 short_ch_def
          <span class="keyword1"><span class="command">using</span></span> ch_by_ord_def finite_chain_with3_def long_ch_by_ord_def ordering_ord_ijk
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">b</span> <span class="free">c</span> <span class="skolem">p</span><span class="main"><span class="free">]]</span></span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abc_sym<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted">False</span>
          <span class="keyword1"><span class="command">using</span></span> finite_chain_with3_def <span class="quoted"><span class="quoted">‹<span class="skolem">p</span><span class="main">∈</span><span class="free">X</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> no_elt<span class="main">)</span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n<span class="hidden">⇩</span><sub>a</sub></span> <span class="main">&lt;</span> <span class="skolem">n<span class="hidden">⇩</span><sub>c</sub></span> <span class="main">∨</span> <span class="skolem">n<span class="hidden">⇩</span><sub>c</sub></span> <span class="main">&lt;</span> <span class="skolem">n<span class="hidden">⇩</span><sub>a</sub></span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹ch_by_ord <span class="skolem">f</span> <span class="free">X</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="skolem">n<span class="hidden">⇩</span><sub>a</sub></span> <span class="main">=</span> <span class="free">a</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="skolem">n<span class="hidden">⇩</span><sub>c</sub></span> <span class="main">=</span> <span class="free">c</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> MinkowskiSpacetime<span class="main">)</span> with3_and_index_is_fin_chain<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">0</span> <span class="main">=</span> <span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"ch_by_ord <span class="free">f</span> <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite_chain_with3 <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">f</span><span class="main">[</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">..</span><span class="free">c</span><span class="main">]</span><span class="free">X</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ordering_def assms old_fin_chain_finite
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"long_ch_by_ord <span class="free">f</span> <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span>  assms<span class="main">(</span>2<span class="main">)</span> assms<span class="main">(</span>3<span class="main">)</span> ch_by_ord_def equiv_chain_1 finite_chain_with3_def short_ch_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">≠</span><span class="free">b</span> <span class="main">∧</span> <span class="free">a</span><span class="main">≠</span><span class="free">c</span> <span class="main">∧</span> <span class="free">b</span><span class="main">≠</span><span class="free">c</span> <span class="main">∧</span> <span class="free">f</span> <span class="main">0</span> <span class="main">=</span> <span class="free">a</span> <span class="main">∧</span> <span class="free">b</span><span class="main">∈</span><span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>3<span class="main">)</span> equiv_chain_1 finite_chain_with3_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span>card <span class="free">X</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="free">c</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">n</span> <span class="main">=</span> <span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> card <span class="free">X</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> ordering_def equiv_chain_1 finite_chain_with3_def long_ch_by_ord_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> calculation<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> card <span class="free">X</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">&lt;</span><span class="skolem">m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span><span class="main">&lt;</span>card <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">c</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">m</span><span class="main">)</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">m</span><span class="main">)</span><span class="main">∈</span><span class="free">X</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"TernaryOrdering.ordering <span class="free">f</span> <span class="free">betw</span> <span class="free">X</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹long_ch_by_ord <span class="free">f</span> <span class="free">X</span>›</span></span> long_ch_by_ord_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">have</span></span> f2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">f</span> <span class="bound">A</span> <span class="bound">p</span> <span class="bound">na</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="bound">p</span> <span class="main">(</span><span class="bound">f</span> <span class="bound">na</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">(</span><span class="bound">f</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="bound">f</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">∨</span> <span class="main">¬</span> <span class="skolem">m</span> <span class="main">&lt;</span> card <span class="bound">A</span><span class="main">)</span> <span class="main">∨</span> <span class="main">¬</span> ordering <span class="bound">f</span> <span class="bound">p</span> <span class="bound">A</span><span class="main">)</span>
                                      <span class="main">∨</span> <span class="main">¬</span> <span class="bound">na</span> <span class="main">&lt;</span> <span class="skolem">n</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ordering_def <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">&lt;</span> <span class="skolem">m</span>›</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">m</span> <span class="main">∈</span> <span class="free">X</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> f1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ordering_def <span class="quoted"><span class="quoted">‹<span class="skolem">m</span> <span class="main">&lt;</span> card <span class="free">X</span>›</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">using</span></span> f2 f1 <span class="quoted"><span class="quoted">‹<span class="free">a</span><span class="main">≠</span><span class="free">b</span> <span class="main">∧</span> <span class="free">a</span><span class="main">≠</span><span class="free">c</span> <span class="main">∧</span> <span class="free">b</span><span class="main">≠</span><span class="free">c</span> <span class="main">∧</span> <span class="free">f</span> <span class="main">0</span> <span class="main">=</span> <span class="free">a</span> <span class="main">∧</span> <span class="free">b</span><span class="main">∈</span><span class="free">X</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="skolem">n</span> <span class="main">=</span> <span class="free">c</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">m</span> <span class="main">&lt;</span> card <span class="free">X</span>›</span></span>
              <span class="keyword1"><span class="command">using</span></span> gr_implies_not0 linorder_neqE_nat
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">b</span> <span class="free">c</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">m</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> abc_acd_bcd
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> chain_with_def finite_chain_with3_def<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted">False</span>
          <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">c</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">m</span><span class="main">)</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="free">f</span> <span class="skolem">m</span> <span class="main">∈</span> <span class="free">X</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> finite_chain_with3_def<span class="main">)</span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> card <span class="free">X</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">&lt;</span> card <span class="free">X</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="skolem">n</span> <span class="main">=</span> <span class="free">c</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fin_long_chain_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> MinkowskiSpacetime<span class="main">)</span> g_from_with3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite_chain_with3 <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">g</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">g</span><span class="main">[</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">..</span><span class="free">c</span><span class="main">]</span><span class="free">X</span><span class="main">]</span> <span class="main">∨</span> <span class="main">[</span><span class="free">g</span><span class="main">[</span><span class="free">c</span><span class="main">..</span><span class="free">b</span><span class="main">..</span><span class="free">a</span><span class="main">]</span><span class="free">X</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> old_chain_sym<span class="main">:</span> <span class="quoted"><span class="quoted">"finite_chain_with3 <span class="free">c</span> <span class="free">b</span> <span class="free">a</span> <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> abc_sym assms chain_with_def finite_chain_with3_def<span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> f_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span> <span class="main">0</span> <span class="main">=</span> <span class="free">a</span> <span class="main">∨</span> <span class="skolem">f</span> <span class="main">0</span> <span class="main">=</span> <span class="free">c</span><span class="main">)</span> <span class="main">∧</span> ch_by_ord <span class="skolem">f</span> <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> index_from_with3 assms
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">0</span> <span class="main">=</span> <span class="free">a</span> <span class="main">⟶</span> <span class="main">[</span><span class="skolem">f</span><span class="main">[</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">..</span><span class="free">c</span><span class="main">]</span><span class="free">X</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> with3_and_index_is_fin_chain f_def assms
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">0</span> <span class="main">=</span> <span class="free">c</span> <span class="main">⟶</span> <span class="main">[</span><span class="skolem">f</span><span class="main">[</span><span class="free">c</span><span class="main">..</span><span class="free">b</span><span class="main">..</span><span class="free">a</span><span class="main">]</span><span class="free">X</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> with3_and_index_is_fin_chain f_def assms old_chain_sym
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> f_def that
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> MinkowskiSpacetime<span class="main">)</span> equiv_chain_2a<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite_chain_with3 <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">f</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">f</span><span class="main">[</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">..</span><span class="free">c</span><span class="main">]</span><span class="free">X</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">g</span><span class="main">[</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">..</span><span class="free">c</span><span class="main">]</span><span class="free">X</span><span class="main">]</span> <span class="main">∨</span> <span class="main">[</span><span class="skolem">g</span><span class="main">[</span><span class="free">c</span><span class="main">..</span><span class="free">b</span><span class="main">..</span><span class="free">a</span><span class="main">]</span><span class="free">X</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms g_from_with3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="comment1">(* in two cases *)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">g</span><span class="main">[</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">..</span><span class="free">c</span><span class="main">]</span><span class="free">X</span><span class="main">]</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">[</span><span class="skolem">g</span><span class="main">[</span><span class="free">a</span> <span class="main">..</span> <span class="free">b</span> <span class="main">..</span> <span class="free">c</span><span class="main">]</span><span class="free">X</span><span class="main">]</span>›</span></span> that
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">g</span><span class="main">[</span><span class="free">c</span><span class="main">..</span><span class="free">b</span><span class="main">..</span><span class="free">a</span><span class="main">]</span><span class="free">X</span><span class="main">]</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">[</span><span class="skolem">g</span><span class="main">[</span><span class="free">c</span> <span class="main">..</span> <span class="free">b</span> <span class="main">..</span> <span class="free">a</span><span class="main">]</span><span class="free">X</span><span class="main">]</span>›</span></span> chain_sym that
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="TemporalOrderOnPath-equiv_chain_2b"><span class="command">lemma</span></span> equiv_chain_2b<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">f</span><span class="main">[</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">..</span><span class="free">c</span><span class="main">]</span><span class="free">X</span><span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite_chain_with3 <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="free">X</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> aligned<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms fin_ch_betw
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> some_chain<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[[..</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">..</span><span class="free">c</span><span class="main">..]</span><span class="free">X</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms ch_by_ord_def equiv_chain_1b fin_long_chain_def points_in_chain
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">w</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="bound">w</span> <span class="free">a</span> <span class="free">b</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">b</span> <span class="free">c</span> <span class="bound">w</span><span class="main"><span class="free">]]</span></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">safe</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">w</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span><span class="main">∈</span><span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> case1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="skolem">w</span> <span class="free">a</span> <span class="free">b</span><span class="main"><span class="free">]]</span></span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">n</span> <span class="main">=</span> <span class="skolem">w</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">&lt;</span>card <span class="free">X</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">w</span><span class="main">∈</span><span class="free">X</span>›</span></span> abc_bcd_abd abc_only_cba aligned assms fin_ch_betw fin_long_chain_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">0</span> <span class="main">=</span> <span class="free">a</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms fin_long_chain_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span>card <span class="free">X</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="free">c</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> MinkowskiBetweenness.fin_long_chain_def MinkowskiBetweenness_axioms assms<span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="skolem">w</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> abc_bcd_abd abc_only_cba assms case1 fin_ch_betw<span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">using</span></span> f1 fin_long_chain_def <span class="quoted"><span class="quoted">‹<span class="skolem">w</span> <span class="main">∈</span> <span class="free">X</span>›</span></span> abc_only_cba assms case1 fin_ch_betw
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">assume</span></span> case2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">b</span> <span class="free">c</span> <span class="skolem">w</span><span class="main"><span class="free">]]</span></span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">n</span> <span class="main">=</span> <span class="skolem">w</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">&lt;</span>card <span class="free">X</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">w</span><span class="main">∈</span><span class="free">X</span>›</span></span> ordering_def abc_bcd_abd abc_only_cba aligned assms fin_ch_betw
        <span class="keyword1"><span class="command">using</span></span> fin_long_chain_def long_ch_by_ord_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span>card <span class="free">X</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="free">c</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms fin_long_chain_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="skolem">w</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> abc_bcd_abd abc_only_cba assms case2 fin_ch_betw abc_bcd_acd
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&gt;</span> card <span class="free">X</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="skolem">w</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">w</span> <span class="main">∈</span> <span class="free">X</span>›</span></span> abc_only_cba assms case2 fin_ch_betw
        <span class="keyword1"><span class="command">unfolding</span></span> fin_long_chain_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">&lt;</span> card <span class="free">X</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> finite_chain_with3_def some_chain<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> MinkowskiSpacetime<span class="main">)</span> equiv_chain_2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">f</span><span class="main">.</span> <span class="main">[</span><span class="bound">f</span><span class="main">[</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">..</span><span class="free">c</span><span class="main">]</span><span class="free">X</span><span class="main">]</span> <span class="main">⟷</span> <span class="main">[[</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">..</span><span class="free">c</span><span class="main">]</span><span class="free">X</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> equiv_chain_2a equiv_chain_2b
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context MinkowskiChain *)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Results for segments, rays and chains"</span></span>

<span class="keyword1"><span class="command">context</span></span> MinkowskiChain <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="TemporalOrderOnPath-inside_not_bound"><span class="command">lemma</span></span> inside_not_bound<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">f</span><span class="main">[</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">..</span><span class="free">c</span><span class="main">]</span><span class="free">X</span><span class="main">]</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span><span class="main">&lt;</span>card <span class="free">X</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span><span class="main">&gt;</span><span class="main">0</span> <span class="main">⟹</span> <span class="free">f</span> <span class="free">j</span> <span class="main">≠</span> <span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span><span class="main">&lt;</span>card <span class="free">X</span> <span class="main">-</span> <span class="main">1</span> <span class="main">⟹</span> <span class="free">f</span> <span class="free">j</span> <span class="main">≠</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> bound_indices<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">0</span> <span class="main">=</span> <span class="free">a</span> <span class="main">∧</span> <span class="free">f</span> <span class="main">(</span>card <span class="free">X</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="free">c</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> fin_long_chain_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">j</span> <span class="main">≠</span> <span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">j</span> <span class="main">=</span> <span class="free">c</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="free">j</span><span class="main">)</span> <span class="free">b</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="main">0</span><span class="main">)</span> <span class="free">b</span> <span class="main">(</span><span class="free">f</span> <span class="free">j</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> fin_ch_betw fin_long_chain_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> abc_abc_neq bound_indices <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">j</span> <span class="main">≠</span> <span class="free">c</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="free">j</span><span class="main">)</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="main">0</span><span class="main">)</span> <span class="free">c</span> <span class="main">(</span><span class="free">f</span> <span class="free">j</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms fin_ch_betw
      <span class="keyword1"><span class="command">unfolding</span></span> fin_long_chain_def long_ch_by_ord_def ordering_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> abc_abc_neq assms that ch_all_betw_f nat_neq_iff<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> abc_abc_neq bound_indices <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">j</span> <span class="main">≠</span> <span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span><span class="main">&lt;</span>card <span class="free">X</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">j</span> <span class="main">=</span> <span class="free">a</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="free">j</span> <span class="main">=</span> <span class="free">a</span>›</span></span> assms<span class="main">(</span>1<span class="main">)</span> fin_long_chain_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">j</span> <span class="main">≠</span> <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> card <span class="free">X</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="main">(</span><span class="free">f</span> <span class="free">j</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span>card <span class="free">X</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="free">j</span><span class="main">)</span> <span class="free">a</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span>card <span class="free">X</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span>  assms fin_ch_betw fin_long_chain_def order_finite_chain
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="free">j</span> <span class="main">≠</span> <span class="free">a</span>›</span></span> diff_less le_numeral_extra<span class="main"><span class="main">(</span></span>1-3<span class="main"><span class="main">)</span></span> neq0_conv that<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">j</span> <span class="main">≠</span> <span class="free">c</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> abc_abc_neq bound_indices <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="TemporalOrderOnPath-some_betw2"><span class="command">lemma</span></span> some_betw2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">f</span><span class="main">[</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">..</span><span class="free">c</span><span class="main">]</span><span class="free">X</span><span class="main">]</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span><span class="main">&lt;</span>card <span class="free">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">j</span> <span class="main">≠</span> <span class="free">b</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="main">(</span><span class="free">f</span> <span class="free">j</span><span class="main">)</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="main">(</span><span class="free">f</span> <span class="free">j</span><span class="main">)</span> <span class="free">b</span><span class="main"><span class="free">]]</span></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ab</span></span> <span class="keyword2"><span class="keyword">where</span></span> ab_def<span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="skolem">ab</span> <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span><span class="main">⊆</span><span class="skolem">ab</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fin_long_chain_def long_chain_on_path assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> points_in_chain subsetD<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> bound_indices<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">0</span> <span class="main">=</span> <span class="free">a</span> <span class="main">∧</span> <span class="free">f</span> <span class="main">(</span>card <span class="free">X</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="free">c</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> fin_long_chain_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">j</span> <span class="main">≠</span> <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> inside_not_bound<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> assms<span class="main">(</span>3<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="free">j</span><span class="main">)</span> <span class="free">a</span> <span class="free">b</span><span class="main"><span class="free">]]</span></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> abc_bcd_abd abc_only_cba assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> fin_ch_betw fin_long_chain_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ordering_def ch_all_betw_f long_ch_by_ord_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">" <span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="main">(</span><span class="free">f</span> <span class="free">j</span><span class="main">)</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="main">(</span><span class="free">f</span> <span class="free">j</span><span class="main">)</span> <span class="free">b</span><span class="main"><span class="free">]]</span></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> some_betw <span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> Q<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">ab</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">a</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">b</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> c<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">j</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> ab_def assms<span class="main">(</span>4<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="free">j</span> <span class="main">≠</span> <span class="free">a</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ordering_def abc_sym assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span> fin_long_chain_def long_ch_by_ord_def subsetD<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="TemporalOrderOnPath-i_le_j_events_neq1"><span class="command">lemma</span></span> i_le_j_events_neq1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">f</span><span class="main">[</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">..</span><span class="free">c</span><span class="main">]</span><span class="free">X</span><span class="main">]</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">&lt;</span><span class="free">j</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span><span class="main">&lt;</span>card <span class="free">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">j</span> <span class="main">≠</span> <span class="free">b</span>"</span></span> <span class="comment1">(* this just means you need to pick b well *)</span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">i</span> <span class="main">≠</span> <span class="free">f</span> <span class="free">j</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> in_X<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">i</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">∧</span> <span class="free">f</span> <span class="free">j</span> <span class="main">∈</span> <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ordering_def assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span> fin_long_chain_def less_trans long_ch_by_ord_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> bound_indices<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">0</span> <span class="main">=</span> <span class="free">a</span> <span class="main">∧</span> <span class="free">f</span> <span class="main">(</span>card <span class="free">X</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="free">c</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> fin_long_chain_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ab</span></span> <span class="keyword2"><span class="keyword">where</span></span> ab_def<span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="skolem">ab</span> <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span><span class="main">⊆</span><span class="skolem">ab</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fin_long_chain_def long_chain_on_path assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> points_in_chain subsetD<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">i</span> <span class="main">=</span> <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="main">(</span><span class="free">f</span> <span class="free">j</span><span class="main">)</span> <span class="free">b</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="main">(</span><span class="free">f</span> <span class="free">j</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> some_betw2 assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="free">i</span> <span class="main">=</span> <span class="free">a</span>›</span></span> abc_abc_neq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">i</span> <span class="main">≠</span> <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="main">(</span><span class="free">f</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="free">j</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>3<span class="main">)</span> ch_equiv fin_long_chain_def order_finite_chain2
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> gr_implies_not_zero le_numeral_extra<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> less_linear<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> abc_abc_neq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="TemporalOrderOnPath-i_le_j_events_neq"><span class="command">lemma</span></span> i_le_j_events_neq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">f</span><span class="main">[</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">..</span><span class="free">c</span><span class="main">]</span><span class="free">X</span><span class="main">]</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">&lt;</span><span class="free">j</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span><span class="main">&lt;</span>card <span class="free">X</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">i</span> <span class="main">≠</span> <span class="free">f</span> <span class="free">j</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> in_X<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">i</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">∧</span> <span class="free">f</span> <span class="free">j</span> <span class="main">∈</span> <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ordering_def assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span> fin_long_chain_def less_trans long_ch_by_ord_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> bound_indices<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">0</span> <span class="main">=</span> <span class="free">a</span> <span class="main">∧</span> <span class="free">f</span> <span class="main">(</span>card <span class="free">X</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="free">c</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> fin_long_chain_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ab</span></span> <span class="keyword2"><span class="keyword">where</span></span> ab_def<span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="skolem">ab</span> <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span><span class="main">⊆</span><span class="skolem">ab</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fin_long_chain_def long_chain_on_path assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> points_in_chain subsetD<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">i</span> <span class="main">=</span> <span class="free">a</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="free">b</span>"</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">f</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span>›</span></span> ab_def<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="free">j</span><span class="main">)</span> <span class="main">≠</span> <span class="free">b</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="main">(</span><span class="free">f</span> <span class="free">j</span><span class="main">)</span> <span class="free">b</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="main">(</span><span class="free">f</span> <span class="free">j</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> some_betw2 assms <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">f</span> <span class="free">j</span><span class="main">)</span> <span class="main">≠</span> <span class="free">b</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">f</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span>›</span></span> abc_abc_neq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="free">i</span><span class="main">)</span> <span class="main">≠</span> <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="main">(</span><span class="free">f</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="free">j</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>3<span class="main">)</span> ch_equiv fin_long_chain_def order_finite_chain2
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> gr_implies_not_zero le_numeral_extra<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> less_linear<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> abc_abc_neq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="TemporalOrderOnPath-indices_neq_imp_events_neq"><span class="command">lemma</span></span> indices_neq_imp_events_neq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">f</span><span class="main">[</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">..</span><span class="free">c</span><span class="main">]</span><span class="free">X</span><span class="main">]</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">≠</span><span class="free">j</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span><span class="main">&lt;</span>card <span class="free">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">&lt;</span>card <span class="free">X</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">i</span> <span class="main">≠</span> <span class="free">f</span> <span class="free">j</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms i_le_j_events_neq less_linear<span class="main">)</span>


<span class="keyword1" id="TemporalOrderOnPath-index_order2"><span class="command">lemma</span></span> index_order2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">f</span><span class="main">[</span><span class="free">x</span><span class="main">..</span><span class="free">y</span><span class="main">..</span><span class="free">z</span><span class="main">]</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">a</span> <span class="main">=</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">b</span> <span class="main">=</span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">c</span> <span class="main">=</span> <span class="free">z</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span> <span class="main">⟶</span> <span class="free">a</span> <span class="main">&lt;</span> card <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span> <span class="main">⟶</span> <span class="free">b</span> <span class="main">&lt;</span> card <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span> <span class="main">⟶</span> <span class="free">c</span> <span class="main">&lt;</span> card <span class="free">X</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">&lt;</span><span class="free">b</span> <span class="main">∧</span> <span class="free">b</span><span class="main">&lt;</span><span class="free">c</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">c</span><span class="main">&lt;</span><span class="free">b</span> <span class="main">∧</span> <span class="free">b</span><span class="main">&lt;</span><span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> index_order <span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> y<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">y</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> z<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">z</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">a</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">b</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> c<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">c</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> f<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">f</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> X<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">X</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms ch_by_ord_def equiv_chain_2b fin_long_chain_def finite_chain_with3_def<span class="main">)</span>

<span class="keyword1" id="TemporalOrderOnPath-index_order3"><span class="command">lemma</span></span> index_order3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">x</span> <span class="free">y</span> <span class="free">z</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">a</span> <span class="main">=</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">b</span> <span class="main">=</span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">c</span> <span class="main">=</span> <span class="free">z</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"long_ch_by_ord <span class="free">f</span> <span class="free">X</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span> <span class="main">⟶</span> <span class="free">a</span> <span class="main">&lt;</span> card <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span> <span class="main">⟶</span> <span class="free">b</span> <span class="main">&lt;</span> card <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span> <span class="main">⟶</span> <span class="free">c</span> <span class="main">&lt;</span> card <span class="free">X</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">&lt;</span><span class="free">b</span> <span class="main">∧</span> <span class="free">b</span><span class="main">&lt;</span><span class="free">c</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">c</span><span class="main">&lt;</span><span class="free">b</span> <span class="main">∧</span> <span class="free">b</span><span class="main">&lt;</span><span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> index_order2 <span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> y<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">y</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> z<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">z</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">a</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">b</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> c<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">c</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> f<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">f</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> X<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">X</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">using</span></span> assms long_ch_by_ord_def ordering_ord_ijk
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> abc_abc_neq abc_only_cba<span class="main"><span class="main">(</span></span>1-3<span class="main"><span class="main">)</span></span> linorder_neqE_nat<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context MinkowskiChain *)</span>

<span class="keyword1"><span class="command">context</span></span> MinkowskiSpacetime <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="TemporalOrderOnPath-bound_on_path"><span class="command">lemma</span></span> bound_on_path<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span><span class="main">∈</span><span class="free">𝒫</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">f</span><span class="main">[</span><span class="main">(</span><span class="free">f</span> <span class="main">0</span><span class="main">)</span><span class="main">..]</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span><span class="main">⊆</span><span class="free">Q</span>"</span></span> <span class="quoted"><span class="quoted">"is_bound_f <span class="free">b</span> <span class="free">X</span> <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">∈</span><span class="free">Q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">∈</span><span class="free">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">∈</span><span class="free">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="skolem">a</span> <span class="skolem">c</span> <span class="free">b</span><span class="main"><span class="free">]]</span></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ordering_def inf_chain_is_long is_bound_f_def long_ch_by_ord_def zero_less_one<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> abc_abc_neq assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>3<span class="main">)</span> betw_c_in_path <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="TemporalOrderOnPath-pro_basis_change"><span class="command">lemma</span></span> pro_basis_change<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"prolongation <span class="free">a</span> <span class="free">c</span> <span class="main">=</span> prolongation <span class="free">b</span> <span class="free">c</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ac</span><span class="main">=</span><span class="var">?bc</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ac</span> <span class="main">⊆</span> <span class="var">?bc</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="var">?ac</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">c</span> <span class="skolem">x</span><span class="main"><span class="free">]]</span></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pro_betw<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">b</span> <span class="free">c</span> <span class="skolem">x</span><span class="main"><span class="free">]]</span></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms abc_acd_bcd <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="var">?bc</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> abc_abc_neq pro_betw <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?bc</span> <span class="main">⊆</span> <span class="var">?ac</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="var">?bc</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">b</span> <span class="free">c</span> <span class="skolem">x</span><span class="main"><span class="free">]]</span></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pro_betw<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">c</span> <span class="skolem">x</span><span class="main"><span class="free">]]</span></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms abc_bcd_acd <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="var">?ac</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> abc_abc_neq pro_betw <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="TemporalOrderOnPath-adjoining_segs_exclusive"><span class="command">lemma</span></span> adjoining_segs_exclusive<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"segment <span class="free">a</span> <span class="free">b</span> <span class="main">∩</span> segment <span class="free">b</span> <span class="free">c</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"segment <span class="free">a</span> <span class="free">b</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"segment <span class="free">a</span> <span class="free">b</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span>segment <span class="free">a</span> <span class="free">b</span> <span class="main">⟶</span> <span class="skolem">x</span><span class="main">∉</span>segment <span class="free">b</span> <span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span>segment <span class="free">a</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="skolem">x</span> <span class="free">b</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> seg_betw<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="skolem">x</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">`<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="skolem">x</span> <span class="free">b</span><span class="main"><span class="free">]]</span></span>`</span></span> abc_only_cba<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main"><span class="free">[[</span></span><span class="free">b</span> <span class="skolem">x</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="skolem">x</span><span class="main"><span class="free">]]</span></span>›</span></span> abd_bcd_abc assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∉</span>segment <span class="free">b</span> <span class="free">c</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> seg_betw<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context MinkowskiSpacetime *)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"3.6 Order on a path - Theorems 10 and 11"</span></span>

<span class="keyword1"><span class="command">context</span></span> MinkowskiSpacetime <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Theorem 10 (based on Veblen (1904) theorem 10).›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> MinkowskiBetweenness<span class="main">)</span> two_event_chain<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> finiteX<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> path_Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">∈</span> <span class="free">𝒫</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> events_X<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> <span class="free">Q</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> card_X<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="free">X</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ch <span class="free">X</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> X_is<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">X</span><span class="main">=</span><span class="main">{</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> card_le_Suc_iff numeral_2_eq_2
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> card_2_iff card_X<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> no_c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">c</span><span class="main">∈</span><span class="main">{</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">}</span><span class="main">.</span> <span class="bound">c</span><span class="main">≠</span><span class="skolem">a</span> <span class="main">∧</span> <span class="bound">c</span><span class="main">≠</span><span class="skolem">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">≠</span><span class="skolem">b</span> <span class="main">∧</span> <span class="skolem">a</span><span class="main">∈</span><span class="free">Q</span> <span class="main">&amp;</span> <span class="skolem">b</span><span class="main">∈</span><span class="free">Q</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> X_is card_X events_X <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"short_ch <span class="main">{</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> path_Q short_ch_def no_c <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> X_is ch_by_ord_def ch_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> MinkowskiBetweenness<span class="main">)</span> three_event_chain<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> finiteX<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> path_Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">∈</span> <span class="free">𝒫</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> events_X<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> <span class="free">Q</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> card_X<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="free">X</span> <span class="main">=</span> <span class="numeral">3</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ch <span class="free">X</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> X_is<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">X</span><span class="main">=</span><span class="main">{</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">,</span><span class="skolem">c</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> numeral_3_eq_3 card_X <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> card_Suc_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> all_neq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">≠</span><span class="skolem">b</span> <span class="main">∧</span> <span class="skolem">a</span><span class="main">≠</span><span class="skolem">c</span> <span class="main">∧</span> <span class="skolem">b</span><span class="main">≠</span><span class="skolem">c</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> card_X numeral_2_eq_2 numeral_3_eq_3
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_n_not_le_n insert_absorb2 insert_commute set_le_two<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> in_path<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">∈</span><span class="free">Q</span> <span class="main">∧</span> <span class="skolem">b</span><span class="main">∈</span><span class="free">Q</span> <span class="main">∧</span> <span class="skolem">c</span><span class="main">∈</span><span class="free">Q</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> X_is events_X <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">a</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="skolem">c</span> <span class="skolem">a</span> <span class="skolem">b</span><span class="main"><span class="free">]]</span></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> some_betw all_neq path_Q <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"ch <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> between_chain X_is all_neq chain3 in_path path_Q <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This is case (i) of the induction in Theorem 10.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="comment1">(*for 10*)</span> chain_append_at_left_edge<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> long_ch_Y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">f</span><span class="main">[</span><span class="free">a<span class="hidden">⇩</span><sub>1</sub></span><span class="main">..</span><span class="free">a</span><span class="main">..</span><span class="free">a<span class="hidden">⇩</span><sub>n</sub></span><span class="main">]</span><span class="free">Y</span><span class="main">]</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> bY<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">b</span> <span class="free">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>n</sub></span><span class="main"><span class="free">]]</span></span>"</span></span>
    <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">g</span> <span class="keyword2"><span class="keyword">defines</span></span> g_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">::</span>nat<span class="main">.</span> <span class="keyword1">if</span> <span class="bound">j</span><span class="main">≥</span><span class="main">1</span> <span class="keyword1">then</span> <span class="free">f</span> <span class="main">(</span><span class="bound">j</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="keyword1">else</span> <span class="free">b</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">g</span><span class="main">[</span><span class="free">b</span> <span class="main">..</span> <span class="free">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">..</span> <span class="free">a<span class="hidden">⇩</span><sub>n</sub></span><span class="main">]</span><span class="main">(</span>insert <span class="free">b</span> <span class="free">Y</span><span class="main">)</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?X</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"insert <span class="free">b</span> <span class="free">Y</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">∉</span><span class="free">Y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> abc_ac_neq abc_only_cba<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> bY ch_all_betw_f long_ch_Y<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> bound_indices<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">0</span> <span class="main">=</span> <span class="free">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∧</span> <span class="free">f</span> <span class="main">(</span>card <span class="free">Y</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="free">a<span class="hidden">⇩</span><sub>n</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> long_ch_Y <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fin_long_chain_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> fin_Y<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="free">Y</span> <span class="main">≥</span> <span class="numeral">3</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span>  fin_long_chain_def long_ch_Y numeral_2_eq_2
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ch_by_ord_def long_ch_card_ge3<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> num_ord<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">∧</span> <span class="main">0</span><span class="main">&lt;</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">∧</span> <span class="main">1</span> <span class="main">&lt;</span> card <span class="free">Y</span> <span class="main">-</span> <span class="main">1</span> <span class="main">∧</span> card <span class="free">Y</span> <span class="main">-</span> <span class="main">1</span> <span class="main">&lt;</span> card <span class="free">Y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span><span class="free">f</span> <span class="main">1</span><span class="main">)</span> <span class="free">a<span class="hidden">⇩</span><sub>n</sub></span><span class="main"><span class="free">]]</span></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> order_finite_chain fin_long_chain_def long_ch_Y
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Schutz has a step here that says <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>[b a<span class="hidden">⇩</span><sub>1</sub> a<span class="hidden">⇩</span><sub>2</sub> a<span class="hidden">⇩</span><sub>n</sub>]›</span></span></span></span> is a chain (using Theorem 9).
    We have no easy way of denoting an ordered 4-element chain, so we skip this step
    using an ordering lemma from our script for 3.6, which Schutz doesn't list.›</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">b</span> <span class="free">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span><span class="free">f</span> <span class="main">1</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> bY abd_bcd_abc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ordering2 <span class="free">g</span> <span class="free">betw</span> <span class="var">?X</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?X</span> <span class="main">⟶</span> <span class="skolem">n</span><span class="main">&lt;</span>card <span class="var">?X</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="skolem">n</span> <span class="main">∈</span> <span class="var">?X</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">≥</span><span class="main">1</span>"</span></span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> g_def<span class="main">)</span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">≤</span><span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="skolem">n</span> <span class="main">∉</span> <span class="free">Y</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="skolem">n</span> <span class="main">=</span> <span class="free">f</span><span class="main">(</span><span class="skolem">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> g_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="skolem">n</span> <span class="main">∈</span> <span class="free">Y</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> card <span class="var">?X</span> <span class="main">-</span> <span class="main">1</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span><span class="main">∉</span><span class="free">Y</span>›</span></span> card.insert diff_Suc_1 fin_long_chain_def long_ch_Y points_in_chain
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="free">g</span> <span class="skolem">n</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>›</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> card <span class="free">Y</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> points_in_chain <span class="quoted"><span class="quoted">‹finite <span class="var">?X</span> <span class="main">⟶</span> <span class="skolem">n</span> <span class="main">&lt;</span> card <span class="var">?X</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">g</span> <span class="skolem">n</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">g</span> <span class="skolem">n</span> <span class="main">∉</span> <span class="free">Y</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span><span class="main">∉</span><span class="free">Y</span>›</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> card.insert fin_long_chain_def finite_insert long_ch_Y not_less_simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">-</span><span class="main">1</span> <span class="main">&lt;</span> card <span class="free">Y</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">1</span> <span class="main">≤</span> <span class="skolem">n</span>›</span></span> diff_less_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">(</span><span class="skolem">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">∈</span><span class="free">Y</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> long_ch_Y <span class="keyword1"><span class="command">unfolding</span></span> fin_long_chain_def long_ch_by_ord_def ordering_def
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> less_trans num_ord<span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">g</span> <span class="skolem">n</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">g</span> <span class="skolem">n</span> <span class="main">∉</span> <span class="free">Y</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="skolem">n</span> <span class="main">=</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="skolem">n'</span> <span class="skolem">n''</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>finite <span class="var">?X</span> <span class="main">⟶</span> <span class="skolem">n''</span> <span class="main">&lt;</span> card <span class="var">?X</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">n</span> <span class="main">=</span> <span class="skolem">n'</span> <span class="main">∧</span> Suc <span class="skolem">n'</span> <span class="main">=</span> <span class="skolem">n''</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">g</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="free">g</span> <span class="skolem">n'</span><span class="main">)</span> <span class="main">(</span><span class="free">g</span> <span class="skolem">n''</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span><span class="main">∉</span><span class="free">Y</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="free">b</span> <span class="free">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span><span class="free">f</span> <span class="main">1</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>›</span></span> g_def long_ch_Y ordering_ord_ijk
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> ccfv_threshold<span class="main"><span class="main">)</span></span> fin_long_chain_def long_ch_by_ord_def
            One_nat_def card.insert diff_Suc_Suc diff_diff_cancel diff_is_0_eq
            finite_insert nat_less_le not_less not_less_eq_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="var">?X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="free">b</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>finite <span class="var">?X</span> <span class="main">⟶</span> <span class="main">0</span> <span class="main">&lt;</span> card <span class="var">?X</span><span class="main">)</span> <span class="main">∧</span> <span class="free">g</span> <span class="main">0</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span><span class="main">∉</span><span class="free">Y</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">=</span> <span class="free">b</span>›</span></span> g_def<span class="main">)</span>
    <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="var">?X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">≠</span><span class="free">b</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span>finite <span class="var">?X</span> <span class="main">⟶</span> <span class="bound">n</span> <span class="main">&lt;</span> card <span class="var">?X</span><span class="main">)</span> <span class="main">∧</span> <span class="free">g</span> <span class="bound">n</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">n</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> card <span class="free">Y</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span><span class="main">∈</span><span class="var">?X</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span><span class="main">≠</span><span class="free">b</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ordering_def fin_long_chain_def insert_iff long_ch_Y long_ch_by_ord_def<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>finite <span class="var">?X</span> <span class="main">⟶</span> <span class="skolem">n</span><span class="main">+</span><span class="main">1</span> <span class="main">&lt;</span> card <span class="var">?X</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span><span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span><span class="main">∉</span><span class="free">Y</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">&lt;</span> card <span class="free">Y</span>›</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="skolem">n</span> <span class="main">=</span> <span class="skolem">x</span>›</span></span> g_def<span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> ordering2_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">smt</span> <span class="comment1">(* sledgehammer proposes both meson and auto, neither of which work... *)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"long_ch_by_ord2 <span class="free">g</span> <span class="var">?X</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> long_ch_by_ord2_def
    <span class="keyword1"><span class="command">using</span></span> points_in_chain fin_long_chain_def <span class="quoted"><span class="quoted">‹<span class="free">b</span><span class="main">∉</span><span class="free">Y</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> abc_abc_neq bY insert_iff long_ch_Y points_in_chain<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"long_ch_by_ord <span class="free">g</span> <span class="var">?X</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ch_equiv fin_Y
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> fin_long_chain_def finite_insert long_ch_Y<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> fin_long_chain_def
    <span class="keyword1"><span class="command">using</span></span> bound_indices <span class="quoted"><span class="quoted">‹<span class="free">b</span><span class="main">∉</span><span class="free">Y</span>›</span></span> g_def num_ord points_in_chain long_ch_Y fin_long_chain_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> card.insert diff_Suc_1 finite_insert insert_iff less_trans nat_less_le<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  This is case (iii) of the induction in Theorem 10.
  Schutz says merely ``The proof for this case is similar to that for Case (i).''
  Thus I feel free to use a result on symmetry, rather than going through
  the pain of Case (i) (<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>chain_append_at_left_edge›</span></span></span></span>) again.
›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="comment1">(*for 10*)</span> chain_append_at_right_edge<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> long_ch_Y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">f</span><span class="main">[</span><span class="free">a<span class="hidden">⇩</span><sub>1</sub></span><span class="main">..</span><span class="free">a</span><span class="main">..</span><span class="free">a<span class="hidden">⇩</span><sub>n</sub></span><span class="main">]</span><span class="free">Y</span><span class="main">]</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> Yb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">b</span><span class="main"><span class="free">]]</span></span>"</span></span>
    <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">g</span> <span class="keyword2"><span class="keyword">defines</span></span> g_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">::</span>nat<span class="main">.</span> <span class="keyword1">if</span> <span class="bound">j</span> <span class="main">≤</span> <span class="main">(</span>card <span class="free">Y</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">then</span> <span class="free">f</span> <span class="bound">j</span> <span class="keyword1">else</span> <span class="free">b</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">g</span><span class="main">[</span><span class="free">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">..</span> <span class="free">a<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">..</span> <span class="free">b</span><span class="main">]</span><span class="main">(</span>insert <span class="free">b</span> <span class="free">Y</span><span class="main">)</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?X</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"insert <span class="free">b</span> <span class="free">Y</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">∉</span><span class="free">Y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Yb abc_abc_neq abc_only_cba<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> ch_all_betw_f long_ch_Y<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> fin_X<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="var">?X</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> fin_long_chain_def long_ch_Y <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> fin_Y<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="free">Y</span> <span class="main">≥</span> <span class="numeral">3</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> ch_by_ord_def fin_long_chain_def long_ch_Y long_ch_card_ge3<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a<span class="hidden">⇩</span><sub>1</sub></span><span class="main">∈</span><span class="free">Y</span> <span class="main">∧</span> <span class="free">a<span class="hidden">⇩</span><sub>n</sub></span><span class="main">∈</span><span class="free">Y</span> <span class="main">∧</span> <span class="free">a</span><span class="main">∈</span><span class="free">Y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> long_ch_Y points_in_chain <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a<span class="hidden">⇩</span><sub>1</sub></span><span class="main">≠</span><span class="free">a</span> <span class="main">∧</span> <span class="free">a</span><span class="main">≠</span> <span class="free">a<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">∧</span> <span class="free">a<span class="hidden">⇩</span><sub>1</sub></span><span class="main">≠</span><span class="free">a<span class="hidden">⇩</span><sub>n</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> fin_long_chain_def long_ch_Y <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>card <span class="free">Y</span><span class="main">)</span> <span class="main">=</span> card <span class="var">?X</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span><span class="main">∉</span><span class="free">Y</span>›</span></span> fin_X fin_long_chain_def long_ch_Y <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f2</span></span> <span class="keyword2"><span class="keyword">where</span></span> f2_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">f2</span><span class="main">[</span><span class="free">a<span class="hidden">⇩</span><sub>n</sub></span><span class="main">..</span><span class="free">a</span><span class="main">..</span><span class="free">a<span class="hidden">⇩</span><sub>1</sub></span><span class="main">]</span><span class="free">Y</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f2</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span>card <span class="free">Y</span> <span class="main">-</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> chain_sym long_ch_Y <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g2</span></span> <span class="keyword2"><span class="keyword">where</span></span> g2_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g2</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">::</span>nat<span class="main">.</span> <span class="keyword1">if</span> <span class="bound">j</span><span class="main">≥</span><span class="main">1</span> <span class="keyword1">then</span> <span class="skolem">f2</span> <span class="main">(</span><span class="bound">j</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="keyword1">else</span> <span class="free">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">b</span> <span class="free">a<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">a<span class="hidden">⇩</span><sub>1</sub></span><span class="main"><span class="free">]]</span></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> abc_sym Yb <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> g2_ord_X<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">g2</span><span class="main">[</span><span class="free">b</span> <span class="main">..</span> <span class="free">a<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">..</span> <span class="free">a<span class="hidden">⇩</span><sub>1</sub></span><span class="main">]</span><span class="var">?X</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> chain_append_at_left_edge <span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> a<span class="hidden">⇩</span><sub>1</sub><span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">a<span class="hidden">⇩</span><sub>n</sub></span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> a<span class="hidden">⇩</span><sub>n</sub><span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">a<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> f<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">f2</span>"</span></span><span class="main">]</span>
      fin_X <span class="quoted"><span class="quoted">‹<span class="free">b</span><span class="main">∉</span><span class="free">Y</span>›</span></span> f2_def g2_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g1</span></span> <span class="keyword2"><span class="keyword">where</span></span> g1_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">g1</span><span class="main">[</span><span class="free">a<span class="hidden">⇩</span><sub>1</sub></span><span class="main">..</span><span class="free">a<span class="hidden">⇩</span><sub>n</sub></span><span class="main">..</span><span class="free">b</span><span class="main">]</span><span class="var">?X</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g1</span><span class="main">=</span><span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">g2</span> <span class="main">(</span>card <span class="var">?X</span> <span class="main">-</span> <span class="main">1</span> <span class="main">-</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> chain_sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> sYX<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>card <span class="free">Y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>card <span class="var">?X</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> fin_long_chain_def long_ch_Y <span class="quoted"><span class="quoted">‹Suc <span class="main">(</span>card <span class="free">Y</span><span class="main">)</span> <span class="main">=</span> card <span class="var">?X</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g1</span><span class="main">=</span><span class="free">g</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> g1_def g2_def f2_def g_def
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>
            <span class="keyword1">if</span> <span class="main">1</span> <span class="main">≤</span> card <span class="var">?X</span> <span class="main">-</span> <span class="main">1</span> <span class="main">-</span> <span class="skolem">n</span> <span class="keyword1">then</span>
              <span class="free">f</span> <span class="main">(</span>card <span class="free">Y</span> <span class="main">-</span> <span class="main">1</span> <span class="main">-</span> <span class="main">(</span>card <span class="var">?X</span> <span class="main">-</span> <span class="main">1</span> <span class="main">-</span> <span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>
            <span class="keyword1">else</span> <span class="free">b</span>
          <span class="main">)</span> <span class="main">=</span> <span class="main">(</span>
            <span class="keyword1">if</span> <span class="skolem">n</span> <span class="main">≤</span> card <span class="free">Y</span> <span class="main">-</span> <span class="main">1</span> <span class="keyword1">then</span>
              <span class="free">f</span> <span class="skolem">n</span>
            <span class="keyword1">else</span> <span class="free">b</span>
          <span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span><span class="main">=</span><span class="var">?rhs</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≤</span> card <span class="var">?X</span> <span class="main">-</span> <span class="numeral">2</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span><span class="main">=</span><span class="var">?rhs</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">≤</span> card <span class="var">?X</span> <span class="main">-</span> <span class="numeral">2</span>›</span></span> fin_long_chain_def long_ch_Y sYX
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_1 Suc_diff_1 Suc_diff_le card_gt_0_iff diff_Suc_eq_diff_pred diff_commute
            diff_diff_cancel equals0D less_one nat.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> not_less<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">n</span> <span class="main">≤</span> card <span class="var">?X</span> <span class="main">-</span> <span class="numeral">2</span>"</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span><span class="main">=</span><span class="var">?rhs</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹Suc <span class="main">(</span>card <span class="free">Y</span><span class="main">)</span> <span class="main">=</span> card <span class="var">?X</span>›</span></span> Suc_1 diff_Suc_1 diff_Suc_eq_diff_pred diff_diff_cancel
            diff_is_0_eq' nat_le_linear not_less_eq_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> g1_def<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="TemporalOrderOnPath-S_is_dense"><span class="command">lemma</span></span> S_is_dense<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> long_ch_Y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">f</span><span class="main">[</span><span class="free">a<span class="hidden">⇩</span><sub>1</sub></span><span class="main">..</span><span class="free">a</span><span class="main">..</span><span class="free">a<span class="hidden">⇩</span><sub>n</sub></span><span class="main">]</span><span class="free">Y</span><span class="main">]</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> S_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">=</span> <span class="main">{</span><span class="bound">k</span><span class="main">::</span>nat<span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="free">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span><span class="free">f</span> <span class="bound">k</span><span class="main">)</span> <span class="free">b</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="bound">k</span> <span class="main">&lt;</span> card <span class="free">Y</span><span class="main">}</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> k_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span><span class="main">≠</span><span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> Max <span class="free">S</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> k'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k'</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">k'</span><span class="main">&lt;</span><span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">k'</span> <span class="main">∈</span> <span class="free">S</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span><span class="main">∈</span><span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> k_def Max_in S_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> finite_Collect_conjI finite_Collect_less_nat<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">k'</span> <span class="main">∈</span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="free">k'</span><span class="main">∈</span><span class="free">S</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">b</span> <span class="main">(</span><span class="free">f</span> <span class="free">k'</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> order_finite_chain S_def abc_acd_bcd abc_bcd_acd abc_sym long_ch_Y
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> fin_long_chain_def <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="free">k'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">k</span> <span class="main">∈</span> <span class="free">S</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">k'</span> <span class="main">&lt;</span> <span class="free">k</span>›</span></span> le_numeral_extra<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span>
          less_trans mem_Collect_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span><span class="free">f</span> <span class="free">k</span><span class="main">)</span> <span class="free">b</span><span class="main"><span class="free">]]</span></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> S_def <span class="quoted"><span class="quoted">‹<span class="free">k</span> <span class="main">∈</span> <span class="free">S</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="free">k</span><span class="main">)</span> <span class="free">b</span> <span class="main">(</span><span class="free">f</span> <span class="free">k'</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> abc_acd_bcd <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="free">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">b</span> <span class="main">(</span><span class="free">f</span> <span class="free">k'</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="free">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span><span class="free">f</span> <span class="free">k</span><span class="main">)</span> <span class="free">b</span><span class="main"><span class="free">]]</span></span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">k'</span> <span class="main">&lt;</span> card <span class="free">Y</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> S_def <span class="quoted"><span class="quoted">‹<span class="free">k</span> <span class="main">∈</span> <span class="free">S</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">k'</span> <span class="main">&lt;</span> <span class="free">k</span>›</span></span> less_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">using</span></span> abc_bcd_abd order_finite_chain S_def abc_only_cba<span class="main">(</span>2<span class="main">)</span> long_ch_Y
        <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="free">k'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="free">k</span><span class="main">)</span> <span class="free">b</span> <span class="main">(</span><span class="free">f</span> <span class="free">k'</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">k</span> <span class="main">∈</span> <span class="free">S</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">k'</span> <span class="main">&lt;</span> <span class="free">k</span>›</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> fin_long_chain_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> le_numeral_extra<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> mem_Collect_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> <span class="comment1">(*for 10*)</span> smallest_k_ex<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> long_ch_Y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">f</span><span class="main">[</span><span class="free">a<span class="hidden">⇩</span><sub>1</sub></span><span class="main">..</span><span class="free">a</span><span class="main">..</span><span class="free">a<span class="hidden">⇩</span><sub>n</sub></span><span class="main">]</span><span class="free">Y</span><span class="main">]</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> Y_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">∉</span><span class="free">Y</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> Yb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">b</span> <span class="free">a<span class="hidden">⇩</span><sub>n</sub></span><span class="main"><span class="free">]]</span></span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">k</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="free">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">b</span> <span class="main">(</span><span class="free">f</span> <span class="bound">k</span><span class="main">)</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="bound">k</span> <span class="main">&lt;</span> card <span class="free">Y</span> <span class="main">∧</span> <span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">k'</span></span><span class="main">&lt;</span><span class="bound">k</span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="free">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">b</span> <span class="main">(</span><span class="free">f</span> <span class="bound">k'</span><span class="main">)</span><span class="main"><span class="free">]]</span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
<span class="comment1">(* the usual suspects first, they'll come in useful I'm sure *)</span>
  <span class="keyword1"><span class="command">have</span></span> bound_indices<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">0</span> <span class="main">=</span> <span class="free">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∧</span> <span class="free">f</span> <span class="main">(</span>card <span class="free">Y</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="free">a<span class="hidden">⇩</span><sub>n</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> fin_long_chain_def long_ch_Y <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> fin_Y<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">Y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> fin_long_chain_def long_ch_Y <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> card_Y<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="free">Y</span> <span class="main">≥</span> <span class="numeral">3</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> fin_long_chain_def long_ch_Y points_in_chain
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> One_nat_def antisym card2_either_elt1_or_elt2 diff_is_0_eq'
        not_less_eq_eq numeral_2_eq_2 numeral_3_eq_3<span class="main">)</span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We consider all indices of chain elements between <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>a<span class="hidden">⇩</span><sub>1</sub>›</span></span></span></span> and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>b›</span></span></span></span>, and find the maximal one.›</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">k</span><span class="main">::</span>nat<span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="free">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span><span class="free">f</span> <span class="bound">k</span><span class="main">)</span> <span class="free">b</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="bound">k</span> <span class="main">&lt;</span> card <span class="free">Y</span><span class="main">}</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">S</span></span> <span class="keyword2"><span class="keyword">where</span></span> S_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span><span class="main">=</span><span class="var">?S</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="comment1">(* just to check this Isabelle-exists *)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span><span class="main">⊆</span><span class="main">{</span><span class="main">0</span><span class="main">..</span>card <span class="free">Y</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> S_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">S</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> finite_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span><span class="main">=</span><span class="main">{}</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span><span class="main">::</span>nat<span class="main">)</span><span class="main">&lt;</span><span class="main">1</span> <span class="main">∧</span> <span class="main"><span class="free">[[</span></span><span class="free">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">b</span> <span class="main">(</span><span class="free">f</span> <span class="main">1</span><span class="main">)</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="main">1</span> <span class="main">&lt;</span> card <span class="free">Y</span> <span class="main">∧</span> <span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">k'</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">k'</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">∧</span> <span class="main"><span class="free">[[</span></span><span class="free">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">b</span> <span class="main">(</span><span class="free">f</span> <span class="bound">k'</span><span class="main">)</span><span class="main"><span class="free">]]</span></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span><span class="main">::</span>nat<span class="main">)</span><span class="main">&lt;</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">&lt;</span> card <span class="free">Y</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> Yb abc_ac_neq bound_indices not_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
          <span class="comment1">(* using card_Y by linarith *)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">k'</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">k'</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">∧</span> <span class="main"><span class="free">[[</span></span><span class="free">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">b</span> <span class="main">(</span><span class="free">f</span> <span class="bound">k'</span><span class="main">)</span><span class="main"><span class="free">]]</span></span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> abc_abc_neq bound_indices
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">b</span> <span class="main">(</span><span class="free">f</span> <span class="main">1</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">1</span> <span class="main">∈</span> <span class="free">Y</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ordering_def diff_0_eq_0 fin_long_chain_def less_one long_ch_Y long_ch_by_ord_def nat_neq_iff<span class="main">)</span>
          <span class="comment1">(* have "[[a<span class="hidden">⇩</span><sub>1</sub> b f 1]] ∨ [[a<span class="hidden">⇩</span><sub>1</sub> f 1 b]]" *)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span><span class="free">f</span> <span class="main">1</span><span class="main">)</span> <span class="free">a<span class="hidden">⇩</span><sub>n</sub></span><span class="main"><span class="free">]]</span></span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> bound_indices long_ch_Y
            <span class="keyword1"><span class="command">unfolding</span></span> fin_long_chain_def long_ch_by_ord_def ordering_def
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> One_nat_def card.remove card_Diff1_less card_Diff_singleton diff_is_0_eq'
                le_eq_less_or_eq less_SucE neq0_conv zero_less_diff zero_less_one<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">b</span> <span class="main">(</span><span class="free">f</span> <span class="main">1</span><span class="main">)</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span><span class="free">f</span> <span class="main">1</span><span class="main">)</span> <span class="free">b</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">b</span> <span class="free">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span><span class="free">f</span> <span class="main">1</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> abc_ex_path_unique some_betw abc_sym
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> Y_def Yb <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">1</span> <span class="main">∈</span> <span class="free">Y</span>›</span></span> abc_abc_neq cross_once_notin<span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">b</span> <span class="main">(</span><span class="free">f</span> <span class="main">1</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
            <span class="comment1">(* by (smt S_def Yb ‹S = {}› ‹[[a<span class="hidden">⇩</span><sub>1</sub> f 1 a<span class="hidden">⇩</span><sub>n</sub>]]› abc_bcd_abd abc_sym abd_bcd_abc bound_indices
                diff_is_0_eq' empty_iff mem_Collect_eq nat_le_linear nat_less_le) *)</span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> <span class="main">(</span><span class="main"><span class="free">[[</span></span><span class="free">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span><span class="free">f</span> <span class="bound">n</span><span class="main">)</span> <span class="free">b</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="bound">n</span> <span class="main">&lt;</span> card <span class="free">Y</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> S_def <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">=</span> <span class="main">{}</span>›</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">b</span> <span class="main">(</span><span class="free">f</span> <span class="main">1</span><span class="main">)</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main">¬</span> <span class="main"><span class="free">[[</span></span><span class="free">a<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free">f</span> <span class="main">1</span><span class="main">)</span> <span class="free">b</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="main">¬</span> <span class="main"><span class="free">[[</span></span><span class="free">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span><span class="free">f</span> <span class="main">1</span><span class="main">)</span> <span class="free">b</span><span class="main"><span class="free">]]</span></span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> bound_indices abc_sym abd_bcd_abc Yb
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> diff_is_0_eq' nat_le_linear nat_less_le<span class="main">)</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">using</span></span> abc_bcd_abd abc_sym
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="free">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">b</span> <span class="main">(</span><span class="free">f</span> <span class="main">1</span><span class="main">)</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span><span class="free">f</span> <span class="main">1</span><span class="main">)</span> <span class="free">b</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">b</span> <span class="free">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span><span class="free">f</span> <span class="main">1</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="free">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span><span class="free">f</span> <span class="main">1</span><span class="main">)</span> <span class="free">a<span class="hidden">⇩</span><sub>n</sub></span><span class="main"><span class="free">]]</span></span>›</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="skolem">S</span><span class="main">=</span><span class="main">{}</span>"</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> Max <span class="skolem">S</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">∈</span> <span class="skolem">S</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Max_in
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">S</span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">≥</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">1</span> <span class="main">≤</span> <span class="skolem">k</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span><span class="free">f</span> <span class="skolem">k</span><span class="main">)</span> <span class="free">b</span><span class="main"><span class="free">]]</span></span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span><span class="main">∈</span><span class="skolem">S</span>›</span></span> S_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
        <span class="keyword1"><span class="command">using</span></span> bound_indices <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">=</span> <span class="main">0</span>›</span></span> abc_abc_neq
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?k</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">+</span><span class="main">1</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">&lt;</span><span class="var">?k</span> <span class="main">∧</span> <span class="main"><span class="free">[[</span></span><span class="free">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">b</span> <span class="main">(</span><span class="free">f</span> <span class="var">?k</span><span class="main">)</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="var">?k</span> <span class="main">&lt;</span> card <span class="free">Y</span> <span class="main">∧</span> <span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">k'</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">k'</span> <span class="main">&lt;</span> <span class="var">?k</span> <span class="main">∧</span> <span class="main"><span class="free">[[</span></span><span class="free">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">b</span> <span class="main">(</span><span class="free">f</span> <span class="bound">k'</span><span class="main">)</span><span class="main"><span class="free">]]</span></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span><span class="main">::</span>nat<span class="main">)</span><span class="main">&lt;</span><span class="var">?k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?k</span> <span class="main">&lt;</span> card <span class="free">Y</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> S_def Yb <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span> abc_only_cba<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> add.commute
              add_diff_cancel_right' bound_indices less_SucE mem_Collect_eq nat_add_left_cancel_less
              plus_1_eq_Suc<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">b</span> <span class="main">(</span><span class="free">f</span> <span class="var">?k</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="var">?k</span> <span class="main">∈</span> <span class="free">Y</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">+</span> <span class="main">1</span> <span class="main">&lt;</span> card <span class="free">Y</span>›</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ordering_def fin_long_chain_def long_ch_Y long_ch_by_ord_def<span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span><span class="free">f</span> <span class="var">?k</span><span class="main">)</span> <span class="free">a<span class="hidden">⇩</span><sub>n</sub></span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="free">f</span> <span class="var">?k</span> <span class="main">=</span> <span class="free">a<span class="hidden">⇩</span><sub>n</sub></span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> bound_indices long_ch_Y <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">+</span> <span class="main">1</span> <span class="main">&lt;</span> card <span class="free">Y</span>›</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> fin_long_chain_def long_ch_by_ord_def ordering_def
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Suc_lessI add.commute add_gr_0 card_Diff1_less
                card_Diff_singleton less_diff_conv plus_1_eq_Suc zero_less_one<span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span>  <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">b</span> <span class="main">(</span><span class="free">f</span> <span class="var">?k</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> disjE<span class="main">)</span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span><span class="free">f</span> <span class="var">?k</span><span class="main">)</span> <span class="free">a<span class="hidden">⇩</span><sub>n</sub></span><span class="main"><span class="free">]]</span></span>"</span></span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="var">?k</span> <span class="main">≠</span> <span class="free">a<span class="hidden">⇩</span><sub>n</sub></span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abc_abc_neq<span class="main">)</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">b</span> <span class="main">(</span><span class="free">f</span> <span class="var">?k</span><span class="main">)</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span><span class="free">f</span> <span class="var">?k</span><span class="main">)</span> <span class="free">b</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">b</span> <span class="free">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span><span class="free">f</span> <span class="var">?k</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> abc_ex_path_unique some_betw abc_sym <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="free">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span><span class="free">f</span> <span class="var">?k</span><span class="main">)</span> <span class="free">a<span class="hidden">⇩</span><sub>n</sub></span><span class="main"><span class="free">]]</span></span>›</span></span>
                <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="var">?k</span> <span class="main">∈</span> <span class="free">Y</span>›</span></span> Yb abc_abc_neq assms<span class="main">(</span>3<span class="main">)</span> cross_once_notin
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> Y_def<span class="main">)</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main"><span class="free">[[</span></span><span class="free">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span><span class="free">f</span> <span class="var">?k</span><span class="main">)</span> <span class="free">b</span><span class="main"><span class="free">]]</span></span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span>
              <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span><span class="free">f</span> <span class="var">?k</span><span class="main">)</span> <span class="free">b</span><span class="main"><span class="free">]]</span></span>"</span></span>
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?k</span> <span class="main">∈</span> <span class="skolem">S</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> S_def <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="free">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span><span class="free">f</span> <span class="var">?k</span><span class="main">)</span> <span class="free">b</span><span class="main"><span class="free">]]</span></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">+</span> <span class="main">1</span> <span class="main">&lt;</span> card <span class="free">Y</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?k</span> <span class="main">≤</span> <span class="skolem">k</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">S</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">=</span> Max <span class="skolem">S</span>›</span></span><span class="main">)</span>
              <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main"><span class="free">[[</span></span><span class="free">b</span> <span class="free">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span><span class="free">f</span> <span class="var">?k</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> Yb <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="free">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span><span class="free">f</span> <span class="var">?k</span><span class="main">)</span> <span class="free">a<span class="hidden">⇩</span><sub>n</sub></span><span class="main"><span class="free">]]</span></span>›</span></span> abc_only_cba
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">b</span> <span class="main">(</span><span class="free">f</span> <span class="var">?k</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="var">?k</span> <span class="main">=</span> <span class="free">a<span class="hidden">⇩</span><sub>n</sub></span>"</span></span>
            <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">using</span></span> Yb <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="free">a<span class="hidden">⇩</span><sub>n</sub></span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">k'</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">k'</span> <span class="main">&lt;</span> <span class="skolem">k</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="main"><span class="free">[[</span></span><span class="free">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">b</span> <span class="main">(</span><span class="free">f</span> <span class="bound">k'</span><span class="main">)</span><span class="main"><span class="free">]]</span></span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">k'</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">k'</span> <span class="main">&lt;</span> <span class="skolem">k</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> <span class="main"><span class="free">[[</span></span><span class="free">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">b</span> <span class="main">(</span><span class="free">f</span> <span class="bound">k'</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k'</span></span> <span class="keyword2"><span class="keyword">where</span></span> k'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k'</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k'</span> <span class="main">&lt;</span> <span class="skolem">k</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">b</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">k'</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> abc_ac_neq bound_indices neq0_conv
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k'</span><span class="main">&lt;</span><span class="skolem">k</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> S_def <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span> abc_only_cba<span class="main">(</span>2<span class="main">)</span> less_SucE <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k'</span><span class="main">∈</span><span class="skolem">S</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> S_is_dense long_ch_Y S_def <span class="quoted"><span class="quoted">‹<span class="main">¬</span><span class="skolem">S</span><span class="main">=</span><span class="main">{}</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">=</span> Max <span class="skolem">S</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k'</span><span class="main">&gt;</span><span class="main">0</span>›</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
            <span class="keyword1"><span class="command">using</span></span> S_def abc_only_cba<span class="main">(</span>2<span class="main">)</span> k'_def<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="comment1">(* TODO: there's definitely a way of doing this using chain_sym and smallest_k_ex. *)</span>
<span class="keyword1" id="TemporalOrderOnPath-greatest_k_ex"><span class="command">lemma</span></span> greatest_k_ex<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> long_ch_Y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">f</span><span class="main">[</span><span class="free">a<span class="hidden">⇩</span><sub>1</sub></span><span class="main">..</span><span class="free">a</span><span class="main">..</span><span class="free">a<span class="hidden">⇩</span><sub>n</sub></span><span class="main">]</span><span class="free">Y</span><span class="main">]</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> Y_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">∉</span><span class="free">Y</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> Yb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">b</span> <span class="free">a<span class="hidden">⇩</span><sub>n</sub></span><span class="main"><span class="free">]]</span></span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">k</span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="bound">k</span><span class="main">)</span> <span class="free">b</span> <span class="free">a<span class="hidden">⇩</span><sub>n</sub></span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="bound">k</span> <span class="main">&lt;</span> card <span class="free">Y</span> <span class="main">-</span> <span class="main">1</span> <span class="main">∧</span> <span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">k'</span></span><span class="main">&lt;</span>card <span class="free">Y</span><span class="main">.</span> <span class="bound">k'</span><span class="main">&gt;</span><span class="bound">k</span> <span class="main">∧</span> <span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="bound">k'</span><span class="main">)</span> <span class="free">b</span> <span class="free">a<span class="hidden">⇩</span><sub>n</sub></span><span class="main"><span class="free">]]</span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
<span class="comment1">(* the usual suspects first, they'll come in useful I'm sure *)</span>
  <span class="keyword1"><span class="command">have</span></span> bound_indices<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">0</span> <span class="main">=</span> <span class="free">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∧</span> <span class="free">f</span> <span class="main">(</span>card <span class="free">Y</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="free">a<span class="hidden">⇩</span><sub>n</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> fin_long_chain_def long_ch_Y <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> fin_Y<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">Y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> fin_long_chain_def long_ch_Y <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> card_Y<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="free">Y</span> <span class="main">≥</span> <span class="numeral">3</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> fin_long_chain_def long_ch_Y points_in_chain
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> One_nat_def antisym card2_either_elt1_or_elt2 diff_is_0_eq'
        not_less_eq_eq numeral_2_eq_2 numeral_3_eq_3<span class="main">)</span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Again we consider all indices of chain elements between <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>a<span class="hidden">⇩</span><sub>1</sub>›</span></span></span></span> and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>b›</span></span></span></span>.›</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">k</span><span class="main">::</span>nat<span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="free">a<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free">f</span> <span class="bound">k</span><span class="main">)</span> <span class="free">b</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="bound">k</span> <span class="main">&lt;</span> card <span class="free">Y</span><span class="main">}</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">S</span></span> <span class="keyword2"><span class="keyword">where</span></span> S_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span><span class="main">=</span><span class="var">?S</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="comment1">(* just to check this Isabelle-exists *)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span><span class="main">⊆</span><span class="main">{</span><span class="main">0</span><span class="main">..</span>card <span class="free">Y</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> S_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">S</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> finite_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span><span class="main">=</span><span class="main">{}</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?n</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"card <span class="free">Y</span> <span class="main">-</span> <span class="numeral">2</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="var">?n</span><span class="main">)</span> <span class="free">b</span> <span class="free">a<span class="hidden">⇩</span><sub>n</sub></span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="var">?n</span> <span class="main">&lt;</span> card <span class="free">Y</span> <span class="main">-</span> <span class="main">1</span> <span class="main">∧</span> <span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">k'</span></span><span class="main">&lt;</span>card <span class="free">Y</span><span class="main">.</span> <span class="bound">k'</span><span class="main">&gt;</span><span class="var">?n</span> <span class="main">∧</span> <span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="bound">k'</span><span class="main">)</span> <span class="free">b</span> <span class="free">a<span class="hidden">⇩</span><sub>n</sub></span><span class="main"><span class="free">]]</span></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?n</span> <span class="main">&lt;</span> card <span class="free">Y</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> Yb abc_ac_neq bound_indices not_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">k'</span></span><span class="main">&lt;</span>card <span class="free">Y</span><span class="main">.</span> <span class="bound">k'</span><span class="main">&gt;</span><span class="var">?n</span> <span class="main">∧</span> <span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="bound">k'</span><span class="main">)</span> <span class="free">b</span> <span class="free">a<span class="hidden">⇩</span><sub>n</sub></span><span class="main"><span class="free">]]</span></span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> abc_abc_neq bound_indices
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def Suc_diff_le Suc_leD Suc_lessI card_Y diff_Suc_1 diff_Suc_Suc
              not_less_eq numeral_2_eq_2 numeral_3_eq_3<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="var">?n</span><span class="main">)</span> <span class="free">b</span> <span class="free">a<span class="hidden">⇩</span><sub>n</sub></span><span class="main"><span class="free">]]</span></span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="var">?n</span> <span class="main">∈</span> <span class="free">Y</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ordering_def diff_less fin_long_chain_def gr_implies_not0 long_ch_Y
                long_ch_by_ord_def neq0_conv not_less_eq numeral_2_eq_2<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span><span class="free">f</span> <span class="var">?n</span><span class="main">)</span> <span class="free">a<span class="hidden">⇩</span><sub>n</sub></span><span class="main"><span class="free">]]</span></span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> bound_indices long_ch_Y
            <span class="keyword1"><span class="command">unfolding</span></span> fin_long_chain_def long_ch_by_ord_def ordering_def
            <span class="keyword1"><span class="command">using</span></span> card_Y <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">b</span> <span class="main">(</span><span class="free">f</span> <span class="var">?n</span><span class="main">)</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">a<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free">f</span> <span class="var">?n</span><span class="main">)</span> <span class="free">b</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">b</span> <span class="free">a<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free">f</span> <span class="var">?n</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> abc_ex_path_unique some_betw abc_sym
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> Y_def Yb <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="var">?n</span> <span class="main">∈</span> <span class="free">Y</span>›</span></span> abc_abc_neq cross_once_notin<span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="var">?n</span><span class="main">)</span> <span class="free">b</span> <span class="free">a<span class="hidden">⇩</span><sub>n</sub></span><span class="main"><span class="free">]]</span></span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> <span class="main">(</span><span class="main"><span class="free">[[</span></span><span class="free">a<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free">f</span> <span class="bound">n</span><span class="main">)</span> <span class="free">b</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="bound">n</span> <span class="main">&lt;</span> card <span class="free">Y</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> S_def <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">=</span> <span class="main">{}</span>›</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">b</span> <span class="main">(</span><span class="free">f</span> <span class="var">?n</span><span class="main">)</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main">¬</span> <span class="main"><span class="free">[[</span></span><span class="free">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span><span class="free">f</span> <span class="var">?n</span><span class="main">)</span> <span class="free">b</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="main">¬</span> <span class="main"><span class="free">[[</span></span><span class="free">a<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free">f</span> <span class="var">?n</span><span class="main">)</span> <span class="free">b</span><span class="main"><span class="free">]]</span></span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> bound_indices abc_sym abd_bcd_abc Yb
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">(</span>card <span class="free">Y</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">∈</span> <span class="free">Y</span>›</span></span> card_gt_0_iff diff_less empty_iff fin_Y zero_less_numeral<span class="main">)</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">using</span></span> abc_bcd_abd abc_sym
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="free">a<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">b</span> <span class="main">(</span><span class="free">f</span> <span class="var">?n</span><span class="main">)</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">a<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free">f</span> <span class="var">?n</span><span class="main">)</span> <span class="free">b</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">b</span> <span class="free">a<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free">f</span> <span class="var">?n</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="free">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span><span class="free">f</span> <span class="var">?n</span><span class="main">)</span> <span class="free">a<span class="hidden">⇩</span><sub>n</sub></span><span class="main"><span class="free">]]</span></span>›</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="skolem">S</span><span class="main">=</span><span class="main">{}</span>"</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> Min <span class="skolem">S</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">∈</span> <span class="skolem">S</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Max_in
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">S</span>›</span></span><span class="main">)</span>

    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?k</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">-</span><span class="main">1</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="var">?k</span><span class="main">)</span> <span class="free">b</span> <span class="free">a<span class="hidden">⇩</span><sub>n</sub></span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="var">?k</span> <span class="main">&lt;</span> card <span class="free">Y</span> <span class="main">-</span> <span class="main">1</span> <span class="main">∧</span> <span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">k'</span></span><span class="main">&lt;</span>card <span class="free">Y</span><span class="main">.</span> <span class="var">?k</span> <span class="main">&lt;</span> <span class="bound">k'</span> <span class="main">∧</span> <span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="bound">k'</span><span class="main">)</span> <span class="free">b</span> <span class="free">a<span class="hidden">⇩</span><sub>n</sub></span><span class="main"><span class="free">]]</span></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?k</span> <span class="main">&lt;</span> card <span class="free">Y</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> S_def <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span> less_imp_diff_less card_Y
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> One_nat_def diff_is_0_eq' diff_less_mono lessI less_le_trans
              mem_Collect_eq nat_le_linear numeral_3_eq_3 zero_less_diff<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="var">?k</span><span class="main">)</span> <span class="free">b</span> <span class="free">a<span class="hidden">⇩</span><sub>n</sub></span><span class="main"><span class="free">]]</span></span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="var">?k</span> <span class="main">∈</span> <span class="free">Y</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">-</span> <span class="main">1</span> <span class="main">&lt;</span> card <span class="free">Y</span> <span class="main">-</span> <span class="main">1</span>›</span></span> long_ch_Y long_ch_by_ord_def ordering_def
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> diff_less fin_long_chain_def less_trans neq0_conv zero_less_one<span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span><span class="free">f</span> <span class="var">?k</span><span class="main">)</span> <span class="free">a<span class="hidden">⇩</span><sub>n</sub></span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="free">f</span> <span class="var">?k</span> <span class="main">=</span> <span class="free">a<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> bound_indices long_ch_Y <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">-</span> <span class="main">1</span> <span class="main">&lt;</span> card <span class="free">Y</span> <span class="main">-</span> <span class="main">1</span>›</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> fin_long_chain_def long_ch_by_ord_def ordering_def
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> S_def <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span> add_diff_inverse_nat card_Diff1_less card_Diff_singleton
                less_numeral_extra<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> less_trans mem_Collect_eq nat_add_left_cancel_less
                neq0_conv zero_less_diff<span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span>  <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="var">?k</span><span class="main">)</span> <span class="free">b</span> <span class="free">a<span class="hidden">⇩</span><sub>n</sub></span><span class="main"><span class="free">]]</span></span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> disjE<span class="main">)</span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span><span class="free">f</span> <span class="var">?k</span><span class="main">)</span> <span class="free">a<span class="hidden">⇩</span><sub>n</sub></span><span class="main"><span class="free">]]</span></span>"</span></span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="var">?k</span> <span class="main">≠</span> <span class="free">a<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> abc_abc_neq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">b</span> <span class="main">(</span><span class="free">f</span> <span class="var">?k</span><span class="main">)</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">a<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free">f</span> <span class="var">?k</span><span class="main">)</span> <span class="free">b</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">b</span> <span class="free">a<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free">f</span> <span class="var">?k</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> abc_ex_path_unique some_betw abc_sym <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="free">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span><span class="free">f</span> <span class="var">?k</span><span class="main">)</span> <span class="free">a<span class="hidden">⇩</span><sub>n</sub></span><span class="main"><span class="free">]]</span></span>›</span></span>
                <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="var">?k</span> <span class="main">∈</span> <span class="free">Y</span>›</span></span> Yb abc_abc_neq assms<span class="main">(</span>3<span class="main">)</span> cross_once_notin
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> Y_def<span class="main">)</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main"><span class="free">[[</span></span><span class="free">a<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free">f</span> <span class="var">?k</span><span class="main">)</span> <span class="free">b</span><span class="main"><span class="free">]]</span></span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span>
              <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free">f</span> <span class="var">?k</span><span class="main">)</span> <span class="free">b</span><span class="main"><span class="free">]]</span></span>"</span></span>
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?k</span> <span class="main">∈</span> <span class="skolem">S</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> S_def <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="free">a<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free">f</span> <span class="var">?k</span><span class="main">)</span> <span class="free">b</span><span class="main"><span class="free">]]</span></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">-</span> <span class="main">1</span> <span class="main">&lt;</span> card <span class="free">Y</span> <span class="main">-</span> <span class="main">1</span>›</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?k</span> <span class="main">≥</span> <span class="skolem">k</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">S</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">=</span> Min <span class="skolem">S</span>›</span></span><span class="main">)</span>
              <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
                <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">≠</span> <span class="free">a<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> fin_long_chain_def long_ch_Y
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main"><span class="free">[[</span></span><span class="free">b</span> <span class="free">a<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">(</span><span class="free">f</span> <span class="var">?k</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> Yb <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="free">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span><span class="free">f</span> <span class="var">?k</span><span class="main">)</span> <span class="free">a<span class="hidden">⇩</span><sub>n</sub></span><span class="main"><span class="free">]]</span></span>›</span></span> abc_only_cba<span class="main">(</span>2<span class="main">)</span> abc_bcd_acd
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="var">?k</span><span class="main">)</span> <span class="free">b</span> <span class="free">a<span class="hidden">⇩</span><sub>n</sub></span><span class="main"><span class="free">]]</span></span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> abc_sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="var">?k</span> <span class="main">=</span> <span class="free">a<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
            <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">using</span></span> Yb <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="free">a<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">k'</span></span><span class="main">&lt;</span>card <span class="free">Y</span><span class="main">.</span> <span class="skolem">k</span><span class="main">-</span><span class="main">1</span> <span class="main">&lt;</span> <span class="bound">k'</span> <span class="main">∧</span> <span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="bound">k'</span><span class="main">)</span> <span class="free">b</span> <span class="free">a<span class="hidden">⇩</span><sub>n</sub></span><span class="main"><span class="free">]]</span></span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">k'</span></span><span class="main">&lt;</span>card <span class="free">Y</span><span class="main">.</span> <span class="skolem">k</span><span class="main">-</span><span class="main">1</span> <span class="main">&lt;</span> <span class="bound">k'</span> <span class="main">∧</span> <span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="bound">k'</span><span class="main">)</span> <span class="free">b</span> <span class="free">a<span class="hidden">⇩</span><sub>n</sub></span><span class="main"><span class="free">]]</span></span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k'</span></span> <span class="keyword2"><span class="keyword">where</span></span> k'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k'</span><span class="main">&lt;</span>card <span class="free">Y</span> <span class="main">-</span><span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k'</span> <span class="main">&gt;</span> <span class="skolem">k</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">b</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">k'</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> abc_ac_neq bound_indices neq0_conv
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_diff_1 abc_sym gr_implies_not0 less_SucE<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k'</span><span class="main">&gt;</span><span class="skolem">k</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> S_def <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span> abc_only_cba<span class="main">(</span>2<span class="main">)</span> less_SucE
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> add_diff_inverse_nat less_one mem_Collect_eq
                not_less_eq plus_1_eq_Suc<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k'</span><span class="main">∈</span><span class="skolem">S</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> S_is_dense long_ch_Y S_def <span class="quoted"><span class="quoted">‹<span class="main">¬</span><span class="skolem">S</span><span class="main">=</span><span class="main">{}</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">=</span> Min <span class="skolem">S</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k'</span><span class="main">&lt;</span>card <span class="free">Y</span> <span class="main">-</span> <span class="main">1</span>›</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> Yb <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span> abc_acd_bcd abc_only_cba<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> card_Diff1_less card_Diff_singleton
                fin_long_chain_def k'_def<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> less_le mem_Collect_eq neq0_conv order_finite_chain<span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
            <span class="keyword1"><span class="command">using</span></span> S_def abc_only_cba<span class="main">(</span>2<span class="main">)</span> k'_def<span class="main">(</span>3<span class="main">)</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="TemporalOrderOnPath-get_closest_chain_events"><span class="command">lemma</span></span> get_closest_chain_events<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> long_ch_Y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">f</span><span class="main">[</span><span class="free">a<span class="hidden">⇩</span><sub>0</sub></span><span class="main">..</span><span class="free">a</span><span class="main">..</span><span class="free">a<span class="hidden">⇩</span><sub>n</sub></span><span class="main">]</span><span class="free">Y</span><span class="main">]</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> x_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">∉</span><span class="free">Y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a<span class="hidden">⇩</span><sub>0</sub></span> <span class="free">x</span> <span class="free">a<span class="hidden">⇩</span><sub>n</sub></span><span class="main"><span class="free">]]</span></span>"</span></span>
    <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">n<span class="hidden">⇩</span><sub>b</sub></span> <span class="free">n<span class="hidden">⇩</span><sub>c</sub></span> <span class="free">b</span> <span class="free">c</span>
      <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">=</span><span class="free">f</span> <span class="free">n<span class="hidden">⇩</span><sub>b</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">=</span><span class="free">f</span> <span class="free">n<span class="hidden">⇩</span><sub>c</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">b</span> <span class="free">x</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">∈</span><span class="free">Y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">∈</span><span class="free">Y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n<span class="hidden">⇩</span><sub>b</sub></span> <span class="main">=</span> <span class="free">n<span class="hidden">⇩</span><sub>c</sub></span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n<span class="hidden">⇩</span><sub>c</sub></span><span class="main">&lt;</span>card <span class="free">Y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n<span class="hidden">⇩</span><sub>c</sub></span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
            <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">k</span></span> <span class="main">&lt;</span> card <span class="free">Y</span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="bound">k</span><span class="main">)</span> <span class="free">x</span> <span class="free">a<span class="hidden">⇩</span><sub>n</sub></span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="bound">k</span><span class="main">&gt;</span><span class="free">n<span class="hidden">⇩</span><sub>b</sub></span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">k</span></span><span class="main">&lt;</span><span class="free">n<span class="hidden">⇩</span><sub>c</sub></span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="free">a<span class="hidden">⇩</span><sub>0</sub></span> <span class="free">x</span> <span class="main">(</span><span class="free">f</span> <span class="bound">k</span><span class="main">)</span><span class="main"><span class="free">]]</span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">n<span class="hidden">⇩</span><sub>b</sub></span> <span class="bound">n<span class="hidden">⇩</span><sub>c</sub></span> <span class="bound">b</span> <span class="bound">c</span><span class="main">.</span> <span class="bound">b</span><span class="main">=</span><span class="free">f</span> <span class="bound">n<span class="hidden">⇩</span><sub>b</sub></span> <span class="main">∧</span> <span class="bound">c</span><span class="main">=</span><span class="free">f</span> <span class="bound">n<span class="hidden">⇩</span><sub>c</sub></span> <span class="main">∧</span> <span class="main"><span class="free">[[</span></span><span class="bound">b</span> <span class="free">x</span> <span class="bound">c</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="bound">b</span><span class="main">∈</span><span class="free">Y</span> <span class="main">∧</span> <span class="bound">c</span><span class="main">∈</span><span class="free">Y</span> <span class="main">∧</span> <span class="bound">n<span class="hidden">⇩</span><sub>b</sub></span> <span class="main">=</span> <span class="bound">n<span class="hidden">⇩</span><sub>c</sub></span> <span class="main">-</span> <span class="main">1</span> <span class="main">∧</span> <span class="bound">n<span class="hidden">⇩</span><sub>c</sub></span><span class="main">&lt;</span>card <span class="free">Y</span> <span class="main">∧</span> <span class="bound">n<span class="hidden">⇩</span><sub>c</sub></span><span class="main">&gt;</span><span class="main">0</span>
    <span class="main">∧</span> <span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">k</span></span> <span class="main">&lt;</span> card <span class="free">Y</span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="bound">k</span><span class="main">)</span> <span class="free">x</span> <span class="free">a<span class="hidden">⇩</span><sub>n</sub></span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="bound">k</span><span class="main">&gt;</span><span class="bound">n<span class="hidden">⇩</span><sub>b</sub></span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">k</span></span> <span class="main">&lt;</span> <span class="bound">n<span class="hidden">⇩</span><sub>c</sub></span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="free">a<span class="hidden">⇩</span><sub>0</sub></span> <span class="free">x</span> <span class="main">(</span><span class="free">f</span> <span class="bound">k</span><span class="main">)</span><span class="main"><span class="free">]]</span></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> bound_indices<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">0</span> <span class="main">=</span> <span class="free">a<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">∧</span> <span class="free">f</span> <span class="main">(</span>card <span class="free">Y</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="free">a<span class="hidden">⇩</span><sub>n</sub></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> fin_long_chain_def long_ch_Y <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">Y</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> fin_long_chain_def long_ch_Y <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">P</span></span> <span class="keyword2"><span class="keyword">where</span></span> P_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span><span class="main">∈</span><span class="free">𝒫</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Y</span><span class="main">⊆</span><span class="skolem">P</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> chain_on_path long_ch_Y
      <span class="keyword1"><span class="command">unfolding</span></span> fin_long_chain_def ch_by_ord_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">∈</span><span class="skolem">P</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> betw_b_in_path x_def<span class="main">(</span>2<span class="main">)</span> long_ch_Y points_in_chain
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> abc_abc_neq in_mono<span class="main">)</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n<span class="hidden">⇩</span><sub>c</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> nc_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">k</span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="free">a<span class="hidden">⇩</span><sub>0</sub></span> <span class="free">x</span> <span class="main">(</span><span class="free">f</span> <span class="bound">k</span><span class="main">)</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="bound">k</span><span class="main">&lt;</span><span class="skolem">n<span class="hidden">⇩</span><sub>c</sub></span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a<span class="hidden">⇩</span><sub>0</sub></span> <span class="free">x</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">n<span class="hidden">⇩</span><sub>c</sub></span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n<span class="hidden">⇩</span><sub>c</sub></span><span class="main">&lt;</span>card <span class="free">Y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n<span class="hidden">⇩</span><sub>c</sub></span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> smallest_k_ex <span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> a<span class="hidden">⇩</span><sub>1</sub><span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">a<span class="hidden">⇩</span><sub>0</sub></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">a</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> a<span class="hidden">⇩</span><sub>n</sub><span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">a<span class="hidden">⇩</span><sub>n</sub></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> f<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">f</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> Y<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">Y</span></span><span class="main">]</span>
        long_ch_Y x_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> c_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">=</span><span class="free">f</span> <span class="skolem">n<span class="hidden">⇩</span><sub>c</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">∈</span><span class="free">Y</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> long_ch_Y long_ch_by_ord_def fin_long_chain_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ordering_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> c_goal<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">=</span><span class="free">f</span> <span class="skolem">n<span class="hidden">⇩</span><sub>c</sub></span> <span class="main">∧</span> <span class="skolem">c</span><span class="main">∈</span><span class="free">Y</span> <span class="main">∧</span> <span class="skolem">n<span class="hidden">⇩</span><sub>c</sub></span><span class="main">&lt;</span>card <span class="free">Y</span> <span class="main">∧</span> <span class="skolem">n<span class="hidden">⇩</span><sub>c</sub></span><span class="main">&gt;</span><span class="main">0</span> <span class="main">∧</span> <span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">k</span></span> <span class="main">&lt;</span> card <span class="free">Y</span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="free">a<span class="hidden">⇩</span><sub>0</sub></span> <span class="free">x</span> <span class="main">(</span><span class="free">f</span> <span class="bound">k</span><span class="main">)</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="bound">k</span><span class="main">&lt;</span><span class="skolem">n<span class="hidden">⇩</span><sub>c</sub></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> c_def nc_def<span class="main">(</span>1<span class="main">,</span>3<span class="main">,</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n<span class="hidden">⇩</span><sub>b</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> nb_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">k</span></span> <span class="main">&lt;</span> card <span class="free">Y</span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="bound">k</span><span class="main">)</span> <span class="free">x</span> <span class="free">a<span class="hidden">⇩</span><sub>n</sub></span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="bound">k</span><span class="main">&gt;</span><span class="skolem">n<span class="hidden">⇩</span><sub>b</sub></span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="skolem">n<span class="hidden">⇩</span><sub>b</sub></span><span class="main">)</span> <span class="free">x</span> <span class="free">a<span class="hidden">⇩</span><sub>n</sub></span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n<span class="hidden">⇩</span><sub>b</sub></span><span class="main">&lt;</span>card <span class="free">Y</span><span class="main">-</span><span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> greatest_k_ex <span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> a<span class="hidden">⇩</span><sub>1</sub><span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">a<span class="hidden">⇩</span><sub>0</sub></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">a</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> a<span class="hidden">⇩</span><sub>n</sub><span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">a<span class="hidden">⇩</span><sub>n</sub></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> f<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">f</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> Y<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">Y</span></span><span class="main">]</span>
        long_ch_Y x_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n<span class="hidden">⇩</span><sub>b</sub></span><span class="main">&lt;</span>card <span class="free">Y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> b_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">=</span><span class="free">f</span> <span class="skolem">n<span class="hidden">⇩</span><sub>b</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">∈</span><span class="free">Y</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> nb_def long_ch_Y long_ch_by_ord_def fin_long_chain_def ordering_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="skolem">b</span> <span class="free">x</span> <span class="skolem">c</span><span class="main"><span class="free">]]</span></span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="skolem">b</span> <span class="free">x</span> <span class="free">a<span class="hidden">⇩</span><sub>n</sub></span><span class="main"><span class="free">]]</span></span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> b_def<span class="main">(</span>1<span class="main">)</span> nb_def<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a<span class="hidden">⇩</span><sub>0</sub></span> <span class="free">x</span> <span class="skolem">c</span><span class="main"><span class="free">]]</span></span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> c_def<span class="main">(</span>1<span class="main">)</span> nc_def<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="bound">a</span> <span class="free">x</span> <span class="skolem">b</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main">¬</span> <span class="main"><span class="free">[[</span></span><span class="bound">a</span> <span class="free">a<span class="hidden">⇩</span><sub>n</sub></span> <span class="free">x</span><span class="main"><span class="free">]]</span></span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="skolem">b</span> <span class="free">x</span> <span class="free">a<span class="hidden">⇩</span><sub>n</sub></span><span class="main"><span class="free">]]</span></span>›</span></span> abc_bcd_acd
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> abc_sym<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="bound">a</span> <span class="free">x</span> <span class="skolem">b</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main">¬</span> <span class="main"><span class="free">[[</span></span><span class="free">a<span class="hidden">⇩</span><sub>n</sub></span> <span class="bound">a</span> <span class="free">x</span><span class="main"><span class="free">]]</span></span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="skolem">b</span> <span class="free">x</span> <span class="free">a<span class="hidden">⇩</span><sub>n</sub></span><span class="main"><span class="free">]]</span></span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> abc_acd_bcd abc_sym<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">=</span> <span class="skolem">c</span> <span class="main">⟶</span> <span class="main"><span class="free">[[</span></span><span class="skolem">b</span> <span class="free">x</span> <span class="skolem">c</span><span class="main"><span class="free">]]</span></span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="skolem">b</span> <span class="free">x</span> <span class="free">a<span class="hidden">⇩</span><sub>n</sub></span><span class="main"><span class="free">]]</span></span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> abc_abd_bcdbdc abc_sym x_def<span class="main">(</span>2<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n<span class="hidden">⇩</span><sub>b</sub></span><span class="main">&lt;</span><span class="skolem">n<span class="hidden">⇩</span><sub>c</sub></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="skolem">b</span> <span class="free">x</span> <span class="skolem">c</span><span class="main"><span class="free">]]</span></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n<span class="hidden">⇩</span><sub>c</sub></span><span class="main">&lt;</span>card <span class="free">Y</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n<span class="hidden">⇩</span><sub>b</sub></span><span class="main">&lt;</span>card <span class="free">Y</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">n<span class="hidden">⇩</span><sub>c</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">n<span class="hidden">⇩</span><sub>b</sub></span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="comment1">(* TODO *)</span>
          <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">thesis</span><span class="main">.</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">n<span class="hidden">⇩</span><sub>b</sub></span><span class="main">.</span> <span class="main">⟦</span><span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">k</span></span><span class="main">&lt;</span>card <span class="free">Y</span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="bound">k</span><span class="main">)</span> <span class="free">x</span> <span class="free">a<span class="hidden">⇩</span><sub>n</sub></span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="bound">n<span class="hidden">⇩</span><sub>b</sub></span> <span class="main">&lt;</span> <span class="bound">k</span><span class="main">)</span><span class="main">;</span> <span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="bound">n<span class="hidden">⇩</span><sub>b</sub></span><span class="main">)</span> <span class="free">x</span> <span class="free">a<span class="hidden">⇩</span><sub>n</sub></span><span class="main"><span class="free">]]</span></span><span class="main">;</span> <span class="bound">n<span class="hidden">⇩</span><sub>b</sub></span> <span class="main">&lt;</span> card <span class="free">Y</span> <span class="main">-</span> <span class="main">1</span><span class="main">⟧</span>
          <span class="main">⟹</span> <span class="bound">thesis</span><span class="main">)</span> <span class="main">⟹</span> <span class="bound">thesis</span>›</span></span> abc_abd_acdadc abc_ac_neq abc_only_cba diff_less
          fin_long_chain_def le_antisym le_trans less_imp_le_nat less_numeral_extra<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span>
          linorder_neqE_nat long_ch_Y nb_def<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> nc_def<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> order_finite_chain<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n<span class="hidden">⇩</span><sub>b</sub></span> <span class="main">=</span> <span class="skolem">n<span class="hidden">⇩</span><sub>c</sub></span> <span class="main">-</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n<span class="hidden">⇩</span><sub>b</sub></span> <span class="main">≠</span> <span class="skolem">n<span class="hidden">⇩</span><sub>c</sub></span> <span class="main">-</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n<span class="hidden">⇩</span><sub>b</sub></span><span class="main">&lt;</span><span class="skolem">n<span class="hidden">⇩</span><sub>c</sub></span><span class="main">-</span><span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n<span class="hidden">⇩</span><sub>b</sub></span> <span class="main">≠</span> <span class="skolem">n<span class="hidden">⇩</span><sub>c</sub></span> <span class="main">-</span> <span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n<span class="hidden">⇩</span><sub>b</sub></span><span class="main">&lt;</span><span class="skolem">n<span class="hidden">⇩</span><sub>c</sub></span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="skolem">n<span class="hidden">⇩</span><sub>b</sub></span><span class="main">)</span> <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="skolem">n<span class="hidden">⇩</span><sub>c</sub></span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">n<span class="hidden">⇩</span><sub>c</sub></span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n<span class="hidden">⇩</span><sub>b</sub></span> <span class="main">≠</span> <span class="skolem">n<span class="hidden">⇩</span><sub>c</sub></span> <span class="main">-</span> <span class="main">1</span>›</span></span> fin_long_chain_def long_ch_Y nc_def<span class="main">(</span>3<span class="main">)</span> order_finite_chain
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main"><span class="free">[[</span></span><span class="free">a<span class="hidden">⇩</span><sub>0</sub></span> <span class="free">x</span> <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="skolem">n<span class="hidden">⇩</span><sub>c</sub></span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> nc_def<span class="main">(</span>1<span class="main">,</span>4<span class="main">)</span> diff_less less_numeral_extra<span class="main">(</span>1<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n<span class="hidden">⇩</span><sub>c</sub></span><span class="main">-</span><span class="main">1</span><span class="main">≠</span><span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n<span class="hidden">⇩</span><sub>b</sub></span> <span class="main">&lt;</span> <span class="skolem">n<span class="hidden">⇩</span><sub>c</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n<span class="hidden">⇩</span><sub>b</sub></span> <span class="main">≠</span> <span class="skolem">n<span class="hidden">⇩</span><sub>c</sub></span> <span class="main">-</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">(</span><span class="skolem">n<span class="hidden">⇩</span><sub>c</sub></span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">≠</span><span class="free">a<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">∧</span> <span class="free">a<span class="hidden">⇩</span><sub>0</sub></span><span class="main">≠</span><span class="free">x</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> bound_indices
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="skolem">n<span class="hidden">⇩</span><sub>b</sub></span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="skolem">n<span class="hidden">⇩</span><sub>c</sub></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">n<span class="hidden">⇩</span><sub>c</sub></span><span class="main">)</span><span class="main"><span class="free">]]</span></span>›</span></span> abc_abc_neq abd_bcd_abc b_def<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span> ch_all_betw_f
            long_ch_Y nb_def<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> nc_def<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">≠</span><span class="free">f</span><span class="main">(</span><span class="skolem">n<span class="hidden">⇩</span><sub>c</sub></span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> x_def<span class="main">(</span>1<span class="main">)</span> nc_def<span class="main">(</span>3<span class="main">)</span> long_ch_Y
        <span class="keyword1"><span class="command">unfolding</span></span> fin_long_chain_def long_ch_by_ord_def ordering_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_imp_diff_less<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="skolem">n<span class="hidden">⇩</span><sub>c</sub></span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span><span class="main"><span class="free">]]</span></span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> some_betw P_def<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> abc_abc_neq abc_acd_bcd abc_bcd_acd abc_sym b_def<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span>
              c_def<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> ch_all_betw_f in_mono long_ch_Y nc_def<span class="main">(</span>2<span class="main">)</span> betw_b_in_path
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="skolem">n<span class="hidden">⇩</span><sub>b</sub></span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="skolem">n<span class="hidden">⇩</span><sub>c</sub></span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">n<span class="hidden">⇩</span><sub>c</sub></span><span class="main">)</span><span class="main"><span class="free">]]</span></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main"><span class="free">[[</span></span><span class="free">a<span class="hidden">⇩</span><sub>0</sub></span> <span class="free">x</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="skolem">n<span class="hidden">⇩</span><sub>c</sub></span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">∈</span> <span class="skolem">P</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span><span class="main">(</span><span class="skolem">n<span class="hidden">⇩</span><sub>c</sub></span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">≠</span><span class="free">a<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">∧</span> <span class="free">a<span class="hidden">⇩</span><sub>0</sub></span><span class="main">≠</span><span class="free">x</span>›</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="skolem">n<span class="hidden">⇩</span><sub>c</sub></span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span> <span class="free">a<span class="hidden">⇩</span><sub>n</sub></span><span class="main"><span class="free">]]</span></span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> abc_acd_bcd x_def<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> nb_def<span class="main">(</span>1<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n<span class="hidden">⇩</span><sub>b</sub></span> <span class="main">&lt;</span> <span class="skolem">n<span class="hidden">⇩</span><sub>c</sub></span> <span class="main">-</span> <span class="main">1</span>›</span></span> less_imp_diff_less nc_def<span class="main">(</span>3<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> b_goal<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">=</span><span class="free">f</span> <span class="skolem">n<span class="hidden">⇩</span><sub>b</sub></span> <span class="main">∧</span> <span class="skolem">b</span><span class="main">∈</span><span class="free">Y</span> <span class="main">∧</span> <span class="skolem">n<span class="hidden">⇩</span><sub>b</sub></span><span class="main">=</span><span class="skolem">n<span class="hidden">⇩</span><sub>c</sub></span><span class="main">-</span><span class="main">1</span> <span class="main">∧</span> <span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">k</span></span> <span class="main">&lt;</span> card <span class="free">Y</span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="bound">k</span><span class="main">)</span> <span class="free">x</span> <span class="free">a<span class="hidden">⇩</span><sub>n</sub></span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="bound">k</span><span class="main">&gt;</span><span class="skolem">n<span class="hidden">⇩</span><sub>b</sub></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> b_def nb_def<span class="main">(</span>1<span class="main">)</span> nb_def<span class="main">(</span>3<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">n<span class="hidden">⇩</span><sub>b</sub></span><span class="main">=</span><span class="skolem">n<span class="hidden">⇩</span><sub>c</sub></span><span class="main">-</span><span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="skolem">b</span> <span class="free">x</span> <span class="skolem">c</span><span class="main"><span class="free">]]</span></span>›</span></span> c_goal
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n<span class="hidden">⇩</span><sub>b</sub></span> <span class="main">&lt;</span> card <span class="free">Y</span>›</span></span> nc_def<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This is case (ii) of the induction in Theorem 10.›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="comment1">(*for 10*)</span> chain_append_inside<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> long_ch_Y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">f</span><span class="main">[</span><span class="free">a<span class="hidden">⇩</span><sub>1</sub></span><span class="main">..</span><span class="free">a</span><span class="main">..</span><span class="free">a<span class="hidden">⇩</span><sub>n</sub></span><span class="main">]</span><span class="free">Y</span><span class="main">]</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> Y_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">∉</span><span class="free">Y</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> Yb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">b</span> <span class="free">a<span class="hidden">⇩</span><sub>n</sub></span><span class="main"><span class="free">]]</span></span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> k_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">b</span> <span class="main">(</span><span class="free">f</span> <span class="free">k</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&lt;</span> card <span class="free">Y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">k'</span><span class="main">.</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>nat<span class="main">)</span><span class="main">&lt;</span><span class="bound">k'</span> <span class="main">∧</span> <span class="bound">k'</span><span class="main">&lt;</span><span class="free">k</span> <span class="main">∧</span> <span class="main"><span class="free">[[</span></span><span class="free">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">b</span> <span class="main">(</span><span class="free">f</span> <span class="bound">k'</span><span class="main">)</span><span class="main"><span class="free">]]</span></span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">g</span>
  <span class="keyword2"><span class="keyword">defines</span></span> g_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">::</span>nat<span class="main">.</span> <span class="keyword1">if</span> <span class="main">(</span><span class="bound">j</span><span class="main">≤</span><span class="free">k</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="keyword1">then</span> <span class="free">f</span> <span class="bound">j</span> <span class="keyword1">else</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="bound">j</span><span class="main">=</span><span class="free">k</span><span class="main">)</span> <span class="keyword1">then</span> <span class="free">b</span> <span class="keyword1">else</span> <span class="free">f</span> <span class="main">(</span><span class="bound">j</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">g</span><span class="main">[</span><span class="free">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">..</span> <span class="free">b</span> <span class="main">..</span> <span class="free">a<span class="hidden">⇩</span><sub>n</sub></span><span class="main">]</span>insert <span class="free">b</span> <span class="free">Y</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?X</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"insert <span class="free">b</span> <span class="free">Y</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> fin_X<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="var">?X</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> fin_long_chain_def finite.insertI long_ch_Y<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> bound_indices<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">0</span> <span class="main">=</span> <span class="free">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∧</span> <span class="free">f</span> <span class="main">(</span>card <span class="free">Y</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="free">a<span class="hidden">⇩</span><sub>n</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> fin_long_chain_def long_ch_Y
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> fin_Y<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">Y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> fin_long_chain_def long_ch_Y <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> f_def<span class="main">:</span> <span class="quoted"><span class="quoted">"long_ch_by_ord <span class="free">f</span> <span class="free">Y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> fin_long_chain_def long_ch_Y <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">‹<span class="free">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="free">a<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">∧</span> <span class="free">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="free">b</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">≠</span> <span class="free">a<span class="hidden">⇩</span><sub>n</sub></span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> Yb abc_abc_neq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> abc_abc_neq bound_indices k_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

  <span class="keyword1"><span class="command">have</span></span> b_middle<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="free">b</span> <span class="main">(</span><span class="free">f</span> <span class="free">k</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span><span class="main">=</span><span class="main">1</span>"</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="free">b</span> <span class="main">(</span><span class="free">f</span> <span class="free">k</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="free">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">b</span> <span class="main">(</span><span class="free">f</span> <span class="free">k</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">k</span> <span class="main">=</span> <span class="main">1</span>›</span></span> bound_indices <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span><span class="main">≠</span><span class="main">1</span>"</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="free">b</span> <span class="main">(</span><span class="free">f</span> <span class="free">k</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="free">k</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bound_indices
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">k</span> <span class="main">&lt;</span> card <span class="free">Y</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">k</span> <span class="main">≠</span> <span class="main">1</span>›</span></span> long_ch_Y fin_Y order_finite_chain
        <span class="keyword1"><span class="command">unfolding</span></span> fin_long_chain_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹In fact, the comprehension below gives the order of elements too.
         Our notation and Theorem 9 are too weak to say that just now.›</span></span>
      <span class="keyword1"><span class="command">have</span></span> ch_with_b<span class="main">:</span> <span class="quoted"><span class="quoted">"ch <span class="main">{</span><span class="free">a<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="free">b</span><span class="main">,</span> <span class="main">(</span><span class="free">f</span> <span class="free">k</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> chain4
        <span class="keyword1"><span class="command">using</span></span> k_def<span class="main">(</span>1<span class="main">)</span> abc_ex_path_unique between_chain cross_once_notin
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="free">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="free">k</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>›</span></span> abc_abc_neq insert_absorb2<span class="main">)</span>
<span class="comment1">(*TODO: the proof below needs extra assumptions, but we should still try to get rid of smt above. *)</span>
      <span class="comment1">(* proof -
        have "a<span class="hidden">⇩</span><sub>1</sub>∈Q ∧ a<span class="hidden">⇩</span><sub>n</sub>∈Q ∧ b∈Q"
          using Y_def long_ch_Y events_X points_in_chain by auto
        have f1: "a<span class="hidden">⇩</span><sub>1</sub> ≠ b ∧ a<span class="hidden">⇩</span><sub>1</sub> ≠ f k ∧ b ≠ f k"
          using abc_abc_neq k_def(1) by presburger
        then have f2: "f k ∈ Q"
          using betw_c_in_path k_def(1) path_Q
            ‹a<span class="hidden">⇩</span><sub>1</sub> ∈ Q ∧ a<span class="hidden">⇩</span><sub>n</sub> ∈ Q ∧ b ∈ Q›
          by blast
        then have "f (k - 1) ∈ Q"
          using betw_b_in_path path_Q
            f1 ‹[[a<span class="hidden">⇩</span><sub>1</sub> f (k - 1) f k]]› ‹a<span class="hidden">⇩</span><sub>1</sub> ∈ Q ∧ a<span class="hidden">⇩</span><sub>n</sub> ∈ Q ∧ b ∈ Q›
          by presburger
        then show ?thesis
          using abc_abc_neq between_chain chain4 k_def(1) path_Q
          by (metis (no_types) f2 ‹[[a<span class="hidden">⇩</span><sub>1</sub> f (k - 1) f k]]› ‹a<span class="hidden">⇩</span><sub>1</sub> ∈ Q ∧ a<span class="hidden">⇩</span><sub>n</sub> ∈ Q ∧ b ∈ Q›
              insertI1 insert_absorb)
      qed *)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">≠</span> <span class="free">b</span> <span class="main">∧</span> <span class="main">(</span><span class="free">f</span> <span class="free">k</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">≠</span> <span class="main">(</span><span class="free">f</span> <span class="free">k</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> abc_abc_neq f_def k_def<span class="main">(</span>2<span class="main">)</span> Y_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ordering_def <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="free">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="free">k</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>›</span></span> less_imp_diff_less long_ch_by_ord_def<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> some_ord_bk<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="free">b</span> <span class="main">(</span><span class="free">f</span> <span class="free">k</span><span class="main">)</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">b</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="free">k</span><span class="main">)</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="free">k</span><span class="main">)</span> <span class="free">b</span><span class="main"><span class="free">]]</span></span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> chain_on_path ch_with_b some_betw Y_def <span class="keyword1"><span class="command">unfolding</span></span> ch_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> abc_sym insert_subset<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="free">b</span> <span class="main">(</span><span class="free">f</span> <span class="free">k</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main"><span class="free">[[</span></span><span class="free">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span><span class="free">f</span> <span class="free">k</span><span class="main">)</span> <span class="free">b</span><span class="main"><span class="free">]]</span></span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="free">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">b</span> <span class="main">(</span><span class="free">f</span> <span class="free">k</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>›</span></span> abc_only_cba<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> some_ord_bk k_def abc_bcd_acd abd_bcd_abc bound_indices
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> diff_is_0_eq' diff_less less_imp_diff_less less_irrefl_nat not_less
              zero_less_diff zero_less_one <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="free">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">b</span> <span class="main">(</span><span class="free">f</span> <span class="free">k</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="free">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="free">k</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>›</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="comment1">(* not xor but it works anyway *)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="quoted"><span class="quoted">"<span class="var">?case1</span> <span class="main">∨</span> <span class="var">?case2</span>"</span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">k</span><span class="main">-</span><span class="numeral">2</span> <span class="main">≥</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">k</span><span class="main">+</span><span class="main">1</span> <span class="main">≤</span> card <span class="free">Y</span> <span class="main">-</span><span class="main">1</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> b_right<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="free">b</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≥</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span><span class="main">-</span><span class="main">1</span> <span class="main">&lt;</span> <span class="main">(</span><span class="free">k</span><span class="main">::</span>nat<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> diff_less zero_less_one <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span><span class="main">-</span><span class="numeral">2</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">-</span><span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="numeral">2</span> <span class="main">≤</span> <span class="free">k</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="free">k</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f_def k_def<span class="main">(</span>2<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="free">k</span><span class="main">-</span><span class="numeral">2</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">-</span><span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">k</span><span class="main">-</span><span class="main">1</span> <span class="main">&lt;</span> <span class="free">k</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> long_ch_by_ord_def ordering_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="free">b</span><span class="main"><span class="free">]]</span></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="free">b</span> <span class="main">(</span><span class="free">f</span> <span class="free">k</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>›</span></span> abd_bcd_abc
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> b_left<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">b</span> <span class="main">(</span><span class="free">f</span> <span class="free">k</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="free">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span><span class="main">+</span><span class="main">1</span> <span class="main">≤</span> card <span class="free">Y</span> <span class="main">-</span><span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="free">k</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="free">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> f_def fin_Y order_finite_chain that
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">b</span> <span class="main">(</span><span class="free">f</span> <span class="free">k</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="free">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="free">b</span> <span class="main">(</span><span class="free">f</span> <span class="free">k</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>›</span></span> abc_acd_bcd
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ordering2 <span class="free">g</span> <span class="free">betw</span> <span class="var">?X</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span>finite <span class="var">?X</span> <span class="main">⟶</span> <span class="bound">n</span> <span class="main">&lt;</span> card <span class="var">?X</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">g</span> <span class="bound">n</span> <span class="main">∈</span> <span class="var">?X</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?X</span> <span class="main">⟶</span> <span class="skolem">n</span> <span class="main">&lt;</span> card <span class="var">?X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="skolem">n</span> <span class="main">∉</span> <span class="free">Y</span>"</span></span>
      <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">≤</span><span class="free">k</span><span class="main">-</span><span class="main">1</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">≥</span><span class="free">k</span><span class="main">+</span><span class="main">1</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">=</span><span class="free">k</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="skolem">n</span> <span class="main">=</span> <span class="free">b</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≤</span> <span class="free">k</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="skolem">n</span> <span class="main">=</span> <span class="free">b</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span>  f_def k_def<span class="main">(</span>2<span class="main">)</span> Y_def<span class="main">(</span>1<span class="main">)</span> long_ch_by_ord_def ordering_def g_def
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="free">g</span> <span class="skolem">n</span> <span class="main">∉</span> <span class="free">Y</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> diff_less le_less less_one less_trans not_le<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="skolem">n</span> <span class="main">=</span> <span class="free">b</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="comment1">(* assume asm: "Suc k ≤ n" "?X = insert b Y" "b ∉ Y" "g n ∉ Y" *)</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">n</span> <span class="main">∈</span> <span class="free">Y</span> <span class="main">∨</span> <span class="main">¬</span><span class="main">(</span><span class="skolem">n</span> <span class="main">&lt;</span> card <span class="free">Y</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ordering_def f_def long_ch_by_ord_def<span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="skolem">n</span> <span class="main">=</span> <span class="free">b</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="var">?X</span> <span class="main">⟶</span> <span class="skolem">n</span> <span class="main">&lt;</span> card <span class="var">?X</span>›</span></span> fin_Y g_def Y_def <span class="quoted"><span class="quoted">‹<span class="free">g</span> <span class="skolem">n</span> <span class="main">∉</span> <span class="free">Y</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">k</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> <span class="skolem">n</span>›</span></span>
              not_less not_less_simps<span class="main">(</span>1<span class="main">)</span> not_one_le_zero
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">=</span><span class="free">k</span>"</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="skolem">n</span> <span class="main">=</span> <span class="free">b</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> Y_def <span class="quoted"><span class="quoted">‹<span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> g_def
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="var">?X</span><span class="main">.</span> <span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span>finite <span class="var">?X</span> <span class="main">⟶</span> <span class="bound">n</span> <span class="main">&lt;</span> card <span class="var">?X</span><span class="main">)</span> <span class="main">∧</span> <span class="free">g</span> <span class="bound">n</span> <span class="main">=</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="var">?X</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span>finite <span class="var">?X</span> <span class="main">⟶</span> <span class="bound">n</span> <span class="main">&lt;</span> card <span class="var">?X</span><span class="main">)</span> <span class="main">∧</span> <span class="free">g</span> <span class="bound">n</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="free">Y</span>"</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ix</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">ix</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ix</span> <span class="main">&lt;</span> card <span class="free">Y</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span>  <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">Y</span>›</span></span> f_def fin_Y
            <span class="keyword1"><span class="command">unfolding</span></span> long_ch_by_ord_def ordering_def
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ix</span><span class="main">≤</span><span class="free">k</span><span class="main">-</span><span class="main">1</span> <span class="main">∨</span> <span class="skolem">ix</span><span class="main">≥</span><span class="free">k</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">proof</span></span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ix</span><span class="main">≤</span><span class="free">k</span><span class="main">-</span><span class="main">1</span>"</span></span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="skolem">ix</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="skolem">ix</span> <span class="main">=</span> <span class="skolem">x</span>›</span></span> g_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?X</span> <span class="main">⟶</span> <span class="skolem">ix</span> <span class="main">&lt;</span> card <span class="var">?X</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> Y_def <span class="quoted"><span class="quoted">‹<span class="skolem">ix</span> <span class="main">&lt;</span> card <span class="free">Y</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
          <span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ix</span><span class="main">≥</span><span class="free">k</span>"</span></span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">(</span><span class="skolem">ix</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="skolem">ix</span> <span class="main">=</span> <span class="skolem">x</span>›</span></span> g_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?X</span> <span class="main">⟶</span> <span class="skolem">ix</span><span class="main">+</span><span class="main">1</span> <span class="main">&lt;</span> card <span class="var">?X</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> Y_def <span class="quoted"><span class="quoted">‹<span class="skolem">ix</span> <span class="main">&lt;</span> card <span class="free">Y</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∉</span><span class="free">Y</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="free">b</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> Y_def <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="var">?X</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> Y_def <span class="quoted"><span class="quoted">‹<span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> k_def<span class="main">(</span>2<span class="main">)</span> ordered_cancel_comm_monoid_diff_class.le_diff_conv2 g_def
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span> <span class="bound">n'</span> <span class="bound">n''</span><span class="main">.</span> <span class="main">(</span>finite <span class="var">?X</span> <span class="main">⟶</span> <span class="bound">n''</span> <span class="main">&lt;</span> card <span class="var">?X</span><span class="main">)</span> <span class="main">∧</span> Suc <span class="bound">n</span> <span class="main">=</span> <span class="bound">n'</span> <span class="main">∧</span> Suc <span class="bound">n'</span> <span class="main">=</span> <span class="bound">n''</span>
          <span class="main">⟶</span> <span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">g</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span><span class="free">g</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">g</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="skolem">n'</span> <span class="skolem">n''</span> <span class="keyword3"><span class="command">assume</span></span>  a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>finite <span class="var">?X</span> <span class="main">⟶</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> card <span class="var">?X</span><span class="main">)</span>"</span></span>
      
      <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Introduce the two-case splits used later.›</span></span>
      <span class="keyword1"><span class="command">have</span></span>  cases_sn<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">n</span><span class="main">≤</span><span class="free">k</span><span class="main">-</span><span class="main">1</span> <span class="main">∨</span> Suc <span class="skolem">n</span><span class="main">=</span><span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">≤</span><span class="free">k</span><span class="main">-</span><span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
      <span class="keyword1"><span class="command">have</span></span> cases_ssn<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc<span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">≤</span><span class="free">k</span><span class="main">-</span><span class="main">1</span> <span class="main">∨</span> Suc<span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">=</span><span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">≤</span><span class="free">k</span><span class="main">-</span><span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">n</span><span class="main">≤</span><span class="free">k</span><span class="main">-</span><span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> that<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>

      <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">≤</span><span class="free">k</span><span class="main">-</span><span class="main">1</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">≥</span><span class="free">k</span><span class="main">+</span><span class="main">1</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">=</span><span class="free">k</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">g</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="free">g</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">g</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">≤</span><span class="free">k</span><span class="main">-</span><span class="main">1</span>"</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> cases_sn
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> disjE<span class="main">)</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">n</span> <span class="main">≤</span> <span class="free">k</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> cases_ssn
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> disjE<span class="main">)</span>
            <span class="keyword3"><span class="command">show</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≤</span> <span class="free">k</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">≤</span> <span class="free">k</span> <span class="main">-</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">‹Suc <span class="skolem">n</span> <span class="main">≤</span> <span class="free">k</span> <span class="main">-</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Suc <span class="skolem">n</span> <span class="main">≤</span> <span class="free">k</span> <span class="main">-</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">≤</span> <span class="free">k</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">using</span></span>  <span class="quoted"><span class="quoted">‹Suc <span class="skolem">n</span> <span class="main">≤</span> <span class="free">k</span> <span class="main">-</span> <span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">≤</span> <span class="free">k</span> <span class="main">-</span> <span class="main">1</span>›</span></span> ordering_ord_ijk f_def g_def k_def<span class="main">(</span>2<span class="main">)</span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> add_diff_inverse_nat lessI less_Suc_eq_le
                  less_imp_le_nat less_le_trans less_one long_ch_by_ord_def plus_1_eq_Suc<span class="main">)</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">k</span>"</span></span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">using</span></span> b_right g_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">n</span> <span class="main">=</span> <span class="free">k</span>"</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">using</span></span> b_middle <span class="quoted"><span class="quoted">‹Suc <span class="skolem">n</span> <span class="main">=</span> <span class="free">k</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">≤</span> <span class="free">k</span> <span class="main">-</span> <span class="main">1</span>›</span></span> g_def
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≤</span> <span class="free">k</span><span class="main">-</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">≤</span> <span class="free">k</span> <span class="main">-</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">≥</span><span class="free">k</span><span class="main">+</span><span class="main">1</span>"</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="skolem">n</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">k</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> <span class="skolem">n</span>›</span></span> less_imp_diff_less g_def
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">n</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">k</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> <span class="skolem">n</span>›</span></span> g_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">k</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> <span class="skolem">n</span>›</span></span> g_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">-</span><span class="main">1</span><span class="main">&lt;</span><span class="skolem">n</span> <span class="main">∧</span> <span class="skolem">n</span><span class="main">&lt;</span>Suc <span class="skolem">n</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">k</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> <span class="skolem">n</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">Y</span> <span class="main">⟶</span> Suc <span class="skolem">n</span> <span class="main">&lt;</span> card <span class="free">Y</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> Y_def a <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">using</span></span> f_def <span class="keyword1"><span class="command">unfolding</span></span> long_ch_by_ord_def ordering_def
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">=</span><span class="free">k</span>"</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">=</span> <span class="free">k</span>›</span></span> b_left g_def Y_def<span class="main">(</span>1<span class="main">)</span> a assms<span class="main">(</span>3<span class="main">)</span> fin_Y
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ordering2 <span class="free">g</span> <span class="free">betw</span> <span class="var">?X</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> ordering2_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"long_ch_by_ord2 <span class="free">g</span> <span class="var">?X</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Y_def f_def long_ch_by_ord2_def long_ch_by_ord_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">g</span><span class="main">[</span><span class="free">a<span class="hidden">⇩</span><sub>1</sub></span><span class="main">..</span><span class="free">b</span><span class="main">..</span><span class="free">a<span class="hidden">⇩</span><sub>n</sub></span><span class="main">]</span><span class="var">?X</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> fin_long_chain_def
      <span class="keyword1"><span class="command">using</span></span> ch_equiv fin_X <span class="quoted"><span class="quoted">‹<span class="free">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="free">a<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">∧</span> <span class="free">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="free">b</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">≠</span> <span class="free">a<span class="hidden">⇩</span><sub>n</sub></span>›</span></span> bound_indices k_def<span class="main">(</span>2<span class="main">)</span> Y_def g_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* jep *)</span>
<span class="keyword1" id="TemporalOrderOnPath-card4_eq"><span class="command">lemma</span></span> card4_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"card <span class="free">X</span> <span class="main">=</span> <span class="numeral">4</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">.</span> <span class="bound">a</span> <span class="main">≠</span> <span class="bound">b</span> <span class="main">∧</span> <span class="bound">a</span> <span class="main">≠</span> <span class="bound">c</span> <span class="main">∧</span> <span class="bound">a</span> <span class="main">≠</span> <span class="bound">d</span> <span class="main">∧</span> <span class="bound">b</span> <span class="main">≠</span> <span class="bound">c</span> <span class="main">∧</span> <span class="bound">b</span> <span class="main">≠</span> <span class="bound">d</span> <span class="main">∧</span> <span class="bound">c</span> <span class="main">≠</span> <span class="bound">d</span> <span class="main">∧</span> <span class="free">X</span> <span class="main">=</span> <span class="main">{</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">,</span> <span class="bound">c</span><span class="main">,</span> <span class="bound">d</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">X'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">=</span> insert <span class="skolem">a</span> <span class="skolem">X'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∉</span> <span class="skolem">X'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_eq_numeral assms card_Suc_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">X'</span> <span class="main">=</span> <span class="numeral">3</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_2_eq_Suc' assms card_eq_0_iff card_insert_if diff_Suc_1 finite_insert numeral_3_eq_3 numeral_Bit0 plus_nat.add_0 zero_neq_numeral<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="skolem"><span class="skolem">X''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X'</span> <span class="main">=</span> insert <span class="skolem">b</span> <span class="skolem">X''</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∉</span> <span class="skolem">X''</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> card_Suc_eq numeral_3_eq_3<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">X''</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_eq_numeral <span class="quoted"><span class="quoted">‹card <span class="skolem">X'</span> <span class="main">=</span> <span class="numeral">3</span>›</span></span> card.infinite card_insert_if finite_insert pred_numeral_simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> zero_neq_numeral<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">c</span> <span class="bound">d</span><span class="main">.</span> <span class="bound">c</span> <span class="main">≠</span> <span class="bound">d</span> <span class="main">∧</span> <span class="skolem">X''</span> <span class="main">=</span> <span class="main">{</span><span class="bound">c</span><span class="main">,</span> <span class="bound">d</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> card_2_iff<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">X</span> <span class="main">=</span> insert <span class="skolem">a</span> <span class="skolem">X'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">X'</span> <span class="main">=</span> insert <span class="skolem">b</span> <span class="skolem">X''</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∉</span> <span class="skolem">X'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">∉</span> <span class="skolem">X''</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* jep *)</span>
<span class="keyword1"><span class="command">theorem</span></span> <span class="comment1">(*10*)</span> path_finsubset_chain<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">∈</span> <span class="free">𝒫</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> <span class="free">Q</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"card <span class="free">X</span> <span class="main">≥</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ch <span class="free">X</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> not_numeral_le_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"card <span class="free">X</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"card <span class="free">X</span> <span class="main">=</span> <span class="numeral">3</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"card <span class="free">X</span> <span class="main">≥</span> <span class="numeral">4</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹card <span class="free">X</span> <span class="main">≥</span> <span class="numeral">2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"card <span class="free">X</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">X</span>›</span></span> assms two_event_chain <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"card <span class="free">X</span> <span class="main">=</span> <span class="numeral">3</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">X</span>›</span></span> assms three_event_chain <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"card <span class="free">X</span> <span class="main">≥</span> <span class="numeral">4</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="quoted"><span class="quoted">‹finite <span class="free">X</span>›</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"card <span class="free">X</span> <span class="main">-</span> <span class="numeral">4</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">X</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> 0
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">X</span> <span class="main">=</span> <span class="numeral">4</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">.</span> <span class="bound">a</span> <span class="main">≠</span> <span class="bound">b</span> <span class="main">∧</span> <span class="bound">a</span> <span class="main">≠</span> <span class="bound">c</span> <span class="main">∧</span> <span class="bound">a</span> <span class="main">≠</span> <span class="bound">d</span> <span class="main">∧</span> <span class="bound">b</span> <span class="main">≠</span> <span class="bound">c</span> <span class="main">∧</span> <span class="bound">b</span> <span class="main">≠</span> <span class="bound">d</span> <span class="main">∧</span> <span class="bound">c</span> <span class="main">≠</span> <span class="bound">d</span> <span class="main">∧</span> <span class="skolem">X</span> <span class="main">=</span> <span class="main">{</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">,</span> <span class="bound">c</span><span class="main">,</span> <span class="bound">d</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> card4_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"0.prems"</span><span class="main">(</span>3<span class="main">)</span> assms<span class="main">(</span>1<span class="main">)</span> chain4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> IH<span class="main">:</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>

      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Y</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> X_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">=</span> insert <span class="skolem">b</span> <span class="skolem">Y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∉</span> <span class="skolem">Y</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Diff_iff card_eq_0_iff finite.cases insertI1 insert_Diff_single not_numeral_le_zero<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">Y</span> <span class="main">≥</span> <span class="numeral">4</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> card <span class="skolem">Y</span> <span class="main">-</span> <span class="numeral">4</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> IH.hyps<span class="main">(</span>2<span class="main">)</span> IH.prems<span class="main">(</span>4<span class="main">)</span> X_eq <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">∉</span> <span class="skolem">Y</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ch <span class="skolem">Y</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> IH<span class="main">(</span>1<span class="main">)</span> <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">Y</span></span><span class="main">]</span> IH.prems<span class="main">(</span>3<span class="main">,</span>4<span class="main">)</span> X_eq assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> f_ords<span class="main">:</span> <span class="quoted"><span class="quoted">"long_ch_by_ord <span class="skolem">f</span> <span class="skolem">Y</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> ch_long_if_card_ge3 <span class="quoted"><span class="quoted">‹<span class="numeral">4</span> <span class="main">≤</span> card <span class="skolem">Y</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a<span class="hidden">⇩</span><sub>1</sub></span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">a<span class="hidden">⇩</span><sub>n</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> long_ch_Y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">f</span><span class="main">[</span><span class="skolem">a<span class="hidden">⇩</span><sub>1</sub></span><span class="main">..</span><span class="skolem">a</span><span class="main">..</span><span class="skolem">a<span class="hidden">⇩</span><sub>n</sub></span><span class="main">]</span><span class="skolem">Y</span><span class="main">]</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="numeral">4</span> <span class="main">≤</span> card <span class="skolem">Y</span>›</span></span> get_fin_long_ch_bounds <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">hence</span></span> bound_indices<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">0</span> <span class="main">=</span> <span class="skolem">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∧</span> <span class="skolem">f</span> <span class="main">(</span>card <span class="skolem">Y</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">a<span class="hidden">⇩</span><sub>n</sub></span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fin_long_chain_def<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="skolem">a<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">∧</span> <span class="skolem">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="skolem">b</span> <span class="main">∧</span> <span class="skolem">b</span> <span class="main">≠</span> <span class="skolem">a<span class="hidden">⇩</span><sub>n</sub></span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">∉</span> <span class="skolem">Y</span>›</span></span> abc_abc_neq fin_ch_betw long_ch_Y points_in_chain <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> <span class="free">Q</span> <span class="main">∧</span> <span class="skolem">a<span class="hidden">⇩</span><sub>n</sub></span> <span class="main">∈</span> <span class="free">Q</span> <span class="main">∧</span> <span class="skolem">b</span> <span class="main">∈</span> <span class="free">Q</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> IH.prems<span class="main">(</span>3<span class="main">)</span> X_eq long_ch_Y points_in_chain <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="skolem">b</span> <span class="skolem">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">a<span class="hidden">⇩</span><sub>n</sub></span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="skolem">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">a<span class="hidden">⇩</span><sub>n</sub></span> <span class="skolem">b</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="skolem">a<span class="hidden">⇩</span><sub>n</sub></span> <span class="skolem">b</span> <span class="skolem">a<span class="hidden">⇩</span><sub>1</sub></span><span class="main"><span class="free">]]</span></span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> some_betw <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">Q</span></span> <span class="quoted"><span class="skolem">b</span></span> <span class="quoted"><span class="skolem">a<span class="hidden">⇩</span><sub>1</sub></span></span> <span class="quoted"><span class="skolem">a<span class="hidden">⇩</span><sub>n</sub></span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="free">Q</span> <span class="main">∈</span> <span class="free">𝒫</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"ch <span class="skolem">X</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
        <span class="comment1">(* case (i) *)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="skolem">b</span> <span class="skolem">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">a<span class="hidden">⇩</span><sub>n</sub></span><span class="main"><span class="free">]]</span></span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> X_eq'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">=</span> <span class="skolem">Y</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">b</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> X_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?g</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">j</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">j</span> <span class="main">≥</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="skolem">f</span> <span class="main">(</span><span class="bound">j</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">else</span> <span class="skolem">b</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="var">?g</span><span class="main">[</span><span class="skolem">b</span><span class="main">..</span><span class="skolem">a<span class="hidden">⇩</span><sub>1</sub></span><span class="main">..</span><span class="skolem">a<span class="hidden">⇩</span><sub>n</sub></span><span class="main">]</span><span class="skolem">X</span><span class="main">]</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> chain_append_at_left_edge IH.prems<span class="main">(</span>4<span class="main">)</span> X_eq' <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="skolem">b</span> <span class="skolem">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">a<span class="hidden">⇩</span><sub>n</sub></span><span class="main"><span class="free">]]</span></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">∉</span> <span class="skolem">Y</span>›</span></span> long_ch_Y X_eq
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"ch <span class="skolem">X</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> ch_by_ord_def ch_def fin_long_chain_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="comment1">(* case (ii) *)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="skolem">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">a<span class="hidden">⇩</span><sub>n</sub></span> <span class="skolem">b</span><span class="main"><span class="free">]]</span></span>"</span></span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?g</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">j</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">j</span> <span class="main">≤</span> <span class="main">(</span>card <span class="skolem">X</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="keyword1">then</span> <span class="skolem">f</span> <span class="bound">j</span> <span class="keyword1">else</span> <span class="skolem">b</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="var">?g</span><span class="main">[</span><span class="skolem">a<span class="hidden">⇩</span><sub>1</sub></span><span class="main">..</span><span class="skolem">a<span class="hidden">⇩</span><sub>n</sub></span><span class="main">..</span><span class="skolem">b</span><span class="main">]</span><span class="skolem">X</span><span class="main">]</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> chain_append_at_right_edge IH.prems<span class="main">(</span>4<span class="main">)</span> X_eq <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="skolem">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">a<span class="hidden">⇩</span><sub>n</sub></span> <span class="skolem">b</span><span class="main"><span class="free">]]</span></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">∉</span> <span class="skolem">Y</span>›</span></span> long_ch_Y
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"ch <span class="skolem">X</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> ch_def ch_by_ord_def <span class="keyword1"><span class="command">using</span></span> fin_long_chain_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="comment1">(* case (iii) *)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="skolem">a<span class="hidden">⇩</span><sub>n</sub></span> <span class="skolem">b</span> <span class="skolem">a<span class="hidden">⇩</span><sub>1</sub></span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="comment1">(* jep: I have it this way so it matches some_betw, then switching it so it matches your old proof -- messy but easy to rectify, I'm just too tired to think too hard! *)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="skolem">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">b</span> <span class="skolem">a<span class="hidden">⇩</span><sub>n</sub></span><span class="main"><span class="free">]]</span></span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abc_sym<span class="main">)</span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span>
            k_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="skolem">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">b</span> <span class="main">(</span><span class="skolem">f</span> <span class="skolem">k</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&lt;</span> card <span class="skolem">Y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">k'</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">k'</span> <span class="main">∧</span> <span class="bound">k'</span> <span class="main">&lt;</span> <span class="skolem">k</span> <span class="main">∧</span> <span class="main"><span class="free">[[</span></span><span class="skolem">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">b</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">k'</span><span class="main">)</span><span class="main"><span class="free">]]</span></span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="skolem">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">b</span> <span class="skolem">a<span class="hidden">⇩</span><sub>n</sub></span><span class="main"><span class="free">]]</span></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">∉</span> <span class="skolem">Y</span>›</span></span> long_ch_Y smallest_k_ex <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">::</span>nat<span class="main">.</span> <span class="keyword1">if</span> <span class="bound">j</span> <span class="main">≤</span> <span class="skolem">k</span> <span class="main">-</span> <span class="main">1</span>
                                        <span class="keyword1">then</span> <span class="skolem">f</span> <span class="bound">j</span>
                                        <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">j</span> <span class="main">=</span> <span class="skolem">k</span>
                                          <span class="keyword1">then</span> <span class="skolem">b</span> <span class="keyword1">else</span> <span class="skolem">f</span> <span class="main">(</span><span class="bound">j</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">g</span><span class="main">[</span><span class="skolem">a<span class="hidden">⇩</span><sub>1</sub></span><span class="main">..</span><span class="skolem">b</span><span class="main">..</span><span class="skolem">a<span class="hidden">⇩</span><sub>n</sub></span><span class="main">]</span><span class="skolem">X</span><span class="main">]</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> chain_append_inside <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">f</span></span> <span class="quoted"><span class="skolem">a<span class="hidden">⇩</span><sub>1</sub></span></span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="skolem">a<span class="hidden">⇩</span><sub>n</sub></span></span> <span class="quoted"><span class="skolem">Y</span></span> <span class="quoted"><span class="skolem">b</span></span> <span class="quoted"><span class="skolem">k</span></span><span class="main">]</span> IH.prems<span class="main">(</span>4<span class="main">)</span> X_eq
            <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="skolem">a<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">b</span> <span class="skolem">a<span class="hidden">⇩</span><sub>n</sub></span><span class="main"><span class="free">]]</span></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">∉</span> <span class="skolem">Y</span>›</span></span> k_def long_ch_Y
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"ch <span class="skolem">X</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> ch_by_ord_def ch_def fin_long_chain_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="TemporalOrderOnPath-path_finsubset_chain2"><span class="command">lemma</span></span> path_finsubset_chain2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">∈</span> <span class="free">𝒫</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> <span class="free">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"card <span class="free">X</span> <span class="main">≥</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">f</span> <span class="free">a</span> <span class="free">b</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">f</span><span class="main">[</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">]</span><span class="free">X</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> finX<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> card.infinite rel_simps<span class="main"><span class="main">(</span></span>28<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> ch_X<span class="main">:</span> <span class="quoted"><span class="quoted">"ch <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> path_finsubset_chain<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> f_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">f</span><span class="main">[</span><span class="skolem">a</span><span class="main">..</span><span class="skolem">b</span><span class="main">]</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">∈</span><span class="free">X</span> <span class="main">∧</span> <span class="skolem">b</span><span class="main">∈</span><span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms finX ch_X ch_some_betw get_fin_long_ch_bounds ch_long_if_card_ge3
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ch_by_ord_def ch_def fin_chain_def short_ch_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Theorem 11›</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Notice this case is so simple, it doesn't even require the path density larger sets of segments
  rely on for fixing their cardinality.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="comment1">(*for 11*)</span> segmentation_ex_N2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> path_P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span><span class="main">∈</span><span class="free">𝒫</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> Q_def<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="free">Q</span><span class="main">::</span><span class="tfree">'a</span> set<span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"card <span class="free">Q</span> <span class="main">=</span> <span class="free">N</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span><span class="main">⊆</span><span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">N</span><span class="main">=</span><span class="numeral">2</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> f_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">f</span><span class="main">[</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">]</span><span class="free">Q</span><span class="main">]</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> S_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">=</span> <span class="main">{</span>segment <span class="free">a</span> <span class="free">b</span><span class="main">}</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> P1_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P1</span> <span class="main">=</span> prolongation <span class="free">b</span> <span class="free">a</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> P2_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P2</span> <span class="main">=</span> prolongation <span class="free">a</span> <span class="free">b</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">⋃</span><span class="free">S</span><span class="main">)</span> <span class="main">∪</span> <span class="free">P1</span> <span class="main">∪</span> <span class="free">P2</span> <span class="main">∪</span> <span class="free">Q</span><span class="main">)</span> <span class="main">∧</span>
           card <span class="free">S</span> <span class="main">=</span> <span class="main">(</span><span class="free">N</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> is_segment <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span>
           <span class="free">P1</span><span class="main">∩</span><span class="free">P2</span><span class="main">=</span><span class="main">{}</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">∩</span><span class="free">P1</span><span class="main">=</span><span class="main">{}</span> <span class="main">∧</span> <span class="bound">x</span><span class="main">∩</span><span class="free">P2</span><span class="main">=</span><span class="main">{}</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> <span class="bound">x</span><span class="main">≠</span><span class="bound">y</span> <span class="main">⟶</span> <span class="bound">x</span><span class="main">∩</span><span class="bound">y</span><span class="main">=</span><span class="main">{}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">∈</span><span class="free">Q</span> <span class="main">∧</span> <span class="free">b</span><span class="main">∈</span><span class="free">Q</span> <span class="main">∧</span> <span class="free">a</span><span class="main">≠</span><span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> f_def fin_chain_def fin_long_chain_def points_in_chain<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span><span class="main">=</span><span class="main">{</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">,</span>5<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> card_2_iff insert_absorb insert_commute insert_iff singleton_insert_inj_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">∈</span><span class="free">P</span> <span class="main">∧</span> <span class="free">b</span><span class="main">∈</span><span class="free">P</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Q</span><span class="main">=</span><span class="main">{</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">}</span>›</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">≠</span><span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Q</span><span class="main">=</span><span class="main">{</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">}</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">N</span> <span class="main">=</span> <span class="numeral">2</span>›</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> s_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> segment <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">s</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">⋃</span><span class="main">{</span><span class="skolem">s</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="free">P1</span> <span class="main">∪</span> <span class="free">P2</span> <span class="main">∪</span> <span class="free">Q</span><span class="main">)</span> <span class="main">∧</span>
          card <span class="main">{</span><span class="skolem">s</span><span class="main">}</span> <span class="main">=</span> <span class="main">(</span><span class="free">N</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="skolem">s</span><span class="main">}</span><span class="main">.</span> is_segment <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span>
          <span class="free">P1</span><span class="main">∩</span><span class="free">P2</span><span class="main">=</span><span class="main">{}</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="skolem">s</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">∩</span><span class="free">P1</span><span class="main">=</span><span class="main">{}</span> <span class="main">∧</span> <span class="bound">x</span><span class="main">∩</span><span class="free">P2</span><span class="main">=</span><span class="main">{}</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="main">{</span><span class="skolem">s</span><span class="main">}</span><span class="main">.</span> <span class="bound">x</span><span class="main">≠</span><span class="bound">y</span> <span class="main">⟶</span> <span class="bound">x</span><span class="main">∩</span><span class="bound">y</span><span class="main">=</span><span class="main">{}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="free">P</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="skolem">x</span> <span class="free">b</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">b</span> <span class="free">a</span> <span class="skolem">x</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="skolem">x</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="skolem">x</span><span class="main">=</span><span class="free">a</span> <span class="main">∨</span> <span class="skolem">x</span><span class="main">=</span><span class="free">b</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span><span class="main">∈</span><span class="free">P</span> <span class="main">∧</span> <span class="free">b</span><span class="main">∈</span><span class="free">P</span>›</span></span> some_betw path_P <span class="quoted"><span class="quoted">‹<span class="free">a</span><span class="main">≠</span><span class="free">b</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">P</span>›</span></span> abc_sym<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="skolem">s</span> <span class="main">∨</span> <span class="skolem">x</span><span class="main">∈</span><span class="free">P1</span> <span class="main">∨</span> <span class="skolem">x</span><span class="main">∈</span><span class="free">P2</span> <span class="main">∨</span> <span class="skolem">x</span><span class="main">=</span><span class="free">a</span> <span class="main">∨</span> <span class="skolem">x</span><span class="main">=</span><span class="free">b</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> pro_betw seg_betw P1_def P2_def s_def <span class="quoted"><span class="quoted">‹<span class="free">Q</span> <span class="main">=</span> <span class="main">{</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">}</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⋃</span><span class="main">{</span><span class="skolem">s</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="free">P1</span> <span class="main">∪</span> <span class="free">P2</span> <span class="main">∪</span> <span class="free">Q</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Q</span> <span class="main">=</span> <span class="main">{</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⋃</span><span class="main">{</span><span class="skolem">s</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="free">P1</span> <span class="main">∪</span> <span class="free">P2</span> <span class="main">∪</span> <span class="free">Q</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="skolem">s</span> <span class="main">∨</span> <span class="skolem">x</span><span class="main">∈</span><span class="free">P1</span> <span class="main">∨</span> <span class="skolem">x</span><span class="main">∈</span><span class="free">P2</span> <span class="main">∨</span> <span class="skolem">x</span><span class="main">=</span><span class="free">a</span> <span class="main">∨</span> <span class="skolem">x</span><span class="main">=</span><span class="free">b</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Q</span> <span class="main">=</span> <span class="main">{</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="skolem">x</span> <span class="free">b</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">b</span> <span class="free">a</span> <span class="skolem">x</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="skolem">x</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="skolem">x</span><span class="main">=</span><span class="free">a</span> <span class="main">∨</span> <span class="skolem">x</span><span class="main">=</span><span class="free">b</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> s_def P1_def P2_def
        <span class="keyword1"><span class="command">unfolding</span></span> segment_def prolongation_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="free">P</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> <span class="free">P</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">∈</span> <span class="free">P</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>›</span></span> betw_b_in_path betw_c_in_path path_P
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> union_P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">⋃</span><span class="main">{</span><span class="skolem">s</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="free">P1</span> <span class="main">∪</span> <span class="free">P2</span> <span class="main">∪</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="skolem">s</span><span class="main">}</span> <span class="main">=</span> <span class="main">(</span><span class="free">N</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="skolem">s</span><span class="main">}</span><span class="main">.</span> is_segment <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span> <span class="free">P1</span><span class="main">∩</span><span class="free">P2</span><span class="main">=</span><span class="main">{}</span> <span class="main">∧</span>
          <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="skolem">s</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">∩</span><span class="free">P1</span><span class="main">=</span><span class="main">{}</span> <span class="main">∧</span> <span class="bound">x</span><span class="main">∩</span><span class="free">P2</span><span class="main">=</span><span class="main">{}</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="main">{</span><span class="skolem">s</span><span class="main">}</span><span class="main">.</span> <span class="bound">x</span><span class="main">≠</span><span class="bound">y</span> <span class="main">⟶</span> <span class="bound">x</span><span class="main">∩</span><span class="bound">y</span><span class="main">=</span><span class="main">{}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">safe</span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="skolem">s</span><span class="main">}</span> <span class="main">=</span> <span class="free">N</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Q</span> <span class="main">=</span> <span class="main">{</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">}</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>›</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_segment <span class="skolem">s</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> s_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="free">P1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="free">P2</span>"</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="main">{}</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> P1_def P2_def <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">P1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">P2</span>›</span></span> abc_only_cba pro_betw
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="skolem">s</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="free">P1</span>"</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="main">{}</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> abc_only_cba seg_betw pro_betw  P1_def <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">P1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">s</span>›</span></span> s_def
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span><span class="main">)</span>
      <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="skolem">s</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="free">P2</span>"</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="main">{}</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> abc_only_cba seg_betw pro_betw
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> P2_def <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">P2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">s</span>›</span></span> s_def<span class="main">)</span>
      <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> S_def s_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1" id="TemporalOrderOnPath-int_split_to_segs"><span class="command">lemma</span></span> int_split_to_segs<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">f</span><span class="main">[</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">..</span><span class="free">c</span><span class="main">]</span><span class="free">Q</span><span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">S</span> <span class="keyword2"><span class="keyword">defines</span></span> S_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">≡</span> <span class="main">{</span>segment <span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">|</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">&lt;</span>card <span class="free">Q</span><span class="main">-</span><span class="main">1</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"interval <span class="free">a</span> <span class="free">c</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="free">S</span><span class="main">)</span> <span class="main">∪</span> <span class="free">Q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?N</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"card <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> f_def_2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">∈</span><span class="free">Q</span> <span class="main">∧</span> <span class="free">b</span><span class="main">∈</span><span class="free">Q</span> <span class="main">∧</span> <span class="free">c</span><span class="main">∈</span><span class="free">Q</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f_def points_in_chain <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?N</span> <span class="main">≥</span> <span class="numeral">3</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> ch_by_ord_def f_def fin_long_chain_def long_ch_card_ge3<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> bound_indices<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">0</span> <span class="main">=</span> <span class="free">a</span> <span class="main">∧</span> <span class="free">f</span> <span class="main">(</span>card <span class="free">Q</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="free">c</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f_def fin_long_chain_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="quoted"><span class="quoted">"<span class="var">?i</span> <span class="main">=</span> <span class="var">?u</span>"</span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"interval <span class="free">a</span> <span class="free">c</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="free">S</span><span class="main">)</span> <span class="main">∪</span> <span class="free">Q</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?i</span><span class="main">⊆</span><span class="var">?u</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="var">?i</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">∈</span><span class="var">?u</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">∈</span><span class="free">Q</span>"</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">∉</span><span class="free">Q</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">≠</span><span class="free">a</span> <span class="main">∧</span> <span class="skolem">p</span><span class="main">≠</span><span class="free">c</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> f_def f_def_2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="skolem">p</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> seg_betw <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">∈</span> interval <span class="free">a</span> <span class="free">c</span>›</span></span> interval_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n<span class="hidden">⇩</span><sub>y</sub></span></span> <span class="skolem"><span class="skolem">n<span class="hidden">⇩</span><sub>z</sub></span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="skolem"><span class="skolem">z</span></span>
        <span class="keyword2"><span class="keyword">where</span></span> yz_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">=</span><span class="free">f</span> <span class="skolem">n<span class="hidden">⇩</span><sub>y</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span><span class="main">=</span><span class="free">f</span> <span class="skolem">n<span class="hidden">⇩</span><sub>z</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="skolem">y</span> <span class="skolem">p</span> <span class="skolem">z</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">∈</span><span class="free">Q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span><span class="main">∈</span><span class="free">Q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n<span class="hidden">⇩</span><sub>y</sub></span><span class="main">=</span><span class="skolem">n<span class="hidden">⇩</span><sub>z</sub></span><span class="main">-</span><span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n<span class="hidden">⇩</span><sub>z</sub></span><span class="main">&lt;</span>card <span class="free">Q</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">k</span></span> <span class="main">&lt;</span> card <span class="free">Q</span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="bound">k</span><span class="main">)</span> <span class="skolem">p</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="bound">k</span><span class="main">&gt;</span><span class="skolem">n<span class="hidden">⇩</span><sub>y</sub></span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">k</span></span><span class="main">&lt;</span><span class="skolem">n<span class="hidden">⇩</span><sub>z</sub></span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="skolem">p</span> <span class="main">(</span><span class="free">f</span> <span class="bound">k</span><span class="main">)</span><span class="main"><span class="free">]]</span></span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> get_closest_chain_events <span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">f</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> Y<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">Q</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> a<span class="hidden">⇩</span><sub>n</sub><span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">c</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> a<span class="hidden">⇩</span><sub>0</sub><span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">a</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">b</span></span><span class="main">]</span>
          f_def <span class="quoted"><span class="quoted">‹<span class="skolem">p</span><span class="main">∉</span><span class="free">Q</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n<span class="hidden">⇩</span><sub>y</sub></span><span class="main">&lt;</span>card <span class="free">Q</span><span class="main">-</span><span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> yz_def<span class="main">(</span>6<span class="main">,</span>7<span class="main">)</span> f_def index_middle_element
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"segment <span class="main">(</span><span class="free">f</span> <span class="skolem">n<span class="hidden">⇩</span><sub>y</sub></span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">n<span class="hidden">⇩</span><sub>z</sub></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">∈</span><span class="var">?s</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="skolem">y</span> <span class="skolem">p</span> <span class="skolem">z</span><span class="main"><span class="free">]]</span></span>›</span></span> abc_abc_neq seg_betw yz_def<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n<span class="hidden">⇩</span><sub>z</sub></span> <span class="main">=</span> <span class="skolem">n<span class="hidden">⇩</span><sub>y</sub></span> <span class="main">+</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> yz_def<span class="main">(</span>6<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> abc_abc_neq add.commute add_diff_inverse_nat less_one yz_def<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span> zero_diff<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?s</span><span class="main">∈</span><span class="free">S</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> S_def <span class="quoted"><span class="quoted">‹<span class="skolem">n<span class="hidden">⇩</span><sub>y</sub></span><span class="main">&lt;</span>card <span class="free">Q</span><span class="main">-</span><span class="main">1</span>›</span></span> assms<span class="main">(</span>2<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">∈</span><span class="main">⋃</span><span class="free">S</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">∈</span> <span class="var">?s</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?u</span><span class="main">⊆</span><span class="var">?i</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="var">?u</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">∈</span><span class="main">⋃</span><span class="free">S</span> <span class="main">∨</span> <span class="skolem">p</span><span class="main">∈</span><span class="free">Q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">∈</span><span class="var">?i</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">∈</span><span class="free">Q</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">=</span><span class="free">a</span>"</span></span><span class="main">|</span><span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">=</span><span class="free">c</span>"</span></span><span class="main">|</span><span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="skolem">p</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> ch_all_betw_f f_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">=</span><span class="free">a</span>"</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> interval_def<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">=</span><span class="free">c</span>"</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> interval_def<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="skolem">p</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span>"</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> interval_def seg_betw <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">∈</span><span class="main">⋃</span><span class="free">S</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">∈</span><span class="skolem">s</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">∈</span><span class="free">S</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> segment <span class="main">(</span><span class="free">f</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="skolem">y</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">&lt;</span><span class="var">?N</span><span class="main">-</span><span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> S_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">+</span><span class="main">1</span><span class="main">&lt;</span><span class="var">?N</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> fy_in_Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="skolem">y</span><span class="main">)</span><span class="main">∈</span><span class="free">Q</span> <span class="main">∧</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">y</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">∈</span> <span class="free">Q</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> f_def <span class="keyword1"><span class="command">unfolding</span></span> fin_long_chain_def long_ch_by_ord_def ordering_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> add_lessD1<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">y</span><span class="main">)</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="skolem">y</span><span class="main">=</span><span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">&lt;</span><span class="var">?N</span> <span class="main">-</span> <span class="main">1</span>›</span></span> assms<span class="main">(</span>2<span class="main">)</span> f_def fin_long_chain_def order_finite_chain <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="skolem">y</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="skolem">y</span> <span class="main">=</span> <span class="var">?N</span><span class="main">-</span><span class="numeral">2</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">+</span> <span class="main">1</span> <span class="main">&lt;</span> card <span class="free">Q</span>›</span></span> assms<span class="main">(</span>2<span class="main">)</span> f_def fin_long_chain_def order_finite_chain
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> One_nat_def Suc_diff_1 Suc_eq_plus1 diff_Suc_eq_diff_pred gr_implies_not0
            lessI less_Suc_eq_le linorder_neqE_nat not_le numeral_2_eq_2<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">|</span><span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">=</span><span class="var">?N</span><span class="main">-</span><span class="numeral">2</span>"</span></span><span class="main">|</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">y</span><span class="main">)</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="skolem">y</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="skolem">p</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">=</span><span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">y</span> <span class="main">=</span> <span class="free">a</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bound_indices<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="skolem">p</span> <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="skolem">y</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">∈</span> <span class="skolem">s</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">=</span> segment <span class="main">(</span><span class="free">f</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>›</span></span> seg_betw
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="skolem">y</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="skolem">y</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="skolem">y</span> <span class="main">=</span> <span class="var">?N</span> <span class="main">-</span> <span class="numeral">2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?N</span><span class="main">≥</span><span class="numeral">3</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="skolem">p</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> abc_acd_abd <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">=</span><span class="var">?N</span><span class="main">-</span><span class="numeral">2</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="skolem">y</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="free">c</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> bound_indices <span class="quoted"><span class="quoted">‹<span class="var">?N</span><span class="main">≥</span><span class="numeral">3</span>›</span></span> numeral_2_eq_2 numeral_3_eq_3
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def Suc_diff_le add.commute add_leD2 diff_Suc_Suc plus_1_eq_Suc<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="skolem">y</span><span class="main">)</span> <span class="skolem">p</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">∈</span> <span class="skolem">s</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">=</span> segment <span class="main">(</span><span class="free">f</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>›</span></span> seg_betw
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">y</span><span class="main">)</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">y</span><span class="main">)</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="skolem">y</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">=</span> <span class="var">?N</span> <span class="main">-</span> <span class="numeral">2</span>›</span></span> <span class="quoted"><span class="quoted">`<span class="var">?N</span><span class="main">≥</span><span class="numeral">3</span>`</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="skolem">p</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> abc_acd_abd abc_sym<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">y</span><span class="main">)</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="skolem">y</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span>"</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="skolem">p</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> abe_ade_bcd_ace <span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">a</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> d<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="skolem">y</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> e<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">c</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> c<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">p</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">∈</span> <span class="skolem">s</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">=</span> segment <span class="main">(</span><span class="free">f</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="skolem">y</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>›</span></span> seg_betw
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> interval_def seg_betw <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> <span class="comment1">(*for 11*)</span> path_is_union<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> path_P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span><span class="main">∈</span><span class="free">𝒫</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> Q_def<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="free">Q</span><span class="main">::</span><span class="tfree">'a</span> set<span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"card <span class="free">Q</span> <span class="main">=</span> <span class="free">N</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span><span class="main">⊆</span><span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">N</span><span class="main">≥</span><span class="numeral">3</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> f_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">∈</span><span class="free">Q</span> <span class="main">∧</span> <span class="free">b</span><span class="main">∈</span><span class="free">Q</span> <span class="main">∧</span> <span class="free">c</span><span class="main">∈</span><span class="free">Q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">f</span><span class="main">[</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">..</span><span class="free">c</span><span class="main">]</span><span class="free">Q</span><span class="main">]</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> S_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">=</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> <span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span><span class="main">(</span><span class="free">N</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">.</span> <span class="bound">s</span> <span class="main">=</span> segment <span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> P1_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P1</span> <span class="main">=</span> prolongation <span class="free">b</span> <span class="free">a</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> P2_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P2</span> <span class="main">=</span> prolongation <span class="free">b</span> <span class="free">c</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">⋃</span><span class="free">S</span><span class="main">)</span> <span class="main">∪</span> <span class="free">P1</span> <span class="main">∪</span> <span class="free">P2</span> <span class="main">∪</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="comment1">(* For future use, as always *)</span>
  <span class="keyword1"><span class="command">have</span></span> in_P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">∈</span><span class="free">P</span> <span class="main">∧</span> <span class="free">b</span><span class="main">∈</span><span class="free">P</span> <span class="main">∧</span> <span class="free">c</span><span class="main">∈</span><span class="free">P</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span> f_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> bound_indices<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">0</span> <span class="main">=</span> <span class="free">a</span> <span class="main">∧</span> <span class="free">f</span> <span class="main">(</span>card <span class="free">Q</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="free">c</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f_def fin_long_chain_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> points_neq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">≠</span><span class="free">b</span> <span class="main">∧</span> <span class="free">b</span><span class="main">≠</span><span class="free">c</span> <span class="main">∧</span> <span class="free">a</span><span class="main">≠</span><span class="free">c</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f_def fin_long_chain_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The proof in two parts: subset inclusion one way, then the other.›</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="free">P</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="skolem">x</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">b</span> <span class="free">a</span> <span class="skolem">x</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">b</span> <span class="free">c</span> <span class="skolem">x</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="skolem">x</span><span class="main">=</span><span class="free">a</span> <span class="main">∨</span> <span class="skolem">x</span><span class="main">=</span><span class="free">c</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> in_P some_betw path_P points_neq <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">P</span>›</span></span> abc_sym
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> abc_acd_bcd ch_all_betw_f f_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">s</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> <span class="skolem">x</span><span class="main">∈</span><span class="bound">s</span><span class="main">)</span> <span class="main">∨</span> <span class="skolem">x</span><span class="main">∈</span><span class="free">P1</span> <span class="main">∨</span> <span class="skolem">x</span><span class="main">∈</span><span class="free">P2</span> <span class="main">∨</span> <span class="skolem">x</span><span class="main">∈</span><span class="free">Q</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="skolem">x</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> only_axc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main"><span class="free">[[</span></span><span class="free">b</span> <span class="free">a</span> <span class="skolem">x</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">b</span> <span class="free">c</span> <span class="skolem">x</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="skolem">x</span><span class="main">=</span><span class="free">a</span> <span class="main">∨</span> <span class="skolem">x</span><span class="main">=</span><span class="free">c</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> abc_only_cba
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> abc_bcd_abd abc_sym f_def fin_ch_betw<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> interval <span class="free">a</span> <span class="free">c</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="skolem">x</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span>›</span></span> interval_def seg_betw <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="free">Q</span> <span class="main">∨</span> <span class="skolem">x</span><span class="main">∈</span><span class="main">⋃</span><span class="free">S</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> int_split_to_segs S_def assms<span class="main">(</span>2<span class="main">,</span>3<span class="main">,</span>5<span class="main">)</span> f_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="skolem">x</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">b</span> <span class="free">a</span> <span class="skolem">x</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">b</span> <span class="free">c</span> <span class="skolem">x</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="skolem">x</span><span class="main">=</span><span class="free">a</span> <span class="main">∨</span> <span class="skolem">x</span><span class="main">=</span><span class="free">c</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="skolem">x</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">b</span> <span class="free">a</span> <span class="skolem">x</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">b</span> <span class="free">c</span> <span class="skolem">x</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="skolem">x</span> <span class="main">=</span> <span class="free">a</span> <span class="main">∨</span> <span class="skolem">x</span> <span class="main">=</span> <span class="free">c</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">" <span class="skolem">x</span><span class="main">∈</span><span class="free">P1</span> <span class="main">∨</span> <span class="skolem">x</span><span class="main">∈</span><span class="free">P2</span> <span class="main">∨</span> <span class="skolem">x</span><span class="main">∈</span><span class="free">Q</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> P1_def P2_def f_def pro_betw <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⋃</span><span class="free">S</span><span class="main">)</span> <span class="main">∪</span> <span class="free">P1</span> <span class="main">∪</span> <span class="free">P2</span> <span class="main">∪</span> <span class="free">Q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⋃</span><span class="free">S</span><span class="main">)</span> <span class="main">∪</span> <span class="free">P1</span> <span class="main">∪</span> <span class="free">P2</span> <span class="main">∪</span> <span class="free">Q</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">s</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> <span class="skolem">x</span><span class="main">∈</span><span class="bound">s</span><span class="main">)</span> <span class="main">∨</span> <span class="skolem">x</span><span class="main">∈</span><span class="free">P1</span> <span class="main">∨</span> <span class="skolem">x</span><span class="main">∈</span><span class="free">P2</span> <span class="main">∨</span> <span class="skolem">x</span><span class="main">∈</span><span class="free">Q</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="main">⋃</span><span class="free">S</span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">b</span> <span class="free">a</span> <span class="skolem">x</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">b</span> <span class="free">c</span> <span class="skolem">x</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="skolem">x</span><span class="main">∈</span><span class="free">Q</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> S_def P1_def P2_def
      <span class="keyword1"><span class="command">unfolding</span></span> segment_def prolongation_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="free">P</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="main">⋃</span><span class="free">S</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">=</span> <span class="main">{</span>segment <span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">|</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">&lt;</span><span class="free">N</span><span class="main">-</span><span class="main">1</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> S_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span>interval <span class="free">a</span> <span class="free">c</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> int_split_to_segs <span class="main">[</span><span class="operator">OF</span> f_def<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> assms <span class="quoted"><span class="quoted">`<span class="skolem">x</span><span class="main">∈</span><span class="main">⋃</span><span class="free">S</span>`</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> UnCI<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="skolem">x</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="skolem">x</span><span class="main">=</span><span class="free">a</span> <span class="main">∨</span> <span class="skolem">x</span><span class="main">=</span><span class="free">c</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> interval_def seg_betw <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> disjE<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="free">a</span> <span class="main">∨</span> <span class="skolem">x</span><span class="main">=</span><span class="free">c</span>"</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> in_P <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="skolem">x</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span>"</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> betw_b_in_path in_P path_P points_neq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>
     <span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∉</span><span class="main">⋃</span><span class="free">S</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">b</span> <span class="free">a</span> <span class="skolem">x</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">b</span> <span class="free">c</span> <span class="skolem">x</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="skolem">x</span><span class="main">∈</span><span class="free">Q</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="main">⋃</span> <span class="free">S</span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">b</span> <span class="free">a</span> <span class="skolem">x</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">b</span> <span class="free">c</span> <span class="skolem">x</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="free">Q</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span> betw_c_in_path in_P path_P points_neq
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">⋃</span><span class="free">S</span><span class="main">)</span> <span class="main">∪</span> <span class="free">P1</span> <span class="main">∪</span> <span class="free">P2</span> <span class="main">∪</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> <span class="comment1">(*for 11*)</span> inseg_axc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> path_P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span><span class="main">∈</span><span class="free">𝒫</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> Q_def<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="free">Q</span><span class="main">::</span><span class="tfree">'a</span> set<span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"card <span class="free">Q</span> <span class="main">=</span> <span class="free">N</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span><span class="main">⊆</span><span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">N</span><span class="main">≥</span><span class="numeral">3</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> f_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">∈</span><span class="free">Q</span> <span class="main">∧</span> <span class="free">b</span><span class="main">∈</span><span class="free">Q</span> <span class="main">∧</span> <span class="free">c</span><span class="main">∈</span><span class="free">Q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">f</span><span class="main">[</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">..</span><span class="free">c</span><span class="main">]</span><span class="free">Q</span><span class="main">]</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> S_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">=</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> <span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span><span class="main">(</span><span class="free">N</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">.</span> <span class="bound">s</span> <span class="main">=</span> segment <span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> x_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">∈</span><span class="free">s</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span><span class="main">∈</span><span class="free">S</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">x</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> inseg_neq_ac<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">≠</span><span class="free">a</span> <span class="main">∧</span> <span class="skolem">x</span><span class="main">≠</span><span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="skolem">s</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">∈</span><span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">s</span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">≠</span><span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> notI<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="free">a</span>"</span></span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> s_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> segment <span class="main">(</span><span class="free">f</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">&lt;</span><span class="free">N</span><span class="main">-</span><span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> S_def <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">∈</span> <span class="free">S</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">n</span> <span class="main">∈</span> <span class="free">Q</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> f_def <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">&lt;</span> <span class="free">N</span> <span class="main">-</span> <span class="main">1</span>›</span></span> fin_long_chain_def long_ch_by_ord_def ordering_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> diff_diff_cancel less_imp_diff_less less_irrefl_nat not_less<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">n</span><span class="main">)</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> f_def fin_long_chain_def assms<span class="main">(</span>3<span class="main">)</span> order_finite_chain seg_betw that<span class="main">(</span>1<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">&lt;</span> <span class="free">N</span> <span class="main">-</span> <span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">=</span> segment <span class="main">(</span><span class="free">f</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">=</span> <span class="free">a</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> abc_abc_neq add_lessD1 ch_all_betw_f inside_not_bound<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> less_diff_conv<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span><span class="main">∈</span><span class="skolem">s</span>›</span></span> seg_betw s_def<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span><span class="main">=</span><span class="free">a</span>›</span></span> abc_only_cba<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>3<span class="main">)</span> f_def fin_long_chain_def s_def<span class="main">(</span>2<span class="main">)</span> order_finite_chain
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le_numeral_extra<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> less_add_one less_diff_conv neq0_conv<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">≠</span><span class="free">c</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> notI<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="free">c</span>"</span></span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> s_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> segment <span class="main">(</span><span class="free">f</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">&lt;</span><span class="free">N</span><span class="main">-</span><span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> S_def <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">∈</span> <span class="free">S</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">&lt;</span><span class="free">N</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span><span class="main">∈</span><span class="skolem">s</span>›</span></span> seg_betw s_def<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="skolem">n</span><span class="main">)</span> <span class="main">∈</span> <span class="free">Q</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> f_def <span class="quoted"><span class="quoted">‹<span class="skolem">n</span><span class="main">+</span><span class="main">1</span> <span class="main">&lt;</span> <span class="free">N</span>›</span></span> fin_long_chain_def long_ch_by_ord_def ordering_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_lessD1 assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">∈</span> <span class="free">Q</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> f_def <span class="quoted"><span class="quoted">‹<span class="skolem">n</span><span class="main">+</span><span class="main">1</span> <span class="main">&lt;</span> <span class="free">N</span>›</span></span> fin_long_chain_def long_ch_by_ord_def ordering_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">≠</span> <span class="free">c</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span><span class="main">=</span><span class="free">c</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>›</span></span> abc_abc_neq
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> f_def fin_long_chain_def assms<span class="main">(</span>3<span class="main">)</span> order_finite_chain seg_betw that<span class="main">(</span>1<span class="main">)</span>
          abc_abc_neq abc_only_cba ch_all_betw_f
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="skolem">n</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">∈</span> <span class="free">Q</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="skolem">n</span> <span class="main">∈</span> <span class="free">Q</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">=</span> <span class="free">c</span>›</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span><span class="main">=</span><span class="free">c</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>›</span></span> assms<span class="main">(</span>3<span class="main">)</span> f_def s_def<span class="main">(</span>2<span class="main">)</span>
          abc_only_cba<span class="main">(</span>1<span class="main">)</span> fin_long_chain_def order_finite_chain
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="skolem">n</span> <span class="main">∈</span> <span class="free">Q</span>›</span></span> abc_bcd_acd abc_only_cba<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span> ch_all_betw_f<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">x</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">∈</span>interval <span class="free">a</span> <span class="free">c</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> int_split_to_segs <span class="main">[</span><span class="operator">OF</span> f_def<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> S_def assms<span class="main">(</span>2<span class="main">,</span>3<span class="main">,</span>5<span class="main">)</span> x_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">≠</span><span class="free">a</span> <span class="main">∧</span> <span class="free">x</span><span class="main">≠</span><span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> inseg_neq_ac
      <span class="keyword1"><span class="command">using</span></span> x_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> seg_betw <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">∈</span> interval <span class="free">a</span> <span class="free">c</span>›</span></span> interval_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="TemporalOrderOnPath-disjoint_segmentation"><span class="command">lemma</span></span> disjoint_segmentation<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> path_P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span><span class="main">∈</span><span class="free">𝒫</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> Q_def<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="free">Q</span><span class="main">::</span><span class="tfree">'a</span> set<span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"card <span class="free">Q</span> <span class="main">=</span> <span class="free">N</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span><span class="main">⊆</span><span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">N</span><span class="main">≥</span><span class="numeral">3</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> f_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">∈</span><span class="free">Q</span> <span class="main">∧</span> <span class="free">b</span><span class="main">∈</span><span class="free">Q</span> <span class="main">∧</span> <span class="free">c</span><span class="main">∈</span><span class="free">Q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">f</span><span class="main">[</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">..</span><span class="free">c</span><span class="main">]</span><span class="free">Q</span><span class="main">]</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> S_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">=</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> <span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span><span class="main">(</span><span class="free">N</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">.</span> <span class="bound">s</span> <span class="main">=</span> segment <span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> P1_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P1</span> <span class="main">=</span> prolongation <span class="free">b</span> <span class="free">a</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> P2_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P2</span> <span class="main">=</span> prolongation <span class="free">b</span> <span class="free">c</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P1</span><span class="main">∩</span><span class="free">P2</span><span class="main">=</span><span class="main">{}</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">∩</span><span class="free">P1</span><span class="main">=</span><span class="main">{}</span> <span class="main">∧</span> <span class="bound">x</span><span class="main">∩</span><span class="free">P2</span><span class="main">=</span><span class="main">{}</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> <span class="bound">x</span><span class="main">≠</span><span class="bound">y</span> <span class="main">⟶</span> <span class="bound">x</span><span class="main">∩</span><span class="bound">y</span><span class="main">=</span><span class="main">{}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">P1</span> <span class="main">∩</span> <span class="free">P2</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">safe</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="free">P1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="free">P2</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> abc_only_cba pro_betw P1_def P2_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">P1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">P2</span>›</span></span> abc_bcd_abd f_def<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> fin_ch_betw<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">∩</span><span class="free">P1</span><span class="main">=</span><span class="main">{}</span> <span class="main">∧</span> <span class="bound">x</span><span class="main">∩</span><span class="free">P2</span><span class="main">=</span><span class="main">{}</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> <span class="bound">x</span><span class="main">≠</span><span class="bound">y</span> <span class="main">⟶</span> <span class="bound">x</span><span class="main">∩</span><span class="bound">y</span><span class="main">=</span><span class="main">{}</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ballI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">∈</span><span class="free">S</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∩</span> <span class="free">P1</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∧</span> <span class="skolem">s</span> <span class="main">∩</span> <span class="free">P2</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> <span class="skolem">s</span> <span class="main">≠</span> <span class="bound">y</span> <span class="main">⟶</span> <span class="skolem">s</span> <span class="main">∩</span> <span class="bound">y</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI ballI impI<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">∩</span><span class="free">P1</span><span class="main">=</span><span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">safe</span><span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="skolem">s</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="free">P1</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="skolem">x</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> inseg_axc <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">∈</span> <span class="free">S</span>›</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="main">{}</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> P1_def <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">P1</span>›</span></span> abc_bcd_abd abc_only_cba<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> f_def<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> fin_ch_betw pro_betw<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">∩</span><span class="free">P2</span><span class="main">=</span><span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">safe</span><span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="skolem">s</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="free">P2</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="skolem">x</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> inseg_axc <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">∈</span> <span class="free">S</span>›</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="main">{}</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> P2_def <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">P2</span>›</span></span> abc_bcd_acd abc_only_cba<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> f_def<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> fin_ch_betw pro_betw<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">r</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span><span class="main">∈</span><span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">≠</span><span class="skolem">r</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">∩</span><span class="skolem">r</span><span class="main">=</span><span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">safe</span><span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">r</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">s</span>"</span></span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> rs_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">=</span> segment <span class="main">(</span><span class="free">f</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> segment <span class="main">(</span><span class="free">f</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="skolem">m</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
                                 <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">≠</span><span class="skolem">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">&lt;</span><span class="free">N</span><span class="main">-</span><span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span><span class="main">&lt;</span><span class="free">N</span><span class="main">-</span><span class="main">1</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> S_def <span class="quoted"><span class="quoted">‹<span class="skolem">r</span> <span class="main">∈</span> <span class="free">S</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">≠</span> <span class="skolem">r</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">∈</span> <span class="free">S</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">have</span></span> y_betw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="skolem">n</span><span class="main">)</span> <span class="skolem">y</span> <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="skolem">m</span><span class="main">)</span> <span class="skolem">y</span> <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="skolem">m</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> seg_betw <span class="quoted"><span class="quoted">‹<span class="skolem">y</span><span class="main">∈</span><span class="skolem">r</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span><span class="main">∈</span><span class="skolem">s</span>›</span></span> rs_def<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">&lt;</span><span class="skolem">m</span>"</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="skolem">m</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">&lt;</span> <span class="skolem">m</span>›</span></span> assms<span class="main">(</span>3<span class="main">)</span> f_def fin_long_chain_def order_finite_chain rs_def<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">&lt;</span><span class="skolem">m</span>"</span></span> <span class="comment1">(* NOTICE: this is astounding. in principle, r and s could be adjacent? must be the False in the assumptions. *)</span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="skolem">m</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">&lt;</span> <span class="skolem">m</span>›</span></span> abc_only_cba<span class="main">(</span>2<span class="main">)</span> abd_bcd_abc y_betw
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_eq_plus1 Suc_leI le_eq_less_or_eq<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">m</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> f_def assms<span class="main">(</span>3<span class="main">)</span> rs_def<span class="main">(</span>5<span class="main">)</span>
            <span class="keyword1"><span class="command">unfolding</span></span> fin_long_chain_def long_ch_by_ord_def ordering_def
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_lessD1 less_add_one less_diff_conv<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="skolem">y</span><span class="main"><span class="free">]]</span></span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="skolem">m</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>›</span></span> abc_acd_abd abd_bcd_abc y_betw
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">using</span></span> abc_only_cba y_betw <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="skolem">n</span><span class="main">&lt;</span><span class="skolem">m</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">&gt;</span><span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> nat_neq_iff rs_def<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">&gt;</span> <span class="skolem">m</span>›</span></span> assms<span class="main">(</span>3<span class="main">)</span> f_def fin_long_chain_def order_finite_chain rs_def<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span><span class="main">+</span><span class="main">1</span><span class="main">&lt;</span><span class="skolem">n</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span>  <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">&gt;</span> <span class="skolem">m</span>›</span></span> abc_only_cba<span class="main">(</span>2<span class="main">)</span> abd_bcd_abc y_betw
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_eq_plus1 Suc_leI le_eq_less_or_eq<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="skolem">m</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">n</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> f_def assms<span class="main">(</span>3<span class="main">)</span> rs_def<span class="main">(</span>4<span class="main">)</span>
            <span class="keyword1"><span class="command">unfolding</span></span> fin_long_chain_def long_ch_by_ord_def ordering_def
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_lessD1 less_add_one less_diff_conv<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="skolem">m</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="skolem">y</span><span class="main"><span class="free">]]</span></span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>›</span></span> abc_acd_abd abd_bcd_abc y_betw
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">using</span></span> abc_only_cba y_betw <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">∈</span><span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> <span class="comment1">(*for 11*)</span> segmentation_ex_Nge3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> path_P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span><span class="main">∈</span><span class="free">𝒫</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> Q_def<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="free">Q</span><span class="main">::</span><span class="tfree">'a</span> set<span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"card <span class="free">Q</span> <span class="main">=</span> <span class="free">N</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span><span class="main">⊆</span><span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">N</span><span class="main">≥</span><span class="numeral">3</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> f_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">∈</span><span class="free">Q</span> <span class="main">∧</span> <span class="free">b</span><span class="main">∈</span><span class="free">Q</span> <span class="main">∧</span> <span class="free">c</span><span class="main">∈</span><span class="free">Q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">f</span><span class="main">[</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">..</span><span class="free">c</span><span class="main">]</span><span class="free">Q</span><span class="main">]</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> S_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">=</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> <span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span><span class="main">(</span><span class="free">N</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">.</span> <span class="bound">s</span> <span class="main">=</span> segment <span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> P1_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P1</span> <span class="main">=</span> prolongation <span class="free">b</span> <span class="free">a</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> P2_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P2</span> <span class="main">=</span> prolongation <span class="free">b</span> <span class="free">c</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">⋃</span><span class="free">S</span><span class="main">)</span> <span class="main">∪</span> <span class="free">P1</span> <span class="main">∪</span> <span class="free">P2</span> <span class="main">∪</span> <span class="free">Q</span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> is_segment <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span>
           <span class="free">P1</span><span class="main">∩</span><span class="free">P2</span><span class="main">=</span><span class="main">{}</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">∩</span><span class="free">P1</span><span class="main">=</span><span class="main">{}</span> <span class="main">∧</span> <span class="bound">x</span><span class="main">∩</span><span class="free">P2</span><span class="main">=</span><span class="main">{}</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> <span class="bound">x</span><span class="main">≠</span><span class="bound">y</span> <span class="main">⟶</span> <span class="bound">x</span><span class="main">∩</span><span class="bound">y</span><span class="main">=</span><span class="main">{}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">⋃</span><span class="free">S</span><span class="main">)</span> <span class="main">∪</span> <span class="free">P1</span> <span class="main">∪</span> <span class="free">P2</span> <span class="main">∪</span> <span class="free">Q</span><span class="main">)</span> <span class="main">∧</span>
          <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> is_segment <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span> <span class="free">P1</span><span class="main">∩</span><span class="free">P2</span><span class="main">=</span><span class="main">{}</span> <span class="main">∧</span>
          <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">∩</span><span class="free">P1</span><span class="main">=</span><span class="main">{}</span> <span class="main">∧</span> <span class="bound">x</span><span class="main">∩</span><span class="free">P2</span><span class="main">=</span><span class="main">{}</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> <span class="bound">x</span><span class="main">≠</span><span class="bound">y</span> <span class="main">⟶</span> <span class="bound">x</span><span class="main">∩</span><span class="bound">y</span><span class="main">=</span><span class="main">{}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> disjoint_segmentation conjI<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">⋃</span><span class="free">S</span><span class="main">)</span> <span class="main">∪</span> <span class="free">P1</span> <span class="main">∪</span> <span class="free">P2</span> <span class="main">∪</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> path_is_union assms
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> is_segment <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">∈</span><span class="free">S</span>"</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"is_segment <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> S_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> assms disjoint_segmentation <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We define <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>disjoint›</span></span></span></span> to be the same as in HOL-Library.DisjointSets.
  This saves importing a lot of baggage we don't need.
  The two lemmas below are just for safety.
›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">disjoint</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">disjoint</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">∀</span><span class="bound">a</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">.</span> <span class="main">∀</span><span class="bound">b</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">.</span> <span class="bound">a</span> <span class="main">≠</span> <span class="bound">b</span> <span class="main">⟶</span> <span class="bound">a</span> <span class="main">∩</span> <span class="bound">b</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">S</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> set<span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">P1</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">P2</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">∩</span><span class="free">P1</span><span class="main">=</span><span class="main">{}</span> <span class="main">∧</span> <span class="bound">x</span><span class="main">∩</span><span class="free">P2</span><span class="main">=</span><span class="main">{}</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> <span class="bound">x</span><span class="main">≠</span><span class="bound">y</span> <span class="main">⟶</span> <span class="bound">x</span><span class="main">∩</span><span class="bound">y</span><span class="main">=</span><span class="main">{}</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">P1</span><span class="main">∩</span><span class="free">P2</span><span class="main">=</span><span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"disjoint <span class="main">(</span><span class="free">S</span><span class="main">∪</span><span class="main">{</span><span class="free">P1</span><span class="main">,</span><span class="free">P2</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ballI<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?U</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">S</span><span class="main">∪</span><span class="main">{</span><span class="free">P1</span><span class="main">,</span><span class="free">P2</span><span class="main">}</span>"</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">∈</span><span class="var">?U</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">consider</span></span> <span class="main">(</span>aS<span class="main">)</span><span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">∈</span><span class="free">S</span>"</span></span><span class="main">|</span><span class="main">(</span>a1<span class="main">)</span><span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">=</span><span class="free">P1</span>"</span></span><span class="main">|</span><span class="main">(</span>a2<span class="main">)</span><span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">=</span><span class="free">P2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">b</span><span class="main">∈</span><span class="var">?U</span><span class="main">.</span> <span class="skolem">a</span> <span class="main">≠</span> <span class="bound">b</span> <span class="main">⟶</span> <span class="skolem">a</span> <span class="main">∩</span> <span class="bound">b</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
    <span class="keyword3"><span class="command">case</span></span> aS
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">b</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">∈</span><span class="var">?U</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">≠</span><span class="skolem">b</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">∈</span><span class="free">S</span>"</span></span><span class="main">|</span><span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">=</span><span class="free">P1</span>"</span></span><span class="main">|</span><span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">=</span><span class="free">P2</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">∩</span><span class="skolem">b</span><span class="main">=</span><span class="main">{}</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">cases</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∈</span> <span class="free">S</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">≠</span> <span class="skolem">b</span>›</span></span> assms<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∈</span> <span class="free">S</span>›</span></span> assms<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∈</span> <span class="free">S</span>›</span></span> assms<span class="main">)</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> a1
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">b</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">∈</span><span class="var">?U</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">≠</span><span class="skolem">b</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">∈</span><span class="free">S</span>"</span></span><span class="main">|</span><span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">=</span><span class="free">P2</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> a1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">∩</span><span class="skolem">b</span><span class="main">=</span><span class="main">{}</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">cases</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> a1 assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> inf_commute<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a1 assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> a2
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">b</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">∈</span><span class="var">?U</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">≠</span><span class="skolem">b</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">∈</span><span class="free">S</span>"</span></span><span class="main">|</span><span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">=</span><span class="free">P1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> a2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">∩</span><span class="skolem">b</span><span class="main">=</span><span class="main">{}</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">cases</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> a2 assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> inf_commute<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a2 assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> inf_commute<span class="main">)</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">S</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> set<span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">P1</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">P2</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"disjoint <span class="main">(</span><span class="free">S</span><span class="main">∪</span><span class="main">{</span><span class="free">P1</span><span class="main">,</span><span class="free">P2</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">P1</span><span class="main">∉</span><span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">P2</span><span class="main">∉</span><span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">P1</span><span class="main">≠</span><span class="free">P2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">∩</span><span class="free">P1</span><span class="main">=</span><span class="main">{}</span> <span class="main">∧</span> <span class="bound">x</span><span class="main">∩</span><span class="free">P2</span><span class="main">=</span><span class="main">{}</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> <span class="bound">x</span><span class="main">≠</span><span class="bound">y</span> <span class="main">⟶</span> <span class="bound">x</span><span class="main">∩</span><span class="bound">y</span><span class="main">=</span><span class="main">{}</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">P1</span><span class="main">∩</span><span class="free">P2</span><span class="main">=</span><span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ballI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">P1</span><span class="main">∩</span><span class="free">P2</span><span class="main">=</span><span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="free">S</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∩</span><span class="free">P1</span><span class="main">=</span><span class="main">{}</span> <span class="main">∧</span> <span class="skolem">x</span><span class="main">∩</span><span class="free">P2</span><span class="main">=</span><span class="main">{}</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> <span class="skolem">x</span><span class="main">≠</span><span class="bound">y</span> <span class="main">⟶</span> <span class="skolem">x</span><span class="main">∩</span><span class="bound">y</span><span class="main">=</span><span class="main">{}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span><span class="main"><span class="improper">[</span></span>2<span class="main"><span class="improper">]</span></span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span><span class="main"><span class="improper">[</span></span>3<span class="main"><span class="improper">]</span></span> ballI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span><span class="main"><span class="improper">[</span></span>3<span class="main"><span class="improper">]</span></span> impI<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∩</span><span class="free">P1</span><span class="main">=</span><span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">S</span>›</span></span> assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∩</span><span class="free">P2</span><span class="main">=</span><span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">S</span>›</span></span> assms<span class="main">(</span>1<span class="main">,</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">∈</span><span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">≠</span><span class="skolem">y</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∩</span><span class="skolem">y</span><span class="main">=</span><span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">S</span>›</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Schutz says "As in the proof of the previous theorem [...]" - does he mean to imply that this
  should really be proved as induction? I can see that quite easily, induct on $N$, and add a segment
  by either splitting up a segment or taking a piece out of a prolongation.
  But I think that might be too much trouble.
›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> <span class="comment1">(*11*)</span> show_segmentation<span class="main">:</span>  
  <span class="keyword2"><span class="keyword">assumes</span></span> path_P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span><span class="main">∈</span><span class="free">𝒫</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> Q_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span><span class="main">⊆</span><span class="free">P</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> f_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">f</span><span class="main">[</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">]</span><span class="free">Q</span><span class="main">]</span>"</span></span>
    <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">P1</span> <span class="keyword2"><span class="keyword">defines</span></span> P1_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P1</span> <span class="main">≡</span> prolongation <span class="free">b</span> <span class="free">a</span>"</span></span>
    <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">P2</span> <span class="keyword2"><span class="keyword">defines</span></span> P2_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P2</span> <span class="main">≡</span> prolongation <span class="free">a</span> <span class="free">b</span>"</span></span>
    <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">S</span>  <span class="keyword2"><span class="keyword">defines</span></span> S_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">≡</span> <span class="keyword1">if</span> card <span class="free">Q</span><span class="main">=</span><span class="numeral">2</span> <span class="keyword1">then</span> <span class="main">{</span>segment <span class="free">a</span> <span class="free">b</span><span class="main">}</span>
                                 <span class="keyword1">else</span> <span class="main">{</span>segment <span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">|</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">&lt;</span>card <span class="free">Q</span><span class="main">-</span><span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">⋃</span><span class="free">S</span><span class="main">)</span> <span class="main">∪</span> <span class="free">P1</span> <span class="main">∪</span> <span class="free">P2</span> <span class="main">∪</span> <span class="free">Q</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> is_segment <span class="bound">x</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"disjoint <span class="main">(</span><span class="free">S</span><span class="main">∪</span><span class="main">{</span><span class="free">P1</span><span class="main">,</span><span class="free">P2</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">P1</span><span class="main">≠</span><span class="free">P2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">P1</span><span class="main">∉</span><span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">P2</span><span class="main">∉</span><span class="free">S</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> card_Q<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="free">Q</span> <span class="main">≥</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> fin_chain_card_geq_2 f_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">Q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> card.infinite card_Q rel_simps<span class="main"><span class="main">(</span></span>28<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="comment1">(* Hooray for theorem 10! Without it, we couldn't so brazenly go from a set of events
   to an ordered chain of events. The line below doesn't need f_def (which is needed for S_def)! *)</span>
  <span class="keyword1"><span class="command">have</span></span> ch_Q<span class="main">:</span> <span class="quoted"><span class="quoted">"ch <span class="free">Q</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Q_def card_Q path_P path_finsubset_chain <span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> X<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">Q</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> Q<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">P</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> f_def_2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">∈</span><span class="free">Q</span> <span class="main">∧</span> <span class="free">b</span><span class="main">∈</span><span class="free">Q</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f_def points_in_chain fin_chain_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">≠</span><span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f_def fin_chain_def fin_long_chain_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"card <span class="free">Q</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span><span class="main">=</span><span class="main">{</span>segment <span class="free">a</span> <span class="free">b</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> S_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">⋃</span><span class="free">S</span><span class="main">)</span> <span class="main">∪</span> <span class="free">P1</span> <span class="main">∪</span> <span class="free">P2</span> <span class="main">∪</span> <span class="free">Q</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> is_segment <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">P1</span><span class="main">∩</span><span class="free">P2</span><span class="main">=</span><span class="main">{}</span>"</span></span>
         <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">∩</span><span class="free">P1</span><span class="main">=</span><span class="main">{}</span> <span class="main">∧</span> <span class="bound">x</span><span class="main">∩</span><span class="free">P2</span><span class="main">=</span><span class="main">{}</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> <span class="bound">x</span><span class="main">≠</span><span class="bound">y</span> <span class="main">⟶</span> <span class="bound">x</span><span class="main">∩</span><span class="bound">y</span><span class="main">=</span><span class="main">{}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms ch_Q <span class="quoted"><span class="quoted">‹finite <span class="free">Q</span>›</span></span> segmentation_ex_N2
        <span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">P</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> Q<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">Q</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> N<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"card <span class="free">Q</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹card <span class="free">Q</span> <span class="main">=</span> <span class="numeral">2</span>›</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"card <span class="free">Q</span> <span class="main">≠</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"card <span class="free">Q</span> <span class="main">≥</span> <span class="numeral">3</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> card_Q <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> c_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">f</span><span class="main">[</span><span class="free">a</span><span class="main">..</span><span class="skolem">c</span><span class="main">..</span><span class="free">b</span><span class="main">]</span><span class="free">Q</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">,</span>5<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="free">a</span><span class="main">≠</span><span class="free">b</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> f_def fin_chain_def short_ch_def three_in_set3<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> pro_equiv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P1</span> <span class="main">=</span> prolongation <span class="skolem">c</span> <span class="free">a</span> <span class="main">∧</span> <span class="free">P2</span> <span class="main">=</span> prolongation <span class="skolem">c</span> <span class="free">b</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> pro_basis_change
      <span class="keyword1"><span class="command">using</span></span> P1_def P2_def abc_sym c_def fin_ch_betw <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> S_def2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">=</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> <span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span><span class="main">(</span>card <span class="free">Q</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">.</span> <span class="bound">s</span> <span class="main">=</span> segment <span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> S_def <span class="quoted"><span class="quoted">‹card <span class="free">Q</span> <span class="main">≥</span> <span class="numeral">3</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">⋃</span><span class="free">S</span><span class="main">)</span> <span class="main">∪</span> <span class="free">P1</span> <span class="main">∪</span> <span class="free">P2</span> <span class="main">∪</span> <span class="free">Q</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> is_segment <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">P1</span><span class="main">∩</span><span class="free">P2</span><span class="main">=</span><span class="main">{}</span>"</span></span>
         <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">∩</span><span class="free">P1</span><span class="main">=</span><span class="main">{}</span> <span class="main">∧</span> <span class="bound">x</span><span class="main">∩</span><span class="free">P2</span><span class="main">=</span><span class="main">{}</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> <span class="bound">x</span><span class="main">≠</span><span class="bound">y</span> <span class="main">⟶</span> <span class="bound">x</span><span class="main">∩</span><span class="bound">y</span><span class="main">=</span><span class="main">{}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f_def_2 assms ch_Q <span class="quoted"><span class="quoted">‹card <span class="free">Q</span> <span class="main">≥</span> <span class="numeral">3</span>›</span></span> c_def pro_equiv
        segmentation_ex_Nge3 <span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">P</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> Q<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">Q</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> N<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"card <span class="free">Q</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> S<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">S</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">a</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> c<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">b</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> f<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">f</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">using</span></span> points_in_chain <span class="quoted"><span class="quoted">‹finite <span class="free">Q</span>›</span></span> S_def2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> old_thesis<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">⋃</span><span class="free">S</span><span class="main">)</span> <span class="main">∪</span> <span class="free">P1</span> <span class="main">∪</span> <span class="free">P2</span> <span class="main">∪</span> <span class="free">Q</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> is_segment <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">P1</span><span class="main">∩</span><span class="free">P2</span><span class="main">=</span><span class="main">{}</span>"</span></span>
                  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">∩</span><span class="free">P1</span><span class="main">=</span><span class="main">{}</span> <span class="main">∧</span> <span class="bound">x</span><span class="main">∩</span><span class="free">P2</span><span class="main">=</span><span class="main">{}</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> <span class="bound">x</span><span class="main">≠</span><span class="bound">y</span> <span class="main">⟶</span> <span class="bound">x</span><span class="main">∩</span><span class="bound">y</span><span class="main">=</span><span class="main">{}</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"disjoint <span class="main">(</span><span class="free">S</span><span class="main">∪</span><span class="main">{</span><span class="free">P1</span><span class="main">,</span><span class="free">P2</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">P1</span><span class="main">≠</span><span class="free">P2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">P1</span><span class="main">∉</span><span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">P2</span><span class="main">∉</span><span class="free">S</span>"</span></span>
       <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">⋃</span><span class="free">S</span><span class="main">)</span> <span class="main">∪</span> <span class="free">P1</span> <span class="main">∪</span> <span class="free">P2</span> <span class="main">∪</span> <span class="free">Q</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> is_segment <span class="bound">x</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Int_commute<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> P2_def Un_iff old_thesis<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>›</span></span> disjoint_iff f_def_2 path_P pro_betw prolong_betw2<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> P1_def Un_iff old_thesis<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>4<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>›</span></span> disjoint_iff f_def_2 path_P pro_betw prolong_betw3<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> P2_def Un_iff old_thesis<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>4<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>›</span></span> disjoint_iff f_def_2 path_P pro_betw prolong_betw<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> old_thesis<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">theorem</span></span> <span class="comment1">(*11*)</span> segmentation<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> path_P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span><span class="main">∈</span><span class="free">𝒫</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> Q_def<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="free">Q</span><span class="main">≥</span><span class="numeral">2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span><span class="main">⊆</span><span class="free">P</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">S</span> <span class="bound">P1</span> <span class="bound">P2</span><span class="main">.</span> <span class="free">P</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">⋃</span><span class="bound">S</span><span class="main">)</span> <span class="main">∪</span> <span class="bound">P1</span> <span class="main">∪</span> <span class="bound">P2</span> <span class="main">∪</span> <span class="free">Q</span><span class="main">)</span> <span class="main">∧</span>
                     disjoint <span class="main">(</span><span class="bound">S</span><span class="main">∪</span><span class="main">{</span><span class="bound">P1</span><span class="main">,</span><span class="bound">P2</span><span class="main">}</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">P1</span><span class="main">≠</span><span class="bound">P2</span> <span class="main">∧</span> <span class="bound">P1</span><span class="main">∉</span><span class="bound">S</span> <span class="main">∧</span> <span class="bound">P2</span><span class="main">∉</span><span class="bound">S</span> <span class="main">∧</span>
                     <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="bound">S</span><span class="main">.</span> is_segment <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span> is_prolongation <span class="bound">P1</span> <span class="main">∧</span> is_prolongation <span class="bound">P2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?N</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"card <span class="free">Q</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> f_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">f</span><span class="main">[</span><span class="skolem">a</span><span class="main">..</span><span class="skolem">b</span><span class="main">]</span><span class="free">Q</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> path_finsubset_chain2<span class="main">[</span><span class="operator">OF</span> path_P Q_def<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">,</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="keyword1">if</span> <span class="var">?N</span><span class="main">=</span><span class="numeral">2</span> <span class="keyword1">then</span> <span class="main">{</span>segment <span class="skolem">a</span> <span class="skolem">b</span><span class="main">}</span> <span class="keyword1">else</span> <span class="main">{</span>segment <span class="main">(</span><span class="skolem">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">|</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">&lt;</span>card <span class="free">Q</span><span class="main">-</span><span class="main">1</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?P1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"prolongation <span class="skolem">b</span> <span class="skolem">a</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?P2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"prolongation <span class="skolem">a</span> <span class="skolem">b</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> from_seg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">⋃</span><span class="var">?S</span><span class="main">)</span> <span class="main">∪</span> <span class="var">?P1</span> <span class="main">∪</span> <span class="var">?P2</span> <span class="main">∪</span> <span class="free">Q</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="var">?S</span><span class="main">.</span> is_segment <span class="bound">x</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"disjoint <span class="main">(</span><span class="var">?S</span><span class="main">∪</span><span class="main">{</span><span class="var">?P1</span><span class="main">,</span><span class="var">?P2</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P1</span><span class="main">≠</span><span class="var">?P2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P1</span><span class="main">∉</span><span class="var">?S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P2</span><span class="main">∉</span><span class="var">?S</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> show_segmentation<span class="main">[</span><span class="operator">OF</span> path_P Q_def<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">(</span></span></span></span></span></span></span>2<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">)</span></span></span></span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">`<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">[</span></span></span></span></span></span><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem">f</span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">[</span></span></span></span></span></span><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem">a</span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">..</span></span></span></span></span></span><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem">b</span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">]</span></span></span></span></span></span><span class="free"><span class="free"><span class="free"><span class="free"><span class="free"><span class="free">Q</span></span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">]</span></span></span></span></span></span>`</span></span></span></span></span></span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>


  
<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context MinkowskiSpacetime *)</span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Chains are unique up to reversal"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> MinkowskiSpacetime<span class="main">)</span> chain_remove_at_right_edge<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">f</span><span class="main">[</span><span class="free">a</span><span class="main">..</span><span class="free">c</span><span class="main">]</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span>card <span class="free">X</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span> <span class="main">≤</span> card <span class="free">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">=</span> insert <span class="free">c</span> <span class="free">Y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">∉</span><span class="free">Y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">f</span><span class="main">[</span><span class="free">a</span><span class="main">..</span><span class="free">p</span><span class="main">]</span><span class="free">Y</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>

  <span class="keyword1"><span class="command">have</span></span> lch_X<span class="main">:</span> <span class="quoted"><span class="quoted">"long_ch_by_ord <span class="free">f</span> <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>3<span class="main">)</span> fin_chain_def fin_long_chain_def ch_by_ord_def short_ch_card_2
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">∈</span><span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ordering_def assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span> card.empty card_gt_0_iff diff_less lch_X
        long_ch_by_ord_def not_numeral_le_zero zero_less_numeral<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> bound_ind<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">0</span> <span class="main">=</span> <span class="free">a</span> <span class="main">∧</span> <span class="free">f</span> <span class="main">(</span>card <span class="free">X</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="free">c</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> lch_X assms<span class="main">(</span>1<span class="main">,</span>3<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> fin_chain_def fin_long_chain_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> One_nat_def Suc_1 ch_by_ord_def diff_Suc_Suc
        less_Suc_eq_le neq0_conv numeral_3_eq_3 short_ch_card_2 zero_less_diff<span class="main">)</span>
  
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">p</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="free">X</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">&lt;</span> card <span class="free">X</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="numeral">3</span> <span class="main">≤</span> card <span class="free">X</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="free">X</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="numeral">3</span> <span class="main">≤</span> card <span class="free">X</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> lch_X bound_ind <span class="quoted"><span class="quoted">‹<span class="numeral">3</span> <span class="main">≤</span> card <span class="free">X</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> long_ch_by_ord_def ordering_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def diff_Suc_less less_le_trans zero_less_numeral<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">≠</span><span class="free">c</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> abc_abc_neq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">∈</span><span class="free">Y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> <span class="free">X</span>›</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span> <span class="main">=</span> card <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">=</span> card <span class="free">Y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">,</span></span>5<span class="main"><span class="main">)</span></span> card.insert card.infinite diff_Suc_1 finite_insert nat.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span>
          numeral_2_eq_2 numeral_3_eq_3<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">≠</span><span class="free">p</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">p</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span>›</span></span> abc_abc_neq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">∈</span><span class="free">Y</span> <span class="main">∧</span> <span class="free">p</span><span class="main">∈</span><span class="free">Y</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">p</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> <span class="free">Y</span>›</span></span> abc_abc_neq assms<span class="main">(</span>1<span class="main">,</span>4<span class="main">)</span> fin_chain_def points_in_chain
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"short_ch <span class="free">Y</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ap</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"path <span class="skolem">ap</span> <span class="free">a</span> <span class="free">p</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">p</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span>›</span></span> abc_ex_path_unique calculation<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">Q</span><span class="main">.</span> path <span class="bound">Q</span> <span class="free">a</span> <span class="free">p</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">z</span><span class="main">∈</span><span class="free">Y</span><span class="main">.</span> <span class="bound">z</span> <span class="main">≠</span> <span class="free">a</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">≠</span> <span class="free">p</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="numeral">2</span> <span class="main">=</span> card <span class="free">Y</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> <span class="free">Y</span> <span class="main">∧</span> <span class="free">p</span> <span class="main">∈</span> <span class="free">Y</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">≠</span> <span class="free">p</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> card_2_iff'<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> short_ch_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> <span class="free">Y</span> <span class="main">∧</span> <span class="free">p</span> <span class="main">∈</span> <span class="free">Y</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> fin_chain_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span> <span class="main">≠</span> card <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">4</span> <span class="main">≤</span> card <span class="free">X</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> <span class="free">f</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">b</span><span class="main">.</span> <span class="main">[</span><span class="free">f</span><span class="main">[</span><span class="free">a</span><span class="main">..</span><span class="bound">b</span><span class="main">..</span><span class="free">p</span><span class="main">]</span><span class="free">Y</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="skolem">b</span> <span class="free">p</span><span class="main"><span class="free">]]</span></span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> bound_ind <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">=</span> <span class="free">f</span> <span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="numeral">3</span> <span class="main">≠</span> card <span class="free">X</span>›</span></span> assms<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> lch_X order_finite_chain
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">hence</span></span> all_neq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">≠</span><span class="free">a</span> <span class="main">∧</span> <span class="skolem">b</span><span class="main">≠</span><span class="free">p</span> <span class="main">∧</span> <span class="free">a</span><span class="main">≠</span><span class="free">p</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> abc_abc_neq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">∈</span><span class="free">X</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">=</span> <span class="free">f</span> <span class="main">1</span>›</span></span> lch_X assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> long_ch_by_ord_def ordering_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">∈</span><span class="free">Y</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="skolem">b</span> <span class="free">p</span><span class="main"><span class="free">]]</span></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">p</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span>›</span></span> abc_only_cba<span class="main">(</span>2<span class="main">)</span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ordering <span class="free">f</span> <span class="free">betw</span> <span class="free">Y</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> ordering_def
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">safe</span><span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> infinite <span class="free">Y</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">n</span> <span class="main">∈</span> <span class="free">Y</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">&lt;</span> card <span class="free">Y</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">n</span> <span class="main">∈</span> <span class="free">Y</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">,</span>4<span class="main">,</span>5<span class="main">)</span> bound_ind lch_X
          <span class="keyword1"><span class="command">unfolding</span></span> long_ch_by_ord_def ordering_def
          <span class="keyword1"><span class="command">using</span></span> get_fin_long_ch_bounds indices_neq_imp_events_neq
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> Suc_less_eq add_leD1 cancel_comm_monoid_add_class.diff_cancel card_Diff1_less
              card_Diff_singleton card_eq_0_iff card_insert_disjoint gr_implies_not0 insert_iff lch_X
              le_add_diff_inverse less_SucI numeral_3_eq_3 plus_1_eq_Suc zero_less_diff<span class="main">)</span>
        <span class="keyword1"><span class="command">{</span></span> 
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="free">Y</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="free">X</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> card <span class="free">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">n</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> lch_X <span class="keyword1"><span class="command">unfolding</span></span> long_ch_by_ord_def ordering_def
            <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span>finite <span class="free">Y</span> <span class="main">⟶</span> <span class="bound">n</span> <span class="main">&lt;</span> card <span class="free">Y</span><span class="main">)</span> <span class="main">∧</span> <span class="free">f</span> <span class="bound">n</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>finite <span class="free">Y</span> <span class="main">⟶</span> <span class="skolem">n</span> <span class="main">&lt;</span> card <span class="free">Y</span><span class="main">)</span> <span class="main">∧</span> <span class="free">f</span> <span class="skolem">n</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="skolem">n</span> <span class="main">=</span> <span class="skolem">x</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">&lt;</span> card <span class="free">X</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">Y</span>›</span></span> assms<span class="main">(</span>4<span class="main">,</span>5<span class="main">)</span> bound_ind
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Diff_insert_absorb card.remove card_Diff_singleton
                  finite.insertI insertI1 less_SucE<span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">}</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="skolem">n'</span> <span class="skolem">n''</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">n</span><span class="main">::</span>nat<span class="main">)</span><span class="main">&lt;</span><span class="skolem">n'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span><span class="main">&lt;</span><span class="skolem">n''</span>"</span></span>
        <span class="keyword1"><span class="command">{</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"infinite <span class="free">Y</span>"</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">n'</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">n''</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> infinite <span class="free">Y</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">n</span> <span class="main">∈</span> <span class="free">Y</span>›</span></span> <span class="quoted"><span class="quoted">‹infinite <span class="free">Y</span>›</span></span> assms<span class="main">(</span>5<span class="main">)</span> bound_ind <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">{</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n''</span> <span class="main">&lt;</span> card <span class="free">Y</span>"</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">n'</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">n''</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">&lt;</span> <span class="skolem">n'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n'</span> <span class="main">&lt;</span> <span class="skolem">n''</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n''</span> <span class="main">&lt;</span> card <span class="free">Y</span>›</span></span> assms<span class="main">(</span>4<span class="main">,</span>5<span class="main">)</span> lch_X order_finite_chain
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹infinite <span class="free">Y</span> <span class="main">⟹</span> <span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">n'</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">n''</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">hence</span></span> lch_Y<span class="main">:</span> <span class="quoted"><span class="quoted">"long_ch_by_ord <span class="free">f</span> <span class="free">Y</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">p</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">∈</span> <span class="free">Y</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> <span class="free">X</span>›</span></span> abc_abc_neq all_neq assms<span class="main">(</span>4<span class="main">)</span> bound_ind
          long_ch_by_ord_def zero_into_ordering
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">f</span><span class="main">[</span><span class="free">a</span><span class="main">..</span><span class="skolem">b</span><span class="main">..</span><span class="free">p</span><span class="main">]</span><span class="free">Y</span><span class="main">]</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> all_neq lch_Y bound_ind <span class="quoted"><span class="quoted">‹<span class="skolem">b</span><span class="main">∈</span><span class="free">Y</span>›</span></span> assms<span class="main">(</span>2<span class="main">,</span>3<span class="main">,</span>4<span class="main">,</span>5<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> fin_long_chain_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Diff_insert_absorb One_nat_def add_leD1 card.infinite finite_insert plus_1_eq_Suc
            diff_diff_left card_Diff_singleton not_one_le_zero insertI1 numeral_2_eq_2 numeral_3_eq_3<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> fin_chain_def
      <span class="keyword1"><span class="command">using</span></span> points_in_chain <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> MinkowskiChain<span class="main">)</span> fin_long_ch_imp_fin_ch<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">f</span><span class="main">[</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">..</span><span class="free">c</span><span class="main">]</span><span class="free">X</span><span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">f</span><span class="main">[</span><span class="free">a</span><span class="main">..</span><span class="free">c</span><span class="main">]</span><span class="free">X</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms fin_chain_def points_in_chain <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  If we ever want to have chains less strongly identified by endpoints,
  this result should generalise - $a,c,x,z$ are only used to identify reversal/no-reversal cases.
›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> MinkowskiSpacetime<span class="main">)</span> chain_unique_induction_ax<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"card <span class="free">X</span> <span class="main">≥</span> <span class="numeral">3</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> card <span class="free">X</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">f</span><span class="main">[</span><span class="free">a</span><span class="main">..</span><span class="free">c</span><span class="main">]</span><span class="free">X</span><span class="main">]</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">g</span><span class="main">[</span><span class="free">x</span><span class="main">..</span><span class="free">z</span><span class="main">]</span><span class="free">X</span><span class="main">]</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="free">x</span> <span class="main">∨</span> <span class="free">c</span> <span class="main">=</span> <span class="free">z</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">i</span> <span class="main">=</span> <span class="free">g</span> <span class="free">i</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"card <span class="free">X</span> <span class="main">-</span> <span class="numeral">3</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">X</span></span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">c</span></span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">z</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil<span class="main">:</span> 0
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">X</span> <span class="main">=</span> <span class="numeral">3</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Nil.hyps Nil.prems<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> f_ch<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">f</span><span class="main">[</span><span class="skolem">a</span><span class="main">..</span><span class="skolem">b</span><span class="main">..</span><span class="skolem">c</span><span class="main">]</span><span class="skolem">X</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Nil.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span> fin_chain_def short_ch_def three_in_set3<span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> g_ch<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">g</span><span class="main">[</span><span class="skolem">x</span><span class="main">..</span><span class="skolem">y</span><span class="main">..</span><span class="skolem">z</span><span class="main">]</span><span class="skolem">X</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Nil.prems fin_chain_def short_ch_card_2
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_n_not_le_n ch_by_ord_def numeral_2_eq_2 numeral_3_eq_3<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">=</span><span class="main">1</span> <span class="main">∨</span> <span class="free">i</span><span class="main">=</span><span class="main">0</span> <span class="main">∨</span> <span class="free">i</span><span class="main">=</span><span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹card <span class="skolem">X</span> <span class="main">=</span> <span class="numeral">3</span>›</span></span> Nil.prems<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> disjE<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">=</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">i</span> <span class="main">=</span> <span class="skolem">b</span> <span class="main">∧</span> <span class="free">g</span> <span class="free">i</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> index_middle_element f_ch g_ch <span class="quoted"><span class="quoted">‹card <span class="skolem">X</span> <span class="main">=</span> <span class="numeral">3</span>›</span></span> numeral_3_eq_3
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def add_diff_cancel_left' less_SucE not_less_eq plus_1_eq_Suc<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">i</span> <span class="main">=</span> <span class="free">g</span> <span class="free">i</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">i</span> <span class="main">≠</span> <span class="free">g</span> <span class="free">i</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="free">i</span> <span class="main">≠</span> <span class="skolem">b</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="free">i</span> <span class="main">=</span> <span class="skolem">b</span> <span class="main">∧</span> <span class="free">g</span> <span class="free">i</span> <span class="main">=</span> <span class="skolem">y</span>›</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="free">i</span> <span class="main">∈</span> <span class="skolem">X</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="free">i</span> <span class="main">=</span> <span class="skolem">b</span> <span class="main">∧</span> <span class="free">g</span> <span class="free">i</span> <span class="main">=</span> <span class="skolem">y</span>›</span></span>  g_ch points_in_chain <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g</span> <span class="free">i</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">∨</span> <span class="free">g</span> <span class="free">i</span> <span class="main">=</span> <span class="skolem">c</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">g</span> <span class="free">i</span> <span class="main">≠</span> <span class="skolem">b</span>›</span></span> <span class="quoted"><span class="quoted">‹card <span class="skolem">X</span> <span class="main">=</span> <span class="numeral">3</span>›</span></span> points_in_chain
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span>  f_ch card2_either_elt1_or_elt2 card_Diff_singleton diff_Suc_1
            fin_long_chain_def insert_Diff insert_iff numeral_2_eq_2 numeral_3_eq_3<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main"><span class="free">[[</span></span><span class="skolem">a</span> <span class="main">(</span><span class="free">g</span> <span class="free">i</span><span class="main">)</span> <span class="skolem">c</span><span class="main"><span class="free">]]</span></span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> abc_abc_neq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="free">i</span> <span class="main">∉</span> <span class="skolem">X</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="free">i</span><span class="main">=</span><span class="skolem">b</span> <span class="main">∧</span> <span class="free">g</span> <span class="free">i</span><span class="main">=</span><span class="skolem">y</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">g</span> <span class="free">i</span><span class="main">=</span><span class="skolem">a</span> <span class="main">∨</span> <span class="free">g</span> <span class="free">i</span><span class="main">=</span><span class="skolem">c</span>›</span></span>  f_ch g_ch chain_bounds_unique fin_long_chain_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="free">g</span> <span class="free">i</span> <span class="main">∈</span> <span class="skolem">X</span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹card <span class="skolem">X</span> <span class="main">=</span> <span class="numeral">3</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">i</span> <span class="main">=</span> <span class="main">1</span>›</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">i</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> Nil.prems<span class="main">(</span>5<span class="main">)</span> <span class="quoted"><span class="quoted">‹card <span class="skolem">X</span> <span class="main">=</span> <span class="numeral">3</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">i</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">i</span> <span class="main">=</span> <span class="numeral">2</span>›</span></span> chain_bounds_unique f_ch g_ch
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> diff_Suc_1 fin_long_chain_def numeral_2_eq_2 numeral_3_eq_3<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> IH<span class="main">:</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> lch_fX<span class="main">:</span> <span class="quoted"><span class="quoted">"long_ch_by_ord <span class="free">f</span> <span class="skolem">X</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ch_by_ord_def fin_chain_def fin_long_chain_def long_ch_card_ge3 IH<span class="main">(</span>3<span class="main">,</span>5<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> lch_gX<span class="main">:</span> <span class="quoted"><span class="quoted">"long_ch_by_ord <span class="free">g</span> <span class="skolem">X</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> IH<span class="main">(</span>3<span class="main">,</span>6<span class="main">)</span> ch_by_ord_def fin_chain_def fin_long_chain_def long_ch_card_ge3
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> fin_X<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">X</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> IH<span class="main">(</span>4<span class="main">)</span> le_0_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ch_by_ord <span class="free">f</span> <span class="skolem">X</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> lch_fX <span class="keyword1"><span class="command">unfolding</span></span> ch_by_ord_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">X</span> <span class="main">≥</span> <span class="numeral">4</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> IH.hyps<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>

  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> f_ch<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">f</span><span class="main">[</span><span class="skolem">a</span><span class="main">..</span><span class="skolem">b</span><span class="main">..</span><span class="skolem">c</span><span class="main">]</span><span class="skolem">X</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹ch_by_ord <span class="free">f</span> <span class="skolem">X</span>›</span></span> IH<span class="main">(</span>3<span class="main">,</span>5<span class="main">)</span> fin_chain_def short_ch_card_2
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> g_ch<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">g</span><span class="main">[</span><span class="skolem">x</span><span class="main">..</span><span class="skolem">y</span><span class="main">..</span><span class="skolem">z</span><span class="main">]</span><span class="skolem">X</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹ch_by_ord <span class="free">f</span> <span class="skolem">X</span>›</span></span> IH.prems<span class="main">(</span>1<span class="main">,</span>4<span class="main">)</span> fin_chain_def short_ch_card_2
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> p_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span>card <span class="skolem">X</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="skolem">a</span> <span class="skolem">p</span> <span class="skolem">c</span><span class="main"><span class="free">]]</span></span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">X</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">&lt;</span> card <span class="skolem">X</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="numeral">4</span> <span class="main">≤</span> card <span class="skolem">X</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">X</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="numeral">3</span> <span class="main">≤</span> card <span class="skolem">X</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> f_ch p_def <span class="keyword1"><span class="command">unfolding</span></span> fin_long_chain_def long_ch_by_ord_def ordering_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> card_Diff1_less card_Diff_singleton<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">≠</span><span class="skolem">c</span> <span class="main">∧</span> <span class="skolem">p</span><span class="main">≠</span><span class="skolem">a</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> abc_abc_neq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Y</span></span> <span class="keyword2"><span class="keyword">where</span></span> Y_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">=</span> insert <span class="skolem">c</span> <span class="skolem">Y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">∉</span><span class="skolem">Y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f_ch points_in_chain
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> mk_disjoint_insert<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> fin_Y<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">Y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f_ch fin_long_chain_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> card <span class="skolem">Y</span> <span class="main">-</span> <span class="numeral">3</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Suc <span class="skolem">n</span> <span class="main">=</span> card <span class="skolem">X</span> <span class="main">-</span> <span class="numeral">3</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">X</span> <span class="main">=</span> insert <span class="skolem">c</span> <span class="skolem">Y</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c</span><span class="main">∉</span><span class="skolem">Y</span>›</span></span> card_insert_if
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> card_Y<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="skolem">Y</span> <span class="main">=</span> <span class="skolem">n</span> <span class="main">+</span> <span class="numeral">3</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Y_def<span class="main">(</span>1<span class="main">)</span> Y_def<span class="main">(</span>2<span class="main">)</span> fin_Y IH.hyps<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">Y</span> <span class="main">=</span> card <span class="skolem">X</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Y_def<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> fin_X <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">∈</span><span class="skolem">Y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">X</span> <span class="main">=</span> insert <span class="skolem">c</span> <span class="skolem">Y</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="skolem">a</span> <span class="skolem">p</span> <span class="skolem">c</span><span class="main"><span class="free">]]</span></span>›</span></span> abc_abc_neq lch_fX p_def IH.prems<span class="main">(</span>1<span class="main">,</span>3<span class="main">)</span> Y_def<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> chain_remove_at_right_edge fin_chain_def points_in_chain<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">f</span><span class="main">[</span><span class="skolem">a</span><span class="main">..</span><span class="skolem">p</span><span class="main">]</span><span class="skolem">Y</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> chain_remove_at_right_edge <span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">f</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> c<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> X<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">X</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> p<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> Y<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">Y</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> fin_long_ch_imp_fin_ch  <span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">f</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> c<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> X<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">X</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> f_ch p_def <span class="quoted"><span class="quoted">‹card <span class="skolem">X</span> <span class="main">≥</span> <span class="numeral">3</span>›</span></span> Y_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> ch_fY<span class="main">:</span> <span class="quoted"><span class="quoted">"long_ch_by_ord <span class="free">f</span> <span class="skolem">Y</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> fin_chain_def
    <span class="keyword1"><span class="command">using</span></span> card_Y ch_by_ord_def fin_Y fin_long_chain_def long_ch_card_ge3
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

  <span class="keyword1"><span class="command">have</span></span> p_closest<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">q</span><span class="main">∈</span><span class="skolem">X</span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="skolem">p</span> <span class="bound">q</span> <span class="skolem">c</span><span class="main"><span class="free">]]</span></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">q</span><span class="main">∈</span><span class="skolem">X</span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="skolem">p</span> <span class="bound">q</span> <span class="skolem">c</span><span class="main"><span class="free">]]</span></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span><span class="main">∈</span><span class="skolem">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="skolem">p</span> <span class="skolem">q</span> <span class="skolem">c</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> card <span class="skolem">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">j</span> <span class="main">=</span> <span class="skolem">q</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> lch_fX lch_gX fin_X points_in_chain <span class="quoted"><span class="quoted">‹<span class="skolem">p</span><span class="main">≠</span><span class="skolem">c</span> <span class="main">∧</span> <span class="skolem">p</span><span class="main">≠</span><span class="skolem">a</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ordering_def long_ch_by_ord_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&gt;</span> card <span class="skolem">X</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">∧</span> <span class="skolem">j</span> <span class="main">&lt;</span> card <span class="skolem">X</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&gt;</span> card <span class="skolem">X</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">∧</span> <span class="skolem">j</span> <span class="main">&lt;</span> card <span class="skolem">X</span> <span class="main">-</span> <span class="main">1</span> <span class="main">∨</span> <span class="skolem">j</span> <span class="main">&lt;</span> card <span class="skolem">X</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">∧</span> <span class="skolem">j</span> <span class="main">&gt;</span> card <span class="skolem">X</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> index_order3 <span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"card <span class="skolem">X</span> <span class="main">-</span> <span class="numeral">2</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> c<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"card <span class="skolem">X</span> <span class="main">-</span> <span class="main">1</span>"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="skolem">p</span> <span class="skolem">q</span> <span class="skolem">c</span><span class="main"><span class="free">]]</span></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="skolem">j</span> <span class="main">=</span> <span class="skolem">q</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">&lt;</span> card <span class="skolem">X</span>›</span></span> f_ch p_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> One_nat_def card_gt_0_iff diff_less empty_iff
            fin_long_chain_def lessI zero_less_numeral<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">(</span>card <span class="skolem">X</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">p</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> asm_false<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">(</span>card <span class="skolem">X</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">≠</span> <span class="skolem">p</span>"</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="skolem">j</span> <span class="main">=</span> <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> card <span class="skolem">X</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">X</span> <span class="main">=</span> insert <span class="skolem">c</span> <span class="skolem">Y</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span><span class="main">∈</span><span class="skolem">Y</span>›</span></span>  points_in_chain <span class="quoted"><span class="quoted">‹<span class="skolem">p</span><span class="main">≠</span><span class="skolem">c</span> <span class="main">∧</span> <span class="skolem">p</span><span class="main">≠</span><span class="skolem">a</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> chain_bounds_unique f_ch
          fin_long_chain_def g_ch index_middle_element insert_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> card <span class="skolem">X</span> <span class="main">-</span> <span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> asm_false le_eq_less_or_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> card <span class="skolem">Y</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Y_def<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span> fin_Y<span class="main">)</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> <span class="free">g</span> <span class="main">(</span>card <span class="skolem">X</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="skolem">p</span> <span class="skolem">d</span> <span class="skolem">z</span><span class="main"><span class="free">]]</span></span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">X</span> <span class="main">-</span> <span class="main">1</span> <span class="main">&gt;</span> card <span class="skolem">X</span> <span class="main">-</span> <span class="numeral">2</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">&lt;</span> card <span class="skolem">X</span> <span class="main">-</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> lch_gX <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">&lt;</span> card <span class="skolem">Y</span> <span class="main">-</span> <span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹card <span class="skolem">Y</span> <span class="main">=</span> card <span class="skolem">X</span> <span class="main">-</span> <span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">d</span> <span class="main">=</span> <span class="free">g</span> <span class="main">(</span>card <span class="skolem">X</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">g</span> <span class="skolem">j</span> <span class="main">=</span> <span class="skolem">p</span>›</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> long_ch_by_ord_def ordering_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> One_nat_def card_Diff1_less card_Diff_singleton
            diff_diff_left fin_long_chain_def g_ch numeral_2_eq_2 plus_1_eq_Suc<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">∈</span><span class="skolem">X</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> lch_gX <span class="quoted"><span class="quoted">‹<span class="skolem">d</span> <span class="main">=</span> <span class="free">g</span> <span class="main">(</span>card <span class="skolem">X</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> long_ch_by_ord_def ordering_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">using</span></span> p_closest abc_sym IH.prems<span class="main">(</span>5<span class="main">)</span> chain_bounds_unique f_ch g_ch
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">hence</span></span> ch_gY<span class="main">:</span> <span class="quoted"><span class="quoted">"long_ch_by_ord <span class="free">g</span> <span class="skolem">Y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> IH.prems<span class="main">(</span>1<span class="main">,</span>4<span class="main">,</span>5<span class="main">)</span> g_ch f_ch ch_fY card_Y ch_by_ord_def chain_remove_at_right_edge fin_Y
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Y_def chain_bounds_unique fin_chain_def fin_long_chain_def long_ch_card_ge3<span class="main">)</span>
  
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">i</span> <span class="main">∈</span> <span class="skolem">Y</span> <span class="main">∨</span> <span class="free">f</span> <span class="free">i</span> <span class="main">=</span> <span class="skolem">c</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ordering_def <span class="quoted"><span class="quoted">‹<span class="skolem">X</span> <span class="main">=</span> insert <span class="skolem">c</span> <span class="skolem">Y</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">i</span> <span class="main">&lt;</span> card <span class="skolem">X</span>›</span></span> lch_fX insert_iff long_ch_by_ord_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">i</span> <span class="main">=</span> <span class="free">g</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> disjE<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">i</span> <span class="main">∈</span> <span class="skolem">Y</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">i</span> <span class="main">≠</span> <span class="skolem">c</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c</span> <span class="main">∉</span> <span class="skolem">Y</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> card <span class="skolem">Y</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">X</span> <span class="main">=</span> insert <span class="skolem">c</span> <span class="skolem">Y</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c</span><span class="main">∉</span><span class="skolem">Y</span>›</span></span> IH<span class="main">(</span>3<span class="main">,</span>4<span class="main">)</span> f_ch fin_Y fin_long_chain_def not_less_less_Suc_eq
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span> <span class="main">≤</span> card <span class="skolem">Y</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> card_Y le_add2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">i</span> <span class="main">=</span> <span class="free">g</span> <span class="free">i</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> IH<span class="main">(</span>1<span class="main">)</span> <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">Y</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">=</span> card <span class="skolem">Y</span> <span class="main">-</span> <span class="numeral">3</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="numeral">3</span> <span class="main">≤</span> card <span class="skolem">Y</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">i</span> <span class="main">&lt;</span> card <span class="skolem">Y</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> Y_def card_Y chain_remove_at_right_edge le_add2
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> IH.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">,</span></span>4<span class="main"><span class="main">,</span></span>5<span class="main"><span class="main">)</span></span> chain_bounds_unique2<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">i</span> <span class="main">=</span> <span class="skolem">c</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> IH.prems<span class="main">(</span>2<span class="main">,</span>5<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="free">i</span> <span class="main">=</span> <span class="skolem">c</span>›</span></span> chain_bounds_unique f_ch g_ch indices_neq_imp_events_neq
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹card <span class="skolem">Y</span> <span class="main">=</span> card <span class="skolem">X</span> <span class="main">-</span> <span class="main">1</span>›</span></span> Y_def card_insert_disjoint fin_Y fin_long_chain_def lessI<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹I'm really impressed <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>sledgehammer›</span></span></span></span>/<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>smt›</span></span></span></span> can solve this if I just tell them "Use symmetry!".›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> MinkowskiSpacetime<span class="main">)</span> chain_unique_induction_cx<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"card <span class="free">X</span> <span class="main">≥</span> <span class="numeral">3</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> card <span class="free">X</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">f</span><span class="main">[</span><span class="free">a</span><span class="main">..</span><span class="free">c</span><span class="main">]</span><span class="free">X</span><span class="main">]</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">g</span><span class="main">[</span><span class="free">x</span><span class="main">..</span><span class="free">z</span><span class="main">]</span><span class="free">X</span><span class="main">]</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">=</span> <span class="free">x</span> <span class="main">∨</span> <span class="free">a</span> <span class="main">=</span> <span class="free">z</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">i</span> <span class="main">=</span> <span class="free">g</span> <span class="main">(</span>card <span class="free">X</span> <span class="main">-</span> <span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> chain_sym chain_unique_induction_ax
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> best<span class="main"><span class="main">)</span></span> assms diff_right_commute fin_chain_def fin_long_ch_imp_fin_ch<span class="main">)</span>



<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  This lemma has to exclude two-element chains again, because no order exists within them.
  Alternatively, the result is trivial: any function that assigns one element to index 0 and
  the other to 1 can be replaced with the (unique) other assignment, without destroying any
  (trivial, since ternary) "ordering" of the chain.
  This could be made generic over the ordering similar to <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>chain_sym›</span></span></span></span> relying on <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ordering_sym›</span></span></span></span>.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> MinkowskiSpacetime<span class="main">)</span> chain_unique_upto_rev_cases<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ch_f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">f</span><span class="main">[</span><span class="free">a</span><span class="main">..</span><span class="free">c</span><span class="main">]</span><span class="free">X</span><span class="main">]</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> ch_g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">g</span><span class="main">[</span><span class="free">x</span><span class="main">..</span><span class="free">z</span><span class="main">]</span><span class="free">X</span><span class="main">]</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> card_X<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="free">X</span> <span class="main">≥</span> <span class="numeral">3</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> valid_index<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> card <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">a</span><span class="main">=</span><span class="free">x</span> <span class="main">∨</span> <span class="free">c</span><span class="main">=</span><span class="free">z</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">f</span> <span class="free">i</span> <span class="main">=</span> <span class="free">g</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">a</span><span class="main">=</span><span class="free">z</span> <span class="main">∨</span> <span class="free">c</span><span class="main">=</span><span class="free">x</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">f</span> <span class="free">i</span> <span class="main">=</span> <span class="free">g</span> <span class="main">(</span>card <span class="free">X</span> <span class="main">-</span> <span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> n_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> card <span class="free">X</span> <span class="main">-</span> <span class="numeral">3</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> valid_index_2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="skolem">n</span> <span class="main">+</span> <span class="numeral">3</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_X valid_index<span class="main">)</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">a</span><span class="main">=</span><span class="free">x</span> <span class="main">∨</span> <span class="free">c</span><span class="main">=</span><span class="free">z</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">f</span> <span class="free">i</span> <span class="main">=</span> <span class="free">g</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> card_X ch_f ch_g chain_unique_induction_ax valid_index <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">a</span><span class="main">=</span><span class="free">z</span> <span class="main">∨</span> <span class="free">c</span><span class="main">=</span><span class="free">x</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">f</span> <span class="free">i</span> <span class="main">=</span> <span class="free">g</span> <span class="main">(</span>card <span class="free">X</span> <span class="main">-</span> <span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> ch_f ch_g chain_unique_induction_cx valid_index <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> MinkowskiSpacetime<span class="main">)</span> chain_unique_upto_rev<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">f</span><span class="main">[</span><span class="free">a</span><span class="main">..</span><span class="free">c</span><span class="main">]</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">g</span><span class="main">[</span><span class="free">x</span><span class="main">..</span><span class="free">z</span><span class="main">]</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"card <span class="free">X</span> <span class="main">≥</span> <span class="numeral">3</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> card <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">i</span> <span class="main">=</span> <span class="free">g</span> <span class="free">i</span> <span class="main">∨</span> <span class="free">f</span> <span class="free">i</span> <span class="main">=</span> <span class="free">g</span> <span class="main">(</span>card <span class="free">X</span> <span class="main">-</span> <span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">=</span><span class="free">x</span><span class="main">∧</span><span class="free">c</span><span class="main">=</span><span class="free">z</span> <span class="main">∨</span> <span class="free">c</span><span class="main">=</span><span class="free">x</span><span class="main">∧</span><span class="free">a</span><span class="main">=</span><span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">=</span><span class="free">x</span> <span class="main">∨</span> <span class="free">c</span><span class="main">=</span><span class="free">z</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">a</span><span class="main">=</span><span class="free">z</span> <span class="main">∨</span> <span class="free">c</span><span class="main">=</span><span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> chain_bounds_unique
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span> fin_chain_def points_in_chain short_ch_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">i</span> <span class="main">=</span> <span class="free">g</span> <span class="free">i</span> <span class="main">∨</span> <span class="free">f</span> <span class="free">i</span> <span class="main">=</span> <span class="free">g</span> <span class="main">(</span>card <span class="free">X</span> <span class="main">-</span> <span class="free">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="free">i</span> <span class="main">&lt;</span> card <span class="free">X</span>›</span></span> assms chain_unique_upto_rev_cases <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">=</span><span class="free">x</span><span class="main">∧</span><span class="free">c</span><span class="main">=</span><span class="free">z</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">c</span><span class="main">=</span><span class="free">x</span><span class="main">∧</span><span class="free">a</span><span class="main">=</span><span class="free">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms<span class="main"><span class="main">(</span></span>1-3<span class="main"><span class="main">)</span></span> chain_bounds_unique2<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Subchains"</span></span>
<span class="keyword1"><span class="command">context</span></span> MinkowskiSpacetime <span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1" id="TemporalOrderOnPath-f_img_is_subset"><span class="command">lemma</span></span> f_img_is_subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">f</span><span class="main">[</span><span class="main">(</span><span class="free">f</span> <span class="main">0</span><span class="main">)</span> <span class="main">..]</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">≥</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span><span class="main">&gt;</span><span class="free">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Y</span><span class="main">=</span><span class="free">f</span><span class="main">`</span><span class="main">{</span><span class="free">i</span><span class="main">..</span><span class="free">j</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">Y</span><span class="main">⊆</span><span class="free">X</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="free">Y</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">∈</span><span class="main">{</span><span class="free">i</span><span class="main">..</span><span class="free">j</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">n</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">n</span> <span class="main">∈</span> <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ordering_def assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> inf_chain_is_long long_ch_by_ord_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="skolem">n</span> <span class="main">=</span> <span class="skolem">x</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="TemporalOrderOnPath-f_inj_on_index_subset"><span class="command">lemma</span></span> f_inj_on_index_subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">f</span><span class="main">[</span><span class="main">(</span><span class="free">f</span> <span class="main">0</span><span class="main">)</span> <span class="main">..]</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">≥</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span><span class="main">&gt;</span><span class="free">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Y</span><span class="main">=</span><span class="free">f</span><span class="main">`</span><span class="main">{</span><span class="free">i</span><span class="main">..</span><span class="free">j</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="free">f</span> <span class="main">{</span><span class="free">i</span><span class="main">..</span><span class="free">j</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> inj_on_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">safe</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="main">{</span><span class="free">i</span><span class="main">..</span><span class="free">j</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">∈</span><span class="main">{</span><span class="free">i</span><span class="main">..</span><span class="free">j</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">y</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="skolem">y</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">≠</span><span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">r</span> <span class="bound">s</span><span class="main">.</span> <span class="free">f</span> <span class="bound">r</span> <span class="main">≠</span> <span class="free">f</span> <span class="bound">s</span>"</span></span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">≤</span><span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">&lt;</span><span class="skolem">y</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">y</span>›</span></span> le_imp_less_or_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">&gt;</span><span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="skolem">x</span><span class="main">)</span><span class="main">(</span><span class="free">f</span> <span class="skolem">y</span><span class="main">)</span><span class="main">(</span><span class="free">f</span> <span class="skolem">n</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span><span class="main">&lt;</span><span class="skolem">y</span>›</span></span> inf_chain_is_long long_ch_by_ord_def ordering_ord_ijk <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">x</span> <span class="skolem">y</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> abc_abc_neq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span> <span class="comment1">(* TODO: use a wlog theorem for sets instead? *)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">&gt;</span><span class="skolem">y</span>"</span></span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">&gt;</span><span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="skolem">y</span><span class="main">)</span><span class="main">(</span><span class="free">f</span> <span class="skolem">x</span><span class="main">)</span><span class="main">(</span><span class="free">f</span> <span class="skolem">n</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span><span class="main">&gt;</span><span class="skolem">y</span>›</span></span> inf_chain_is_long long_ch_by_ord_def ordering_ord_ijk <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">y</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> abc_abc_neq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">using</span></span> not_le_imp_less <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="skolem">x</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">y</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="TemporalOrderOnPath-f_bij_on_index_subset"><span class="command">lemma</span></span> f_bij_on_index_subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">f</span><span class="main">[</span><span class="main">(</span><span class="free">f</span> <span class="main">0</span><span class="main">)</span> <span class="main">..]</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">≥</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span><span class="main">&gt;</span><span class="free">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Y</span><span class="main">=</span><span class="free">f</span><span class="main">`</span><span class="main">{</span><span class="free">i</span><span class="main">..</span><span class="free">j</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="free">f</span> <span class="main">{</span><span class="free">i</span><span class="main">..</span><span class="free">j</span><span class="main">}</span> <span class="free">Y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> f_inj_on_index_subset
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms inj_on_imp_bij_betw<span class="main">)</span>


<span class="keyword1" id="TemporalOrderOnPath-only_one_index"><span class="command">lemma</span></span> only_one_index<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">f</span><span class="main">[</span><span class="main">(</span><span class="free">f</span> <span class="main">0</span><span class="main">)</span> <span class="main">..]</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">≥</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span><span class="main">&gt;</span><span class="free">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Y</span><span class="main">=</span><span class="free">f</span><span class="main">`</span><span class="main">{</span><span class="free">i</span><span class="main">..</span><span class="free">j</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">n</span> <span class="main">∈</span> <span class="free">Y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span><span class="main">∈</span><span class="main">{</span><span class="free">i</span><span class="main">..</span><span class="free">j</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span><span class="main">∈</span><span class="main">{</span><span class="free">i</span><span class="main">..</span><span class="free">j</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">m</span> <span class="main">=</span> <span class="free">f</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span> assms<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="free">f</span> <span class="main">{</span><span class="free">i</span><span class="main">..</span><span class="free">j</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>3<span class="main">)</span> f_inj_on_index_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span><span class="main">≠</span><span class="free">n</span>"</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">l</span> <span class="main">∈</span> <span class="free">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span><span class="main">≠</span><span class="skolem">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span><span class="main">≠</span><span class="free">n</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> inf_chain_is_long
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ordering_def le_eq_less_or_eq lessI long_ch_by_ord_def not_less_eq_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="skolem">l</span><span class="main">)</span><span class="main">(</span><span class="free">f</span> <span class="skolem">m</span><span class="main">)</span><span class="main">(</span><span class="free">f</span> <span class="free">n</span><span class="main">)</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="skolem">m</span><span class="main">)</span><span class="main">(</span><span class="free">f</span> <span class="skolem">l</span><span class="main">)</span><span class="main">(</span><span class="free">f</span> <span class="free">n</span><span class="main">)</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="skolem">l</span><span class="main">)</span><span class="main">(</span><span class="free">f</span> <span class="free">n</span><span class="main">)</span><span class="main">(</span><span class="free">f</span> <span class="skolem">m</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="skolem">m</span> <span class="main">=</span> <span class="free">f</span> <span class="free">n</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">m</span><span class="main">≠</span><span class="free">n</span>›</span></span> 
      <span class="keyword1"><span class="command">using</span></span> abc_abc_neq assms<span class="main">(</span>1<span class="main">)</span> inf_chain_is_long inf_ordering_inj' long_ch_by_ord_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="skolem">m</span> <span class="main">=</span> <span class="free">f</span> <span class="free">n</span>›</span></span> abc_abc_neq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">m</span> <span class="main">∈</span> <span class="main">{</span><span class="free">i</span><span class="main">..</span><span class="free">j</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="TemporalOrderOnPath-f_one_to_one_on_index_subset"><span class="command">lemma</span></span> f_one_to_one_on_index_subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">f</span><span class="main">[</span><span class="main">(</span><span class="free">f</span> <span class="main">0</span><span class="main">)</span> <span class="main">..]</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">≥</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span><span class="main">&gt;</span><span class="free">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Y</span><span class="main">=</span><span class="free">f</span><span class="main">`</span><span class="main">{</span><span class="free">i</span><span class="main">..</span><span class="free">j</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main">∈</span><span class="free">Y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃!</span><span class="bound"><span class="bound">k</span></span><span class="main">∈</span><span class="main">{</span><span class="free">i</span><span class="main">..</span><span class="free">j</span><span class="main">}</span><span class="main">.</span> <span class="free">f</span> <span class="bound">k</span> <span class="main">=</span> <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">k</span> <span class="main">=</span> <span class="free">y</span> <span class="main">⟶</span> <span class="free">k</span><span class="main">∈</span><span class="main">{</span><span class="free">i</span><span class="main">..</span><span class="free">j</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> f_inj_on_index_subset only_one_index assms image_iff inj_on_eq_iff <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>3<span class="main">,</span>4<span class="main">,</span>5<span class="main">)</span> only_one_index <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


<span class="keyword1" id="TemporalOrderOnPath-card_of_subchain"><span class="command">lemma</span></span> card_of_subchain<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">f</span><span class="main">[</span><span class="main">(</span><span class="free">f</span> <span class="main">0</span><span class="main">)</span> <span class="main">..]</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">≥</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span><span class="main">&gt;</span><span class="free">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Y</span><span class="main">=</span><span class="free">f</span><span class="main">`</span><span class="main">{</span><span class="free">i</span><span class="main">..</span><span class="free">j</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="free">Y</span> <span class="main">=</span> card <span class="main">{</span><span class="free">i</span><span class="main">..</span><span class="free">j</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"card <span class="free">Y</span> <span class="main">=</span> <span class="free">j</span><span class="main">-</span><span class="free">i</span><span class="main">+</span><span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"card <span class="free">Y</span> <span class="main">=</span> card <span class="main">{</span><span class="free">i</span><span class="main">..</span><span class="free">j</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms bij_betw_same_card f_bij_on_index_subset<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"card <span class="free">Y</span> <span class="main">=</span> <span class="free">j</span><span class="main">-</span><span class="free">i</span><span class="main">+</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> card_Collect_nat
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="TemporalOrderOnPath-fin_long_subchain_of_semifin"><span class="command">lemma</span></span> fin_long_subchain_of_semifin<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">f</span><span class="main">[</span><span class="main">(</span><span class="free">f</span> <span class="main">0</span><span class="main">)</span> <span class="main">..]</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">≥</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span><span class="main">&gt;</span><span class="free">i</span><span class="main">+</span><span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Y</span><span class="main">=</span><span class="free">f</span><span class="main">`</span><span class="main">{</span><span class="free">i</span><span class="main">..</span><span class="free">j</span><span class="main">}</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="free">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">g</span><span class="main">[</span><span class="main">(</span><span class="free">f</span> <span class="free">i</span><span class="main">)</span><span class="main">..</span><span class="main">(</span><span class="free">f</span> <span class="free">j</span><span class="main">)</span><span class="main">]</span><span class="free">Y</span><span class="main">]</span>"</span></span> <span class="comment1">(* "j=i+1 ⟶ short_ch Y" "j&gt;i+1 ⟶ fin_long_ch_by_ord g Y" *)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">=</span><span class="free">i</span><span class="main">+</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> ind_ord<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">&lt;</span><span class="skolem">k</span> <span class="main">∧</span> <span class="skolem">k</span><span class="main">&lt;</span><span class="free">j</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">g</span><span class="main">[</span><span class="main">(</span><span class="free">f</span> <span class="free">i</span><span class="main">)</span> <span class="main">..</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">..</span> <span class="main">(</span><span class="free">f</span> <span class="free">j</span><span class="main">)</span><span class="main">]</span><span class="free">Y</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">i</span> <span class="main">≠</span> <span class="free">f</span> <span class="skolem">k</span> <span class="main">∧</span> <span class="free">f</span> <span class="free">i</span> <span class="main">≠</span> <span class="free">f</span> <span class="free">j</span> <span class="main">∧</span> <span class="free">f</span> <span class="skolem">k</span> <span class="main">≠</span> <span class="free">f</span> <span class="free">j</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="free">j</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> ind_ord long_ch_by_ord_def ordering_ord_ijk semifin_chain_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> abc_abc_neq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">Y</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj <span class="free">f</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> inf_ordering_inj <span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> ord<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">betw</span>"</span></span><span class="main">]</span> abc_abc_neq
        <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> long_ch_by_ord_def semifin_chain_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"card <span class="free">Y</span> <span class="main">≤</span> card <span class="main">{</span><span class="free">i</span><span class="main">..</span><span class="free">j</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span> inf_ordering_inj
        <span class="keyword1"><span class="command">using</span></span> card_image_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="free">i</span><span class="main">..</span><span class="free">j</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">Y</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span> 
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"long_ch_by_ord <span class="free">g</span> <span class="free">Y</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="free">f</span> <span class="free">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">=</span><span class="free">f</span> <span class="skolem">k</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span><span class="main">=</span><span class="free">f</span> <span class="free">j</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="free">Y</span> <span class="main">∧</span> <span class="skolem">y</span><span class="main">∈</span><span class="free">Y</span> <span class="main">∧</span> <span class="skolem">z</span><span class="main">∈</span><span class="free">Y</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">y</span> <span class="main">∧</span> <span class="skolem">y</span> <span class="main">≠</span> <span class="skolem">z</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">z</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">=</span> <span class="free">f</span> <span class="free">i</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">k</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z</span> <span class="main">=</span> <span class="free">f</span> <span class="free">j</span>›</span></span> assms<span class="main">(</span>4<span class="main">)</span> calculation<span class="main">(</span>1<span class="main">)</span> ind_ord <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ordering <span class="free">g</span> <span class="free">betw</span> <span class="free">Y</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> ordering_def
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span>finite <span class="free">Y</span> <span class="main">⟶</span> <span class="bound">n</span> <span class="main">&lt;</span> card <span class="free">Y</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">g</span> <span class="bound">n</span> <span class="main">∈</span> <span class="free">Y</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">safe</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">Y</span>›</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">&lt;</span>card <span class="free">Y</span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">+</span><span class="free">i</span> <span class="main">=</span> <span class="skolem">n'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span><span class="main">∈</span><span class="main">{</span><span class="free">i</span><span class="main">..</span><span class="free">j</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n'</span><span class="main">.</span> <span class="main">⟦</span><span class="skolem">n</span> <span class="main">+</span> <span class="free">i</span> <span class="main">=</span> <span class="bound">n'</span><span class="main">;</span> <span class="bound">n'</span> <span class="main">∈</span> <span class="main">{</span><span class="free">i</span><span class="main">..</span><span class="free">j</span><span class="main">}</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="skolem">thesis</span>"</span></span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> card <span class="main">{</span><span class="free">i</span><span class="main">..</span><span class="free">j</span><span class="main">}</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">&lt;</span> card <span class="free">Y</span>›</span></span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> card_image_le finite_atLeastAtMost less_le_trans<span class="main">)</span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">using</span></span> asm <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="skolem">n</span> <span class="main">∈</span> <span class="free">Y</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">+</span> <span class="free">i</span> <span class="main">=</span> <span class="skolem">n'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n'</span> <span class="main">∈</span> <span class="main">{</span><span class="free">i</span><span class="main">..</span><span class="free">j</span><span class="main">}</span>›</span></span> assms<span class="main">(</span>4<span class="main">,</span>5<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">Y</span><span class="main">.</span> <span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span>finite <span class="free">Y</span> <span class="main">⟶</span> <span class="bound">n</span> <span class="main">&lt;</span> card <span class="free">Y</span><span class="main">)</span> <span class="main">∧</span> <span class="free">g</span> <span class="bound">n</span> <span class="main">=</span> <span class="bound">x</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ballI<span class="main">)</span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="free">Y</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="free">X</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> f_img_is_subset assms<span class="main">(</span>1<span class="main">,</span>4<span class="main">)</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ordering_def imageE inf_chain_is_long long_ch_by_ord_def<span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">n</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">Y</span>›</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">∈</span><span class="main">{</span><span class="free">i</span><span class="main">..</span><span class="free">j</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> only_one_index
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="skolem">n</span> <span class="main">=</span> <span class="skolem">x</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">Y</span>›</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">,</span></span>4<span class="main"><span class="main">)</span></span> ind_ord less_trans<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span>finite <span class="free">Y</span> <span class="main">⟶</span> <span class="bound">n</span> <span class="main">&lt;</span> card <span class="free">Y</span><span class="main">)</span> <span class="main">∧</span> <span class="free">g</span> <span class="bound">n</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> conjI<span class="main">)</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">-</span><span class="free">i</span><span class="main">≥</span><span class="main">0</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">(</span><span class="skolem">n</span><span class="main">-</span><span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">n</span><span class="main">-</span><span class="free">i</span><span class="main">+</span><span class="free">i</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">(</span><span class="skolem">n</span><span class="main">-</span><span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
              <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">-</span><span class="free">i</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
              <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="skolem">n</span> <span class="main">=</span> <span class="skolem">x</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">g</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="free">i</span> <span class="main">+</span> <span class="free">i</span><span class="main">)</span>›</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="skolem">n</span><span class="main">-</span><span class="free">i</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">-</span><span class="free">i</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
              <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span><span class="main">∈</span><span class="main">{</span><span class="free">i</span><span class="main">..</span><span class="free">j</span><span class="main">}</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="skolem">n</span> <span class="main">=</span> <span class="skolem">x</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">g</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="free">i</span> <span class="main">+</span> <span class="free">i</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">Y</span> <span class="main">⟶</span> <span class="main">(</span><span class="skolem">n</span><span class="main">-</span><span class="free">i</span><span class="main">)</span> <span class="main">&lt;</span> card <span class="free">Y</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span>
              <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">Y</span>"</span></span>
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">-</span><span class="free">i</span><span class="main">&lt;</span>card <span class="free">Y</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> card_of_subchain
                <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">∈</span> <span class="main">{</span><span class="free">i</span><span class="main">..</span><span class="free">j</span><span class="main">}</span>›</span></span> assms<span class="main">(</span>1<span class="main">,</span>4<span class="main">)</span> ind_ord <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span> <span class="bound">n'</span> <span class="bound">n''</span><span class="main">.</span> <span class="main">(</span>finite <span class="free">Y</span> <span class="main">⟶</span> <span class="bound">n''</span> <span class="main">&lt;</span> card <span class="free">Y</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">n</span><span class="main">&lt;</span><span class="bound">n'</span> <span class="main">∧</span> <span class="bound">n'</span><span class="main">&lt;</span><span class="bound">n''</span> <span class="main">⟶</span> <span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">g</span> <span class="bound">n</span><span class="main">)</span><span class="main">(</span><span class="free">g</span> <span class="bound">n'</span><span class="main">)</span><span class="main">(</span><span class="free">g</span> <span class="bound">n''</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">safe</span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">Y</span>›</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">l</span> <span class="skolem">m</span> <span class="skolem">n</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span><span class="main">&lt;</span><span class="skolem">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span><span class="main">&lt;</span><span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">&lt;</span>card <span class="free">Y</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span><span class="main">+</span><span class="free">i</span><span class="main">&lt;</span><span class="skolem">m</span><span class="main">+</span><span class="free">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span><span class="main">+</span><span class="free">i</span><span class="main">&lt;</span><span class="skolem">n</span><span class="main">+</span><span class="free">i</span>"</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">m</span> <span class="main">&lt;</span> <span class="skolem">n</span>›</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="skolem">l</span><span class="main">+</span><span class="free">i</span><span class="main">)</span><span class="main">)</span><span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="skolem">m</span><span class="main">+</span><span class="free">i</span><span class="main">)</span><span class="main">)</span><span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="free">i</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> inf_chain_is_long long_ch_by_ord_def ordering_ord_ijk <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">g</span> <span class="skolem">l</span><span class="main">)</span><span class="main">(</span><span class="free">g</span> <span class="skolem">m</span><span class="main">)</span><span class="main">(</span><span class="free">g</span> <span class="skolem">n</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> long_ch_by_ord_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">0</span> <span class="main">=</span> <span class="free">f</span> <span class="free">i</span> <span class="main">∧</span> <span class="free">f</span> <span class="skolem">k</span> <span class="main">∈</span> <span class="free">Y</span> <span class="main">∧</span> <span class="free">g</span> <span class="main">(</span>card <span class="free">Y</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="free">j</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> card_of_subchain assms<span class="main">(</span>1<span class="main">,</span>4<span class="main">,</span>5<span class="main">)</span> ind_ord less_imp_le_nat 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> fin_long_chain_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> fin_long_ch_imp_fin_ch <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(*Context MinkowskiSpacetime*)</span>



<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Extensions of results to infinite chains"</span></span>
<span class="keyword1"><span class="command">context</span></span> MinkowskiSpacetime <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="TemporalOrderOnPath-i_neq_j_imp_events_neq_inf"><span class="command">lemma</span></span> i_neq_j_imp_events_neq_inf<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">f</span><span class="main">[</span><span class="main">(</span><span class="free">f</span> <span class="main">0</span><span class="main">)</span><span class="main">..]</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">≠</span><span class="free">j</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">i</span> <span class="main">≠</span> <span class="free">f</span> <span class="free">j</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="bound">i</span><span class="main">≠</span><span class="bound">j</span> <span class="main">⟶</span> <span class="free">f</span> <span class="bound">i</span> <span class="main">≠</span> <span class="free">f</span> <span class="bound">j</span>"</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">i</span><span class="main">::</span>nat<span class="main">)</span><span class="main">≤</span><span class="skolem">j</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">i</span> <span class="skolem">j</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">&lt;</span><span class="skolem">j</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">&gt;</span><span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="skolem">i</span><span class="main">)</span><span class="main">(</span><span class="free">f</span> <span class="skolem">j</span><span class="main">)</span><span class="main">(</span><span class="free">f</span> <span class="skolem">k</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">j</span>›</span></span> assms<span class="main">(</span>1<span class="main">)</span> inf_chain_is_long long_ch_by_ord_def ordering_ord_ijk <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">i</span> <span class="skolem">j</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> abc_abc_neq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="skolem">i</span><span class="main">&lt;</span><span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">=</span><span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">≤</span> <span class="skolem">j</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">i</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">=</span> <span class="skolem">j</span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">j</span> <span class="skolem">i</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">i</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> leI less_imp_le_nat<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="TemporalOrderOnPath-i_neq_j_imp_events_neq"><span class="command">lemma</span></span> i_neq_j_imp_events_neq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"long_ch_by_ord <span class="free">f</span> <span class="free">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">≠</span><span class="free">j</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">i</span><span class="main">&lt;</span>card <span class="free">X</span> <span class="main">∧</span> <span class="free">j</span><span class="main">&lt;</span>card <span class="free">X</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">i</span> <span class="main">≠</span> <span class="free">f</span> <span class="free">j</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> i_neq_j_imp_events_neq_inf indices_neq_imp_events_neq
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms get_fin_long_ch_bounds semifin_chain_def<span class="main">)</span>


<span class="keyword1" id="TemporalOrderOnPath-inf_chain_origin_unique"><span class="command">lemma</span></span> inf_chain_origin_unique<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">f</span><span class="main">[</span><span class="free">f</span> <span class="main">0</span><span class="main">..]</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">g</span><span class="main">[</span><span class="free">g</span> <span class="main">0</span><span class="main">..]</span><span class="free">X</span><span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">0</span> <span class="main">=</span> <span class="free">g</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">0</span> <span class="main">≠</span> <span class="free">g</span> <span class="main">0</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">P</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span><span class="main">∈</span><span class="free">𝒫</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span><span class="main">⊆</span><span class="skolem">P</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> semifin_chain_on_path <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="free">g</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">≠</span><span class="free">g</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> i_neq_j_imp_events_neq_inf zero_neq_one <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ordering_def <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">=</span> <span class="free">g</span> <span class="main">1</span>›</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> inf_chain_is_long long_ch_by_ord_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="free">f</span> <span class="main">0</span> <span class="main">∨</span> <span class="skolem">x</span><span class="main">≠</span><span class="free">f</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> disjE<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="free">f</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">g</span> <span class="main">0</span><span class="main">)</span><span class="main">(</span><span class="free">f</span> <span class="main">0</span><span class="main">)</span><span class="main">(</span><span class="free">g</span> <span class="numeral">2</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span><span class="main">=</span><span class="free">g</span> <span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span><span class="main">=</span><span class="free">f</span> <span class="main">0</span>›</span></span> assms<span class="main">(</span>2<span class="main">)</span> inf_chain_is_long long_ch_by_ord_def ordering_ord_ijk
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">m</span> <span class="main">=</span> <span class="free">g</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">n</span> <span class="main">=</span> <span class="free">g</span> <span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ordering_def assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> inf_chain_is_long long_ch_by_ord_def<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="skolem">m</span><span class="main">)</span><span class="main">(</span><span class="free">f</span> <span class="main">0</span><span class="main">)</span><span class="main">(</span><span class="free">f</span> <span class="skolem">n</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">g</span> <span class="main">0</span><span class="main">)</span><span class="main">(</span><span class="free">f</span> <span class="main">0</span><span class="main">)</span><span class="main">(</span><span class="free">g</span> <span class="numeral">2</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span><span class="main">≠</span><span class="skolem">n</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> abc_abc_neq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span><span class="main">&gt;</span><span class="main">0</span> <span class="main">∧</span> <span class="skolem">n</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="skolem">m</span><span class="main">)</span><span class="main">(</span><span class="free">f</span> <span class="main">0</span><span class="main">)</span><span class="main">(</span><span class="free">f</span> <span class="skolem">n</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>›</span></span> abc_abc_neq neq0_conv <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span><span class="main">&lt;</span><span class="skolem">m</span> <span class="main">∧</span> <span class="skolem">m</span><span class="main">&lt;</span><span class="skolem">n</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">0</span><span class="main">&lt;</span><span class="skolem">n</span> <span class="main">∧</span> <span class="skolem">n</span><span class="main">&lt;</span><span class="skolem">m</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">m</span> <span class="main">≠</span> <span class="skolem">n</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">`<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="skolem">m</span><span class="main">)</span><span class="main">(</span><span class="free">f</span> <span class="main">0</span><span class="main">)</span><span class="main">(</span><span class="free">f</span> <span class="skolem">n</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>`</span></span> assms<span class="main">(</span>1<span class="main">)</span> index_order3 inf_chain_is_long <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">≠</span><span class="free">f</span> <span class="main">0</span>"</span></span>

    <span class="comment1">(*Help for Sledgehammer*)</span>
    <span class="keyword1"><span class="command">have</span></span> fn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="main">∈</span> <span class="free">X</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> ordering_def assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> inf_chain_is_long long_ch_by_ord_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> gn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="free">g</span> <span class="bound">n</span> <span class="main">∈</span> <span class="free">X</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ordering_def assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> inf_chain_is_long long_ch_by_ord_def<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">g</span> <span class="main">0</span><span class="main">)</span><span class="skolem">x</span><span class="main">(</span><span class="free">f</span> <span class="main">0</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="main">0</span><span class="main">)</span><span class="main">(</span><span class="free">g</span> <span class="main">0</span><span class="main">)</span><span class="skolem">x</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">g</span> <span class="main">0</span><span class="main">)</span><span class="main">(</span><span class="free">f</span> <span class="main">0</span><span class="main">)</span><span class="skolem">x</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">g</span> <span class="main">0</span><span class="main">)</span><span class="skolem">x</span><span class="main">(</span><span class="free">f</span> <span class="main">0</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">0</span> <span class="main">≠</span> <span class="free">g</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≠</span> <span class="free">f</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≠</span> <span class="free">g</span> <span class="main">0</span>›</span></span> all_aligned_on_semifin_chain
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ordering_def <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">X</span>›</span></span> assms inf_chain_is_long long_ch_by_ord_def<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="main">0</span><span class="main">)</span><span class="main">(</span><span class="free">g</span> <span class="main">0</span><span class="main">)</span><span class="skolem">x</span><span class="main"><span class="free">]]</span></span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> abc_only_cba<span class="main">(</span>1<span class="main">,</span>3<span class="main">)</span> all_aligned_on_semifin_chain assms<span class="main">(</span>2<span class="main">)</span> fn
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span><span class="main">∈</span><span class="free">X</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span><span class="main">≠</span><span class="free">f</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span><span class="main">≠</span><span class="free">g</span> <span class="main">0</span>›</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">g</span> <span class="main">0</span><span class="main">)</span><span class="main">(</span><span class="free">f</span> <span class="main">0</span><span class="main">)</span><span class="skolem">x</span><span class="main"><span class="free">]]</span></span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> fn gn <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">X</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≠</span> <span class="free">g</span> <span class="main">0</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> abc_only_cba<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">,</span></span>4<span class="main"><span class="main">)</span></span> all_aligned_on_semifin_chain assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="skolem"><span class="skolem">m'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="skolem">m'</span> <span class="main">=</span> <span class="free">f</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> Suc <span class="skolem">m'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ordering_def assms inf_chain_is_long long_ch_by_ord_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">g</span> <span class="main">0</span><span class="main">)</span><span class="main">(</span><span class="free">f</span> <span class="main">0</span><span class="main">)</span><span class="main">(</span><span class="free">g</span> <span class="skolem">m</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_le_eq <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">0</span> <span class="main">≠</span> <span class="free">g</span> <span class="main">0</span>›</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> inf_chain_is_long lessI linorder_neqE_nat
          long_ch_by_ord_def not_le ordering_ord_ijk zero_less_Suc<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">n</span> <span class="main">=</span> <span class="free">g</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">p</span> <span class="main">=</span> <span class="free">g</span> <span class="skolem">m</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> abc_abc_neq abc_only_cba<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>4<span class="main"><span class="main">)</span></span> all_aligned_on_semifin_chain assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> gn<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span><span class="main">&lt;</span><span class="main">0</span> <span class="main">∨</span> <span class="skolem">n</span><span class="main">&lt;</span><span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> all_aligned_on_semifin_chain assms<span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">g</span> <span class="main">0</span><span class="main">)</span><span class="main">(</span><span class="free">f</span> <span class="main">0</span><span class="main">)</span><span class="main">(</span><span class="free">g</span> <span class="skolem">m</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> abc_abc_neq abc_only_cba<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>4<span class="main"><span class="main">)</span></span> fn<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="TemporalOrderOnPath-inf_chain_unique"><span class="command">lemma</span></span> inf_chain_unique<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">f</span><span class="main">[</span><span class="free">f</span> <span class="main">0</span><span class="main">..]</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">g</span><span class="main">[</span><span class="free">g</span> <span class="main">0</span><span class="main">..]</span><span class="free">X</span><span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">::</span>nat<span class="main">.</span> <span class="free">f</span> <span class="bound">i</span> <span class="main">=</span> <span class="free">g</span> <span class="bound">i</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">f</span><span class="main">[</span><span class="free">f</span> <span class="main">0</span><span class="main">..]</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">g</span><span class="main">[</span><span class="free">f</span> <span class="main">0</span><span class="main">..]</span><span class="free">X</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">::</span>nat<span class="main">.</span> <span class="free">f</span> <span class="bound">i</span> <span class="main">=</span> <span class="free">g</span> <span class="bound">i</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span><span class="main">::</span><span class="quoted">nat</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">i</span> <span class="main">=</span> <span class="free">g</span> <span class="skolem">i</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">i</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">0</span> <span class="main">=</span> <span class="free">g</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> asm<span class="main">(</span>2<span class="main">)</span> inf_chain_is_long <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">i</span> <span class="main">=</span> <span class="free">g</span> <span class="skolem">i</span>"</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">g</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="main">≠</span> <span class="free">g</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?i</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">i</span>"</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">0</span><span class="main">∈</span><span class="free">X</span> <span class="main">∧</span> <span class="free">g</span><span class="var">?i</span><span class="main">∈</span><span class="free">X</span> <span class="main">∧</span> <span class="free">f</span><span class="var">?i</span><span class="main">∈</span><span class="free">X</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ordering_def assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> inf_chain_is_long long_ch_by_ord_def<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="main">0</span><span class="main">)</span><span class="main">(</span><span class="free">f</span> <span class="var">?i</span><span class="main">)</span><span class="main">(</span><span class="free">g</span> <span class="var">?i</span><span class="main">)</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="main">0</span><span class="main">)</span><span class="main">(</span><span class="free">g</span> <span class="var">?i</span><span class="main">)</span><span class="main">(</span><span class="free">f</span> <span class="var">?i</span><span class="main">)</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="var">?i</span><span class="main">)</span><span class="main">(</span><span class="free">f</span> <span class="main">0</span><span class="main">)</span><span class="main">(</span><span class="free">g</span> <span class="var">?i</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> all_aligned_on_semifin_chain assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> i_neq_j_imp_events_neq_inf
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="free">f</span><span class="var">?i</span> <span class="main">≠</span><span class="free">g</span><span class="var">?i</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">0</span> <span class="main">=</span> <span class="free">g</span> <span class="main">0</span>›</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="main">0</span><span class="main">)</span><span class="main">(</span><span class="free">f</span> <span class="var">?i</span><span class="main">)</span><span class="main">(</span><span class="free">g</span> <span class="var">?i</span><span class="main">)</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="main">0</span><span class="main">)</span><span class="main">(</span><span class="free">g</span> <span class="var">?i</span><span class="main">)</span><span class="main">(</span><span class="free">f</span> <span class="var">?i</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> all_aligned_on_semifin_chain asm<span class="main">(</span>2<span class="main">)</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">0</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">∧</span> <span class="free">g</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">∧</span> <span class="free">f</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="main">∈</span> <span class="free">X</span>›</span></span> abc_abc_neq<span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="main">0</span><span class="main">)</span><span class="main">(</span><span class="free">f</span> <span class="skolem">i</span><span class="main">)</span><span class="main">(</span><span class="free">f</span> <span class="var">?i</span><span class="main">)</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="main">0</span><span class="main">)</span><span class="main">(</span><span class="free">g</span> <span class="skolem">i</span><span class="main">)</span><span class="main">(</span><span class="free">g</span> <span class="var">?i</span><span class="main">)</span><span class="main"><span class="free">]]</span></span><span class="main">)</span> <span class="main">∨</span> <span class="skolem">i</span><span class="main">=</span><span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> long_ch_by_ord_def ordering_ord_ijk asm<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_inject Suc_lessI Suc_less_eq inf_chain_is_long lessI zero_less_Suc<span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> disjE<span class="main">)</span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">=</span><span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">g</span> <span class="main">0</span><span class="main">)</span><span class="main">(</span><span class="free">f</span> <span class="main">1</span><span class="main">)</span><span class="main">(</span><span class="free">g</span> <span class="main">1</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
              <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="free">g</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="free">X</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">0</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">∧</span> <span class="free">g</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">∧</span> <span class="free">f</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="main">∈</span> <span class="free">X</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">m</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ordering_def assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> inf_chain_is_long long_ch_by_ord_def<span class="main">)</span>
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">m</span> <span class="main">=</span> <span class="free">g</span> <span class="main">1</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">=</span> <span class="free">g</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span><span class="main">&gt;</span><span class="main">1</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> i_neq_j_imp_events_neq_inf <span class="quoted"><span class="quoted">‹<span class="free">f</span><span class="var">?i</span> <span class="main">≠</span> <span class="free">g</span><span class="var">?i</span>›</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def Suc_lessI <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">0</span> <span class="main">=</span> <span class="free">g</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="skolem">m</span> <span class="main">=</span> <span class="skolem">x</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">=</span> <span class="free">g</span> <span class="main">1</span>›</span></span> neq0_conv<span class="main">)</span>
              <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">g</span> <span class="main">0</span><span class="main">)</span><span class="main">(</span><span class="free">f</span> <span class="main">1</span><span class="main">)</span><span class="main">(</span><span class="free">g</span> <span class="main">1</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="main">0</span><span class="main">)</span><span class="main">(</span><span class="free">f</span><span class="var">?i</span><span class="main">)</span><span class="main">(</span><span class="free">g</span><span class="var">?i</span><span class="main">)</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="main">0</span><span class="main">)</span><span class="main">(</span><span class="free">g</span><span class="var">?i</span><span class="main">)</span><span class="main">(</span><span class="free">f</span><span class="var">?i</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">0</span> <span class="main">=</span> <span class="free">g</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="skolem">m</span> <span class="main">=</span> <span class="skolem">x</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span><span class="main">=</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">=</span> <span class="free">g</span> <span class="main">1</span>›</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> gr_implies_not_zero index_order3 inf_chain_is_long order.asym<span class="main">)</span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">1</span> <span class="main">∈</span> <span class="free">X</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">0</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">∧</span> <span class="free">g</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">∧</span> <span class="free">f</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="main">∈</span> <span class="free">X</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="skolem">m'</span> <span class="main">=</span> <span class="free">f</span> <span class="main">1</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ordering_def assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> inf_chain_is_long long_ch_by_ord_def<span class="main">)</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">g</span> <span class="main">0</span><span class="main">)</span><span class="main">(</span><span class="free">g</span> <span class="skolem">m'</span><span class="main">)</span><span class="main">(</span><span class="free">g</span> <span class="main">1</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">g</span> <span class="main">0</span><span class="main">)</span><span class="main">(</span><span class="free">f</span> <span class="main">1</span><span class="main">)</span><span class="main">(</span><span class="free">g</span> <span class="main">1</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">g</span> <span class="main">0</span><span class="main">)</span><span class="main">(</span><span class="free">g</span> <span class="main">1</span><span class="main">)</span><span class="main">(</span><span class="free">g</span> <span class="skolem">m'</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m'</span> <span class="main">≠</span> <span class="main">1</span> <span class="main">∧</span> <span class="skolem">m'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">`<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">g</span> <span class="main">0</span><span class="main">)</span><span class="main">(</span><span class="free">g</span> <span class="skolem">m'</span><span class="main">)</span><span class="main">(</span><span class="free">g</span> <span class="main">1</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>`</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> abc_abc_neq<span class="main">)</span>
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m'</span><span class="main">&gt;</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">g</span> <span class="main">0</span><span class="main">)</span><span class="main">(</span><span class="free">g</span> <span class="main">1</span><span class="main">)</span><span class="main">(</span><span class="free">g</span> <span class="skolem">m'</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">g</span> <span class="main">0</span><span class="main">)</span><span class="main">(</span><span class="free">g</span> <span class="skolem">m'</span><span class="main">)</span><span class="main">(</span><span class="free">g</span> <span class="main">1</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>›</span></span> assms<span class="main">(</span>2<span class="main">)</span> index_order3 inf_chain_is_long <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">`<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">g</span> <span class="main">0</span><span class="main">)</span><span class="main">(</span><span class="free">g</span> <span class="skolem">m'</span><span class="main">)</span><span class="main">(</span><span class="free">g</span> <span class="main">1</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>`</span></span> abc_only_cba<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="main">0</span><span class="main">)</span><span class="main">(</span><span class="free">f</span> <span class="skolem">i</span><span class="main">)</span><span class="main">(</span><span class="free">f</span> <span class="var">?i</span><span class="main">)</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="main">0</span><span class="main">)</span><span class="main">(</span><span class="free">g</span> <span class="skolem">i</span><span class="main">)</span><span class="main">(</span><span class="free">g</span> <span class="var">?i</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">g</span> <span class="main">0</span><span class="main">)</span><span class="main">(</span><span class="free">f</span> <span class="var">?i</span><span class="main">)</span><span class="main">(</span><span class="free">g</span> <span class="var">?i</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
              <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="free">g</span> <span class="var">?i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="free">X</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">0</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">∧</span> <span class="free">g</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">∧</span> <span class="free">f</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="main">∈</span> <span class="free">X</span>›</span></span><span class="main">)</span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">m</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ordering_def assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> inf_chain_is_long long_ch_by_ord_def<span class="main">)</span>
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">m</span> <span class="main">=</span> <span class="free">g</span> <span class="var">?i</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">=</span> <span class="free">g</span> <span class="var">?i</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span><span class="main">&gt;</span><span class="var">?i</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> i_neq_j_imp_events_neq_inf <span class="quoted"><span class="quoted">‹<span class="free">f</span><span class="var">?i</span> <span class="main">≠</span> <span class="free">g</span><span class="var">?i</span>›</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_lessI <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="main">0</span><span class="main">)</span><span class="main">(</span><span class="free">f</span> <span class="skolem">i</span><span class="main">)</span><span class="main">(</span><span class="free">f</span> <span class="var">?i</span><span class="main">)</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="main">0</span><span class="main">)</span><span class="main">(</span><span class="free">g</span> <span class="skolem">i</span><span class="main">)</span><span class="main">(</span><span class="free">g</span> <span class="var">?i</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="skolem">i</span> <span class="main">=</span> <span class="free">g</span> <span class="skolem">i</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="skolem">m</span> <span class="main">=</span> <span class="skolem">x</span>›</span></span>
                    <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">=</span> <span class="free">g</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span>›</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> index_order3 less_nat_zero_code semifin_chain_def<span class="main">)</span>
              <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">g</span> <span class="main">0</span><span class="main">)</span><span class="main">(</span><span class="free">f</span> <span class="var">?i</span><span class="main">)</span><span class="main">(</span><span class="free">g</span> <span class="var">?i</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="main">0</span><span class="main">)</span><span class="main">(</span><span class="free">f</span><span class="var">?i</span><span class="main">)</span><span class="main">(</span><span class="free">g</span><span class="var">?i</span><span class="main">)</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="main">0</span><span class="main">)</span><span class="main">(</span><span class="free">g</span><span class="var">?i</span><span class="main">)</span><span class="main">(</span><span class="free">f</span><span class="var">?i</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">0</span> <span class="main">=</span> <span class="free">g</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="skolem">m</span> <span class="main">=</span> <span class="skolem">x</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">=</span> <span class="free">g</span> <span class="var">?i</span>›</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> gr_implies_not_zero index_order3 inf_chain_is_long order.asym<span class="main">)</span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="skolem">m</span> <span class="main">=</span> <span class="free">f</span> <span class="var">?i</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">f</span> <span class="main">0</span><span class="main">)</span><span class="main">∈</span><span class="free">X</span> <span class="main">∧</span> <span class="free">g</span><span class="var">?i</span><span class="main">∈</span><span class="free">X</span> <span class="main">∧</span> <span class="free">f</span><span class="var">?i</span><span class="main">∈</span><span class="free">X</span>›</span></span> assms<span class="main">(</span>2<span class="main">)</span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ordering_def inf_chain_is_long long_ch_by_ord_def<span class="main">)</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">g</span> <span class="skolem">i</span><span class="main">)</span><span class="main">(</span><span class="free">g</span> <span class="skolem">m</span><span class="main">)</span><span class="main">(</span><span class="free">g</span> <span class="var">?i</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> abc_acd_bcd <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="main">0</span><span class="main">)</span><span class="main">(</span><span class="free">f</span> <span class="skolem">i</span><span class="main">)</span><span class="main">(</span><span class="free">f</span><span class="var">?i</span><span class="main">)</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="main">0</span><span class="main">)</span><span class="main">(</span><span class="free">g</span> <span class="skolem">i</span><span class="main">)</span><span class="main">(</span><span class="free">g</span> <span class="var">?i</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">g</span> <span class="main">0</span><span class="main">)</span><span class="main">(</span><span class="free">f</span> <span class="var">?i</span><span class="main">)</span><span class="main">(</span><span class="free">g</span> <span class="var">?i</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>›</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">0</span> <span class="main">=</span> <span class="free">g</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="skolem">i</span> <span class="main">=</span> <span class="free">g</span> <span class="skolem">i</span>›</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">g</span> <span class="skolem">i</span><span class="main">)</span><span class="main">(</span><span class="free">g</span> <span class="var">?i</span><span class="main">)</span><span class="main">(</span><span class="free">g</span> <span class="skolem">m</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span><span class="main">&gt;</span><span class="var">?i</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">g</span> <span class="skolem">i</span><span class="main">)</span><span class="main">(</span><span class="free">g</span> <span class="skolem">m</span><span class="main">)</span><span class="main">(</span><span class="free">g</span> <span class="var">?i</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>›</span></span> assms<span class="main">(</span>2<span class="main">)</span> index_order3 inf_chain_is_long <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
              <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> inf_chain_is_long long_ch_by_ord_def ordering_ord_ijk <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">g</span> <span class="skolem">i</span><span class="main">)</span><span class="main">(</span><span class="free">g</span> <span class="skolem">m</span><span class="main">)</span><span class="main">(</span><span class="free">g</span> <span class="var">?i</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>›</span></span> abc_only_cba <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">0</span> <span class="main">=</span> <span class="free">g</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> inf_chain_origin_unique assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(*context MinkowskiSpacetime*)</span>



<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Interlude: betw4 and WLOG"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"betw4 - strict and non-strict, basic lemmas"</span></span>
<span class="keyword1"><span class="command">context</span></span> MinkowskiBetweenness <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Define additional notation for non-strict ordering - cf Schutz' monograph \cite[ p.~27]{schutz1997}.›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">nonstrict_betw_right</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">[[</span>_ _ _<span class="keyword1">⟧</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">nonstrict_betw_right</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">≡</span> <span class="main"><span class="free">[[</span></span><span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">nonstrict_betw_left</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">⟦</span>_ _ _<span class="keyword1">]]</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">nonstrict_betw_left</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">≡</span> <span class="main"><span class="free">[[</span></span><span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">nonstrict_betw_both</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="comment1">(* ("[(_ _ _)]") *)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">nonstrict_betw_both</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">≡</span> nonstrict_betw_left <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">∨</span> nonstrict_betw_right <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">betw4</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">[[</span>_ _ _ _<span class="keyword1">]]</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">betw4</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">≡</span> <span class="main"><span class="free">[[</span></span><span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="main"><span class="free">[[</span></span><span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main"><span class="free">]]</span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">nonstrict_betw_right4</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">[[</span>_ _ _ _<span class="keyword1">⟧</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">nonstrict_betw_right4</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">≡</span> betw4 <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">nonstrict_betw_left4</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">⟦</span>_ _ _ _<span class="keyword1">]]</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">nonstrict_betw_left4</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">≡</span> betw4 <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">nonstrict_betw_both4</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="comment1">(* ("[(_ _ _ _)]") *)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">nonstrict_betw_both4</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">≡</span> nonstrict_betw_left4 <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">∨</span> nonstrict_betw_right4 <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span>"</span></span>

<span class="keyword1" id="TemporalOrderOnPath-betw4_strong"><span class="command">lemma</span></span> betw4_strong<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"betw4 <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="free">d</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="free">d</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">c</span> <span class="free">d</span><span class="main"><span class="free">]]</span></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> abc_bcd_acd assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="TemporalOrderOnPath-betw4_imp_neq"><span class="command">lemma</span></span> betw4_imp_neq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"betw4 <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="free">d</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">≠</span><span class="free">b</span> <span class="main">∧</span> <span class="free">a</span><span class="main">≠</span><span class="free">c</span> <span class="main">∧</span> <span class="free">a</span><span class="main">≠</span><span class="free">d</span> <span class="main">∧</span> <span class="free">b</span><span class="main">≠</span><span class="free">c</span> <span class="main">∧</span> <span class="free">b</span><span class="main">≠</span><span class="free">d</span> <span class="main">∧</span> <span class="free">c</span><span class="main">≠</span><span class="free">d</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> abc_only_cba assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context MinkowskiBetweenness *)</span>
<span class="keyword1"><span class="command">context</span></span> MinkowskiSpacetime <span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1" id="TemporalOrderOnPath-betw4_weak"><span class="command">lemma</span></span> betw4_weak<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="free">d</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">c</span> <span class="free">d</span><span class="main"><span class="free">]]</span></span>
          <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="main"><span class="free">[[</span></span><span class="free">b</span> <span class="free">c</span> <span class="free">d</span><span class="main"><span class="free">]]</span></span>
          <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="free">d</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="main"><span class="free">[[</span></span><span class="free">b</span> <span class="free">c</span> <span class="free">d</span><span class="main"><span class="free">]]</span></span>
          <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="free">d</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="main"><span class="free">[[</span></span><span class="free">b</span> <span class="free">c</span> <span class="free">d</span><span class="main"><span class="free">]]</span></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"betw4 <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="free">d</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> abc_acd_bcd abd_bcd_abc assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="TemporalOrderOnPath-betw4_sym"><span class="command">lemma</span></span> betw4_sym<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">b</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">c</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">d</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"betw4 <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="free">d</span> <span class="main">⟷</span> betw4 <span class="free">d</span> <span class="free">c</span> <span class="free">b</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> abc_sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="TemporalOrderOnPath-abcd_dcba_only"><span class="command">lemma</span></span> abcd_dcba_only<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">b</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">c</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">d</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"betw4 <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="free">d</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>betw4 <span class="free">a</span> <span class="free">b</span> <span class="free">d</span> <span class="free">c</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>betw4 <span class="free">a</span> <span class="free">c</span> <span class="free">b</span> <span class="free">d</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>betw4 <span class="free">a</span> <span class="free">c</span> <span class="free">d</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>betw4 <span class="free">a</span> <span class="free">d</span> <span class="free">b</span> <span class="free">c</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>betw4 <span class="free">a</span> <span class="free">d</span> <span class="free">c</span> <span class="free">b</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">¬</span>betw4 <span class="free">b</span> <span class="free">a</span> <span class="free">c</span> <span class="free">d</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>betw4 <span class="free">b</span> <span class="free">a</span> <span class="free">d</span> <span class="free">c</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>betw4 <span class="free">b</span> <span class="free">c</span> <span class="free">a</span> <span class="free">d</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>betw4 <span class="free">b</span> <span class="free">c</span> <span class="free">d</span> <span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>betw4 <span class="free">b</span> <span class="free">d</span> <span class="free">c</span> <span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>betw4 <span class="free">b</span> <span class="free">d</span> <span class="free">a</span> <span class="free">c</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">¬</span>betw4 <span class="free">c</span> <span class="free">a</span> <span class="free">b</span> <span class="free">d</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>betw4 <span class="free">c</span> <span class="free">a</span> <span class="free">d</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>betw4 <span class="free">c</span> <span class="free">b</span> <span class="free">a</span> <span class="free">d</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>betw4 <span class="free">c</span> <span class="free">b</span> <span class="free">d</span> <span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>betw4 <span class="free">c</span> <span class="free">d</span> <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>betw4 <span class="free">c</span> <span class="free">d</span> <span class="free">b</span> <span class="free">a</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">¬</span>betw4 <span class="free">d</span> <span class="free">a</span> <span class="free">b</span> <span class="free">c</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>betw4 <span class="free">d</span> <span class="free">a</span> <span class="free">c</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>betw4 <span class="free">d</span> <span class="free">b</span> <span class="free">a</span> <span class="free">c</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>betw4 <span class="free">d</span> <span class="free">b</span> <span class="free">c</span> <span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>betw4 <span class="free">d</span> <span class="free">c</span> <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> abc_only_cba assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span> 

<span class="keyword1" id="TemporalOrderOnPath-some_betw4a"><span class="command">lemma</span></span> some_betw4a<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">b</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">c</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">d</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">P</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span><span class="main">∈</span><span class="free">𝒫</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">∈</span><span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">∈</span><span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">∈</span><span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span><span class="main">∈</span><span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">≠</span><span class="free">b</span> <span class="main">∧</span> <span class="free">a</span><span class="main">≠</span><span class="free">c</span> <span class="main">∧</span> <span class="free">a</span><span class="main">≠</span><span class="free">d</span> <span class="main">∧</span> <span class="free">b</span><span class="main">≠</span><span class="free">c</span> <span class="main">∧</span> <span class="free">b</span><span class="main">≠</span><span class="free">d</span> <span class="main">∧</span> <span class="free">c</span><span class="main">≠</span><span class="free">d</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>betw4 <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="free">d</span> <span class="main">∨</span> betw4 <span class="free">a</span> <span class="free">b</span> <span class="free">d</span> <span class="free">c</span> <span class="main">∨</span> betw4 <span class="free">a</span> <span class="free">c</span> <span class="free">b</span> <span class="free">d</span> <span class="main">∨</span> betw4 <span class="free">a</span> <span class="free">c</span> <span class="free">d</span> <span class="free">b</span> <span class="main">∨</span> betw4 <span class="free">a</span> <span class="free">d</span> <span class="free">b</span> <span class="free">c</span> <span class="main">∨</span> betw4 <span class="free">a</span> <span class="free">d</span> <span class="free">c</span> <span class="free">b</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"betw4 <span class="free">b</span> <span class="free">a</span> <span class="free">c</span> <span class="free">d</span> <span class="main">∨</span> betw4 <span class="free">b</span> <span class="free">a</span> <span class="free">d</span> <span class="free">c</span> <span class="main">∨</span> betw4 <span class="free">b</span> <span class="free">c</span> <span class="free">a</span> <span class="free">d</span> <span class="main">∨</span> betw4 <span class="free">b</span> <span class="free">d</span> <span class="free">a</span> <span class="free">c</span> <span class="main">∨</span> betw4 <span class="free">c</span> <span class="free">a</span> <span class="free">b</span> <span class="free">d</span> <span class="main">∨</span> betw4 <span class="free">c</span> <span class="free">b</span> <span class="free">a</span> <span class="free">d</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> abc_bcd_acd abc_sym abd_bcd_abc assms some_betw_xor<span class="main">)</span>

<span class="keyword1" id="TemporalOrderOnPath-some_betw4b"><span class="command">lemma</span></span> some_betw4b<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">b</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">c</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">d</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">P</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span><span class="main">∈</span><span class="free">𝒫</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">∈</span><span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">∈</span><span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">∈</span><span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span><span class="main">∈</span><span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">≠</span><span class="free">b</span> <span class="main">∧</span> <span class="free">a</span><span class="main">≠</span><span class="free">c</span> <span class="main">∧</span> <span class="free">a</span><span class="main">≠</span><span class="free">d</span> <span class="main">∧</span> <span class="free">b</span><span class="main">≠</span><span class="free">c</span> <span class="main">∧</span> <span class="free">b</span><span class="main">≠</span><span class="free">d</span> <span class="main">∧</span> <span class="free">c</span><span class="main">≠</span><span class="free">d</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>betw4 <span class="free">b</span> <span class="free">a</span> <span class="free">c</span> <span class="free">d</span> <span class="main">∨</span> betw4 <span class="free">b</span> <span class="free">a</span> <span class="free">d</span> <span class="free">c</span> <span class="main">∨</span> betw4 <span class="free">b</span> <span class="free">c</span> <span class="free">a</span> <span class="free">d</span> <span class="main">∨</span> betw4 <span class="free">b</span> <span class="free">d</span> <span class="free">a</span> <span class="free">c</span> <span class="main">∨</span> betw4 <span class="free">c</span> <span class="free">a</span> <span class="free">b</span> <span class="free">d</span> <span class="main">∨</span> betw4 <span class="free">c</span> <span class="free">b</span> <span class="free">a</span> <span class="free">d</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"betw4 <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="free">d</span> <span class="main">∨</span> betw4 <span class="free">a</span> <span class="free">b</span> <span class="free">d</span> <span class="free">c</span> <span class="main">∨</span> betw4 <span class="free">a</span> <span class="free">c</span> <span class="free">b</span> <span class="free">d</span> <span class="main">∨</span> betw4 <span class="free">a</span> <span class="free">c</span> <span class="free">d</span> <span class="free">b</span> <span class="main">∨</span> betw4 <span class="free">a</span> <span class="free">d</span> <span class="free">b</span> <span class="free">c</span> <span class="main">∨</span> betw4 <span class="free">a</span> <span class="free">d</span> <span class="free">c</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> abc_bcd_acd abc_sym abd_bcd_abc assms some_betw_xor<span class="main">)</span>


<span class="keyword1" id="TemporalOrderOnPath-abd_acd_abcdacbd"><span class="command">lemma</span></span> abd_acd_abcdacbd<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">b</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">c</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">d</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> abd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="free">d</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> acd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">c</span> <span class="free">d</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">≠</span><span class="free">c</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"betw4 <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="free">d</span> <span class="main">∨</span> betw4 <span class="free">a</span> <span class="free">c</span> <span class="free">b</span> <span class="free">d</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">P</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span><span class="main">∈</span><span class="free">𝒫</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">∈</span><span class="skolem">P</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">∈</span><span class="skolem">P</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span><span class="main">∈</span><span class="skolem">P</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> abc_ex_path abd <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">∈</span><span class="skolem">P</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">P</span> <span class="main">∈</span> <span class="free">𝒫</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> <span class="skolem">P</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">d</span> <span class="main">∈</span> <span class="skolem">P</span>›</span></span> abc_abc_neq acd betw_b_in_path <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main"><span class="free">[[</span></span><span class="free">b</span> <span class="free">d</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> abc_sym abcd_dcba_only<span class="main">(</span>5<span class="main">)</span> abd acd <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">b</span> <span class="free">c</span> <span class="free">d</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">c</span> <span class="free">b</span> <span class="free">d</span><span class="main"><span class="free">]]</span></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> abc_abc_neq abc_sym abd acd assms<span class="main">(</span>3<span class="main">)</span> some_betw
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">P</span> <span class="main">∈</span> <span class="free">𝒫</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">∈</span> <span class="skolem">P</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span> <span class="main">∈</span> <span class="skolem">P</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">d</span> <span class="main">∈</span> <span class="skolem">P</span>›</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> abd acd betw4_weak <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(*context MinkowskiSpacetime*)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"WLOG for two general symmetric relations of two elements on a single path"</span></span>
<span class="keyword1"><span class="command">context</span></span> MinkowskiBetweenness <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  This first one is really just trying to get a hang of how to write these things.
  If you have a relation that does not care which way round the ``endpoints'' (if $Q$ is the
  interval-relation) go, then anything you want to prove about both undistinguished endpoints,
  follows from a proof involving a single endpoint.
›</span></span>

<span class="keyword1" id="TemporalOrderOnPath-wlog_sym_element"><span class="command">lemma</span></span> wlog_sym_element<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> symmetric_rel<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">I</span> <span class="bound">a</span> <span class="bound">b</span> <span class="main">⟹</span> <span class="free">Q</span> <span class="bound">I</span> <span class="bound">b</span> <span class="bound">a</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> one_endpoint<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">x</span> <span class="bound">I</span><span class="main">.</span> <span class="main">⟦</span><span class="free">Q</span> <span class="bound">I</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">;</span> <span class="bound">x</span><span class="main">=</span><span class="bound">a</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">x</span> <span class="bound">I</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> other_endpoint<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">x</span> <span class="bound">I</span><span class="main">.</span> <span class="main">⟦</span><span class="free">Q</span> <span class="bound">I</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">;</span> <span class="bound">x</span><span class="main">=</span><span class="bound">b</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">x</span> <span class="bound">I</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  This one gives the most pertinent case split: a proof involving e.g. an element of an interval
  must consider the edge case and the inside case.
›</span></span>
<span class="keyword1" id="TemporalOrderOnPath-wlog_element"><span class="command">lemma</span></span> wlog_element<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> symmetric_rel<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">I</span> <span class="bound">a</span> <span class="bound">b</span> <span class="main">⟹</span> <span class="free">Q</span> <span class="bound">I</span> <span class="bound">b</span> <span class="bound">a</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> one_endpoint<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">x</span> <span class="bound">I</span><span class="main">.</span> <span class="main">⟦</span><span class="free">Q</span> <span class="bound">I</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">;</span> <span class="bound">x</span><span class="main">=</span><span class="bound">a</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">x</span> <span class="bound">I</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> neither_endpoint<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">x</span> <span class="bound">I</span><span class="main">.</span> <span class="main">⟦</span><span class="free">Q</span> <span class="bound">I</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">;</span> <span class="bound">x</span><span class="main">∈</span><span class="bound">I</span><span class="main">;</span> <span class="main">(</span><span class="bound">x</span><span class="main">≠</span><span class="bound">a</span> <span class="main">∧</span> <span class="bound">x</span><span class="main">≠</span><span class="bound">b</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">x</span> <span class="bound">I</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> any_element<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">I</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">x</span><span class="main">∈</span><span class="bound">I</span><span class="main">;</span> <span class="main">(</span><span class="main">∃</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">I</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">x</span> <span class="bound">I</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Summary of the two above. Use for early case splitting in proofs.
  Doesn't need $P$ to be symmetric - the context in the conclusion is explicitly symmetric.
›</span></span>

<span class="keyword1" id="TemporalOrderOnPath-wlog_two_sets_element"><span class="command">lemma</span></span> wlog_two_sets_element<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> symmetric_Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">I</span> <span class="bound">a</span> <span class="bound">b</span> <span class="main">⟹</span> <span class="free">Q</span> <span class="bound">I</span> <span class="bound">b</span> <span class="bound">a</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> case_split<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">d</span> <span class="bound">x</span> <span class="bound">I</span> <span class="bound">J</span><span class="main">.</span> <span class="main">⟦</span><span class="free">Q</span> <span class="bound">I</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">;</span> <span class="free">Q</span> <span class="bound">J</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">⟧</span> <span class="main">⟹</span>
              <span class="main">(</span><span class="bound">x</span><span class="main">=</span><span class="bound">a</span> <span class="main">∨</span> <span class="bound">x</span><span class="main">=</span><span class="bound">c</span> <span class="main">⟶</span> <span class="free">P</span> <span class="bound">x</span> <span class="bound">I</span> <span class="bound">J</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">¬</span><span class="main">(</span><span class="bound">x</span><span class="main">=</span><span class="bound">a</span> <span class="main">∨</span> <span class="bound">x</span><span class="main">=</span><span class="bound">b</span> <span class="main">∨</span> <span class="bound">x</span><span class="main">=</span><span class="bound">c</span> <span class="main">∨</span> <span class="bound">x</span><span class="main">=</span><span class="bound">d</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">P</span> <span class="bound">x</span> <span class="bound">I</span> <span class="bound">J</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">I</span> <span class="bound">J</span><span class="main">.</span> <span class="main">⟦</span><span class="main">∃</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">I</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">;</span> <span class="main">∃</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">J</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">x</span> <span class="bound">I</span> <span class="bound">J</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> case_split symmetric_Q<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Now we start on the actual result of interest. First we assume the events are all distinct,
  and we deal with the degenerate possibilities after.
›</span></span>

<span class="keyword1" id="TemporalOrderOnPath-wlog_endpoints_distinct1"><span class="command">lemma</span></span> wlog_endpoints_distinct1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> symmetric_Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">I</span> <span class="bound">a</span> <span class="bound">b</span> <span class="main">⟹</span> <span class="free">Q</span> <span class="bound">I</span> <span class="bound">b</span> <span class="bound">a</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">I</span> <span class="bound">J</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">.</span> <span class="main">⟦</span><span class="free">Q</span> <span class="bound">I</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">;</span> <span class="free">Q</span> <span class="bound">J</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">;</span> betw4 <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">I</span> <span class="bound">J</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">I</span> <span class="bound">J</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">.</span> <span class="main">⟦</span><span class="free">Q</span> <span class="bound">I</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">;</span> <span class="free">Q</span> <span class="bound">J</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">;</span>
              betw4 <span class="bound">b</span> <span class="bound">a</span> <span class="bound">c</span> <span class="bound">d</span> <span class="main">∨</span> betw4 <span class="bound">a</span> <span class="bound">b</span> <span class="bound">d</span> <span class="bound">c</span> <span class="main">∨</span> betw4 <span class="bound">b</span> <span class="bound">a</span> <span class="bound">d</span> <span class="bound">c</span> <span class="main">∨</span> betw4 <span class="bound">d</span> <span class="bound">c</span> <span class="bound">b</span> <span class="bound">a</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">I</span> <span class="bound">J</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> abc_sym assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> symmetric_Q<span class="main">)</span>

<span class="keyword1" id="TemporalOrderOnPath-wlog_endpoints_distinct2"><span class="command">lemma</span></span> wlog_endpoints_distinct2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> symmetric_Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">I</span> <span class="bound">a</span> <span class="bound">b</span> <span class="main">⟹</span> <span class="free">Q</span> <span class="bound">I</span> <span class="bound">b</span> <span class="bound">a</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">I</span> <span class="bound">J</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">.</span> <span class="main">⟦</span><span class="free">Q</span> <span class="bound">I</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">;</span> <span class="free">Q</span> <span class="bound">J</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">;</span> betw4 <span class="bound">a</span> <span class="bound">c</span> <span class="bound">b</span> <span class="bound">d</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">I</span> <span class="bound">J</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">I</span> <span class="bound">J</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">.</span> <span class="main">⟦</span><span class="free">Q</span> <span class="bound">I</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">;</span> <span class="free">Q</span> <span class="bound">J</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">;</span>
              betw4 <span class="bound">b</span> <span class="bound">c</span> <span class="bound">a</span> <span class="bound">d</span> <span class="main">∨</span> betw4 <span class="bound">a</span> <span class="bound">d</span> <span class="bound">b</span> <span class="bound">c</span> <span class="main">∨</span> betw4 <span class="bound">b</span> <span class="bound">d</span> <span class="bound">a</span> <span class="bound">c</span> <span class="main">∨</span> betw4 <span class="bound">d</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">a</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">I</span> <span class="bound">J</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> abc_sym assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> symmetric_Q<span class="main">)</span>

<span class="keyword1" id="TemporalOrderOnPath-wlog_endpoints_distinct3"><span class="command">lemma</span></span> wlog_endpoints_distinct3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> symmetric_Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">I</span> <span class="bound">a</span> <span class="bound">b</span> <span class="main">⟹</span> <span class="free">Q</span> <span class="bound">I</span> <span class="bound">b</span> <span class="bound">a</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> symmetric_P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">I</span> <span class="bound">J</span><span class="main">.</span> <span class="main">⟦</span><span class="main">∃</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">I</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">;</span> <span class="main">∃</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">J</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">;</span> <span class="free">P</span> <span class="bound">I</span> <span class="bound">J</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">J</span> <span class="bound">I</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">I</span> <span class="bound">J</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">.</span> <span class="main">⟦</span><span class="free">Q</span> <span class="bound">I</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">;</span> <span class="free">Q</span> <span class="bound">J</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">;</span> betw4 <span class="bound">a</span> <span class="bound">c</span> <span class="bound">d</span> <span class="bound">b</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">I</span> <span class="bound">J</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">I</span> <span class="bound">J</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">.</span> <span class="main">⟦</span><span class="free">Q</span> <span class="bound">I</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">;</span> <span class="free">Q</span> <span class="bound">J</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">;</span>
              betw4 <span class="bound">a</span> <span class="bound">d</span> <span class="bound">c</span> <span class="bound">b</span> <span class="main">∨</span> betw4 <span class="bound">b</span> <span class="bound">c</span> <span class="bound">d</span> <span class="bound">a</span> <span class="main">∨</span> betw4 <span class="bound">b</span> <span class="bound">d</span> <span class="bound">c</span> <span class="bound">a</span> <span class="main">∨</span> betw4 <span class="bound">c</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">d</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">I</span> <span class="bound">J</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> MinkowskiSpacetime<span class="main">)</span> wlog_endpoints_distinct4<span class="main">:</span>
    <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">Q</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> set<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="comment1">(* cf `I = interval a b` *)</span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="free">P</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> set<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> set<span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="free">A</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> set<span class="main">)</span>"</span></span> <span class="comment1">(* the path that takes the role of the real line *)</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> path_A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">∈</span><span class="free">𝒫</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> symmetric_Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">I</span> <span class="bound">a</span> <span class="bound">b</span> <span class="main">⟹</span> <span class="free">Q</span> <span class="bound">I</span> <span class="bound">b</span> <span class="bound">a</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> Q_implies_path<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">I</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">I</span><span class="main">⊆</span><span class="free">A</span><span class="main">;</span> <span class="free">Q</span> <span class="bound">I</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="bound">b</span><span class="main">∈</span><span class="free">A</span> <span class="main">∧</span> <span class="bound">a</span><span class="main">∈</span><span class="free">A</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> symmetric_P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">I</span> <span class="bound">J</span><span class="main">.</span> <span class="main">⟦</span><span class="main">∃</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">I</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">;</span> <span class="main">∃</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">J</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">;</span> <span class="free">P</span> <span class="bound">I</span> <span class="bound">J</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">J</span> <span class="bound">I</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">I</span> <span class="bound">J</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">.</span>
          <span class="main">⟦</span><span class="free">Q</span> <span class="bound">I</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">;</span> <span class="free">Q</span> <span class="bound">J</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">;</span> <span class="bound">I</span><span class="main">⊆</span><span class="free">A</span><span class="main">;</span> <span class="bound">J</span><span class="main">⊆</span><span class="free">A</span><span class="main">;</span> betw4 <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">d</span> <span class="main">∨</span> betw4 <span class="bound">a</span> <span class="bound">c</span> <span class="bound">b</span> <span class="bound">d</span> <span class="main">∨</span> betw4 <span class="bound">a</span> <span class="bound">c</span> <span class="bound">d</span> <span class="bound">b</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">I</span> <span class="bound">J</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">I</span> <span class="bound">J</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">.</span> <span class="main">⟦</span><span class="free">Q</span> <span class="bound">I</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">;</span> <span class="free">Q</span> <span class="bound">J</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">;</span> <span class="bound">I</span><span class="main">⊆</span><span class="free">A</span><span class="main">;</span> <span class="bound">J</span><span class="main">⊆</span><span class="free">A</span><span class="main">;</span>
                <span class="bound">a</span><span class="main">≠</span><span class="bound">b</span> <span class="main">∧</span> <span class="bound">a</span><span class="main">≠</span><span class="bound">c</span> <span class="main">∧</span> <span class="bound">a</span><span class="main">≠</span><span class="bound">d</span> <span class="main">∧</span> <span class="bound">b</span><span class="main">≠</span><span class="bound">c</span> <span class="main">∧</span> <span class="bound">b</span><span class="main">≠</span><span class="bound">d</span> <span class="main">∧</span> <span class="bound">c</span><span class="main">≠</span><span class="bound">d</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">I</span> <span class="bound">J</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">I</span> <span class="skolem">J</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">d</span>
  <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="skolem">I</span> <span class="skolem">a</span> <span class="skolem">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="skolem">J</span> <span class="skolem">c</span> <span class="skolem">d</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">I</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">J</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span>
              <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">≠</span><span class="skolem">b</span> <span class="main">∧</span> <span class="skolem">a</span><span class="main">≠</span><span class="skolem">c</span> <span class="main">∧</span> <span class="skolem">a</span><span class="main">≠</span><span class="skolem">d</span> <span class="main">∧</span> <span class="skolem">b</span><span class="main">≠</span><span class="skolem">c</span> <span class="main">∧</span> <span class="skolem">b</span><span class="main">≠</span><span class="skolem">d</span> <span class="main">∧</span> <span class="skolem">c</span><span class="main">≠</span><span class="skolem">d</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> endpoints_on_path<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">∈</span><span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">∈</span><span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">∈</span><span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">∈</span><span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Q_implies_path asm <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">I</span> <span class="skolem">J</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span> <span class="comment1">(* have to split like this, because the full some_betw4 is too large for Isabelle *)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"betw4 <span class="skolem">b</span> <span class="skolem">a</span> <span class="skolem">c</span> <span class="skolem">d</span> <span class="main">∨</span> betw4 <span class="skolem">b</span> <span class="skolem">a</span> <span class="skolem">d</span> <span class="skolem">c</span> <span class="main">∨</span> betw4 <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">a</span> <span class="skolem">d</span> <span class="main">∨</span>
            betw4 <span class="skolem">b</span> <span class="skolem">d</span> <span class="skolem">a</span> <span class="skolem">c</span> <span class="main">∨</span> betw4 <span class="skolem">c</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">d</span> <span class="main">∨</span> betw4 <span class="skolem">c</span> <span class="skolem">b</span> <span class="skolem">a</span> <span class="skolem">d</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"betw4 <span class="skolem">b</span> <span class="skolem">a</span> <span class="skolem">c</span> <span class="skolem">d</span>"</span></span><span class="main">|</span><span class="quoted"><span class="quoted">"betw4 <span class="skolem">b</span> <span class="skolem">a</span> <span class="skolem">d</span> <span class="skolem">c</span>"</span></span><span class="main">|</span><span class="quoted"><span class="quoted">"betw4 <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">a</span> <span class="skolem">d</span>"</span></span><span class="main">|</span>
                  <span class="quoted"><span class="quoted">"betw4 <span class="skolem">b</span> <span class="skolem">d</span> <span class="skolem">a</span> <span class="skolem">c</span>"</span></span><span class="main">|</span><span class="quoted"><span class="quoted">"betw4 <span class="skolem">c</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">d</span>"</span></span><span class="main">|</span><span class="quoted"><span class="quoted">"betw4 <span class="skolem">c</span> <span class="skolem">b</span> <span class="skolem">a</span> <span class="skolem">d</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">I</span> <span class="skolem">J</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span><span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> asm<span class="main"><span class="main">(</span></span>1-4<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> symmetric_Q<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> asm<span class="main"><span class="main">(</span></span>1-4<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">,</span></span>5<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> asm<span class="main"><span class="main">(</span></span>1-4<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">,</span></span>4<span class="main"><span class="main">,</span></span>5<span class="main"><span class="main">)</span></span> symmetric_Q<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>betw4 <span class="skolem">b</span> <span class="skolem">a</span> <span class="skolem">c</span> <span class="skolem">d</span> <span class="main">∨</span> betw4 <span class="skolem">b</span> <span class="skolem">a</span> <span class="skolem">d</span> <span class="skolem">c</span> <span class="main">∨</span> betw4 <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">a</span> <span class="skolem">d</span> <span class="main">∨</span>
              betw4 <span class="skolem">b</span> <span class="skolem">d</span> <span class="skolem">a</span> <span class="skolem">c</span> <span class="main">∨</span> betw4 <span class="skolem">c</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">d</span> <span class="main">∨</span> betw4 <span class="skolem">c</span> <span class="skolem">b</span> <span class="skolem">a</span> <span class="skolem">d</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"betw4 <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">d</span> <span class="main">∨</span> betw4 <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">d</span> <span class="skolem">c</span> <span class="main">∨</span> betw4 <span class="skolem">a</span> <span class="skolem">c</span> <span class="skolem">b</span> <span class="skolem">d</span> <span class="main">∨</span>
           betw4 <span class="skolem">a</span> <span class="skolem">c</span> <span class="skolem">d</span> <span class="skolem">b</span> <span class="main">∨</span> betw4 <span class="skolem">a</span> <span class="skolem">d</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="main">∨</span> betw4 <span class="skolem">a</span> <span class="skolem">d</span> <span class="skolem">c</span> <span class="skolem">b</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> some_betw4b <span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">A</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> c<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> d<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">d</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">using</span></span> endpoints_on_path asm path_A <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"betw4 <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">d</span>"</span></span><span class="main">|</span><span class="quoted"><span class="quoted">"betw4 <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">d</span> <span class="skolem">c</span>"</span></span><span class="main">|</span><span class="quoted"><span class="quoted">"betw4 <span class="skolem">a</span> <span class="skolem">c</span> <span class="skolem">b</span> <span class="skolem">d</span>"</span></span><span class="main">|</span>
                  <span class="quoted"><span class="quoted">"betw4 <span class="skolem">a</span> <span class="skolem">c</span> <span class="skolem">d</span> <span class="skolem">b</span>"</span></span><span class="main">|</span><span class="quoted"><span class="quoted">"betw4 <span class="skolem">a</span> <span class="skolem">d</span> <span class="skolem">b</span> <span class="skolem">c</span>"</span></span><span class="main">|</span><span class="quoted"><span class="quoted">"betw4 <span class="skolem">a</span> <span class="skolem">d</span> <span class="skolem">c</span> <span class="skolem">b</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">I</span> <span class="skolem">J</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> asm<span class="main"><span class="main">(</span></span>1-4<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> symmetric_Q<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> MinkowskiSpacetime<span class="main">)</span> wlog_endpoints_distinct'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∈</span> <span class="free">𝒫</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">I</span> <span class="bound">a</span> <span class="bound">b</span> <span class="main">⟹</span> <span class="free">Q</span> <span class="bound">I</span> <span class="bound">b</span> <span class="bound">a</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">I</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">I</span> <span class="main">⊆</span> <span class="free">A</span><span class="main">;</span> <span class="free">Q</span> <span class="bound">I</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">I</span> <span class="bound">J</span><span class="main">.</span> <span class="main">⟦</span><span class="main">∃</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">I</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">;</span> <span class="main">∃</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">J</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">;</span> <span class="free">P</span> <span class="bound">I</span> <span class="bound">J</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">J</span> <span class="bound">I</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">I</span> <span class="bound">J</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">.</span>
          <span class="main">⟦</span><span class="free">Q</span> <span class="bound">I</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">;</span> <span class="free">Q</span> <span class="bound">J</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">;</span> <span class="bound">I</span><span class="main">⊆</span><span class="free">A</span><span class="main">;</span> <span class="bound">J</span><span class="main">⊆</span><span class="free">A</span><span class="main">;</span> betw4 <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">d</span> <span class="main">∨</span> betw4 <span class="bound">a</span> <span class="bound">c</span> <span class="bound">b</span> <span class="bound">d</span> <span class="main">∨</span> betw4 <span class="bound">a</span> <span class="bound">c</span> <span class="bound">d</span> <span class="bound">b</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">I</span> <span class="bound">J</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="free">I</span> <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="comment1">(* Is it better style to have these assumptions first, or last like this? *)</span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="free">J</span> <span class="free">c</span> <span class="free">d</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">J</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">c</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">d</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≠</span> <span class="free">c</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≠</span> <span class="free">d</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">≠</span> <span class="free">d</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">I</span> <span class="free">J</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span> 
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">I</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">I</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">I</span> <span class="bound">J</span><span class="main">.</span> <span class="main">⟦</span><span class="var">?R</span> <span class="bound">I</span><span class="main">;</span> <span class="var">?R</span> <span class="bound">J</span><span class="main">;</span> <span class="free">P</span> <span class="bound">I</span> <span class="bound">J</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">J</span> <span class="bound">I</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> wlog_endpoints_distinct4
      <span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">P</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> Q<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">Q</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> A<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">A</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> I<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">I</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> J<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">J</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">a</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">b</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> c<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">c</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> d<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">d</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> assms<span class="main"><span class="main">(</span></span>1-3<span class="main"><span class="main">,</span></span>5-<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> MinkowskiSpacetime<span class="main">)</span> wlog_endpoints_distinct<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> path_A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">∈</span><span class="free">𝒫</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> symmetric_Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">I</span> <span class="bound">a</span> <span class="bound">b</span> <span class="main">⟹</span> <span class="free">Q</span> <span class="bound">I</span> <span class="bound">b</span> <span class="bound">a</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> Q_implies_path<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">I</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">I</span><span class="main">⊆</span><span class="free">A</span><span class="main">;</span> <span class="free">Q</span> <span class="bound">I</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="bound">b</span><span class="main">∈</span><span class="free">A</span> <span class="main">∧</span> <span class="bound">a</span><span class="main">∈</span><span class="free">A</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> symmetric_P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">I</span> <span class="bound">J</span><span class="main">.</span> <span class="main">⟦</span><span class="main">∃</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">I</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">;</span> <span class="main">∃</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">J</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">;</span> <span class="free">P</span> <span class="bound">I</span> <span class="bound">J</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">J</span> <span class="bound">I</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">I</span> <span class="bound">J</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">.</span>
          <span class="main">⟦</span><span class="free">Q</span> <span class="bound">I</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">;</span> <span class="free">Q</span> <span class="bound">J</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">;</span> <span class="bound">I</span><span class="main">⊆</span><span class="free">A</span><span class="main">;</span> <span class="bound">J</span><span class="main">⊆</span><span class="free">A</span><span class="main">;</span> betw4 <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">d</span> <span class="main">∨</span> betw4 <span class="bound">a</span> <span class="bound">c</span> <span class="bound">b</span> <span class="bound">d</span> <span class="main">∨</span> betw4 <span class="bound">a</span> <span class="bound">c</span> <span class="bound">d</span> <span class="bound">b</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">I</span> <span class="bound">J</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">I</span> <span class="bound">J</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">.</span> <span class="main">⟦</span><span class="free">Q</span> <span class="bound">I</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">;</span> <span class="free">Q</span> <span class="bound">J</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">;</span> <span class="bound">I</span><span class="main">⊆</span><span class="free">A</span><span class="main">;</span> <span class="bound">J</span><span class="main">⊆</span><span class="free">A</span><span class="main">;</span>
              <span class="bound">a</span><span class="main">≠</span><span class="bound">b</span> <span class="main">∧</span> <span class="bound">a</span><span class="main">≠</span><span class="bound">c</span> <span class="main">∧</span> <span class="bound">a</span><span class="main">≠</span><span class="bound">d</span> <span class="main">∧</span> <span class="bound">b</span><span class="main">≠</span><span class="bound">c</span> <span class="main">∧</span> <span class="bound">b</span><span class="main">≠</span><span class="bound">d</span> <span class="main">∧</span> <span class="bound">c</span><span class="main">≠</span><span class="bound">d</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">I</span> <span class="bound">J</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> ccfv_SIG<span class="main"><span class="main">)</span></span> assms some_betw4b<span class="main">)</span>


<span class="keyword1" id="TemporalOrderOnPath-wlog_endpoints_degenerate1"><span class="command">lemma</span></span> wlog_endpoints_degenerate1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> symmetric_Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">I</span> <span class="bound">a</span> <span class="bound">b</span> <span class="main">⟹</span> <span class="free">Q</span> <span class="bound">I</span> <span class="bound">b</span> <span class="bound">a</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> symmetric_P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">I</span> <span class="bound">J</span><span class="main">.</span> <span class="main">⟦</span><span class="main">∃</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">I</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">;</span> <span class="main">∃</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">I</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">;</span> <span class="free">P</span> <span class="bound">I</span> <span class="bound">J</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">J</span> <span class="bound">I</span>"</span></span>
          <span class="comment1">(* two singleton intervals *)</span>
      <span class="keyword2"><span class="keyword">and</span></span> two<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">I</span> <span class="bound">J</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">.</span> <span class="main">⟦</span><span class="free">Q</span> <span class="bound">I</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">;</span> <span class="free">Q</span> <span class="bound">J</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">;</span>
                  <span class="main">(</span><span class="bound">a</span><span class="main">=</span><span class="bound">b</span> <span class="main">∧</span> <span class="bound">b</span><span class="main">=</span><span class="bound">c</span> <span class="main">∧</span> <span class="bound">c</span><span class="main">=</span><span class="bound">d</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="bound">a</span><span class="main">=</span><span class="bound">b</span> <span class="main">∧</span> <span class="bound">b</span><span class="main">≠</span><span class="bound">c</span> <span class="main">∧</span> <span class="bound">c</span><span class="main">=</span><span class="bound">d</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">I</span> <span class="bound">J</span>"</span></span>
          <span class="comment1">(* one singleton interval *)</span>
      <span class="keyword2"><span class="keyword">and</span></span> one<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">I</span> <span class="bound">J</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">.</span> <span class="main">⟦</span><span class="free">Q</span> <span class="bound">I</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">;</span> <span class="free">Q</span> <span class="bound">J</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">;</span>
                  <span class="main">(</span><span class="bound">a</span><span class="main">=</span><span class="bound">b</span> <span class="main">∧</span> <span class="bound">b</span><span class="main">=</span><span class="bound">c</span> <span class="main">∧</span> <span class="bound">c</span><span class="main">≠</span><span class="bound">d</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="bound">a</span><span class="main">=</span><span class="bound">b</span> <span class="main">∧</span> <span class="bound">b</span><span class="main">≠</span><span class="bound">c</span> <span class="main">∧</span> <span class="bound">c</span><span class="main">≠</span><span class="bound">d</span> <span class="main">∧</span> <span class="bound">a</span><span class="main">≠</span><span class="bound">d</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">I</span> <span class="bound">J</span>"</span></span>
          <span class="comment1">(* no singleton interval - the all-distinct case is a separate theorem *)</span>
      <span class="keyword2"><span class="keyword">and</span></span> no<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">I</span> <span class="bound">J</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">.</span> <span class="main">⟦</span><span class="free">Q</span> <span class="bound">I</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">;</span> <span class="free">Q</span> <span class="bound">J</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">;</span>
                  <span class="main">(</span><span class="bound">a</span><span class="main">≠</span><span class="bound">b</span> <span class="main">∧</span> <span class="bound">b</span><span class="main">≠</span><span class="bound">c</span> <span class="main">∧</span> <span class="bound">c</span><span class="main">≠</span><span class="bound">d</span> <span class="main">∧</span> <span class="bound">a</span><span class="main">=</span><span class="bound">d</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="bound">a</span><span class="main">≠</span><span class="bound">b</span> <span class="main">∧</span> <span class="bound">b</span><span class="main">=</span><span class="bound">c</span> <span class="main">∧</span> <span class="bound">c</span><span class="main">≠</span><span class="bound">d</span> <span class="main">∧</span> <span class="bound">a</span><span class="main">=</span><span class="bound">d</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">I</span> <span class="bound">J</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">I</span> <span class="bound">J</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">.</span> <span class="main">⟦</span><span class="free">Q</span> <span class="bound">I</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">;</span> <span class="free">Q</span> <span class="bound">J</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">;</span> <span class="main">¬</span><span class="main">(</span><span class="bound">a</span><span class="main">≠</span><span class="bound">b</span> <span class="main">∧</span> <span class="bound">b</span><span class="main">≠</span><span class="bound">c</span> <span class="main">∧</span> <span class="bound">c</span><span class="main">≠</span><span class="bound">d</span> <span class="main">∧</span> <span class="bound">a</span><span class="main">≠</span><span class="bound">d</span> <span class="main">∧</span> <span class="bound">a</span><span class="main">≠</span><span class="bound">c</span> <span class="main">∧</span> <span class="bound">b</span><span class="main">≠</span><span class="bound">d</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">I</span> <span class="bound">J</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main">)</span>

<span class="keyword1" id="TemporalOrderOnPath-wlog_endpoints_degenerate2"><span class="command">lemma</span></span> wlog_endpoints_degenerate2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> symmetric_Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">I</span> <span class="bound">a</span> <span class="bound">b</span> <span class="main">⟹</span> <span class="free">Q</span> <span class="bound">I</span> <span class="bound">b</span> <span class="bound">a</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> Q_implies_path<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">I</span> <span class="bound">A</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">I</span><span class="main">⊆</span><span class="bound">A</span><span class="main">;</span> <span class="bound">A</span><span class="main">∈</span><span class="free">𝒫</span><span class="main">;</span> <span class="free">Q</span> <span class="bound">I</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="bound">b</span><span class="main">∈</span><span class="bound">A</span> <span class="main">∧</span> <span class="bound">a</span><span class="main">∈</span><span class="bound">A</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> symmetric_P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">I</span> <span class="bound">J</span><span class="main">.</span> <span class="main">⟦</span><span class="main">∃</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">I</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">;</span> <span class="main">∃</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">J</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">;</span> <span class="free">P</span> <span class="bound">I</span> <span class="bound">J</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">J</span> <span class="bound">I</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">I</span> <span class="bound">J</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">d</span> <span class="bound">A</span><span class="main">.</span> <span class="main">⟦</span><span class="free">Q</span> <span class="bound">I</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">;</span> <span class="free">Q</span> <span class="bound">J</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">;</span> <span class="bound">I</span><span class="main">⊆</span><span class="bound">A</span><span class="main">;</span> <span class="bound">J</span><span class="main">⊆</span><span class="bound">A</span><span class="main">;</span> <span class="bound">A</span><span class="main">∈</span><span class="free">𝒫</span><span class="main">;</span>
              <span class="main"><span class="free">[[</span></span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="bound">a</span><span class="main">=</span><span class="bound">d</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">I</span> <span class="bound">J</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">I</span> <span class="bound">J</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">d</span> <span class="bound">A</span><span class="main">.</span> <span class="main">⟦</span><span class="free">Q</span> <span class="bound">I</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">;</span> <span class="free">Q</span> <span class="bound">J</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">;</span> <span class="bound">I</span><span class="main">⊆</span><span class="bound">A</span><span class="main">;</span> <span class="bound">J</span><span class="main">⊆</span><span class="bound">A</span><span class="main">;</span> <span class="bound">A</span><span class="main">∈</span><span class="free">𝒫</span><span class="main">;</span>
              <span class="main"><span class="free">[[</span></span><span class="bound">b</span> <span class="bound">a</span> <span class="bound">c</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="bound">a</span><span class="main">=</span><span class="bound">d</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">I</span> <span class="bound">J</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">I</span> <span class="bound">J</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">d</span> <span class="bound">A</span><span class="main">.</span> <span class="main">⟦</span><span class="free">Q</span> <span class="bound">I</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">;</span> <span class="free">Q</span> <span class="bound">J</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">;</span> <span class="bound">I</span><span class="main">⊆</span><span class="bound">A</span><span class="main">;</span> <span class="bound">J</span><span class="main">⊆</span><span class="bound">A</span><span class="main">;</span> <span class="bound">A</span><span class="main">∈</span><span class="free">𝒫</span><span class="main">;</span>
              <span class="bound">a</span><span class="main">≠</span><span class="bound">b</span> <span class="main">∧</span> <span class="bound">b</span><span class="main">≠</span><span class="bound">c</span> <span class="main">∧</span> <span class="bound">c</span><span class="main">≠</span><span class="bound">d</span> <span class="main">∧</span> <span class="bound">a</span><span class="main">=</span><span class="bound">d</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">I</span> <span class="bound">J</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> last_case<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">I</span> <span class="bound">J</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">d</span> <span class="bound">A</span><span class="main">.</span> <span class="main">⟦</span><span class="free">Q</span> <span class="bound">I</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">;</span> <span class="free">Q</span> <span class="bound">J</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">;</span> <span class="bound">I</span><span class="main">⊆</span><span class="bound">A</span><span class="main">;</span> <span class="bound">J</span><span class="main">⊆</span><span class="bound">A</span><span class="main">;</span> <span class="bound">A</span><span class="main">∈</span><span class="free">𝒫</span><span class="main">;</span>
              <span class="main"><span class="free">[[</span></span><span class="bound">b</span> <span class="bound">c</span> <span class="bound">a</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="bound">a</span><span class="main">=</span><span class="bound">d</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">I</span> <span class="bound">J</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>3-5<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> abc_sym<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">I</span> <span class="bound">J</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">d</span> <span class="bound">A</span><span class="main">.</span> <span class="main">⟦</span><span class="free">Q</span> <span class="bound">I</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">;</span> <span class="free">Q</span> <span class="bound">J</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">;</span> <span class="bound">I</span><span class="main">⊆</span><span class="bound">A</span><span class="main">;</span> <span class="bound">J</span><span class="main">⊆</span><span class="bound">A</span><span class="main">;</span> <span class="bound">A</span><span class="main">∈</span><span class="free">𝒫</span><span class="main">;</span>
              <span class="bound">a</span><span class="main">≠</span><span class="bound">b</span> <span class="main">∧</span> <span class="bound">b</span><span class="main">≠</span><span class="bound">c</span> <span class="main">∧</span> <span class="bound">c</span><span class="main">≠</span><span class="bound">d</span> <span class="main">∧</span> <span class="bound">a</span><span class="main">=</span><span class="bound">d</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">I</span> <span class="bound">J</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> abc_sym assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">,</span></span>4<span class="main"><span class="main">,</span></span>5<span class="main"><span class="main">)</span></span> some_betw<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="TemporalOrderOnPath-wlog_endpoints_degenerate"><span class="command">lemma</span></span> wlog_endpoints_degenerate<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> path_A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">∈</span><span class="free">𝒫</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> symmetric_Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">I</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">I</span> <span class="bound">a</span> <span class="bound">b</span> <span class="main">⟹</span> <span class="free">Q</span> <span class="bound">I</span> <span class="bound">b</span> <span class="bound">a</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> Q_implies_path<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">I</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">I</span><span class="main">⊆</span><span class="free">A</span><span class="main">;</span> <span class="free">Q</span> <span class="bound">I</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="bound">b</span><span class="main">∈</span><span class="free">A</span> <span class="main">∧</span> <span class="bound">a</span><span class="main">∈</span><span class="free">A</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> symmetric_P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">I</span> <span class="bound">J</span><span class="main">.</span> <span class="main">⟦</span><span class="main">∃</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">I</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">;</span> <span class="main">∃</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">J</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">;</span> <span class="free">P</span> <span class="bound">I</span> <span class="bound">J</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">J</span> <span class="bound">I</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">I</span> <span class="bound">J</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">.</span> <span class="main">⟦</span><span class="free">Q</span> <span class="bound">I</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">;</span> <span class="free">Q</span> <span class="bound">J</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">;</span> <span class="bound">I</span><span class="main">⊆</span><span class="free">A</span><span class="main">;</span> <span class="bound">J</span><span class="main">⊆</span><span class="free">A</span><span class="main">⟧</span>
            <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span><span class="bound">a</span><span class="main">=</span><span class="bound">b</span> <span class="main">∧</span> <span class="bound">b</span><span class="main">=</span><span class="bound">c</span> <span class="main">∧</span> <span class="bound">c</span><span class="main">=</span><span class="bound">d</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">P</span> <span class="bound">I</span> <span class="bound">J</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="bound">a</span><span class="main">=</span><span class="bound">b</span> <span class="main">∧</span> <span class="bound">b</span><span class="main">≠</span><span class="bound">c</span> <span class="main">∧</span> <span class="bound">c</span><span class="main">=</span><span class="bound">d</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">P</span> <span class="bound">I</span> <span class="bound">J</span><span class="main">)</span>
              <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="bound">a</span><span class="main">=</span><span class="bound">b</span> <span class="main">∧</span> <span class="bound">b</span><span class="main">=</span><span class="bound">c</span> <span class="main">∧</span> <span class="bound">c</span><span class="main">≠</span><span class="bound">d</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">P</span> <span class="bound">I</span> <span class="bound">J</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="bound">a</span><span class="main">=</span><span class="bound">b</span> <span class="main">∧</span> <span class="bound">b</span><span class="main">≠</span><span class="bound">c</span> <span class="main">∧</span> <span class="bound">c</span><span class="main">≠</span><span class="bound">d</span> <span class="main">∧</span> <span class="bound">a</span><span class="main">≠</span><span class="bound">d</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">P</span> <span class="bound">I</span> <span class="bound">J</span><span class="main">)</span>
              <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="bound">a</span><span class="main">≠</span><span class="bound">b</span> <span class="main">∧</span> <span class="bound">b</span><span class="main">=</span><span class="bound">c</span> <span class="main">∧</span> <span class="bound">c</span><span class="main">≠</span><span class="bound">d</span> <span class="main">∧</span> <span class="bound">a</span><span class="main">=</span><span class="bound">d</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">P</span> <span class="bound">I</span> <span class="bound">J</span><span class="main">)</span>
              <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="main"><span class="free">[[</span></span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="bound">a</span><span class="main">=</span><span class="bound">d</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">P</span> <span class="bound">I</span> <span class="bound">J</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="main"><span class="free">[[</span></span><span class="bound">b</span> <span class="bound">a</span> <span class="bound">c</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="bound">a</span><span class="main">=</span><span class="bound">d</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">P</span> <span class="bound">I</span> <span class="bound">J</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">I</span> <span class="bound">J</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">.</span> <span class="main">⟦</span><span class="free">Q</span> <span class="bound">I</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">;</span> <span class="free">Q</span> <span class="bound">J</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">;</span> <span class="bound">I</span><span class="main">⊆</span><span class="free">A</span><span class="main">;</span> <span class="bound">J</span><span class="main">⊆</span><span class="free">A</span><span class="main">;</span>
            <span class="main">¬</span><span class="main">(</span><span class="bound">a</span><span class="main">≠</span><span class="bound">b</span> <span class="main">∧</span> <span class="bound">b</span><span class="main">≠</span><span class="bound">c</span> <span class="main">∧</span> <span class="bound">c</span><span class="main">≠</span><span class="bound">d</span> <span class="main">∧</span> <span class="bound">a</span><span class="main">≠</span><span class="bound">d</span> <span class="main">∧</span> <span class="bound">a</span><span class="main">≠</span><span class="bound">c</span> <span class="main">∧</span> <span class="bound">b</span><span class="main">≠</span><span class="bound">d</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">I</span> <span class="bound">J</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We first extract some of the assumptions of this lemma into the form
  of other WLOG lemmas' assumptions.›</span></span>
  <span class="keyword1"><span class="command">have</span></span> ord1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">I</span> <span class="bound">J</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">.</span> <span class="main">⟦</span><span class="free">Q</span> <span class="bound">I</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">;</span> <span class="free">Q</span> <span class="bound">J</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">;</span> <span class="bound">I</span><span class="main">⊆</span><span class="free">A</span><span class="main">;</span> <span class="bound">J</span><span class="main">⊆</span><span class="free">A</span><span class="main">;</span>
              <span class="main"><span class="free">[[</span></span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="bound">a</span><span class="main">=</span><span class="bound">d</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">I</span> <span class="bound">J</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> ord2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">I</span> <span class="bound">J</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">.</span> <span class="main">⟦</span><span class="free">Q</span> <span class="bound">I</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">;</span> <span class="free">Q</span> <span class="bound">J</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">;</span> <span class="bound">I</span><span class="main">⊆</span><span class="free">A</span><span class="main">;</span> <span class="bound">J</span><span class="main">⊆</span><span class="free">A</span><span class="main">;</span>
              <span class="main"><span class="free">[[</span></span><span class="bound">b</span> <span class="bound">a</span> <span class="bound">c</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="bound">a</span><span class="main">=</span><span class="bound">d</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">I</span> <span class="bound">J</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> last_case<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">I</span> <span class="bound">J</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">.</span> <span class="main">⟦</span><span class="free">Q</span> <span class="bound">I</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">;</span> <span class="free">Q</span> <span class="bound">J</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">;</span> <span class="bound">I</span><span class="main">⊆</span><span class="free">A</span><span class="main">;</span> <span class="bound">J</span><span class="main">⊆</span><span class="free">A</span><span class="main">;</span>
              <span class="bound">a</span><span class="main">≠</span><span class="bound">b</span> <span class="main">∧</span> <span class="bound">b</span><span class="main">≠</span><span class="bound">c</span> <span class="main">∧</span> <span class="bound">c</span><span class="main">≠</span><span class="bound">d</span> <span class="main">∧</span> <span class="bound">a</span><span class="main">=</span><span class="bound">d</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">I</span> <span class="bound">J</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ord1 ord2 wlog_endpoints_degenerate2 symmetric_P symmetric_Q Q_implies_path path_A
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> abc_sym some_betw<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">I</span> <span class="bound">J</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">.</span> <span class="main">⟦</span><span class="free">Q</span> <span class="bound">I</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">;</span> <span class="free">Q</span> <span class="bound">J</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">;</span> <span class="bound">I</span><span class="main">⊆</span><span class="free">A</span><span class="main">;</span> <span class="bound">J</span><span class="main">⊆</span><span class="free">A</span><span class="main">;</span>
            <span class="main">¬</span><span class="main">(</span><span class="bound">a</span><span class="main">≠</span><span class="bound">b</span> <span class="main">∧</span> <span class="bound">b</span><span class="main">≠</span><span class="bound">c</span> <span class="main">∧</span> <span class="bound">c</span><span class="main">≠</span><span class="bound">d</span> <span class="main">∧</span> <span class="bound">a</span><span class="main">≠</span><span class="bound">d</span> <span class="main">∧</span> <span class="bound">a</span><span class="main">≠</span><span class="bound">c</span> <span class="main">∧</span> <span class="bound">b</span><span class="main">≠</span><span class="bound">d</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">I</span> <span class="bound">J</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>

    <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Fix the sets on the path, and obtain the assumptions of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>wlog_endpoints_degenerate1›</span></span></span></span>.›</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">I</span> <span class="skolem">J</span>
    <span class="keyword3"><span class="command">assume</span></span> asm1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">I</span><span class="main">⊆</span><span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">J</span><span class="main">⊆</span><span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> two<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">.</span> <span class="main">⟦</span><span class="free">Q</span> <span class="skolem">I</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">;</span> <span class="free">Q</span> <span class="skolem">J</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">;</span> <span class="bound">a</span><span class="main">=</span><span class="bound">b</span> <span class="main">∧</span> <span class="bound">b</span><span class="main">=</span><span class="bound">c</span> <span class="main">∧</span> <span class="bound">c</span><span class="main">=</span><span class="bound">d</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="skolem">I</span> <span class="skolem">J</span>"</span></span>
            <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">.</span> <span class="main">⟦</span><span class="free">Q</span> <span class="skolem">I</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">;</span> <span class="free">Q</span> <span class="skolem">J</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">;</span> <span class="bound">a</span><span class="main">=</span><span class="bound">b</span> <span class="main">∧</span> <span class="bound">b</span><span class="main">≠</span><span class="bound">c</span> <span class="main">∧</span> <span class="bound">c</span><span class="main">=</span><span class="bound">d</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="skolem">I</span> <span class="skolem">J</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">J</span> <span class="main">⊆</span> <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">I</span> <span class="main">⊆</span> <span class="free">A</span>›</span></span> path_A assms<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span> 
    <span class="keyword1"><span class="command">have</span></span> one<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">.</span> <span class="main">⟦</span><span class="free">Q</span> <span class="skolem">I</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">;</span> <span class="free">Q</span> <span class="skolem">J</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">;</span> <span class="bound">a</span><span class="main">=</span><span class="bound">b</span> <span class="main">∧</span> <span class="bound">b</span><span class="main">=</span><span class="bound">c</span> <span class="main">∧</span> <span class="bound">c</span><span class="main">≠</span><span class="bound">d</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="skolem">I</span> <span class="skolem">J</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">.</span> <span class="main">⟦</span><span class="free">Q</span> <span class="skolem">I</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">;</span> <span class="free">Q</span> <span class="skolem">J</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">;</span> <span class="bound">a</span><span class="main">=</span><span class="bound">b</span> <span class="main">∧</span> <span class="bound">b</span><span class="main">≠</span><span class="bound">c</span> <span class="main">∧</span> <span class="bound">c</span><span class="main">≠</span><span class="bound">d</span> <span class="main">∧</span> <span class="bound">a</span><span class="main">≠</span><span class="bound">d</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="skolem">I</span> <span class="skolem">J</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">I</span> <span class="main">⊆</span> <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">J</span> <span class="main">⊆</span> <span class="free">A</span>›</span></span> path_A assms<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span> 
    <span class="keyword1"><span class="command">have</span></span> no<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">.</span> <span class="main">⟦</span><span class="free">Q</span> <span class="skolem">I</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">;</span> <span class="free">Q</span> <span class="skolem">J</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">;</span> <span class="bound">a</span><span class="main">≠</span><span class="bound">b</span> <span class="main">∧</span> <span class="bound">b</span><span class="main">≠</span><span class="bound">c</span> <span class="main">∧</span> <span class="bound">c</span><span class="main">≠</span><span class="bound">d</span> <span class="main">∧</span> <span class="bound">a</span><span class="main">=</span><span class="bound">d</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="skolem">I</span> <span class="skolem">J</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">.</span> <span class="main">⟦</span><span class="free">Q</span> <span class="skolem">I</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">;</span> <span class="free">Q</span> <span class="skolem">J</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">;</span> <span class="bound">a</span><span class="main">≠</span><span class="bound">b</span> <span class="main">∧</span> <span class="bound">b</span><span class="main">=</span><span class="bound">c</span> <span class="main">∧</span> <span class="bound">c</span><span class="main">≠</span><span class="bound">d</span> <span class="main">∧</span> <span class="bound">a</span><span class="main">=</span><span class="bound">d</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="skolem">I</span> <span class="skolem">J</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">I</span> <span class="main">⊆</span> <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">J</span> <span class="main">⊆</span> <span class="free">A</span>›</span></span> path_A last_case <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">I</span> <span class="main">⊆</span> <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">J</span> <span class="main">⊆</span> <span class="free">A</span>›</span></span> path_A assms<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Now unwrap the remaining object logic and finish the proof.›</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">d</span>
    <span class="keyword3"><span class="command">assume</span></span> asm2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="skolem">I</span> <span class="skolem">a</span> <span class="skolem">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="skolem">J</span> <span class="skolem">c</span> <span class="skolem">d</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="skolem">a</span><span class="main">≠</span><span class="skolem">b</span> <span class="main">∧</span> <span class="skolem">b</span><span class="main">≠</span><span class="skolem">c</span> <span class="main">∧</span> <span class="skolem">c</span><span class="main">≠</span><span class="skolem">d</span> <span class="main">∧</span> <span class="skolem">a</span><span class="main">≠</span><span class="skolem">d</span> <span class="main">∧</span> <span class="skolem">a</span><span class="main">≠</span><span class="skolem">c</span> <span class="main">∧</span> <span class="skolem">b</span><span class="main">≠</span><span class="skolem">d</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">I</span> <span class="skolem">J</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> two <span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> a<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">a</span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> b<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">b</span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> c<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">c</span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> d<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">d</span></span></span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">using</span></span> one <span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> a<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">a</span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> b<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">b</span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> c<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">c</span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> d<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">d</span></span></span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">using</span></span> no <span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> a<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">a</span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> b<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">b</span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> c<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">c</span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> d<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">d</span></span></span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">using</span></span> wlog_endpoints_degenerate1
        <span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> I<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">I</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> J<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">J</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> c<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> d<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> P<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">P</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> Q<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">Q</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">using</span></span> asm1 asm2 symmetric_P last_case assms<span class="main">(</span>5<span class="main">)</span> symmetric_Q
      <span class="comment1">(* by metis *)</span> <span class="comment1">(* metis is proposed by solver "e", but is slow :-( *)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">smt</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(*context MinkowskiSpacetime*)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"WLOG for two intervals"</span></span>
<span class="keyword1"><span class="command">context</span></span> MinkowskiBetweenness <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  This section just specifies the results for a generic relation $Q$
  in the previous section to the interval relation.
›</span></span>

<span class="keyword1" id="TemporalOrderOnPath-wlog_two_interval_element"><span class="command">lemma</span></span> wlog_two_interval_element<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">I</span> <span class="bound">J</span><span class="main">.</span> <span class="main">⟦</span>is_interval <span class="bound">I</span><span class="main">;</span> is_interval <span class="bound">J</span><span class="main">;</span> <span class="free">P</span> <span class="bound">x</span> <span class="bound">J</span> <span class="bound">I</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">x</span> <span class="bound">I</span> <span class="bound">J</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">d</span> <span class="bound">x</span> <span class="bound">I</span> <span class="bound">J</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">I</span> <span class="main">=</span> interval <span class="bound">a</span> <span class="bound">b</span><span class="main">;</span> <span class="bound">J</span> <span class="main">=</span> interval <span class="bound">c</span> <span class="bound">d</span><span class="main">⟧</span> <span class="main">⟹</span>
              <span class="main">(</span><span class="bound">x</span><span class="main">=</span><span class="bound">a</span> <span class="main">∨</span> <span class="bound">x</span><span class="main">=</span><span class="bound">c</span> <span class="main">⟶</span> <span class="free">P</span> <span class="bound">x</span> <span class="bound">I</span> <span class="bound">J</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">¬</span><span class="main">(</span><span class="bound">x</span><span class="main">=</span><span class="bound">a</span> <span class="main">∨</span> <span class="bound">x</span><span class="main">=</span><span class="bound">b</span> <span class="main">∨</span> <span class="bound">x</span><span class="main">=</span><span class="bound">c</span> <span class="main">∨</span> <span class="bound">x</span><span class="main">=</span><span class="bound">d</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">P</span> <span class="bound">x</span> <span class="bound">I</span> <span class="bound">J</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">I</span> <span class="bound">J</span><span class="main">.</span> <span class="main">⟦</span>is_interval <span class="bound">I</span><span class="main">;</span> is_interval <span class="bound">J</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">x</span> <span class="bound">I</span> <span class="bound">J</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> int_sym<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> MinkowskiSpacetime<span class="main">)</span> wlog_interval_endpoints_distinct<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">I</span> <span class="bound">J</span><span class="main">.</span> <span class="main">⟦</span>is_interval <span class="bound">I</span><span class="main">;</span> is_interval <span class="bound">J</span><span class="main">;</span> <span class="free">P</span> <span class="bound">I</span> <span class="bound">J</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">J</span> <span class="bound">I</span>"</span></span> <span class="comment1">(*P does not distinguish between intervals*)</span>
          <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">I</span> <span class="bound">J</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">I</span> <span class="main">=</span> interval <span class="bound">a</span> <span class="bound">b</span><span class="main">;</span> <span class="bound">J</span> <span class="main">=</span> interval <span class="bound">c</span> <span class="bound">d</span><span class="main">⟧</span>
          <span class="main">⟹</span> <span class="main">(</span>betw4 <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">d</span> <span class="main">⟶</span> <span class="free">P</span> <span class="bound">I</span> <span class="bound">J</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>betw4 <span class="bound">a</span> <span class="bound">c</span> <span class="bound">b</span> <span class="bound">d</span> <span class="main">⟶</span> <span class="free">P</span> <span class="bound">I</span> <span class="bound">J</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>betw4 <span class="bound">a</span> <span class="bound">c</span> <span class="bound">d</span> <span class="bound">b</span> <span class="main">⟶</span> <span class="free">P</span> <span class="bound">I</span> <span class="bound">J</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">I</span> <span class="bound">J</span> <span class="bound">Q</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">I</span> <span class="main">=</span> interval <span class="bound">a</span> <span class="bound">b</span><span class="main">;</span> <span class="bound">J</span> <span class="main">=</span> interval <span class="bound">c</span> <span class="bound">d</span><span class="main">;</span> <span class="bound">I</span><span class="main">⊆</span><span class="bound">Q</span><span class="main">;</span> <span class="bound">J</span><span class="main">⊆</span><span class="bound">Q</span><span class="main">;</span> <span class="bound">Q</span><span class="main">∈</span><span class="free">𝒫</span><span class="main">;</span>
              <span class="bound">a</span><span class="main">≠</span><span class="bound">b</span> <span class="main">∧</span> <span class="bound">a</span><span class="main">≠</span><span class="bound">c</span> <span class="main">∧</span> <span class="bound">a</span><span class="main">≠</span><span class="bound">d</span> <span class="main">∧</span> <span class="bound">b</span><span class="main">≠</span><span class="bound">c</span> <span class="main">∧</span> <span class="bound">b</span><span class="main">≠</span><span class="bound">d</span> <span class="main">∧</span> <span class="bound">c</span><span class="main">≠</span><span class="bound">d</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">I</span> <span class="bound">J</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Q</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">I</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">I</span> <span class="main">=</span> interval <span class="bound">a</span> <span class="bound">b</span>"</span></span>

  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">I</span> <span class="skolem">J</span> <span class="skolem">A</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">d</span>
  <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?Q</span> <span class="skolem">I</span> <span class="skolem">a</span> <span class="skolem">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Q</span> <span class="skolem">J</span> <span class="skolem">c</span> <span class="skolem">d</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">I</span><span class="main">⊆</span><span class="skolem">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">J</span><span class="main">⊆</span><span class="skolem">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span><span class="main">∈</span><span class="free">𝒫</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">≠</span><span class="skolem">b</span> <span class="main">∧</span> <span class="skolem">a</span><span class="main">≠</span><span class="skolem">c</span> <span class="main">∧</span> <span class="skolem">a</span><span class="main">≠</span><span class="skolem">d</span> <span class="main">∧</span> <span class="skolem">b</span><span class="main">≠</span><span class="skolem">c</span> <span class="main">∧</span> <span class="skolem">b</span><span class="main">≠</span><span class="skolem">d</span> <span class="main">∧</span> <span class="skolem">c</span><span class="main">≠</span><span class="skolem">d</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">I</span> <span class="skolem">J</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> wlog_endpoints_distinct<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">I</span><span class="main">.</span> <span class="var">?Q</span> <span class="bound">I</span> <span class="bound">a</span> <span class="bound">b</span> <span class="main">⟹</span> <span class="var">?Q</span> <span class="bound">I</span> <span class="bound">b</span> <span class="bound">a</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> int_sym<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">I</span><span class="main">.</span> <span class="bound">I</span> <span class="main">⊆</span> <span class="skolem">A</span> <span class="main">⟹</span> <span class="var">?Q</span> <span class="bound">I</span> <span class="bound">a</span> <span class="bound">b</span> <span class="main">⟹</span> <span class="bound">b</span> <span class="main">∈</span> <span class="skolem">A</span> <span class="main">∧</span> <span class="bound">a</span> <span class="main">∈</span> <span class="skolem">A</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ends_in_int subset_iff<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">I</span> <span class="bound">J</span><span class="main">.</span> is_interval <span class="bound">I</span> <span class="main">⟹</span> is_interval <span class="bound">J</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">I</span> <span class="bound">J</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">J</span> <span class="bound">I</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">I</span> <span class="bound">J</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">.</span> <span class="main">⟦</span><span class="var">?Q</span> <span class="bound">I</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">;</span> <span class="var">?Q</span> <span class="bound">J</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">;</span> betw4 <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">d</span> <span class="main">∨</span> betw4 <span class="bound">a</span> <span class="bound">c</span> <span class="bound">b</span> <span class="bound">d</span> <span class="main">∨</span> betw4 <span class="bound">a</span> <span class="bound">c</span> <span class="bound">d</span> <span class="bound">b</span><span class="main">⟧</span>
        <span class="main">⟹</span> <span class="free">P</span> <span class="bound">I</span> <span class="bound">J</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">I</span> <span class="main">=</span> interval <span class="skolem">a</span> <span class="skolem">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">J</span> <span class="main">=</span> interval <span class="skolem">c</span> <span class="skolem">d</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">I</span><span class="main">⊆</span><span class="skolem">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">J</span><span class="main">⊆</span><span class="skolem">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span><span class="main">∈</span><span class="free">𝒫</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">≠</span><span class="skolem">b</span> <span class="main">∧</span> <span class="skolem">a</span><span class="main">≠</span><span class="skolem">c</span> <span class="main">∧</span> <span class="skolem">a</span><span class="main">≠</span><span class="skolem">d</span> <span class="main">∧</span> <span class="skolem">b</span><span class="main">≠</span><span class="skolem">c</span> <span class="main">∧</span> <span class="skolem">b</span><span class="main">≠</span><span class="skolem">d</span> <span class="main">∧</span> <span class="skolem">c</span><span class="main">≠</span><span class="skolem">d</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> asm <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="TemporalOrderOnPath-wlog_interval_endpoints_degenerate"><span class="command">lemma</span></span> wlog_interval_endpoints_degenerate<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> symmetry<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">I</span> <span class="bound">J</span><span class="main">.</span> <span class="main">⟦</span>is_interval <span class="bound">I</span><span class="main">;</span> is_interval <span class="bound">J</span><span class="main">;</span> <span class="free">P</span> <span class="bound">I</span> <span class="bound">J</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">J</span> <span class="bound">I</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">I</span> <span class="bound">J</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">d</span> <span class="bound">Q</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">I</span> <span class="main">=</span> interval <span class="bound">a</span> <span class="bound">b</span><span class="main">;</span> <span class="bound">J</span> <span class="main">=</span> interval <span class="bound">c</span> <span class="bound">d</span><span class="main">;</span> <span class="bound">I</span><span class="main">⊆</span><span class="bound">Q</span><span class="main">;</span> <span class="bound">J</span><span class="main">⊆</span><span class="bound">Q</span><span class="main">;</span> <span class="bound">Q</span><span class="main">∈</span><span class="free">𝒫</span><span class="main">⟧</span>
            <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span><span class="bound">a</span><span class="main">=</span><span class="bound">b</span> <span class="main">∧</span> <span class="bound">b</span><span class="main">=</span><span class="bound">c</span> <span class="main">∧</span> <span class="bound">c</span><span class="main">=</span><span class="bound">d</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">P</span> <span class="bound">I</span> <span class="bound">J</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="bound">a</span><span class="main">=</span><span class="bound">b</span> <span class="main">∧</span> <span class="bound">b</span><span class="main">≠</span><span class="bound">c</span> <span class="main">∧</span> <span class="bound">c</span><span class="main">=</span><span class="bound">d</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">P</span> <span class="bound">I</span> <span class="bound">J</span><span class="main">)</span>
              <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="bound">a</span><span class="main">=</span><span class="bound">b</span> <span class="main">∧</span> <span class="bound">b</span><span class="main">=</span><span class="bound">c</span> <span class="main">∧</span> <span class="bound">c</span><span class="main">≠</span><span class="bound">d</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">P</span> <span class="bound">I</span> <span class="bound">J</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="bound">a</span><span class="main">=</span><span class="bound">b</span> <span class="main">∧</span> <span class="bound">b</span><span class="main">≠</span><span class="bound">c</span> <span class="main">∧</span> <span class="bound">c</span><span class="main">≠</span><span class="bound">d</span> <span class="main">∧</span> <span class="bound">a</span><span class="main">≠</span><span class="bound">d</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">P</span> <span class="bound">I</span> <span class="bound">J</span><span class="main">)</span>
              <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="bound">a</span><span class="main">≠</span><span class="bound">b</span> <span class="main">∧</span> <span class="bound">b</span><span class="main">=</span><span class="bound">c</span> <span class="main">∧</span> <span class="bound">c</span><span class="main">≠</span><span class="bound">d</span> <span class="main">∧</span> <span class="bound">a</span><span class="main">=</span><span class="bound">d</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">P</span> <span class="bound">I</span> <span class="bound">J</span><span class="main">)</span>
              <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="main"><span class="free">[[</span></span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="bound">a</span><span class="main">=</span><span class="bound">d</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">P</span> <span class="bound">I</span> <span class="bound">J</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="main"><span class="free">[[</span></span><span class="bound">b</span> <span class="bound">a</span> <span class="bound">c</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="bound">a</span><span class="main">=</span><span class="bound">d</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">P</span> <span class="bound">I</span> <span class="bound">J</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">I</span> <span class="bound">J</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">d</span> <span class="bound">Q</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">I</span> <span class="main">=</span> interval <span class="bound">a</span> <span class="bound">b</span><span class="main">;</span> <span class="bound">J</span> <span class="main">=</span> interval <span class="bound">c</span> <span class="bound">d</span><span class="main">;</span> <span class="bound">I</span><span class="main">⊆</span><span class="bound">Q</span><span class="main">;</span> <span class="bound">J</span><span class="main">⊆</span><span class="bound">Q</span><span class="main">;</span> <span class="bound">Q</span><span class="main">∈</span><span class="free">𝒫</span><span class="main">;</span>
            <span class="main">¬</span><span class="main">(</span><span class="bound">a</span><span class="main">≠</span><span class="bound">b</span> <span class="main">∧</span> <span class="bound">b</span><span class="main">≠</span><span class="bound">c</span> <span class="main">∧</span> <span class="bound">c</span><span class="main">≠</span><span class="bound">d</span> <span class="main">∧</span> <span class="bound">a</span><span class="main">≠</span><span class="bound">d</span> <span class="main">∧</span> <span class="bound">a</span><span class="main">≠</span><span class="bound">c</span> <span class="main">∧</span> <span class="bound">b</span><span class="main">≠</span><span class="bound">d</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">I</span> <span class="bound">J</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Q</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">I</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">I</span> <span class="main">=</span> interval <span class="bound">a</span> <span class="bound">b</span>"</span></span>

  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">I</span> <span class="skolem">J</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">d</span> <span class="skolem">A</span>
  <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?Q</span> <span class="skolem">I</span> <span class="skolem">a</span> <span class="skolem">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Q</span> <span class="skolem">J</span> <span class="skolem">c</span> <span class="skolem">d</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">I</span><span class="main">⊆</span><span class="skolem">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">J</span><span class="main">⊆</span><span class="skolem">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span><span class="main">∈</span><span class="free">𝒫</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="skolem">a</span><span class="main">≠</span><span class="skolem">b</span> <span class="main">∧</span> <span class="skolem">b</span><span class="main">≠</span><span class="skolem">c</span> <span class="main">∧</span> <span class="skolem">c</span><span class="main">≠</span><span class="skolem">d</span> <span class="main">∧</span> <span class="skolem">a</span><span class="main">≠</span><span class="skolem">d</span> <span class="main">∧</span> <span class="skolem">a</span><span class="main">≠</span><span class="skolem">c</span> <span class="main">∧</span> <span class="skolem">b</span><span class="main">≠</span><span class="skolem">d</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">I</span> <span class="skolem">J</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> wlog_endpoints_degenerate<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">I</span><span class="main">.</span> <span class="var">?Q</span> <span class="bound">I</span> <span class="bound">a</span> <span class="bound">b</span> <span class="main">⟹</span> <span class="var">?Q</span> <span class="bound">I</span> <span class="bound">b</span> <span class="bound">a</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> int_sym<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">I</span><span class="main">.</span> <span class="bound">I</span> <span class="main">⊆</span> <span class="skolem">A</span> <span class="main">⟹</span> <span class="var">?Q</span> <span class="bound">I</span> <span class="bound">a</span> <span class="bound">b</span> <span class="main">⟹</span> <span class="bound">b</span> <span class="main">∈</span> <span class="skolem">A</span> <span class="main">∧</span> <span class="bound">a</span> <span class="main">∈</span> <span class="skolem">A</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ends_in_int subset_iff<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">I</span> <span class="bound">J</span><span class="main">.</span> is_interval <span class="bound">I</span> <span class="main">⟹</span> is_interval <span class="bound">J</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">I</span> <span class="bound">J</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">J</span> <span class="bound">I</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> symmetry <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">I</span> <span class="main">=</span> interval <span class="skolem">a</span> <span class="skolem">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">J</span> <span class="main">=</span> interval <span class="skolem">c</span> <span class="skolem">d</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">I</span><span class="main">⊆</span><span class="skolem">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">J</span><span class="main">⊆</span><span class="skolem">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span><span class="main">∈</span><span class="free">𝒫</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="skolem">a</span><span class="main">≠</span><span class="skolem">b</span> <span class="main">∧</span> <span class="skolem">b</span><span class="main">≠</span><span class="skolem">c</span> <span class="main">∧</span> <span class="skolem">c</span><span class="main">≠</span><span class="skolem">d</span> <span class="main">∧</span> <span class="skolem">a</span><span class="main">≠</span><span class="skolem">d</span> <span class="main">∧</span> <span class="skolem">a</span><span class="main">≠</span><span class="skolem">c</span> <span class="main">∧</span> <span class="skolem">b</span><span class="main">≠</span><span class="skolem">d</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> asm <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">+</span></span> 
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">I</span> <span class="bound">J</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">.</span> <span class="main">⟦</span><span class="var">?Q</span> <span class="bound">I</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">;</span> <span class="var">?Q</span> <span class="bound">J</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">;</span> <span class="bound">I</span> <span class="main">⊆</span> <span class="skolem">A</span><span class="main">;</span> <span class="bound">J</span> <span class="main">⊆</span> <span class="skolem">A</span><span class="main">⟧</span> <span class="main">⟹</span>
        <span class="main">(</span><span class="bound">a</span> <span class="main">=</span> <span class="bound">b</span> <span class="main">∧</span> <span class="bound">b</span> <span class="main">=</span> <span class="bound">c</span> <span class="main">∧</span> <span class="bound">c</span> <span class="main">=</span> <span class="bound">d</span> <span class="main">⟶</span> <span class="free">P</span> <span class="bound">I</span> <span class="bound">J</span><span class="main">)</span> <span class="main">∧</span>
        <span class="main">(</span><span class="bound">a</span> <span class="main">=</span> <span class="bound">b</span> <span class="main">∧</span> <span class="bound">b</span> <span class="main">≠</span> <span class="bound">c</span> <span class="main">∧</span> <span class="bound">c</span> <span class="main">=</span> <span class="bound">d</span> <span class="main">⟶</span> <span class="free">P</span> <span class="bound">I</span> <span class="bound">J</span><span class="main">)</span> <span class="main">∧</span>
        <span class="main">(</span><span class="bound">a</span> <span class="main">=</span> <span class="bound">b</span> <span class="main">∧</span> <span class="bound">b</span> <span class="main">=</span> <span class="bound">c</span> <span class="main">∧</span> <span class="bound">c</span> <span class="main">≠</span> <span class="bound">d</span> <span class="main">⟶</span> <span class="free">P</span> <span class="bound">I</span> <span class="bound">J</span><span class="main">)</span> <span class="main">∧</span>
        <span class="main">(</span><span class="bound">a</span> <span class="main">=</span> <span class="bound">b</span> <span class="main">∧</span> <span class="bound">b</span> <span class="main">≠</span> <span class="bound">c</span> <span class="main">∧</span> <span class="bound">c</span> <span class="main">≠</span> <span class="bound">d</span> <span class="main">∧</span> <span class="bound">a</span> <span class="main">≠</span> <span class="bound">d</span> <span class="main">⟶</span> <span class="free">P</span> <span class="bound">I</span> <span class="bound">J</span><span class="main">)</span> <span class="main">∧</span>
        <span class="main">(</span><span class="bound">a</span> <span class="main">≠</span> <span class="bound">b</span> <span class="main">∧</span> <span class="bound">b</span> <span class="main">=</span> <span class="bound">c</span> <span class="main">∧</span> <span class="bound">c</span> <span class="main">≠</span> <span class="bound">d</span> <span class="main">∧</span> <span class="bound">a</span> <span class="main">=</span> <span class="bound">d</span> <span class="main">⟶</span> <span class="free">P</span> <span class="bound">I</span> <span class="bound">J</span><span class="main">)</span> <span class="main">∧</span>
        <span class="main">(</span><span class="main"><span class="free">[[</span></span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="bound">a</span> <span class="main">=</span> <span class="bound">d</span> <span class="main">⟶</span> <span class="free">P</span> <span class="bound">I</span> <span class="bound">J</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main"><span class="free">[[</span></span><span class="bound">b</span> <span class="bound">a</span> <span class="bound">c</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="bound">a</span> <span class="main">=</span> <span class="bound">d</span> <span class="main">⟶</span> <span class="free">P</span> <span class="bound">I</span> <span class="bound">J</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">A</span><span class="main">∈</span><span class="free">𝒫</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context MinkowskiBetweenness *)</span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Interlude: Intervals, Segments, Connectedness"</span></span>
<span class="keyword1"><span class="command">context</span></span> MinkowskiSpacetime <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  In this secion, we apply the WLOG lemmas from the previous section in order to reduce the
  number of cases we need to consider when thinking about two arbitrary intervals on a path.
  This is used to prove that the (countable) intersection of intervals is an interval.
  These results cannot be found in Schutz, but he does use them (without justification)
  in his proof of Theorem 12 (even for uncountable intersections).
›</span></span>

<span class="keyword1" id="TemporalOrderOnPath-int_of_ints_is_interval_neq"><span class="command">lemma</span></span> int_of_ints_is_interval_neq<span class="main">:</span> <span class="comment1">(* Proof using WLOG *)</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>  <span class="quoted"><span class="quoted">"<span class="free">I1</span> <span class="main">=</span> interval <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">I2</span> <span class="main">=</span> interval <span class="free">c</span> <span class="free">d</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">I1</span><span class="main">⊆</span><span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">I2</span><span class="main">⊆</span><span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span><span class="main">∈</span><span class="free">𝒫</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">I1</span><span class="main">∩</span><span class="free">I2</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> events_neq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">≠</span><span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">≠</span><span class="free">c</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">≠</span><span class="free">d</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">≠</span><span class="free">c</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">≠</span><span class="free">d</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">≠</span><span class="free">d</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_interval <span class="main">(</span><span class="free">I1</span> <span class="main">∩</span> <span class="free">I2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> on_path<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">∈</span><span class="free">P</span> <span class="main">∧</span> <span class="free">b</span><span class="main">∈</span><span class="free">P</span> <span class="main">∧</span> <span class="free">c</span><span class="main">∈</span><span class="free">P</span> <span class="main">∧</span> <span class="free">d</span><span class="main">∈</span><span class="free">P</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1-4<span class="main">)</span> interval_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?prop</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">I</span> <span class="bound">J</span><span class="main">.</span> is_interval <span class="main">(</span><span class="bound">I</span><span class="main">∩</span><span class="bound">J</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="bound">I</span><span class="main">∩</span><span class="bound">J</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="comment1">(* The empty intersection is excluded in assms. *)</span>

  <span class="keyword1"><span class="command">have</span></span> symmetry<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">I</span> <span class="bound">J</span><span class="main">.</span> is_interval <span class="bound">I</span> <span class="main">⟹</span> is_interval <span class="bound">J</span> <span class="main">⟹</span> <span class="var">?prop</span> <span class="bound">I</span> <span class="bound">J</span> <span class="main">⟹</span> <span class="var">?prop</span> <span class="bound">J</span> <span class="bound">I</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Int_commute<span class="main">)</span>

  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">I</span> <span class="skolem">J</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">d</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">I</span> <span class="main">=</span> interval <span class="skolem">a</span> <span class="skolem">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">J</span> <span class="main">=</span> interval <span class="skolem">c</span> <span class="skolem">d</span>"</span></span> <span class="comment1">(* "a ≠ b ∧ a ≠ c ∧ a ≠ d ∧ b ≠ c ∧ b ≠ d ∧ c ≠ d" *)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>betw4 <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">d</span> <span class="main">⟶</span> <span class="var">?prop</span> <span class="skolem">I</span> <span class="skolem">J</span><span class="main">)</span>"</span></span>
         <span class="quoted"><span class="quoted">"<span class="main">(</span>betw4 <span class="skolem">a</span> <span class="skolem">c</span> <span class="skolem">b</span> <span class="skolem">d</span> <span class="main">⟶</span> <span class="var">?prop</span> <span class="skolem">I</span> <span class="skolem">J</span><span class="main">)</span>"</span></span>
         <span class="quoted"><span class="quoted">"<span class="main">(</span>betw4 <span class="skolem">a</span> <span class="skolem">c</span> <span class="skolem">d</span> <span class="skolem">b</span> <span class="main">⟶</span> <span class="var">?prop</span> <span class="skolem">I</span> <span class="skolem">J</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> impI<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"betw4 <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">d</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">I</span><span class="main">∩</span><span class="skolem">J</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">I</span><span class="main">∩</span><span class="skolem">J</span><span class="main">≠</span><span class="main">{}</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="skolem">I</span><span class="main">∩</span><span class="skolem">J</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">≠</span><span class="skolem">a</span> <span class="main">∧</span> <span class="skolem">x</span><span class="main">≠</span><span class="skolem">b</span> <span class="main">∧</span> <span class="skolem">x</span><span class="main">≠</span><span class="skolem">c</span> <span class="main">∧</span> <span class="skolem">x</span><span class="main">≠</span><span class="skolem">d</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="skolem">a</span> <span class="skolem">x</span> <span class="skolem">b</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="skolem">c</span> <span class="skolem">x</span> <span class="skolem">d</span><span class="main"><span class="free">]]</span></span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">I</span><span class="main">=</span>interval <span class="skolem">a</span> <span class="skolem">b</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span><span class="main">∈</span><span class="skolem">I</span><span class="main">∩</span><span class="skolem">J</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">J</span><span class="main">=</span>interval <span class="skolem">c</span> <span class="skolem">d</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span><span class="main">∈</span><span class="skolem">I</span><span class="main">∩</span><span class="skolem">J</span>›</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> interval_def seg_betw<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">‹betw4 <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">d</span>›</span></span> abc_only_cba<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> abc_sym abd_bcd_abc<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="skolem">x</span><span class="main">≠</span><span class="skolem">a</span> <span class="main">∧</span> <span class="skolem">x</span><span class="main">≠</span><span class="skolem">b</span> <span class="main">∧</span> <span class="skolem">x</span><span class="main">≠</span><span class="skolem">c</span> <span class="main">∧</span> <span class="skolem">x</span><span class="main">≠</span><span class="skolem">d</span><span class="main">)</span>"</span></span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
            <span class="keyword1"><span class="command">using</span></span> interval_def seg_betw <span class="quoted"><span class="quoted">‹<span class="skolem">I</span> <span class="main">=</span> interval <span class="skolem">a</span> <span class="skolem">b</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">J</span> <span class="main">=</span> interval <span class="skolem">c</span> <span class="skolem">d</span>›</span></span> abcd_dcba_only<span class="main">(</span>21<span class="main">)</span>
                 <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">I</span> <span class="main">∩</span> <span class="skolem">J</span>›</span></span> <span class="quoted"><span class="quoted">‹betw4 <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">d</span>›</span></span> abc_bcd_abd abc_bcd_acd abc_only_cba<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> insert_iff Int_iff<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span> 
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="var">?prop</span> <span class="skolem">I</span> <span class="skolem">J</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"betw4 <span class="skolem">a</span> <span class="skolem">c</span> <span class="skolem">b</span> <span class="skolem">d</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≠</span> <span class="skolem">b</span> <span class="main">∧</span> <span class="skolem">a</span> <span class="main">≠</span> <span class="skolem">c</span> <span class="main">∧</span> <span class="skolem">a</span> <span class="main">≠</span> <span class="skolem">d</span> <span class="main">∧</span> <span class="skolem">b</span> <span class="main">≠</span> <span class="skolem">c</span> <span class="main">∧</span> <span class="skolem">b</span> <span class="main">≠</span> <span class="skolem">d</span> <span class="main">∧</span> <span class="skolem">c</span> <span class="main">≠</span> <span class="skolem">d</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> betw4_imp_neq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">I</span><span class="main">∩</span><span class="skolem">J</span> <span class="main">=</span> interval <span class="skolem">c</span> <span class="skolem">b</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">safe</span><span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> interval <span class="skolem">c</span> <span class="skolem">b</span>"</span></span>
        <span class="keyword1"><span class="command">{</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="skolem">b</span> <span class="main">∨</span> <span class="skolem">x</span><span class="main">=</span><span class="skolem">c</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="skolem">I</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹betw4 <span class="skolem">a</span> <span class="skolem">c</span> <span class="skolem">b</span> <span class="skolem">d</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">I</span> <span class="main">=</span> interval <span class="skolem">a</span> <span class="skolem">b</span>›</span></span> interval_def seg_betw <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="skolem">J</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span><span class="main">=</span><span class="skolem">b</span> <span class="main">∨</span> <span class="skolem">x</span><span class="main">=</span><span class="skolem">c</span>›</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹betw4 <span class="skolem">a</span> <span class="skolem">c</span> <span class="skolem">b</span> <span class="skolem">d</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">J</span> <span class="main">=</span> interval <span class="skolem">c</span> <span class="skolem">d</span>›</span></span> interval_def seg_betw <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="skolem">I</span> <span class="main">∧</span> <span class="skolem">x</span><span class="main">∈</span><span class="skolem">J</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">I</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
          <span class="keyword3"><span class="command">assume</span></span>  <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="skolem">x</span><span class="main">=</span><span class="skolem">b</span> <span class="main">∨</span> <span class="skolem">x</span><span class="main">=</span><span class="skolem">c</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="skolem">c</span> <span class="skolem">x</span> <span class="skolem">b</span><span class="main"><span class="free">]]</span></span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">`<span class="skolem">x</span><span class="main">∈</span>interval <span class="skolem">c</span> <span class="skolem">b</span>`</span></span> <span class="keyword1"><span class="command">unfolding</span></span> interval_def segment_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="skolem">a</span> <span class="skolem">x</span> <span class="skolem">b</span><span class="main"><span class="free">]]</span></span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">‹betw4 <span class="skolem">a</span> <span class="skolem">c</span> <span class="skolem">b</span> <span class="skolem">d</span>›</span></span> abc_acd_abd abc_sym<span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="skolem">c</span> <span class="skolem">x</span> <span class="skolem">d</span><span class="main"><span class="free">]]</span></span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹betw4 <span class="skolem">a</span> <span class="skolem">c</span> <span class="skolem">b</span> <span class="skolem">d</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="skolem">c</span> <span class="skolem">x</span> <span class="skolem">b</span><span class="main"><span class="free">]]</span></span>›</span></span> abc_acd_abd <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="skolem">I</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="skolem">J</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">I</span> <span class="main">=</span> interval <span class="skolem">a</span> <span class="skolem">b</span>›</span></span> <span class="quoted"><span class="quoted">`<span class="main"><span class="free">[[</span></span><span class="skolem">a</span> <span class="skolem">x</span> <span class="skolem">b</span><span class="main"><span class="free">]]</span></span>`</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">J</span> <span class="main">=</span> interval <span class="skolem">c</span> <span class="skolem">d</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="skolem">c</span> <span class="skolem">x</span> <span class="skolem">d</span><span class="main"><span class="free">]]</span></span>›</span></span> 
                  interval_def seg_betw <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">}</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="skolem">I</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="skolem">J</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="skolem">I</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="skolem">J</span>"</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> interval <span class="skolem">c</span> <span class="skolem">b</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
          <span class="keyword3"><span class="command">assume</span></span> not_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">≠</span><span class="skolem">a</span> <span class="main">∧</span> <span class="skolem">x</span><span class="main">≠</span><span class="skolem">b</span> <span class="main">∧</span> <span class="skolem">x</span><span class="main">≠</span><span class="skolem">c</span> <span class="main">∧</span> <span class="skolem">x</span><span class="main">≠</span><span class="skolem">d</span>"</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="skolem">a</span> <span class="skolem">x</span> <span class="skolem">b</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="skolem">c</span> <span class="skolem">x</span> <span class="skolem">d</span><span class="main"><span class="free">]]</span></span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">`<span class="skolem">x</span><span class="main">∈</span><span class="skolem">I</span>`</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">I</span> <span class="main">=</span> interval <span class="skolem">a</span> <span class="skolem">b</span>›</span></span>  <span class="quoted"><span class="quoted">`<span class="skolem">x</span><span class="main">∈</span><span class="skolem">J</span>`</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">J</span> <span class="main">=</span> interval <span class="skolem">c</span> <span class="skolem">d</span>›</span></span> 
                  not_eq <span class="keyword1"><span class="command">unfolding</span></span> interval_def segment_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="skolem">c</span> <span class="skolem">x</span> <span class="skolem">b</span><span class="main"><span class="free">]]</span></span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">‹betw4 <span class="skolem">a</span> <span class="skolem">c</span> <span class="skolem">b</span> <span class="skolem">d</span>›</span></span> abc_bcd_acd betw4_weak<span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> interval_def segment_def <span class="keyword1"><span class="command">using</span></span> seg_betw segment_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">assume</span></span> not_not_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="skolem">x</span><span class="main">≠</span><span class="skolem">a</span> <span class="main">∧</span> <span class="skolem">x</span><span class="main">≠</span><span class="skolem">b</span> <span class="main">∧</span> <span class="skolem">x</span><span class="main">≠</span><span class="skolem">c</span> <span class="main">∧</span> <span class="skolem">x</span><span class="main">≠</span><span class="skolem">d</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">{</span></span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="skolem">a</span>"</span></span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main"><span class="free">[[</span></span><span class="skolem">d</span> <span class="skolem">a</span> <span class="skolem">c</span><span class="main"><span class="free">]]</span></span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹betw4 <span class="skolem">a</span> <span class="skolem">c</span> <span class="skolem">b</span> <span class="skolem">d</span>›</span></span> abcd_dcba_only<span class="main">(</span>9<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∉</span> interval <span class="skolem">c</span> <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> interval_def segment_def
              <span class="keyword1"><span class="command">using</span></span> abc_sym <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">≠</span> <span class="skolem">b</span> <span class="main">∧</span> <span class="skolem">a</span> <span class="main">≠</span> <span class="skolem">c</span> <span class="main">∧</span> <span class="skolem">a</span> <span class="main">≠</span> <span class="skolem">d</span> <span class="main">∧</span> <span class="skolem">b</span> <span class="main">≠</span> <span class="skolem">c</span> <span class="main">∧</span> <span class="skolem">b</span> <span class="main">≠</span> <span class="skolem">d</span> <span class="main">∧</span> <span class="skolem">c</span> <span class="main">≠</span> <span class="skolem">d</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">`<span class="skolem">x</span><span class="main">∈</span><span class="skolem">J</span>`</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">J</span> <span class="main">=</span> interval <span class="skolem">c</span> <span class="skolem">d</span>›</span></span> <span class="quoted"><span class="quoted">`<span class="skolem">x</span><span class="main">=</span><span class="skolem">a</span>`</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="skolem">d</span>"</span></span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main"><span class="free">[[</span></span><span class="skolem">a</span> <span class="skolem">d</span> <span class="skolem">b</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹betw4 <span class="skolem">a</span> <span class="skolem">c</span> <span class="skolem">b</span> <span class="skolem">d</span>›</span></span> abc_sym abcd_dcba_only<span class="main">(</span>9<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">∉</span>interval <span class="skolem">a</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> interval_def segment_def
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">≠</span> <span class="skolem">b</span> <span class="main">∧</span> <span class="skolem">a</span> <span class="main">≠</span> <span class="skolem">c</span> <span class="main">∧</span> <span class="skolem">a</span> <span class="main">≠</span> <span class="skolem">d</span> <span class="main">∧</span> <span class="skolem">b</span> <span class="main">≠</span> <span class="skolem">c</span> <span class="main">∧</span> <span class="skolem">b</span> <span class="main">≠</span> <span class="skolem">d</span> <span class="main">∧</span> <span class="skolem">c</span> <span class="main">≠</span> <span class="skolem">d</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">`<span class="skolem">x</span><span class="main">∈</span><span class="skolem">I</span>`</span></span> <span class="quoted"><span class="quoted">`<span class="skolem">x</span><span class="main">=</span><span class="skolem">d</span>`</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">I</span> <span class="main">=</span> interval <span class="skolem">a</span> <span class="skolem">b</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">}</span></span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">using</span></span> interval_def not_not_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="var">?prop</span> <span class="skolem">I</span> <span class="skolem">J</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"betw4 <span class="skolem">a</span> <span class="skolem">c</span> <span class="skolem">d</span> <span class="skolem">b</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">I</span><span class="main">∩</span><span class="skolem">J</span> <span class="main">=</span> interval <span class="skolem">c</span> <span class="skolem">d</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">safe</span><span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> interval <span class="skolem">c</span> <span class="skolem">d</span>"</span></span>
        <span class="keyword1"><span class="command">{</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">≠</span><span class="skolem">c</span> <span class="main">∧</span> <span class="skolem">x</span><span class="main">≠</span><span class="skolem">d</span>"</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">J</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">J</span> <span class="main">=</span> interval <span class="skolem">c</span> <span class="skolem">d</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> interval <span class="skolem">c</span> <span class="skolem">d</span>›</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="skolem">c</span> <span class="skolem">x</span> <span class="skolem">d</span><span class="main"><span class="free">]]</span></span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> interval <span class="skolem">c</span> <span class="skolem">d</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">c</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">d</span>›</span></span> interval_def seg_betw <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="skolem">a</span> <span class="skolem">x</span> <span class="skolem">b</span><span class="main"><span class="free">]]</span></span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">‹betw4 <span class="skolem">a</span> <span class="skolem">c</span> <span class="skolem">d</span> <span class="skolem">b</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="skolem">c</span> <span class="skolem">x</span> <span class="skolem">d</span><span class="main"><span class="free">]]</span></span>›</span></span> abc_bcd_abd abc_sym abe_ade_bcd_ace<span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">I</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">I</span> <span class="main">=</span> interval <span class="skolem">a</span> <span class="skolem">b</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="skolem">a</span> <span class="skolem">x</span> <span class="skolem">b</span><span class="main"><span class="free">]]</span></span>›</span></span> interval_def seg_betw <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="skolem">I</span> <span class="main">∧</span> <span class="skolem">x</span><span class="main">∈</span><span class="skolem">J</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">J</span>›</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="skolem">x</span><span class="main">≠</span><span class="skolem">c</span> <span class="main">∧</span> <span class="skolem">x</span><span class="main">≠</span><span class="skolem">d</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="skolem">I</span> <span class="main">∧</span> <span class="skolem">x</span><span class="main">∈</span><span class="skolem">J</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">I</span> <span class="main">=</span> interval <span class="skolem">a</span> <span class="skolem">b</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">J</span> <span class="main">=</span> interval <span class="skolem">c</span> <span class="skolem">d</span>›</span></span> <span class="quoted"><span class="quoted">‹betw4 <span class="skolem">a</span> <span class="skolem">c</span> <span class="skolem">d</span> <span class="skolem">b</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> interval <span class="skolem">c</span> <span class="skolem">d</span>›</span></span>
                abc_bcd_abd abc_bcd_acd insertI2 interval_def seg_betw<span class="main">)</span>
        <span class="keyword1"><span class="command">}</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="skolem">I</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="skolem">J</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="skolem">I</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="skolem">J</span>"</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> interval <span class="skolem">c</span> <span class="skolem">d</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">J</span> <span class="main">=</span> interval <span class="skolem">c</span> <span class="skolem">d</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">J</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="var">?prop</span> <span class="skolem">I</span> <span class="skolem">J</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">}</span></span>
    
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_interval <span class="main">(</span><span class="free">I1</span><span class="main">∩</span><span class="free">I2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> wlog_interval_endpoints_distinct
      <span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="var">?prop</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> I<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">I1</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> J<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">I2</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> Q<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">P</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">a</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">b</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> c<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">c</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> d<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">d</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> symmetry assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="TemporalOrderOnPath-int_of_ints_is_interval_deg"><span class="command">lemma</span></span> int_of_ints_is_interval_deg<span class="main">:</span> <span class="comment1">(* Proof using WLOG *)</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>  <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">=</span> interval <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">J</span> <span class="main">=</span> interval <span class="free">c</span> <span class="free">d</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">I</span><span class="main">∩</span><span class="free">J</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">I</span><span class="main">⊆</span><span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">J</span><span class="main">⊆</span><span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span><span class="main">∈</span><span class="free">𝒫</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> events_deg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="free">a</span><span class="main">≠</span><span class="free">b</span> <span class="main">∧</span> <span class="free">b</span><span class="main">≠</span><span class="free">c</span> <span class="main">∧</span> <span class="free">c</span><span class="main">≠</span><span class="free">d</span> <span class="main">∧</span> <span class="free">a</span><span class="main">≠</span><span class="free">d</span> <span class="main">∧</span> <span class="free">a</span><span class="main">≠</span><span class="free">c</span> <span class="main">∧</span> <span class="free">b</span><span class="main">≠</span><span class="free">d</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_interval <span class="main">(</span><span class="free">I</span> <span class="main">∩</span> <span class="free">J</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">I</span> <span class="bound">J</span><span class="main">.</span> <span class="main">(</span>is_interval <span class="main">(</span><span class="bound">I</span> <span class="main">∩</span> <span class="bound">J</span><span class="main">)</span> <span class="main">∨</span> <span class="bound">I</span><span class="main">∩</span><span class="bound">J</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> symmetry<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">I</span> <span class="bound">J</span><span class="main">.</span> <span class="main">⟦</span>is_interval <span class="bound">I</span><span class="main">;</span> is_interval <span class="bound">J</span><span class="main">;</span> <span class="var">?p</span> <span class="bound">I</span> <span class="bound">J</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="var">?p</span> <span class="bound">J</span> <span class="bound">I</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_commute<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> degen_cases<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">I</span> <span class="bound">J</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">d</span> <span class="bound">Q</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">I</span> <span class="main">=</span> interval <span class="bound">a</span> <span class="bound">b</span><span class="main">;</span> <span class="bound">J</span> <span class="main">=</span> interval <span class="bound">c</span> <span class="bound">d</span><span class="main">;</span> <span class="bound">I</span><span class="main">⊆</span><span class="bound">Q</span><span class="main">;</span> <span class="bound">J</span><span class="main">⊆</span><span class="bound">Q</span><span class="main">;</span> <span class="bound">Q</span><span class="main">∈</span><span class="free">𝒫</span><span class="main">⟧</span>
            <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span><span class="bound">a</span><span class="main">=</span><span class="bound">b</span> <span class="main">∧</span> <span class="bound">b</span><span class="main">=</span><span class="bound">c</span> <span class="main">∧</span> <span class="bound">c</span><span class="main">=</span><span class="bound">d</span><span class="main">)</span> <span class="main">⟶</span> <span class="var">?p</span> <span class="bound">I</span> <span class="bound">J</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="bound">a</span><span class="main">=</span><span class="bound">b</span> <span class="main">∧</span> <span class="bound">b</span><span class="main">≠</span><span class="bound">c</span> <span class="main">∧</span> <span class="bound">c</span><span class="main">=</span><span class="bound">d</span><span class="main">)</span> <span class="main">⟶</span> <span class="var">?p</span> <span class="bound">I</span> <span class="bound">J</span><span class="main">)</span>
              <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="bound">a</span><span class="main">=</span><span class="bound">b</span> <span class="main">∧</span> <span class="bound">b</span><span class="main">=</span><span class="bound">c</span> <span class="main">∧</span> <span class="bound">c</span><span class="main">≠</span><span class="bound">d</span><span class="main">)</span> <span class="main">⟶</span> <span class="var">?p</span> <span class="bound">I</span> <span class="bound">J</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="bound">a</span><span class="main">=</span><span class="bound">b</span> <span class="main">∧</span> <span class="bound">b</span><span class="main">≠</span><span class="bound">c</span> <span class="main">∧</span> <span class="bound">c</span><span class="main">≠</span><span class="bound">d</span> <span class="main">∧</span> <span class="bound">a</span><span class="main">≠</span><span class="bound">d</span><span class="main">)</span> <span class="main">⟶</span> <span class="var">?p</span> <span class="bound">I</span> <span class="bound">J</span><span class="main">)</span>
              <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="bound">a</span><span class="main">≠</span><span class="bound">b</span> <span class="main">∧</span> <span class="bound">b</span><span class="main">=</span><span class="bound">c</span> <span class="main">∧</span> <span class="bound">c</span><span class="main">≠</span><span class="bound">d</span> <span class="main">∧</span> <span class="bound">a</span><span class="main">=</span><span class="bound">d</span><span class="main">)</span> <span class="main">⟶</span> <span class="var">?p</span> <span class="bound">I</span> <span class="bound">J</span><span class="main">)</span>
              <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="main"><span class="free">[[</span></span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="bound">a</span><span class="main">=</span><span class="bound">d</span><span class="main">)</span> <span class="main">⟶</span> <span class="var">?p</span> <span class="bound">I</span> <span class="bound">J</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="main"><span class="free">[[</span></span><span class="bound">b</span> <span class="bound">a</span> <span class="bound">c</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="bound">a</span><span class="main">=</span><span class="bound">d</span><span class="main">)</span> <span class="main">⟶</span> <span class="var">?p</span> <span class="bound">I</span> <span class="bound">J</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">I</span> <span class="skolem">J</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">d</span> <span class="skolem">Q</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">I</span> <span class="main">=</span> interval <span class="skolem">a</span> <span class="skolem">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">J</span> <span class="main">=</span> interval <span class="skolem">c</span> <span class="skolem">d</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">I</span><span class="main">⊆</span><span class="skolem">Q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">J</span><span class="main">⊆</span><span class="skolem">Q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span><span class="main">∈</span><span class="free">𝒫</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">a</span><span class="main">=</span><span class="skolem">b</span> <span class="main">∧</span> <span class="skolem">b</span><span class="main">=</span><span class="skolem">c</span> <span class="main">∧</span> <span class="skolem">c</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span> <span class="main">⟶</span> <span class="var">?p</span> <span class="skolem">I</span> <span class="skolem">J</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="skolem">a</span><span class="main">=</span><span class="skolem">b</span> <span class="main">∧</span> <span class="skolem">b</span><span class="main">≠</span><span class="skolem">c</span> <span class="main">∧</span> <span class="skolem">c</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span> <span class="main">⟶</span> <span class="var">?p</span> <span class="skolem">I</span> <span class="skolem">J</span><span class="main">)</span>
              <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="skolem">a</span><span class="main">=</span><span class="skolem">b</span> <span class="main">∧</span> <span class="skolem">b</span><span class="main">=</span><span class="skolem">c</span> <span class="main">∧</span> <span class="skolem">c</span><span class="main">≠</span><span class="skolem">d</span><span class="main">)</span> <span class="main">⟶</span> <span class="var">?p</span> <span class="skolem">I</span> <span class="skolem">J</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="skolem">a</span><span class="main">=</span><span class="skolem">b</span> <span class="main">∧</span> <span class="skolem">b</span><span class="main">≠</span><span class="skolem">c</span> <span class="main">∧</span> <span class="skolem">c</span><span class="main">≠</span><span class="skolem">d</span> <span class="main">∧</span> <span class="skolem">a</span><span class="main">≠</span><span class="skolem">d</span><span class="main">)</span> <span class="main">⟶</span> <span class="var">?p</span> <span class="skolem">I</span> <span class="skolem">J</span><span class="main">)</span>
              <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="skolem">a</span><span class="main">≠</span><span class="skolem">b</span> <span class="main">∧</span> <span class="skolem">b</span><span class="main">=</span><span class="skolem">c</span> <span class="main">∧</span> <span class="skolem">c</span><span class="main">≠</span><span class="skolem">d</span> <span class="main">∧</span> <span class="skolem">a</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span> <span class="main">⟶</span> <span class="var">?p</span> <span class="skolem">I</span> <span class="skolem">J</span><span class="main">)</span>
              <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="main"><span class="free">[[</span></span><span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="skolem">a</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span> <span class="main">⟶</span> <span class="var">?p</span> <span class="skolem">I</span> <span class="skolem">J</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="main"><span class="free">[[</span></span><span class="skolem">b</span> <span class="skolem">a</span> <span class="skolem">c</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="skolem">a</span><span class="main">=</span><span class="skolem">d</span><span class="main">)</span> <span class="main">⟶</span> <span class="var">?p</span> <span class="skolem">I</span> <span class="skolem">J</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI impI<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="skolem">b</span> <span class="main">∧</span> <span class="skolem">b</span> <span class="main">=</span> <span class="skolem">c</span> <span class="main">∧</span> <span class="skolem">c</span> <span class="main">=</span> <span class="skolem">d</span>"</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="skolem">I</span> <span class="skolem">J</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">I</span> <span class="main">=</span> interval <span class="skolem">a</span> <span class="skolem">b</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">J</span> <span class="main">=</span> interval <span class="skolem">c</span> <span class="skolem">d</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="skolem">b</span> <span class="main">∧</span> <span class="skolem">b</span> <span class="main">≠</span> <span class="skolem">c</span> <span class="main">∧</span> <span class="skolem">c</span> <span class="main">=</span> <span class="skolem">d</span>"</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="skolem">I</span> <span class="skolem">J</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">J</span> <span class="main">=</span> interval <span class="skolem">c</span> <span class="skolem">d</span>›</span></span> empty_segment interval_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="skolem">b</span> <span class="main">∧</span> <span class="skolem">b</span> <span class="main">=</span> <span class="skolem">c</span> <span class="main">∧</span> <span class="skolem">c</span> <span class="main">≠</span> <span class="skolem">d</span>"</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="skolem">I</span> <span class="skolem">J</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">I</span> <span class="main">=</span> interval <span class="skolem">a</span> <span class="skolem">b</span>›</span></span> empty_segment interval_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="skolem">b</span> <span class="main">∧</span> <span class="skolem">b</span> <span class="main">≠</span> <span class="skolem">c</span> <span class="main">∧</span> <span class="skolem">c</span> <span class="main">≠</span> <span class="skolem">d</span> <span class="main">∧</span> <span class="skolem">a</span> <span class="main">≠</span> <span class="skolem">d</span>"</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="skolem">I</span> <span class="skolem">J</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">I</span> <span class="main">=</span> interval <span class="skolem">a</span> <span class="skolem">b</span>›</span></span> empty_segment interval_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≠</span> <span class="skolem">b</span> <span class="main">∧</span> <span class="skolem">b</span> <span class="main">=</span> <span class="skolem">c</span> <span class="main">∧</span> <span class="skolem">c</span> <span class="main">≠</span> <span class="skolem">d</span> <span class="main">∧</span> <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">d</span>"</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="skolem">I</span> <span class="skolem">J</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">I</span> <span class="main">=</span> interval <span class="skolem">a</span> <span class="skolem">b</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">J</span> <span class="main">=</span> interval <span class="skolem">c</span> <span class="skolem">d</span>›</span></span> int_sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">d</span>"</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="skolem">I</span> <span class="skolem">J</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">I</span><span class="main">∩</span><span class="skolem">J</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">I</span><span class="main">∩</span><span class="skolem">J</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">I</span><span class="main">∩</span><span class="skolem">J</span> <span class="main">=</span> interval <span class="skolem">a</span> <span class="skolem">b</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">safe</span><span class="main">)</span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="skolem">I</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="skolem">J</span>"</span></span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span>interval <span class="skolem">a</span> <span class="skolem">b</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">I</span> <span class="main">=</span> interval <span class="skolem">a</span> <span class="skolem">b</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span>interval <span class="skolem">a</span> <span class="skolem">b</span>"</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="skolem">I</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">I</span> <span class="main">=</span> interval <span class="skolem">a</span> <span class="skolem">b</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> interval <span class="skolem">a</span> <span class="skolem">b</span>›</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="skolem">d</span> <span class="skolem">b</span> <span class="skolem">c</span><span class="main"><span class="free">]]</span></span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">d</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="skolem">a</span> <span class="skolem">x</span> <span class="skolem">b</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="skolem">x</span><span class="main">=</span><span class="skolem">a</span> <span class="main">∨</span> <span class="skolem">x</span><span class="main">=</span><span class="skolem">b</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">I</span> <span class="main">=</span> interval <span class="skolem">a</span> <span class="skolem">b</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">I</span>›</span></span> interval_def seg_betw <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="skolem">d</span> <span class="skolem">x</span> <span class="skolem">c</span><span class="main"><span class="free">]]</span></span>"</span></span><span class="main">|</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="skolem">a</span> <span class="main">∨</span> <span class="skolem">x</span><span class="main">=</span><span class="skolem">b</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">d</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="skolem">a</span> <span class="skolem">x</span> <span class="skolem">b</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">∨</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">b</span>›</span></span> abc_acd_abd <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="skolem">J</span>"</span></span> 
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> 1
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">J</span> <span class="main">=</span> interval <span class="skolem">c</span> <span class="skolem">d</span>›</span></span> abc_abc_neq abc_sym interval_def seg_betw<span class="main">)</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> 2
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> interval <span class="skolem">c</span> <span class="skolem">d</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span>  <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">d</span>›</span></span> int_sym interval_def seg_betw 
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span> 
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">J</span> <span class="main">=</span> interval <span class="skolem">c</span> <span class="skolem">d</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>  
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="skolem">I</span> <span class="skolem">J</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="skolem">b</span> <span class="skolem">a</span> <span class="skolem">c</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">d</span>"</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="skolem">I</span> <span class="skolem">J</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">I</span><span class="main">∩</span><span class="skolem">J</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">I</span><span class="main">∩</span><span class="skolem">J</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">I</span><span class="main">∩</span><span class="skolem">J</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">safe</span><span class="main">)</span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="skolem">I</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="skolem">J</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∉</span><span class="main">{}</span>"</span></span>
          <span class="keyword1"><span class="command">have</span></span> cxd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="skolem">c</span> <span class="skolem">x</span> <span class="skolem">d</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="skolem">x</span><span class="main">=</span><span class="skolem">c</span> <span class="main">∨</span> <span class="skolem">x</span><span class="main">=</span><span class="skolem">d</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">J</span> <span class="main">=</span> interval <span class="skolem">c</span> <span class="skolem">d</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">J</span>›</span></span> interval_def seg_betw <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="skolem">a</span> <span class="skolem">x</span> <span class="skolem">b</span><span class="main"><span class="free">]]</span></span>"</span></span><span class="main">|</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="skolem">a</span>"</span></span><span class="main">|</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="skolem">b</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">I</span> <span class="main">=</span> interval <span class="skolem">a</span> <span class="skolem">b</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">I</span>›</span></span> interval_def seg_betw <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="skolem">a</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="skolem">a</span> <span class="skolem">x</span> <span class="skolem">b</span><span class="main"><span class="free">]]</span></span>"</span></span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"betw4 <span class="skolem">b</span> <span class="skolem">x</span> <span class="skolem">d</span> <span class="skolem">c</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="skolem">b</span> <span class="skolem">a</span> <span class="skolem">c</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">d</span>›</span></span> abc_acd_bcd abc_sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted">False</span>
              <span class="keyword1"><span class="command">using</span></span> cxd abc_abc_neq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="skolem">b</span>"</span></span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="skolem">b</span> <span class="skolem">d</span> <span class="skolem">c</span><span class="main"><span class="free">]]</span></span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="skolem">b</span> <span class="skolem">a</span> <span class="skolem">c</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">d</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted">False</span>
              <span class="keyword1"><span class="command">using</span></span> cxd <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">b</span>›</span></span> abc_abc_neq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="skolem">a</span>"</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">∈</span><span class="skolem">I</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">I</span> <span class="main">=</span> interval <span class="skolem">a</span> <span class="skolem">b</span>›</span></span> ends_in_int<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">∈</span><span class="skolem">J</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">J</span> <span class="main">=</span> interval <span class="skolem">c</span> <span class="skolem">d</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="skolem">b</span> <span class="skolem">a</span> <span class="skolem">c</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">d</span>›</span></span> ends_in_int<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="skolem">I</span> <span class="skolem">J</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> empty_segment interval_def<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="free">I</span> <span class="free">J</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> wlog_interval_endpoints_degenerate
      <span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="var">?p</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> I<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">I</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> J<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">J</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">a</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">b</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> c<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">c</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> d<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">d</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> Q<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">P</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> degen_cases
    <span class="keyword1"><span class="command">using</span></span> symmetry assms
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">smt</span>

  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="TemporalOrderOnPath-int_of_ints_is_interval"><span class="command">lemma</span></span> int_of_ints_is_interval<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_interval <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"is_interval <span class="free">J</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">I</span><span class="main">⊆</span><span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">J</span><span class="main">⊆</span><span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span><span class="main">∈</span><span class="free">𝒫</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">I</span><span class="main">∩</span><span class="free">J</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_interval <span class="main">(</span><span class="free">I</span> <span class="main">∩</span> <span class="free">J</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> int_of_ints_is_interval_neq int_of_ints_is_interval_deg
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms<span class="main">)</span>


<span class="keyword1" id="TemporalOrderOnPath-int_of_ints_is_interval2"><span class="command">lemma</span></span> int_of_ints_is_interval2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> <span class="main">(</span>is_interval <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span><span class="main">⊆</span><span class="free">P</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span><span class="main">∈</span><span class="free">𝒫</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋂</span><span class="free">S</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span><span class="main">≠</span><span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_interval <span class="main">(</span><span class="main">⋂</span><span class="free">S</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> card <span class="free">S</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">|</span><span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">=</span><span class="main">1</span>"</span></span><span class="main">|</span><span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">≥</span><span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">=</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">=</span> card <span class="free">S</span>›</span></span> assms<span class="main">(</span>4<span class="main">,</span>5<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">=</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">I</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">I</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">=</span> card <span class="free">S</span>›</span></span> card_1_singletonE <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋂</span><span class="free">S</span> <span class="main">=</span> <span class="skolem">I</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_interval <span class="skolem">I</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="free">S</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">I</span><span class="main">}</span>›</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">≤</span><span class="skolem">n</span>"</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span><span class="main">+</span><span class="numeral">2</span><span class="main">=</span><span class="skolem">n</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="numeral">2</span> <span class="main">≤</span> <span class="skolem">n</span>›</span></span> le_add_diff_inverse2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> ind<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">S</span><span class="main">.</span> <span class="main">⟦</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="bound">S</span><span class="main">.</span> <span class="main">(</span>is_interval <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span><span class="main">⊆</span><span class="free">P</span><span class="main">)</span><span class="main">;</span> <span class="free">P</span><span class="main">∈</span><span class="free">𝒫</span><span class="main">;</span> <span class="main">⋂</span><span class="bound">S</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">;</span> finite <span class="bound">S</span><span class="main">;</span> <span class="bound">S</span><span class="main">≠</span><span class="main">{}</span><span class="main">;</span> <span class="skolem">m</span><span class="main">+</span><span class="numeral">2</span><span class="main">=</span>card <span class="bound">S</span><span class="main">⟧</span>
      <span class="main">⟹</span>  is_interval <span class="main">(</span><span class="main">⋂</span><span class="bound">S</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">m</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> 0
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">S</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">I</span></span> <span class="skolem"><span class="skolem">J</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span><span class="main">=</span><span class="main">{</span><span class="skolem">I</span><span class="main">,</span><span class="skolem">J</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">I</span><span class="main">≠</span><span class="skolem">J</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> card_2_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">I</span><span class="main">∈</span><span class="skolem">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">J</span><span class="main">∈</span><span class="skolem">S</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_interval <span class="skolem">I</span>"</span></span> <span class="quoted"><span class="quoted">"is_interval <span class="skolem">J</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">I</span><span class="main">⊆</span><span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">J</span><span class="main">⊆</span><span class="free">P</span>"</span></span>
           <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted">"0.prems"</span><span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span> 
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">I</span><span class="main">∩</span><span class="skolem">J</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span><span class="main">=</span><span class="main">{</span><span class="skolem">I</span><span class="main">,</span><span class="skolem">J</span><span class="main">}</span>›</span></span> <span class="quoted">"0.prems"</span><span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_interval<span class="main">(</span><span class="skolem">I</span><span class="main">∩</span><span class="skolem">J</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> calculation int_of_ints_is_interval<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> I<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">I</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> J<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">J</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> P<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">P</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">I</span><span class="main">,</span> <span class="skolem">J</span><span class="main">}</span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">S'</span></span> <span class="skolem"><span class="skolem">I</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">I</span><span class="main">∈</span><span class="skolem">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">=</span> insert <span class="skolem">I</span> <span class="skolem">S'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">I</span><span class="main">∉</span><span class="skolem">S'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Suc.prems<span class="main">(</span>4<span class="main">,</span>5<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Set.set_insert finite.simps insertI1<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_interval <span class="main">(</span><span class="main">⋂</span><span class="skolem">S'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span><span class="main">+</span><span class="numeral">2</span> <span class="main">=</span> card <span class="skolem">S'</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> Suc.prems<span class="main">(</span>4<span class="main">,</span>6<span class="main">)</span> <span class="quoted"><span class="quoted">`<span class="skolem">S</span> <span class="main">=</span> insert <span class="skolem">I</span> <span class="skolem">S'</span>`</span></span> <span class="quoted"><span class="quoted">`<span class="skolem">I</span><span class="main">∉</span><span class="skolem">S'</span>`</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">S'</span><span class="main">.</span> is_interval <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">⊆</span> <span class="free">P</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Suc.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">=</span> insert <span class="skolem">I</span> <span class="skolem">S'</span>›</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋂</span> <span class="skolem">S'</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> Suc.prems<span class="main">(</span>3<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">=</span> insert <span class="skolem">I</span> <span class="skolem">S'</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">S'</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> Suc.prems<span class="main">(</span>4<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">=</span> insert <span class="skolem">I</span> <span class="skolem">S'</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> Suc<span class="main">(</span>1<span class="main">)</span> <span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> S<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">S'</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_interval <span class="main">(</span><span class="main">(</span><span class="main">⋂</span><span class="skolem">S'</span><span class="main">)</span><span class="main">∩</span><span class="skolem">I</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> int_of_ints_is_interval<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_interval <span class="skolem">I</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Suc.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">I</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋂</span><span class="skolem">S'</span> <span class="main">⊆</span> <span class="free">P</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">I</span> <span class="main">∉</span> <span class="skolem">S'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">=</span> insert <span class="skolem">I</span> <span class="skolem">S'</span>›</span></span> Suc.prems<span class="main">(</span>1<span class="main">,</span>4<span class="main">,</span>6<span class="main">)</span> Inter_subset
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_n_not_le_n card.empty card_insert_disjoint finite_insert
              le_add2 numeral_2_eq_2 subset_eq subset_insertI<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">I</span> <span class="main">⊆</span> <span class="free">P</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Suc.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">I</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">∈</span> <span class="free">𝒫</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋂</span><span class="skolem">S'</span> <span class="main">∩</span> <span class="skolem">I</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> Suc.prems<span class="main">(</span>3<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">=</span> insert <span class="skolem">I</span> <span class="skolem">S'</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">=</span> insert <span class="skolem">I</span> <span class="skolem">S'</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf.commute<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">m</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">=</span> <span class="skolem">n</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">=</span> card <span class="free">S</span>›</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(*context MinkowskiSpacetime*)</span>



<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"3.7 Continuity and the monotonic sequence property"</span></span>
<span class="keyword1"><span class="command">context</span></span> MinkowskiSpacetime <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  This section only includes a proof of the first part of Theorem 12, as well as some results
  that would be useful in proving part (ii).
›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> <span class="comment1">(*12(i)*)</span> two_rays<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> path_Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span><span class="main">∈</span><span class="free">𝒫</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> event_a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">∈</span><span class="free">Q</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">R</span> <span class="bound">L</span><span class="main">.</span> <span class="main">(</span>is_ray_on <span class="bound">R</span> <span class="free">Q</span> <span class="main">∧</span> is_ray_on <span class="bound">L</span> <span class="free">Q</span>
                <span class="main">∧</span> <span class="free">Q</span><span class="main">-</span><span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">(</span><span class="bound">R</span> <span class="main">∪</span> <span class="bound">L</span><span class="main">)</span>               <span class="comment1">⌦‹events of Q excl. a belong to two rays›</span>
                <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">r</span><span class="main">∈</span><span class="bound">R</span><span class="main">.</span> <span class="main">∀</span><span class="bound">l</span><span class="main">∈</span><span class="bound">L</span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="bound">l</span> <span class="free">a</span> <span class="bound">r</span><span class="main"><span class="free">]]</span></span><span class="main">)</span>       <span class="comment1">⌦‹a is betw any 'a of one ray and any 'a of the other›</span>
                <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="bound">R</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="bound">R</span><span class="main">.</span> <span class="main">¬</span> <span class="main"><span class="free">[[</span></span><span class="bound">x</span> <span class="free">a</span> <span class="bound">y</span><span class="main"><span class="free">]]</span></span><span class="main">)</span>     <span class="comment1">⌦‹but a is not betw any two events …›</span>
                <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="bound">L</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="bound">L</span><span class="main">.</span> <span class="main">¬</span> <span class="main"><span class="free">[[</span></span><span class="bound">x</span> <span class="free">a</span> <span class="bound">y</span><span class="main"><span class="free">]]</span></span><span class="main">)</span><span class="main">)</span>"</span></span>   <span class="comment1">⌦‹… of the same ray›</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Schutz here uses Theorem 6, but we don't need it.›</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">∈</span><span class="free">ℰ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">∈</span><span class="free">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">≠</span><span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> event_a ge2_events in_path_event path_Q <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?L</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="bound">x</span> <span class="free">a</span> <span class="skolem">b</span><span class="main"><span class="free">]]</span></span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="bound">y</span> <span class="skolem">b</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main">[[</span><span class="free">a</span> <span class="skolem">b</span> <span class="bound">y</span><span class="main">⟧</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">=</span> <span class="var">?L</span> <span class="main">∪</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">∪</span> <span class="var">?R</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> inQ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">Q</span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="bound">x</span> <span class="free">a</span> <span class="skolem">b</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="bound">x</span><span class="main">=</span><span class="free">a</span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="bound">x</span> <span class="skolem">b</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main">[[</span><span class="free">a</span> <span class="skolem">b</span> <span class="bound">x</span><span class="main">⟧</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">∈</span> <span class="free">Q</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">≠</span> <span class="free">a</span>›</span></span> abc_sym event_a path_Q some_betw<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">safe</span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">Q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main"><span class="free">[[</span></span><span class="skolem">x</span> <span class="free">a</span> <span class="skolem">b</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="skolem">x</span> <span class="skolem">b</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">≠</span> <span class="skolem">x</span>"</span></span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="skolem">b</span> <span class="skolem">x</span><span class="main"><span class="free">]]</span></span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> inQ <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>  
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="skolem">x</span> <span class="free">a</span> <span class="skolem">b</span><span class="main"><span class="free">]]</span></span>"</span></span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">Q</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">∈</span> <span class="free">Q</span>›</span></span> abc_abc_neq betw_a_in_path event_a path_Q<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">Q</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> event_a<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="skolem">x</span> <span class="skolem">b</span><span class="main"><span class="free">]]</span></span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">Q</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">∈</span> <span class="free">Q</span>›</span></span> abc_abc_neq betw_b_in_path event_a path_Q<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="skolem">b</span> <span class="skolem">x</span><span class="main"><span class="free">]]</span></span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">Q</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">∈</span> <span class="free">Q</span>›</span></span> abc_abc_neq betw_c_in_path event_a path_Q<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="free">Q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">∈</span> <span class="free">Q</span>›</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> disjointLR<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">∩</span> <span class="var">?R</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> abc_abc_neq abc_only_cba <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">have</span></span> wxyz_ord<span class="main">:</span> <span class="quoted"><span class="quoted">"nonstrict_betw_right4 <span class="skolem">x</span> <span class="free">a</span> <span class="skolem">y</span> <span class="skolem">b</span> <span class="main">∨</span> nonstrict_betw_right4 <span class="skolem">x</span> <span class="free">a</span> <span class="skolem">b</span> <span class="skolem">y</span>
      <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="main"><span class="free">[[</span></span><span class="skolem">w</span> <span class="skolem">x</span> <span class="free">a</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="main"><span class="free">[[</span></span><span class="skolem">x</span> <span class="free">a</span> <span class="skolem">y</span><span class="main"><span class="free">]]</span></span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main"><span class="free">[[</span></span><span class="skolem">x</span> <span class="skolem">w</span> <span class="free">a</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="main"><span class="free">[[</span></span><span class="skolem">w</span> <span class="free">a</span> <span class="skolem">y</span><span class="main"><span class="free">]]</span></span><span class="main">)</span><span class="main">)</span>
      <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="main"><span class="free">[[</span></span><span class="skolem">x</span> <span class="free">a</span> <span class="skolem">y</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="skolem">y</span> <span class="skolem">z</span><span class="main"><span class="free">]]</span></span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main"><span class="free">[[</span></span><span class="skolem">x</span> <span class="free">a</span> <span class="skolem">z</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="skolem">z</span> <span class="skolem">y</span><span class="main"><span class="free">]]</span></span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="var">?L</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span><span class="main">∈</span><span class="var">?L</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">∈</span><span class="var">?R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span><span class="main">∈</span><span class="var">?R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span><span class="main">≠</span><span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">≠</span><span class="skolem">z</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">w</span> <span class="skolem">y</span> <span class="skolem">z</span>
    <span class="keyword1"><span class="command">using</span></span> path_finsubset_chain order_finite_chain2 <span class="comment1">(* Schutz says: implied by thm 10 &amp; 2 *)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> abc_abd_bcdbdc abc_bcd_abd abc_sym abd_bcd_abc mem_Collect_eq that<span class="main">)</span> <span class="comment1">(* impressive! *)</span>

  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="var">?L</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">∈</span><span class="var">?R</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">∈</span> <span class="free">Q</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">≠</span> <span class="free">a</span>›</span></span> abc_sym event_a mem_Collect_eq path_Q prolong_betw2<span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">w</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span><span class="main">∈</span><span class="var">?L</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span><span class="main">≠</span><span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">∈</span> <span class="free">Q</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">≠</span> <span class="free">a</span>›</span></span> abc_sym event_a mem_Collect_eq path_Q prolong_betw3<span class="main">)</span> 
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span><span class="main">∈</span><span class="var">?R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">≠</span><span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">∈</span> <span class="free">Q</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">≠</span> <span class="free">a</span>›</span></span> event_a mem_Collect_eq path_Q prolong_betw3<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_ray_on <span class="var">?R</span> <span class="free">Q</span> <span class="main">∧</span>
          is_ray_on <span class="var">?L</span> <span class="free">Q</span> <span class="main">∧</span>
          <span class="free">Q</span> <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">⊆</span> <span class="var">?R</span> <span class="main">∪</span> <span class="var">?L</span> <span class="main">∧</span>
          <span class="main">(</span><span class="main">∀</span><span class="bound">r</span><span class="main">∈</span><span class="var">?R</span><span class="main">.</span> <span class="main">∀</span><span class="bound">l</span><span class="main">∈</span><span class="var">?L</span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="bound">l</span> <span class="free">a</span> <span class="bound">r</span><span class="main"><span class="free">]]</span></span><span class="main">)</span> <span class="main">∧</span>
          <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="var">?R</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="var">?R</span><span class="main">.</span> <span class="main">¬</span> <span class="main"><span class="free">[[</span></span><span class="bound">x</span> <span class="free">a</span> <span class="bound">y</span><span class="main"><span class="free">]]</span></span><span class="main">)</span> <span class="main">∧</span>
          <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="var">?L</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="var">?L</span><span class="main">.</span> <span class="main">¬</span> <span class="main"><span class="free">[[</span></span><span class="bound">x</span> <span class="free">a</span> <span class="bound">y</span><span class="main"><span class="free">]]</span></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_ray_on <span class="var">?L</span> <span class="free">Q</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> is_ray_on_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">∈</span> <span class="free">𝒫</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> path_Q<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> 
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="skolem">x</span> <span class="free">a</span> <span class="skolem">b</span><span class="main"><span class="free">]]</span></span>"</span></span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">Q</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">∈</span> <span class="free">Q</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">≠</span> <span class="free">a</span>›</span></span> betw_a_in_path event_a path_Q <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_ray <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="bound">x</span> <span class="free">a</span> <span class="skolem">b</span><span class="main"><span class="free">]]</span></span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="skolem">x</span> <span class="free">a</span> <span class="skolem">b</span><span class="main"><span class="free">]]</span></span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span><span class="main">∈</span><span class="var">?L</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">=</span> ray <span class="free">a</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ray <span class="free">a</span> <span class="skolem">x</span> <span class="main">⊆</span> <span class="var">?L</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">e</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span><span class="main">∈</span>ray <span class="free">a</span> <span class="skolem">x</span>"</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span><span class="main">∈</span><span class="var">?L</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> wxyz_ord ray_cases abc_bcd_abd abd_bcd_abc abc_sym
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="skolem">x</span> <span class="free">a</span> <span class="skolem">b</span><span class="main"><span class="free">]]</span></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">e</span> <span class="main">∈</span> ray <span class="free">a</span> <span class="skolem">x</span>›</span></span> mem_Collect_eq<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">⊆</span> ray <span class="free">a</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">e</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span><span class="main">∈</span><span class="var">?L</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="skolem">e</span> <span class="free">a</span> <span class="skolem">b</span><span class="main"><span class="free">]]</span></span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span><span class="main">∈</span>ray <span class="free">a</span> <span class="skolem">x</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span><span class="main">=</span><span class="skolem">x</span>"</span></span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ray_def<span class="main">)</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span><span class="main">≠</span><span class="skolem">x</span>"</span></span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="skolem">e</span> <span class="skolem">x</span> <span class="free">a</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="skolem">x</span> <span class="skolem">e</span> <span class="free">a</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> wxyz_ord
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="skolem">e</span> <span class="free">a</span> <span class="skolem">b</span><span class="main"><span class="free">]]</span></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="skolem">x</span> <span class="free">a</span> <span class="skolem">b</span><span class="main"><span class="free">]]</span></span>›</span></span> abc_abd_bcdbdc abc_sym<span class="main">)</span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span><span class="main">∈</span>ray <span class="free">a</span> <span class="skolem">x</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Un_iff abc_sym insertCI pro_betw ray_def seg_betw<span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"is_ray <span class="var">?L</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="comment1">(*
 1. Q ∈ 𝒫
 2. ⋀x. [[a x b]] ⟹ x ∈ Q
 3. ⋀x. [[a b x]] ⟹ x ∈ Q
 4. ⋀x. b ∈ Q
 5. is_ray {y. [[a y b]] ∨ [[a b y⟧}
*)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_ray_on <span class="var">?R</span> <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> is_ray_on_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">∈</span> <span class="free">𝒫</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> path_Q<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span> 
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> 
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="skolem">x</span> <span class="skolem">b</span><span class="main"><span class="free">]]</span></span>"</span></span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">Q</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">∈</span> <span class="free">Q</span>›</span></span> abc_abc_neq betw_b_in_path event_a path_Q<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="skolem">b</span> <span class="skolem">x</span><span class="main"><span class="free">]]</span></span>"</span></span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">Q</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">∈</span> <span class="free">Q</span>›</span></span> abc_abc_neq betw_c_in_path event_a path_Q<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="free">Q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">∈</span> <span class="free">Q</span>›</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_ray <span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="bound">y</span> <span class="skolem">b</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main">[[</span><span class="free">a</span> <span class="skolem">b</span> <span class="bound">y</span><span class="main">⟧</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="skolem">y</span> <span class="skolem">b</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="skolem">b</span> <span class="skolem">y</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="skolem">y</span><span class="main">=</span><span class="skolem">b</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span><span class="main">∈</span><span class="var">?R</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?R</span> <span class="main">=</span> ray <span class="free">a</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ray <span class="free">a</span> <span class="skolem">y</span> <span class="main">⊆</span> <span class="var">?R</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">e</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span><span class="main">∈</span>ray <span class="free">a</span> <span class="skolem">y</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="skolem">e</span> <span class="skolem">y</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="skolem">y</span> <span class="skolem">e</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="skolem">y</span><span class="main">=</span><span class="skolem">e</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> ray_cases <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span><span class="main">∈</span><span class="var">?R</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">≠</span> <span class="skolem">b</span>"</span></span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">e</span> <span class="main">≠</span> <span class="skolem">y</span> <span class="main">∧</span> <span class="skolem">e</span> <span class="main">≠</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">∧</span> <span class="main"><span class="free">[[</span></span><span class="skolem">w</span> <span class="free">a</span> <span class="skolem">y</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="skolem">e</span> <span class="skolem">b</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main">[[</span><span class="free">a</span> <span class="skolem">b</span> <span class="skolem">e</span><span class="main">⟧</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="skolem">y</span> <span class="skolem">b</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="skolem">b</span> <span class="skolem">y</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">b</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">w</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="bound">x</span> <span class="free">a</span> <span class="skolem">b</span><span class="main"><span class="free">]]</span></span><span class="main">}</span>›</span></span> abd_bcd_abc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="skolem">e</span> <span class="skolem">b</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main">[[</span><span class="free">a</span> <span class="skolem">b</span> <span class="skolem">e</span><span class="main">⟧</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> abc_abd_bcdbdc abc_bcd_abd abd_bcd_abc
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="skolem">e</span> <span class="skolem">y</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main">[[</span><span class="free">a</span> <span class="skolem">y</span> <span class="skolem">e</span><span class="main">⟧</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">w</span> <span class="main">∈</span> <span class="var">?L</span>›</span></span> mem_Collect_eq<span class="main">)</span>
            <span class="keyword1"><span class="command">}</span></span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?R</span> <span class="main">⊆</span> ray <span class="free">a</span> <span class="skolem">y</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">e</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span><span class="main">∈</span><span class="var">?R</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> aeb_cases<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="skolem">e</span> <span class="skolem">b</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="skolem">b</span> <span class="skolem">e</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="skolem">e</span><span class="main">=</span><span class="skolem">b</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">hence</span></span> aey_cases<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="skolem">e</span> <span class="skolem">y</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="skolem">y</span> <span class="skolem">e</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="skolem">e</span><span class="main">=</span><span class="skolem">y</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> abc_abd_bcdbdc abc_bcd_abd abd_bcd_abc
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="skolem">y</span> <span class="skolem">b</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="skolem">b</span> <span class="skolem">y</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">b</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="bound">x</span> <span class="free">a</span> <span class="skolem">b</span><span class="main"><span class="free">]]</span></span><span class="main">}</span>›</span></span> mem_Collect_eq<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span><span class="main">∈</span>ray <span class="free">a</span> <span class="skolem">y</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">{</span></span>
              <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span><span class="main">=</span><span class="skolem">b</span>"</span></span>
              <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="skolem">y</span> <span class="skolem">b</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="skolem">b</span> <span class="skolem">y</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">b</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">≠</span> <span class="free">a</span>›</span></span> pro_betw ray_def seg_betw <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
              <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="skolem">e</span> <span class="skolem">b</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="skolem">b</span> <span class="skolem">e</span><span class="main"><span class="free">]]</span></span>"</span></span>
              <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">≠</span><span class="skolem">e</span>"</span></span>
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="skolem">e</span> <span class="skolem">y</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="skolem">y</span> <span class="skolem">e</span><span class="main"><span class="free">]]</span></span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> aey_cases <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span><span class="main">∈</span>ray <span class="free">a</span> <span class="skolem">y</span>"</span></span>
                <span class="keyword1"><span class="command">unfolding</span></span> ray_def <span class="keyword1"><span class="command">using</span></span> abc_abc_neq pro_betw seg_betw <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
              <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="skolem">e</span> <span class="skolem">b</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="skolem">b</span> <span class="skolem">e</span><span class="main"><span class="free">]]</span></span>"</span></span>
              <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">=</span><span class="skolem">e</span>"</span></span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span><span class="main">∈</span>ray <span class="free">a</span> <span class="skolem">y</span>"</span></span>
                <span class="keyword1"><span class="command">unfolding</span></span> ray_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">=</span> <span class="skolem">e</span>›</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">}</span></span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">using</span></span> aeb_cases <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"is_ray <span class="var">?R</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">r</span><span class="main">∈</span><span class="var">?R</span><span class="main">.</span> <span class="main">∀</span><span class="bound">l</span><span class="main">∈</span><span class="var">?L</span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="bound">l</span> <span class="free">a</span> <span class="bound">r</span><span class="main"><span class="free">]]</span></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> abd_bcd_abc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="var">?R</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="var">?R</span><span class="main">.</span> <span class="main">¬</span> <span class="main"><span class="free">[[</span></span><span class="bound">x</span> <span class="free">a</span> <span class="bound">y</span><span class="main"><span class="free">]]</span></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> abc_ac_neq abc_bcd_abd abd_bcd_abc mem_Collect_eq<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="var">?L</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="var">?L</span><span class="main">.</span> <span class="main">¬</span> <span class="main"><span class="free">[[</span></span><span class="bound">x</span> <span class="free">a</span> <span class="bound">y</span><span class="main"><span class="free">]]</span></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> abc_abc_neq abc_abd_bcdbdc abc_only_cba <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span><span class="main">-</span><span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">⊆</span> <span class="var">?R</span> <span class="main">∪</span> <span class="var">?L</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Q</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="bound">x</span> <span class="free">a</span> <span class="skolem">b</span><span class="main"><span class="free">]]</span></span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="bound">y</span> <span class="skolem">b</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main">[[</span><span class="free">a</span> <span class="skolem">b</span> <span class="bound">y</span><span class="main">⟧</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The definition <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>closest_to›</span></span></span></span> in prose:
  Pick any $r \in R$. The closest event $c$ is such that there is no closer event in $L$,
  i.e. all other events of $L$ are further away from $r$.
  Thus in $L$, $c$ is the element closest to $R$.
›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">closest_to</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> set<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> set<span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">closest_to</span> <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">r</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">R</span></span></span><span class="main">.</span> <span class="main">∀</span><span class="bound">l</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">L</span></span></span><span class="main">-</span><span class="main">{</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">}</span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="bound">l</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="bound">r</span><span class="main"><span class="free">]]</span></span><span class="main">)</span>"</span></span>


<span class="keyword1" id="TemporalOrderOnPath-int_on_path"><span class="command">lemma</span></span> int_on_path<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span><span class="main">∈</span><span class="free">L</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="main">∈</span><span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span><span class="main">∈</span><span class="free">𝒫</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> partition<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">L</span><span class="main">⊆</span><span class="free">Q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">L</span><span class="main">≠</span><span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span><span class="main">⊆</span><span class="free">Q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span><span class="main">≠</span><span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">L</span><span class="main">∪</span><span class="free">R</span><span class="main">=</span><span class="free">Q</span>"</span></span> <span class="comment1">(*disjoint?*)</span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"interval <span class="free">l</span> <span class="free">r</span> <span class="main">⊆</span> <span class="free">Q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span>interval <span class="free">l</span> <span class="free">r</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="free">Q</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> interval_def segment_def
    <span class="keyword1"><span class="command">using</span></span> betw_b_in_path partition<span class="main">(</span>5<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="free">Q</span><span class="main">∈</span><span class="free">𝒫</span>›</span></span> seg_betw <span class="quoted"><span class="quoted">‹<span class="free">l</span> <span class="main">∈</span> <span class="free">L</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span> <span class="main">∈</span> <span class="free">R</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="TemporalOrderOnPath-ray_of_bounds1"><span class="command">lemma</span></span> ray_of_bounds1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span><span class="main">∈</span><span class="free">𝒫</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">f</span><span class="main">[</span><span class="main">(</span><span class="free">f</span> <span class="main">0</span><span class="main">)</span><span class="main">..]</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span><span class="main">⊆</span><span class="free">Q</span>"</span></span> <span class="quoted"><span class="quoted">"closest_bound <span class="free">c</span> <span class="free">X</span>"</span></span> <span class="quoted"><span class="quoted">"is_bound_f <span class="free">b</span> <span class="free">X</span> <span class="free">f</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">≠</span><span class="free">c</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_bound_f <span class="free">x</span> <span class="free">X</span> <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">=</span><span class="free">b</span> <span class="main">∨</span> <span class="free">x</span><span class="main">=</span><span class="free">c</span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">c</span> <span class="free">x</span> <span class="free">b</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">c</span> <span class="free">b</span> <span class="free">x</span><span class="main"><span class="free">]]</span></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">∈</span><span class="free">Q</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> bound_on_path assms<span class="main">(</span>1<span class="main">,</span>3<span class="main">,</span>7<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> all_bounds_def is_bound_def is_bound_f_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">=</span><span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">=</span><span class="free">c</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">≠</span><span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">≠</span><span class="free">c</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> abc_abd_bcdbdc assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">,</span></span>5<span class="main"><span class="main">,</span></span>6<span class="main"><span class="main">,</span></span>7<span class="main"><span class="main">)</span></span> closest_bound_def is_bound_def<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="TemporalOrderOnPath-ray_of_bounds2"><span class="command">lemma</span></span> ray_of_bounds2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span><span class="main">∈</span><span class="free">𝒫</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">f</span><span class="main">[</span><span class="main">(</span><span class="free">f</span> <span class="main">0</span><span class="main">)</span><span class="main">..]</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span><span class="main">⊆</span><span class="free">Q</span>"</span></span> <span class="quoted"><span class="quoted">"closest_bound_f <span class="free">c</span> <span class="free">X</span> <span class="free">f</span>"</span></span> <span class="quoted"><span class="quoted">"is_bound_f <span class="free">b</span> <span class="free">X</span> <span class="free">f</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">≠</span><span class="free">c</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">=</span><span class="free">b</span> <span class="main">∨</span> <span class="free">x</span><span class="main">=</span><span class="free">c</span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">c</span> <span class="free">x</span> <span class="free">b</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">c</span> <span class="free">b</span> <span class="free">x</span><span class="main"><span class="free">]]</span></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_bound_f <span class="free">x</span> <span class="free">X</span> <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">∈</span><span class="free">Q</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>3<span class="main">,</span>4<span class="main">,</span>5<span class="main">,</span>6<span class="main">,</span>7<span class="main">)</span> betw_b_in_path betw_c_in_path bound_on_path
    <span class="keyword1"><span class="command">using</span></span> closest_bound_f_def is_bound_f_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">=</span><span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">=</span><span class="free">c</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> closest_bound_f_def<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">c</span> <span class="free">x</span> <span class="free">b</span><span class="main"><span class="free">]]</span></span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> is_bound_f_def
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">safe</span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span><span class="main">::</span><span class="quoted">nat</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">f</span><span class="main">[</span><span class="free">f</span> <span class="main">0</span><span class="main">..]</span><span class="free">X</span><span class="main">]</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">&lt;</span><span class="skolem">j</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="skolem">i</span><span class="main">)</span><span class="main">(</span><span class="free">f</span> <span class="skolem">j</span><span class="main">)</span><span class="free">b</span><span class="main"><span class="free">]]</span></span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>5<span class="main">)</span> is_bound_f_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="skolem">j</span><span class="main">)</span> <span class="free">b</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="skolem">j</span><span class="main">)</span> <span class="free">c</span> <span class="free">b</span><span class="main"><span class="free">]]</span></span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">j</span>›</span></span> abc_abd_bcdbdc assms<span class="main">(</span>4<span class="main">,</span>6<span class="main">)</span> closest_bound_f_def is_bound_f_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="skolem">i</span><span class="main">)</span><span class="main">(</span><span class="free">f</span> <span class="skolem">j</span><span class="main">)</span><span class="main">(</span><span class="free">x</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="free">c</span> <span class="free">x</span> <span class="free">b</span><span class="main"><span class="free">]]</span></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="skolem">i</span><span class="main">)</span><span class="main">(</span><span class="free">f</span> <span class="skolem">j</span><span class="main">)</span><span class="free">b</span><span class="main"><span class="free">]]</span></span>›</span></span> abc_bcd_acd abc_sym abd_bcd_abc<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">c</span> <span class="free">b</span> <span class="free">x</span><span class="main"><span class="free">]]</span></span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> is_bound_f_def
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">safe</span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span><span class="main">::</span><span class="quoted">nat</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">f</span><span class="main">[</span><span class="free">f</span> <span class="main">0</span><span class="main">..]</span><span class="free">X</span><span class="main">]</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">&lt;</span><span class="skolem">j</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="skolem">i</span><span class="main">)</span><span class="main">(</span><span class="free">f</span> <span class="skolem">j</span><span class="main">)</span><span class="free">b</span><span class="main"><span class="free">]]</span></span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>5<span class="main">)</span> is_bound_f_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="skolem">j</span><span class="main">)</span> <span class="free">b</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="skolem">j</span><span class="main">)</span> <span class="free">c</span> <span class="free">b</span><span class="main"><span class="free">]]</span></span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">j</span>›</span></span> abc_abd_bcdbdc assms<span class="main">(</span>4<span class="main">,</span>6<span class="main">)</span> closest_bound_f_def is_bound_f_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="skolem">i</span><span class="main">)</span><span class="main">(</span><span class="free">f</span> <span class="skolem">j</span><span class="main">)</span><span class="main">(</span><span class="free">x</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span> <span class="main">=</span> <span class="free">b</span><span class="main">)</span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="main">0</span><span class="main">)</span> <span class="free">c</span> <span class="free">b</span><span class="main"><span class="free">]]</span></span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">,</span>5<span class="main">)</span> closest_bound_f_def is_bound_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="skolem">j</span><span class="main">)</span> <span class="free">b</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span> <span class="main">⟶</span> <span class="main"><span class="free">[[</span></span><span class="free">x</span><span class="main">(</span><span class="free">f</span> <span class="skolem">j</span><span class="main">)</span><span class="main">(</span><span class="free">f</span> <span class="skolem">i</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> abc_bcd_acd abc_only_cba<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> is_bound_f_def neq0_conv<span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="free">c</span> <span class="free">b</span> <span class="free">x</span><span class="main"><span class="free">]]</span></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="skolem">i</span><span class="main">)</span><span class="main">(</span><span class="free">f</span> <span class="skolem">j</span><span class="main">)</span><span class="free">b</span><span class="main"><span class="free">]]</span></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="skolem">j</span><span class="main">)</span> <span class="free">b</span> <span class="free">c</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="skolem">j</span><span class="main">)</span> <span class="free">c</span> <span class="free">b</span><span class="main"><span class="free">]]</span></span>›</span></span> abc_bcd_acd abc_sym
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>7<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="TemporalOrderOnPath-ray_of_bounds3"><span class="command">lemma</span></span> ray_of_bounds3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span><span class="main">∈</span><span class="free">𝒫</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">f</span><span class="main">[</span><span class="main">(</span><span class="free">f</span> <span class="main">0</span><span class="main">)</span><span class="main">..]</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span><span class="main">⊆</span><span class="free">Q</span>"</span></span> <span class="quoted"><span class="quoted">"closest_bound_f <span class="free">c</span> <span class="free">X</span> <span class="free">f</span>"</span></span> <span class="quoted"><span class="quoted">"is_bound_f <span class="free">b</span> <span class="free">X</span> <span class="free">f</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">≠</span><span class="free">c</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"all_bounds <span class="free">X</span> <span class="main">=</span> insert <span class="free">c</span> <span class="main">(</span>ray <span class="free">c</span> <span class="free">b</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?B</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"all_bounds <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?C</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"insert <span class="free">c</span> <span class="main">(</span>ray <span class="free">c</span> <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?B</span> <span class="main">⊆</span> <span class="var">?C</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="var">?B</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"is_bound <span class="skolem">x</span> <span class="free">X</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> all_bounds_def<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="free">b</span> <span class="main">∨</span> <span class="skolem">x</span><span class="main">=</span><span class="free">c</span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">c</span> <span class="skolem">x</span> <span class="free">b</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">c</span> <span class="free">b</span> <span class="skolem">x</span><span class="main"><span class="free">]]</span></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ray_of_bounds1 abc_abd_bcdbdc assms<span class="main">(</span>4<span class="main">,</span>5<span class="main">,</span>6<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> closest_bound_f_def is_bound_def<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="var">?C</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> pro_betw ray_def seg_betw <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?C</span> <span class="main">⊆</span> <span class="var">?B</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="var">?C</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="free">b</span> <span class="main">∨</span> <span class="skolem">x</span><span class="main">=</span><span class="free">c</span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">c</span> <span class="skolem">x</span> <span class="free">b</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="free">c</span> <span class="free">b</span> <span class="skolem">x</span><span class="main"><span class="free">]]</span></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> pro_betw ray_def seg_betw <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"is_bound <span class="skolem">x</span> <span class="free">X</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> is_bound_def <span class="keyword1"><span class="command">using</span></span> ray_of_bounds2 assms
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="var">?B</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> all_bounds_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="TemporalOrderOnPath-ray_of_bounds"><span class="command">lemma</span></span> ray_of_bounds<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">f</span><span class="main">[</span><span class="main">(</span><span class="free">f</span> <span class="main">0</span><span class="main">)</span><span class="main">..]</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"closest_bound_f <span class="free">c</span> <span class="free">X</span> <span class="free">f</span>"</span></span> <span class="quoted"><span class="quoted">"is_bound_f <span class="free">b</span> <span class="free">X</span> <span class="free">f</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">≠</span><span class="free">c</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"all_bounds <span class="free">X</span> <span class="main">=</span> insert <span class="free">c</span> <span class="main">(</span>ray <span class="free">c</span> <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> ray_of_bounds3 assms semifin_chain_on_path <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


<span class="keyword1" id="TemporalOrderOnPath-int_in_closed_ray"><span class="command">lemma</span></span> int_in_closed_ray<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"path <span class="free">ab</span> <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"interval <span class="free">a</span> <span class="free">b</span> <span class="main">⊂</span> insert <span class="free">a</span> <span class="main">(</span>ray <span class="free">a</span> <span class="free">b</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?i</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"interval <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"interval <span class="free">a</span> <span class="free">b</span> <span class="main">≠</span> insert <span class="free">a</span> <span class="main">(</span>ray <span class="free">a</span> <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="skolem">c</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> prolong_betw2
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">∈</span>ray <span class="free">a</span> <span class="free">b</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> abc_abc_neq pro_betw ray_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">∉</span>interval <span class="free">a</span> <span class="free">b</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="free">b</span> <span class="skolem">c</span><span class="main"><span class="free">]]</span></span>›</span></span> abc_abc_neq abc_only_cba<span class="main">(</span>2<span class="main">)</span> interval_def seg_betw <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c</span> <span class="main">∈</span> ray <span class="free">a</span> <span class="free">b</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"interval <span class="free">a</span> <span class="free">b</span> <span class="main">⊆</span> insert <span class="free">a</span> <span class="main">(</span>ray <span class="free">a</span> <span class="free">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> interval_def ray_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="TemporalOrderOnPath-bound_any_f"><span class="command">lemma</span></span> bound_any_f<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span><span class="main">∈</span><span class="free">𝒫</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">f</span><span class="main">[</span><span class="main">(</span><span class="free">f</span> <span class="main">0</span><span class="main">)</span><span class="main">..]</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span><span class="main">⊆</span><span class="free">Q</span>"</span></span> <span class="quoted"><span class="quoted">"is_bound <span class="free">c</span> <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_bound_f <span class="free">c</span> <span class="free">X</span> <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"is_bound_f <span class="free">c</span> <span class="free">X</span> <span class="skolem">g</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">g</span><span class="main">[</span><span class="skolem">g</span> <span class="main">0</span><span class="main">..]</span><span class="free">X</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span> is_bound_def is_bound_f_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> is_bound_f_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">safe</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span><span class="main">::</span><span class="quoted">nat</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">f</span><span class="main">[</span><span class="free">f</span> <span class="main">0</span> <span class="main">..]</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">&lt;</span><span class="skolem">j</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="skolem">g</span> <span class="skolem">i</span><span class="main">)</span><span class="main">(</span><span class="skolem">g</span> <span class="skolem">j</span><span class="main">)</span><span class="free">c</span><span class="main"><span class="free">]]</span></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">j</span>›</span></span> <span class="quoted"><span class="quoted">‹is_bound_f <span class="free">c</span> <span class="free">X</span> <span class="skolem">g</span>›</span></span> is_bound_f_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="skolem">i</span><span class="main">)</span><span class="main">(</span><span class="free">f</span> <span class="skolem">j</span><span class="main">)</span><span class="free">c</span><span class="main"><span class="free">]]</span></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> inf_chain_unique <span class="quoted"><span class="quoted">‹<span class="main">[</span><span class="skolem">g</span><span class="main">[</span><span class="skolem">g</span> <span class="main">0</span> <span class="main">..]</span><span class="free">X</span><span class="main">]</span>›</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="TemporalOrderOnPath-closest_bound_any_f"><span class="command">lemma</span></span> closest_bound_any_f<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span><span class="main">∈</span><span class="free">𝒫</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">f</span><span class="main">[</span><span class="main">(</span><span class="free">f</span> <span class="main">0</span><span class="main">)</span><span class="main">..]</span><span class="free">X</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span><span class="main">⊆</span><span class="free">Q</span>"</span></span> <span class="quoted"><span class="quoted">"closest_bound <span class="free">c</span> <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"closest_bound_f <span class="free">c</span> <span class="free">X</span> <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> closest_bound_f_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_bound_f <span class="free">c</span> <span class="free">X</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> bound_any_f assms closest_bound_def is_bound_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">Q<span class="hidden">⇩</span><sub>b</sub>'</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"is_bound <span class="skolem">Q<span class="hidden">⇩</span><sub>b</sub>'</span> <span class="free">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q<span class="hidden">⇩</span><sub>b</sub>'</span> <span class="main">≠</span> <span class="free">c</span>"</span></span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="main">0</span><span class="main">)</span> <span class="free">c</span> <span class="skolem">Q<span class="hidden">⇩</span><sub>b</sub>'</span><span class="main"><span class="free">]]</span></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">,</span></span>4<span class="main"><span class="main">)</span></span> closest_bound_def inf_chain_unique is_bound_f_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context MinkowskiSpacetime *)</span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"3.8 Connectedness of the unreachable set"</span></span>
<span class="keyword1"><span class="command">context</span></span> MinkowskiSpacetime <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Theorem 13 (Connectedness of the Unreachable Set)›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> <span class="comment1">(*13*)</span> unreach_connected<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> path_Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span><span class="main">∈</span><span class="free">𝒫</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> event_b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">∉</span><span class="free">Q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">∈</span><span class="free">ℰ</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> unreach<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Q<span class="hidden">⇩</span><sub>x</sub></span> <span class="main">∈</span> <span class="main">∅</span> <span class="free">Q</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q<span class="hidden">⇩</span><sub>z</sub></span> <span class="main">∈</span> <span class="main">∅</span> <span class="free">Q</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q<span class="hidden">⇩</span><sub>x</sub></span> <span class="main">≠</span> <span class="free">Q<span class="hidden">⇩</span><sub>z</sub></span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> xyz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">Q<span class="hidden">⇩</span><sub>x</sub></span> <span class="free">Q<span class="hidden">⇩</span><sub>y</sub></span> <span class="free">Q<span class="hidden">⇩</span><sub>z</sub></span><span class="main"><span class="free">]]</span></span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q<span class="hidden">⇩</span><sub>y</sub></span> <span class="main">∈</span> <span class="main">∅</span> <span class="free">Q</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹First we obtain the chain from I6.›</span></span>
  <span class="keyword1"><span class="command">have</span></span> in_Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Q<span class="hidden">⇩</span><sub>x</sub></span><span class="main">∈</span><span class="free">Q</span> <span class="main">∧</span> <span class="free">Q<span class="hidden">⇩</span><sub>y</sub></span><span class="main">∈</span><span class="free">Q</span> <span class="main">∧</span> <span class="free">Q<span class="hidden">⇩</span><sub>z</sub></span><span class="main">∈</span><span class="free">Q</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> betw_b_in_path path_Q unreach<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>3<span class="main">)</span> unreach_on_path xyz <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> event_y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Q<span class="hidden">⇩</span><sub>y</sub></span><span class="main">∈</span><span class="free">ℰ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> in_path_event path_Q <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">X</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> X_def<span class="main">:</span> <span class="quoted"><span class="quoted">"ch_by_ord <span class="skolem">f</span> <span class="skolem">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">0</span> <span class="main">=</span> <span class="free">Q<span class="hidden">⇩</span><sub>x</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">(</span>card <span class="skolem">X</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="free">Q<span class="hidden">⇩</span><sub>z</sub></span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span> <span class="main">..</span> card <span class="skolem">X</span> <span class="main">-</span> <span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">∈</span> <span class="main">∅</span> <span class="free">Q</span> <span class="free">b</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">Qy</span><span class="main">∈</span><span class="free">ℰ</span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="bound">Qy</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">i</span><span class="main">)</span><span class="main"><span class="free">]]</span></span> <span class="main">⟶</span> <span class="bound">Qy</span> <span class="main">∈</span> <span class="main">∅</span> <span class="free">Q</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"short_ch <span class="skolem">X</span> <span class="main">⟶</span> <span class="free">Q<span class="hidden">⇩</span><sub>x</sub></span> <span class="main">∈</span> <span class="skolem">X</span> <span class="main">∧</span> <span class="free">Q<span class="hidden">⇩</span><sub>z</sub></span> <span class="main">∈</span> <span class="skolem">X</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">Q<span class="hidden">⇩</span><sub>y</sub></span><span class="main">∈</span><span class="free">ℰ</span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="free">Q<span class="hidden">⇩</span><sub>x</sub></span> <span class="bound">Q<span class="hidden">⇩</span><sub>y</sub></span> <span class="free">Q<span class="hidden">⇩</span><sub>z</sub></span><span class="main"><span class="free">]]</span></span> <span class="main">⟶</span> <span class="bound">Q<span class="hidden">⇩</span><sub>y</sub></span> <span class="main">∈</span> <span class="main">∅</span> <span class="free">Q</span> <span class="free">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> I6 <span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1-6<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> fin_X<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">X</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> unreach<span class="main">(</span>3<span class="main">)</span> not_less <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">N</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">N</span><span class="main">=</span>card <span class="skolem">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">N</span><span class="main">≥</span><span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> X_def<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> unreach<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Then we have to manually show the bounds, defined via indices only, are in the obtained chain.
  This step made me add the two-element-chain-case to I6 in <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Minkowski.thy›</span></span></span></span>;
  this case is referenced here as <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>X_def(5)›</span></span></span></span>.
›</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?a</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?d</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">(</span>card <span class="skolem">X</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">X</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"short_ch <span class="skolem">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?a</span> <span class="main">∈</span> <span class="skolem">X</span> <span class="main">∧</span> <span class="var">?d</span> <span class="main">∈</span> <span class="skolem">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?a</span> <span class="main">≠</span> <span class="var">?d</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> X_def <span class="quoted"><span class="quoted">‹card <span class="skolem">X</span> <span class="main">=</span> <span class="numeral">2</span>›</span></span> short_ch_card_2  unreach<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">f</span><span class="main">[</span><span class="free">Q<span class="hidden">⇩</span><sub>x</sub></span><span class="main">..</span><span class="free">Q<span class="hidden">⇩</span><sub>z</sub></span><span class="main">]</span><span class="skolem">X</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> fin_chain_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> X_def<span class="main"><span class="main">(</span></span>1-3<span class="main"><span class="main">,</span></span>5<span class="main"><span class="main">)</span></span> ch_by_ord_def fin_X fin_long_chain_def get_fin_long_ch_bounds unreach<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Further on, we split the proof into two cases, namely the split Schutz absorbs into his
  non-strict ordering. Just below is the statement we use <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>disjE›</span></span></span></span> with.›</span></span>
  <span class="keyword1"><span class="command">have</span></span> y_cases<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Q<span class="hidden">⇩</span><sub>y</sub></span><span class="main">∈</span><span class="skolem">X</span> <span class="main">∨</span> <span class="free">Q<span class="hidden">⇩</span><sub>y</sub></span><span class="main">∉</span><span class="skolem">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> y_int<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Q<span class="hidden">⇩</span><sub>y</sub></span><span class="main">∈</span>interval <span class="free">Q<span class="hidden">⇩</span><sub>x</sub></span> <span class="free">Q<span class="hidden">⇩</span><sub>z</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> interval_def seg_betw xyz <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> X_in_Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span><span class="main">⊆</span><span class="free">Q</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> chain_on_path_I6 <span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> Q<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">Q</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> X<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">X</span></span><span class="main">]</span> X_def event_b path_Q unreach
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
    <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹As usual, we treat short chains separately, and they have their own clause in I6.›</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">N</span><span class="main">=</span><span class="numeral">2</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> X_def<span class="main">(</span>1<span class="main">,</span>5<span class="main">)</span> xyz <span class="quoted"><span class="quoted">‹<span class="skolem">N</span> <span class="main">=</span> card <span class="skolem">X</span>›</span></span> event_y short_ch_card_2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  This is where Schutz obtains the chain from Theorem 11. We instead use the chain we already have
  with only a part of Theorem 11, namely <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>int_split_to_segs›</span></span></span></span>. <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>?S›</span></span></span></span> is defined like in <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>segmentation›</span></span></span></span>.›</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">N</span><span class="main">≠</span><span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">N</span><span class="main">≥</span><span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="numeral">2</span> <span class="main">≤</span> <span class="skolem">N</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">≤</span>card <span class="skolem">X</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="numeral">2</span> <span class="main">≤</span> <span class="skolem">N</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">N</span> <span class="main">=</span> card <span class="skolem">X</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> y_cases
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> disjE<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q<span class="hidden">⇩</span><sub>y</sub></span><span class="main">∈</span><span class="skolem">X</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> i_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">&lt;</span>card <span class="skolem">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q<span class="hidden">⇩</span><sub>y</sub></span> <span class="main">=</span> <span class="skolem">f</span> <span class="skolem">i</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> X_def<span class="main">(</span>1<span class="main">)</span>
        <span class="keyword1"><span class="command">unfolding</span></span> ch_by_ord_def long_ch_by_ord_def ordering_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> X_def<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> abc_abc_neq fin_X short_ch_def xyz<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">≠</span><span class="main">0</span> <span class="main">∧</span> <span class="skolem">i</span><span class="main">≠</span>card <span class="skolem">X</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> X_def<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> abc_abc_neq i_def<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> xyz<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span>card <span class="skolem">X</span> <span class="main">-</span><span class="main">1</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> i_def<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> X_def<span class="main">(</span>4<span class="main">)</span> i_def<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q<span class="hidden">⇩</span><sub>y</sub></span><span class="main">∉</span><span class="skolem">X</span>"</span></span>

      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="keyword1">if</span> card <span class="skolem">X</span> <span class="main">=</span> <span class="numeral">2</span> <span class="keyword1">then</span> <span class="main">{</span>segment <span class="var">?a</span> <span class="var">?d</span><span class="main">}</span> <span class="keyword1">else</span> <span class="main">{</span>segment <span class="main">(</span><span class="skolem">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">f</span><span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">|</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">&lt;</span>card <span class="skolem">X</span> <span class="main">-</span> <span class="main">1</span><span class="main">}</span>"</span></span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q<span class="hidden">⇩</span><sub>y</sub></span><span class="main">∈</span><span class="main">⋃</span><span class="var">?S</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">f</span><span class="main">[</span><span class="free">Q<span class="hidden">⇩</span><sub>x</sub></span><span class="main">..</span><span class="skolem">c</span><span class="main">..</span><span class="free">Q<span class="hidden">⇩</span><sub>z</sub></span><span class="main">]</span><span class="skolem">X</span><span class="main">]</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> X_def<span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">N</span> <span class="main">=</span> card <span class="skolem">X</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">N</span><span class="main">≠</span><span class="numeral">2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">[</span><span class="skolem">f</span><span class="main">[</span><span class="free">Q<span class="hidden">⇩</span><sub>x</sub></span><span class="main">..</span><span class="free">Q<span class="hidden">⇩</span><sub>z</sub></span><span class="main">]</span><span class="skolem">X</span><span class="main">]</span>›</span></span> fin_chain_def short_ch_card_2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"interval <span class="free">Q<span class="hidden">⇩</span><sub>x</sub></span> <span class="free">Q<span class="hidden">⇩</span><sub>z</sub></span> <span class="main">=</span> <span class="main">⋃</span><span class="var">?S</span> <span class="main">∪</span> <span class="skolem">X</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> int_split_to_segs <span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">`<span class="main">[</span><span class="skolem">f</span><span class="main">[</span><span class="free">Q<span class="hidden">⇩</span><sub>x</sub></span><span class="main">..</span><span class="skolem">c</span><span class="main">..</span><span class="free">Q<span class="hidden">⇩</span><sub>z</sub></span><span class="main">]</span><span class="skolem">X</span><span class="main">]</span>`</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Q<span class="hidden">⇩</span><sub>y</sub></span><span class="main">∉</span><span class="skolem">X</span>›</span></span> y_int <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">∈</span><span class="var">?S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q<span class="hidden">⇩</span><sub>y</sub></span><span class="main">∈</span><span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="main">(</span>card <span class="skolem">X</span><span class="main">)</span><span class="main">-</span><span class="main">1</span><span class="main">}</span> <span class="main">∧</span> <span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="skolem">f</span><span class="main">(</span><span class="bound">i</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="free">Q<span class="hidden">⇩</span><sub>y</sub></span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">i</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i'</span></span> <span class="keyword2"><span class="keyword">where</span></span> i'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i'</span> <span class="main">&lt;</span> <span class="skolem">N</span><span class="main">-</span><span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> segment <span class="main">(</span><span class="skolem">f</span> <span class="skolem">i'</span><span class="main">)</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span><span class="skolem">i'</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Q<span class="hidden">⇩</span><sub>y</sub></span><span class="main">∈</span><span class="skolem">s</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span><span class="main">∈</span><span class="var">?S</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">N</span><span class="main">=</span>card <span class="skolem">X</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="quoted"><span class="quoted">‹<span class="numeral">2</span> <span class="main">≤</span> <span class="skolem">N</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">N</span> <span class="main">≠</span> <span class="numeral">2</span>›</span></span> le_antisym mem_Collect_eq not_less<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> conjI<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">i'</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span>card <span class="skolem">X</span> <span class="main">-</span> <span class="main">1</span><span class="main">}</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> i'_def<span class="main">(</span>1<span class="main">)</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">N</span> <span class="main">=</span> card <span class="skolem">X</span>›</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="skolem">f</span><span class="main">(</span><span class="main">(</span><span class="skolem">i'</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="free">Q<span class="hidden">⇩</span><sub>y</sub></span> <span class="main">(</span><span class="skolem">f</span><span class="main">(</span><span class="skolem">i'</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> i'_def<span class="main">(</span>2<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="free">Q<span class="hidden">⇩</span><sub>y</sub></span><span class="main">∈</span><span class="skolem">s</span>›</span></span> seg_betw <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> i_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="main">(</span>card <span class="skolem">X</span><span class="main">)</span><span class="main">-</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="skolem">f</span><span class="main">(</span><span class="skolem">i</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="free">Q<span class="hidden">⇩</span><sub>y</sub></span> <span class="main">(</span><span class="skolem">f</span> <span class="skolem">i</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> X_def<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> i_def event_y<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Theorem 14 (Second Existence Theorem)›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="comment1">(*for 14i*)</span> union_of_bounded_sets_is_bounded<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="bound">x</span> <span class="free">b</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">B</span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="free">c</span> <span class="bound">x</span> <span class="free">d</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">⊆</span><span class="free">Q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span><span class="main">⊆</span><span class="free">Q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span><span class="main">∈</span><span class="free">𝒫</span>"</span></span>
    <span class="quoted"><span class="quoted">"card <span class="free">A</span> <span class="main">&gt;</span> <span class="main">1</span> <span class="main">∨</span> infinite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"card <span class="free">B</span> <span class="main">&gt;</span> <span class="main">1</span> <span class="main">∨</span> infinite <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">l</span><span class="main">∈</span><span class="free">Q</span><span class="main">.</span> <span class="main">∃</span><span class="bound">u</span><span class="main">∈</span><span class="free">Q</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">∪</span><span class="free">B</span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="bound">l</span> <span class="bound">x</span> <span class="bound">u</span><span class="main"><span class="free">]]</span></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">A</span> <span class="bound">B</span><span class="main">.</span> <span class="main">∃</span><span class="bound">l</span><span class="main">∈</span><span class="free">Q</span><span class="main">.</span> <span class="main">∃</span><span class="bound">u</span><span class="main">∈</span><span class="free">Q</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="bound">A</span><span class="main">∪</span><span class="bound">B</span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="bound">l</span> <span class="bound">x</span> <span class="bound">u</span><span class="main"><span class="free">]]</span></span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?I</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">A</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="main">(</span>card <span class="bound">A</span> <span class="main">&gt;</span> <span class="main">1</span> <span class="main">∨</span> infinite <span class="bound">A</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="bound">A</span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="bound">a</span> <span class="bound">x</span> <span class="bound">b</span><span class="main"><span class="free">]]</span></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">A</span><span class="main">.</span> <span class="main">∃</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="var">?I</span> <span class="bound">A</span> <span class="bound">a</span> <span class="bound">b</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> on_path<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">A</span><span class="main">.</span> <span class="bound">A</span> <span class="main">⊆</span> <span class="free">Q</span> <span class="main">⟹</span> <span class="var">?I</span> <span class="bound">A</span> <span class="bound">a</span> <span class="bound">b</span> <span class="main">⟹</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free">Q</span> <span class="main">∧</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">A</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span><span class="main">⊆</span><span class="free">Q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?I</span> <span class="skolem">A</span> <span class="skolem">a</span> <span class="skolem">b</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">∈</span><span class="free">Q</span><span class="main">∧</span><span class="skolem">a</span><span class="main">∈</span><span class="free">Q</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">A</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">∧</span> finite <span class="skolem">A</span>"</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?I</span> <span class="skolem">A</span> <span class="skolem">a</span> <span class="skolem">b</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>card <span class="skolem">A</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">∧</span> finite <span class="skolem">A</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> asmA<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="skolem">A</span> <span class="main">&gt;</span> <span class="main">1</span> <span class="main">∨</span> infinite <span class="skolem">A</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="skolem">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">∈</span><span class="skolem">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">≠</span><span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> 
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">&lt;</span> card <span class="skolem">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">x</span> <span class="main">∈</span> <span class="skolem">A</span><span class="main">;</span> <span class="bound">y</span> <span class="main">∈</span> <span class="skolem">A</span><span class="main">;</span> <span class="bound">x</span> <span class="main">≠</span> <span class="bound">y</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="skolem">thesis</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def Suc_le_eq card_le_Suc_iff insert_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"infinite <span class="skolem">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">x</span> <span class="main">∈</span> <span class="skolem">A</span><span class="main">;</span> <span class="bound">y</span> <span class="main">∈</span> <span class="skolem">A</span><span class="main">;</span> <span class="bound">x</span> <span class="main">≠</span> <span class="bound">y</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="skolem">thesis</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">using</span></span> infinite_imp_nonempty <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> finite_insert finite_subset singletonI subsetI<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="free">Q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">∈</span><span class="free">Q</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">A</span> <span class="main">⊆</span> <span class="free">Q</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">A</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">A</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="skolem">a</span> <span class="skolem">x</span> <span class="skolem">b</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="skolem">a</span> <span class="skolem">y</span> <span class="skolem">b</span><span class="main"><span class="free">]]</span></span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">1</span> <span class="main">&lt;</span> card <span class="skolem">A</span> <span class="main">∨</span> infinite <span class="skolem">A</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">A</span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="skolem">a</span> <span class="bound">x</span> <span class="skolem">b</span><span class="main"><span class="free">]]</span></span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">A</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">A</span>›</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span> 
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"betw4 <span class="skolem">a</span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">b</span> <span class="main">∨</span> betw4 <span class="skolem">a</span> <span class="skolem">y</span> <span class="skolem">x</span> <span class="skolem">b</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">y</span>›</span></span> abd_acd_abcdacbd <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">∈</span><span class="free">Q</span> <span class="main">∧</span> <span class="skolem">b</span><span class="main">∈</span><span class="free">Q</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">Q</span><span class="main">∈</span><span class="free">𝒫</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span><span class="main">∈</span><span class="free">Q</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span><span class="main">≠</span><span class="skolem">y</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span><span class="main">∈</span><span class="free">Q</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span><span class="main">∈</span><span class="free">Q</span>›</span></span> betw_a_in_path betw_c_in_path <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">≠</span><span class="free">b</span> <span class="main">∧</span> <span class="free">a</span><span class="main">≠</span><span class="free">c</span> <span class="main">∧</span> <span class="free">a</span><span class="main">≠</span><span class="free">d</span> <span class="main">∧</span> <span class="free">b</span><span class="main">≠</span><span class="free">c</span> <span class="main">∧</span> <span class="free">b</span><span class="main">≠</span><span class="free">d</span> <span class="main">∧</span> <span class="free">c</span><span class="main">≠</span><span class="free">d</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="free">A</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule_tac</span> P<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="var">?P</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> A<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">Q</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> wlog_endpoints_distinct<span class="main">)</span>

      <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹First, some technicalities: the relations $P, I, R$ have the symmetry required.›</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">I</span><span class="main">.</span> <span class="var">?I</span> <span class="bound">I</span> <span class="bound">a</span> <span class="bound">b</span> <span class="main">⟹</span> <span class="var">?I</span> <span class="bound">I</span> <span class="bound">b</span> <span class="bound">a</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> abc_sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">A</span><span class="main">.</span> <span class="bound">A</span> <span class="main">⊆</span> <span class="free">Q</span> <span class="main">⟹</span> <span class="var">?I</span> <span class="bound">A</span> <span class="bound">a</span> <span class="bound">b</span> <span class="main">⟹</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free">Q</span> <span class="main">∧</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">Q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> on_path assms<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">I</span> <span class="bound">J</span><span class="main">.</span> <span class="var">?R</span> <span class="bound">I</span> <span class="main">⟹</span> <span class="var">?R</span> <span class="bound">J</span> <span class="main">⟹</span> <span class="var">?P</span> <span class="bound">I</span> <span class="bound">J</span> <span class="main">⟹</span> <span class="var">?P</span> <span class="bound">J</span> <span class="bound">I</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Un_commute<span class="main">)</span>

      <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Next, the lemma/case assumptions have to be repeated for Isabelle.›</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?I</span> <span class="free">A</span> <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?I</span> <span class="free">B</span> <span class="free">c</span> <span class="free">d</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">⊆</span><span class="free">Q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span><span class="main">⊆</span><span class="free">Q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span><span class="main">∈</span><span class="free">𝒫</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span> 
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">≠</span><span class="free">b</span> <span class="main">∧</span> <span class="free">a</span><span class="main">≠</span><span class="free">c</span> <span class="main">∧</span> <span class="free">a</span><span class="main">≠</span><span class="free">d</span> <span class="main">∧</span> <span class="free">b</span><span class="main">≠</span><span class="free">c</span> <span class="main">∧</span> <span class="free">b</span><span class="main">≠</span><span class="free">d</span> <span class="main">∧</span> <span class="free">c</span><span class="main">≠</span><span class="free">d</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span><span class="main">≠</span><span class="free">b</span> <span class="main">∧</span> <span class="free">a</span><span class="main">≠</span><span class="free">c</span> <span class="main">∧</span> <span class="free">a</span><span class="main">≠</span><span class="free">d</span> <span class="main">∧</span> <span class="free">b</span><span class="main">≠</span><span class="free">c</span> <span class="main">∧</span> <span class="free">b</span><span class="main">≠</span><span class="free">d</span> <span class="main">∧</span> <span class="free">c</span><span class="main">≠</span><span class="free">d</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

      <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Finally, the important bit: proofs for the necessary cases of betweenness.›</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">I</span> <span class="skolem">J</span>"</span></span>
        <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="var">?I</span> <span class="skolem">I</span> <span class="skolem">a</span> <span class="skolem">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?I</span> <span class="skolem">J</span> <span class="skolem">c</span> <span class="skolem">d</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">I</span><span class="main">⊆</span><span class="free">Q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">J</span><span class="main">⊆</span><span class="free">Q</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"betw4 <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">d</span> <span class="main">∨</span> betw4 <span class="skolem">a</span> <span class="skolem">c</span> <span class="skolem">b</span> <span class="skolem">d</span> <span class="main">∨</span> betw4 <span class="skolem">a</span> <span class="skolem">c</span> <span class="skolem">d</span> <span class="skolem">b</span>"</span></span>
        <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">I</span> <span class="skolem">J</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">d</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"betw4 <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">d</span>"</span></span><span class="main">|</span><span class="quoted"><span class="quoted">"betw4 <span class="skolem">a</span> <span class="skolem">c</span> <span class="skolem">b</span> <span class="skolem">d</span>"</span></span><span class="main">|</span><span class="quoted"><span class="quoted">"betw4 <span class="skolem">a</span> <span class="skolem">c</span> <span class="skolem">d</span> <span class="skolem">b</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹betw4 <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">d</span> <span class="main">∨</span> betw4 <span class="skolem">a</span> <span class="skolem">c</span> <span class="skolem">b</span> <span class="skolem">d</span> <span class="main">∨</span> betw4 <span class="skolem">a</span> <span class="skolem">c</span> <span class="skolem">d</span> <span class="skolem">b</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
          <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"betw4 <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">d</span>"</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">I</span> <span class="skolem">J</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span> <span class="skolem">I</span><span class="main">∪</span><span class="skolem">J</span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="skolem">a</span> <span class="bound">x</span> <span class="skolem">d</span><span class="main"><span class="free">]]</span></span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Un_iff asm betw4_strong betw4_weak that<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> that<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">∈</span><span class="free">Q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">∈</span><span class="free">Q</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>5<span class="main">)</span> on_path that<span class="main">(</span>1-4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span> 
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"betw4 <span class="skolem">a</span> <span class="skolem">c</span> <span class="skolem">b</span> <span class="skolem">d</span>"</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">I</span> <span class="skolem">J</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span> <span class="skolem">I</span><span class="main">∪</span><span class="skolem">J</span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="skolem">a</span> <span class="bound">x</span> <span class="skolem">d</span><span class="main"><span class="free">]]</span></span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Un_iff <span class="quoted"><span class="quoted">‹betw4 <span class="skolem">a</span> <span class="skolem">c</span> <span class="skolem">b</span> <span class="skolem">d</span>›</span></span> abc_bcd_abd abc_bcd_acd betw4_weak that<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">∈</span><span class="free">Q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">∈</span><span class="free">Q</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>5<span class="main">)</span> on_path that<span class="main">(</span>1-4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span> 
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"betw4 <span class="skolem">a</span> <span class="skolem">c</span> <span class="skolem">d</span> <span class="skolem">b</span>"</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">I</span> <span class="skolem">J</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span> <span class="skolem">I</span><span class="main">∪</span><span class="skolem">J</span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="skolem">a</span> <span class="bound">x</span> <span class="skolem">b</span><span class="main"><span class="free">]]</span></span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹betw4 <span class="skolem">a</span> <span class="skolem">c</span> <span class="skolem">d</span> <span class="skolem">b</span>›</span></span> abc_bcd_abd abc_bcd_acd abe_ade_bcd_ace
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> UnE that<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">∈</span><span class="free">Q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">∈</span><span class="free">Q</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>5<span class="main">)</span> on_path that<span class="main">(</span>1-4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="free">a</span><span class="main">≠</span><span class="free">b</span> <span class="main">∧</span> <span class="free">a</span><span class="main">≠</span><span class="free">c</span> <span class="main">∧</span> <span class="free">a</span><span class="main">≠</span><span class="free">d</span> <span class="main">∧</span> <span class="free">b</span><span class="main">≠</span><span class="free">c</span> <span class="main">∧</span> <span class="free">b</span><span class="main">≠</span><span class="free">d</span> <span class="main">∧</span> <span class="free">c</span><span class="main">≠</span><span class="free">d</span><span class="main">)</span>"</span></span>
  
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="free">A</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule_tac</span> P<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="var">?P</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> A<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">Q</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> wlog_endpoints_degenerate<span class="main">)</span>

      <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
        This case follows the same pattern as above: the next five <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>show›</span></span></span></span> statements
        are effectively bookkeeping.›</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">I</span><span class="main">.</span> <span class="var">?I</span> <span class="bound">I</span> <span class="bound">a</span> <span class="bound">b</span> <span class="main">⟹</span> <span class="var">?I</span> <span class="bound">I</span> <span class="bound">b</span> <span class="bound">a</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> abc_sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">A</span><span class="main">.</span> <span class="bound">A</span> <span class="main">⊆</span> <span class="free">Q</span> <span class="main">⟹</span> <span class="var">?I</span> <span class="bound">A</span> <span class="bound">a</span> <span class="bound">b</span> <span class="main">⟹</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free">Q</span> <span class="main">∧</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">Q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> on_path <span class="quoted"><span class="quoted">‹<span class="free">Q</span><span class="main">∈</span><span class="free">𝒫</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">I</span> <span class="bound">J</span><span class="main">.</span> <span class="var">?R</span> <span class="bound">I</span> <span class="main">⟹</span> <span class="var">?R</span> <span class="bound">J</span> <span class="main">⟹</span> <span class="var">?P</span> <span class="bound">I</span> <span class="bound">J</span> <span class="main">⟹</span> <span class="var">?P</span> <span class="bound">J</span> <span class="bound">I</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Un_commute<span class="main">)</span>

      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?I</span> <span class="free">A</span> <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?I</span> <span class="free">B</span> <span class="free">c</span> <span class="free">d</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">⊆</span><span class="free">Q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span><span class="main">⊆</span><span class="free">Q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span><span class="main">∈</span><span class="free">𝒫</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="free">a</span> <span class="main">≠</span> <span class="free">b</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">≠</span> <span class="free">c</span> <span class="main">∧</span> <span class="free">c</span> <span class="main">≠</span> <span class="free">d</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">≠</span> <span class="free">d</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">≠</span> <span class="free">c</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">≠</span> <span class="free">d</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">(</span><span class="free">a</span> <span class="main">≠</span> <span class="free">b</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">≠</span> <span class="free">c</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">≠</span> <span class="free">d</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">≠</span> <span class="free">c</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">≠</span> <span class="free">d</span> <span class="main">∧</span> <span class="free">c</span> <span class="main">≠</span> <span class="free">d</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

      <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Again, this is the important bit: proofs for the necessary cases of degeneracy.›</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span> <span class="main">=</span> <span class="skolem">b</span> <span class="main">∧</span> <span class="skolem">b</span> <span class="main">=</span> <span class="skolem">c</span> <span class="main">∧</span> <span class="skolem">c</span> <span class="main">=</span> <span class="skolem">d</span> <span class="main">⟶</span> <span class="var">?P</span> <span class="skolem">I</span> <span class="skolem">J</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">=</span> <span class="skolem">b</span> <span class="main">∧</span> <span class="skolem">b</span> <span class="main">≠</span> <span class="skolem">c</span> <span class="main">∧</span> <span class="skolem">c</span> <span class="main">=</span> <span class="skolem">d</span> <span class="main">⟶</span> <span class="var">?P</span> <span class="skolem">I</span> <span class="skolem">J</span><span class="main">)</span> <span class="main">∧</span>
          <span class="main">(</span><span class="skolem">a</span> <span class="main">=</span> <span class="skolem">b</span> <span class="main">∧</span> <span class="skolem">b</span> <span class="main">=</span> <span class="skolem">c</span> <span class="main">∧</span> <span class="skolem">c</span> <span class="main">≠</span> <span class="skolem">d</span> <span class="main">⟶</span> <span class="var">?P</span> <span class="skolem">I</span> <span class="skolem">J</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">=</span> <span class="skolem">b</span> <span class="main">∧</span> <span class="skolem">b</span> <span class="main">≠</span> <span class="skolem">c</span> <span class="main">∧</span> <span class="skolem">c</span> <span class="main">≠</span> <span class="skolem">d</span> <span class="main">∧</span> <span class="skolem">a</span> <span class="main">≠</span> <span class="skolem">d</span> <span class="main">⟶</span> <span class="var">?P</span> <span class="skolem">I</span> <span class="skolem">J</span><span class="main">)</span> <span class="main">∧</span>
          <span class="main">(</span><span class="skolem">a</span> <span class="main">≠</span> <span class="skolem">b</span> <span class="main">∧</span> <span class="skolem">b</span> <span class="main">=</span> <span class="skolem">c</span> <span class="main">∧</span> <span class="skolem">c</span> <span class="main">≠</span> <span class="skolem">d</span> <span class="main">∧</span> <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">d</span> <span class="main">⟶</span> <span class="var">?P</span> <span class="skolem">I</span> <span class="skolem">J</span><span class="main">)</span> <span class="main">∧</span>
          <span class="main">(</span><span class="main"><span class="free">[[</span></span><span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">d</span> <span class="main">⟶</span> <span class="var">?P</span> <span class="skolem">I</span> <span class="skolem">J</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main"><span class="free">[[</span></span><span class="skolem">b</span> <span class="skolem">a</span> <span class="skolem">c</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">d</span> <span class="main">⟶</span> <span class="var">?P</span> <span class="skolem">I</span> <span class="skolem">J</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="var">?I</span> <span class="skolem">I</span> <span class="skolem">a</span> <span class="skolem">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?I</span> <span class="skolem">J</span> <span class="skolem">c</span> <span class="skolem">d</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">I</span> <span class="main">⊆</span> <span class="free">Q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">J</span> <span class="main">⊆</span> <span class="free">Q</span>"</span></span>
      <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">I</span> <span class="skolem">J</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">d</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI impI<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="skolem">b</span> <span class="main">∧</span> <span class="skolem">b</span> <span class="main">=</span> <span class="skolem">c</span> <span class="main">∧</span> <span class="skolem">c</span> <span class="main">=</span> <span class="skolem">d</span>"</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">l</span><span class="main">∈</span><span class="free">Q</span><span class="main">.</span> <span class="main">∃</span><span class="bound">u</span><span class="main">∈</span><span class="free">Q</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">I</span> <span class="main">∪</span> <span class="skolem">J</span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="bound">l</span> <span class="bound">x</span> <span class="bound">u</span><span class="main"><span class="free">]]</span></span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">=</span> <span class="skolem">b</span> <span class="main">∧</span> <span class="skolem">b</span> <span class="main">=</span> <span class="skolem">c</span> <span class="main">∧</span> <span class="skolem">c</span> <span class="main">=</span> <span class="skolem">d</span>›</span></span> abc_ac_neq assms<span class="main">(</span>5<span class="main">)</span> ex_crossing_path that<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="skolem">b</span> <span class="main">∧</span> <span class="skolem">b</span> <span class="main">≠</span> <span class="skolem">c</span> <span class="main">∧</span> <span class="skolem">c</span> <span class="main">=</span> <span class="skolem">d</span>"</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">l</span><span class="main">∈</span><span class="free">Q</span><span class="main">.</span> <span class="main">∃</span><span class="bound">u</span><span class="main">∈</span><span class="free">Q</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">I</span> <span class="main">∪</span> <span class="skolem">J</span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="bound">l</span> <span class="bound">x</span> <span class="bound">u</span><span class="main"><span class="free">]]</span></span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">=</span> <span class="skolem">b</span> <span class="main">∧</span> <span class="skolem">b</span> <span class="main">≠</span> <span class="skolem">c</span> <span class="main">∧</span> <span class="skolem">c</span> <span class="main">=</span> <span class="skolem">d</span>›</span></span> abc_ac_neq assms<span class="main">(</span>5<span class="main">)</span> ex_crossing_path that<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Un_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="skolem">b</span> <span class="main">∧</span> <span class="skolem">b</span> <span class="main">=</span> <span class="skolem">c</span> <span class="main">∧</span> <span class="skolem">c</span> <span class="main">≠</span> <span class="skolem">d</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span> <span class="skolem">I</span><span class="main">∪</span><span class="skolem">J</span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="skolem">c</span> <span class="bound">x</span> <span class="skolem">d</span><span class="main"><span class="free">]]</span></span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> abc_abc_neq that<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">∈</span><span class="free">Q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">∈</span><span class="free">Q</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> on_path <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">=</span> <span class="skolem">b</span> <span class="main">∧</span> <span class="skolem">b</span> <span class="main">=</span> <span class="skolem">c</span> <span class="main">∧</span> <span class="skolem">c</span> <span class="main">≠</span> <span class="skolem">d</span>›</span></span> that<span class="main">(</span>1<span class="main">,</span>3<span class="main">)</span> abc_abc_neq <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span><span class="main"><span class="keyword3">+</span></span> 
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">l</span><span class="main">∈</span><span class="free">Q</span><span class="main">.</span> <span class="main">∃</span><span class="bound">u</span><span class="main">∈</span><span class="free">Q</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">I</span> <span class="main">∪</span> <span class="skolem">J</span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="bound">l</span> <span class="bound">x</span> <span class="bound">u</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="skolem">b</span> <span class="main">∧</span> <span class="skolem">b</span> <span class="main">≠</span> <span class="skolem">c</span> <span class="main">∧</span> <span class="skolem">c</span> <span class="main">≠</span> <span class="skolem">d</span> <span class="main">∧</span> <span class="skolem">a</span> <span class="main">≠</span> <span class="skolem">d</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span> <span class="skolem">I</span><span class="main">∪</span><span class="skolem">J</span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="skolem">c</span> <span class="bound">x</span> <span class="skolem">d</span><span class="main"><span class="free">]]</span></span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> abc_abc_neq that<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">∈</span><span class="free">Q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">∈</span><span class="free">Q</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> on_path <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">=</span> <span class="skolem">b</span> <span class="main">∧</span> <span class="skolem">b</span> <span class="main">≠</span> <span class="skolem">c</span> <span class="main">∧</span> <span class="skolem">c</span> <span class="main">≠</span> <span class="skolem">d</span> <span class="main">∧</span> <span class="skolem">a</span> <span class="main">≠</span> <span class="skolem">d</span>›</span></span> that<span class="main">(</span>1<span class="main">,</span>3<span class="main">)</span> abc_abc_neq <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span><span class="main"><span class="keyword3">+</span></span> 
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">l</span><span class="main">∈</span><span class="free">Q</span><span class="main">.</span> <span class="main">∃</span><span class="bound">u</span><span class="main">∈</span><span class="free">Q</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">I</span> <span class="main">∪</span> <span class="skolem">J</span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="bound">l</span> <span class="bound">x</span> <span class="bound">u</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≠</span> <span class="skolem">b</span> <span class="main">∧</span> <span class="skolem">b</span> <span class="main">=</span> <span class="skolem">c</span> <span class="main">∧</span> <span class="skolem">c</span> <span class="main">≠</span> <span class="skolem">d</span> <span class="main">∧</span> <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">d</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span> <span class="skolem">I</span><span class="main">∪</span><span class="skolem">J</span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="skolem">c</span> <span class="bound">x</span> <span class="skolem">d</span><span class="main"><span class="free">]]</span></span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> abc_sym that<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">∈</span><span class="free">Q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">∈</span><span class="free">Q</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> on_path <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">≠</span> <span class="skolem">b</span> <span class="main">∧</span> <span class="skolem">b</span> <span class="main">=</span> <span class="skolem">c</span> <span class="main">∧</span> <span class="skolem">c</span> <span class="main">≠</span> <span class="skolem">d</span> <span class="main">∧</span> <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">d</span>›</span></span> that<span class="main">(</span>1<span class="main">,</span>3<span class="main">)</span> abc_abc_neq <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span><span class="main"><span class="keyword3">+</span></span> 
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">l</span><span class="main">∈</span><span class="free">Q</span><span class="main">.</span> <span class="main">∃</span><span class="bound">u</span><span class="main">∈</span><span class="free">Q</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">I</span> <span class="main">∪</span> <span class="skolem">J</span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="bound">l</span> <span class="bound">x</span> <span class="bound">u</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">d</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span> <span class="skolem">I</span><span class="main">∪</span><span class="skolem">J</span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="skolem">c</span> <span class="bound">x</span> <span class="skolem">d</span><span class="main"><span class="free">]]</span></span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> UnE abc_acd_abd abc_sym that<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">∈</span><span class="free">Q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">∈</span><span class="free">Q</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> on_path that<span class="main">(</span>2<span class="main">,</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span> 
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">l</span><span class="main">∈</span><span class="free">Q</span><span class="main">.</span> <span class="main">∃</span><span class="bound">u</span><span class="main">∈</span><span class="free">Q</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">I</span> <span class="main">∪</span> <span class="skolem">J</span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="bound">l</span> <span class="bound">x</span> <span class="bound">u</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="skolem">b</span> <span class="skolem">a</span> <span class="skolem">c</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">d</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span> <span class="skolem">I</span><span class="main">∪</span><span class="skolem">J</span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="skolem">c</span> <span class="bound">x</span> <span class="skolem">b</span><span class="main"><span class="free">]]</span></span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span>  abc_sym abd_bcd_abc betw4_strong that<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Un_iff<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">∈</span><span class="free">Q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">∈</span><span class="free">Q</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> on_path that <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span> 
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">l</span><span class="main">∈</span><span class="free">Q</span><span class="main">.</span> <span class="main">∃</span><span class="bound">u</span><span class="main">∈</span><span class="free">Q</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">I</span> <span class="main">∪</span> <span class="skolem">J</span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="bound">l</span> <span class="bound">x</span> <span class="bound">u</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> <span class="comment1">(*for 14i*)</span> union_of_bounded_sets_is_bounded2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="bound">x</span> <span class="free">b</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">B</span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="free">c</span> <span class="bound">x</span> <span class="free">d</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">⊆</span><span class="free">Q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span><span class="main">⊆</span><span class="free">Q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span><span class="main">∈</span><span class="free">𝒫</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">&lt;</span>card <span class="free">A</span> <span class="main">∨</span> infinite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">&lt;</span>card <span class="free">B</span> <span class="main">∨</span> infinite <span class="free">B</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">l</span><span class="main">∈</span><span class="free">Q</span><span class="main">-</span><span class="main">(</span><span class="free">A</span><span class="main">∪</span><span class="free">B</span><span class="main">)</span><span class="main">.</span> <span class="main">∃</span><span class="bound">u</span><span class="main">∈</span><span class="free">Q</span><span class="main">-</span><span class="main">(</span><span class="free">A</span><span class="main">∪</span><span class="free">B</span><span class="main">)</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">∪</span><span class="free">B</span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="bound">l</span> <span class="bound">x</span> <span class="bound">u</span><span class="main"><span class="free">]]</span></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms union_of_bounded_sets_is_bounded
    <span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> A<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">A</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">a</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">b</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> B<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">B</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> c<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">c</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> d<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">d</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> Q<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">Q</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Diff_iff abc_abc_neq<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Schutz proves a mildly stronger version of this theorem than he states. Namely, he gives an
  additional condition that has to be fulfilled by the bounds $y,z$ in the proof (<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>y,z∉∅ Q ab›</span></span></span></span>).
  This condition is trivial given <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>abc_abc_neq›</span></span></span></span>. His stating it in the proof makes me wonder
  whether his (strictly speaking) undefined notion of bounded set is somehow weaker than the
  version using strict betweenness in his theorem statement and used here in Isabelle.
  This would make sense, given the obvious analogy with sets on the real line.
›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> <span class="comment1">(*14i*)</span> second_existence_thm_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> path_Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span><span class="main">∈</span><span class="free">𝒫</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> events<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">∉</span><span class="free">Q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">∉</span><span class="free">Q</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> reachable<span class="main">:</span> <span class="quoted"><span class="quoted">"path_ex <span class="free">a</span> <span class="free">q1</span>"</span></span> <span class="quoted"><span class="quoted">"path_ex <span class="free">b</span> <span class="free">q2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">q1</span><span class="main">∈</span><span class="free">Q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">q2</span><span class="main">∈</span><span class="free">Q</span>"</span></span> <span class="comment1">(* "∃P∈𝒫. ∃q∈Q. path P a q" *)</span><span class="comment1">(*  "∃P∈𝒫. ∃q∈Q. path P b q" *)</span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">y</span><span class="main">∈</span><span class="free">Q</span><span class="main">.</span> <span class="main">∃</span><span class="bound">z</span><span class="main">∈</span><span class="free">Q</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">∅</span> <span class="free">Q</span> <span class="free">a</span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="bound">y</span> <span class="bound">x</span> <span class="bound">z</span><span class="main"><span class="free">]]</span></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">∅</span> <span class="free">Q</span> <span class="free">b</span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="bound">y</span> <span class="bound">x</span> <span class="bound">z</span><span class="main"><span class="free">]]</span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Slightly annoying: Schutz implicitly extends <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>bounded›</span></span></span></span> to sets, so his statements are neater.›</span></span>

<span class="comment1">(* alternative way of saying reachable *)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">q</span><span class="main">∈</span><span class="free">Q</span><span class="main">.</span> <span class="bound">q</span><span class="main">∉</span><span class="main">(</span><span class="main">∅</span> <span class="free">Q</span> <span class="free">a</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">q</span><span class="main">∈</span><span class="free">Q</span><span class="main">.</span> <span class="bound">q</span><span class="main">∉</span><span class="main">(</span><span class="main">∅</span> <span class="free">Q</span> <span class="free">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> cross_in_reachable reachable <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This is a helper statement for obtaining bounds in both directions of both unreachable sets.
  Notice this needs Theorem 13 right now, Schutz claims only Theorem 4. I think this is necessary?›</span></span>
  <span class="keyword1"><span class="command">have</span></span> get_bds<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">la</span><span class="main">∈</span><span class="free">Q</span><span class="main">.</span> <span class="main">∃</span><span class="bound">ua</span><span class="main">∈</span><span class="free">Q</span><span class="main">.</span> <span class="bound">la</span><span class="main">∉</span><span class="main">∅</span> <span class="free">Q</span> <span class="skolem">a</span> <span class="main">∧</span> <span class="bound">ua</span><span class="main">∉</span><span class="main">∅</span> <span class="free">Q</span> <span class="skolem">a</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">∅</span> <span class="free">Q</span> <span class="skolem">a</span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="bound">la</span> <span class="bound">x</span> <span class="bound">ua</span><span class="main"><span class="free">]]</span></span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">∉</span><span class="free">Q</span>"</span></span> <span class="quoted"><span class="quoted">"path_ex <span class="skolem">a</span> <span class="skolem">q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span><span class="main">∈</span><span class="free">Q</span>"</span></span>
    <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span> <span class="skolem">q</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Qy</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Qy</span><span class="main">∈</span><span class="main">∅</span> <span class="free">Q</span> <span class="skolem">a</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> asm<span class="main">(</span>2<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∉</span> <span class="free">Q</span>›</span></span> in_path_event path_Q two_in_unreach <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">la</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">la</span> <span class="main">∈</span> <span class="free">Q</span> <span class="main">-</span> <span class="main">∅</span> <span class="free">Q</span> <span class="skolem">a</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> asm<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> cross_in_reachable <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ua</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ua</span> <span class="main">∈</span> <span class="free">Q</span> <span class="main">-</span> <span class="main">∅</span> <span class="free">Q</span> <span class="skolem">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="skolem">la</span> <span class="skolem">Qy</span> <span class="skolem">ua</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">la</span> <span class="main">≠</span> <span class="skolem">ua</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> unreachable_set_bounded <span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> Q<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">Q</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> Qx<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">la</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> Qy<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">Qy</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Qy</span> <span class="main">∈</span> <span class="main">∅</span> <span class="free">Q</span> <span class="skolem">a</span>›</span></span> asm in_path_event path_Q <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">la</span> <span class="main">∉</span> <span class="main">∅</span> <span class="free">Q</span> <span class="skolem">a</span> <span class="main">∧</span> <span class="skolem">ua</span> <span class="main">∉</span> <span class="main">∅</span> <span class="free">Q</span> <span class="skolem">a</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">∅</span> <span class="free">Q</span> <span class="skolem">a</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">≠</span><span class="skolem">la</span> <span class="main">∧</span> <span class="bound">x</span><span class="main">≠</span><span class="skolem">ua</span><span class="main">)</span> <span class="main">⟶</span> <span class="main"><span class="free">[[</span></span><span class="skolem">la</span> <span class="bound">x</span> <span class="skolem">ua</span><span class="main"><span class="free">]]</span></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">la</span> <span class="main">∉</span> <span class="main">∅</span> <span class="free">Q</span> <span class="skolem">a</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">la</span> <span class="main">∈</span> <span class="free">Q</span> <span class="main">-</span> <span class="main">∅</span> <span class="free">Q</span> <span class="skolem">a</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ua</span> <span class="main">∉</span> <span class="main">∅</span> <span class="free">Q</span> <span class="skolem">a</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ua</span> <span class="main">∈</span> <span class="free">Q</span> <span class="main">-</span> <span class="main">∅</span> <span class="free">Q</span> <span class="skolem">a</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">∅</span> <span class="free">Q</span> <span class="skolem">a</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> <span class="skolem">la</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≠</span> <span class="skolem">ua</span> <span class="main">⟶</span> <span class="main"><span class="free">[[</span></span><span class="skolem">la</span> <span class="bound">x</span> <span class="skolem">ua</span><span class="main"><span class="free">]]</span></span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">safe</span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="main">∅</span> <span class="free">Q</span> <span class="skolem">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">≠</span><span class="skolem">la</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">≠</span><span class="skolem">ua</span>"</span></span>
      <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="skolem">Qy</span>"</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="skolem">la</span> <span class="skolem">x</span> <span class="skolem">ua</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="skolem">la</span> <span class="skolem">Qy</span> <span class="skolem">ua</span><span class="main"><span class="free">]]</span></span>›</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">≠</span><span class="skolem">Qy</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="skolem">Qy</span> <span class="skolem">x</span> <span class="skolem">la</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="skolem">la</span> <span class="skolem">Qy</span> <span class="skolem">x</span><span class="main"><span class="free">]]</span></span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="skolem">x</span> <span class="skolem">la</span> <span class="skolem">Qy</span><span class="main"><span class="free">]]</span></span>"</span></span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">la</span><span class="main">∈</span><span class="main">∅</span> <span class="free">Q</span> <span class="skolem">a</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> unreach_connected <span class="quoted"><span class="quoted">‹<span class="skolem">Qy</span><span class="main">∈</span><span class="main">∅</span> <span class="free">Q</span> <span class="skolem">a</span>›</span></span><span class="quoted"><span class="quoted">‹<span class="skolem">x</span><span class="main">∈</span><span class="main">∅</span> <span class="free">Q</span> <span class="skolem">a</span>›</span></span><span class="quoted"><span class="quoted">‹<span class="skolem">x</span><span class="main">≠</span><span class="skolem">Qy</span>›</span></span> in_path_event path_Q that <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted">False</span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">la</span> <span class="main">∈</span> <span class="free">Q</span> <span class="main">-</span> <span class="main">∅</span> <span class="free">Q</span> <span class="skolem">a</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command">}</span></span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="skolem">Qy</span> <span class="skolem">x</span> <span class="skolem">la</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="skolem">la</span> <span class="skolem">Qy</span> <span class="skolem">x</span><span class="main"><span class="free">]]</span></span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> some_betw <span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> Q<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">Q</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">la</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> c<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">Qy</span></span><span class="main">]</span> path_Q unreach_on_path
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Qy</span> <span class="main">∈</span> <span class="main">∅</span> <span class="free">Q</span> <span class="skolem">a</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">la</span> <span class="main">∈</span> <span class="free">Q</span> <span class="main">-</span> <span class="main">∅</span> <span class="free">Q</span> <span class="skolem">a</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="main">∅</span> <span class="free">Q</span> <span class="skolem">a</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">Qy</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">la</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="skolem">la</span> <span class="skolem">x</span> <span class="skolem">ua</span><span class="main"><span class="free">]]</span></span>"</span></span>
          <span class="comment1">(* by (smt DiffD1 DiffD2 ‹Qy ∈ ∅ Q a› ‹[[la Qy ua]]› ‹ua ∈ Q - ∅ Q a› ‹x ∈ ∅ Q a› ‹x ≠ la› abc_abd_acdadc abc_acd_abd abc_only_cba abc_sym in_path_event path_Q some_betw that(1) that(2) unreach_connected unreach_on_path) *)</span>
        <span class="keyword1"><span class="command">proof</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="skolem">Qy</span> <span class="skolem">x</span> <span class="skolem">la</span><span class="main"><span class="free">]]</span></span>"</span></span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="skolem">la</span> <span class="skolem">Qy</span> <span class="skolem">ua</span><span class="main"><span class="free">]]</span></span>›</span></span> abc_acd_abd abc_sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="skolem">la</span> <span class="skolem">Qy</span> <span class="skolem">x</span><span class="main"><span class="free">]]</span></span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="skolem">la</span> <span class="skolem">x</span> <span class="skolem">ua</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="skolem">la</span> <span class="skolem">ua</span> <span class="skolem">x</span><span class="main"><span class="free">]]</span></span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="skolem">la</span> <span class="skolem">Qy</span> <span class="skolem">ua</span><span class="main"><span class="free">]]</span></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">ua</span>›</span></span> abc_abd_acdadc <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main"><span class="free">[[</span></span><span class="skolem">la</span> <span class="skolem">ua</span> <span class="skolem">x</span><span class="main"><span class="free">]]</span></span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> unreach_connected that abc_abc_neq abc_acd_bcd in_path_event path_Q
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> DiffD2 <span class="quoted"><span class="quoted">‹<span class="skolem">Qy</span> <span class="main">∈</span> <span class="main">∅</span> <span class="free">Q</span> <span class="skolem">a</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="skolem">la</span> <span class="skolem">Qy</span> <span class="skolem">ua</span><span class="main"><span class="free">]]</span></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ua</span> <span class="main">∈</span> <span class="free">Q</span> <span class="main">-</span> <span class="main">∅</span> <span class="free">Q</span> <span class="skolem">a</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="main">∅</span> <span class="free">Q</span> <span class="skolem">a</span>›</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="skolem">la</span> <span class="skolem">x</span> <span class="skolem">ua</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main"><span class="free">[[</span></span><span class="skolem">la</span> <span class="skolem">ua</span> <span class="skolem">x</span><span class="main"><span class="free">]]</span></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main"><span class="free">[[</span></span><span class="skolem">la</span> <span class="skolem">ua</span> <span class="skolem">x</span><span class="main"><span class="free">]]</span></span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="skolem">la</span> <span class="skolem">x</span> <span class="skolem">ua</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">la</span> <span class="main">∈</span> <span class="free">Q</span> <span class="main">-</span> <span class="main">∅</span> <span class="free">Q</span> <span class="skolem">a</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ua</span> <span class="main">∈</span> <span class="free">Q</span> <span class="main">-</span> <span class="main">∅</span> <span class="free">Q</span> <span class="skolem">a</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">y</span><span class="main">∈</span><span class="free">Q</span><span class="main">.</span> <span class="main">∃</span><span class="bound">z</span><span class="main">∈</span><span class="free">Q</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">(</span><span class="main">∅</span> <span class="free">Q</span> <span class="free">a</span><span class="main">)</span><span class="main">∪</span><span class="main">(</span><span class="main">∅</span> <span class="free">Q</span> <span class="free">b</span><span class="main">)</span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="bound">y</span> <span class="bound">x</span> <span class="bound">z</span><span class="main"><span class="free">]]</span></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">la</span></span> <span class="skolem"><span class="skolem">ua</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">∅</span> <span class="free">Q</span> <span class="free">a</span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="skolem">la</span> <span class="bound">x</span> <span class="skolem">ua</span><span class="main"><span class="free">]]</span></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> events<span class="main">(</span>1<span class="main">)</span> get_bds reachable<span class="main">(</span>1<span class="main">,</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">lb</span></span> <span class="skolem"><span class="skolem">ub</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">∅</span> <span class="free">Q</span> <span class="free">b</span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="skolem">lb</span> <span class="bound">x</span> <span class="skolem">ub</span><span class="main"><span class="free">]]</span></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> events<span class="main">(</span>2<span class="main">)</span> get_bds reachable<span class="main">(</span>2<span class="main">,</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∅</span> <span class="free">Q</span> <span class="free">a</span> <span class="main">⊆</span> <span class="free">Q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∅</span> <span class="free">Q</span> <span class="free">b</span> <span class="main">⊆</span> <span class="free">Q</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subsetI unreach_on_path<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">&lt;</span> card <span class="main">(</span><span class="main">∅</span> <span class="free">Q</span> <span class="free">a</span><span class="main">)</span> <span class="main">∨</span> infinite <span class="main">(</span><span class="main">∅</span> <span class="free">Q</span> <span class="free">a</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> two_in_unreach events<span class="main">(</span>1<span class="main">)</span> in_path_event path_Q reachable<span class="main">(</span>1<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def card_le_Suc0_iff_eq not_less<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">&lt;</span> card <span class="main">(</span><span class="main">∅</span> <span class="free">Q</span> <span class="free">b</span><span class="main">)</span> <span class="main">∨</span> infinite <span class="main">(</span><span class="main">∅</span> <span class="free">Q</span> <span class="free">b</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> two_in_unreach events<span class="main">(</span>2<span class="main">)</span> in_path_event path_Q reachable<span class="main">(</span>2<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def card_le_Suc0_iff_eq not_less<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> union_of_bounded_sets_is_bounded <span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> Q<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">Q</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> A<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">∅</span> <span class="free">Q</span> <span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> B<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">∅</span> <span class="free">Q</span> <span class="free">b</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">using</span></span> get_bds assms <span class="quoted"><span class="quoted">`<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">∅</span> <span class="free">Q</span> <span class="free">a</span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="skolem">la</span> <span class="bound">x</span> <span class="skolem">ua</span><span class="main"><span class="free">]]</span></span>`</span></span> <span class="quoted"><span class="quoted">`<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">∅</span> <span class="free">Q</span> <span class="free">b</span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="skolem">lb</span> <span class="bound">x</span> <span class="skolem">ub</span><span class="main"><span class="free">]]</span></span>`</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">∈</span><span class="free">Q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span><span class="main">∈</span><span class="free">Q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">(</span><span class="main">∅</span> <span class="free">Q</span> <span class="free">a</span><span class="main">)</span><span class="main">∪</span><span class="main">(</span><span class="main">∅</span> <span class="free">Q</span> <span class="free">b</span><span class="main">)</span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="skolem">y</span> <span class="bound">x</span> <span class="skolem">z</span><span class="main"><span class="free">]]</span></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bexI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">∈</span><span class="free">Q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> <span class="free">Q</span>›</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span><span class="main">∈</span><span class="free">Q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z</span> <span class="main">∈</span> <span class="free">Q</span>›</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">∅</span> <span class="free">Q</span> <span class="free">a</span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="skolem">z</span> <span class="bound">x</span> <span class="skolem">y</span><span class="main"><span class="free">]]</span></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">∅</span> <span class="free">Q</span> <span class="free">b</span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="skolem">z</span> <span class="bound">x</span> <span class="skolem">y</span><span class="main"><span class="free">]]</span></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">∅</span> <span class="free">Q</span> <span class="free">a</span> <span class="main">∪</span> <span class="main">∅</span> <span class="free">Q</span> <span class="free">b</span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="skolem">y</span> <span class="bound">x</span> <span class="skolem">z</span><span class="main"><span class="free">]]</span></span>›</span></span> abc_sym<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">theorem</span></span> <span class="comment1">(*14*)</span> second_existence_thm_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> path_Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span><span class="main">∈</span><span class="free">𝒫</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> events<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">∉</span><span class="free">Q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">∉</span><span class="free">Q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">∈</span><span class="free">Q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span><span class="main">∈</span><span class="free">Q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">≠</span><span class="free">d</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> reachable<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">P</span><span class="main">∈</span><span class="free">𝒫</span><span class="main">.</span> <span class="main">∃</span><span class="bound">q</span><span class="main">∈</span><span class="free">Q</span><span class="main">.</span> path <span class="bound">P</span> <span class="free">a</span> <span class="bound">q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">P</span><span class="main">∈</span><span class="free">𝒫</span><span class="main">.</span> <span class="main">∃</span><span class="bound">q</span><span class="main">∈</span><span class="free">Q</span><span class="main">.</span> path <span class="bound">P</span> <span class="free">b</span> <span class="bound">q</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">e</span><span class="main">∈</span><span class="free">Q</span><span class="main">.</span> <span class="main">∃</span><span class="bound">ae</span><span class="main">∈</span><span class="free">𝒫</span><span class="main">.</span> <span class="main">∃</span><span class="bound">be</span><span class="main">∈</span><span class="free">𝒫</span><span class="main">.</span> path <span class="bound">ae</span> <span class="free">a</span> <span class="bound">e</span> <span class="main">∧</span> path <span class="bound">be</span> <span class="free">b</span> <span class="bound">e</span> <span class="main">∧</span> <span class="main"><span class="free">[[</span></span><span class="free">c</span> <span class="free">d</span> <span class="bound">e</span><span class="main"><span class="free">]]</span></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> bounds_yz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">∅</span> <span class="free">Q</span> <span class="free">a</span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="skolem">z</span> <span class="bound">x</span> <span class="skolem">y</span><span class="main"><span class="free">]]</span></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">∅</span> <span class="free">Q</span> <span class="free">b</span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="skolem">z</span> <span class="bound">x</span> <span class="skolem">y</span><span class="main"><span class="free">]]</span></span><span class="main">)</span>"</span></span>
               <span class="keyword2"><span class="keyword">and</span></span> yz_inQ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">∈</span><span class="free">Q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span><span class="main">∈</span><span class="free">Q</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> second_existence_thm_1 <span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> Q<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">Q</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">a</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">b</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> path_Q events<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> reachable <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">∉</span><span class="main">(</span><span class="main">∅</span> <span class="free">Q</span> <span class="free">a</span><span class="main">)</span><span class="main">∪</span><span class="main">(</span><span class="main">∅</span> <span class="free">Q</span> <span class="free">b</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span><span class="main">∉</span><span class="main">(</span><span class="main">∅</span> <span class="free">Q</span> <span class="free">a</span><span class="main">)</span><span class="main">∪</span><span class="main">(</span><span class="main">∅</span> <span class="free">Q</span> <span class="free">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Un_iff <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">∅</span> <span class="free">Q</span> <span class="free">a</span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="skolem">z</span> <span class="bound">x</span> <span class="skolem">y</span><span class="main"><span class="free">]]</span></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">∅</span> <span class="free">Q</span> <span class="free">b</span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="skolem">z</span> <span class="bound">x</span> <span class="skolem">y</span><span class="main"><span class="free">]]</span></span><span class="main">)</span>›</span></span> abc_abc_neq<span class="main">)</span><span class="main"><span class="keyword3">+</span></span> 
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">e</span> <span class="bound">ae</span> <span class="bound">be</span><span class="main">.</span> <span class="main">(</span><span class="bound">e</span><span class="main">∈</span><span class="free">Q</span> <span class="main">∧</span> path <span class="bound">ae</span> <span class="free">a</span> <span class="bound">e</span> <span class="main">∧</span> path <span class="bound">be</span> <span class="free">b</span> <span class="bound">e</span> <span class="main">∧</span> <span class="main"><span class="free">[[</span></span><span class="free">c</span> <span class="free">d</span> <span class="bound">e</span><span class="main"><span class="free">]]</span></span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> exist_ay<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ay</span><span class="main">.</span> path <span class="bound">ay</span> <span class="skolem">a</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">∉</span><span class="free">Q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">P</span><span class="main">∈</span><span class="free">𝒫</span><span class="main">.</span> <span class="main">∃</span><span class="bound">q</span><span class="main">∈</span><span class="free">Q</span><span class="main">.</span> path <span class="bound">P</span> <span class="skolem">a</span> <span class="bound">q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">∉</span><span class="main">(</span><span class="main">∅</span> <span class="free">Q</span> <span class="skolem">a</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">∈</span><span class="free">Q</span>"</span></span>
    <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span> <span class="skolem">y</span>
    <span class="keyword1"><span class="command">using</span></span> in_path_event path_Q that unreachable_bounded_path_only
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">c</span> <span class="free">d</span> <span class="skolem">y</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main">⟦</span><span class="skolem">y</span> <span class="free">c</span> <span class="free">d</span><span class="main">]]</span> <span class="main">∨</span> <span class="main">[[</span><span class="free">c</span> <span class="skolem">y</span> <span class="free">d</span><span class="main">⟧</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> <span class="free">Q</span>›</span></span> abc_sym events<span class="main"><span class="main">(</span></span>3-5<span class="main"><span class="main">)</span></span> path_Q some_betw<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">c</span> <span class="free">d</span> <span class="skolem">z</span><span class="main"><span class="free">]]</span></span> <span class="main">∨</span> <span class="main">⟦</span><span class="skolem">z</span> <span class="free">c</span> <span class="free">d</span><span class="main">]]</span> <span class="main">∨</span> <span class="main">[[</span><span class="free">c</span> <span class="skolem">z</span> <span class="free">d</span><span class="main">⟧</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">‹<span class="skolem">z</span> <span class="main">∈</span> <span class="free">Q</span>›</span></span> abc_sym events<span class="main"><span class="main">(</span></span>3-5<span class="main"><span class="main">)</span></span> path_Q some_betw<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">c</span> <span class="free">d</span> <span class="skolem">y</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">c</span> <span class="free">d</span> <span class="skolem">z</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="main">|</span>
                      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">⟦</span><span class="skolem">y</span> <span class="free">c</span> <span class="free">d</span><span class="main">]]</span> <span class="main">∨</span> <span class="main">[[</span><span class="free">c</span> <span class="skolem">y</span> <span class="free">d</span><span class="main">⟧</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">⟦</span><span class="skolem">z</span> <span class="free">c</span> <span class="free">d</span><span class="main">]]</span> <span class="main">∨</span> <span class="main">[[</span><span class="free">c</span> <span class="skolem">z</span> <span class="free">d</span><span class="main">⟧</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">c</span> <span class="free">d</span> <span class="skolem">y</span><span class="main"><span class="free">]]</span></span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">∉</span><span class="main">(</span><span class="main">∅</span> <span class="free">Q</span> <span class="free">a</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">∉</span><span class="main">(</span><span class="main">∅</span> <span class="free">Q</span> <span class="free">b</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∉</span> <span class="main">∅</span> <span class="free">Q</span> <span class="free">a</span> <span class="main">∪</span> <span class="main">∅</span> <span class="free">Q</span> <span class="free">b</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ay</span></span> <span class="skolem"><span class="skolem">yb</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"path <span class="skolem">ay</span> <span class="free">a</span> <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"path <span class="skolem">yb</span> <span class="free">b</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">`<span class="skolem">y</span><span class="main">∈</span><span class="free">Q</span>`</span></span> exist_ay events<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> reachable<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">y</span> <span class="skolem">ay</span> <span class="skolem">yb</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="free">c</span> <span class="free">d</span> <span class="skolem">y</span><span class="main"><span class="free">]]</span></span>›</span></span> <span class="quoted"><span class="quoted">‹path <span class="skolem">ay</span> <span class="free">a</span> <span class="skolem">y</span>›</span></span> <span class="quoted"><span class="quoted">‹path <span class="skolem">yb</span> <span class="free">b</span> <span class="skolem">y</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> <span class="free">Q</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">c</span> <span class="free">d</span> <span class="skolem">z</span><span class="main"><span class="free">]]</span></span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span><span class="main">∉</span><span class="main">(</span><span class="main">∅</span> <span class="free">Q</span> <span class="free">a</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span><span class="main">∉</span><span class="main">(</span><span class="main">∅</span> <span class="free">Q</span> <span class="free">b</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z</span> <span class="main">∉</span> <span class="main">∅</span> <span class="free">Q</span> <span class="free">a</span> <span class="main">∪</span> <span class="main">∅</span> <span class="free">Q</span> <span class="free">b</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">az</span></span> <span class="skolem"><span class="skolem">bz</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"path <span class="skolem">az</span> <span class="free">a</span> <span class="skolem">z</span>"</span></span> <span class="quoted"><span class="quoted">"path <span class="skolem">bz</span> <span class="free">b</span> <span class="skolem">z</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">`<span class="skolem">z</span><span class="main">∈</span><span class="free">Q</span>`</span></span> exist_ay events<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> reachable<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">z</span> <span class="skolem">az</span> <span class="skolem">bz</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="free">c</span> <span class="free">d</span> <span class="skolem">z</span><span class="main"><span class="free">]]</span></span>›</span></span> <span class="quoted"><span class="quoted">‹path <span class="skolem">az</span> <span class="free">a</span> <span class="skolem">z</span>›</span></span> <span class="quoted"><span class="quoted">‹path <span class="skolem">bz</span> <span class="free">b</span> <span class="skolem">z</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z</span> <span class="main">∈</span> <span class="free">Q</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟦</span><span class="skolem">y</span> <span class="free">c</span> <span class="free">d</span><span class="main">]]</span> <span class="main">∨</span> <span class="main">[[</span><span class="free">c</span> <span class="skolem">y</span> <span class="free">d</span><span class="main">⟧</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">⟦</span><span class="skolem">z</span> <span class="free">c</span> <span class="free">d</span><span class="main">]]</span> <span class="main">∨</span> <span class="main">[[</span><span class="free">c</span> <span class="skolem">z</span> <span class="free">d</span><span class="main">⟧</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">e</span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="free">c</span> <span class="free">d</span> <span class="bound">e</span><span class="main"><span class="free">]]</span></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> prolong_betw <span class="comment1">(* works as Schutz says! *)</span>
      <span class="keyword1"><span class="command">using</span></span> events<span class="main">(</span>3-5<span class="main">)</span> path_Q <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">c</span> <span class="free">d</span> <span class="skolem">e</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main"><span class="free">[[</span></span><span class="skolem">y</span> <span class="skolem">e</span> <span class="skolem">z</span><span class="main"><span class="free">]]</span></span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> notI<span class="main">)</span>
      <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Notice Theorem 10 is not needed for this proof, and does not seem to help <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>sledgehammer›</span></span></span></span>.
        I think this is because it cannot be easily/automatically reconciled with non-strict
        notation.›</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="skolem">y</span> <span class="skolem">e</span> <span class="skolem">z</span><span class="main"><span class="free">]]</span></span>"</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟦</span><span class="skolem">y</span> <span class="free">c</span> <span class="free">d</span><span class="main">]]</span> <span class="main">∧</span> <span class="main">⟦</span><span class="skolem">z</span> <span class="free">c</span> <span class="free">d</span><span class="main">]]</span><span class="main">)</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟦</span><span class="skolem">y</span> <span class="free">c</span> <span class="free">d</span><span class="main">]]</span> <span class="main">∧</span> <span class="main">[[</span><span class="free">c</span> <span class="skolem">z</span> <span class="free">d</span><span class="main">⟧</span><span class="main">)</span>"</span></span> <span class="main">|</span>
               <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[[</span><span class="free">c</span> <span class="skolem">y</span> <span class="free">d</span><span class="main">⟧</span> <span class="main">∧</span> <span class="main">⟦</span><span class="skolem">z</span> <span class="free">c</span> <span class="free">d</span><span class="main">]]</span><span class="main">)</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[[</span><span class="free">c</span> <span class="skolem">y</span> <span class="free">d</span><span class="main">⟧</span> <span class="main">∧</span> <span class="main">[[</span><span class="free">c</span> <span class="skolem">z</span> <span class="free">d</span><span class="main">⟧</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">⟦</span><span class="skolem">y</span> <span class="free">c</span> <span class="free">d</span><span class="main">]]</span> <span class="main">∨</span> <span class="main">[[</span><span class="free">c</span> <span class="skolem">y</span> <span class="free">d</span><span class="main">⟧</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">⟦</span><span class="skolem">z</span> <span class="free">c</span> <span class="free">d</span><span class="main">]]</span> <span class="main">∨</span> <span class="main">[[</span><span class="free">c</span> <span class="skolem">z</span> <span class="free">d</span><span class="main">⟧</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="free">c</span> <span class="free">d</span> <span class="skolem">e</span><span class="main"><span class="free">]]</span></span>›</span></span> abc_ac_neq betw4_strong betw4_weak<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span><span class="main">∈</span><span class="free">Q</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="free">c</span> <span class="free">d</span> <span class="skolem">e</span><span class="main"><span class="free">]]</span></span>›</span></span> betw_c_in_path events<span class="main">(</span>3-5<span class="main">)</span> path_Q <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span><span class="main">∉</span> <span class="main">∅</span> <span class="free">Q</span> <span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span><span class="main">∉</span> <span class="main">∅</span> <span class="free">Q</span> <span class="free">b</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> bounds_yz <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main"><span class="free">[[</span></span><span class="skolem">y</span> <span class="skolem">e</span> <span class="skolem">z</span><span class="main"><span class="free">]]</span></span>›</span></span> abc_sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span> 
    <span class="keyword1"><span class="command">hence</span></span> ex_aebe<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ae</span> <span class="bound">be</span><span class="main">.</span> path <span class="bound">ae</span> <span class="free">a</span> <span class="skolem">e</span> <span class="main">∧</span> path <span class="bound">be</span> <span class="free">b</span> <span class="skolem">e</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">e</span> <span class="main">∈</span> <span class="free">Q</span>›</span></span> events<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> in_path_event path_Q reachable<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> unreachable_bounded_path_only
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="free">c</span> <span class="free">d</span> <span class="skolem">e</span><span class="main"><span class="free">]]</span></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">e</span> <span class="main">∈</span> <span class="free">Q</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The assumption <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Q≠R›</span></span></span></span> in Theorem 14(iii) is somewhat implicit in Schutz.
  If <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Q=R›</span></span></span></span>, <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>∅ Q a›</span></span></span></span> is empty, so the third conjunct of the conclusion is meaningless.
›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> <span class="comment1">(*14*)</span> second_existence_thm_3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> paths<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span><span class="main">∈</span><span class="free">𝒫</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span><span class="main">∈</span><span class="free">𝒫</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span><span class="main">≠</span><span class="free">R</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> events<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">∈</span><span class="free">Q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">∈</span><span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">∈</span><span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">≠</span><span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">∉</span><span class="free">Q</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> reachable<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">P</span><span class="main">∈</span><span class="free">𝒫</span><span class="main">.</span> <span class="main">∃</span><span class="bound">q</span><span class="main">∈</span><span class="free">Q</span><span class="main">.</span> path <span class="bound">P</span> <span class="free">b</span> <span class="bound">q</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">e</span><span class="main">∈</span><span class="free">ℰ</span><span class="main">.</span> <span class="main">∃</span><span class="bound">ae</span><span class="main">∈</span><span class="free">𝒫</span><span class="main">.</span> <span class="main">∃</span><span class="bound">be</span><span class="main">∈</span><span class="free">𝒫</span><span class="main">.</span> path <span class="bound">ae</span> <span class="free">a</span> <span class="bound">e</span> <span class="main">∧</span> path <span class="bound">be</span> <span class="free">b</span> <span class="bound">e</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="main">∅</span> <span class="free">Q</span> <span class="free">a</span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="free">x</span> <span class="bound">y</span> <span class="bound">e</span><span class="main"><span class="free">]]</span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">∉</span><span class="free">Q</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> events<span class="main">(</span>1-4<span class="main">)</span> paths eq_paths <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∅</span> <span class="free">Q</span> <span class="free">a</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> events<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> ex_in_conv in_path_event paths<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span> two_in_unreach<span class="main">)</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">∈</span> <span class="main">∅</span> <span class="free">Q</span> <span class="free">a</span>"</span></span> <span class="comment1">(*as in Schutz*)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">≠</span><span class="skolem">d</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">d</span> <span class="main">∈</span> <span class="main">∅</span> <span class="free">Q</span> <span class="free">a</span>›</span></span> cross_in_reachable events<span class="main">(</span>1<span class="main">)</span> events<span class="main">(</span>2<span class="main">)</span> events<span class="main">(</span>3<span class="main">)</span> paths<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">∈</span><span class="free">Q</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">d</span> <span class="main">∈</span> <span class="main">∅</span> <span class="free">Q</span> <span class="free">a</span>›</span></span> unreach_on_path <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">e</span><span class="main">∈</span><span class="free">Q</span><span class="main">.</span> <span class="main">∃</span><span class="bound">ae</span> <span class="bound">be</span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="free">x</span> <span class="skolem">d</span> <span class="bound">e</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> path <span class="bound">ae</span> <span class="free">a</span> <span class="bound">e</span> <span class="main">∧</span> path <span class="bound">be</span> <span class="free">b</span> <span class="bound">e</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> second_existence_thm_2 <span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> c<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> Q<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">Q</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">a</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">b</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> d<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">d</span></span><span class="main">]</span> <span class="comment1">(*as in Schutz*)</span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∉</span> <span class="free">Q</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">d</span> <span class="main">∈</span> <span class="free">Q</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">≠</span> <span class="skolem">d</span>›</span></span> events<span class="main">(</span>1-3<span class="main">,</span>5<span class="main">)</span> paths<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> reachable <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="skolem"><span class="skolem">ae</span></span> <span class="skolem"><span class="skolem">be</span></span> <span class="keyword2"><span class="keyword">where</span></span> conds<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">x</span> <span class="skolem">d</span> <span class="skolem">e</span><span class="main"><span class="free">]]</span></span> <span class="main">∧</span> path <span class="skolem">ae</span> <span class="free">a</span> <span class="skolem">e</span> <span class="main">∧</span> path <span class="skolem">be</span> <span class="free">b</span> <span class="skolem">e</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="main">(</span><span class="main">∅</span> <span class="free">Q</span> <span class="free">a</span><span class="main">)</span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="free">x</span> <span class="bound">y</span> <span class="skolem">e</span><span class="main"><span class="free">]]</span></span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">∈</span><span class="main">(</span><span class="main">∅</span> <span class="free">Q</span> <span class="free">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">∈</span><span class="free">Q</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> unreach_on_path <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">x</span> <span class="skolem">y</span> <span class="skolem">e</span><span class="main"><span class="free">]]</span></span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main"><span class="free">[[</span></span><span class="free">x</span> <span class="skolem">y</span> <span class="skolem">e</span><span class="main"><span class="free">]]</span></span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">=</span><span class="free">x</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">=</span><span class="skolem">e</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="skolem">y</span> <span class="free">x</span> <span class="skolem">e</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">x</span> <span class="skolem">e</span> <span class="skolem">y</span><span class="main"><span class="free">]]</span></span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">d</span><span class="main">∈</span><span class="free">Q</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span><span class="main">∈</span><span class="free">Q</span>›</span></span> abc_abc_neq abc_sym betw_c_in_path conds events<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> paths<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> some_betw<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">=</span><span class="free">x</span>"</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> <span class="main">∅</span> <span class="free">Q</span> <span class="free">a</span>›</span></span> events<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> paths<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> same_empty_unreach unreach_equiv unreach_on_path
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">=</span><span class="skolem">e</span>"</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span><span class="main">∈</span><span class="free">Q</span>›</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> conds empty_iff same_empty_unreach unreach_equiv <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> <span class="main">∅</span> <span class="free">Q</span> <span class="free">a</span>›</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="skolem">y</span> <span class="free">x</span> <span class="skolem">e</span><span class="main"><span class="free">]]</span></span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="skolem">y</span> <span class="free">x</span> <span class="skolem">d</span><span class="main"><span class="free">]]</span></span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> abd_bcd_abc conds <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">∈</span><span class="main">(</span><span class="main">∅</span> <span class="free">Q</span> <span class="free">a</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> unreach_connected <span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> Q<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">Q</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> Q<span class="hidden">⇩</span><sub>x</sub><span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> Q<span class="hidden">⇩</span><sub>y</sub><span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> Q<span class="hidden">⇩</span><sub>z</sub><span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">a</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span><span class="main"><span class="free">[[</span></span><span class="free">x</span> <span class="skolem">y</span> <span class="skolem">e</span><span class="main"><span class="free">]]</span></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span><span class="main">∉</span><span class="free">Q</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">d</span><span class="main">∈</span><span class="main">∅</span> <span class="free">Q</span> <span class="free">a</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span><span class="main">∈</span><span class="main">∅</span> <span class="free">Q</span> <span class="free">a</span>›</span></span> conds in_path_event paths<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
          <span class="keyword1"><span class="command">using</span></span> empty_iff events<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> paths<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> same_empty_unreach unreach_equiv unreach_on_path
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="free">x</span> <span class="skolem">e</span> <span class="skolem">y</span><span class="main"><span class="free">]]</span></span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="skolem">d</span> <span class="skolem">e</span> <span class="skolem">y</span><span class="main"><span class="free">]]</span></span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> abc_acd_bcd conds <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span><span class="main">∈</span><span class="main">(</span><span class="main">∅</span> <span class="free">Q</span> <span class="free">a</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> unreach_connected <span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> Q<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">Q</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> Q<span class="hidden">⇩</span><sub>x</sub><span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> Q<span class="hidden">⇩</span><sub>y</sub><span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> Q<span class="hidden">⇩</span><sub>z</sub><span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">a</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∉</span> <span class="free">Q</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">d</span> <span class="main">∈</span> <span class="main">∅</span> <span class="free">Q</span> <span class="free">a</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> <span class="main">∅</span> <span class="free">Q</span> <span class="free">a</span>›</span></span>
            abc_abc_neq abc_sym events<span class="main">(</span>3<span class="main">)</span> in_path_event paths<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conds empty_iff paths<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> same_empty_unreach unreach_equiv unreach_on_path<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> conds in_path_event <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context MinkowskiSpacetime *)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Theorem 11 - with path density assumed"</span></span>
<span class="keyword1"><span class="command">locale</span></span> MinkowskiDense <span class="main">=</span> MinkowskiSpacetime <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> path_dense<span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="free">ab</span> <span class="free">a</span> <span class="free">b</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="main"><span class="free">[[</span></span><span class="free">a</span> <span class="bound">x</span> <span class="free">b</span><span class="main"><span class="free">]]</span></span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Path density: if $a$ and $b$ are connected by a path, then the segment between them is nonempty.
  Since Schutz insists on the number of segments in his segmentation (Theorem 11), we prove it here,
  showcasing where his missing assumption of path density fits in
  (it is used three times in <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>number_of_segments›</span></span></span></span>, once in each separate meaningful ordering case).
›</span></span>

<span class="keyword1" id="TemporalOrderOnPath-segment_nonempty"><span class="command">lemma</span></span> segment_nonempty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"path <span class="free">ab</span> <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">x</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> segment <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> path_dense <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> seg_betw assms<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> <span class="comment1">(*for 11*)</span> number_of_segments<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> path_P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span><span class="main">∈</span><span class="free">𝒫</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> Q_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span><span class="main">⊆</span><span class="free">P</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> f_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">f</span><span class="main">[</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">..</span><span class="free">c</span><span class="main">]</span><span class="free">Q</span><span class="main">]</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span>segment <span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">|</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">&lt;</span><span class="main">(</span>card <span class="free">Q</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> card <span class="free">Q</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span>segment <span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">|</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">&lt;</span><span class="main">(</span>card <span class="free">Q</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?N</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"card <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?g</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> segment <span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?N</span> <span class="main">≥</span> <span class="numeral">3</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> ch_by_ord_def f_def fin_long_chain_def long_ch_card_ge3<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?g</span> <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="var">?N</span><span class="main">-</span><span class="numeral">2</span><span class="main">}</span> <span class="main">=</span> <span class="var">?S</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">safe</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="main">0</span><span class="main">::</span>nat<span class="main">)</span><span class="main">..</span><span class="var">?N</span><span class="main">-</span><span class="numeral">2</span><span class="main">}</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ia</span><span class="main">.</span> segment <span class="main">(</span><span class="free">f</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="skolem">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> segment <span class="main">(</span><span class="free">f</span> <span class="bound">ia</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="bound">ia</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">ia</span><span class="main">&lt;</span>card <span class="free">Q</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">&lt;</span><span class="var">?N</span><span class="main">-</span><span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms <span class="quoted"><span class="quoted">‹<span class="skolem">i</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="main">0</span><span class="main">::</span>nat<span class="main">)</span><span class="main">..</span><span class="var">?N</span><span class="main">-</span><span class="numeral">2</span><span class="main">}</span>›</span></span> <span class="quoted"><span class="quoted">`<span class="var">?N</span><span class="main">≥</span><span class="numeral">3</span>`</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def Suc_diff_Suc atLeastAtMost_iff le_less_trans lessI less_le_trans
            less_trans numeral_2_eq_2 numeral_3_eq_3<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"segment <span class="main">(</span><span class="free">f</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> segment <span class="main">(</span><span class="free">f</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">i</span><span class="main">&lt;</span><span class="var">?N</span><span class="main">-</span><span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">i</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> card <span class="free">Q</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"segment <span class="main">(</span><span class="free">f</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?s</span> <span class="main">∈</span> <span class="var">?g</span> <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="var">?N</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="var">?N</span><span class="main">-</span><span class="numeral">2</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">&lt;</span> card <span class="free">Q</span> <span class="main">-</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="var">?g</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="var">?N</span><span class="main">-</span><span class="numeral">2</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="var">?N</span><span class="main">-</span><span class="numeral">2</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="var">?N</span><span class="main">-</span><span class="numeral">2</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?g</span> <span class="skolem">i</span> <span class="main">=</span> <span class="var">?g</span> <span class="skolem">j</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">=</span><span class="skolem">j</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">≠</span><span class="skolem">j</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">i</span> <span class="main">≠</span> <span class="free">f</span> <span class="skolem">j</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> asm<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> f_def assms<span class="main">(</span>3<span class="main">)</span> indices_neq_imp_events_neq
          <span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> X<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">Q</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> f<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">f</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">a</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">b</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> c<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">c</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> i<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> j<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">j</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span><span class="main">=</span><span class="skolem">i</span><span class="main">+</span><span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="skolem">j</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> asm<span class="main">(</span>2<span class="main">)</span> assms fin_long_chain_def order_finite_chain <span class="quoted"><span class="quoted">`<span class="var">?N</span><span class="main">≥</span><span class="numeral">3</span>`</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> One_nat_def Suc_diff_Suc Suc_less_eq add.commute
              add_leD2 atLeastAtMost_iff card.remove card_Diff_singleton less_Suc_eq_le
              less_add_one numeral_2_eq_2 numeral_3_eq_3 plus_1_eq_Suc<span class="main">)</span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span><span class="main">∈</span><span class="var">?g</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> segment_nonempty abc_ex_path asm<span class="main">(</span>3<span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="skolem">i</span> <span class="main">≠</span> <span class="free">f</span> <span class="skolem">j</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">=</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span>›</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span><span class="main">∈</span><span class="var">?g</span> <span class="skolem">i</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> asm<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">j</span><span class="main">)</span> <span class="skolem">e</span><span class="main"><span class="free">]]</span></span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> abd_bcd_abc <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">‹<span class="skolem">e</span> <span class="main">∈</span> segment <span class="main">(</span><span class="free">f</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>›</span></span> seg_betw<span class="main">)</span> 
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">e</span> <span class="main">∈</span> segment <span class="main">(</span><span class="free">f</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">=</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span>›</span></span> abc_only_cba<span class="main">(</span>2<span class="main">)</span> seg_betw
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span><span class="main">≠</span><span class="skolem">i</span><span class="main">+</span><span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> card <span class="free">Q</span> <span class="main">∧</span> <span class="skolem">j</span> <span class="main">&lt;</span> card <span class="free">Q</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">&lt;</span> card <span class="free">Q</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> add_mono_thms_linordered_field<span class="main">(</span>3<span class="main">)</span> asm<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> assms <span class="quoted"><span class="quoted">`<span class="var">?N</span><span class="main">≥</span><span class="numeral">3</span>`</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">i</span> <span class="main">∈</span> <span class="free">Q</span> <span class="main">∧</span> <span class="free">f</span> <span class="skolem">j</span> <span class="main">∈</span> <span class="free">Q</span> <span class="main">∧</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">∈</span> <span class="free">Q</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> f_def <span class="keyword1"><span class="command">unfolding</span></span> fin_long_chain_def long_ch_by_ord_def ordering_def
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">i</span> <span class="main">∈</span> <span class="free">P</span> <span class="main">∧</span> <span class="free">f</span> <span class="skolem">j</span> <span class="main">∈</span> <span class="free">P</span> <span class="main">∧</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">∈</span> <span class="free">P</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> path_is_union assms
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subset_iff<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="skolem">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">j</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="skolem">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span> <span class="main">|</span>
                      <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="skolem">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">j</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> some_betw path_P f_def indices_neq_imp_events_neq
            <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="skolem">i</span> <span class="main">≠</span> <span class="free">f</span> <span class="skolem">j</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">&lt;</span> card <span class="free">Q</span> <span class="main">∧</span> <span class="skolem">j</span> <span class="main">&lt;</span> card <span class="free">Q</span> <span class="main">∧</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">&lt;</span> card <span class="free">Q</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">≠</span> <span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> abc_sym less_add_one less_irrefl_nat<span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="skolem">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">j</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span><span class="main">∈</span><span class="var">?g</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> segment_nonempty
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="skolem">i</span> <span class="main">∈</span> <span class="free">P</span> <span class="main">∧</span> <span class="free">f</span> <span class="skolem">j</span> <span class="main">∈</span> <span class="free">P</span> <span class="main">∧</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">∈</span> <span class="free">P</span>›</span></span> abc_abc_neq path_P<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="skolem">e</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="skolem">j</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="skolem">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">j</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>›</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> abc_acd_abd abc_acd_bcd abc_only_cba abc_sym asm<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> seg_betw<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span><span class="main">∈</span><span class="var">?g</span> <span class="skolem">j</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">e</span> <span class="main">∈</span> <span class="var">?g</span> <span class="skolem">i</span>›</span></span> asm<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abc_only_cba<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> seg_betw<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="skolem">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
            <span class="keyword1"><span class="command">using</span></span> abc_abc_neq <span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">j</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> c<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">(</span><span class="skolem">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span><span class="main">]</span> asm<span class="main">(</span>3<span class="main">)</span> seg_betw <span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">j</span>"</span></span><span class="main">]</span>
            <span class="keyword1"><span class="command">using</span></span> ends_notin_segment <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="skolem">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">j</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span><span class="main">∈</span><span class="var">?g</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> segment_nonempty
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="skolem">i</span> <span class="main">∈</span> <span class="free">P</span> <span class="main">∧</span> <span class="free">f</span> <span class="skolem">j</span> <span class="main">∈</span> <span class="free">P</span> <span class="main">∧</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">∈</span> <span class="free">P</span>›</span></span> abc_abc_neq path_P<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[[</span></span><span class="skolem">e</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="skolem">j</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="skolem">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">≠</span> <span class="free">f</span> <span class="skolem">j</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="skolem">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">j</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>›</span></span> abc_abc_neq <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">e</span> <span class="main">∈</span> segment <span class="main">(</span><span class="free">f</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="skolem">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">[[</span></span><span class="main">(</span><span class="free">f</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="skolem">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">j</span><span class="main">)</span><span class="main"><span class="free">]]</span></span>›</span></span> asm<span class="main">(</span>3<span class="main">)</span> seg_betw
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> abc_abc_neq abc_acd_abd abc_acd_bcd abc_sym<span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span><span class="main">∈</span><span class="var">?g</span> <span class="skolem">j</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">e</span> <span class="main">∈</span> <span class="var">?g</span> <span class="skolem">i</span>›</span></span> asm<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abc_only_cba<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> seg_betw<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="var">?g</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="var">?N</span><span class="main">-</span><span class="numeral">2</span><span class="main">}</span> <span class="var">?S</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> inj_on_imp_bij_betw <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> bij_betw_same_card numeral_2_eq_2 numeral_3_eq_3 <span class="quoted"><span class="quoted">`<span class="var">?N</span><span class="main">≥</span><span class="numeral">3</span>`</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> One_nat_def Suc_diff_Suc card_atLeastAtMost le_less_trans
        less_Suc_eq_le minus_nat.diff_0 not_less not_numeral_le_zero<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> <span class="comment1">(*11*)</span> segmentation_card<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> path_P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span><span class="main">∈</span><span class="free">𝒫</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> Q_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span><span class="main">⊆</span><span class="free">P</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> f_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">f</span><span class="main">[</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">]</span><span class="free">Q</span><span class="main">]</span>"</span></span> <span class="comment1">(* This always exists given card Q &gt; 2 *)</span>
    <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">P1</span> <span class="keyword2"><span class="keyword">defines</span></span> P1_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P1</span> <span class="main">≡</span> prolongation <span class="free">b</span> <span class="free">a</span>"</span></span>
    <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">P2</span> <span class="keyword2"><span class="keyword">defines</span></span>  P2_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P2</span> <span class="main">≡</span> prolongation <span class="free">a</span> <span class="free">b</span>"</span></span>
    <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">S</span> <span class="keyword2"><span class="keyword">defines</span></span> S_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">≡</span> <span class="main">(</span><span class="keyword1">if</span> card <span class="free">Q</span><span class="main">=</span><span class="numeral">2</span> <span class="keyword1">then</span> <span class="main">{</span>segment <span class="free">a</span> <span class="free">b</span><span class="main">}</span> <span class="keyword1">else</span> <span class="main">{</span>segment <span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">|</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">&lt;</span>card <span class="free">Q</span><span class="main">-</span><span class="main">1</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">⋃</span><span class="free">S</span><span class="main">)</span> <span class="main">∪</span> <span class="free">P1</span> <span class="main">∪</span> <span class="free">P2</span> <span class="main">∪</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
        <span class="comment1">(* The union of these segments and prolongations with the separating points is the path. *)</span>
          <span class="quoted"><span class="quoted">"card <span class="free">S</span> <span class="main">=</span> <span class="main">(</span>card <span class="free">Q</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> is_segment <span class="bound">x</span><span class="main">)</span>"</span></span>
        <span class="comment1">(* There are N-1 segments. *)</span>
        <span class="comment1">(* There are two prolongations. *)</span>
            <span class="comment1">(* "P1∩P2={} ∧ (∀x∈S. (x∩P1={} ∧ x∩P2={} ∧ (∀y∈S. x≠y ⟶ x∩y={})))" *)</span>
          <span class="quoted"><span class="quoted">"disjoint <span class="main">(</span><span class="free">S</span><span class="main">∪</span><span class="main">{</span><span class="free">P1</span><span class="main">,</span><span class="free">P2</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">P1</span><span class="main">≠</span><span class="free">P2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">P1</span><span class="main">∉</span><span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">P2</span><span class="main">∉</span><span class="free">S</span>"</span></span>
        <span class="comment1">(* The prolongations and all the segments are disjoint. *)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?N</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"card <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">≤</span> card <span class="free">Q</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f_def fin_chain_card_geq_2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> seg_facts<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="free">S</span> <span class="main">∪</span> <span class="free">P1</span> <span class="main">∪</span> <span class="free">P2</span> <span class="main">∪</span> <span class="free">Q</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> is_segment <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"disjoint <span class="main">(</span><span class="free">S</span><span class="main">∪</span><span class="main">{</span><span class="free">P1</span><span class="main">,</span><span class="free">P2</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">P1</span><span class="main">≠</span><span class="free">P2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">P1</span><span class="main">∉</span><span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">P2</span><span class="main">∉</span><span class="free">S</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> show_segmentation <span class="main">[</span><span class="operator">OF</span> path_P Q_def f_def<span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> P1_def P2_def S_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">=</span> <span class="main">⋃</span><span class="free">S</span> <span class="main">∪</span> <span class="free">P1</span> <span class="main">∪</span> <span class="free">P2</span> <span class="main">∪</span> <span class="free">Q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> seg_facts<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"disjoint <span class="main">(</span><span class="free">S</span><span class="main">∪</span><span class="main">{</span><span class="free">P1</span><span class="main">,</span><span class="free">P2</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">P1</span><span class="main">≠</span><span class="free">P2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">P1</span><span class="main">∉</span><span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">P2</span><span class="main">∉</span><span class="free">S</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> seg_facts<span class="main">(</span>3-6<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="free">S</span> <span class="main">=</span> <span class="main">(</span><span class="var">?N</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?N</span><span class="main">=</span><span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"card <span class="free">S</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> S_def<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?N</span> <span class="main">=</span> <span class="numeral">2</span>›</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?N</span><span class="main">≠</span><span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?N</span><span class="main">≥</span><span class="numeral">3</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="numeral">2</span> <span class="main">≤</span> card <span class="free">Q</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">f</span><span class="main">[</span><span class="free">a</span><span class="main">..</span><span class="skolem">c</span><span class="main">..</span><span class="free">b</span><span class="main">]</span><span class="free">Q</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms ch_by_ord_def fin_chain_def short_ch_card_2 <span class="quoted"><span class="quoted">‹<span class="numeral">2</span> <span class="main">≤</span> card <span class="free">Q</span>›</span></span> <span class="quoted"><span class="quoted">‹card <span class="free">Q</span> <span class="main">≠</span> <span class="numeral">2</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> number_of_segments <span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">`<span class="main">[</span><span class="free">f</span><span class="main">[</span><span class="free">a</span><span class="main">..</span><span class="skolem">c</span><span class="main">..</span><span class="free">b</span><span class="main">]</span><span class="free">Q</span><span class="main">]</span>`</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">using</span></span> S_def <span class="quoted"><span class="quoted">‹card <span class="free">Q</span> <span class="main">≠</span> <span class="numeral">2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"card <span class="free">S</span> <span class="main">=</span> card <span class="free">Q</span> <span class="main">-</span> <span class="main">1</span> <span class="main">∧</span> Ball <span class="free">S</span> is_segment"</span></span>
    <span class="keyword1"><span class="command">using</span></span> seg_facts<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context MinkowskiDense *)</span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div>